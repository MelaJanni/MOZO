const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/staffRealtime-CQQLemJX.js","assets/index-CAcerDvW.js","assets/vendor-DPnOlTVy.js","assets/bootstrap--QliLv9A.js","assets/index-D91yHXQH.css"])))=>i.map(i=>d[i]);
import{q as a,u as s,s as e,B as i,t,_ as n}from"./index-CAcerDvW.js";import{u as l,r as o,o as r,c as u,a as c,b as d,d as v,t as f,e as p,f as _,w as g,g as m,h}from"./vendor-DPnOlTVy.js";import"./bootstrap--QliLv9A.js";const b={class:"join-staff-container"},y={class:"join-card"},S={class:"join-header"},w=["src"],k={key:0,class:"loading-section"},q={key:1,class:"success-section"},j={key:0,class:"staff-info"},I={key:2,class:"error-section"},R={key:0,class:"auth-options"},A={key:3,class:"auth-section"},D={class:"auth-options"},C=a({__name:"JoinStaff",setup(a){const C=l(),E=m(),J=s(),P=C.params.token,T=o(!1),O=o(""),x=o(""),F=o(null),L=()=>{localStorage.setItem("redirectAfterLogin",C.fullPath),E.push("/login")},U=()=>{localStorage.setItem("redirectAfterLogin",C.fullPath),E.push("/register")};return r(()=>{P?J.isAuthenticated&&(async()=>{var a,s,e,i,l,o,r,u,c;if(J.isAuthenticated){T.value=!0,O.value="";try{const u=J.getUser(),c=await t.joinStaffWithToken(P,{user_id:u.id});F.value=c.data.data,x.value=c.data.message;try{console.log("🔔 JoinStaff: Writing staff request to Firebase...");const{writeStaffRequest:t}=await n(async()=>{const{writeStaffRequest:a}=await import("./staffRealtime-CQQLemJX.js");return{writeStaffRequest:a}},__vite__mapDeps([0,1,2,3,4])),d=(null==(s=null==(a=c.data.data)?void 0:a.business)?void 0:s.id)||(null==(e=c.data.data)?void 0:e.business_id);d?(await t(d,{id:(null==(i=c.data.data)?void 0:i.id)||Date.now(),name:u.name||u.display_name||"Usuario",user_id:u.id,status:(null==(l=c.data.data)?void 0:l.status)||"pending",created_at:(new Date).toISOString(),last_request_id:(null==(o=c.data.data)?void 0:o.id)||Date.now(),last_request_name:u.name||u.display_name||"Usuario",last_request_status:(null==(r=c.data.data)?void 0:r.status)||"pending",last_update:Date.now()}),console.log("🔔 JoinStaff: Staff request written to Firebase successfully")):console.warn("🔔 JoinStaff: No business ID found in response")}catch(d){console.error("🔔 JoinStaff: Error writing to Firebase:",d)}setTimeout(()=>{E.push("/waiter")},3e3)}catch(v){O.value=(null==(c=null==(u=v.response)?void 0:u.data)?void 0:c.message)||"Error al unirse al negocio"}finally{T.value=!1}}else O.value="Debes iniciar sesión para unirte al negocio"})():O.value="Token de invitación inválido"}),(a,s)=>{var t;return h(),u("div",b,[c("div",y,[c("div",S,[c("img",{src:v(e),alt:"MOZO",class:"logo"},null,8,w),s[0]||(s[0]=c("h1",null,"Invitación de Trabajo",-1)),s[1]||(s[1]=c("p",null,"Has sido invitado a unirte a un negocio como miembro del personal",-1))]),T.value?(h(),u("div",k,s[2]||(s[2]=[c("div",{class:"loading-spinner"},null,-1),c("p",null,"Procesando invitación...",-1)]))):x.value?(h(),u("div",q,[s[5]||(s[5]=c("div",{class:"success-icon"},[c("i",{class:"bi bi-check-circle-fill"})],-1)),s[6]||(s[6]=c("h2",null,"¡Bienvenido al equipo!",-1)),c("p",null,f(x.value),1),F.value?(h(),u("div",j,[c("p",null,[s[3]||(s[3]=c("strong",null,"Negocio:",-1)),p(" "+f(null==(t=F.value.business)?void 0:t.name),1)]),c("p",null,[s[4]||(s[4]=c("strong",null,"Cargo:",-1)),p(" "+f(F.value.position),1)])])):d("",!0),s[7]||(s[7]=c("p",{class:"redirect-message"}," Serás redirigido al panel de mozo en unos segundos... ",-1))])):O.value?(h(),u("div",I,[s[10]||(s[10]=c("div",{class:"error-icon"},[c("i",{class:"bi bi-exclamation-triangle-fill"})],-1)),s[11]||(s[11]=c("h2",null,"Error",-1)),c("p",null,f(O.value),1),O.value.includes("iniciar sesión")?(h(),u("div",R,[_(i,{onClick:L,variant:"primary",class:"auth-button"},{default:g(()=>s[8]||(s[8]=[p(" Iniciar Sesión ")])),_:1,__:[8]}),_(i,{onClick:U,variant:"secondary",class:"auth-button"},{default:g(()=>s[9]||(s[9]=[p(" Registrarse ")])),_:1,__:[9]})])):d("",!0)])):v(J).isAuthenticated?d("",!0):(h(),u("div",A,[s[14]||(s[14]=c("div",{class:"auth-icon"},[c("i",{class:"bi bi-person-check"})],-1)),s[15]||(s[15]=c("h2",null,"Autenticación Requerida",-1)),s[16]||(s[16]=c("p",null,"Para aceptar esta invitación, necesitas iniciar sesión o crear una cuenta.",-1)),c("div",D,[_(i,{onClick:L,variant:"primary",class:"auth-button"},{default:g(()=>s[12]||(s[12]=[p(" Iniciar Sesión ")])),_:1,__:[12]}),_(i,{onClick:U,variant:"secondary",class:"auth-button"},{default:g(()=>s[13]||(s[13]=[p(" Registrarse ")])),_:1,__:[13]})])]))])])}}},[["__scopeId","data-v-68d5f383"]]);export{C as default};
