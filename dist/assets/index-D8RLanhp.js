const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/echo-DazC-UKW.js","assets/vendor-CC72n-b_.js","assets/bootstrap--QliLv9A.js","assets/index.esm-BIzZB3Zu.js","assets/index.esm-BzFJCx3r.js","assets/index.esm-Bt68CSGu.js","assets/staffRealtime-DiZPA2GU.js","assets/web-C2hW9ook.js","assets/web-BKA6N7Xb.js","assets/index-DlE1A72V.js","assets/JoinStaff-erESBuF5.js","assets/JoinStaff-Bp5UGIcf.css","assets/Completeness-BxBBsYqb.js","assets/Completeness-CbHRmKuw.css","assets/redirectResultHandler-w4lVDc6c.js","assets/androidFCM-CtXznQHW.js"])))=>i.map(i=>d[i]);
var e;import{k as t,r as a,l as n,d as i,o as s,c as o,a as r,b as l,t as c,m as d,p as u,v as h,f as p,q as m,w as f,s as v,e as g,g as b,h as w,u as y,F as _,i as k,n as C,x as E,y as I,z as S,A as T,B as N,C as P,D as A,E as x,G as R,j as D,H as O,I as L,J as M,K as U,L as F,M as q,T as B,N as j,O as $,P as z}from"./vendor-CC72n-b_.js";import{M as V}from"./bootstrap--QliLv9A.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const W={},H=function(e,t,a){let n=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=(null==a?void 0:a.nonce)||(null==a?void 0:a.getAttribute("nonce"));n=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in W)return;W[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,i&&n.setAttribute("nonce",i),document.head.appendChild(n),t?new Promise((t,a)=>{n.addEventListener("load",t),n.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)})},G=t("calls",{state:()=>({calls:{},waiterActiveIds:[],businessActiveIds:[],stats:{pending_count:0,total_active_calls:0},initialized:!1,loading:!1,lastSync:null}),getters:{list:e=>Object.values(e.calls).sort((e,t)=>(t.called_at||0)-(e.called_at||0)),pending:e=>Object.values(e.calls).filter(e=>"pending"===e.status),acknowledged:e=>Object.values(e.calls).filter(e=>"acknowledged"===e.status),active:e=>Object.values(e.calls).filter(e=>"completed"!==e.status),has:e=>t=>!!e.calls[t]},actions:{upsert(e){if(!e||!e.id)return;const t=this.calls[e.id];if(t){const a={pending:1,acknowledged:2,completed:3};if(a[e.status]<a[t.status])return}this.calls[e.id]={...t||{},...e},this.lastSync=Date.now()},remove(e){this.calls[e]&&delete this.calls[e]},setWaiterActive(e){this.waiterActiveIds=e||[]},updateStats(e){this.stats={...this.stats,...e||{}}},markInitialized(){this.initialized=!0}}});function K(e,t){return function(){return e.apply(t,arguments)}}const{toString:J}=Object.prototype,{getPrototypeOf:Y}=Object,{iterator:Q,toStringTag:Z}=Symbol,X=(e=>t=>{const a=J.call(t);return e[a]||(e[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),ee=e=>(e=e.toLowerCase(),t=>X(t)===e),te=e=>t=>typeof t===e,{isArray:ae}=Array,ne=te("undefined");const ie=ee("ArrayBuffer");const se=te("string"),oe=te("function"),re=te("number"),le=e=>null!==e&&"object"==typeof e,ce=e=>{if("object"!==X(e))return!1;const t=Y(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Z in e||Q in e)},de=ee("Date"),ue=ee("File"),he=ee("Blob"),pe=ee("FileList"),me=ee("URLSearchParams"),[fe,ve,ge,be]=["ReadableStream","Request","Response","Headers"].map(ee);function we(e,t,{allOwnKeys:a=!1}={}){if(null==e)return;let n,i;if("object"!=typeof e&&(e=[e]),ae(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const i=a?Object.getOwnPropertyNames(e):Object.keys(e),s=i.length;let o;for(n=0;n<s;n++)o=i[n],t.call(null,e[o],o,e)}}function ye(e,t){t=t.toLowerCase();const a=Object.keys(e);let n,i=a.length;for(;i-- >0;)if(n=a[i],t===n.toLowerCase())return n;return null}const _e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,ke=e=>!ne(e)&&e!==_e;const Ce=(e=>t=>e&&t instanceof e)("undefined"!=typeof Uint8Array&&Y(Uint8Array)),Ee=ee("HTMLFormElement"),Ie=(({hasOwnProperty:e})=>(t,a)=>e.call(t,a))(Object.prototype),Se=ee("RegExp"),Te=(e,t)=>{const a=Object.getOwnPropertyDescriptors(e),n={};we(a,(a,i)=>{let s;!1!==(s=t(a,i,e))&&(n[i]=s||a)}),Object.defineProperties(e,n)};const Ne=ee("AsyncFunction"),Pe=(Ae="function"==typeof setImmediate,xe=oe(_e.postMessage),Ae?setImmediate:xe?(Re=`axios@${Math.random()}`,De=[],_e.addEventListener("message",({source:e,data:t})=>{e===_e&&t===Re&&De.length&&De.shift()()},!1),e=>{De.push(e),_e.postMessage(Re,"*")}):e=>setTimeout(e));var Ae,xe,Re,De;const Oe="undefined"!=typeof queueMicrotask?queueMicrotask.bind(_e):"undefined"!=typeof process&&process.nextTick||Pe,Le={isArray:ae,isArrayBuffer:ie,isBuffer:function(e){return null!==e&&!ne(e)&&null!==e.constructor&&!ne(e.constructor)&&oe(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||oe(e.append)&&("formdata"===(t=X(e))||"object"===t&&oe(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&ie(e.buffer),t},isString:se,isNumber:re,isBoolean:e=>!0===e||!1===e,isObject:le,isPlainObject:ce,isReadableStream:fe,isRequest:ve,isResponse:ge,isHeaders:be,isUndefined:ne,isDate:de,isFile:ue,isBlob:he,isRegExp:Se,isFunction:oe,isStream:e=>le(e)&&oe(e.pipe),isURLSearchParams:me,isTypedArray:Ce,isFileList:pe,forEach:we,merge:function e(){const{caseless:t}=ke(this)&&this||{},a={},n=(n,i)=>{const s=t&&ye(a,i)||i;ce(a[s])&&ce(n)?a[s]=e(a[s],n):ce(n)?a[s]=e({},n):ae(n)?a[s]=n.slice():a[s]=n};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&we(arguments[i],n);return a},extend:(e,t,a,{allOwnKeys:n}={})=>(we(t,(t,n)=>{a&&oe(t)?e[n]=K(t,a):e[n]=t},{allOwnKeys:n}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,a,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),a&&Object.assign(e.prototype,a)},toFlatObject:(e,t,a,n)=>{let i,s,o;const r={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)o=i[s],n&&!n(o,e,t)||r[o]||(t[o]=e[o],r[o]=!0);e=!1!==a&&Y(e)}while(e&&(!a||a(e,t))&&e!==Object.prototype);return t},kindOf:X,kindOfTest:ee,endsWith:(e,t,a)=>{e=String(e),(void 0===a||a>e.length)&&(a=e.length),a-=t.length;const n=e.indexOf(t,a);return-1!==n&&n===a},toArray:e=>{if(!e)return null;if(ae(e))return e;let t=e.length;if(!re(t))return null;const a=new Array(t);for(;t-- >0;)a[t]=e[t];return a},forEachEntry:(e,t)=>{const a=(e&&e[Q]).call(e);let n;for(;(n=a.next())&&!n.done;){const a=n.value;t.call(e,a[0],a[1])}},matchAll:(e,t)=>{let a;const n=[];for(;null!==(a=e.exec(t));)n.push(a);return n},isHTMLForm:Ee,hasOwnProperty:Ie,hasOwnProp:Ie,reduceDescriptors:Te,freezeMethods:e=>{Te(e,(t,a)=>{if(oe(e)&&-1!==["arguments","caller","callee"].indexOf(a))return!1;const n=e[a];oe(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")}))})},toObjectSet:(e,t)=>{const a={},n=e=>{e.forEach(e=>{a[e]=!0})};return ae(e)?n(e):n(String(e).split(t)),a},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,a){return t.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:ye,global:_e,isContextDefined:ke,isSpecCompliantForm:function(e){return!!(e&&oe(e.append)&&"FormData"===e[Z]&&e[Q])},toJSONObject:e=>{const t=new Array(10),a=(e,n)=>{if(le(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const i=ae(e)?[]:{};return we(e,(e,t)=>{const s=a(e,n+1);!ne(s)&&(i[t]=s)}),t[n]=void 0,i}}return e};return a(e,0)},isAsyncFn:Ne,isThenable:e=>e&&(le(e)||oe(e))&&oe(e.then)&&oe(e.catch),setImmediate:Pe,asap:Oe,isIterable:e=>null!=e&&oe(e[Q])};function Me(e,t,a,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),a&&(this.config=a),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}Le.inherits(Me,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Le.toJSONObject(this.config),code:this.code,status:this.status}}});const Ue=Me.prototype,Fe={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Fe[e]={value:e}}),Object.defineProperties(Me,Fe),Object.defineProperty(Ue,"isAxiosError",{value:!0}),Me.from=(e,t,a,n,i,s)=>{const o=Object.create(Ue);return Le.toFlatObject(e,o,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),Me.call(o,e.message,t,a,n,i),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};function qe(e){return Le.isPlainObject(e)||Le.isArray(e)}function Be(e){return Le.endsWith(e,"[]")?e.slice(0,-2):e}function je(e,t,a){return e?e.concat(t).map(function(e,t){return e=Be(e),!a&&t?"["+e+"]":e}).join(a?".":""):t}const $e=Le.toFlatObject(Le,{},null,function(e){return/^is[A-Z]/.test(e)});function ze(e,t,a){if(!Le.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(a=Le.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!Le.isUndefined(t[e])})).metaTokens,i=a.visitor||c,s=a.dots,o=a.indexes,r=(a.Blob||"undefined"!=typeof Blob&&Blob)&&Le.isSpecCompliantForm(t);if(!Le.isFunction(i))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(Le.isDate(e))return e.toISOString();if(!r&&Le.isBlob(e))throw new Me("Blob is not supported. Use a Buffer instead.");return Le.isArrayBuffer(e)||Le.isTypedArray(e)?r&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,a,i){let r=e;if(e&&!i&&"object"==typeof e)if(Le.endsWith(a,"{}"))a=n?a:a.slice(0,-2),e=JSON.stringify(e);else if(Le.isArray(e)&&function(e){return Le.isArray(e)&&!e.some(qe)}(e)||(Le.isFileList(e)||Le.endsWith(a,"[]"))&&(r=Le.toArray(e)))return a=Be(a),r.forEach(function(e,n){!Le.isUndefined(e)&&null!==e&&t.append(!0===o?je([a],n,s):null===o?a:a+"[]",l(e))}),!1;return!!qe(e)||(t.append(je(i,a,s),l(e)),!1)}const d=[],u=Object.assign($e,{defaultVisitor:c,convertValue:l,isVisitable:qe});if(!Le.isObject(e))throw new TypeError("data must be an object");return function e(a,n){if(!Le.isUndefined(a)){if(-1!==d.indexOf(a))throw Error("Circular reference detected in "+n.join("."));d.push(a),Le.forEach(a,function(a,s){!0===(!(Le.isUndefined(a)||null===a)&&i.call(t,a,Le.isString(s)?s.trim():s,n,u))&&e(a,n?n.concat(s):[s])}),d.pop()}}(e),t}function Ve(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function We(e,t){this._pairs=[],e&&ze(e,this,t)}const He=We.prototype;function Ge(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ke(e,t,a){if(!t)return e;const n=a&&a.encode||Ge;Le.isFunction(a)&&(a={serialize:a});const i=a&&a.serialize;let s;if(s=i?i(t,a):Le.isURLSearchParams(t)?t.toString():new We(t,a).toString(n),s){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}He.append=function(e,t){this._pairs.push([e,t])},He.toString=function(e){const t=e?function(t){return e.call(this,t,Ve)}:Ve;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};class Je{constructor(){this.handlers=[]}use(e,t,a){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!a&&a.synchronous,runWhen:a?a.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Le.forEach(this.handlers,function(t){null!==t&&e(t)})}}const Ye={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Qe={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:We,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Ze="undefined"!=typeof window&&"undefined"!=typeof document,Xe="object"==typeof navigator&&navigator||void 0,et=Ze&&(!Xe||["ReactNative","NativeScript","NS"].indexOf(Xe.product)<0),tt="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,at=Ze&&window.location.href||"http://localhost",nt={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ze,hasStandardBrowserEnv:et,hasStandardBrowserWebWorkerEnv:tt,navigator:Xe,origin:at},Symbol.toStringTag,{value:"Module"})),...Qe};function it(e){function t(e,a,n,i){let s=e[i++];if("__proto__"===s)return!0;const o=Number.isFinite(+s),r=i>=e.length;if(s=!s&&Le.isArray(n)?n.length:s,r)return Le.hasOwnProp(n,s)?n[s]=[n[s],a]:n[s]=a,!o;n[s]&&Le.isObject(n[s])||(n[s]=[]);return t(e,a,n[s],i)&&Le.isArray(n[s])&&(n[s]=function(e){const t={},a=Object.keys(e);let n;const i=a.length;let s;for(n=0;n<i;n++)s=a[n],t[s]=e[s];return t}(n[s])),!o}if(Le.isFormData(e)&&Le.isFunction(e.entries)){const a={};return Le.forEachEntry(e,(e,n)=>{t(function(e){return Le.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),n,a,0)}),a}return null}const st={transitional:Ye,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const a=t.getContentType()||"",n=a.indexOf("application/json")>-1,i=Le.isObject(e);i&&Le.isHTMLForm(e)&&(e=new FormData(e));if(Le.isFormData(e))return n?JSON.stringify(it(e)):e;if(Le.isArrayBuffer(e)||Le.isBuffer(e)||Le.isStream(e)||Le.isFile(e)||Le.isBlob(e)||Le.isReadableStream(e))return e;if(Le.isArrayBufferView(e))return e.buffer;if(Le.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(a.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return ze(e,new nt.classes.URLSearchParams,Object.assign({visitor:function(e,t,a,n){return nt.isNode&&Le.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((s=Le.isFileList(e))||a.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return ze(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),function(e,t,a){if(Le.isString(e))try{return(t||JSON.parse)(e),Le.trim(e)}catch(n){if("SyntaxError"!==n.name)throw n}return(a||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||st.transitional,a=t&&t.forcedJSONParsing,n="json"===this.responseType;if(Le.isResponse(e)||Le.isReadableStream(e))return e;if(e&&Le.isString(e)&&(a&&!this.responseType||n)){const a=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(i){if(a){if("SyntaxError"===i.name)throw Me.from(i,Me.ERR_BAD_RESPONSE,this,null,this.response);throw i}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:nt.classes.FormData,Blob:nt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Le.forEach(["delete","get","head","post","put","patch"],e=>{st.headers[e]={}});const ot=Le.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),rt=Symbol("internals");function lt(e){return e&&String(e).trim().toLowerCase()}function ct(e){return!1===e||null==e?e:Le.isArray(e)?e.map(ct):String(e)}function dt(e,t,a,n,i){return Le.isFunction(n)?n.call(this,t,a):(i&&(t=a),Le.isString(t)?Le.isString(n)?-1!==t.indexOf(n):Le.isRegExp(n)?n.test(t):void 0:void 0)}let ut=class{constructor(e){e&&this.set(e)}set(e,t,a){const n=this;function i(e,t,a){const i=lt(t);if(!i)throw new Error("header name must be a non-empty string");const s=Le.findKey(n,i);(!s||void 0===n[s]||!0===a||void 0===a&&!1!==n[s])&&(n[s||t]=ct(e))}const s=(e,t)=>Le.forEach(e,(e,a)=>i(e,a,t));if(Le.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(Le.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))s((e=>{const t={};let a,n,i;return e&&e.split("\n").forEach(function(e){i=e.indexOf(":"),a=e.substring(0,i).trim().toLowerCase(),n=e.substring(i+1).trim(),!a||t[a]&&ot[a]||("set-cookie"===a?t[a]?t[a].push(n):t[a]=[n]:t[a]=t[a]?t[a]+", "+n:n)}),t})(e),t);else if(Le.isObject(e)&&Le.isIterable(e)){let a,n,i={};for(const t of e){if(!Le.isArray(t))throw TypeError("Object iterator must return a key-value pair");i[n=t[0]]=(a=i[n])?Le.isArray(a)?[...a,t[1]]:[a,t[1]]:t[1]}s(i,t)}else null!=e&&i(t,e,a);return this}get(e,t){if(e=lt(e)){const a=Le.findKey(this,e);if(a){const e=this[a];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=a.exec(e);)t[n[1]]=n[2];return t}(e);if(Le.isFunction(t))return t.call(this,e,a);if(Le.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=lt(e)){const a=Le.findKey(this,e);return!(!a||void 0===this[a]||t&&!dt(0,this[a],a,t))}return!1}delete(e,t){const a=this;let n=!1;function i(e){if(e=lt(e)){const i=Le.findKey(a,e);!i||t&&!dt(0,a[i],i,t)||(delete a[i],n=!0)}}return Le.isArray(e)?e.forEach(i):i(e),n}clear(e){const t=Object.keys(this);let a=t.length,n=!1;for(;a--;){const i=t[a];e&&!dt(0,this[i],i,e,!0)||(delete this[i],n=!0)}return n}normalize(e){const t=this,a={};return Le.forEach(this,(n,i)=>{const s=Le.findKey(a,i);if(s)return t[s]=ct(n),void delete t[i];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,a)=>t.toUpperCase()+a)}(i):String(i).trim();o!==i&&delete t[i],t[o]=ct(n),a[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Le.forEach(this,(a,n)=>{null!=a&&!1!==a&&(t[n]=e&&Le.isArray(a)?a.join(", "):a)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const a=new this(e);return t.forEach(e=>a.set(e)),a}static accessor(e){const t=(this[rt]=this[rt]={accessors:{}}).accessors,a=this.prototype;function n(e){const n=lt(e);t[n]||(!function(e,t){const a=Le.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+a,{value:function(e,a,i){return this[n].call(this,t,e,a,i)},configurable:!0})})}(a,e),t[n]=!0)}return Le.isArray(e)?e.forEach(n):n(e),this}};function ht(e,t){const a=this||st,n=t||a,i=ut.from(n.headers);let s=n.data;return Le.forEach(e,function(e){s=e.call(a,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function pt(e){return!(!e||!e.__CANCEL__)}function mt(e,t,a){Me.call(this,null==e?"canceled":e,Me.ERR_CANCELED,t,a),this.name="CanceledError"}function ft(e,t,a){const n=a.config.validateStatus;a.status&&n&&!n(a.status)?t(new Me("Request failed with status code "+a.status,[Me.ERR_BAD_REQUEST,Me.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a)):e(a)}ut.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Le.reduceDescriptors(ut.prototype,({value:e},t)=>{let a=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[a]=e}}}),Le.freezeMethods(ut),Le.inherits(mt,Me,{__CANCEL__:!0});const vt=(e,t,a=3)=>{let n=0;const i=function(e,t){e=e||10;const a=new Array(e),n=new Array(e);let i,s=0,o=0;return t=void 0!==t?t:1e3,function(r){const l=Date.now(),c=n[o];i||(i=l),a[s]=r,n[s]=l;let d=o,u=0;for(;d!==s;)u+=a[d++],d%=e;if(s=(s+1)%e,s===o&&(o=(o+1)%e),l-i<t)return;const h=c&&l-c;return h?Math.round(1e3*u/h):void 0}}(50,250);return function(e,t){let a,n,i=0,s=1e3/t;const o=(t,s=Date.now())=>{i=s,a=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[(...e)=>{const t=Date.now(),r=t-i;r>=s?o(e,t):(a=e,n||(n=setTimeout(()=>{n=null,o(a)},s-r)))},()=>a&&o(a)]}(a=>{const s=a.loaded,o=a.lengthComputable?a.total:void 0,r=s-n,l=i(r);n=s;e({loaded:s,total:o,progress:o?s/o:void 0,bytes:r,rate:l||void 0,estimated:l&&o&&s<=o?(o-s)/l:void 0,event:a,lengthComputable:null!=o,[t?"download":"upload"]:!0})},a)},gt=(e,t)=>{const a=null!=e;return[n=>t[0]({lengthComputable:a,total:e,loaded:n}),t[1]]},bt=e=>(...t)=>Le.asap(()=>e(...t)),wt=nt.hasStandardBrowserEnv?((e,t)=>a=>(a=new URL(a,nt.origin),e.protocol===a.protocol&&e.host===a.host&&(t||e.port===a.port)))(new URL(nt.origin),nt.navigator&&/(msie|trident)/i.test(nt.navigator.userAgent)):()=>!0,yt=nt.hasStandardBrowserEnv?{write(e,t,a,n,i,s){const o=[e+"="+encodeURIComponent(t)];Le.isNumber(a)&&o.push("expires="+new Date(a).toGMTString()),Le.isString(n)&&o.push("path="+n),Le.isString(i)&&o.push("domain="+i),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function _t(e,t,a){let n=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(n||0==a)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const kt=e=>e instanceof ut?{...e}:e;function Ct(e,t){t=t||{};const a={};function n(e,t,a,n){return Le.isPlainObject(e)&&Le.isPlainObject(t)?Le.merge.call({caseless:n},e,t):Le.isPlainObject(t)?Le.merge({},t):Le.isArray(t)?t.slice():t}function i(e,t,a,i){return Le.isUndefined(t)?Le.isUndefined(e)?void 0:n(void 0,e,0,i):n(e,t,0,i)}function s(e,t){if(!Le.isUndefined(t))return n(void 0,t)}function o(e,t){return Le.isUndefined(t)?Le.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function r(a,i,s){return s in t?n(a,i):s in e?n(void 0,a):void 0}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:r,headers:(e,t,a)=>i(kt(e),kt(t),0,!0)};return Le.forEach(Object.keys(Object.assign({},e,t)),function(n){const s=l[n]||i,o=s(e[n],t[n],n);Le.isUndefined(o)&&s!==r||(a[n]=o)}),a}const Et=e=>{const t=Ct({},e);let a,{data:n,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:o,headers:r,auth:l}=t;if(t.headers=r=ut.from(r),t.url=Ke(_t(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&r.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),Le.isFormData(n))if(nt.hasStandardBrowserEnv||nt.hasStandardBrowserWebWorkerEnv)r.setContentType(void 0);else if(!1!==(a=r.getContentType())){const[e,...t]=a?a.split(";").map(e=>e.trim()).filter(Boolean):[];r.setContentType([e||"multipart/form-data",...t].join("; "))}if(nt.hasStandardBrowserEnv&&(i&&Le.isFunction(i)&&(i=i(t)),i||!1!==i&&wt(t.url))){const e=s&&o&&yt.read(o);e&&r.set(s,e)}return t},It="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,a){const n=Et(e);let i=n.data;const s=ut.from(n.headers).normalize();let o,r,l,c,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=n;function m(){c&&c(),d&&d(),n.cancelToken&&n.cancelToken.unsubscribe(o),n.signal&&n.signal.removeEventListener("abort",o)}let f=new XMLHttpRequest;function v(){if(!f)return;const n=ut.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());ft(function(e){t(e),m()},function(e){a(e),m()},{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:n,config:e,request:f}),f=null}f.open(n.method.toUpperCase(),n.url,!0),f.timeout=n.timeout,"onloadend"in f?f.onloadend=v:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(v)},f.onabort=function(){f&&(a(new Me("Request aborted",Me.ECONNABORTED,e,f)),f=null)},f.onerror=function(){a(new Me("Network Error",Me.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const i=n.transitional||Ye;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),a(new Me(t,i.clarifyTimeoutError?Me.ETIMEDOUT:Me.ECONNABORTED,e,f)),f=null},void 0===i&&s.setContentType(null),"setRequestHeader"in f&&Le.forEach(s.toJSON(),function(e,t){f.setRequestHeader(t,e)}),Le.isUndefined(n.withCredentials)||(f.withCredentials=!!n.withCredentials),u&&"json"!==u&&(f.responseType=n.responseType),p&&([l,d]=vt(p,!0),f.addEventListener("progress",l)),h&&f.upload&&([r,c]=vt(h),f.upload.addEventListener("progress",r),f.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(o=t=>{f&&(a(!t||t.type?new mt(null,e,f):t),f.abort(),f=null)},n.cancelToken&&n.cancelToken.subscribe(o),n.signal&&(n.signal.aborted?o():n.signal.addEventListener("abort",o)));const g=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);g&&-1===nt.protocols.indexOf(g)?a(new Me("Unsupported protocol "+g+":",Me.ERR_BAD_REQUEST,e)):f.send(i||null)})},St=(e,t)=>{const{length:a}=e=e?e.filter(Boolean):[];if(t||a){let a,n=new AbortController;const i=function(e){if(!a){a=!0,o();const t=e instanceof Error?e:this.reason;n.abort(t instanceof Me?t:new mt(t instanceof Error?t.message:t))}};let s=t&&setTimeout(()=>{s=null,i(new Me(`timeout ${t} of ms exceeded`,Me.ETIMEDOUT))},t);const o=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)}),e=null)};e.forEach(e=>e.addEventListener("abort",i));const{signal:r}=n;return r.unsubscribe=()=>Le.asap(o),r}},Tt=function*(e,t){let a=e.byteLength;if(a<t)return void(yield e);let n,i=0;for(;i<a;)n=i+t,yield e.slice(i,n),i=n},Nt=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:a}=await t.read();if(e)break;yield a}}finally{await t.cancel()}},Pt=(e,t,a,n)=>{const i=async function*(e,t){for await(const a of Nt(e))yield*Tt(a,t)}(e,t);let s,o=0,r=e=>{s||(s=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await i.next();if(t)return r(),void e.close();let s=n.byteLength;if(a){let e=o+=s;a(e)}e.enqueue(new Uint8Array(n))}catch(t){throw r(t),t}},cancel:e=>(r(e),i.return())},{highWaterMark:2})},At="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,xt=At&&"function"==typeof ReadableStream,Rt=At&&("function"==typeof TextEncoder?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),Dt=(e,...t)=>{try{return!!e(...t)}catch(a){return!1}},Ot=xt&&Dt(()=>{let e=!1;const t=new Request(nt.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),Lt=xt&&Dt(()=>Le.isReadableStream(new Response("").body)),Mt={stream:Lt&&(e=>e.body)};var Ut;At&&(Ut=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Mt[e]&&(Mt[e]=Le.isFunction(Ut[e])?t=>t[e]():(t,a)=>{throw new Me(`Response type '${e}' is not supported`,Me.ERR_NOT_SUPPORT,a)})}));const Ft=async(e,t)=>{const a=Le.toFiniteNumber(e.getContentLength());return null==a?(async e=>{if(null==e)return 0;if(Le.isBlob(e))return e.size;if(Le.isSpecCompliantForm(e)){const t=new Request(nt.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return Le.isArrayBufferView(e)||Le.isArrayBuffer(e)?e.byteLength:(Le.isURLSearchParams(e)&&(e+=""),Le.isString(e)?(await Rt(e)).byteLength:void 0)})(t):a},qt={http:null,xhr:It,fetch:At&&(async e=>{let{url:t,method:a,data:n,signal:i,cancelToken:s,timeout:o,onDownloadProgress:r,onUploadProgress:l,responseType:c,headers:d,withCredentials:u="same-origin",fetchOptions:h}=Et(e);c=c?(c+"").toLowerCase():"text";let p,m=St([i,s&&s.toAbortSignal()],o);const f=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let v;try{if(l&&Ot&&"get"!==a&&"head"!==a&&0!==(v=await Ft(d,n))){let e,a=new Request(t,{method:"POST",body:n,duplex:"half"});if(Le.isFormData(n)&&(e=a.headers.get("content-type"))&&d.setContentType(e),a.body){const[e,t]=gt(v,vt(bt(l)));n=Pt(a.body,65536,e,t)}}Le.isString(u)||(u=u?"include":"omit");const i="credentials"in Request.prototype;p=new Request(t,{...h,signal:m,method:a.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:i?u:void 0});let s=await fetch(p);const o=Lt&&("stream"===c||"response"===c);if(Lt&&(r||o&&f)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=s[t]});const t=Le.toFiniteNumber(s.headers.get("content-length")),[a,n]=r&&gt(t,vt(bt(r),!0))||[];s=new Response(Pt(s.body,65536,a,()=>{n&&n(),f&&f()}),e)}c=c||"text";let g=await Mt[Le.findKey(Mt,c)||"text"](s,e);return!o&&f&&f(),await new Promise((t,a)=>{ft(t,a,{data:g,headers:ut.from(s.headers),status:s.status,statusText:s.statusText,config:e,request:p})})}catch(g){if(f&&f(),g&&"TypeError"===g.name&&/Load failed|fetch/i.test(g.message))throw Object.assign(new Me("Network Error",Me.ERR_NETWORK,e,p),{cause:g.cause||g});throw Me.from(g,g&&g.code,e,p)}})};Le.forEach(qt,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(a){}Object.defineProperty(e,"adapterName",{value:t})}});const Bt=e=>`- ${e}`,jt=e=>Le.isFunction(e)||null===e||!1===e,$t=e=>{e=Le.isArray(e)?e:[e];const{length:t}=e;let a,n;const i={};for(let s=0;s<t;s++){let t;if(a=e[s],n=a,!jt(a)&&(n=qt[(t=String(a)).toLowerCase()],void 0===n))throw new Me(`Unknown adapter '${t}'`);if(n)break;i[t||"#"+s]=n}if(!n){const e=Object.entries(i).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new Me("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(Bt).join("\n"):" "+Bt(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n};function zt(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new mt(null,e)}function Vt(e){zt(e),e.headers=ut.from(e.headers),e.data=ht.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return $t(e.adapter||st.adapter)(e).then(function(t){return zt(e),t.data=ht.call(e,e.transformResponse,t),t.headers=ut.from(t.headers),t},function(t){return pt(t)||(zt(e),t&&t.response&&(t.response.data=ht.call(e,e.transformResponse,t.response),t.response.headers=ut.from(t.response.headers))),Promise.reject(t)})}const Wt="1.9.0",Ht={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Ht[e]=function(a){return typeof a===e||"a"+(t<1?"n ":" ")+e}});const Gt={};Ht.transitional=function(e,t,a){function n(e,t){return"[Axios v1.9.0] Transitional option '"+e+"'"+t+(a?". "+a:"")}return(a,i,s)=>{if(!1===e)throw new Me(n(i," has been removed"+(t?" in "+t:"")),Me.ERR_DEPRECATED);return t&&!Gt[i]&&(Gt[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(a,i,s)}},Ht.spelling=function(e){return(t,a)=>(console.warn(`${a} is likely a misspelling of ${e}`),!0)};const Kt={assertOptions:function(e,t,a){if("object"!=typeof e)throw new Me("options must be an object",Me.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let i=n.length;for(;i-- >0;){const s=n[i],o=t[s];if(o){const t=e[s],a=void 0===t||o(t,s,e);if(!0!==a)throw new Me("option "+s+" must be "+a,Me.ERR_BAD_OPTION_VALUE);continue}if(!0!==a)throw new Me("Unknown option "+s,Me.ERR_BAD_OPTION)}},validators:Ht},Jt=Kt.validators;let Yt=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Je,response:new Je}}async request(e,t){try{return await this._request(e,t)}catch(a){if(a instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{a.stack?t&&!String(a.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(a.stack+="\n"+t):a.stack=t}catch(n){}}throw a}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Ct(this.defaults,t);const{transitional:a,paramsSerializer:n,headers:i}=t;void 0!==a&&Kt.assertOptions(a,{silentJSONParsing:Jt.transitional(Jt.boolean),forcedJSONParsing:Jt.transitional(Jt.boolean),clarifyTimeoutError:Jt.transitional(Jt.boolean)},!1),null!=n&&(Le.isFunction(n)?t.paramsSerializer={serialize:n}:Kt.assertOptions(n,{encode:Jt.function,serialize:Jt.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Kt.assertOptions(t,{baseUrl:Jt.spelling("baseURL"),withXsrfToken:Jt.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&Le.merge(i.common,i[t.method]);i&&Le.forEach(["delete","get","head","post","put","patch","common"],e=>{delete i[e]}),t.headers=ut.concat(s,i);const o=[];let r=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(r=r&&e.synchronous,o.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let d,u=0;if(!r){const e=[Vt.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,l),d=e.length,c=Promise.resolve(t);u<d;)c=c.then(e[u++],e[u++]);return c}d=o.length;let h=t;for(u=0;u<d;){const e=o[u++],t=o[u++];try{h=e(h)}catch(p){t.call(this,p);break}}try{c=Vt.call(this,h)}catch(p){return Promise.reject(p)}for(u=0,d=l.length;u<d;)c=c.then(l[u++],l[u++]);return c}getUri(e){return Ke(_t((e=Ct(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Le.forEach(["delete","get","head","options"],function(e){Yt.prototype[e]=function(t,a){return this.request(Ct(a||{},{method:e,url:t,data:(a||{}).data}))}}),Le.forEach(["post","put","patch"],function(e){function t(t){return function(a,n,i){return this.request(Ct(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:a,data:n}))}}Yt.prototype[e]=t(),Yt.prototype[e+"Form"]=t(!0)});const Qt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Qt).forEach(([e,t])=>{Qt[t]=e});const Zt=function e(t){const a=new Yt(t),n=K(Yt.prototype.request,a);return Le.extend(n,Yt.prototype,a,{allOwnKeys:!0}),Le.extend(n,a,null,{allOwnKeys:!0}),n.create=function(a){return e(Ct(t,a))},n}(st);Zt.Axios=Yt,Zt.CanceledError=mt,Zt.CancelToken=class e{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const a=this;this.promise.then(e=>{if(!a._listeners)return;let t=a._listeners.length;for(;t-- >0;)a._listeners[t](e);a._listeners=null}),this.promise.then=e=>{let t;const n=new Promise(e=>{a.subscribe(e),t=e}).then(e);return n.cancel=function(){a.unsubscribe(t)},n},e(function(e,n,i){a.reason||(a.reason=new mt(e,n,i),t(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;return{token:new e(function(e){t=e}),cancel:t}}},Zt.isCancel=pt,Zt.VERSION=Wt,Zt.toFormData=ze,Zt.AxiosError=Me,Zt.Cancel=Zt.CanceledError,Zt.all=function(e){return Promise.all(e)},Zt.spread=function(e){return function(t){return e.apply(null,t)}},Zt.isAxiosError=function(e){return Le.isObject(e)&&!0===e.isAxiosError},Zt.mergeConfig=Ct,Zt.AxiosHeaders=ut,Zt.formToJSON=e=>it(Le.isHTMLForm(e)?new FormData(e):e),Zt.getAdapter=$t,Zt.HttpStatusCode=Qt,Zt.default=Zt;const{Axios:Xt,AxiosError:ea,CanceledError:ta,isCancel:aa,CancelToken:na,VERSION:ia,all:sa,Cancel:oa,isAxiosError:ra,spread:la,toFormData:ca,AxiosHeaders:da,HttpStatusCode:ua,formToJSON:ha,getAdapter:pa,mergeConfig:ma}=Zt,fa=Zt.create({baseURL:"https://mozoqr.com/api",headers:{"Content-Type":"application/json",Accept:"application/json"}});fa.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),fa.interceptors.response.use(e=>{try{const t=e.data;if(t){const e=t.token||t.access_token||t.plainTextToken||t.user&&t.user.token||t.user&&t.user.access_token;e&&localStorage.setItem("token",e)}if(!localStorage.getItem("token")&&e.headers){const t=e.headers.authorization||e.headers.Authorization;t&&t.startsWith("Bearer ")&&localStorage.setItem("token",t.replace("Bearer ",""))}}catch(t){}return e},e=>(e.response&&401===e.response.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),e.message=(e=>{if(e.response){const t=e.response.data;if(t){if("string"==typeof t)return t;if(t.message)return t.message;if(t.error)return t.error}return`Error ${e.response.status}: ${e.response.statusText||"Error en la respuesta del servidor"}`}return e.request?"No se recibió respuesta del servidor. Verifique su conexión.":e.message||"Ocurrió un error desconocido."})(e),Promise.reject(e)));const va={login:e=>fa.post("login",e),loginWithGoogle:e=>fa.post("login/google",e),checkUserExists:e=>fa.post("check-user-exists",{email:e}),forgotPassword:e=>fa.post("forgot-password",e),resetPassword:e=>fa.post("reset-password",e),callWaiter:e=>fa.post(`tables/${e}/call-waiter`),register:e=>fa.post("register",e),getCurrentUser:()=>fa.get("user"),logout:()=>fa.post("logout"),selectRole:(e,t=null)=>{const a={role:e};return t&&(a.business_id=t),fa.post("role/select",a)},updateProfile:e=>fa.post("profile/update",e,{headers:{"Content-Type":"multipart/form-data"}}),updateWaiterProfile:e=>fa.post("profile/waiter/update",e,{headers:{"Content-Type":"multipart/form-data"}}),getProfileCompleteness:()=>fa.get("profile/completeness"),getActiveUserProfile:(e=null)=>{const t=e?{business_id:e}:{};return fa.get("user-profile/active",{params:t})},getAllUserProfiles:()=>fa.get("user-profile/all"),updateWaiterUserProfile:e=>fa.post("user-profile/waiter/update",e,{headers:{"Content-Type":"multipart/form-data"}}),updateAdminUserProfile:e=>fa.post("user-profile/admin/update",e,{headers:{"Content-Type":"multipart/form-data"}}),deleteUserProfileAvatar:e=>fa.delete("user-profile/avatar",{data:e}),changePassword:e=>fa.post("change-password",e),deleteAccount:e=>fa.delete("delete-account",{data:e}),sendWhatsAppMessage:e=>fa.post("profile/whatsapp/send",e),getNotifications:()=>fa.get("user/notifications"),handleNotification:e=>fa.post(`user/notifications/${e}/read`),globalNotifications:e=>fa.post("notifications/global",e),storeDeviceToken:e=>fa.post("device-token",e),deleteDeviceToken:e=>e&&"object"==typeof e?fa.delete("device-token",{data:e}):"string"==typeof e||"number"==typeof e?fa.delete(`device-token/${e}`):fa.delete("device-token"),toggleTableNotifications:e=>fa.post(`tables/toggle-notifications/${e}`),waiterOnboard:e=>fa.post("waiter/onboard",{code:e}),getWaiterTables:()=>fa.get("waiter/tables"),listWaiterProfiles:()=>fa.get("waiter/profiles"),createWaiterProfile:e=>fa.post("waiter/profiles",e),deleteWaiterProfile:e=>fa.delete(`waiter/profiles/${e}`),getWaiterNotifications:()=>fa.get("waiter/notifications"),handleWaiterNotification:(e,t)=>fa.post(`waiter/notifications/handle/${e}`,t),waiterGlobalNotifications:e=>fa.post("waiter/notifications/global",e),waiterToggleTableNotifications:e=>fa.post(`waiter/tables/toggle-notifications/${e}`),getBusinessInfo:()=>fa.get("admin/business"),getAdminBusinesses:()=>fa.get("admin/businesses"),removeStaff:e=>fa.delete(`admin/staff/${e}`),handleStaffRequest:(e,t)=>fa.post(`admin/staff/request/${e}`,t),getStaffRequests:()=>fa.get("admin/staff/requests"),getArchivedStaffRequests:()=>fa.get("admin/staff/requests/archived"),getTables:()=>fa.get("tables"),createTable:e=>fa.post("tables",e),updateTable:(e,t)=>fa.put(`tables/${e}`,t),deleteTable:e=>fa.delete(`tables/${e}`),getMenus:()=>fa.get("menus"),uploadMenu:e=>fa.post("menus",e,{headers:{"Content-Type":"multipart/form-data"}}),setDefaultMenu:e=>fa.post("menus/default",e),generateQRCode:e=>fa.post(`admin/qr/generate/${e}`),regenerateQRCode:e=>fa.post(`admin/qr/generate/${e}`,{regenerate:!0}),getQrPreview:e=>fa.get(`admin/qr/preview/${e}`,{responseType:"text"}),exportQR:e=>fa.post("admin/qr/export",e),sendQrEmail:e=>fa.post("admin/qr/email",e),getSettings:()=>fa.get("admin/settings"),updateSettings:e=>fa.post("admin/settings",e),deleteMenu:e=>fa.delete(`menus/${e}`),renameMenu:(e,t)=>fa.put(`menus/${e}`,t),reorderMenus:e=>fa.post("menus/reorder",{order:e}),previewMenu:e=>fa.get(`menus/${e}/preview`,{responseType:"blob"}),downloadMenu:e=>fa.get(`menus/${e}/download`,{responseType:"blob"}),cloneTable:(e,t)=>fa.post(`tables/clone/${e}`,t),getStaff:(e=1)=>fa.get(`admin/staff?page=${e}`),getStaffMember:e=>fa.get(`admin/staff/${e}`),updateStaffMember:(e,t)=>t instanceof FormData?fa.post(`admin/staff/${e}?_method=PUT`,t,{headers:{"Content-Type":"multipart/form-data"}}):fa.put(`admin/staff/${e}`,t),inviteStaff:e=>fa.post("admin/staff/invite",e),addReview:(e,t)=>fa.post(`admin/staff/${e}/reviews`,t),deleteReview:(e,t)=>fa.delete(`admin/staff/${e}/reviews/${t}`),changePassword:e=>fa.post("change-password",e),deleteAccount:e=>fa.delete("delete-account",{data:e}),getAdminStatistics:()=>fa.get("admin/statistics"),getAdminNotifications:()=>fa.get("admin/notifications"),listWorkHistory:()=>fa.get("profile/work-history"),addWorkHistory:e=>fa.post("profile/work-history",e),updateWorkHistory:(e,t)=>fa.put(`profile/work-history/${e}`,t),deleteWorkHistory:e=>fa.delete(`profile/work-history/${e}`),getAdminTables:()=>fa.get("admin/tables"),getAdminTableDetails:e=>fa.get(`admin/tables/${e}`),updateAdminTable:(e,t)=>fa.put(`admin/tables/${e}`,t),deleteAdminTable:e=>fa.delete(`admin/tables/${e}`),getAdminStaff:()=>fa.get("admin/staff"),getAdminStaffDetails:e=>fa.get(`admin/staff/${e}`),createAdminStaff:e=>fa.post("admin/staff",e),updateAdminStaff:(e,t)=>fa.post(`admin/staff/${e}`,t),deleteAdminStaff:e=>fa.delete(`admin/staff/${e}`),getStaffByBusiness:e=>fa.get(`staff?business_id=${e}`),createStaff:e=>fa.post("staff",e),getStaffById:e=>fa.get(`staff/${e}`),approveStaff:(e,t)=>fa.post(`staff/${e}/approve`,t),rejectStaff:(e,t)=>fa.post(`staff/${e}/reject`,t),inviteStaffMember:e=>fa.post(`staff/${e}/invite`),getStaffWhatsApp:e=>fa.get(`staff/${e}/whatsapp`),deleteStaffById:e=>fa.delete(`staff/${e}`),joinStaffWithToken:(e,t)=>fa.post(`staff/join/${e}`,t),testStaffNotifications:e=>fa.post("staff/test-notifications",e),getAdminMenus:()=>fa.get("admin/menus"),getAdminMenuDetails:e=>fa.get(`admin/menus/${e}`),createAdminMenu:e=>fa.post("admin/menus",e),updateAdminMenu:(e,t)=>fa.post(`admin/menus/update/${e}`,t),deleteAdminMenu:e=>fa.delete(`admin/menus/${e}`),getAdminRequests:()=>fa.get("admin/requests"),sendNotificationToAll:e=>fa.post("admin/notifications/send-to-all",e),sendNotificationToUser:e=>fa.post("admin/notifications/send-to-user",e),sendNotificationToDevice:e=>fa.post("admin/notifications/send-to-device",e),sendNotificationToTopic:e=>fa.post("admin/notifications/send-to-topic",e),subscribeToTopic:e=>fa.post("admin/notifications/subscribe-to-topic",e),unsubscribeFromTopic:e=>fa.post("admin/notifications/unsubscribe-from-topic",e),getDeviceTokens:e=>fa.get(`device-tokens/${e}`),sendPushToUser:e=>fa.post("admin/notifications/send-to-user",e),healthCheck:()=>fa.get("health-check"),getBusinessInfo:()=>fa.get("admin/business"),createBusiness:e=>fa.post("admin/business/create",e),joinBusiness:e=>fa.post("join-business",{invitation_code:e}),regenerateInvitationCode:()=>fa.post("admin/business/regenerate-invitation-code"),getFirebaseConfig:()=>fa.get("firebase/config"),registerWaiterFcm:e=>fa.post("waiter/fcm/register",e),refreshWaiterFcm:e=>fa.post("waiter/fcm/refresh",e),deleteWaiterFcmToken:e=>fa.delete("waiter/fcm/token",{data:e}),testWaiterFcm:e=>fa.post("waiter/fcm/test",e),getPendingCalls:()=>fa.get("waiter/calls/pending"),acknowledgeCall:e=>fa.post(`waiter/calls/${e}/acknowledge`),completeCall:e=>fa.post(`waiter/calls/${e}/complete`),getWaiterCallHistory:(e={})=>fa.get("waiter/calls/history",{params:e}),getAdminCallHistory:(e={})=>fa.get("admin/calls/history",{params:e}),activateTable:e=>fa.post(`waiter/tables/${e}/activate`),deactivateTable:e=>fa.delete(`waiter/tables/${e}/activate`),activateMultipleTables:e=>fa.post("waiter/tables/activate/multiple",e),deactivateMultipleTables:e=>fa.post("waiter/tables/deactivate/multiple",e),silenceTable:(e,t)=>fa.post(`waiter/tables/${e}/silence`,t),unsilenceTable:e=>fa.delete(`waiter/tables/${e}/silence`),silenceMultipleTables:e=>fa.post("waiter/tables/silence/multiple",e),unsilenceMultipleTables:e=>fa.post("waiter/tables/unsilence/multiple",e),getSilencedTables:()=>fa.get("waiter/tables/silenced"),getAssignedTables:()=>fa.get("waiter/tables/assigned"),getAvailableTables:()=>fa.get("waiter/tables/available"),getAdminSilencedTables:()=>fa.get("admin/tables/silenced"),adminUnsilenceTable:e=>fa.delete(`admin/tables/${e}/silence`),getWaiterTableProfiles:()=>fa.get("waiter/table-profiles"),getWaiterTableProfile:e=>fa.get(`waiter/table-profiles/${e}`),createWaiterTableProfile:e=>fa.post("waiter/table-profiles",e),updateWaiterTableProfile:(e,t)=>fa.put(`waiter/table-profiles/${e}`,t),deleteWaiterTableProfile:e=>fa.delete(`waiter/table-profiles/${e}`),activateWaiterTableProfile:e=>fa.post(`waiter/table-profiles/${e}/activate`),deactivateWaiterTableProfile:e=>fa.post(`waiter/table-profiles/${e}/deactivate`),getWaiterTableProfileNotifications:()=>fa.get("waiter/table-profiles/notifications"),getWaiterDashboard:()=>fa.get("waiter/dashboard"),getWaiterTableStatus:()=>fa.get("waiter/tables/status"),getWaiterBusinesses:()=>fa.get("waiter/businesses"),setActiveWaiterBusiness:e=>fa.post("waiter/set-active-business",{business_id:e}),getActiveWaiterBusiness:()=>fa.get("waiter/businesses/active"),getWaiterBusinessTables:e=>fa.get(`waiter/businesses/${e}/tables`),joinBusinessWithCode:e=>fa.post("waiter/join-business",{business_code:e}),leaveWaiterBusiness:e=>fa.delete(`waiter/businesses/${e}/leave`),blockIpForSpam:e=>fa.post("waiter/ip/block",e),unblockIp:e=>fa.post("waiter/ip/unblock",e),getBlockedIps:e=>fa.get("waiter/ip/blocked",{params:e}),debugBlockedIp:e=>fa.get("waiter/ip/debug",{params:e}),forceUnblockIp:e=>fa.post("waiter/ip/force-unblock",e),getWaiterBusinessesActiveToday:()=>fa.get("waiter/businesses/active-today"),leaveBusinessAsWaiter:e=>fa.post("waiter/leave-business",e)},ga={async getNotifications(){try{return(await va.getNotifications()).data}catch(e){throw console.error("Error obteniendo notificaciones:",e),e}},async handleNotification(e,t){try{if(!t||"mark_as_read"===t||"read"===t){const t=await va.handleNotification(e);return t.data||t}return(await fa.post(`notifications/handle/${e}`,{action:t})).data}catch(a){throw console.error("Error manejando notificación:",a),a}},async globalNotifications(e){try{return(await va.globalNotifications({enabled:e})).data}catch(t){throw console.error("Error configurando notificaciones globales:",t),t}},async getWaiterNotifications(){try{return(await va.getWaiterNotifications()).data}catch(e){throw console.error("Error obteniendo notificaciones de mozo:",e),e}},async handleWaiterNotification(e,t){try{return(await va.handleWaiterNotification(e,{action:t})).data}catch(a){throw console.error("Error manejando notificación de mozo:",a),a}},async waiterGlobalNotifications(e){try{return(await va.waiterGlobalNotifications({enabled:e})).data}catch(t){throw console.error("Error configurando notificaciones globales de mozo:",t),t}},async waiterToggleTableNotifications(e){try{return(await va.waiterToggleTableNotifications(e)).data}catch(t){throw console.error("Error alternando notificaciones de mesa para mozo:",t),t}},async getAdminNotifications(){try{return(await va.getAdminNotifications()).data}catch(e){throw console.error("Error obteniendo notificaciones de administrador:",e),e}},async storeDeviceToken(e,t="web",a=null){try{const n={token:e,platform:t};a&&(n.user_id=a);return(await va.storeDeviceToken(n)).data}catch(n){throw console.error("Error guardando token de dispositivo:",n),n}},async deleteDeviceToken(e){try{return(await va.deleteDeviceToken(e)).data}catch(t){throw console.error("Error eliminando token de dispositivo:",t),t}},async getDeviceTokens(e){try{return(await va.getDeviceTokens(e)).data}catch(t){throw console.error("Error obteniendo tokens de dispositivo:",t),t}},async sendNotificationToAll(e,t,a=null){try{const n={title:e,body:t};a&&(n.data=a);return(await va.sendNotificationToAll(n)).data}catch(n){throw console.error("Error enviando notificación a todos:",n),n}},async sendNotificationToUser(e,t,a,n=null){try{const i={user_id:e,title:t,body:a};n&&(i.data=n);return(await va.sendNotificationToUser(i)).data}catch(i){throw console.error("Error enviando notificación a usuario:",i),i}},async sendNotificationToDevice(e,t,a,n=null){try{const i={token:e,title:t,body:a};n&&(i.data=n);return(await va.sendNotificationToDevice(i)).data}catch(i){throw console.error("Error enviando notificación a dispositivo:",i),i}},async sendNotificationToTopic(e,t,a,n=null){try{const i={topic:e,title:t,body:a};n&&(i.data=n);return(await va.sendNotificationToTopic(i)).data}catch(i){throw console.error("Error enviando notificación a topic:",i),i}},async subscribeToTopic(e,t){try{const a={tokens:Array.isArray(e)?e:[e],topic:t};return(await va.subscribeToTopic(a)).data}catch(a){throw console.error("Error suscribiendo a topic:",a),a}},async unsubscribeFromTopic(e,t){try{const a={tokens:Array.isArray(e)?e:[e],topic:t};return(await va.unsubscribeFromTopic(a)).data}catch(a){throw console.error("Error desuscribiendo de topic:",a),a}},async toggleTableNotifications(e){try{return(await va.toggleTableNotifications(e)).data}catch(t){throw console.error("Error alternando notificaciones de mesa:",t),t}},async callWaiter(e){try{return(await va.callWaiter(e)).data}catch(t){throw console.error("Error llamando al camarero:",t),t}},async markAllAsRead(e){try{const t=e.map(e=>this.handleNotification(e.id,"mark_as_read"));return await Promise.all(t)}catch(t){throw console.error("Error marcando todas como leídas:",t),t}},async deleteAllRead(e){try{const t=e.map(e=>fa.post(`notifications/handle/${e.id}`,{action:"delete"}));return(await Promise.all(t)).map(e=>e.data)}catch(t){throw console.error("Error eliminando todas las leídas:",t),t}},async getNotificationsByRole(e){try{switch(e){case"waiter":return await this.getWaiterNotifications();case"admin":return await this.getAdminNotifications();default:return await this.getNotifications()}}catch(t){throw console.error("Error obteniendo notificaciones por rol:",t),t}},async healthCheck(){try{return await va.healthCheck()}catch(e){throw console.error("Error en el health check de la API:",e),e}},async testWebSocketConnection(){try{if(!localStorage.getItem("token"))throw new Error("No hay token de autenticación");const e=localStorage.getItem("user"),{initializeEcho:t}=(e&&JSON.parse(e),await H(async()=>{const{initializeEcho:e}=await import("./echo-DazC-UKW.js");return{initializeEcho:e}},__vite__mapDeps([0,1,2]))),a=t();if(!a)throw new Error("No se pudo inicializar Echo");if(!a.connector||!a.connector.pusher)throw new Error("Pusher no está disponible en Echo");return await new Promise((e,t)=>{const n=setTimeout(()=>{t(new Error("Timeout en la conexión WebSocket (5 segundos)"))},5e3);a.connector.pusher.connection.bind("connected",()=>{clearTimeout(n),e()}),a.connector.pusher.connection.bind("error",e=>{clearTimeout(n),console.error("🔍 Error en WebSocket:",e),t(new Error(`Error de conexión: ${e.message||"Error desconocido"}`))}),a.connector.pusher.connection.bind("disconnected",()=>{}),a.connector.pusher.connection.bind("connecting",()=>{})}),{success:!0,message:"Conexión WebSocket exitosa"}}catch(e){throw console.error("🔍 Error en testWebSocketConnection:",e),console.error("🔍 Stack trace:",e.stack),e}}},ba=Object.freeze(Object.defineProperty({__proto__:null,default:ga},Symbol.toStringTag,{value:"Module"})),wa={apiKey:"AIzaSyBlupKSIy7qtTsXukqROyVjMNx03X8CCzU",authDomain:"mozoqr-7d32c.firebaseapp.com",projectId:"mozoqr-7d32c",storageBucket:"mozoqr-7d32c.firebasestorage.app",databaseURL:"https://mozoqr-7d32c-default-rtdb.firebaseio.com",messagingSenderId:"175482362472",appId:"1:175482362472:web:308070c885bacc71b6b9dd",measurementId:"G-6N7J4X94DH"};let ya=null,_a=null,ka=null,Ca=null;const Ea=async()=>{try{if("undefined"==typeof window)return console.log("🔥 Firebase: Not supported in non-browser environment"),null;const t=Object.entries(wa).filter(([e,t])=>!t).map(([e,t])=>e);if(t.length>0)return console.error("🔥 Firebase: Incomplete configuration. Missing keys:",t),null;console.log("🔥 Initializing Firebase...");const{initializeApp:a}=await H(async()=>{const{initializeApp:e}=await import("./index.esm-BIzZB3Zu.js");return{initializeApp:e}},__vite__mapDeps([3,1,2]));ya=a(wa);const{getFirestore:n}=await H(async()=>{const{getFirestore:e}=await import("./index.esm-BzFJCx3r.js");return{getFirestore:e}},__vite__mapDeps([4,1,2]));ka=n(ya);const{getAuth:i,signInAnonymously:s,onAuthStateChanged:o}=await H(async()=>{const{getAuth:e,signInAnonymously:t,onAuthStateChanged:a}=await Promise.resolve().then(()=>Ph);return{getAuth:e,signInAnonymously:t,onAuthStateChanged:a}},void 0);Ca=i(ya);try{const e=await s(Ca);console.log("🔥 Firebase Auth: Anonymous sign-in successful, UID:",e.user.uid),await new Promise(e=>{const t=o(Ca,a=>{a?console.log("🔥 Firebase Auth: User authenticated with UID:",a.uid):console.warn("🔥 Firebase Auth: No user authenticated"),t(),e()})})}catch(e){console.error("🔥 Firebase Auth: Anonymous sign-in failed:",e)}return{app:ya,db:ka,auth:Ca}}catch(t){return console.error("🔥 Firebase App initialization error:",t),null}},Ia=async()=>(Ca||await Ea(),Ca),Sa=async()=>{try{if(!ya){if(!(await Ea()))return null}if("serviceWorker"in navigator)try{await navigator.serviceWorker.register("/firebase-messaging-sw.js")}catch(e){console.error("🔥 Service Worker registration failed:",e)}const{getMessaging:t,isSupported:a}=await H(async()=>{const{getMessaging:e,isSupported:t}=await import("./index.esm-Bt68CSGu.js");return{getMessaging:e,isSupported:t}},__vite__mapDeps([5,1,2]));if(!(await a())){console.log("🔥 Firebase Messaging not supported in this browser");const{getAuth:e}=await H(async()=>{const{getAuth:e}=await Promise.resolve().then(()=>Ph);return{getAuth:e}},void 0),t=e(ya);return{app:ya,messaging:null,db:ka,auth:t}}_a=t(ya);const{getAuth:n}=await H(async()=>{const{getAuth:e}=await Promise.resolve().then(()=>Ph);return{getAuth:e}},void 0),i=n(ya);return{app:ya,messaging:_a,db:ka,auth:i}}catch(e){console.error("🔥 Firebase initialization error:",e);try{const{getAuth:e}=await H(async()=>{const{getAuth:e}=await Promise.resolve().then(()=>Ph);return{getAuth:e}},void 0),t=e(ya);return{app:ya,messaging:null,db:ka,auth:t}}catch(t){return{app:ya,messaging:null,db:ka,auth:null}}}},Ta=async()=>{try{if(!_a){if(!(await Sa()))throw new Error("Firebase initialization failed")}const{getToken:e}=await H(async()=>{const{getToken:e}=await import("./index.esm-Bt68CSGu.js");return{getToken:e}},__vite__mapDeps([5,1,2]));if("undefined"==typeof Notification)console.warn("🔥 Notification API no disponible en este entorno (probablemente WebView). Saltando solicitud de permisos.");else{let e=Notification.permission;if("default"===e&&(console.log("🔥 Requesting notification permissions..."),e=await Notification.requestPermission(),console.log("🔥 Permission after request:",e)),"denied"===e)throw console.error("🔥 Notification permissions DENIED by user"),console.error('🔥 SOLUTION: Click the 🔒 in the address bar and change Notifications to "Allow"'),new Error('Notification permissions denied. Click the 🔒 in the address bar and change Notifications to "Allow", then reload the page.');if("granted"!==e)throw new Error("Notification permissions not granted")}const t="BNJgpNkgB0a0y7gHT-SNBFLMGIZw-Xx8NTBDCn_4dVqekzgmnGmKMIn10t-6gWl3Qj_msyCcfbsVycnAp8USs6M",a={};t&&(a.vapidKey=t);const n=await e(_a,a);if(!n)throw new Error("Failed to obtain FCM token");return localStorage.setItem("fcm_token",n),n}catch(e){throw console.error("🔥 FCM token error:",e),e}},Na=async e=>{try{if(!_a){if(!(await Sa()))return}const{onMessage:t}=await H(async()=>{const{onMessage:e}=await import("./index.esm-Bt68CSGu.js");return{onMessage:e}},__vite__mapDeps([5,1,2]));t(_a,t=>{const a=Pa(t);if(e&&"function"==typeof e)try{e(a)}catch(n){console.error("🔥❌ Error in onMessage callback:",n)}try{H(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>lr);return{useNotificationsStore:e}},void 0).then(({useNotificationsStore:e})=>{var t;const n=e(),i={id:`fcm-${Date.now()}`,type:(null==(t=a.data)?void 0:t.type)||"FCMNotification",data:{title:a.title,message:a.body,...a.data},created_at:(new Date).toISOString(),read_at:null,source:"firebase-foreground"};console.log("🔥📨 Adding FCM notification to store:",i),n.addNewNotification(i)})}catch(n){console.error("🔥❌ Error adding FCM notification to store:",n)}"granted"===Notification.permission&&Aa(a)})}catch(t){console.error("🔥 Error setting up message listener:",t)}},Pa=e=>{var t,a,n;let i={title:(null==(t=e.notification)?void 0:t.title)||"Nueva notificación",body:(null==(a=e.notification)?void 0:a.body)||"Tienes una nueva notificación",data:e.data||{}};if(null==(n=e.data)?void 0:n.type){switch(e.data.type){case"TestNotification":i={title:"🧪 Test Notification",body:"This is a test notification sent to all business users",data:{...e.data,icon:"🧪",priority:"normal",channels:["Database","Broadcast","FCM"]}};break;case"UserSpecificNotification":i={title:e.data.title||"👤 Personalized Notification",body:e.data.message||"You have a new personalized notification",data:{...e.data,icon:"👤",priority:"high",channels:["Database","Broadcast","FCM"]}};break;case"WebSocketTestNotification":i={title:"⚡ WebSocket + FCM Test",body:"This notification arrives via WebSocket (real-time) and FCM (push)",data:{...e.data,icon:"⚡",priority:"high",test_mode:"websocket_fcm"}};break;case"WebSocketOnlyNotification":i={title:"🔌 WebSocket Only Test",body:"This notification ONLY arrives via WebSocket in real-time",data:{...e.data,icon:"🔌",priority:"normal",test_mode:"websocket_only"}};break;default:e.notification&&(i={title:e.notification.title,body:e.notification.body,data:{...e.data,icon:"📱",priority:"normal"}})}}return i},Aa=e=>{try{const{title:t,body:a,data:n}=e;if(t||a){new Notification(t||"Nueva notificación",{body:a||"Tienes una nueva notificación",icon:"/favicon.ico",tag:`fcm-notification-${Date.now()}`,data:n,requireInteraction:!0})}}catch(t){console.error("🔥❌ Error showing browser notification:",t)}},xa=async()=>{try{if(!_a)return void console.log("🔥 Firebase Messaging not initialized");const{deleteToken:e}=await H(async()=>{const{deleteToken:e}=await import("./index.esm-Bt68CSGu.js");return{deleteToken:e}},__vite__mapDeps([5,1,2]));await e(_a),localStorage.removeItem("fcm_token"),console.log("🔥 FCM token deleted successfully")}catch(e){throw console.error("🔥 FCM token deletion error:",e),e}},Ra=()=>ka||(console.error("🔥 Firestore not initialized. Call initializeFirebase() first."),null),Da=()=>{const e={configured:!1,initialized:!1,messagingAvailable:!1,firestoreAvailable:!1,tokenExists:!1,notificationPermission:"undefined"!=typeof Notification?Notification.permission:"unavailable"};try{const t=Object.entries(wa).filter(([e,t])=>!t).map(([e,t])=>e);return e.configured=0===t.length,e.initialized=!!ya&&!!_a&&!!ka,e.messagingAvailable=!!_a,e.firestoreAvailable=!!ka,e.tokenExists=!!localStorage.getItem("fcm_token"),"Notification"in window&&(e.notificationPermission=Notification.permission),e}catch(t){return console.error("🔥 Error getting Firebase status:",t),e}},Oa={initializeFirebase:Sa,initializeFirebaseApp:Ea,getFCMToken:Ta,setupForegroundMessageListener:Na,deleteFCMToken:xa,getFirestore:Ra,getFirebaseStatus:Da,config:wa},La=Object.freeze(Object.defineProperty({__proto__:null,default:Oa,deleteFCMToken:xa,getAuth:Ia,getFCMToken:Ta,getFirebaseStatus:Da,getFirestore:Ra,initializeFirebase:Sa,initializeFirebaseApp:Ea,setupForegroundMessageListener:Na},Symbol.toStringTag,{value:"Module"}));
/*! Capacitor: https://capacitorjs.com/ - MIT License */
var Ma,Ua;(Ua=Ma||(Ma={})).Unimplemented="UNIMPLEMENTED",Ua.Unavailable="UNAVAILABLE";class Fa extends Error{constructor(e,t,a){super(e),this.message=e,this.code=t,this.data=a}}const qa=e=>{const t=e.CapacitorCustomPlatform||null,a=e.Capacitor||{},n=a.Plugins=a.Plugins||{},i=()=>null!==t?t.name:(e=>{var t,a;return(null==e?void 0:e.androidBridge)?"android":(null===(a=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===a?void 0:a.bridge)?"ios":"web"})(e),s=e=>{var t;return null===(t=a.PluginHeaders)||void 0===t?void 0:t.find(t=>t.name===e)},o=new Map;return a.convertFileSrc||(a.convertFileSrc=e=>e),a.getPlatform=i,a.handleError=t=>e.console.error(t),a.isNativePlatform=()=>"web"!==i(),a.isPluginAvailable=e=>{const t=o.get(e);return!!(null==t?void 0:t.platforms.has(i()))||!!s(e)},a.registerPlugin=(e,r={})=>{const l=o.get(e);if(l)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),l.proxy;const c=i(),d=s(e);let u;const h=n=>{let i;const s=(...s)=>{const o=(async()=>(!u&&c in r?u=u="function"==typeof r[c]?await r[c]():r[c]:null!==t&&!u&&"web"in r&&(u=u="function"==typeof r.web?await r.web():r.web),u))().then(t=>{const o=((t,n)=>{var i,s;if(!d){if(t)return null===(s=t[n])||void 0===s?void 0:s.bind(t);throw new Fa(`"${e}" plugin is not implemented on ${c}`,Ma.Unimplemented)}{const s=null==d?void 0:d.methods.find(e=>n===e.name);if(s)return"promise"===s.rtype?t=>a.nativePromise(e,n.toString(),t):(t,i)=>a.nativeCallback(e,n.toString(),t,i);if(t)return null===(i=t[n])||void 0===i?void 0:i.bind(t)}})(t,n);if(o){const e=o(...s);return i=null==e?void 0:e.remove,e}throw new Fa(`"${e}.${n}()" is not implemented on ${c}`,Ma.Unimplemented)});return"addListener"===n&&(o.remove=async()=>i()),o};return s.toString=()=>`${n.toString()}() { [capacitor code] }`,Object.defineProperty(s,"name",{value:n,writable:!1,configurable:!1}),s},p=h("addListener"),m=h("removeListener"),f=(e,t)=>{const a=p({eventName:e},t),n=async()=>{const n=await a;m({eventName:e,callbackId:n},t)},i=new Promise(e=>a.then(()=>e({remove:n})));return i.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await n()},i},v=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return d?f:p;case"removeListener":return m;default:return h(t)}}});return n[e]=v,o.set(e,{name:e,proxy:v,platforms:new Set([...Object.keys(r),...d?[c]:[]])}),v},a.Exception=Fa,a.DEBUG=!!a.DEBUG,a.isLoggingEnabled=!!a.isLoggingEnabled,a},Ba=(e=>e.Capacitor=qa(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),ja=Ba.registerPlugin;class $a{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let a=!1;this.listeners[e]||(this.listeners[e]=[],a=!0),this.listeners[e].push(t);const n=this.windowListeners[e];n&&!n.registered&&this.addWindowListener(n),a&&this.sendRetainedArgumentsForEvent(e);return Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,a){const n=this.listeners[e];if(n)n.forEach(e=>e(t));else if(a){let a=this.retainedEventArguments[e];a||(a=[]),a.push(t),this.retainedEventArguments[e]=a}}hasListeners(e){var t;return!!(null===(t=this.listeners[e])||void 0===t?void 0:t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new Ba.Exception(e,Ma.Unimplemented)}unavailable(e="not available"){return new Ba.Exception(e,Ma.Unavailable)}async removeListener(e,t){const a=this.listeners[e];if(!a)return;const n=a.indexOf(t);this.listeners[e].splice(n,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(t=>{this.notifyListeners(e,t)}))}}const za=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Va=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Wa extends $a{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[a,n]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");a=Va(a).trim(),n=Va(n).trim(),t[a]=n}),t}async setCookie(e){try{const t=za(e.key),a=za(e.value),n=`; expires=${(e.expires||"").replace("expires=","")}`,i=(e.path||"/").replace("path=",""),s=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${a||""}${n}; path=${i}; ${s};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}ja("CapacitorCookies",{web:()=>new Wa});const Ha=(e,t={})=>{const a=Object.assign({method:e.method||"GET",headers:e.headers},t),n=((e={})=>{const t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((a,n,i)=>(a[n]=e[t[i]],a),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)a.body=e.data;else if(n.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[a,n]of Object.entries(e.data||{}))t.set(a,n);a.body=t.toString()}else if(n.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,a)=>{t.append(a,e)});else for(const a of Object.keys(e.data))t.append(a,e.data[a]);a.body=t;const n=new Headers(a.headers);n.delete("content-type"),a.headers=n}else(n.includes("application/json")||"object"==typeof e.data)&&(a.body=JSON.stringify(e.data));return a};class Ga extends $a{async request(e){const t=Ha(e,e.webFetchExtra),a=((e,t=!0)=>e?Object.entries(e).reduce((e,a)=>{const[n,i]=a;let s,o;return Array.isArray(i)?(o="",i.forEach(e=>{s=t?encodeURIComponent(e):e,o+=`${n}=${s}&`}),o.slice(0,-1)):(s=t?encodeURIComponent(i):i,o=`${n}=${s}`),`${e}&${o}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),n=a?`${e.url}?${a}`:e.url,i=await fetch(n,t),s=i.headers.get("content-type")||"";let o,r,{responseType:l="text"}=i.ok?e:{};switch(s.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":r=await i.blob(),o=await(async e=>new Promise((t,a)=>{const n=new FileReader;n.onload=()=>{const e=n.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},n.onerror=e=>a(e),n.readAsDataURL(e)}))(r);break;case"json":o=await i.json();break;default:o=await i.text()}const c={};return i.headers.forEach((e,t)=>{c[t]=e}),{data:o,headers:c,status:i.status,url:i.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}ja("CapacitorHttp",{web:()=>new Ga});const Ka=Object.freeze(Object.defineProperty({__proto__:null,Capacitor:Ba,CapacitorException:Fa,get ExceptionCode(){return Ma},WebPlugin:$a,buildRequestInit:Ha,registerPlugin:ja},Symbol.toStringTag,{value:"Module"})),Ja=()=>{try{const e=Ba.getPlatform();return"android"===e?"android":"ios"===e?"ios":"web"}catch(e){return"web"}};async function Ya(){try{if(!(await Oa.initializeFirebase()))return null;return await Oa.getFCMToken()}catch(e){return console.warn("notificationClient: no se pudo obtener FCM token:",(null==e?void 0:e.message)||e),null}}async function Qa(e={},t={}){const a=t.platformOverride||Ja();let n=null;try{n=await Ya()}catch(o){}const i={...e};n&&(i.fcm_token=n,i.platform=a);const s=await va.login(i);if(!n)try{const e=await Ya();e&&await async function(e,t=null){try{const a=t||Ja();return await ga.storeDeviceToken(e,a),localStorage.setItem("fcm_token",e),!0}catch(a){return console.warn("notificationClient: error registrando token despues de login:",(null==a?void 0:a.message)||a),!1}}(e,a)}catch(o){}return s}const Za=e=>{try{return"object"==typeof e&&null!==e&&"value"in e?i(e):e}catch(t){return console.warn("Error accessing reactive value:",t),null}},Xa=e=>{try{const t=Za(e);return t?String(t):""}catch(t){return console.warn("Error converting token to string:",t),""}},en=t("auth",()=>{const e=a(null),t=a(localStorage.getItem("token")||null),i=a(!1),s=a(!!Xa(t)),o=a(!1),r=a(null),l=a(null),c=a({userFetch:null,userFetchTimestamp:0,cacheDuration:12e4,pendingUserRequest:null}),d=localStorage.getItem("user");if(d)try{const t=JSON.parse(d);t.selectedRole&&(l.value=t.selectedRole,t.role=t.selectedRole),e.value=t}catch(m){console.error("AuthStore - Error al parsear usuario de localStorage:",m)}const u=n(()=>{var t;return l.value||(null==(t=e.value)?void 0:t.role)||null}),h=async(a=!1)=>{if(c.value.pendingUserRequest)return console.log("📦 fetchUser: Esperando petición pendiente..."),await c.value.pendingUserRequest;if(!a&&e.value)return console.log("📦 fetchUser: Usuario ya existe en memoria"),e.value;const n=Date.now();if(!a&&c.value.userFetch&&n-c.value.userFetchTimestamp<c.value.cacheDuration&&(console.log("📦 fetchUser: Usando datos del cache"),c.value.userFetch))return e.value=c.value.userFetch,e.value;const i=localStorage.getItem("user");if(i&&!a)try{const t=JSON.parse(i);return e.value=t,c.value.userFetch=t,c.value.userFetchTimestamp=n,console.log("📦 fetchUser: Usuario cargado desde localStorage"),e.value}catch(m){console.error("Error parsing stored user:",m)}return s.value&&Xa(t)?(console.log("📦 fetchUser: Obteniendo usuario del servidor..."),c.value.pendingUserRequest=(async()=>{var t;try{const t=await va.getCurrentUser();return t?(e.value=t,c.value.userFetch=t,c.value.userFetchTimestamp=n,localStorage.setItem("user",JSON.stringify(t)),console.log("✅ fetchUser: Usuario obtenido y guardado"),t):(console.warn("fetchUser: Token inválido, cerrando sesión"),await p(),null)}catch(m){throw console.error("Error fetching user:",m),401===(null==(t=m.response)?void 0:t.status)&&await p(),m}finally{c.value.pendingUserRequest=null}})(),await c.value.pendingUserRequest):(console.log("📦 fetchUser: No hay token de autenticación"),null)},p=async()=>{c.value.userFetch=null,c.value.userFetchTimestamp=0,c.value.pendingUserRequest=null;try{await async function(){try{const t=localStorage.getItem("fcm_token");if(t){try{await ga.deleteDeviceToken({token:t})}catch(m){try{await va.delete("device-token",{data:{token:t}})}catch(e){console.warn("notificationClient: fallback delete failed",e)}}localStorage.removeItem("fcm_token")}try{await va.logout()}catch(e){}return localStorage.removeItem("token"),localStorage.removeItem("user"),!0}catch(r){return console.warn("notificationClient: error en logoutAndUnregister",r),!1}}()}catch(a){console.warn("AuthStore - Error en logoutAndUnregister:",a)}e.value=null,t.value=null,s.value=!1,l.value=null,localStorage.removeItem("token"),localStorage.removeItem("userRole"),localStorage.removeItem("user"),localStorage.removeItem("fcm_token");try{const{deleteFCMToken:e}=await H(async()=>{const{deleteFCMToken:e}=await Promise.resolve().then(()=>La);return{deleteFCMToken:e}},void 0);await e()}catch(a){console.warn("Error eliminando token FCM:",a)}try{const{useNotificationsStore:e}=await H(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>lr);return{useNotificationsStore:e}},void 0);e().disconnectRealTimeNotifications()}catch(a){console.warn("Error desconectando Firestore listeners:",a)}return!0};return{user:e,token:t,isAuthenticated:s,initialized:i,isLoading:o,error:r,selectedRole:l,currentRole:u,login:async a=>{var n;o.value=!0,r.value=null;try{const o=(await Qa(a)).data||{},r=o.token||o.access_token||o.plainTextToken;e.value=o.user,t.value=r||null,s.value=!0,l.value=(null==(n=o.user)?void 0:n.selectedRole)||null;const d=Xa(t);d&&localStorage.setItem("token",d),localStorage.setItem("user",JSON.stringify(o.user)),i.value=!0;try{const{initializePushNotifications:e}=await H(async()=>{const{initializePushNotifications:e}=await Promise.resolve().then(()=>JL);return{initializePushNotifications:e}},void 0),{useNotificationsStore:t}=((await H(async()=>{const{Capacitor:e}=await Promise.resolve().then(()=>Ka);return{Capacitor:e}},void 0)).Capacitor.getPlatform(),await e(),await H(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>lr);return{useNotificationsStore:e}},void 0));t().initializeRealTimeNotifications()}catch(c){}return o.user}catch(m){throw console.error("AuthStore - Error en login:",m),r.value=m.message||"Error al iniciar sesión",m}finally{o.value=!1}},loginWithGoogle:async a=>{var n,c,d;o.value=!0,r.value=null;try{const o=(await va.loginWithGoogle(a)).data||{},r=o.token||o.access_token||o.plainTextToken;e.value=o.user,t.value=r||null,s.value=!0,l.value=(null==(n=o.user)?void 0:n.selectedRole)||null;const c=Xa(t);c&&localStorage.setItem("token",c),e.value&&localStorage.setItem("user",JSON.stringify(e.value));try{const{initializePushNotifications:e}=await H(async()=>{const{initializePushNotifications:e}=await Promise.resolve().then(()=>JL);return{initializePushNotifications:e}},void 0);await e();const{useNotificationsStore:t}=await H(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>lr);return{useNotificationsStore:e}},void 0);t().initializeRealTimeNotifications()}catch(u){}return i.value=!0,o}catch(m){throw r.value=(null==(d=null==(c=m.response)?void 0:c.data)?void 0:d.message)||"Error en login con Google",t.value=null,e.value=null,s.value=!1,localStorage.removeItem("token"),localStorage.removeItem("user"),m}finally{o.value=!1}},register:async a=>{o.value=!0,r.value=null;try{const n=(await va.register(a)).data||{};e.value=n.user,t.value=n.token||null,s.value=!0,l.value=null;const i=Xa(t);return i&&localStorage.setItem("token",i),localStorage.setItem("user",JSON.stringify(n.user)),n.user}catch(m){throw r.value=m.message||"Error al registrarse",m}finally{o.value=!1}},logout:p,fetchUser:h,updateProfile:async t=>{try{const a=Object.fromEntries(t.entries());return e.value={...e.value,...a},localStorage.setItem("user",JSON.stringify(e.value)),{data:{user:e.value}}}catch(a){throw console.error("Error actualizando el perfil:",a),a}},forgotPassword:async e=>{o.value=!0,r.value=null;try{return!0}catch(m){throw r.value=m.message||"Error al enviar email de recuperación",m}finally{o.value=!1}},resetPassword:async(e,t)=>{o.value=!0,r.value=null;try{return!0}catch(m){throw r.value=m.message||"Error al restablecer contraseña",m}finally{o.value=!1}},setSelectedRole:a=>{l.value=a,e.value&&(e.value={...e.value,role:a});const n=localStorage.getItem("user");if(n)try{const e=JSON.parse(n);e.selectedRole=a,e.role=a,localStorage.setItem("user",JSON.stringify(e))}catch(m){console.error("AuthStore - Error actualizando usuario en localStorage:",m)}try{const e=localStorage.getItem("token");e&&(t.value=e,s.value=!0)}catch(m){console.warn("AuthStore - Error sincronizando token desde localStorage:",m)}},getSelectedRole:()=>Za(l),tryToLogin:async()=>{if(i.value)return console.log("📦 tryToLogin: Ya inicializado, retornando estado actual"),s.value;const a=localStorage.getItem("token"),n=localStorage.getItem("user");if(!a)return i.value=!0,!1;try{if(t.value=a,n){const t=JSON.parse(n);e.value=t,l.value=t.selectedRole||t.role,c.value.userFetch=t,c.value.userFetchTimestamp=Date.now()}return await h(!1)?(s.value=!0,i.value=!0,!0):(await p(),!1)}catch(m){return await p(),i.value=!0,!1}}}}),tn=Object.freeze(Object.defineProperty({__proto__:null,useAuthStore:en},Symbol.toStringTag,{value:"Module"}));
/*!
* sweetalert2 v11.22.0
* Released under the MIT License.
*/
function an(e,t,a){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:a;throw new TypeError("Private element is not present on this object")}function nn(e,t){return e.get(an(e,t))}function sn(e,t,a){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,a)}const on={},rn=e=>new Promise(t=>{if(!e)return t();const a=window.scrollX,n=window.scrollY;on.restoreFocusTimeout=setTimeout(()=>{on.previousActiveElement instanceof HTMLElement?(on.previousActiveElement.focus(),on.previousActiveElement=null):document.body&&document.body.focus(),t()},100),window.scrollTo(a,n)}),ln="swal2-",cn=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error","draggable","dragging"].reduce((e,t)=>(e[t]=ln+t,e),{}),dn=["success","warning","info","question","error"].reduce((e,t)=>(e[t]=ln+t,e),{}),un="SweetAlert2:",hn=e=>e.charAt(0).toUpperCase()+e.slice(1),pn=e=>{console.warn(`${un} ${"object"==typeof e?e.join(" "):e}`)},mn=e=>{console.error(`${un} ${e}`)},fn=[],vn=(e,t=null)=>{var a;a=`"${e}" is deprecated and will be removed in the next major release.${t?` Use "${t}" instead.`:""}`,fn.includes(a)||(fn.push(a),pn(a))},gn=e=>"function"==typeof e?e():e,bn=e=>e&&"function"==typeof e.toPromise,wn=e=>bn(e)?e.toPromise():Promise.resolve(e),yn=e=>e&&Promise.resolve(e)===e,_n=()=>document.body.querySelector(`.${cn.container}`),kn=e=>{const t=_n();return t?t.querySelector(e):null},Cn=e=>kn(`.${e}`),En=()=>Cn(cn.popup),In=()=>Cn(cn.icon),Sn=()=>Cn(cn.title),Tn=()=>Cn(cn["html-container"]),Nn=()=>Cn(cn.image),Pn=()=>Cn(cn["progress-steps"]),An=()=>Cn(cn["validation-message"]),xn=()=>kn(`.${cn.actions} .${cn.confirm}`),Rn=()=>kn(`.${cn.actions} .${cn.cancel}`),Dn=()=>kn(`.${cn.actions} .${cn.deny}`),On=()=>kn(`.${cn.loader}`),Ln=()=>Cn(cn.actions),Mn=()=>Cn(cn.footer),Un=()=>Cn(cn["timer-progress-bar"]),Fn=()=>Cn(cn.close),qn=()=>{const e=En();if(!e)return[];const t=e.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),a=Array.from(t).sort((e,t)=>{const a=parseInt(e.getAttribute("tabindex")||"0"),n=parseInt(t.getAttribute("tabindex")||"0");return a>n?1:a<n?-1:0}),n=e.querySelectorAll('\n  a[href],\n  area[href],\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled]),\n  button:not([disabled]),\n  iframe,\n  object,\n  embed,\n  [tabindex="0"],\n  [contenteditable],\n  audio[controls],\n  video[controls],\n  summary\n'),i=Array.from(n).filter(e=>"-1"!==e.getAttribute("tabindex"));return[...new Set(a.concat(i))].filter(e=>ni(e))},Bn=()=>zn(document.body,cn.shown)&&!zn(document.body,cn["toast-shown"])&&!zn(document.body,cn["no-backdrop"]),jn=()=>{const e=En();return!!e&&zn(e,cn.toast)},$n=(e,t)=>{if(e.textContent="",t){const a=(new DOMParser).parseFromString(t,"text/html"),n=a.querySelector("head");n&&Array.from(n.childNodes).forEach(t=>{e.appendChild(t)});const i=a.querySelector("body");i&&Array.from(i.childNodes).forEach(t=>{t instanceof HTMLVideoElement||t instanceof HTMLAudioElement?e.appendChild(t.cloneNode(!0)):e.appendChild(t)})}},zn=(e,t)=>{if(!t)return!1;const a=t.split(/\s+/);for(let n=0;n<a.length;n++)if(!e.classList.contains(a[n]))return!1;return!0},Vn=(e,t,a)=>{if(((e,t)=>{Array.from(e.classList).forEach(a=>{Object.values(cn).includes(a)||Object.values(dn).includes(a)||Object.values(t.showClass||{}).includes(a)||e.classList.remove(a)})})(e,t),!t.customClass)return;const n=t.customClass[a];n&&("string"==typeof n||n.forEach?Kn(e,n):pn(`Invalid type of customClass.${a}! Expected string or iterable object, got "${typeof n}"`))},Wn=(e,t)=>{if(!t)return null;switch(t){case"select":case"textarea":case"file":return e.querySelector(`.${cn.popup} > .${cn[t]}`);case"checkbox":return e.querySelector(`.${cn.popup} > .${cn.checkbox} input`);case"radio":return e.querySelector(`.${cn.popup} > .${cn.radio} input:checked`)||e.querySelector(`.${cn.popup} > .${cn.radio} input:first-child`);case"range":return e.querySelector(`.${cn.popup} > .${cn.range} input`);default:return e.querySelector(`.${cn.popup} > .${cn.input}`)}},Hn=e=>{if(e.focus(),"file"!==e.type){const t=e.value;e.value="",e.value=t}},Gn=(e,t,a)=>{e&&t&&("string"==typeof t&&(t=t.split(/\s+/).filter(Boolean)),t.forEach(t=>{Array.isArray(e)?e.forEach(e=>{a?e.classList.add(t):e.classList.remove(t)}):a?e.classList.add(t):e.classList.remove(t)}))},Kn=(e,t)=>{Gn(e,t,!0)},Jn=(e,t)=>{Gn(e,t,!1)},Yn=(e,t)=>{const a=Array.from(e.children);for(let n=0;n<a.length;n++){const e=a[n];if(e instanceof HTMLElement&&zn(e,t))return e}},Qn=(e,t,a)=>{a===`${parseInt(a)}`&&(a=parseInt(a)),a||0===parseInt(a)?e.style.setProperty(t,"number"==typeof a?`${a}px`:a):e.style.removeProperty(t)},Zn=(e,t="flex")=>{e&&(e.style.display=t)},Xn=e=>{e&&(e.style.display="none")},ei=(e,t="block")=>{e&&new MutationObserver(()=>{ai(e,e.innerHTML,t)}).observe(e,{childList:!0,subtree:!0})},ti=(e,t,a,n)=>{const i=e.querySelector(t);i&&i.style.setProperty(a,n)},ai=(e,t,a="flex")=>{t?Zn(e,a):Xn(e)},ni=e=>!(!e||!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)),ii=e=>!!(e.scrollHeight>e.clientHeight),si=e=>{const t=window.getComputedStyle(e),a=parseFloat(t.getPropertyValue("animation-duration")||"0"),n=parseFloat(t.getPropertyValue("transition-duration")||"0");return a>0||n>0},oi=(e,t=!1)=>{const a=Un();a&&ni(a)&&(t&&(a.style.transition="none",a.style.width="100%"),setTimeout(()=>{a.style.transition=`width ${e/1e3}s linear`,a.style.width="0%"},10))},ri=`\n <div aria-labelledby="${cn.title}" aria-describedby="${cn["html-container"]}" class="${cn.popup}" tabindex="-1">\n   <button type="button" class="${cn.close}"></button>\n   <ul class="${cn["progress-steps"]}"></ul>\n   <div class="${cn.icon}"></div>\n   <img class="${cn.image}" />\n   <h2 class="${cn.title}" id="${cn.title}"></h2>\n   <div class="${cn["html-container"]}" id="${cn["html-container"]}"></div>\n   <input class="${cn.input}" id="${cn.input}" />\n   <input type="file" class="${cn.file}" />\n   <div class="${cn.range}">\n     <input type="range" />\n     <output></output>\n   </div>\n   <select class="${cn.select}" id="${cn.select}"></select>\n   <div class="${cn.radio}"></div>\n   <label class="${cn.checkbox}">\n     <input type="checkbox" id="${cn.checkbox}" />\n     <span class="${cn.label}"></span>\n   </label>\n   <textarea class="${cn.textarea}" id="${cn.textarea}"></textarea>\n   <div class="${cn["validation-message"]}" id="${cn["validation-message"]}"></div>\n   <div class="${cn.actions}">\n     <div class="${cn.loader}"></div>\n     <button type="button" class="${cn.confirm}"></button>\n     <button type="button" class="${cn.deny}"></button>\n     <button type="button" class="${cn.cancel}"></button>\n   </div>\n   <div class="${cn.footer}"></div>\n   <div class="${cn["timer-progress-bar-container"]}">\n     <div class="${cn["timer-progress-bar"]}"></div>\n   </div>\n </div>\n`.replace(/(^|\n)\s*/g,""),li=()=>{on.currentInstance.resetValidationMessage()},ci=e=>{const t=(()=>{const e=_n();return!!e&&(e.remove(),Jn([document.documentElement,document.body],[cn["no-backdrop"],cn["toast-shown"],cn["has-column"]]),!0)})();if("undefined"==typeof window||"undefined"==typeof document)return void mn("SweetAlert2 requires document to initialize");const a=document.createElement("div");a.className=cn.container,t&&Kn(a,cn["no-transition"]),$n(a,ri),a.dataset.swal2Theme=e.theme;const n="string"==typeof(i=e.target)?document.querySelector(i):i;var i;n.appendChild(a),e.topLayer&&(a.setAttribute("popover",""),a.showPopover()),(e=>{const t=En();t.setAttribute("role",e.toast?"alert":"dialog"),t.setAttribute("aria-live",e.toast?"polite":"assertive"),e.toast||t.setAttribute("aria-modal","true")})(e),(e=>{"rtl"===window.getComputedStyle(e).direction&&Kn(_n(),cn.rtl)})(n),(()=>{const e=En(),t=Yn(e,cn.input),a=Yn(e,cn.file),n=e.querySelector(`.${cn.range} input`),i=e.querySelector(`.${cn.range} output`),s=Yn(e,cn.select),o=e.querySelector(`.${cn.checkbox} input`),r=Yn(e,cn.textarea);t.oninput=li,a.onchange=li,s.onchange=li,o.onchange=li,r.oninput=li,n.oninput=()=>{li(),i.value=n.value},n.onchange=()=>{li(),i.value=n.value}})()},di=(e,t)=>{e instanceof HTMLElement?t.appendChild(e):"object"==typeof e?ui(e,t):e&&$n(t,e)},ui=(e,t)=>{e.jquery?hi(t,e):$n(t,e.toString())},hi=(e,t)=>{if(e.textContent="",0 in t)for(let a=0;a in t;a++)e.appendChild(t[a].cloneNode(!0));else e.appendChild(t.cloneNode(!0))},pi=(e,t)=>{const a=Ln(),n=On();a&&n&&(t.showConfirmButton||t.showDenyButton||t.showCancelButton?Zn(a):Xn(a),Vn(a,t,"actions"),function(e,t,a){const n=xn(),i=Dn(),s=Rn();if(!n||!i||!s)return;fi(n,"confirm",a),fi(i,"deny",a),fi(s,"cancel",a),function(e,t,a,n){if(!n.buttonsStyling)return void Jn([e,t,a],cn.styled);Kn([e,t,a],cn.styled),n.confirmButtonColor&&e.style.setProperty("--swal2-confirm-button-background-color",n.confirmButtonColor);n.denyButtonColor&&t.style.setProperty("--swal2-deny-button-background-color",n.denyButtonColor);n.cancelButtonColor&&a.style.setProperty("--swal2-cancel-button-background-color",n.cancelButtonColor);mi(e),mi(t),mi(a)}(n,i,s,a),a.reverseButtons&&(a.toast?(e.insertBefore(s,n),e.insertBefore(i,n)):(e.insertBefore(s,t),e.insertBefore(i,t),e.insertBefore(n,t)))}(a,n,t),$n(n,t.loaderHtml||""),Vn(n,t,"loader"))};function mi(e){const t=window.getComputedStyle(e);if(t.getPropertyValue("--swal2-action-button-focus-box-shadow"))return;const a=t.backgroundColor.replace(/rgba?\((\d+), (\d+), (\d+).*/,"rgba($1, $2, $3, 0.5)");e.style.setProperty("--swal2-action-button-focus-box-shadow",t.getPropertyValue("--swal2-outline").replace(/ rgba\(.*/,` ${a}`))}function fi(e,t,a){const n=hn(t);ai(e,a[`show${n}Button`],"inline-block"),$n(e,a[`${t}ButtonText`]||""),e.setAttribute("aria-label",a[`${t}ButtonAriaLabel`]||""),e.className=cn[t],Vn(e,a,`${t}Button`)}const vi=(e,t)=>{const a=_n();a&&(!function(e,t){"string"==typeof t?e.style.background=t:t||Kn([document.documentElement,document.body],cn["no-backdrop"])}(a,t.backdrop),function(e,t){if(!t)return;t in cn?Kn(e,cn[t]):(pn('The "position" parameter is not valid, defaulting to "center"'),Kn(e,cn.center))}(a,t.position),function(e,t){if(!t)return;Kn(e,cn[`grow-${t}`])}(a,t.grow),Vn(a,t,"container"))};var gi={innerParams:new WeakMap,domCache:new WeakMap};const bi=["input","file","range","select","radio","checkbox","textarea"],wi=e=>{if(!e.input)return;if(!Si[e.input])return void mn(`Unexpected type of input! Expected ${Object.keys(Si).join(" | ")}, got "${e.input}"`);const t=Ei(e.input);if(!t)return;const a=Si[e.input](t,e);Zn(t),e.inputAutoFocus&&setTimeout(()=>{Hn(a)})},yi=(e,t)=>{const a=En();if(!a)return;const n=Wn(a,e);if(n){(e=>{for(let t=0;t<e.attributes.length;t++){const a=e.attributes[t].name;["id","type","value","style"].includes(a)||e.removeAttribute(a)}})(n);for(const e in t)n.setAttribute(e,t[e])}},_i=e=>{if(!e.input)return;const t=Ei(e.input);t&&Vn(t,e,"input")},ki=(e,t)=>{!e.placeholder&&t.inputPlaceholder&&(e.placeholder=t.inputPlaceholder)},Ci=(e,t,a)=>{if(a.inputLabel){const n=document.createElement("label"),i=cn["input-label"];n.setAttribute("for",e.id),n.className=i,"object"==typeof a.customClass&&Kn(n,a.customClass.inputLabel),n.innerText=a.inputLabel,t.insertAdjacentElement("beforebegin",n)}},Ei=e=>{const t=En();if(t)return Yn(t,cn[e]||cn.input)},Ii=(e,t)=>{["string","number"].includes(typeof t)?e.value=`${t}`:yn(t)||pn(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof t}"`)},Si={};Si.text=Si.email=Si.password=Si.number=Si.tel=Si.url=Si.search=Si.date=Si["datetime-local"]=Si.time=Si.week=Si.month=(e,t)=>(Ii(e,t.inputValue),Ci(e,e,t),ki(e,t),e.type=t.input,e),Si.file=(e,t)=>(Ci(e,e,t),ki(e,t),e),Si.range=(e,t)=>{const a=e.querySelector("input"),n=e.querySelector("output");return Ii(a,t.inputValue),a.type=t.input,Ii(n,t.inputValue),Ci(a,e,t),e},Si.select=(e,t)=>{if(e.textContent="",t.inputPlaceholder){const a=document.createElement("option");$n(a,t.inputPlaceholder),a.value="",a.disabled=!0,a.selected=!0,e.appendChild(a)}return Ci(e,e,t),e},Si.radio=e=>(e.textContent="",e),Si.checkbox=(e,t)=>{const a=Wn(En(),"checkbox");a.value="1",a.checked=Boolean(t.inputValue);const n=e.querySelector("span");return $n(n,t.inputPlaceholder||t.inputLabel),a},Si.textarea=(e,t)=>{Ii(e,t.inputValue),ki(e,t),Ci(e,e,t);return setTimeout(()=>{if("MutationObserver"in window){const a=parseInt(window.getComputedStyle(En()).width);new MutationObserver(()=>{if(!document.body.contains(e))return;const n=e.offsetWidth+(i=e,parseInt(window.getComputedStyle(i).marginLeft)+parseInt(window.getComputedStyle(i).marginRight));var i;n>a?En().style.width=`${n}px`:Qn(En(),"width",t.width)}).observe(e,{attributes:!0,attributeFilter:["style"]})}}),e};const Ti=(e,t)=>{const a=Tn();a&&(ei(a),Vn(a,t,"htmlContainer"),t.html?(di(t.html,a),Zn(a,"block")):t.text?(a.textContent=t.text,Zn(a,"block")):Xn(a),((e,t)=>{const a=En();if(!a)return;const n=gi.innerParams.get(e),i=!n||t.input!==n.input;bi.forEach(e=>{const n=Yn(a,cn[e]);n&&(yi(e,t.inputAttributes),n.className=cn[e],i&&Xn(n))}),t.input&&(i&&wi(t),_i(t))})(e,t))},Ni=(e,t)=>{for(const[a,n]of Object.entries(dn))t.icon!==a&&Jn(e,n);Kn(e,t.icon&&dn[t.icon]),xi(e,t),Pi(),Vn(e,t,"icon")},Pi=()=>{const e=En();if(!e)return;const t=window.getComputedStyle(e).getPropertyValue("background-color"),a=e.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let n=0;n<a.length;n++)a[n].style.backgroundColor=t},Ai=(e,t)=>{if(!t.icon&&!t.iconHtml)return;let a=e.innerHTML,n="";if(t.iconHtml)n=Ri(t.iconHtml);else if("success"===t.icon)n='\n  <div class="swal2-success-circular-line-left"></div>\n  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>\n  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>\n  <div class="swal2-success-circular-line-right"></div>\n',a=a.replace(/ style=".*?"/g,"");else if("error"===t.icon)n='\n  <span class="swal2-x-mark">\n    <span class="swal2-x-mark-line-left"></span>\n    <span class="swal2-x-mark-line-right"></span>\n  </span>\n';else if(t.icon){n=Ri({question:"?",warning:"!",info:"i"}[t.icon])}a.trim()!==n.trim()&&$n(e,n)},xi=(e,t)=>{if(t.iconColor){e.style.color=t.iconColor,e.style.borderColor=t.iconColor;for(const a of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])ti(e,a,"background-color",t.iconColor);ti(e,".swal2-success-ring","border-color",t.iconColor)}},Ri=e=>`<div class="${cn["icon-content"]}">${e}</div>`;let Di=!1,Oi=0,Li=0,Mi=0,Ui=0;const Fi=e=>{const t=En();if(e.target===t||In().contains(e.target)){Di=!0;const a=ji(e);Oi=a.clientX,Li=a.clientY,Mi=parseInt(t.style.insetInlineStart)||0,Ui=parseInt(t.style.insetBlockStart)||0,Kn(t,"swal2-dragging")}},qi=e=>{const t=En();if(Di){let{clientX:a,clientY:n}=ji(e);t.style.insetInlineStart=`${Mi+(a-Oi)}px`,t.style.insetBlockStart=`${Ui+(n-Li)}px`}},Bi=()=>{const e=En();Di=!1,Jn(e,"swal2-dragging")},ji=e=>{let t=0,a=0;return e.type.startsWith("mouse")?(t=e.clientX,a=e.clientY):e.type.startsWith("touch")&&(t=e.touches[0].clientX,a=e.touches[0].clientY),{clientX:t,clientY:a}},$i=(e,t)=>{const a=_n(),n=En();if(a&&n){if(t.toast){Qn(a,"width",t.width),n.style.width="100%";const e=On();e&&n.insertBefore(e,In())}else Qn(n,"width",t.width);Qn(n,"padding",t.padding),t.color&&(n.style.color=t.color),t.background&&(n.style.background=t.background),Xn(An()),zi(n,t),t.draggable&&!t.toast?(Kn(n,cn.draggable),(e=>{e.addEventListener("mousedown",Fi),document.body.addEventListener("mousemove",qi),e.addEventListener("mouseup",Bi),e.addEventListener("touchstart",Fi),document.body.addEventListener("touchmove",qi),e.addEventListener("touchend",Bi)})(n)):(Jn(n,cn.draggable),(e=>{e.removeEventListener("mousedown",Fi),document.body.removeEventListener("mousemove",qi),e.removeEventListener("mouseup",Bi),e.removeEventListener("touchstart",Fi),document.body.removeEventListener("touchmove",qi),e.removeEventListener("touchend",Bi)})(n))}},zi=(e,t)=>{const a=t.showClass||{};e.className=`${cn.popup} ${ni(e)?a.popup:""}`,t.toast?(Kn([document.documentElement,document.body],cn["toast-shown"]),Kn(e,cn.toast)):Kn(e,cn.modal),Vn(e,t,"popup"),"string"==typeof t.customClass&&Kn(e,t.customClass),t.icon&&Kn(e,cn[`icon-${t.icon}`])},Vi=e=>{const t=document.createElement("li");return Kn(t,cn["progress-step"]),$n(t,e),t},Wi=e=>{const t=document.createElement("li");return Kn(t,cn["progress-step-line"]),e.progressStepsDistance&&Qn(t,"width",e.progressStepsDistance),t},Hi=(e,t)=>{$i(0,t),vi(0,t),((e,t)=>{const a=Pn();if(!a)return;const{progressSteps:n,currentProgressStep:i}=t;n&&0!==n.length&&void 0!==i?(Zn(a),a.textContent="",i>=n.length&&pn("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),n.forEach((e,s)=>{const o=Vi(e);if(a.appendChild(o),s===i&&Kn(o,cn["active-progress-step"]),s!==n.length-1){const e=Wi(t);a.appendChild(e)}})):Xn(a)})(0,t),((e,t)=>{const a=gi.innerParams.get(e),n=In();if(!n)return;if(a&&t.icon===a.icon)return Ai(n,t),void Ni(n,t);if(!t.icon&&!t.iconHtml)return void Xn(n);if(t.icon&&-1===Object.keys(dn).indexOf(t.icon))return mn(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${t.icon}"`),void Xn(n);Zn(n),Ai(n,t),Ni(n,t),Kn(n,t.showClass&&t.showClass.icon),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",Pi)})(e,t),((e,t)=>{const a=Nn();a&&(t.imageUrl?(Zn(a,""),a.setAttribute("src",t.imageUrl),a.setAttribute("alt",t.imageAlt||""),Qn(a,"width",t.imageWidth),Qn(a,"height",t.imageHeight),a.className=cn.image,Vn(a,t,"image")):Xn(a))})(0,t),((e,t)=>{const a=Sn();a&&(ei(a),ai(a,t.title||t.titleText,"block"),t.title&&di(t.title,a),t.titleText&&(a.innerText=t.titleText),Vn(a,t,"title"))})(0,t),((e,t)=>{const a=Fn();a&&($n(a,t.closeButtonHtml||""),Vn(a,t,"closeButton"),ai(a,t.showCloseButton),a.setAttribute("aria-label",t.closeButtonAriaLabel||""))})(0,t),Ti(e,t),pi(0,t),((e,t)=>{const a=Mn();a&&(ei(a),ai(a,t.footer,"block"),t.footer&&di(t.footer,a),Vn(a,t,"footer"))})(0,t);const a=En();"function"==typeof t.didRender&&a&&t.didRender(a),on.eventEmitter.emit("didRender",a)},Gi=()=>{var e;return null===(e=xn())||void 0===e?void 0:e.click()},Ki=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),Ji=e=>{e.keydownTarget&&e.keydownHandlerAdded&&(e.keydownTarget.removeEventListener("keydown",e.keydownHandler,{capture:e.keydownListenerCapture}),e.keydownHandlerAdded=!1)},Yi=(e,t)=>{var a;const n=qn();if(n.length)return-2===(e+=t)&&(e=n.length-1),e===n.length?e=0:-1===e&&(e=n.length-1),void n[e].focus();null===(a=En())||void 0===a||a.focus()},Qi=["ArrowRight","ArrowDown"],Zi=["ArrowLeft","ArrowUp"],Xi=(e,t,a)=>{e&&(t.isComposing||229===t.keyCode||(e.stopKeydownPropagation&&t.stopPropagation(),"Enter"===t.key?es(t,e):"Tab"===t.key?ts(t):[...Qi,...Zi].includes(t.key)?as(t.key):"Escape"===t.key&&ns(t,e,a)))},es=(e,t)=>{if(!gn(t.allowEnterKey))return;const a=Wn(En(),t.input);if(e.target&&a&&e.target instanceof HTMLElement&&e.target.outerHTML===a.outerHTML){if(["textarea","file"].includes(t.input))return;Gi(),e.preventDefault()}},ts=e=>{const t=e.target,a=qn();let n=-1;for(let i=0;i<a.length;i++)if(t===a[i]){n=i;break}e.shiftKey?Yi(n,-1):Yi(n,1),e.stopPropagation(),e.preventDefault()},as=e=>{const t=Ln(),a=xn(),n=Dn(),i=Rn();if(!(t&&a&&n&&i))return;const s=[a,n,i];if(document.activeElement instanceof HTMLElement&&!s.includes(document.activeElement))return;const o=Qi.includes(e)?"nextElementSibling":"previousElementSibling";let r=document.activeElement;if(r){for(let e=0;e<t.children.length;e++){if(r=r[o],!r)return;if(r instanceof HTMLButtonElement&&ni(r))break}r instanceof HTMLButtonElement&&r.focus()}},ns=(e,t,a)=>{gn(t.allowEscapeKey)&&(e.preventDefault(),a(Ki.esc))};var is={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const ss=()=>{Array.from(document.body.children).forEach(e=>{e.hasAttribute("data-previous-aria-hidden")?(e.setAttribute("aria-hidden",e.getAttribute("data-previous-aria-hidden")||""),e.removeAttribute("data-previous-aria-hidden")):e.removeAttribute("aria-hidden")})},os="undefined"!=typeof window&&!!window.GestureEvent,rs=()=>{const e=_n();if(!e)return;let t;e.ontouchstart=e=>{t=ls(e)},e.ontouchmove=e=>{t&&(e.preventDefault(),e.stopPropagation())}},ls=e=>{const t=e.target,a=_n(),n=Tn();return!(!a||!n)&&(!cs(e)&&!ds(e)&&(t===a||!(ii(a)||!(t instanceof HTMLElement)||((e,t)=>{let a=e;for(;a&&a!==t;){if(ii(a))return!0;a=a.parentElement}return!1})(t,n)||"INPUT"===t.tagName||"TEXTAREA"===t.tagName||ii(n)&&n.contains(t))))},cs=e=>e.touches&&e.touches.length&&"stylus"===e.touches[0].touchType,ds=e=>e.touches&&e.touches.length>1;let us=null;const hs=e=>{null===us&&(document.body.scrollHeight>window.innerHeight||"scroll"===e)&&(us=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${us+(()=>{const e=document.createElement("div");e.className=cn["scrollbar-measure"],document.body.appendChild(e);const t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t})()}px`)};function ps(e,t,a,n){jn()?_s(e,n):(rn(a).then(()=>_s(e,n)),Ji(on)),os?(t.setAttribute("style","display:none !important"),t.removeAttribute("class"),t.innerHTML=""):t.remove(),Bn()&&(null!==us&&(document.body.style.paddingRight=`${us}px`,us=null),(()=>{if(zn(document.body,cn.iosfix)){const e=parseInt(document.body.style.top,10);Jn(document.body,cn.iosfix),document.body.style.top="",document.body.scrollTop=-1*e}})(),ss()),Jn([document.documentElement,document.body],[cn.shown,cn["height-auto"],cn["no-backdrop"],cn["toast-shown"]])}function ms(e){e=bs(e);const t=is.swalPromiseResolve.get(this),a=fs(this);this.isAwaitingPromise?e.isDismissed||(gs(this),t(e)):a&&t(e)}const fs=e=>{const t=En();if(!t)return!1;const a=gi.innerParams.get(e);if(!a||zn(t,a.hideClass.popup))return!1;Jn(t,a.showClass.popup),Kn(t,a.hideClass.popup);const n=_n();return Jn(n,a.showClass.backdrop),Kn(n,a.hideClass.backdrop),ws(e,t,a),!0};function vs(e){const t=is.swalPromiseReject.get(this);gs(this),t&&t(e)}const gs=e=>{e.isAwaitingPromise&&(delete e.isAwaitingPromise,gi.innerParams.get(e)||e._destroy())},bs=e=>void 0===e?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},e),ws=(e,t,a)=>{var n;const i=_n(),s=si(t);"function"==typeof a.willClose&&a.willClose(t),null===(n=on.eventEmitter)||void 0===n||n.emit("willClose",t),s?ys(e,t,i,a.returnFocus,a.didClose):ps(e,i,a.returnFocus,a.didClose)},ys=(e,t,a,n,i)=>{on.swalCloseEventFinishedCallback=ps.bind(null,e,a,n,i);const s=function(e){var a;e.target===t&&(null===(a=on.swalCloseEventFinishedCallback)||void 0===a||a.call(on),delete on.swalCloseEventFinishedCallback,t.removeEventListener("animationend",s),t.removeEventListener("transitionend",s))};t.addEventListener("animationend",s),t.addEventListener("transitionend",s)},_s=(e,t)=>{setTimeout(()=>{var a;"function"==typeof t&&t.bind(e.params)(),null===(a=on.eventEmitter)||void 0===a||a.emit("didClose"),e._destroy&&e._destroy()})},ks=e=>{let t=En();if(t||new ar,t=En(),!t)return;const a=On();jn()?Xn(In()):Cs(t,e),Zn(a),t.setAttribute("data-loading","true"),t.setAttribute("aria-busy","true"),t.focus()},Cs=(e,t)=>{const a=Ln(),n=On();a&&n&&(!t&&ni(xn())&&(t=xn()),Zn(a),t&&(Xn(t),n.setAttribute("data-button-to-replace",t.className),a.insertBefore(n,t)),Kn([e,a],cn.loading))},Es=e=>e.checked?1:0,Is=e=>e.checked?e.value:null,Ss=e=>e.files&&e.files.length?null!==e.getAttribute("multiple")?e.files:e.files[0]:null,Ts=(e,t)=>{const a=En();if(!a)return;const n=e=>{"select"===t.input?function(e,t,a){const n=Yn(e,cn.select);if(!n)return;const i=(e,t,n)=>{const i=document.createElement("option");i.value=n,$n(i,t),i.selected=As(n,a.inputValue),e.appendChild(i)};t.forEach(e=>{const t=e[0],a=e[1];if(Array.isArray(a)){const e=document.createElement("optgroup");e.label=t,e.disabled=!1,n.appendChild(e),a.forEach(t=>i(e,t[1],t[0]))}else i(n,a,t)}),n.focus()}(a,Ps(e),t):"radio"===t.input&&function(e,t,a){const n=Yn(e,cn.radio);if(!n)return;t.forEach(e=>{const t=e[0],i=e[1],s=document.createElement("input"),o=document.createElement("label");s.type="radio",s.name=cn.radio,s.value=t,As(t,a.inputValue)&&(s.checked=!0);const r=document.createElement("span");$n(r,i),r.className=cn.label,o.appendChild(s),o.appendChild(r),n.appendChild(o)});const i=n.querySelectorAll("input");i.length&&i[0].focus()}(a,Ps(e),t)};bn(t.inputOptions)||yn(t.inputOptions)?(ks(xn()),wn(t.inputOptions).then(t=>{e.hideLoading(),n(t)})):"object"==typeof t.inputOptions?n(t.inputOptions):mn("Unexpected type of inputOptions! Expected object, Map or Promise, got "+typeof t.inputOptions)},Ns=(e,t)=>{const a=e.getInput();a&&(Xn(a),wn(t.inputValue).then(n=>{a.value="number"===t.input?`${parseFloat(n)||0}`:`${n}`,Zn(a),a.focus(),e.hideLoading()}).catch(t=>{mn(`Error in inputValue promise: ${t}`),a.value="",Zn(a),a.focus(),e.hideLoading()}))};const Ps=e=>{const t=[];return e instanceof Map?e.forEach((e,a)=>{let n=e;"object"==typeof n&&(n=Ps(n)),t.push([a,n])}):Object.keys(e).forEach(a=>{let n=e[a];"object"==typeof n&&(n=Ps(n)),t.push([a,n])}),t},As=(e,t)=>!!t&&t.toString()===e.toString(),xs=(e,t)=>{const a=gi.innerParams.get(e);if(!a.input)return void mn(`The "input" parameter is needed to be set when using returnInputValueOn${hn(t)}`);const n=e.getInput(),i=((e,t)=>{const a=e.getInput();if(!a)return null;switch(t.input){case"checkbox":return Es(a);case"radio":return Is(a);case"file":return Ss(a);default:return t.inputAutoTrim?a.value.trim():a.value}})(e,a);a.inputValidator?Rs(e,i,t):n&&!n.checkValidity()?(e.enableButtons(),e.showValidationMessage(a.validationMessage||n.validationMessage)):"deny"===t?Ds(e,i):Ms(e,i)},Rs=(e,t,a)=>{const n=gi.innerParams.get(e);e.disableInput();Promise.resolve().then(()=>wn(n.inputValidator(t,n.validationMessage))).then(n=>{e.enableButtons(),e.enableInput(),n?e.showValidationMessage(n):"deny"===a?Ds(e,t):Ms(e,t)})},Ds=(e,t)=>{const a=gi.innerParams.get(e||void 0);if(a.showLoaderOnDeny&&ks(Dn()),a.preDeny){e.isAwaitingPromise=!0;Promise.resolve().then(()=>wn(a.preDeny(t,a.validationMessage))).then(a=>{!1===a?(e.hideLoading(),gs(e)):e.close({isDenied:!0,value:void 0===a?t:a})}).catch(t=>Ls(e||void 0,t))}else e.close({isDenied:!0,value:t})},Os=(e,t)=>{e.close({isConfirmed:!0,value:t})},Ls=(e,t)=>{e.rejectPromise(t)},Ms=(e,t)=>{const a=gi.innerParams.get(e||void 0);if(a.showLoaderOnConfirm&&ks(),a.preConfirm){e.resetValidationMessage(),e.isAwaitingPromise=!0;Promise.resolve().then(()=>wn(a.preConfirm(t,a.validationMessage))).then(a=>{ni(An())||!1===a?(e.hideLoading(),gs(e)):Os(e,void 0===a?t:a)}).catch(t=>Ls(e||void 0,t))}else Os(e,t)};function Us(){const e=gi.innerParams.get(this);if(!e)return;const t=gi.domCache.get(this);Xn(t.loader),jn()?e.icon&&Zn(In()):Fs(t),Jn([t.popup,t.actions],cn.loading),t.popup.removeAttribute("aria-busy"),t.popup.removeAttribute("data-loading"),t.confirmButton.disabled=!1,t.denyButton.disabled=!1,t.cancelButton.disabled=!1}const Fs=e=>{const t=e.popup.getElementsByClassName(e.loader.getAttribute("data-button-to-replace"));t.length?Zn(t[0],"inline-block"):ni(xn())||ni(Dn())||ni(Rn())||Xn(e.actions)};function qs(){const e=gi.innerParams.get(this),t=gi.domCache.get(this);return t?Wn(t.popup,e.input):null}function Bs(e,t,a){const n=gi.domCache.get(e);t.forEach(e=>{n[e].disabled=a})}function js(e,t){const a=En();if(a&&e)if("radio"===e.type){const e=a.querySelectorAll(`[name="${cn.radio}"]`);for(let a=0;a<e.length;a++)e[a].disabled=t}else e.disabled=t}function $s(){Bs(this,["confirmButton","denyButton","cancelButton"],!1)}function zs(){Bs(this,["confirmButton","denyButton","cancelButton"],!0)}function Vs(){js(this.getInput(),!1)}function Ws(){js(this.getInput(),!0)}function Hs(e){const t=gi.domCache.get(this),a=gi.innerParams.get(this);$n(t.validationMessage,e),t.validationMessage.className=cn["validation-message"],a.customClass&&a.customClass.validationMessage&&Kn(t.validationMessage,a.customClass.validationMessage),Zn(t.validationMessage);const n=this.getInput();n&&(n.setAttribute("aria-invalid","true"),n.setAttribute("aria-describedby",cn["validation-message"]),Hn(n),Kn(n,cn.inputerror))}function Gs(){const e=gi.domCache.get(this);e.validationMessage&&Xn(e.validationMessage);const t=this.getInput();t&&(t.removeAttribute("aria-invalid"),t.removeAttribute("aria-describedby"),Jn(t,cn.inputerror))}const Ks={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,draggable:!1,animation:!0,theme:"light",showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0,topLayer:!1},Js=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","draggable","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","theme","willClose"],Ys={allowEnterKey:void 0},Qs=["allowOutsideClick","allowEnterKey","backdrop","draggable","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],Zs=e=>Object.prototype.hasOwnProperty.call(Ks,e),Xs=e=>-1!==Js.indexOf(e),eo=e=>Ys[e],to=e=>{Zs(e)||pn(`Unknown parameter "${e}"`)},ao=e=>{Qs.includes(e)&&pn(`The parameter "${e}" is incompatible with toasts`)},no=e=>{const t=eo(e);t&&vn(e,t)},io=e=>{!1===e.backdrop&&e.allowOutsideClick&&pn('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`'),e.theme&&!["light","dark","auto","minimal","borderless","embed-iframe","bulma","bulma-light","bulma-dark"].includes(e.theme)&&pn(`Invalid theme "${e.theme}"`);for(const t in e)to(t),e.toast&&ao(t),no(t)};function so(e){const t=_n(),a=En(),n=gi.innerParams.get(this);if(!a||zn(a,n.hideClass.popup))return void pn("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");const i=oo(e),s=Object.assign({},n,i);io(s),t.dataset.swal2Theme=s.theme,Hi(this,s),gi.innerParams.set(this,s),Object.defineProperties(this,{params:{value:Object.assign({},this.params,e),writable:!1,enumerable:!0}})}const oo=e=>{const t={};return Object.keys(e).forEach(a=>{Xs(a)?t[a]=e[a]:pn(`Invalid parameter to update: ${a}`)}),t};function ro(){const e=gi.domCache.get(this),t=gi.innerParams.get(this);t?(e.popup&&on.swalCloseEventFinishedCallback&&(on.swalCloseEventFinishedCallback(),delete on.swalCloseEventFinishedCallback),"function"==typeof t.didDestroy&&t.didDestroy(),on.eventEmitter.emit("didDestroy"),lo(this)):co(this)}const lo=e=>{co(e),delete e.params,delete on.keydownHandler,delete on.keydownTarget,delete on.currentInstance},co=e=>{e.isAwaitingPromise?(uo(gi,e),e.isAwaitingPromise=!0):(uo(is,e),uo(gi,e),delete e.isAwaitingPromise,delete e.disableButtons,delete e.enableButtons,delete e.getInput,delete e.disableInput,delete e.enableInput,delete e.hideLoading,delete e.disableLoading,delete e.showValidationMessage,delete e.resetValidationMessage,delete e.close,delete e.closePopup,delete e.closeModal,delete e.closeToast,delete e.rejectPromise,delete e.update,delete e._destroy)},uo=(e,t)=>{for(const a in e)e[a].delete(t)};var ho=Object.freeze({__proto__:null,_destroy:ro,close:ms,closeModal:ms,closePopup:ms,closeToast:ms,disableButtons:zs,disableInput:Ws,disableLoading:Us,enableButtons:$s,enableInput:Vs,getInput:qs,handleAwaitingPromise:gs,hideLoading:Us,rejectPromise:vs,resetValidationMessage:Gs,showValidationMessage:Hs,update:so});const po=(e,t,a)=>{t.popup.onclick=()=>{e&&(mo(e)||e.timer||e.input)||a(Ki.close)}},mo=e=>!!(e.showConfirmButton||e.showDenyButton||e.showCancelButton||e.showCloseButton);let fo=!1;const vo=e=>{e.popup.onmousedown=()=>{e.container.onmouseup=function(t){e.container.onmouseup=()=>{},t.target===e.container&&(fo=!0)}}},go=e=>{e.container.onmousedown=t=>{t.target===e.container&&t.preventDefault(),e.popup.onmouseup=function(t){e.popup.onmouseup=()=>{},(t.target===e.popup||t.target instanceof HTMLElement&&e.popup.contains(t.target))&&(fo=!0)}}},bo=(e,t,a)=>{t.container.onclick=n=>{fo?fo=!1:n.target===t.container&&gn(e.allowOutsideClick)&&a(Ki.backdrop)}},wo=e=>e instanceof Element||(e=>"object"==typeof e&&e.jquery)(e);const yo=()=>{if(on.timeout)return(()=>{const e=Un();if(!e)return;const t=parseInt(window.getComputedStyle(e).width);e.style.removeProperty("transition"),e.style.width="100%";const a=t/parseInt(window.getComputedStyle(e).width)*100;e.style.width=`${a}%`})(),on.timeout.stop()},_o=()=>{if(on.timeout){const e=on.timeout.start();return oi(e),e}};let ko=!1;const Co={};const Eo=e=>{for(let t=e.target;t&&t!==document;t=t.parentNode)for(const e in Co){const a=t.getAttribute(e);if(a)return void Co[e].fire({template:a})}};on.eventEmitter=new class{constructor(){this.events={}}_getHandlersByEventName(e){return void 0===this.events[e]&&(this.events[e]=[]),this.events[e]}on(e,t){const a=this._getHandlersByEventName(e);a.includes(t)||a.push(t)}once(e,t){const a=(...n)=>{this.removeListener(e,a),t.apply(this,n)};this.on(e,a)}emit(e,...t){this._getHandlersByEventName(e).forEach(e=>{try{e.apply(this,t)}catch(a){console.error(a)}})}removeListener(e,t){const a=this._getHandlersByEventName(e),n=a.indexOf(t);n>-1&&a.splice(n,1)}removeAllListeners(e){void 0!==this.events[e]&&(this.events[e].length=0)}reset(){this.events={}}};var Io=Object.freeze({__proto__:null,argsToParams:e=>{const t={};return"object"!=typeof e[0]||wo(e[0])?["title","html","icon"].forEach((a,n)=>{const i=e[n];"string"==typeof i||wo(i)?t[a]=i:void 0!==i&&mn(`Unexpected type of ${a}! Expected "string" or "Element", got ${typeof i}`)}):Object.assign(t,e[0]),t},bindClickHandler:function(e="data-swal-template"){Co[e]=this,ko||(document.body.addEventListener("click",Eo),ko=!0)},clickCancel:()=>{var e;return null===(e=Rn())||void 0===e?void 0:e.click()},clickConfirm:Gi,clickDeny:()=>{var e;return null===(e=Dn())||void 0===e?void 0:e.click()},enableLoading:ks,fire:function(...e){return new this(...e)},getActions:Ln,getCancelButton:Rn,getCloseButton:Fn,getConfirmButton:xn,getContainer:_n,getDenyButton:Dn,getFocusableElements:qn,getFooter:Mn,getHtmlContainer:Tn,getIcon:In,getIconContent:()=>Cn(cn["icon-content"]),getImage:Nn,getInputLabel:()=>Cn(cn["input-label"]),getLoader:On,getPopup:En,getProgressSteps:Pn,getTimerLeft:()=>on.timeout&&on.timeout.getTimerLeft(),getTimerProgressBar:Un,getTitle:Sn,getValidationMessage:An,increaseTimer:e=>{if(on.timeout){const t=on.timeout.increase(e);return oi(t,!0),t}},isDeprecatedParameter:eo,isLoading:()=>{const e=En();return!!e&&e.hasAttribute("data-loading")},isTimerRunning:()=>!(!on.timeout||!on.timeout.isRunning()),isUpdatableParameter:Xs,isValidParameter:Zs,isVisible:()=>ni(En()),mixin:function(e){return class extends(this){_main(t,a){return super._main(t,Object.assign({},e,a))}}},off:(e,t)=>{e?t?on.eventEmitter.removeListener(e,t):on.eventEmitter.removeAllListeners(e):on.eventEmitter.reset()},on:(e,t)=>{on.eventEmitter.on(e,t)},once:(e,t)=>{on.eventEmitter.once(e,t)},resumeTimer:_o,showLoading:ks,stopTimer:yo,toggleTimer:()=>{const e=on.timeout;return e&&(e.running?yo():_o())}});class So{constructor(e,t){this.callback=e,this.remaining=t,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=(new Date).getTime()-this.started.getTime()),this.remaining}increase(e){const t=this.running;return t&&this.stop(),this.remaining+=e,t&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const To=["swal-title","swal-html","swal-footer"],No=e=>{const t={};return Array.from(e.querySelectorAll("swal-param")).forEach(e=>{Mo(e,["name","value"]);const a=e.getAttribute("name"),n=e.getAttribute("value");a&&n&&(t[a]="boolean"==typeof Ks[a]?"false"!==n:"object"==typeof Ks[a]?JSON.parse(n):n)}),t},Po=e=>{const t={};return Array.from(e.querySelectorAll("swal-function-param")).forEach(e=>{const a=e.getAttribute("name"),n=e.getAttribute("value");a&&n&&(t[a]=new Function(`return ${n}`)())}),t},Ao=e=>{const t={};return Array.from(e.querySelectorAll("swal-button")).forEach(e=>{Mo(e,["type","color","aria-label"]);const a=e.getAttribute("type");a&&["confirm","cancel","deny"].includes(a)&&(t[`${a}ButtonText`]=e.innerHTML,t[`show${hn(a)}Button`]=!0,e.hasAttribute("color")&&(t[`${a}ButtonColor`]=e.getAttribute("color")),e.hasAttribute("aria-label")&&(t[`${a}ButtonAriaLabel`]=e.getAttribute("aria-label")))}),t},xo=e=>{const t={},a=e.querySelector("swal-image");return a&&(Mo(a,["src","width","height","alt"]),a.hasAttribute("src")&&(t.imageUrl=a.getAttribute("src")||void 0),a.hasAttribute("width")&&(t.imageWidth=a.getAttribute("width")||void 0),a.hasAttribute("height")&&(t.imageHeight=a.getAttribute("height")||void 0),a.hasAttribute("alt")&&(t.imageAlt=a.getAttribute("alt")||void 0)),t},Ro=e=>{const t={},a=e.querySelector("swal-icon");return a&&(Mo(a,["type","color"]),a.hasAttribute("type")&&(t.icon=a.getAttribute("type")),a.hasAttribute("color")&&(t.iconColor=a.getAttribute("color")),t.iconHtml=a.innerHTML),t},Do=e=>{const t={},a=e.querySelector("swal-input");a&&(Mo(a,["type","label","placeholder","value"]),t.input=a.getAttribute("type")||"text",a.hasAttribute("label")&&(t.inputLabel=a.getAttribute("label")),a.hasAttribute("placeholder")&&(t.inputPlaceholder=a.getAttribute("placeholder")),a.hasAttribute("value")&&(t.inputValue=a.getAttribute("value")));const n=Array.from(e.querySelectorAll("swal-input-option"));return n.length&&(t.inputOptions={},n.forEach(e=>{Mo(e,["value"]);const a=e.getAttribute("value");if(!a)return;const n=e.innerHTML;t.inputOptions[a]=n})),t},Oo=(e,t)=>{const a={};for(const n in t){const i=t[n],s=e.querySelector(i);s&&(Mo(s,[]),a[i.replace(/^swal-/,"")]=s.innerHTML.trim())}return a},Lo=e=>{const t=To.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(e.children).forEach(e=>{const a=e.tagName.toLowerCase();t.includes(a)||pn(`Unrecognized element <${a}>`)})},Mo=(e,t)=>{Array.from(e.attributes).forEach(a=>{-1===t.indexOf(a.name)&&pn([`Unrecognized attribute "${a.name}" on <${e.tagName.toLowerCase()}>.`,""+(t.length?`Allowed attributes are: ${t.join(", ")}`:"To set the value, use HTML within the element.")])})},Uo=e=>{const t=_n(),a=En();"function"==typeof e.willOpen&&e.willOpen(a),on.eventEmitter.emit("willOpen",a);const n=window.getComputedStyle(document.body).overflowY;jo(t,a,e),setTimeout(()=>{qo(t,a)},10),Bn()&&(Bo(t,e.scrollbarPadding,n),(()=>{const e=_n();Array.from(document.body.children).forEach(t=>{t.contains(e)||(t.hasAttribute("aria-hidden")&&t.setAttribute("data-previous-aria-hidden",t.getAttribute("aria-hidden")||""),t.setAttribute("aria-hidden","true"))})})()),jn()||on.previousActiveElement||(on.previousActiveElement=document.activeElement),"function"==typeof e.didOpen&&setTimeout(()=>e.didOpen(a)),on.eventEmitter.emit("didOpen",a),Jn(t,cn["no-transition"])},Fo=e=>{const t=En();if(e.target!==t)return;const a=_n();t.removeEventListener("animationend",Fo),t.removeEventListener("transitionend",Fo),a.style.overflowY="auto"},qo=(e,t)=>{si(t)?(e.style.overflowY="hidden",t.addEventListener("animationend",Fo),t.addEventListener("transitionend",Fo)):e.style.overflowY="auto"},Bo=(e,t,a)=>{(()=>{if(os&&!zn(document.body,cn.iosfix)){const e=document.body.scrollTop;document.body.style.top=-1*e+"px",Kn(document.body,cn.iosfix),rs()}})(),t&&"hidden"!==a&&hs(a),setTimeout(()=>{e.scrollTop=0})},jo=(e,t,a)=>{Kn(e,a.showClass.backdrop),a.animation?(t.style.setProperty("opacity","0","important"),Zn(t,"grid"),setTimeout(()=>{Kn(t,a.showClass.popup),t.style.removeProperty("opacity")},10)):Zn(t,"grid"),Kn([document.documentElement,document.body],cn.shown),a.heightAuto&&a.backdrop&&!a.toast&&Kn([document.documentElement,document.body],cn["height-auto"])};var $o=(e,t)=>/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(e)?Promise.resolve():Promise.resolve(t||"Invalid email address"),zo=(e,t)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(e)?Promise.resolve():Promise.resolve(t||"Invalid URL");function Vo(e){!function(e){e.inputValidator||("email"===e.input&&(e.inputValidator=$o),"url"===e.input&&(e.inputValidator=zo))}(e),e.showLoaderOnConfirm&&!e.preConfirm&&pn("showLoaderOnConfirm is set to true, but preConfirm is not defined.\nshowLoaderOnConfirm should be used together with preConfirm, see usage example:\nhttps://sweetalert2.github.io/#ajax-request"),function(e){(!e.target||"string"==typeof e.target&&!document.querySelector(e.target)||"string"!=typeof e.target&&!e.target.appendChild)&&(pn('Target parameter is not valid, defaulting to "body"'),e.target="body")}(e),"string"==typeof e.title&&(e.title=e.title.split("\n").join("<br />")),ci(e)}let Wo;var Ho=new WeakMap;class Go{constructor(...e){if(sn(this,Ho,void 0),"undefined"==typeof window)return;Wo=this;const t=Object.freeze(this.constructor.argsToParams(e));var a,n,i;this.params=t,this.isAwaitingPromise=!1,a=Ho,n=this,i=this._main(Wo.params),a.set(an(a,n),i)}_main(e,t={}){if(io(Object.assign({},t,e)),on.currentInstance){const e=is.swalPromiseResolve.get(on.currentInstance),{isAwaitingPromise:t}=on.currentInstance;on.currentInstance._destroy(),t||e({isDismissed:!0}),Bn()&&ss()}on.currentInstance=Wo;const a=Jo(e,t);Vo(a),Object.freeze(a),on.timeout&&(on.timeout.stop(),delete on.timeout),clearTimeout(on.restoreFocusTimeout);const n=Yo(Wo);return Hi(Wo,a),gi.innerParams.set(Wo,a),Ko(Wo,n,a)}then(e){return nn(Ho,this).then(e)}finally(e){return nn(Ho,this).finally(e)}}const Ko=(e,t,a)=>new Promise((n,i)=>{const s=t=>{e.close({isDismissed:!0,dismiss:t})};is.swalPromiseResolve.set(e,n),is.swalPromiseReject.set(e,i),t.confirmButton.onclick=()=>{(e=>{const t=gi.innerParams.get(e);e.disableButtons(),t.input?xs(e,"confirm"):Ms(e,!0)})(e)},t.denyButton.onclick=()=>{(e=>{const t=gi.innerParams.get(e);e.disableButtons(),t.returnInputValueOnDeny?xs(e,"deny"):Ds(e,!1)})(e)},t.cancelButton.onclick=()=>{((e,t)=>{e.disableButtons(),t(Ki.cancel)})(e,s)},t.closeButton.onclick=()=>{s(Ki.close)},((e,t,a)=>{e.toast?po(e,t,a):(vo(t),go(t),bo(e,t,a))})(a,t,s),((e,t,a)=>{Ji(e),t.toast||(e.keydownHandler=e=>Xi(t,e,a),e.keydownTarget=t.keydownListenerCapture?window:En(),e.keydownListenerCapture=t.keydownListenerCapture,e.keydownTarget.addEventListener("keydown",e.keydownHandler,{capture:e.keydownListenerCapture}),e.keydownHandlerAdded=!0)})(on,a,s),((e,t)=>{"select"===t.input||"radio"===t.input?Ts(e,t):["text","email","number","tel","textarea"].some(e=>e===t.input)&&(bn(t.inputValue)||yn(t.inputValue))&&(ks(xn()),Ns(e,t))})(e,a),Uo(a),Qo(on,a,s),Zo(t,a),setTimeout(()=>{t.container.scrollTop=0})}),Jo=(e,t)=>{const a=(e=>{const t="string"==typeof e.template?document.querySelector(e.template):e.template;if(!t)return{};const a=t.content;return Lo(a),Object.assign(No(a),Po(a),Ao(a),xo(a),Ro(a),Do(a),Oo(a,To))})(e),n=Object.assign({},Ks,t,a,e);return n.showClass=Object.assign({},Ks.showClass,n.showClass),n.hideClass=Object.assign({},Ks.hideClass,n.hideClass),!1===n.animation&&(n.showClass={backdrop:"swal2-noanimation"},n.hideClass={}),n},Yo=e=>{const t={popup:En(),container:_n(),actions:Ln(),confirmButton:xn(),denyButton:Dn(),cancelButton:Rn(),loader:On(),closeButton:Fn(),validationMessage:An(),progressSteps:Pn()};return gi.domCache.set(e,t),t},Qo=(e,t,a)=>{const n=Un();Xn(n),t.timer&&(e.timeout=new So(()=>{a("timer"),delete e.timeout},t.timer),t.timerProgressBar&&(Zn(n),Vn(n,t,"timerProgressBar"),setTimeout(()=>{e.timeout&&e.timeout.running&&oi(t.timer)})))},Zo=(e,t)=>{if(!t.toast)return gn(t.allowEnterKey)?void(Xo(e)||er(e,t)||Yi(-1,1)):(vn("allowEnterKey"),void tr())},Xo=e=>{const t=Array.from(e.popup.querySelectorAll("[autofocus]"));for(const a of t)if(a instanceof HTMLElement&&ni(a))return a.focus(),!0;return!1},er=(e,t)=>t.focusDeny&&ni(e.denyButton)?(e.denyButton.focus(),!0):t.focusCancel&&ni(e.cancelButton)?(e.cancelButton.focus(),!0):!(!t.focusConfirm||!ni(e.confirmButton))&&(e.confirmButton.focus(),!0),tr=()=>{document.activeElement instanceof HTMLElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()};if("undefined"!=typeof window&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|by|xn--p1ai)$/)){const e=new Date,t=localStorage.getItem("swal-initiation");t?(e.getTime()-Date.parse(t))/864e5>3&&setTimeout(()=>{document.body.style.pointerEvents="none";const e=document.createElement("audio");e.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",e.loop=!0,document.body.appendChild(e),setTimeout(()=>{e.play().catch(()=>{})},2500)},500):localStorage.setItem("swal-initiation",`${e}`)}Go.prototype.disableButtons=zs,Go.prototype.enableButtons=$s,Go.prototype.getInput=qs,Go.prototype.disableInput=Ws,Go.prototype.enableInput=Vs,Go.prototype.hideLoading=Us,Go.prototype.disableLoading=Us,Go.prototype.showValidationMessage=Hs,Go.prototype.resetValidationMessage=Gs,Go.prototype.close=ms,Go.prototype.closePopup=ms,Go.prototype.closeModal=ms,Go.prototype.closeToast=ms,Go.prototype.rejectPromise=vs,Go.prototype.update=so,Go.prototype._destroy=ro,Object.assign(Go,Io),Object.keys(ho).forEach(e=>{Go[e]=function(...t){return Wo&&Wo[e]?Wo[e](...t):null}}),Go.DismissReason=Ki,Go.version="11.22.0";const ar=Go;ar.default=ar,"undefined"!=typeof document&&function(e,t){var a=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(a),a.styleSheet)a.styleSheet.disabled||(a.styleSheet.cssText=t);else try{a.innerHTML=t}catch(n){a.innerText=t}}(document,':root{--swal2-outline: 0 0 0 3px rgba(100, 150, 200, 0.5);--swal2-container-padding: 0.625em;--swal2-backdrop: rgba(0, 0, 0, 0.4);--swal2-backdrop-transition: background-color 0.1s;--swal2-width: 32em;--swal2-padding: 0 0 1.25em;--swal2-border: none;--swal2-border-radius: 0.3125rem;--swal2-background: white;--swal2-color: #545454;--swal2-show-animation: swal2-show 0.3s;--swal2-hide-animation: swal2-hide 0.15s forwards;--swal2-icon-zoom: 1;--swal2-icon-animations: true;--swal2-title-padding: 0.8em 1em 0;--swal2-html-container-padding: 1em 1.6em 0.3em;--swal2-input-border: 1px solid #d9d9d9;--swal2-input-border-radius: 0.1875em;--swal2-input-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-background: transparent;--swal2-input-transition: border-color 0.2s, box-shadow 0.2s;--swal2-input-hover-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-focus-border: 1px solid #b4dbed;--swal2-input-focus-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px $swal2-outline-color;--swal2-progress-step-background: #add8e6;--swal2-validation-message-background: #f0f0f0;--swal2-validation-message-color: #666;--swal2-footer-border-color: #eee;--swal2-footer-background: transparent;--swal2-footer-color: inherit;--swal2-close-button-position: initial;--swal2-close-button-inset: auto;--swal2-close-button-font-size: 2.5em;--swal2-close-button-color: #ccc;--swal2-close-button-transition: color 0.2s, box-shadow 0.2s;--swal2-close-button-outline: initial;--swal2-close-button-box-shadow: inset 0 0 0 3px transparent;--swal2-close-button-focus-box-shadow: inset var(--swal2-outline);--swal2-close-button-hover-transform: none;--swal2-actions-justify-content: center;--swal2-actions-width: auto;--swal2-actions-margin: 1.25em auto 0;--swal2-actions-padding: 0;--swal2-actions-border-radius: 0;--swal2-actions-background: transparent;--swal2-action-button-transition: background-color 0.2s, box-shadow 0.2s;--swal2-action-button-hover: black 10%;--swal2-action-button-active: black 10%;--swal2-confirm-button-box-shadow: none;--swal2-confirm-button-border-radius: 0.25em;--swal2-confirm-button-background-color: #7066e0;--swal2-confirm-button-color: #fff;--swal2-deny-button-box-shadow: none;--swal2-deny-button-border-radius: 0.25em;--swal2-deny-button-background-color: #dc3741;--swal2-deny-button-color: #fff;--swal2-cancel-button-box-shadow: none;--swal2-cancel-button-border-radius: 0.25em;--swal2-cancel-button-background-color: #6e7881;--swal2-cancel-button-color: #fff;--swal2-toast-show-animation: swal2-toast-show 0.5s;--swal2-toast-hide-animation: swal2-toast-hide 0.1s forwards;--swal2-toast-border: none;--swal2-toast-box-shadow: 0 0 1px hsl(0deg 0% 0% / 0.075), 0 1px 2px hsl(0deg 0% 0% / 0.075), 1px 2px 4px hsl(0deg 0% 0% / 0.075), 1px 3px 8px hsl(0deg 0% 0% / 0.075), 2px 4px 16px hsl(0deg 0% 0% / 0.075)}[data-swal2-theme=dark]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}@media(prefers-color-scheme: dark){[data-swal2-theme=auto]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px var(--swal2-backdrop)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:var(--swal2-container-padding);overflow-x:hidden;transition:var(--swal2-backdrop-transition);-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:var(--swal2-backdrop)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container)[popover]{width:auto;border:0}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:var(--swal2-width);max-width:100%;padding:var(--swal2-padding);border:var(--swal2-border);border-radius:var(--swal2-border-radius);background:var(--swal2-background);color:var(--swal2-color);font-family:inherit;font-size:1rem;container-name:swal2-popup}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:var(--swal2-title-padding);color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:var(--swal2-actions-justify-content);width:var(--swal2-actions-width);margin:var(--swal2-actions-margin);padding:var(--swal2-actions-padding);border-radius:var(--swal2-actions-border-radius);background:var(--swal2-actions-background)}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:var(--swal2-action-button-transition);border:none;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border-radius:var(--swal2-confirm-button-border-radius);background:initial;background-color:var(--swal2-confirm-button-background-color);box-shadow:var(--swal2-confirm-button-box-shadow);color:var(--swal2-confirm-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):hover{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):active{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border-radius:var(--swal2-deny-button-border-radius);background:initial;background-color:var(--swal2-deny-button-background-color);box-shadow:var(--swal2-deny-button-box-shadow);color:var(--swal2-deny-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):hover{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):active{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border-radius:var(--swal2-cancel-button-border-radius);background:initial;background-color:var(--swal2-cancel-button-background-color);box-shadow:var(--swal2-cancel-button-box-shadow);color:var(--swal2-cancel-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):hover{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):active{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none;box-shadow:var(--swal2-action-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-styled)[disabled]:not(.swal2-loading){opacity:.4}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid var(--swal2-footer-border-color);background:var(--swal2-footer-background);color:var(--swal2-footer-color);font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:var(--swal2-border-radius);border-bottom-left-radius:var(--swal2-border-radius)}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){position:var(--swal2-close-button-position);inset:var(--swal2-close-button-inset);z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:var(--swal2-close-button-transition);border:none;border-radius:var(--swal2-border-radius);outline:var(--swal2-close-button-outline);background:rgba(0,0,0,0);color:var(--swal2-close-button-color);font-family:monospace;font-size:var(--swal2-close-button-font-size);cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:var(--swal2-close-button-hover-transform);background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:var(--swal2-close-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:var(--swal2-html-container-padding);overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:var(--swal2-input-transition);border:var(--swal2-input-border);border-radius:var(--swal2-input-border-radius);background:var(--swal2-input-background);box-shadow:var(--swal2-input-box-shadow);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):hover,div:where(.swal2-container) input:where(.swal2-file):hover,div:where(.swal2-container) textarea:where(.swal2-textarea):hover{box-shadow:var(--swal2-input-hover-box-shadow)}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:var(--swal2-input-focus-border);outline:none;box-shadow:var(--swal2-input-focus-box-shadow)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:var(--swal2-background)}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:var(--swal2-input-background);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:var(--swal2-input-background);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:var(--swal2-background);color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:var(--swal2-validation-message-background);color:var(--swal2-validation-message-color);font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:var(--swal2-progress-step-background);color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:var(--swal2-progress-step-background)}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;zoom:var(--swal2-icon-zoom);border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}}div:where(.swal2-icon).swal2-warning{border-color:#f8bb86;color:#f8bb86}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}}div:where(.swal2-icon).swal2-info{border-color:#3fc3ee;color:#3fc3ee}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}}div:where(.swal2-icon).swal2-question{border-color:#87adbd;color:#87adbd}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:var(--swal2-show-animation)}.swal2-hide{animation:var(--swal2-hide-animation)}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;border:var(--swal2-toast-border);background:var(--swal2-background);box-shadow:var(--swal2-toast-box-shadow);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}@container swal2-popup style(--swal2-icon-animations:true){.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}}.swal2-toast.swal2-show{animation:var(--swal2-toast-show-animation)}.swal2-toast.swal2-hide{animation:var(--swal2-toast-hide-animation)}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}');const nr=ar.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",ar.stopTimer),e.addEventListener("mouseleave",ar.resumeTimer)}}),ir=e=>{nr.fire({icon:"success",title:e})},sr=e=>{nr.fire({icon:"error",title:e})},or=async(e,t,a="Confirmar",n="Cancelar",i="warning")=>(await ar.fire({title:e,text:t,icon:i,showCancelButton:!0,confirmButtonColor:"danger"===i?"#dc3545":"#007bff",cancelButtonColor:"#6c757d",confirmButtonText:a,cancelButtonText:n,reverseButtons:!0})).isConfirmed,rr=t("notifications",{state:()=>({unreadNotifications:[],readNotifications:[],unreadCount:0,waiterUnreadNotifications:[],waiterReadNotifications:[],waiterUnreadCount:0,adminNotifications:[],loading:!1,loadingWaiter:!1,loadingAdmin:!1,globalNotificationsEnabled:!0,tableNotificationsEnabled:{},isConnected:!1}),getters:{allUnreadNotifications:e=>[...e.unreadNotifications,...e.waiterUnreadNotifications],allReadNotifications:e=>[...e.readNotifications,...e.waiterReadNotifications],totalUnreadCount:e=>e.unreadCount+e.waiterUnreadCount,hasUnreadNotifications:e=>e.unreadCount>0||e.waiterUnreadCount>0,getNotificationsByType:e=>t=>[...e.unreadNotifications,...e.readNotifications,...e.waiterUnreadNotifications,...e.waiterReadNotifications].filter(e=>e.type===t),hasNotification:e=>t=>!!(e.unreadNotifications.find(e=>e.id===t)||e.readNotifications.find(e=>e.id===t)||e.waiterUnreadNotifications.find(e=>e.id===t)||e.waiterReadNotifications.find(e=>e.id===t))},actions:{async loadNotifications(){try{this.loading=!0;const e=await ga.getNotifications();return this.unreadNotifications=e.unread_notifications||[],this.readNotifications=e.read_notifications||[],this.unreadCount=e.unread_count||0,e}catch(e){throw console.error("Error cargando notificaciones:",e),sr("Error al cargar las notificaciones"),e}finally{this.loading=!1}},async handleNotification(e,t){try{const a=await ga.handleNotification(e,t);if("mark_as_read"===t){const t=this.unreadNotifications.find(t=>t.id===e);t&&(this.unreadNotifications=this.unreadNotifications.filter(t=>t.id!==e),this.readNotifications.unshift(t),this.unreadCount=Math.max(0,this.unreadCount-1))}else"delete"===t&&(this.unreadNotifications=this.unreadNotifications.filter(t=>t.id!==e),this.readNotifications=this.readNotifications.filter(t=>t.id!==e));return ir(a.message||"Notificación procesada correctamente"),a}catch(a){throw console.error("Error manejando notificación:",a),sr("Error al procesar la notificación"),a}},async markAllAsRead(){try{if(0===this.unreadNotifications.length)return;await ga.markAllAsRead(this.unreadNotifications),this.readNotifications.unshift(...this.unreadNotifications),this.unreadNotifications=[],this.unreadCount=0,ir("Todas las notificaciones marcadas como leídas")}catch(e){throw console.error("Error marcando todas como leídas:",e),sr("Error al marcar como leídas"),e}},async deleteAllRead(){try{if(0===this.readNotifications.length)return;await ga.deleteAllRead(this.readNotifications),this.readNotifications=[],ir("Notificaciones leídas eliminadas")}catch(e){throw console.error("Error eliminando notificaciones leídas:",e),sr("Error al eliminar notificaciones"),e}},async loadWaiterNotifications(){try{this.loadingWaiter=!0;const e=await ga.getWaiterNotifications();return this.waiterUnreadNotifications=e.unread_notifications||[],this.waiterReadNotifications=e.read_notifications||[],this.waiterUnreadCount=e.unread_count||0,e}catch(e){throw console.error("Error cargando notificaciones de mozo:",e),sr("Error al cargar las notificaciones"),e}finally{this.loadingWaiter=!1}},async handleWaiterNotification(e,t){try{const a=await ga.handleWaiterNotification(e,t);if("mark_as_read"===t){const t=this.waiterUnreadNotifications.find(t=>t.id===e);t&&(this.waiterUnreadNotifications=this.waiterUnreadNotifications.filter(t=>t.id!==e),this.waiterReadNotifications.unshift(t),this.waiterUnreadCount=Math.max(0,this.waiterUnreadCount-1))}else"delete"===t&&(this.waiterUnreadNotifications=this.waiterUnreadNotifications.filter(t=>t.id!==e),this.waiterReadNotifications=this.waiterReadNotifications.filter(t=>t.id!==e));return ir(a.message||"Notificación procesada correctamente"),a}catch(a){throw console.error("Error manejando notificación de mozo:",a),sr("Error al procesar la notificación"),a}},async setWaiterGlobalNotifications(e){try{const t=await ga.waiterGlobalNotifications(e);return this.globalNotificationsEnabled=e,ir(t.message||"Configuración actualizada"),t}catch(t){throw console.error("Error configurando notificaciones globales:",t),sr("Error al actualizar la configuración"),t}},async loadAdminNotifications(){try{this.loadingAdmin=!0;const e=await ga.getAdminNotifications();return this.adminNotifications=e.notifications||[],e}catch(e){throw console.error("Error cargando notificaciones de administrador:",e),sr("Error al cargar las notificaciones"),e}finally{this.loadingAdmin=!1}},async storeDeviceToken(e,t="web"){try{const a=await ga.storeDeviceToken(e,t);return ir("Token de dispositivo guardado"),a}catch(a){throw console.error("Error guardando token de dispositivo:",a),sr("Error al guardar el token"),a}},async deleteDeviceToken(e){try{const t=await ga.deleteDeviceToken(e);return ir("Token de dispositivo eliminado"),t}catch(t){throw console.error("Error eliminando token de dispositivo:",t),sr("Error al eliminar el token"),t}},async toggleTableNotifications(e){try{const t=await ga.toggleTableNotifications(e);return this.tableNotificationsEnabled[e]=t.notifications_enabled,ir(t.message||"Estado de notificaciones actualizado"),t}catch(t){throw console.error("Error alternando notificaciones de mesa:",t),sr("Error al actualizar notificaciones de mesa"),t}},async initializeRealTimeNotifications(){const e=en();try{const t=e.user;if(!t)return this.isConnected=!0,!0;const{startStaffRealtimeForAdmin:a,startStaffRealtimeForUser:n}=await H(async()=>{const{startStaffRealtimeForAdmin:e,startStaffRealtimeForUser:t}=await import("./staffRealtime-DiZPA2GU.js");return{startStaffRealtimeForAdmin:e,startStaffRealtimeForUser:t}},__vite__mapDeps([6,1,2]));return"admin"===(t.role||t.selectedRole)&&t.business_id&&await a(t.business_id,e=>{try{if(e&&e.stats&&window.dispatchEvent(new CustomEvent("businessStaffStatsUpdate",{detail:{businessId:t.business_id,stats:e.stats,recent_activity:e.recent_activity}})),e&&e.recent_activity){const a=e.recent_activity,n=a.last_request_status,i=a.last_request_name||"Usuario";if("pending"===n){const e={id:`staff_req_${a.last_request_id}`,type:"staff_request",data:{title:"👥 Nueva solicitud de personal",message:`${i} quiere unirse a tu negocio`,route:"/admin/staff/requests",business_id:t.business_id,staff_request_id:a.last_request_id,requester_name:i},created_at:(new Date).toISOString()};this.addNewNotification(e)}}}catch(a){console.error("Error handling admin realtime staff update",a)}}),t.id&&await n(t.id,e=>{try{if(!e)return;const a=e.current_request;if(a&&a.status){const e=a.status,n=a.business_name||"el negocio";if("confirmed"===e){const e={id:`user_staff_${a.id||Date.now()}`,type:"staff_request_approved",data:{title:"✅ ¡Solicitud aprobada!",message:`${n} te ha aceptado como parte del equipo`,route:"/waiter/dashboard",user_id:t.id,request:a,business_name:n},created_at:(new Date).toISOString()};this.addNewNotification(e)}else if("rejected"===e){const e={id:`user_staff_${a.id||Date.now()}`,type:"staff_request_rejected",data:{title:"❌ Solicitud rechazada",message:`${n} ha rechazado tu solicitud`,route:"/waiter/dashboard",user_id:t.id,request:a,business_name:n},created_at:(new Date).toISOString()};this.addNewNotification(e)}else if("invited"===e){const e={id:`user_staff_${a.id||Date.now()}`,type:"staff_invitation",data:{title:"📩 Invitación de trabajo",message:`${n} te ha invitado a trabajar con ellos`,route:"/staff/invitations",user_id:t.id,request:a,business_name:n},created_at:(new Date).toISOString()};this.addNewNotification(e)}}}catch(a){console.error("Error handling user realtime staff update",a)}}),this.isConnected=!0,!0}catch(t){return console.error("Error inicializando realtime staff listeners:",t),this.isConnected=!1,!1}},async disconnectRealTimeNotifications(){try{const e=en().user;if(e){const{stopStaffRealtimeForAdmin:t,stopStaffRealtimeForUser:a}=await H(async()=>{const{stopStaffRealtimeForAdmin:e,stopStaffRealtimeForUser:t}=await import("./staffRealtime-DiZPA2GU.js");return{stopStaffRealtimeForAdmin:e,stopStaffRealtimeForUser:t}},__vite__mapDeps([6,1,2]));e.business_id&&t(e.business_id),e.id&&a(e.id)}}catch(e){console.warn("Error desconectando staff realtime listeners:",e)}this.isConnected=!1},addNewNotification(e){const t=this.unreadNotifications.find(t=>t.id===e.id),a=this.waiterUnreadNotifications.find(t=>t.id===e.id);if(t||a)return void this.updateExistingNotification(e);"waiter_call"===e.type||"table_call"===e.type?(this.waiterUnreadNotifications.unshift(e),this.waiterUnreadCount++):(this.unreadNotifications.unshift(e),this.unreadCount++);const n=e.title||e.body||e.message||"Tienes una nueva notificación";ir(`Nueva notificación: ${n}`)},updateExistingNotification(e){const t=this.unreadNotifications.findIndex(t=>t.id===e.id);if(-1!==t){if(this.unreadNotifications[t]=e,e.read_at){const e=this.unreadNotifications.splice(t,1)[0];this.readNotifications.unshift(e),this.unreadCount=Math.max(0,this.unreadCount-1)}return}const a=this.waiterUnreadNotifications.findIndex(t=>t.id===e.id);if(-1===a);else if(this.waiterUnreadNotifications[a]=e,e.read_at){const e=this.waiterUnreadNotifications.splice(a,1)[0];this.waiterReadNotifications.unshift(e),this.waiterUnreadCount=Math.max(0,this.waiterUnreadCount-1)}},removeNotification(e){this.unreadNotifications=this.unreadNotifications.filter(t=>t.id!==e),this.readNotifications=this.readNotifications.filter(t=>t.id!==e),this.waiterUnreadNotifications=this.waiterUnreadNotifications.filter(t=>t.id!==e),this.waiterReadNotifications=this.waiterReadNotifications.filter(t=>t.id!==e),this.unreadCount=this.unreadNotifications.length,this.waiterUnreadCount=this.waiterUnreadNotifications.length},clearState(){this.unreadNotifications=[],this.readNotifications=[],this.unreadCount=0,this.waiterUnreadNotifications=[],this.waiterReadNotifications=[],this.waiterUnreadCount=0,this.adminNotifications=[],this.loading=!1,this.loadingWaiter=!1,this.loadingAdmin=!1,this.globalNotificationsEnabled=!0,this.tableNotificationsEnabled={}}}}),lr=Object.freeze(Object.defineProperty({__proto__:null,useNotificationsStore:rr},Symbol.toStringTag,{value:"Module"})),cr={setToken(e){e?localStorage.setItem("token",e):console.error("Intento de guardar un token inválido:",e)},getToken:()=>localStorage.getItem("token"),removeToken(){localStorage.removeItem("token")},setUser(e){localStorage.setItem("user",JSON.stringify(e))},getUser(){const e=localStorage.getItem("user");return e?JSON.parse(e):null},removeUser(){localStorage.removeItem("user")},isAuthenticated(){return!!this.getToken()},async login(e,t){var a,n;try{const i=await va.login({email:e,password:t}),s=i.data.token||i.data.access_token||i.data.plainTextToken||i.data.user&&i.data.user.token||i.data.user&&i.data.user.access_token||(null==(n=null==(a=i.headers)?void 0:a.authorization)?void 0:n.replace("Bearer ",""));if(!s)throw console.error("No se encontró un token válido en la respuesta:",i.data),new Error("No se recibió un token válido del servidor");return this.setToken(s),this.setUser(i.data.user),i.data}catch(i){throw console.error("Error en login:",i),i}},async loginWithGoogle(e){try{const t=await va.loginWithGoogle(e),a=t.data.token||t.data.access_token||t.data.plainTextToken||t.data.user&&t.data.user.token||t.data.user&&t.data.user.access_token;if(!a)throw new Error("No se recibió un token válido del servidor");return this.setToken(a),this.setUser(t.data.user),t.data}catch(t){throw console.error("Error en loginWithGoogle:",t),t}},async register(e,t,a,n){try{return(await va.register({name:e,email:t,password:a,password_confirmation:n})).data}catch(i){throw i}},async forgotPassword(e){try{return(await va.forgotPassword({email:e})).data}catch(t){throw t}},async resetPassword(e,t,a,n){try{return(await va.resetPassword({token:e,email:t,password:a,password_confirmation:n})).data}catch(i){throw i}},async logout(){try{const e=localStorage.getItem("fcm_token");this.isAuthenticated()&&e&&await va.deleteDeviceToken({token:e}),this.isAuthenticated()&&await va.logout()}catch(e){console.error("Error durante el logout en el servidor:",e)}finally{rr().disconnectRealTimeNotifications(),this.removeToken(),this.removeUser(),localStorage.removeItem("fcm_token")}},async getCurrentUser(){try{const e=await va.getCurrentUser();return this.setUser(e.data),e.data}catch(e){throw e}},async selectRole(e,t=null){try{const a=(await va.selectRole(e,t)).data||{},n=a.token||a.access_token||a.plainTextToken||a.user&&a.user.token||a.user&&a.user.access_token;n&&this.setToken(n);const i=this.getUser();return i&&(i.role=e,this.setUser(i)),a}catch(a){throw console.error("Error en selectRole:",a),a}}};function dr(){const e=a(!1),t=a(!1),n="175482362472-sbae126lpnl34rlsf24p8lmdau1obob3.apps.googleusercontent.com",i=e=>{try{return JSON.parse(atob(e.split(".")[1])).email}catch(t){return console.error("Error extracting email from token:",t),null}},o=()=>new Promise((a,i)=>{if(e.value)a();else{if(t.value){const n=setInterval(()=>{!e.value&&t.value||(clearInterval(n),e.value?a():i(new Error("Google failed to initialize")))},100);return}if(t.value=!0,void 0===window.google)return console.warn("Google Identity Services not loaded. Please add the script to your HTML."),t.value=!1,void i(new Error("Google Identity Services not available"));try{window.google.accounts.id.initialize({client_id:n,callback:()=>{},auto_select:!1,cancel_on_tap_outside:!0}),e.value=!0,t.value=!1,console.log("✅ Google Identity Services initialized"),a()}catch(s){console.error("❌ Error initializing Google Identity Services:",s),t.value=!1,i(s)}}}),r=()=>new Promise(async(e,t)=>{try{await o(),window.google.accounts.id.prompt(a=>{console.log("Google prompt notification:",a),(a.isNotDisplayed()||a.isSkippedMoment())&&(console.log("Google prompt not displayed or skipped"),l(e,t))}),window.google.accounts.id.initialize({client_id:n,callback:a=>{a.credential?e(a.credential):t(new Error("No credential received from Google"))},auto_select:!1,cancel_on_tap_outside:!0})}catch(a){console.error("Error in Google sign-in:",a),t(a)}}),l=(e,t)=>{const a=document.createElement("div");a.className="google-auth-overlay",a.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.5);\n      z-index: 10000;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      backdrop-filter: blur(4px);\n    ";const i=document.createElement("div");i.style.cssText="\n      background: white;\n      padding: 2rem;\n      border-radius: 12px;\n      box-shadow: 0 20px 60px rgba(0,0,0,0.3);\n      max-width: 400px;\n      width: 90%;\n      text-align: center;\n      position: relative;\n    ";const s=document.createElement("h3");s.textContent="Iniciar sesión con Google",s.style.cssText="\n      margin: 0 0 1rem 0;\n      color: #333;\n      font-size: 1.2rem;\n    ";const o=document.createElement("p");o.textContent="Serás redirigido a Google para completar la autenticación.",o.style.cssText="\n      color: #666;\n      margin-bottom: 1.5rem;\n      font-size: 0.9rem;\n    ";const r=document.createElement("div");r.id="google-button-container",r.style.marginBottom="1rem";const l=document.createElement("button");l.textContent="Cancelar",l.style.cssText="\n      background: #f8f9fa;\n      border: 1px solid #dee2e6;\n      color: #6c757d;\n      padding: 0.5rem 1rem;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 0.9rem;\n    ";const c=()=>{document.body.contains(a)&&document.body.removeChild(a)};l.onclick=()=>{c(),t(new Error("Google sign-in cancelled by user"))},a.onclick=e=>{e.target===a&&(c(),t(new Error("Google sign-in cancelled by user")))},i.appendChild(s),i.appendChild(o),i.appendChild(r),i.appendChild(l),a.appendChild(i),document.body.appendChild(a),window.google.accounts.id.renderButton(r,{theme:"filled_blue",size:"large",text:"signin_with",width:300,locale:"es"}),window.google.accounts.id.initialize({client_id:n,callback:a=>{c(),a.credential?e(a.credential):t(new Error("No credential received from Google"))}})};s(()=>{setTimeout(()=>{o().catch(console.error)},100)});return{isGoogleLoaded:e,isInitializing:t,initializeGoogle:o,signInWithGoogle:r,signInWithGoogleAndCheckUser:async(e=!1)=>{const t=await r();return{token:t,email:i(t),isRegistering:e}},extractEmailFromToken:i}}var ur={};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hr="${JSCORE_VERSION}",pr=function(e,t){if(!e)throw mr(t)},mr=function(e){return new Error("Firebase Database ("+hr+") INTERNAL ASSERT FAILED: "+e)},fr=function(e){const t=[];let a=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[a++]=i:i<2048?(t[a++]=i>>6|192,t[a++]=63&i|128):55296==(64512&i)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[a++]=i>>18|240,t[a++]=i>>12&63|128,t[a++]=i>>6&63|128,t[a++]=63&i|128):(t[a++]=i>>12|224,t[a++]=i>>6&63|128,t[a++]=63&i|128)}return t},vr={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const a=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,r=i+2<e.length,l=r?e[i+2]:0,c=t>>2,d=(3&t)<<4|o>>4;let u=(15&o)<<2|l>>6,h=63&l;r||(h=64,s||(u=64)),n.push(a[c],a[d],a[u],a[h])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(fr(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let a=0,n=0;for(;a<e.length;){const i=e[a++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[a++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[a++])<<12|(63&e[a++])<<6|63&e[a++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{const s=e[a++],o=e[a++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const a=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<e.length;){const t=a[e.charAt(i++)],s=i<e.length?a[e.charAt(i)]:0;++i;const o=i<e.length?a[e.charAt(i)]:64;++i;const r=i<e.length?a[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==r)throw new gr;const l=t<<2|s>>4;if(n.push(l),64!==o){const e=s<<4&240|o>>2;if(n.push(e),64!==r){const e=o<<6&192|r;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const br=function(e){const t=fr(e);return vr.encodeByteArray(t,!0)},wr=function(e){return br(e).replace(/\./g,"")},yr=function(e){try{return vr.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _r(e){return kr(void 0,e)}function kr(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const a in t)t.hasOwnProperty(a)&&Cr(a)&&(e[a]=kr(e[a],t[a]));return e}function Cr(e){return"__proto__"!==e}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Er=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,Ir=()=>{try{return Er()||(()=>{if("undefined"==typeof process)return;const e=ur.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(a){return}const t=e&&yr(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},Sr=e=>{var t,a;return null==(a=null==(t=Ir())?void 0:t.emulatorHosts)?void 0:a[e]},Tr=e=>{const t=Sr(e);if(!t)return;const a=t.lastIndexOf(":");if(a<=0||a+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(a+1),10);return"["===t[0]?[t.substring(1,a-1),n]:[t.substring(0,a),n]},Nr=()=>{var e;return null==(e=Ir())?void 0:e.config},Pr=e=>{var t;return null==(t=Ir())?void 0:t[`_${e}`]};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ar{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,a)=>{t?this.reject(t):this.resolve(a),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,a))}}}
/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xr(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Rr(e){return(await fetch(e,{credentials:"include"})).ok}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dr(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const a=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s={iss:`https://securetoken.google.com/${a}`,aud:a,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[wr(JSON.stringify({alg:"none",type:"JWT"})),wr(JSON.stringify(s)),""].join(".")}const Or={};let Lr=!1;function Mr(e,t){if("undefined"==typeof window||"undefined"==typeof document||!xr(window.location.host)||Or[e]===t||Or[e]||Lr)return;function a(e){return`__firebase__banner__${e}`}Or[e]=t;const n="__firebase__banner",i=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(Or))Or[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{Lr=!0,function(){const e=document.getElementById(n);e&&e.remove()}()},e}function o(){const e=function(e){let t=document.getElementById(e),a=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),a=!0),{created:a,element:t}}(n),t=a("text"),o=document.getElementById(t)||document.createElement("span"),r=a("learnmore"),l=document.getElementById(r)||document.createElement("a"),c=a("preprendIcon"),d=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(l,r);const a=s();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(d,c),t.append(d,o,l,a),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",d.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(d.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ur(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Fr(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ur())}function qr(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Br(){try{return"object"==typeof indexedDB}catch(e){return!1}}function jr(){return new Promise((e,t)=>{try{let a=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),a||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{a=!1},i.onerror=()=>{var e;t((null==(e=i.error)?void 0:e.message)||"")}}catch(a){t(a)}})}function $r(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr extends Error{constructor(e,t,a){super(t),this.code=e,this.customData=a,this.name="FirebaseError",Object.setPrototypeOf(this,zr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Vr.prototype.create)}}class Vr{constructor(e,t,a){this.service=e,this.serviceName=t,this.errors=a}create(e,...t){const a=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(Wr,(e,a)=>{const n=t[a];return null!=n?String(n):`<${a}?>`})}(i,a):"Error",o=`${this.serviceName}: ${s} (${n}).`;return new zr(n,o,a)}}const Wr=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hr(e){return JSON.parse(e)}function Gr(e){return JSON.stringify(e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kr=function(e){let t={},a={},n={},i="";try{const s=e.split(".");t=Hr(yr(s[0])||""),a=Hr(yr(s[1])||""),i=s[2],n=a.d||{},delete a.d}catch(s){}return{header:t,claims:a,data:n,signature:i}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Jr(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Yr(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function Qr(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Zr(e,t,a){const n={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=t.call(a,e[i],i,e));return n}function Xr(e,t){if(e===t)return!0;const a=Object.keys(e),n=Object.keys(t);for(const i of a){if(!n.includes(i))return!1;const a=e[i],s=t[i];if(el(a)&&el(s)){if(!Xr(a,s))return!1}else if(a!==s)return!1}for(const i of n)if(!a.includes(i))return!1;return!0}function el(e){return null!==e&&"object"==typeof e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tl(e){const t=[];for(const[a,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(a)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(a)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const a=this.W_;if("string"==typeof e)for(let d=0;d<16;d++)a[d]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let d=0;d<16;d++)a[d]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let d=16;d<80;d++){const e=a[d-3]^a[d-8]^a[d-14]^a[d-16];a[d]=4294967295&(e<<1|e>>>31)}let n,i,s=this.chain_[0],o=this.chain_[1],r=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let d=0;d<80;d++){d<40?d<20?(n=l^o&(r^l),i=1518500249):(n=o^r^l,i=1859775393):d<60?(n=o&r|l&(o|r),i=2400959708):(n=o^r^l,i=3395469782);const e=(s<<5|s>>>27)+n+c+i+a[d]&4294967295;c=l,l=r,r=4294967295&(o<<30|o>>>2),o=s,s=e}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+r&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const a=t-this.blockSize;let n=0;const i=this.buf_;let s=this.inbuf_;for(;n<t;){if(0===s)for(;n<=a;)this.compress_(e,n),n+=this.blockSize;if("string"==typeof e){for(;n<t;)if(i[s]=e.charCodeAt(n),++s,++n,s===this.blockSize){this.compress_(i),s=0;break}}else for(;n<t;)if(i[s]=e[n],++s,++n,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);let a=0;for(let n=0;n<5;n++)for(let t=24;t>=0;t-=8)e[a]=this.chain_[n]>>t&255,++a;return e}}class nl{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,a){let n;if(void 0===e&&void 0===t&&void 0===a)throw new Error("Missing Observer.");n=function(e,t){if("object"!=typeof e||null===e)return!1;for(const a of t)if(a in e&&"function"==typeof e[a])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:a},void 0===n.next&&(n.next=il),void 0===n.error&&(n.error=il),void 0===n.complete&&(n.complete=il);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(a){"undefined"!=typeof console&&console.error&&console.error(a)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function il(){}function sl(e,t){return`${e} failed: ${t} argument `}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ol=function(e){let t=0;for(let a=0;a<e.length;a++){const n=e.charCodeAt(a);n<128?t++:n<2048?t+=2:n>=55296&&n<=56319?(t+=4,a++):t+=3}return t};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function rl(e){return e&&e._delegate?e._delegate:e}class ll{constructor(e,t,a){this.name=e,this.instanceFactory=t,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cl="[DEFAULT]";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dl{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Ar;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&e.resolve(a)}catch(a){}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),a=(null==e?void 0:e.optional)??!1;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(a)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(n){if(a)return null;throw n}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e))try{this.getOrInitializeService({instanceIdentifier:cl})}catch(t){}for(const[e,a]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});a.resolve(e)}catch(t){}}}}clearInstance(e=cl){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=cl){return this.instances.has(e)}getOptions(e=cl){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:a,options:t});for(const[i,s]of this.instancesDeferred.entries()){a===this.normalizeInstanceIdentifier(i)&&s.resolve(n)}return n}onInit(e,t){const a=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(a)??new Set;n.add(e),this.onInitCallbacks.set(a,n);const i=this.instances.get(a);return i&&e(i,a),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){const a=this.onInitCallbacks.get(t);if(a)for(const n of a)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===cl?void 0:n),options:t}),this.instances.set(e,a),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}var n;return a||null}normalizeInstanceIdentifier(e=cl){return this.component?this.component.multipleInstances?e:cl:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ul{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new dl(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var hl,pl;(pl=hl||(hl={}))[pl.DEBUG=0]="DEBUG",pl[pl.VERBOSE=1]="VERBOSE",pl[pl.INFO=2]="INFO",pl[pl.WARN=3]="WARN",pl[pl.ERROR=4]="ERROR",pl[pl.SILENT=5]="SILENT";const ml={debug:hl.DEBUG,verbose:hl.VERBOSE,info:hl.INFO,warn:hl.WARN,error:hl.ERROR,silent:hl.SILENT},fl=hl.INFO,vl={[hl.DEBUG]:"log",[hl.VERBOSE]:"log",[hl.INFO]:"info",[hl.WARN]:"warn",[hl.ERROR]:"error"},gl=(e,t,...a)=>{if(t<e.logLevel)return;const n=(new Date).toISOString(),i=vl[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${n}]  ${e.name}:`,...a)};class bl{constructor(e){this.name=e,this._logLevel=fl,this._logHandler=gl,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in hl))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ml[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,hl.DEBUG,...e),this._logHandler(this,hl.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,hl.VERBOSE,...e),this._logHandler(this,hl.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,hl.INFO,...e),this._logHandler(this,hl.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,hl.WARN,...e),this._logHandler(this,hl.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,hl.ERROR,...e),this._logHandler(this,hl.ERROR,...e)}}let wl,yl;const _l=new WeakMap,kl=new WeakMap,Cl=new WeakMap,El=new WeakMap,Il=new WeakMap;let Sl={get(e,t,a){if(e instanceof IDBTransaction){if("done"===t)return kl.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Cl.get(e);if("store"===t)return a.objectStoreNames[1]?void 0:a.objectStore(a.objectStoreNames[0])}return Pl(e[t])},set:(e,t,a)=>(e[t]=a,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Tl(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(yl||(yl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Al(this),t),Pl(_l.get(this))}:function(...t){return Pl(e.apply(Al(this),t))}:function(t,...a){const n=e.call(Al(this),t,...a);return Cl.set(n,t.sort?t.sort():[t]),Pl(n)}}function Nl(e){return"function"==typeof e?Tl(e):(e instanceof IDBTransaction&&function(e){if(kl.has(e))return;const t=new Promise((t,a)=>{const n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{a(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});kl.set(e,t)}(e),t=e,(wl||(wl=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,Sl):e);var t}function Pl(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,a)=>{const n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(Pl(e.result)),n()},s=()=>{a(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&_l.set(t,e)}).catch(()=>{}),Il.set(t,e),t}(e);if(El.has(e))return El.get(e);const t=Nl(e);return t!==e&&(El.set(e,t),Il.set(t,e)),t}const Al=e=>Il.get(e);function xl(e,t,{blocked:a,upgrade:n,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),r=Pl(o);return n&&o.addEventListener("upgradeneeded",e=>{n(Pl(o.result),e.oldVersion,e.newVersion,Pl(o.transaction),e)}),a&&o.addEventListener("blocked",e=>a(e.oldVersion,e.newVersion,e)),r.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),r}function Rl(e,{blocked:t}={}){const a=indexedDB.deleteDatabase(e);return t&&a.addEventListener("blocked",e=>t(e.oldVersion,e)),Pl(a).then(()=>{})}const Dl=["get","getKey","getAll","getAllKeys","count"],Ol=["put","add","delete","clear"],Ll=new Map;function Ml(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Ll.get(t))return Ll.get(t);const a=t.replace(/FromIndex$/,""),n=t!==a,i=Ol.includes(a);if(!(a in(n?IDBIndex:IDBObjectStore).prototype)||!i&&!Dl.includes(a))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[a](...t),i&&s.done]))[0]};return Ll.set(t,s),s}Sl=(e=>({...e,get:(t,a,n)=>Ml(t,a)||e.get(t,a,n),has:(t,a)=>!!Ml(t,a)||e.has(t,a)}))(Sl);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ul{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const Fl="@firebase/app",ql="0.14.1",Bl=new bl("@firebase/app"),jl="@firebase/app-compat",$l="@firebase/analytics-compat",zl="@firebase/analytics",Vl="@firebase/app-check-compat",Wl="@firebase/app-check",Hl="@firebase/auth",Gl="@firebase/auth-compat",Kl="@firebase/database",Jl="@firebase/data-connect",Yl="@firebase/database-compat",Ql="@firebase/functions",Zl="@firebase/functions-compat",Xl="@firebase/installations",ec="@firebase/installations-compat",tc="@firebase/messaging",ac="@firebase/messaging-compat",nc="@firebase/performance",ic="@firebase/performance-compat",sc="@firebase/remote-config",oc="@firebase/remote-config-compat",rc="@firebase/storage",lc="@firebase/storage-compat",cc="@firebase/firestore",dc="@firebase/ai",uc="@firebase/firestore-compat",hc="firebase",pc="[DEFAULT]",mc={[Fl]:"fire-core",[jl]:"fire-core-compat",[zl]:"fire-analytics",[$l]:"fire-analytics-compat",[Wl]:"fire-app-check",[Vl]:"fire-app-check-compat",[Hl]:"fire-auth",[Gl]:"fire-auth-compat",[Kl]:"fire-rtdb",[Jl]:"fire-data-connect",[Yl]:"fire-rtdb-compat",[Ql]:"fire-fn",[Zl]:"fire-fn-compat",[Xl]:"fire-iid",[ec]:"fire-iid-compat",[tc]:"fire-fcm",[ac]:"fire-fcm-compat",[nc]:"fire-perf",[ic]:"fire-perf-compat",[sc]:"fire-rc",[oc]:"fire-rc-compat",[rc]:"fire-gcs",[lc]:"fire-gcs-compat",[cc]:"fire-fst",[uc]:"fire-fst-compat",[dc]:"fire-vertex","fire-js":"fire-js",[hc]:"fire-js-all"},fc=new Map,vc=new Map,gc=new Map;function bc(e,t){try{e.container.addComponent(t)}catch(a){Bl.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,a)}}function wc(e){const t=e.name;if(gc.has(t))return Bl.debug(`There were multiple attempts to register component ${t}.`),!1;gc.set(t,e);for(const a of fc.values())bc(a,e);for(const a of vc.values())bc(a,e);return!0}function yc(e,t){const a=e.container.getProvider("heartbeat").getImmediate({optional:!0});return a&&a.triggerHeartbeat(),e.container.getProvider(t)}function _c(e){return null!=e&&void 0!==e.settings}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kc=new Vr("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Cc{constructor(e,t,a){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new ll("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw kc.create("app-deleted",{appName:this._name})}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ec="12.1.0";function Ic(e,t={}){let a=e;if("object"!=typeof t){t={name:t}}const n={name:pc,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw kc.create("bad-app-name",{appName:String(i)});if(a||(a=Nr()),!a)throw kc.create("no-options");const s=fc.get(i);if(s){if(Xr(a,s.options)&&Xr(n,s.config))return s;throw kc.create("duplicate-app",{appName:i})}const o=new ul(i);for(const l of gc.values())o.addComponent(l);const r=new Cc(a,n,o);return fc.set(i,r),r}function Sc(e=pc){const t=fc.get(e);if(!t&&e===pc&&Nr())return Ic();if(!t)throw kc.create("no-app",{appName:e});return t}function Tc(e,t,a){let n=mc[e]??e;a&&(n+=`-${a}`);const i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){const e=[`Unable to register library "${n}" with version "${t}":`];return i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Bl.warn(e.join(" "))}wc(new ll(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nc="firebase-heartbeat-store";let Pc=null;function Ac(){return Pc||(Pc=xl("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Nc)}catch(a){console.warn(a)}}}).catch(e=>{throw kc.create("idb-open",{originalErrorMessage:e.message})})),Pc}async function xc(e,t){try{const a=(await Ac()).transaction(Nc,"readwrite"),n=a.objectStore(Nc);await n.put(t,Rc(e)),await a.done}catch(a){if(a instanceof zr)Bl.warn(a.message);else{const e=kc.create("idb-set",{originalErrorMessage:null==a?void 0:a.message});Bl.warn(e.message)}}}function Rc(e){return`${e.name}!${e.options.appId}`}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dc{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Lc(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=Oc();if(null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:a}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,a=e[0].date;for(let n=1;n<e.length;n++)e[n].date<a&&(a=e[n].date,t=n);return t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Bl.warn(a)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Oc(),{heartbeatsToSend:a,unsentEntries:n}=function(e,t=1024){const a=[];let n=e.slice();for(const i of e){const e=a.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),Mc(a)>t){e.dates.pop();break}}else if(a.push({agent:i.agent,dates:[i.date]}),Mc(a)>t){a.pop();break}n=n.slice(1)}return{heartbeatsToSend:a,unsentEntries:n}}(this._heartbeatsCache.heartbeats),i=wr(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Bl.warn(t),""}}}function Oc(){return(new Date).toISOString().substring(0,10)}class Lc{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Br()&&jr().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Ac()).transaction(Nc),a=await t.objectStore(Nc).get(Rc(e));return await t.done,a}catch(t){if(t instanceof zr)Bl.warn(t.message);else{const e=kc.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});Bl.warn(e.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return xc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return xc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function Mc(e){return wr(JSON.stringify({version:2,heartbeats:e})).length}var Uc;function Fc(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}Uc="",wc(new ll("platform-logger",e=>new Ul(e),"PRIVATE")),wc(new ll("heartbeat",e=>new Dc(e),"PRIVATE")),Tc(Fl,ql,Uc),Tc(Fl,ql,"esm2020"),Tc("fire-js","");const qc=Fc,Bc=new Vr("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),jc=new bl("@firebase/auth");function $c(e,...t){jc.logLevel<=hl.ERROR&&jc.error(`Auth (${Ec}): ${e}`,...t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zc(e,...t){throw Gc(e,...t)}function Vc(e,...t){return Gc(e,...t)}function Wc(e,t,a){const n={...qc(),[t]:a};return new Vr("auth","Firebase",n).create(t,{appName:e.name})}function Hc(e){return Wc(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Gc(e,...t){if("string"!=typeof e){const a=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(a,...n)}return Bc.create(e,...t)}function Kc(e,t,...a){if(!e)throw Gc(t,...a)}function Jc(e){const t="INTERNAL ASSERTION FAILED: "+e;throw $c(t),new Error(t)}function Yc(e,t){e||Jc(t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qc(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function Zc(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xc(){return"undefined"==typeof navigator||!navigator||!("onLine"in navigator)||"boolean"!=typeof navigator.onLine||"http:"!==Zc()&&"https:"!==Zc()&&!function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()&&!("connection"in navigator)||navigator.onLine}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ed{constructor(e,t){this.shortDelay=e,this.longDelay=t,Yc(t>e,"Short delay should be less than long delay!"),this.isMobile=Fr()||qr()}get(){return Xc()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function td(e,t){Yc(e.emulator,"Emulator should always be set here");const{url:a}=e.emulator;return t?`${a}${t.startsWith("/")?t.slice(1):t}`:a}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ad{static initialize(e,t,a){this.fetchImpl=e,t&&(this.headersImpl=t),a&&(this.responseImpl=a)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Jc("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Jc("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Jc("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nd={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},id=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],sd=new ed(3e4,6e4);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function od(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function rd(e,t,a,n,i={}){return ld(e,i,async()=>{let i={},s={};n&&("GET"===t?s=n:i={body:JSON.stringify(n)});const o=tl({key:e.config.apiKey,...s}).slice(1),r=await e._getAdditionalHeaders();r["Content-Type"]="application/json",e.languageCode&&(r["X-Firebase-Locale"]=e.languageCode);const l={method:t,headers:r,...i};return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&xr(e.emulatorConfig.host)&&(l.credentials="include"),ad.fetch()(await dd(e,e.config.apiHost,a,o),l)})}async function ld(e,t,a){e._canInitEmulator=!1;const n={...nd,...t};try{const t=new ud(e),i=await Promise.race([a(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw hd(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[a,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===a)throw hd(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===a)throw hd(e,"email-already-in-use",s);if("USER_DISABLED"===a)throw hd(e,"user-disabled",s);const r=n[a]||a.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Wc(e,r,o);zc(e,r)}}catch(i){if(i instanceof zr)throw i;zc(e,"network-request-failed",{message:String(i)})}}async function cd(e,t,a,n,i={}){const s=await rd(e,t,a,n,i);return"mfaPendingCredential"in s&&zc(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function dd(e,t,a,n){const i=`${t}${a}?${n}`,s=e,o=s.config.emulator?td(e.config,i):`${e.config.apiScheme}://${i}`;if(id.includes(a)&&(await s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())){return s._getPersistence()._getFinalTarget(o).toString()}return o}class ud{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Vc(this.auth,"network-request-failed")),sd.get())})}}function hd(e,t,a){const n={appName:e.name};a.email&&(n.email=a.email),a.phoneNumber&&(n.phoneNumber=a.phoneNumber);const i=Vc(e,t,n);return i.customData._tokenResponse=a,i}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pd(e,t){return rd(e,"POST","/v1/accounts:lookup",t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function md(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}async function fd(e,t=!1){const a=rl(e),n=await a.getIdToken(t),i=gd(n);Kc(i&&i.exp&&i.auth_time&&i.iat,a.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:n,authTime:md(vd(i.auth_time)),issuedAtTime:md(vd(i.iat)),expirationTime:md(vd(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}function vd(e){return 1e3*Number(e)}function gd(e){const[t,a,n]=e.split(".");if(void 0===t||void 0===a||void 0===n)return $c("JWT malformed, contained fewer than 3 sections"),null;try{const e=yr(a);return e?JSON.parse(e):($c("Failed to decode base64 JWT payload"),null)}catch(i){return $c("Caught error parsing JWT payload as JSON",null==i?void 0:i.toString()),null}}function bd(e){const t=gd(e);return Kc(t,"internal-error"),Kc(void 0!==t.exp,"internal-error"),Kc(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wd(e,t,a=!1){if(a)return t;try{return await t}catch(n){throw n instanceof zr&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class yd{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _d{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=md(this.lastLoginAt),this.creationTime=md(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kd(e){var t;const a=e.auth,n=await e.getIdToken(),i=await wd(e,pd(a,{idToken:n}));Kc(null==i?void 0:i.users.length,a,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null==(t=s.providerUserInfo)?void 0:t.length)?Ed(s.providerUserInfo):[],r=(l=e.providerData,c=o,[...l.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var l,c;const d=e.isAnonymous,u=!(e.email&&s.passwordHash||(null==r?void 0:r.length)),h=!!d&&u,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:r,metadata:new _d(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(e,p)}async function Cd(e){const t=rl(e);await kd(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function Ed(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Id{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Kc(e.idToken,"internal-error"),Kc(void 0!==e.idToken,"internal-error"),Kc(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):bd(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Kc(0!==e.length,"internal-error");const t=bd(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(Kc(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:a,refreshToken:n,expiresIn:i}=await async function(e,t){const a=await ld(e,{},async()=>{const a=tl({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:i}=e.config,s=await dd(e,n,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const r={method:"POST",headers:o,body:a};return e.emulatorConfig&&xr(e.emulatorConfig.host)&&(r.credentials="include"),ad.fetch()(s,r)});return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}}(e,t);this.updateTokensAndExpiration(a,n,Number(i))}updateTokensAndExpiration(e,t,a){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*a}static fromJSON(e,t){const{refreshToken:a,accessToken:n,expirationTime:i}=t,s=new Id;return a&&(Kc("string"==typeof a,"internal-error",{appName:e}),s.refreshToken=a),n&&(Kc("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),i&&(Kc("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Id,this.toJSON())}_performRefresh(){return Jc("not implemented")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sd(e,t){Kc("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Td{constructor({uid:e,auth:t,stsTokenManager:a,...n}){this.providerId="firebase",this.proactiveRefresh=new yd(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=n.displayName||null,this.email=n.email||null,this.emailVerified=n.emailVerified||!1,this.phoneNumber=n.phoneNumber||null,this.photoURL=n.photoURL||null,this.isAnonymous=n.isAnonymous||!1,this.tenantId=n.tenantId||null,this.providerData=n.providerData?[...n.providerData]:[],this.metadata=new _d(n.createdAt||void 0,n.lastLoginAt||void 0)}async getIdToken(e){const t=await wd(this,this.stsTokenManager.getToken(this.auth,e));return Kc(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return fd(this,e)}reload(){return Cd(this)}_assign(e){this!==e&&(Kc(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Td({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Kc(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let a=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),a=!0),t&&await kd(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(_c(this.auth.app))return Promise.reject(Hc(this.auth));const e=await this.getIdToken();return await wd(this,async function(e,t){return rd(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const a=t.displayName??void 0,n=t.email??void 0,i=t.phoneNumber??void 0,s=t.photoURL??void 0,o=t.tenantId??void 0,r=t._redirectEventId??void 0,l=t.createdAt??void 0,c=t.lastLoginAt??void 0,{uid:d,emailVerified:u,isAnonymous:h,providerData:p,stsTokenManager:m}=t;Kc(d&&m,e,"internal-error");const f=Id.fromJSON(this.name,m);Kc("string"==typeof d,e,"internal-error"),Sd(a,e.name),Sd(n,e.name),Kc("boolean"==typeof u,e,"internal-error"),Kc("boolean"==typeof h,e,"internal-error"),Sd(i,e.name),Sd(s,e.name),Sd(o,e.name),Sd(r,e.name),Sd(l,e.name),Sd(c,e.name);const v=new Td({uid:d,auth:e,email:n,emailVerified:u,displayName:a,isAnonymous:h,photoURL:s,phoneNumber:i,tenantId:o,stsTokenManager:f,createdAt:l,lastLoginAt:c});return p&&Array.isArray(p)&&(v.providerData=p.map(e=>({...e}))),r&&(v._redirectEventId=r),v}static async _fromIdTokenResponse(e,t,a=!1){const n=new Id;n.updateFromServerResponse(t);const i=new Td({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:a});return await kd(i),i}static async _fromGetAccountInfoResponse(e,t,a){const n=t.users[0];Kc(void 0!==n.localId,"internal-error");const i=void 0!==n.providerUserInfo?Ed(n.providerUserInfo):[],s=!(n.email&&n.passwordHash||(null==i?void 0:i.length)),o=new Id;o.updateFromIdToken(a);const r=new Td({uid:n.localId,auth:e,stsTokenManager:o,isAnonymous:s}),l={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new _d(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash||(null==i?void 0:i.length))};return Object.assign(r,l),r}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nd=new Map;function Pd(e){Yc(e instanceof Function,"Expected a class definition");let t=Nd.get(e);return t?(Yc(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Nd.set(e,t),t)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ad{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ad.type="NONE";const xd=Ad;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rd(e,t,a){return`firebase:${e}:${t}:${a}`}class Dd{constructor(e,t,a){this.persistence=e,this.auth=t,this.userKey=a;const{config:n,name:i}=this.auth;this.fullUserKey=Rd(this.userKey,n.apiKey,i),this.fullPersistenceKey=Rd("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await pd(this.auth,{idToken:e}).catch(()=>{});return t?Td._fromGetAccountInfoResponse(this.auth,t,e):null}return Td._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,a="authUser"){if(!t.length)return new Dd(Pd(xd),e,a);const n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=n[0]||Pd(xd);const s=Rd(a,e.config.apiKey,e.name);let o=null;for(const l of t)try{const t=await l._get(s);if(t){let a;if("string"==typeof t){const n=await pd(e,{idToken:t}).catch(()=>{});if(!n)break;a=await Td._fromGetAccountInfoResponse(e,n,t)}else a=Td._fromJSON(e,t);l!==i&&(o=a),i=l;break}}catch{}const r=n.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&r.length?(i=r[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch{}})),new Dd(i,e,a)):new Dd(i,e,a)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Od(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Fd(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Ld(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Bd(t))return"Blackberry";if(jd(t))return"Webos";if(Md(t))return"Safari";if((t.includes("chrome/")||Ud(t))&&!t.includes("edge/"))return"Chrome";if(qd(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=e.match(t);if(2===(null==a?void 0:a.length))return a[1]}return"Other"}function Ld(e=Ur()){return/firefox\//i.test(e)}function Md(e=Ur()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Ud(e=Ur()){return/crios\//i.test(e)}function Fd(e=Ur()){return/iemobile/i.test(e)}function qd(e=Ur()){return/android/i.test(e)}function Bd(e=Ur()){return/blackberry/i.test(e)}function jd(e=Ur()){return/webos/i.test(e)}function $d(e=Ur()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function zd(){return function(){const e=Ur();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function Vd(e=Ur()){return $d(e)||qd(e)||jd(e)||Bd(e)||/windows phone/i.test(e)||Fd(e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wd(e,t=[]){let a;switch(e){case"Browser":a=Od(Ur());break;case"Worker":a=`${Od(Ur())}-${e}`;break;default:a=e}const n=t.length?t.join(","):"FirebaseCore-web";return`${a}/JsCore/${Ec}/${n}`}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hd{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const a=t=>new Promise((a,n)=>{try{a(e(t))}catch(i){n(i)}});a.onAbort=t,this.queue.push(a);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const a of this.queue)await a(e),a.onAbort&&t.push(a.onAbort)}catch(a){t.reverse();for(const e of t)try{e()}catch(n){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==a?void 0:a.message})}}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gd{constructor(e){var t;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=a.minPasswordLength??6,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),void 0!==a.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),void 0!==a.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),void 0!==a.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),void 0!==a.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(null==(t=e.allowedNonAlphanumericCharacters)?void 0:t.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const a=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;a&&(t.meetsMinPasswordLength=e.length>=a),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let a;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)a=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(e,t,a,n,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd{constructor(e,t,a,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=a,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Yd(this),this.idTokenSubscription=new Yd(this),this.beforeStateQueue=new Hd(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Bc,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Pd(t)),this._initializationPromise=this.queue(async()=>{var a,n,i;if(!this._deleted&&(this.persistenceManager=await Dd.create(this,e),null==(a=this._resolvePersistenceManagerAvailable)||a.call(this),!this._deleted)){if(null==(n=this._popupRedirectResolver)?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(s){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(i=this.currentUser)?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(e,!0)):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await pd(this,{idToken:e}),a=await Td._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(a)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(_c(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let n=a,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=null==(t=this.redirectUser)?void 0:t._redirectEventId,s=null==n?void 0:n._redirectEventId,o=await this.tryRedirectSignIn(e);a&&a!==s||!(null==o?void 0:o.user)||(n=o.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(s){n=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return Kc(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(a){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await kd(e)}catch(t){if("auth/network-request-failed"!==(null==t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(_c(this.app))return Promise.reject(Hc(this));const t=e?rl(e):null;return t&&Kc(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Kc(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return _c(this.app)?Promise.reject(Hc(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return _c(this.app)?Promise.reject(Hc(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Pd(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return rd(e,"GET","/v2/passwordPolicy",od(e,t))}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this),t=new Gd(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Vr("auth","Firebase",e())}onAuthStateChanged(e,t,a){return this.registerStateListener(this.authStateSubscription,e,t,a)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,a){return this.registerStateListener(this.idTokenSubscription,e,t,a)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const a=this.onAuthStateChanged(()=>{a(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return rd(e,"POST","/v2/accounts:revokeToken",od(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){const a=await this.getOrInitRedirectPersistenceManager(t);return null===e?a.removeCurrentUser():a.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Pd(e)||this._popupRedirectResolver;Kc(t,this,"argument-error"),this.redirectPersistenceManager=await Dd.create(this,[Pd(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,a;return this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e?this._currentUser:(null==(a=this.redirectUser)?void 0:a._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const t=(null==(e=this.currentUser)?void 0:e.uid)??null;this.lastNotifiedUid!==t&&(this.lastNotifiedUid=t,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,a,n){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Kc(o,this,"internal-error"),o.then(()=>{s||i(this.currentUser)}),"function"==typeof t){const i=e.addObserver(t,a,n);return()=>{s=!0,i()}}{const a=e.addObserver(t);return()=>{s=!0,a()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Kc(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Wd(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const a=await(null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader());a&&(t["X-Firebase-Client"]=a);const n=await this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t}async _getAppCheckToken(){var e;if(_c(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){jc.logLevel<=hl.WARN&&jc.warn(`Auth (${Ec}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Jd(e){return rl(e)}class Yd{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const a=new nl(e,t);return a.subscribe.bind(a)}(e=>this.observer=e)}get next(){return Kc(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qd={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Zd(e,t){const a=yc(e,"auth");if(a.isInitialized()){const e=a.getImmediate();if(Xr(a.getOptions(),t??{}))return e;zc(e,"already-initialized")}return a.initialize({options:t})}function Xd(e,t,a){const n=Jd(e);Kc(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const i=eu(t),{host:s,port:o}=function(e){const t=eu(e),a=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!a)return{host:"",port:null};const n=a[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const e=i[1];return{host:e,port:tu(n.substr(e.length+1))}}{const[e,t]=n.split(":");return{host:e,port:tu(t)}}}(t),r=null===o?"":`:${o}`,l={url:`${i}//${s}${r}/`},c=Object.freeze({host:s,port:o,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!n._canInitEmulator)return Kc(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),void Kc(Xr(l,n.config.emulator)&&Xr(c,n.emulatorConfig),n,"emulator-config-failed");n.config.emulator=l,n.emulatorConfig=c,n.settings.appVerificationDisabledForTesting=!0,xr(s)?(Rr(`${i}//${s}${r}`),Mr("Auth",!0)):function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */()}function eu(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function tu(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class au{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Jc("not implemented")}_getIdTokenResponse(e){return Jc("not implemented")}_linkToIdToken(e,t){return Jc("not implemented")}_getReauthenticationResolver(e){return Jc("not implemented")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nu(e,t){return cd(e,"POST","/v1/accounts:signInWithIdp",od(e,t))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iu extends au{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new iu(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):zc("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:a,signInMethod:n,...i}=t;if(!a||!n)return null;const s=new iu(a,n);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return nu(e,this.buildRequest())}_linkToIdToken(e,t){const a=this.buildRequest();return a.idToken=t,nu(e,a)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,nu(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=tl(t)}return e}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class su{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ou extends su{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ru extends ou{constructor(){super("facebook.com")}static credential(e){return iu._fromParams({providerId:ru.PROVIDER_ID,signInMethod:ru.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ru.credentialFromTaggedObject(e)}static credentialFromError(e){return ru.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return ru.credential(e.oauthAccessToken)}catch{return null}}}ru.FACEBOOK_SIGN_IN_METHOD="facebook.com",ru.PROVIDER_ID="facebook.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class lu extends ou{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return iu._fromParams({providerId:lu.PROVIDER_ID,signInMethod:lu.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return lu.credentialFromTaggedObject(e)}static credentialFromError(e){return lu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:a}=e;if(!t&&!a)return null;try{return lu.credential(t,a)}catch{return null}}}lu.GOOGLE_SIGN_IN_METHOD="google.com",lu.PROVIDER_ID="google.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class cu extends ou{constructor(){super("github.com")}static credential(e){return iu._fromParams({providerId:cu.PROVIDER_ID,signInMethod:cu.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return cu.credentialFromTaggedObject(e)}static credentialFromError(e){return cu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return cu.credential(e.oauthAccessToken)}catch{return null}}}cu.GITHUB_SIGN_IN_METHOD="github.com",cu.PROVIDER_ID="github.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class du extends ou{constructor(){super("twitter.com")}static credential(e,t){return iu._fromParams({providerId:du.PROVIDER_ID,signInMethod:du.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return du.credentialFromTaggedObject(e)}static credentialFromError(e){return du.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:a}=e;if(!t||!a)return null;try{return du.credential(t,a)}catch{return null}}}du.TWITTER_SIGN_IN_METHOD="twitter.com",du.PROVIDER_ID="twitter.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class uu{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,a,n=!1){const i=await Td._fromIdTokenResponse(e,a,n),s=hu(a);return new uu({user:i,providerId:s,_tokenResponse:a,operationType:t})}static async _forOperation(e,t,a){await e._updateTokensIfNecessary(a,!0);const n=hu(a);return new uu({user:e,providerId:n,_tokenResponse:a,operationType:t})}}function hu(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class pu extends zr{constructor(e,t,a,n){super(t.code,t.message),this.operationType=a,this.user=n,Object.setPrototypeOf(this,pu.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(e,t,a,n){return new pu(e,t,a,n)}}function mu(e,t,a,n){return("reauthenticate"===t?a._getReauthenticationResolver(e):a._getIdTokenResponse(e)).catch(a=>{if("auth/multi-factor-auth-required"===a.code)throw pu._fromErrorAndOperation(e,a,t,n);throw a})}function fu(e,t,a,n){return rl(e).onIdTokenChanged(t,a,n)}function vu(e,t,a){return rl(e).beforeAuthStateChanged(t,a)}const gu="__sak";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bu{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(gu,"1"),this.storage.removeItem(gu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wu extends bu{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Vd(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const a=this.storage.getItem(t),n=this.localCache[t];a!==n&&e(t,n,a)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,a)=>{this.notifyListeners(e,a)});const a=e.key;t?this.detachListener():this.stopPolling();const n=()=>{const e=this.storage.getItem(a);(t||this.localCache[a]!==e)&&this.notifyListeners(a,e)},i=this.storage.getItem(a);zd()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}notifyListeners(e,t){this.localCache[e]=t;const a=this.listeners[e];if(a)for(const n of Array.from(a))n(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:a}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}wu.type="LOCAL";const yu=wu;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _u extends bu{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}_u.type="SESSION";const ku=_u;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Cu{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const a=new Cu(e);return this.receivers.push(a),a}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:a,eventType:n,data:i}=t.data,s=this.handlersMap[n];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:a,eventType:n});const o=Array.from(s).map(async e=>e(t.origin,i)),r=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(o);t.ports[0].postMessage({status:"done",eventId:a,eventType:n,response:r})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Eu(e="",t=10){let a="";for(let n=0;n<t;n++)a+=Math.floor(10*Math.random());return e+a}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Cu.receivers=[];class Iu{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,a=50){const n="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let i,s;return new Promise((o,r)=>{const l=Eu("",20);n.port1.start();const c=setTimeout(()=>{r(new Error("unsupported_event"))},a);s={messageChannel:n,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),i=setTimeout(()=>{r(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(c),clearTimeout(i),r(new Error("invalid_response"))}}},this.handlers.add(s),n.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[n.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Su(){return window}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Tu(){return void 0!==Su().WorkerGlobalScope&&"function"==typeof Su().importScripts}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Nu="firebaseLocalStorageDb",Pu="firebaseLocalStorage",Au="fbase_key";class xu{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Ru(e,t){return e.transaction([Pu],t?"readwrite":"readonly").objectStore(Pu)}function Du(){const e=indexedDB.open(Nu,1);return new Promise((t,a)=>{e.addEventListener("error",()=>{a(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(Pu,{keyPath:Au})}catch(n){a(n)}}),e.addEventListener("success",async()=>{const a=e.result;a.objectStoreNames.contains(Pu)?t(a):(a.close(),await function(){const e=indexedDB.deleteDatabase(Nu);return new xu(e).toPromise()}(),t(await Du()))})})}async function Ou(e,t,a){const n=Ru(e,!0).put({[Au]:t,value:a});return new xu(n).toPromise()}function Lu(e,t){const a=Ru(e,!0).delete(t);return new xu(a).toPromise()}class Mu{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Du()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(a){if(t++>3)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Tu()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Cu._getInstance(Tu()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}(),!this.activeServiceWorker)return;this.sender=new Iu(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&(null==(e=a[0])?void 0:e.fulfilled)&&(null==(t=a[0])?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Du();return await Ou(e,gu,"1"),await Lu(e,gu),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(a=>Ou(a,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const a=Ru(e,!1).get(t),n=await new xu(a).toPromise();return void 0===n?null:n.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Lu(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=Ru(e,!1).getAll();return new xu(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],a=new Set;if(0!==e.length)for(const{fbase_key:n,value:i}of e)a.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(i)&&(this.notifyListeners(n,i),t.push(n));for(const n of Object.keys(this.localCache))this.localCache[n]&&!a.has(n)&&(this.notifyListeners(n,null),t.push(n));return t}notifyListeners(e,t){this.localCache[e]=t;const a=this.listeners[e];if(a)for(const n of Array.from(a))n(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Mu.type="LOCAL";const Uu=Mu;
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Fu(e,t){return t?Pd(t):(Kc(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new ed(3e4,6e4);class qu extends au{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return nu(e,this._buildIdpRequest())}_linkToIdToken(e,t){return nu(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return nu(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Bu(e){
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
return async function(e,t,a=!1){if(_c(e.app))return Promise.reject(Hc(e));const n="signIn",i=await mu(e,n,t),s=await uu._fromIdTokenResponse(e,n,i);return a||await e._updateCurrentUser(s.user),s}(e.auth,new qu(e),e.bypassAuthState)}function ju(e){const{auth:t,user:a}=e;return Kc(a,t,"internal-error"),
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function(e,t,a=!1){const{auth:n}=e;if(_c(n.app))return Promise.reject(Hc(n));const i="reauthenticate";try{const s=await wd(e,mu(n,i,t,e),a);Kc(s.idToken,n,"internal-error");const o=gd(s.idToken);Kc(o,n,"internal-error");const{sub:r}=o;return Kc(e.uid===r,n,"user-mismatch"),uu._forOperation(e,i,s)}catch(s){throw"auth/user-not-found"===(null==s?void 0:s.code)&&zc(n,"user-mismatch"),s}}(a,new qu(e),e.bypassAuthState)}async function $u(e){const{auth:t,user:a}=e;return Kc(a,t,"internal-error"),async function(e,t,a=!1){const n=await wd(e,t._linkToIdToken(e.auth,await e.getIdToken()),a);return uu._forOperation(e,"link",n)}(a,new qu(e),e.bypassAuthState)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zu{constructor(e,t,a,n,i=!1){this.auth=e,this.resolver=a,this.user=n,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:a,postBody:n,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const r={auth:this.auth,requestUri:t,sessionId:a,tenantId:i||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(r))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Bu;case"linkViaPopup":case"linkViaRedirect":return $u;case"reauthViaPopup":case"reauthViaRedirect":return ju;default:zc(this.auth,"internal-error")}}resolve(e){Yc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Yc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vu=new ed(2e3,1e4);class Wu extends zu{constructor(e,t,a,n,i){super(e,t,n,i),this.provider=a,this.authWindow=null,this.pollId=null,Wu.currentPopupAction&&Wu.currentPopupAction.cancel(),Wu.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Kc(e,this.auth,"internal-error"),e}async onExecution(){Yc(1===this.filter.length,"Popup operations only handle one event");const e=Eu();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Vc(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(Vc(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Wu.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,a;(null==(a=null==(t=this.authWindow)?void 0:t.window)?void 0:a.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Vc(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Vu.get())};e()}}Wu.currentPopupAction=null;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Hu=new Map;class Gu extends zu{constructor(e,t,a=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,a),this.eventId=null}async execute(){let e=Hu.get(this.auth._key());if(!e){try{const t=await async function(e,t){const a=Yu(t),n=Ju(e);if(!(await n._isAvailable()))return!1;const i="true"===await n._get(a);return await n._remove(a),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Hu.set(this.auth._key(),e)}return this.bypassAuthState||Hu.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Ku(e,t){Hu.set(e._key(),t)}function Ju(e){return Pd(e._redirectPersistence)}function Yu(e){return Rd("pendingRedirect",e.config.apiKey,e.name)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qu(e,t,a=!1){if(_c(e.app))return Promise.reject(Hc(e));const n=Jd(e),i=Fu(n,t),s=new Gu(n,i,a),o=await s.execute();return o&&!a&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,t)),o}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zu{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(e,a)&&(t=!0,this.sendToConsumer(e,a),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return eh(e);default:return!1}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var a;if(e.error&&!eh(e)){const n=(null==(a=e.error.code)?void 0:a.split("auth/")[1])||"internal-error";t.onError(Vc(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const a=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&a}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Xu(e))}saveEventToCache(e){this.cachedEventUids.add(Xu(e)),this.lastProcessedEventTime=Date.now()}}function Xu(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function eh({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const th=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ah=/^https?/;async function nh(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return rd(e,"GET","/v1/projects",t)}(e);for(const a of t)try{if(ih(a))return}catch{}zc(e,"unauthorized-domain")}function ih(e){const t=Qc(),{protocol:a,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===n?"chrome-extension:"===a&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===a&&i.hostname===n}if(!ah.test(a))return!1;if(th.test(e))return n===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sh=new ed(3e4,6e4);function oh(){const e=Su().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let a=0;a<e.CP.length;a++)e.CP[a]=null}function rh(e){return new Promise((t,a)=>{var n,i,s,o;function r(){oh(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{oh(),a(Vc(e,"network-request-failed"))},timeout:sh.get()})}if(null==(i=null==(n=Su().gapi)?void 0:n.iframes)?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null==(s=Su().gapi)?void 0:s.load)){const t=`__${"iframefcb"}${Math.floor(1e6*Math.random())}`;return Su()[t]=()=>{gapi.load?r():a(Vc(e,"network-request-failed"))},(o=`${Qd.gapiScript}?onload=${t}`,Qd.loadJS(o)).catch(e=>a(e))}r()}}).catch(e=>{throw lh=null,e})}let lh=null;
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ch=new ed(5e3,15e3),dh={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},uh=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function hh(e){const t=e.config;Kc(t.authDomain,e,"auth-domain-config-required");const a=t.emulator?td(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,n={apiKey:t.apiKey,appName:e.name,v:Ec},i=uh.get(e.config.apiHost);i&&(n.eid=i);const s=e._getFrameworks();return s.length&&(n.fw=s.join(",")),`${a}?${tl(n).slice(1)}`}async function ph(e){const t=await function(e){return lh=lh||rh(e),lh}(e),a=Su().gapi;return Kc(a,e,"internal-error"),t.open({where:document.body,url:hh(e),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:dh,dontclear:!0},t=>new Promise(async(a,n)=>{await t.restyle({setHideOnLeave:!1});const i=Vc(e,"network-request-failed"),s=Su().setTimeout(()=>{n(i)},ch.get());function o(){Su().clearTimeout(s),a(t)}t.ping(o).then(o,()=>{n(i)})}))}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class fh{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function vh(e,t,a,n=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let r="";const l={...mh,width:n.toString(),height:i.toString(),top:s,left:o},c=Ur().toLowerCase();a&&(r=Ud(c)?"_blank":a),Ld(c)&&(t=t||"http://localhost",l.scrollbars="yes");const d=Object.entries(l).reduce((e,[t,a])=>`${e}${t}=${a},`,"");if(function(e=Ur()){var t;return $d(e)&&!!(null==(t=window.navigator)?void 0:t.standalone)}(c)&&"_self"!==r)return function(e,t){const a=document.createElement("a");a.href=e,a.target=t;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(n)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t||"",r),new fh(null);const u=window.open(t||"",r,d);Kc(u,e,"popup-blocked");try{u.focus()}catch(h){}return new fh(u)}const gh="__/auth/handler",bh="emulator/auth/handler",wh=encodeURIComponent("fac");async function yh(e,t,a,n,i,s){Kc(e.config.authDomain,e,"auth-domain-config-required"),Kc(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:a,redirectUrl:n,v:Ec,eventId:i};if(t instanceof su){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",Qr(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries({}))o[e]=t}if(t instanceof ou){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const r=o;for(const d of Object.keys(r))void 0===r[d]&&delete r[d];const l=await e._getAppCheckToken(),c=l?`#${wh}=${encodeURIComponent(l)}`:"";return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${gh}`;return td(e,bh)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e)}?${tl(r).slice(1)}${c}`}const _h="webStorageSupport";const kh=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ku,this._completeRedirectFn=Qu,this._overrideRedirectResult=Ku}async _openPopup(e,t,a,n){var i;Yc(null==(i=this.eventManagers[e._key()])?void 0:i.manager,"_initialize() not called before _openPopup()");return vh(e,await yh(e,t,a,Qc(),n),Eu())}async _openRedirect(e,t,a,n){await this._originValidation(e);return function(e){Su().location.href=e}(await yh(e,t,a,Qc(),n)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:a}=this.eventManagers[t];return e?Promise.resolve(e):(Yc(a,"If manager is not set, promise should be"),a)}const a=this.initAndGetManager(e);return this.eventManagers[t]={promise:a},a.catch(()=>{delete this.eventManagers[t]}),a}async initAndGetManager(e){const t=await ph(e),a=new Zu(e);return t.register("authEvent",t=>{Kc(null==t?void 0:t.authEvent,e,"invalid-auth-event");return{status:a.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:a},this.iframes[e._key()]=t,a}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(_h,{type:_h},a=>{var n;const i=null==(n=null==a?void 0:a[0])?void 0:n[_h];void 0!==i&&t(!!i),zc(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=nh(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Vd()||Md()||$d()}};var Ch="@firebase/auth",Eh="1.11.0";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ih{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Kc(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Sh=Pr("authIdTokenMaxAge")||300;let Th=null;var Nh;Qd={loadJS:e=>new Promise((t,a)=>{const n=document.createElement("script");var i;n.setAttribute("src",e),n.onload=t,n.onerror=e=>{const t=Vc("internal-error");t.customData=e,a(t)},n.type="text/javascript",n.charset="UTF-8",((null==(i=document.getElementsByTagName("head"))?void 0:i[0])??document).appendChild(n)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Nh="Browser",wc(new ll("auth",(e,{options:t})=>{const a=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=a.options;Kc(s&&!s.includes(":"),"invalid-api-key",{appName:a.name});const r={apiKey:s,authDomain:o,clientPlatform:Nh,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Wd(Nh)},l=new Kd(a,n,i,r);return function(e,t){const a=(null==t?void 0:t.persistence)||[],n=(Array.isArray(a)?a:[a]).map(Pd);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,null==t?void 0:t.popupRedirectResolver)}(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,a)=>{e.getProvider("auth-internal").initialize()})),wc(new ll("auth-internal",e=>{const t=Jd(e.getProvider("auth").getImmediate());return new Ih(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Tc(Ch,Eh,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Nh)),Tc(Ch,Eh,"esm2020");const Ph=Object.freeze(Object.defineProperty({__proto__:null,AuthCredential:au,FacebookAuthProvider:ru,GithubAuthProvider:cu,GoogleAuthProvider:lu,OAuthCredential:iu,TwitterAuthProvider:du,beforeAuthStateChanged:vu,browserLocalPersistence:yu,browserPopupRedirectResolver:kh,browserSessionPersistence:ku,connectAuthEmulator:Xd,getAuth:function(e=Sc()){const t=yc(e,"auth");if(t.isInitialized())return t.getImmediate();const a=Zd(e,{popupRedirectResolver:kh,persistence:[Uu,yu,ku]}),n=Pr("authTokenSyncURL");if(n&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(n,location.origin);if(location.origin===e.origin){const t=(i=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),a=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(a&&a>Sh)return;const n=null==t?void 0:t.token;Th!==n&&(Th=n,await fetch(i,{method:n?"POST":"DELETE",headers:n?{Authorization:`Bearer ${n}`}:{}}))});vu(a,t,()=>t(a.currentUser)),fu(a,e=>t(e))}}var i;const s=Sr("auth");return s&&Xd(a,`http://${s}`),a},getIdTokenResult:fd,getRedirectResult:async function(e,t){return await Jd(e)._initializationPromise,Qu(e,t,!1)},inMemoryPersistence:xd,indexedDBLocalPersistence:Uu,initializeAuth:Zd,onAuthStateChanged:function(e,t,a,n){return rl(e).onAuthStateChanged(t,a,n)},onIdTokenChanged:fu,prodErrorMap:qc,reload:Cd,signInAnonymously:async function(e){var t;if(_c(e.app))return Promise.reject(Hc(e));const a=Jd(e);if(await a._initializationPromise,null==(t=a.currentUser)?void 0:t.isAnonymous)return new uu({user:a.currentUser,providerId:null,operationType:"signIn"});const n=
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */await async function(e,t){return cd(e,"POST","/v1/accounts:signUp",od(e,t))}(a,{returnSecureToken:!0}),i=await uu._fromIdTokenResponse(a,"signIn",n,!0);return await a._updateCurrentUser(i.user),i},signInWithRedirect:function(e,t,a){return async function(e,t,a){if(_c(e.app))return Promise.reject(Hc(e));const n=Jd(e);(function(e,t,a){if(!(t instanceof a))throw a.name!==t.constructor.name&&zc(e,"argument-error"),Wc(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)})(e,t,su),await n._initializationPromise;const i=Fu(n,a);return await async function(e,t){return Ju(e)._set(Yu(t),"true")}(i,n),i._openRedirect(n,t,"signInViaRedirect")}(e,t,a)}},Symbol.toStringTag,{value:"Module"})),Ah=ja("App",{web:()=>H(()=>import("./web-C2hW9ook.js"),__vite__mapDeps([7,1,2])).then(e=>new e.AppWeb)}),xh=ja("Browser",{web:()=>H(()=>import("./web-BKA6N7Xb.js"),__vite__mapDeps([8,1,2])).then(e=>new e.BrowserWeb)});function Rh(e=64){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=new Uint8Array(e);return crypto.getRandomValues(a),Array.from(a).map(e=>t[e%66]).join("")}async function Dh(){if(!Ba.isNativePlatform())throw new Error("googleInAppLogin solo para plataformas nativas");const{androidClientId:e,redirectUri:t}=function(){const e="175482362472-d8i8so3lpdbkl30ls0gme012t18f9q8q.apps.googleusercontent.com",t=`com.googleusercontent.apps.${e.replace(".apps.googleusercontent.com","")}`;return{androidClientId:e,redirectUri:`${t}:/oauth2redirect`,redirectScheme:t}}(),a=Rh(64),n=await async function(e){const t=(new TextEncoder).encode(e),a=await crypto.subtle.digest("SHA-256",t),n=Array.from(new Uint8Array(a));return btoa(String.fromCharCode.apply(null,n)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(a),i=Rh(32),s=encodeURIComponent("openid email profile"),o=`https://accounts.google.com/o/oauth2/v2/auth?client_id=${encodeURIComponent(e)}&redirect_uri=${encodeURIComponent(t)}&response_type=code&scope=${s}&code_challenge=${n}&code_challenge_method=S256&state=${i}&prompt=select_account`;let r;try{const n=new Promise((e,t)=>{r=Ah.addListener("appUrlOpen",async a=>{try{const{params:t}=function(e){try{const t=new URL(e),a=Object.fromEntries(t.searchParams.entries());if(t.hash&&t.hash.startsWith("#")){const e=new URLSearchParams(t.hash.substring(1));for(const[t,n]of e.entries())a[t]=n}return{params:a,url:t}}catch(t){return{params:{},url:null}}}(a.url);if(t.state&&t.state!==i)return;(t.code||t.error)&&(await xh.close(),e(t))}catch(n){t(n)}})});await xh.open({url:o,presentationStyle:"popover"});const{code:s,error:l,error_description:c}=await n;if(l)throw new Error(c||l);if(!s)throw new Error("No se recibió código de autorización");const d=new URLSearchParams({code:s,client_id:e,redirect_uri:t,grant_type:"authorization_code",code_verifier:a}),u=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:d.toString()});if(!u.ok)throw new Error(`Fallo al canjear code: ${u.status}`);const h=await u.json(),p=h.id_token,m=h.access_token;if(!p)throw new Error("No se recibió id_token");const f=function(e){try{const[t,a]=e.split(".");return JSON.parse(atob(a))}catch(t){return{}}}(p);return{id_token:p,access_token:m,email:f.email,name:f.name,imageUrl:f.picture,sub:f.sub}}finally{r&&"function"==typeof r.remove&&r.remove()}}function Oh(){const e=a(!1),t=Ba.isNativePlatform(),n={web:"175482362472-sbae126lpnl34rlsf24p8lmdau1obob3.apps.googleusercontent.com",android:"175482362472-d8i8so3lpdbkl30ls0gme012t18f9q8q.apps.googleusercontent.com",ios:"175482362472-qv7ql9v55gu9tq0um54u3u54up6584ud.apps.googleusercontent.com"},i=async()=>{try{console.log("🔵 Starting in-app Google OAuth (Browser + PKCE)...");const e=await Dh();if(e&&e.id_token)return{token:e.id_token,email:e.email,name:e.name,imageUrl:e.imageUrl,uid:e.sub,accessToken:e.access_token};const t=new lu;t.addScope("email"),t.addScope("profile");const a=await Ia();if(!a)throw new Error("Firebase Auth not initialized");const{signInWithRedirect:n}=await H(async()=>{const{signInWithRedirect:e}=await Promise.resolve().then(()=>Ph);return{signInWithRedirect:e}},void 0);return console.log("🔵 Falling back to Firebase signInWithRedirect..."),await n(a,t),null}catch(e){throw console.error("❌ Native Firebase Google Sign-In failed:",e),new Error(`Native Firebase Google Sign-In failed: ${e.message}`)}},s=async()=>new Promise(async(e,t)=>{try{if(void 0===window.google)throw new Error("Google Identity Services not loaded");window.google.accounts.id.initialize({client_id:n.web,callback:a=>{if(a.credential){const t=JSON.parse(atob(a.credential.split(".")[1]));e({token:a.credential,email:t.email,name:t.name,imageUrl:t.picture})}else t(new Error("No credential received"))}}),window.google.accounts.id.prompt(e=>{if(e.isNotDisplayed()||e.isSkippedMoment()){const e=document.createElement("div");e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.zIndex="10000",e.style.background="white",e.style.padding="20px",e.style.borderRadius="8px",e.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)",document.body.appendChild(e),window.google.accounts.id.renderButton(e,{theme:"outline",size:"large",text:"signin_with",width:300});const t=window.google.accounts.id.callback;window.google.accounts.id.initialize({client_id:n.web,callback:a=>{document.body.removeChild(e),t(a)}})}})}catch(a){t(a)}});return{isLoading:e,isNativePlatform:t,signInWithGoogle:async()=>{e.value=!0;try{return t?await i():await s()}finally{e.value=!1}},extractEmailFromToken:e=>{try{return JSON.parse(atob(e.split(".")[1])).email}catch(t){return console.error("Error extracting email from token:",t),null}},getPlatformClientId:()=>{const e=Ba.getPlatform();return n[e]||n.web}}}const Lh=(e,t)=>{const a=e.__vccOpts||e;for(const[n,i]of t)a[n]=i;return a},Mh={class:"auth-container"},Uh={class:"auth-card"},Fh={key:0,class:"alert alert-danger"},qh={class:"mb-3"},Bh=["disabled"],jh={class:"mb-3"},$h=["disabled"],zh={class:"d-flex justify-content-between align-items-center mb-4"},Vh={class:"form-check"},Wh=["disabled"],Hh={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Gh={key:0,id:"google-signin-button",class:"d-flex justify-content-center mb-3",style:{"min-height":"44px"}},Kh=["disabled"],Jh={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Yh={key:1,class:"bi bi-google me-2"},Qh={class:"text-center mt-4"};const Zh=Lh({name:"LoginView",setup(){const e=b(),t=en(),{signInWithGoogleAndCheckUser:i,isInitializing:o,isGoogleLoaded:r,initializeGoogle:l}=dr(),{signInWithGoogle:c,isNativePlatform:d}=Oh(),u=a(""),h=a(""),p=a(!1),m=a(""),f=a(!1),v=n(()=>""!==u.value.trim()&&""!==h.value.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u.value)),g=async a=>{var n,i,s,o;try{f.value=!0,m.value="";const i=JSON.parse(atob(a.split(".")[1])).email;console.log("✅ Token de Google obtenido para:",i);let s=!0;try{await va.checkUserExists(i),console.log("👤 Usuario existe, procediendo con login...")}catch(r){if(404!==(null==(n=r.response)?void 0:n.status))throw r;s=!1,console.log("👤 Usuario no existe, se requerirá registro...")}if(!s){if(!(await ar.fire({title:"¡Bienvenido a MOZO!",html:`No tienes una cuenta registrada con <strong>${i}</strong>.<br><br>¿Deseas crear una cuenta nueva y continuar?`,icon:"question",showCancelButton:!0,confirmButtonColor:"#007bff",cancelButtonColor:"#6c757d",confirmButtonText:"✅ Sí, crear cuenta",cancelButtonText:"Cancelar",reverseButtons:!0})).isConfirmed)return void(m.value="Registro cancelado")}const o={google_token:a,fcm_token:localStorage.getItem("fcm_token")||void 0,platform:"web"},l=new URLSearchParams(window.location.search),c=l.get("invitation_code")||l.get("code");c&&(o.business_invitation_code=c);const d=await t.loginWithGoogle(o);s||await ar.fire({title:"¡Cuenta creada!",html:`Tu cuenta ha sido creada exitosamente con <strong>${i}</strong>`,icon:"success",confirmButtonText:"Continuar",timer:3e3,timerProgressBar:!0}),d.staff_request_created&&console.log(`✅ Solicitud de staff creada para: ${d.business_name}`);const u=localStorage.getItem("redirectAfterLogin");u?(localStorage.removeItem("redirectAfterLogin"),e.push(u)):e.push({name:"role-selection"})}catch(r){console.error("❌ Error en autenticación con Google:",r),401===(null==(i=r.response)?void 0:i.status)?m.value="Token de Google inválido. Por favor, inténtalo de nuevo.":m.value=(null==(o=null==(s=r.response)?void 0:s.data)?void 0:o.message)||r.message||"Error al autenticarse con Google"}finally{f.value=!1}};return s(async()=>{if(d)try{const{getAuth:e}=await H(async()=>{const{getAuth:e}=await Promise.resolve().then(()=>La);return{getAuth:e}},void 0),{getRedirectResult:t,GoogleAuthProvider:a}=await H(async()=>{const{getRedirectResult:e,GoogleAuthProvider:t}=await Promise.resolve().then(()=>Ph);return{getRedirectResult:e,GoogleAuthProvider:t}},void 0),n=await e();if(n){const e=await t(n);if(e){console.log("🔄 Processing redirect result from Google Sign-In...");const t=e.user,n=a.credentialFromResult(e),i={token:await t.getIdToken(),email:t.email,name:t.displayName,imageUrl:t.photoURL,uid:t.uid,accessToken:null==n?void 0:n.accessToken};return console.log("✅ Redirect result processed:",i.email),void(await g(i.token))}}}catch(e){console.error("❌ Error processing redirect result:",e)}d||await(async()=>{try{if(await l(),void 0!==window.google){const e=document.getElementById("google-signin-button");e&&(e.innerHTML="",window.google.accounts.id.renderButton(e,{theme:"outline",size:"large",text:"signin_with",width:300,locale:"es"}),window.google.accounts.id.initialize({client_id:"175482362472-sbae126lpnl34rlsf24p8lmdau1obob3.apps.googleusercontent.com",callback:async e=>{e.credential&&await g(e.credential)}}))}}catch(e){console.error("Error rendering Google button:",e)}})()}),{email:u,password:h,remember:p,error:m,loading:f,isInitializing:o,isGoogleLoaded:r,isFormValid:v,handleLogin:async()=>{var a,n;if(v.value){f.value=!0,m.value="";try{await t.login({email:u.value,password:h.value}),e.push({name:"role-selection"})}catch(i){console.error("Error de inicio de sesión:",i),m.value=(null==(n=null==(a=i.response)?void 0:a.data)?void 0:n.message)||"Error al iniciar sesión. Por favor, inténtalo de nuevo."}finally{f.value=!1}}},handleGoogleLogin:async()=>{var a,n,s,o,r;try{let n,s;if(f.value=!0,m.value="",console.log("🔵 Iniciando autenticación con Google...",d?"NATIVO":"WEB"),d){const e=await c();n=e.token,s=e.email}else{const e=await i();n=e.token,s=e.email}console.log("✅ Token de Google obtenido para:",s);let o=!0;try{await va.checkUserExists(s),console.log("👤 Usuario existe, procediendo con login...")}catch(l){if(404!==(null==(a=l.response)?void 0:a.status))throw l;o=!1,console.log("👤 Usuario no existe, se requerirá registro...")}if(!o){if(!(await ar.fire({title:"¡Bienvenido a MOZO!",html:`No tienes una cuenta registrada con <strong>${s}</strong>.<br><br>¿Deseas crear una cuenta nueva y continuar?`,icon:"question",showCancelButton:!0,confirmButtonColor:"#007bff",cancelButtonColor:"#6c757d",confirmButtonText:"✅ Sí, crear cuenta",cancelButtonText:"Cancelar",reverseButtons:!0})).isConfirmed)return void(m.value="Registro cancelado");console.log("👤 Usuario confirmó registro automático")}const r={google_token:n,fcm_token:localStorage.getItem("fcm_token")||void 0,platform:d?"android":"web"},u=new URLSearchParams(window.location.search),h=u.get("invitation_code")||u.get("code");h&&(r.business_invitation_code=h,console.log("🏢 Código de invitación detectado:",h));const p=o?"login":"registro y login";console.log(`🚀 Enviando datos de ${p} al servidor...`);const v=await t.loginWithGoogle(r);o||await ar.fire({title:"¡Cuenta creada!",html:`Tu cuenta ha sido creada exitosamente con <strong>${s}</strong>`,icon:"success",confirmButtonText:"Continuar",timer:3e3,timerProgressBar:!0}),v.staff_request_created&&(console.log(`✅ Solicitud de staff creada para: ${v.business_name}`),v.message&&console.log("📢 Mensaje del servidor:",v.message));const g=localStorage.getItem("redirectAfterLogin");g?(localStorage.removeItem("redirectAfterLogin"),e.push(g)):e.push({name:"role-selection"})}catch(l){if(console.error("❌ Error en autenticación con Google:",l),"Redirecting to Google Sign-In..."===l.message)return void(m.value="Redirigiendo a Google Sign-In...");"Google sign-in cancelled by user"===l.message?m.value="Autenticación cancelada":401===(null==(n=l.response)?void 0:n.status)?m.value="Token de Google inválido. Por favor, inténtalo de nuevo.":m.value=(null==(o=null==(s=l.response)?void 0:s.data)?void 0:o.message)||l.message||"Error al autenticarse con Google"}finally{(null==(r=m.value)?void 0:r.includes("Redirigiendo"))||(f.value=!1)}}}}},[["render",function(e,t,a,n,i,s){const b=v("router-link");return w(),o("div",Mh,[r("div",Uh,[t[13]||(t[13]=r("div",{class:"text-center mb-4"},[r("h1",{class:"h3"},"Iniciar Sesión"),r("p",{class:"text-muted"},"Accede a tu cuenta de MOZO")],-1)),n.error?(w(),o("div",Fh,c(n.error),1)):l("",!0),r("form",{onSubmit:t[4]||(t[4]=d((...e)=>n.handleLogin&&n.handleLogin(...e),["prevent"]))},[r("div",qh,[t[5]||(t[5]=r("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),u(r("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,Bh),[[h,n.email]])]),r("div",jh,[t[6]||(t[6]=r("label",{for:"password",class:"form-label"},"Contraseña",-1)),u(r("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),required:"",disabled:n.loading,placeholder:"Tu contraseña"},null,8,$h),[[h,n.password]])]),r("div",zh,[r("div",Vh,[u(r("input",{class:"form-check-input",type:"checkbox",id:"remember","onUpdate:modelValue":t[2]||(t[2]=e=>n.remember=e)},null,512),[[m,n.remember]]),t[7]||(t[7]=r("label",{class:"form-check-label",for:"remember"}," Recordarme ",-1))]),p(b,{to:"/forgot-password",class:"link-primary"},{default:f(()=>t[8]||(t[8]=[g("¿Olvidaste tu contraseña?")])),_:1,__:[8]})]),r("button",{type:"submit",class:"btn btn-primary w-100 mb-3",disabled:n.loading||!n.isFormValid},[n.loading?(w(),o("span",Hh)):l("",!0),t[9]||(t[9]=g(" Iniciar sesión "))],8,Wh),t[12]||(t[12]=r("div",{class:"text-center my-3"},[r("span",{class:"text-muted"},"O continúa con")],-1)),e.isNativePlatform?l("",!0):(w(),o("div",Gh)),e.isNativePlatform||!n.isGoogleLoaded?(w(),o("button",{key:1,type:"button",class:"btn btn-outline-secondary w-100 mb-3",onClick:t[3]||(t[3]=(...e)=>n.handleGoogleLogin&&n.handleGoogleLogin(...e)),disabled:n.loading||n.isInitializing},[n.loading?(w(),o("span",Jh)):(w(),o("i",Yh)),g(" "+c(n.loading?"Iniciando...":"Continuar con Google"),1)],8,Kh)):l("",!0),r("div",Qh,[t[11]||(t[11]=r("span",{class:"text-muted"},"¿No tienes una cuenta?",-1)),p(b,{to:"/register",class:"link-primary ms-1"},{default:f(()=>t[10]||(t[10]=[g("Registrarse")])),_:1,__:[10]})])],32)])])}],["__scopeId","data-v-80370602"]]),Xh={class:"auth-container"},ep={class:"auth-card"},tp={key:0,class:"alert alert-danger"},ap={class:"mb-3"},np=["disabled"],ip={class:"mb-3"},sp=["disabled"],op={key:0,class:"form-text text-danger"},rp={class:"mb-3"},lp=["disabled"],cp={key:0,class:"form-text text-danger"},dp={class:"mb-4"},up=["disabled"],hp={key:0,class:"form-text text-danger"},pp=["disabled"],mp={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},fp=["disabled"],vp={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},gp={key:1,class:"bi bi-google me-2"},bp={class:"text-center"};const wp=Lh({name:"RegisterView",setup(){const e=b(),{signInWithGoogleAndCheckUser:t,isInitializing:i}=dr(),{signInWithGoogle:s,isNativePlatform:o}=Oh(),r=a(""),l=a(""),c=a(""),d=a(""),u=a(""),h=a(!1),p=n(()=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.value)),m=n(()=>c.value.length>=8),f=n(()=>c.value===d.value),v=n(()=>""!==r.value.trim()&&p.value&&m.value&&f.value);return{name:r,email:l,password:c,passwordConfirmation:d,error:u,loading:h,isInitializing:i,isEmailValid:p,isPasswordValid:m,doPasswordsMatch:f,isFormValid:v,handleRegister:async()=>{var t,a;if(v.value){h.value=!0,u.value="";try{await cr.register(r.value,l.value,c.value,d.value),e.push({path:"/login",query:{registered:"success"}})}catch(n){console.error("Error de registro:",n),u.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al crear la cuenta. Por favor, inténtalo de nuevo."}finally{h.value=!1}}},handleGoogleRegister:async()=>{var a,n,i,r;try{let a,n;if(h.value=!0,u.value="",console.log("🔵 Iniciando registro con Google...",o?"NATIVO":"WEB"),o){const e=await s();a=e.token,n=e.email}else{const e=await t(!0);a=e.token,n=e.email}console.log("✅ Token de Google obtenido para:",n);const i={google_token:a,fcm_token:localStorage.getItem("fcm_token")||void 0,platform:o?"android":"web"},r=new URLSearchParams(window.location.search),l=r.get("invitation_code")||r.get("code");l&&(i.business_invitation_code=l,console.log("🏢 Código de invitación detectado:",l)),console.log("🚀 Enviando datos de registro al servidor...");const c=await cr.loginWithGoogle(i);c.staff_request_created&&(console.log(`✅ Solicitud de staff creada para: ${c.business_name}`),c.message&&console.log("📢 Mensaje del servidor:",c.message)),e.push({name:"role-selection"})}catch(l){if(console.error("❌ Error en registro con Google:",l),"Redirecting to Google Sign-In..."===l.message)return void(u.value="Redirigiendo a Google Sign-In...");"Google sign-in cancelled by user"===l.message?u.value="Registro cancelado":401===(null==(a=l.response)?void 0:a.status)?u.value="Token de Google inválido. Por favor, inténtalo de nuevo.":u.value=(null==(i=null==(n=l.response)?void 0:n.data)?void 0:i.message)||l.message||"Error al registrarse con Google"}finally{(null==(r=u.value)?void 0:r.includes("Redirigiendo"))||(h.value=!1)}}}}},[["render",function(e,t,a,n,i,s){const m=v("router-link");return w(),o("div",Xh,[r("div",ep,[t[14]||(t[14]=r("div",{class:"text-center mb-4"},[r("h1",{class:"h3"},"Crear cuenta"),r("p",{class:"text-muted"},"Regístrate para acceder a MOZO")],-1)),n.error?(w(),o("div",tp,c(n.error),1)):l("",!0),r("form",{onSubmit:t[5]||(t[5]=d((...e)=>n.handleRegister&&n.handleRegister(...e),["prevent"]))},[r("div",ap,[t[6]||(t[6]=r("label",{for:"name",class:"form-label"},"Nombre completo",-1)),u(r("input",{type:"text",class:"form-control",id:"name","onUpdate:modelValue":t[0]||(t[0]=e=>n.name=e),required:"",disabled:n.loading,placeholder:"Tu nombre completo"},null,8,np),[[h,n.name]])]),r("div",ip,[t[7]||(t[7]=r("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),u(r("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[1]||(t[1]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,sp),[[h,n.email]]),!n.isEmailValid&&n.email?(w(),o("div",op," Introduce un correo electrónico válido ")):l("",!0)]),r("div",rp,[t[8]||(t[8]=r("label",{for:"password",class:"form-label"},"Contraseña",-1)),u(r("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[2]||(t[2]=e=>n.password=e),required:"",disabled:n.loading,placeholder:"Mínimo 8 caracteres"},null,8,lp),[[h,n.password]]),!n.isPasswordValid&&n.password?(w(),o("div",cp," La contraseña debe tener al menos 8 caracteres ")):l("",!0)]),r("div",dp,[t[9]||(t[9]=r("label",{for:"passwordConfirmation",class:"form-label"},"Confirmar contraseña",-1)),u(r("input",{type:"password",class:"form-control",id:"passwordConfirmation","onUpdate:modelValue":t[3]||(t[3]=e=>n.passwordConfirmation=e),required:"",disabled:n.loading,placeholder:"Repite tu contraseña"},null,8,up),[[h,n.passwordConfirmation]]),!n.doPasswordsMatch&&n.passwordConfirmation?(w(),o("div",hp," Las contraseñas no coinciden ")):l("",!0)]),r("button",{type:"submit",class:"btn btn-primary w-100 mb-3",disabled:n.loading||!n.isFormValid},[n.loading?(w(),o("span",mp)):l("",!0),t[10]||(t[10]=g(" Crear cuenta "))],8,pp),t[13]||(t[13]=r("div",{class:"text-center my-3"},[r("span",{class:"text-muted"},"O regístrate con")],-1)),r("button",{type:"button",class:"btn btn-outline-secondary w-100 mb-4",onClick:t[4]||(t[4]=(...e)=>n.handleGoogleRegister&&n.handleGoogleRegister(...e)),disabled:n.loading||n.isInitializing},[n.loading?(w(),o("span",vp)):(w(),o("i",gp)),g(" "+c(n.loading?"Registrando...":"Continuar con Google"),1)],8,fp),r("div",bp,[t[12]||(t[12]=r("span",{class:"text-muted"},"¿Ya tienes una cuenta?",-1)),p(m,{to:"/login",class:"link-primary ms-1"},{default:f(()=>t[11]||(t[11]=[g("Iniciar sesión")])),_:1,__:[11]})])],32)])])}],["__scopeId","data-v-800b49f6"]]),yp={class:"auth-container"},_p={class:"auth-card"},kp={key:0,class:"alert alert-success"},Cp={key:1,class:"alert alert-danger"},Ep={class:"mb-4"},Ip=["disabled"],Sp=["disabled"],Tp={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Np={class:"text-center"},Pp={key:3,class:"text-center mt-3"};const Ap=Lh({name:"ForgotPasswordView",setup(){const e=a(""),t=a(""),i=a(""),s=a(!1),o=n(()=>""!==e.value.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value));return{email:e,error:t,success:i,loading:s,isFormValid:o,handleForgotPassword:async()=>{var a,n;if(o.value){s.value=!0,t.value="",i.value="";try{await cr.forgotPassword(e.value),i.value="Se ha enviado un enlace de recuperación a tu correo electrónico. Por favor, revisa tu bandeja de entrada.",e.value=""}catch(r){console.error("Error al solicitar recuperación de contraseña:",r),t.value=(null==(n=null==(a=r.response)?void 0:a.data)?void 0:n.message)||"No se pudo enviar el enlace de recuperación. Por favor, inténtalo de nuevo."}finally{s.value=!1}}}}}},[["render",function(e,t,a,n,i,s){const m=v("router-link");return w(),o("div",yp,[r("div",_p,[t[6]||(t[6]=r("div",{class:"text-center mb-4"},[r("h1",{class:"h3"},"Recuperar contraseña"),r("p",{class:"text-muted"},"Ingresa tu correo electrónico para recibir un enlace de recuperación")],-1)),n.success?(w(),o("div",kp,c(n.success),1)):l("",!0),n.error?(w(),o("div",Cp,c(n.error),1)):l("",!0),n.success?l("",!0):(w(),o("form",{key:2,onSubmit:t[1]||(t[1]=d((...e)=>n.handleForgotPassword&&n.handleForgotPassword(...e),["prevent"]))},[r("div",Ep,[t[2]||(t[2]=r("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),u(r("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,Ip),[[h,n.email]])]),r("button",{type:"submit",class:"btn btn-primary w-100 mb-4",disabled:n.loading||!n.isFormValid},[n.loading?(w(),o("span",Tp)):l("",!0),t[3]||(t[3]=g(" Enviar enlace de recuperación "))],8,Sp),r("div",Np,[p(m,{to:"/login",class:"link-primary"},{default:f(()=>t[4]||(t[4]=[r("i",{class:"bi bi-arrow-left me-1"},null,-1),g(" Volver a inicio de sesión ")])),_:1,__:[4]})])],32)),n.success?(w(),o("div",Pp,[p(m,{to:"/login",class:"btn btn-outline-primary"},{default:f(()=>t[5]||(t[5]=[g(" Volver a inicio de sesión ")])),_:1,__:[5]})])):l("",!0)])])}],["__scopeId","data-v-af089bfd"]]),xp={name:"ResetPasswordView",setup(){b();const e=y(),t=a(""),i=a(""),o=a(""),r=a(""),l=a(""),c=a(""),d=a(!1),u=n(()=>o.value.length>=8),h=n(()=>o.value===r.value),p=n(()=>""!==t.value&&""!==i.value.trim()&&u.value&&h.value);s(()=>{t.value=e.query.token||"",i.value=e.query.email||"",t.value||(l.value="Token de restablecimiento no válido o expirado. Por favor, solicita un nuevo enlace de recuperación.")});return{email:i,password:o,passwordConfirmation:r,error:l,success:c,loading:d,isPasswordValid:u,doPasswordsMatch:h,isFormValid:p,handleResetPassword:async()=>{var e,a;if(p.value){d.value=!0,l.value="",c.value="";try{await cr.resetPassword(t.value,i.value,o.value,r.value),c.value="Tu contraseña ha sido restablecida con éxito. Ya puedes iniciar sesión con tu nueva contraseña.",o.value="",r.value=""}catch(n){console.error("Error al restablecer contraseña:",n),l.value=(null==(a=null==(e=n.response)?void 0:e.data)?void 0:a.message)||"No se pudo restablecer la contraseña. Por favor, inténtalo de nuevo o solicita un nuevo enlace."}finally{d.value=!1}}}}}},Rp={class:"auth-container"},Dp={class:"auth-card"},Op={key:0,class:"alert alert-success"},Lp={key:1,class:"alert alert-danger"},Mp={class:"mb-3"},Up=["disabled"],Fp={class:"mb-3"},qp=["disabled"],Bp={key:0,class:"form-text text-danger"},jp={class:"mb-4"},$p=["disabled"],zp={key:0,class:"form-text text-danger"},Vp=["disabled"],Wp={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Hp={class:"text-center"},Gp={key:3,class:"text-center mt-3"};const Kp=Lh(xp,[["render",function(e,t,a,n,i,s){const m=v("router-link");return w(),o("div",Rp,[r("div",Dp,[t[10]||(t[10]=r("div",{class:"text-center mb-4"},[r("h1",{class:"h3"},"Restablecer contraseña"),r("p",{class:"text-muted"},"Crea una nueva contraseña segura")],-1)),n.success?(w(),o("div",Op,c(n.success),1)):l("",!0),n.error?(w(),o("div",Lp,c(n.error),1)):l("",!0),n.success?l("",!0):(w(),o("form",{key:2,onSubmit:t[3]||(t[3]=d((...e)=>n.handleResetPassword&&n.handleResetPassword(...e),["prevent"]))},[r("div",Mp,[t[4]||(t[4]=r("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),u(r("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,Up),[[h,n.email]])]),r("div",Fp,[t[5]||(t[5]=r("label",{for:"password",class:"form-label"},"Nueva contraseña",-1)),u(r("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),required:"",disabled:n.loading,placeholder:"Mínimo 8 caracteres"},null,8,qp),[[h,n.password]]),!n.isPasswordValid&&n.password?(w(),o("div",Bp," La contraseña debe tener al menos 8 caracteres ")):l("",!0)]),r("div",jp,[t[6]||(t[6]=r("label",{for:"passwordConfirmation",class:"form-label"},"Confirmar nueva contraseña",-1)),u(r("input",{type:"password",class:"form-control",id:"passwordConfirmation","onUpdate:modelValue":t[2]||(t[2]=e=>n.passwordConfirmation=e),required:"",disabled:n.loading,placeholder:"Repite tu nueva contraseña"},null,8,$p),[[h,n.passwordConfirmation]]),!n.doPasswordsMatch&&n.passwordConfirmation?(w(),o("div",zp," Las contraseñas no coinciden ")):l("",!0)]),r("button",{type:"submit",class:"btn btn-primary w-100 mb-4",disabled:n.loading||!n.isFormValid},[n.loading?(w(),o("span",Wp)):l("",!0),t[7]||(t[7]=g(" Cambiar contraseña "))],8,Vp),r("div",Hp,[p(m,{to:"/login",class:"link-primary"},{default:f(()=>t[8]||(t[8]=[r("i",{class:"bi bi-arrow-left me-1"},null,-1),g(" Volver a inicio de sesión ")])),_:1,__:[8]})])],32)),n.success?(w(),o("div",Gp,[p(m,{to:"/login",class:"btn btn-primary"},{default:f(()=>t[9]||(t[9]=[g(" Ir a inicio de sesión ")])),_:1,__:[9]})])):l("",!0)])])}],["__scopeId","data-v-9859a781"]]),Jp="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+DQogIDwhLS0gRm9uZG8gZGVsIGxvZ28gLS0+DQogIDxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiByeD0iNDAiIGZpbGw9IiM3QzZDRjMiLz4NCiAgDQogIDwhLS0gT2pvcyAtLT4NCiAgPGNpcmNsZSBjeD0iNzAiIGN5PSI4MCIgcj0iMTUiIGZpbGw9ImJsYWNrIi8+DQogIDxjaXJjbGUgY3g9IjEzMCIgY3k9IjgwIiByPSIxNSIgZmlsbD0iYmxhY2siLz4NCiAgDQogIDwhLS0gQ2VqYXMgLS0+DQogIDxsaW5lIHgxPSI1MCIgeTE9IjYwIiB4Mj0iOTAiIHkyPSI2MCIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSI1IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4NCiAgPGxpbmUgeDE9IjExMCIgeTE9IjYwIiB4Mj0iMTUwIiB5Mj0iNjAiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+DQogIA0KICA8IS0tIEJvY2Egc29ucmllbnRlIC0tPg0KICA8cGF0aCBkPSJNNzAgMTMwIFExMDAgMTYwIDEzMCAxMzAiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+DQogIA0KICA8IS0tIFRleHRvICJNT1pPIiAtLT4NCiAgPHRleHQgeD0iMTAwIiB5PSIxMTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZvbnQtc2l6ZT0iMzQiIGZpbGw9ImJsYWNrIj5NT1pPPC90ZXh0Pg0KPC9zdmc+IA==",Yp={class:"container d-flex justify-content-center align-items-center vh-100"},Qp={class:"row justify-content-center align-items-center w-100"},Zp={class:"role-card col-11 d-flex flex-column justify-content-center align-items-center"},Xp={class:"row justify-content-between align-items-center w-100"},em={class:"col me-2 d-flex flex-column justify-content-center align-items-center px-0"},tm={class:"col ms-2 d-flex flex-column justify-content-center align-items-center px-0"},am={class:"mt-5 text-center row justify-content-center align-items-center w-100"},nm=["disabled"],im=Lh({__name:"RoleSelection",props:[],setup(e){const t=b(),n=a(""),i=a(!1),s=a(""),l=en(),c=async e=>{if(s.value)return;s.value=e,n.value="";try{console.log("RoleSelection - Inicio de selección de rol:",e),console.log("RoleSelection - Token antes de selectRole:",localStorage.getItem("token"));const t=await cr.selectRole(e);console.log("RoleSelection - Respuesta de selectRole:",t),console.log("RoleSelection - Token después de selectRole:",localStorage.getItem("token"))}catch(i){console.warn("RoleSelection - selectRole falló, se continúa localmente:",(null==i?void 0:i.message)||i),console.error("RoleSelection - Error completo:",i)}console.log("RoleSelection - Actualizando estado local con setSelectedRole"),l.setSelectedRole(e),console.log("RoleSelection - Estado actualizado, token actual:",localStorage.getItem("token"));const a="waiter"===e?"waiter-dashboard":"admin";console.log("RoleSelection - Redirigiendo a:",a),t.push({name:a}),s.value=""},d=async()=>{try{await cr.logout(),l.logout(),t.push({name:"login"})}catch(e){t.push({name:"login"})}};return(e,t)=>(w(),o("div",Yp,[r("div",Qp,[r("div",Zp,[t[5]||(t[5]=r("div",{class:"text-center mb-4 row justify-content-center align-items-center w-100"},[r("img",{src:Jp,alt:"MOZO Logo",class:"logo mb-3"}),r("h1",{class:"h3"},"¿Qué rol tienes?")],-1)),r("div",Xp,[r("div",em,[r("div",{class:"role-option static",onClick:t[0]||(t[0]=e=>c("admin"))},t[2]||(t[2]=[r("div",{class:"role-icon"},[r("i",{class:"bi bi-house-door"})],-1),r("h3",{class:"h5 mt-3"},"Dueño",-1)]))]),r("div",tm,[r("div",{class:"role-option static",onClick:t[1]||(t[1]=e=>c("waiter"))},t[3]||(t[3]=[r("div",{class:"role-icon"},[r("i",{class:"bi bi-person"})],-1),r("h3",{class:"h5 mt-3"},"Mozo",-1)]))])]),r("div",am,[r("button",{class:"btn btn-outline-secondary w-100",onClick:d,disabled:i.value||!!s.value},t[4]||(t[4]=[r("i",{class:"bi bi-box-arrow-left me-1"},null,-1),g(" Cerrar sesión ")]),8,nm)])])])]))}},[["__scopeId","data-v-22e7f38d"]]);const sm=new class{async callWaiter(e,t={}){const{message:a,urgency:n="normal",client_info:i}=t;try{return(await va.callWaiter(e)).data}catch(s){throw console.error("Error calling waiter:",s),this.handleError(s)}}async getPendingCalls(){try{return(await va.getPendingCalls()).data}catch(e){throw this.handleError(e)}}async acknowledgCall(e){try{return(await va.acknowledgeCall(e)).data}catch(t){throw this.handleError(t)}}async completeCall(e){try{return(await va.completeCall(e)).data}catch(t){throw this.handleError(t)}}async getWaiterCallHistory(e="today",t=1,a=20){try{return(await va.getWaiterCallHistory({filter:e,page:t,limit:a})).data}catch(n){throw this.handleError(n)}}async getAdminCallHistory(e="today",t=1,a=20){try{return(await va.getAdminCallHistory({filter:e,page:t,limit:a})).data}catch(n){throw this.handleError(n)}}async activateTable(e){var t;try{return(await va.activateTable(e)).data}catch(a){throw console.error("❌ Error activating table:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data),this.handleError(a)}}async deactivateTable(e){try{return(await va.deactivateTable(e)).data}catch(t){throw console.error("Error deactivating table:",t),this.handleError(t)}}async activateMultipleTables(e){var t;try{return(await va.activateMultipleTables({table_ids:e})).data}catch(a){throw console.error("❌ Error activating multiple tables:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data),this.handleError(a)}}async deactivateMultipleTables(e){try{return(await va.deactivateMultipleTables({table_ids:e})).data}catch(t){throw console.error("Error deactivating multiple tables:",t),this.handleError(t)}}async silenceTable(e,t=30,a=""){var n;const i={duration_minutes:t,notes:"string"==typeof a?a:""};try{const t=await va.silenceTable(e,i);return console.log("✅ Respuesta silenciar mesa:",t.data),t.data}catch(s){throw console.error("❌ Error silencing table:",s),console.error("❌ Error details:",null==(n=s.response)?void 0:n.data),this.handleError(s)}}async unsilenceTable(e){var t;console.log("🔊 Quitando silencio de mesa:",e);try{const t=await va.unsilenceTable(e);return console.log("✅ Respuesta quitar silencio:",t.data),t.data}catch(a){console.error("❌ Error unsilencing table:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data)}}async silenceMultipleTables(e,t=30,a=""){try{return(await va.post("/waiter/tables/silence/multiple",{table_ids:e,duration_minutes:t,notes:a})).data}catch(n){throw console.error("Error silencing multiple tables:",n),this.handleError(n)}}async unsilenceMultipleTables(e){try{return(await va.post("/waiter/tables/unsilence/multiple",{table_ids:e})).data}catch(t){throw console.error("Error unsilencing multiple tables:",t),this.handleError(t)}}async getSilencedTables(){try{return(await va.getSilencedTables()).data}catch(e){throw console.error("Error getting silenced tables:",e),this.handleError(e)}}async getAssignedTables(){try{return(await va.getAssignedTables()).data}catch(e){throw console.error("Error getting assigned tables:",e),this.handleError(e)}}async getAvailableTables(){try{return(await va.getAvailableTables()).data}catch(e){throw console.error("Error getting available tables:",e),this.handleError(e)}}async getWaiterBusinesses(){try{const e=await va.getWaiterBusinesses();return console.log("Negocios del mozo obtenidos:",e.data),e.data}catch(e){throw console.error("Error getting waiter businesses:",e),this.handleError(e)}}async setActiveWaiterBusiness(e){try{return(await va.setActiveWaiterBusiness(e)).data}catch(t){throw console.error("Error setting active business:",t),this.handleError(t)}}async getActiveWaiterBusiness(){try{return(await va.getActiveWaiterBusiness()).data}catch(e){throw console.error("Error getting active business:",e),this.handleError(e)}}async getWaiterBusinessTables(e){var t;try{return(await va.getWaiterBusinessTables(e)).data}catch(a){throw console.error("❌ Error getting business tables:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data),this.handleError(a)}}async joinBusinessWithCode(e){try{return(await va.joinBusinessWithCode(e)).data}catch(t){throw console.error("Error joining business with code:",t),this.handleError(t)}}async blockIpForSpam(e,t={}){try{const a={call_id:e,reason:t.reason||"spam",duration_hours:t.duration_hours||24,notes:t.notes||"Bloqueado por spam"};return(await va.blockIpForSpam(a)).data}catch(a){throw console.error("Error blocking IP for spam:",a),this.handleError(a)}}async unblockIp(e,t=null){try{const a={ip_address:e};t&&(a.business_id=t);return(await va.unblockIp(a)).data}catch(a){throw console.error("Error unblocking IP:",a),this.handleError(a)}}async getBlockedIps(e={}){try{const t={};void 0!==e.active_only&&(t.active_only=e.active_only),e.reason&&(t.reason=e.reason),e.per_page&&(t.per_page=e.per_page);return(await va.getBlockedIps(t)).data}catch(t){throw console.error("Error getting blocked IPs:",t),this.handleError(t)}}async debugBlockedIp(e,t=null){try{const a={ip_address:e};t&&(a.business_id=t);return(await va.debugBlockedIp(a)).data}catch(a){throw console.error("Error debugging blocked IP:",a),this.handleError(a)}}async forceUnblockIp(e,t=null){try{const a={ip_address:e};t&&(a.business_id=t);return(await va.forceUnblockIp(a)).data}catch(a){throw console.error("Error force-unblocking IP:",a),this.handleError(a)}}async leaveWaiterBusiness(e){try{return(await va.leaveWaiterBusiness(e)).data}catch(t){throw console.error("Error leaving business:",t),this.handleError(t)}}async getAdminSilencedTables(){try{return(await va.get("/admin/tables/silenced")).data}catch(e){throw console.error("Error getting admin silenced tables:",e),this.handleError(e)}}async adminUnsilenceTable(e){try{return(await va.delete(`/admin/tables/${e}/silence`)).data}catch(t){throw console.error("Error admin unsilencing table:",t),this.handleError(t)}}handleError(e){var t;return(null==(t=e.response)?void 0:t.data)?{success:!1,message:e.response.data.message||"Error en la solicitud",code:e.response.status,data:e.response.data}:{success:!1,message:e.message||"Error de conexión",code:"NETWORK_ERROR"}}formatResponseTime(e){if(e<60)return`${e}s`;if(e<3600){const t=Math.floor(e/60),a=e%60;return a>0?`${t}m ${a}s`:`${t}m`}{const t=Math.floor(e/3600),a=Math.floor(e%3600/60);return a>0?`${t}h ${a}m`:`${t}h`}}formatTimeAgo(e){const t=new Date-new Date(e),a=Math.floor(t/6e4);if(a<1)return"Ahora";if(a<60)return`${a}m`;if(a<1440){return`${Math.floor(a/60)}h`}return`${Math.floor(a/1440)}d`}getUrgencyColor(e,t=0){return"high"===e?"#dc3545":t>5?"#fd7e14":"#007bff"}getUrgencyIcon(e,t=0){return"high"===e?"🚨":t>5?"⏰":"🔔"}},om=Object.freeze(Object.defineProperty({__proto__:null,default:sm},Symbol.toStringTag,{value:"Module"}));var rm={};const lm="@firebase/database",cm="1.1.0";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let dm="";function um(e){dm=e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hm{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Gr(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Hr(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pm{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Jr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mm=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new hm(t)}}catch(t){}return new pm},fm=mm("localStorage"),vm=mm("sessionStorage"),gm=new bl("@firebase/database"),bm=function(){let e=1;return function(){return e++}}(),wm=function(e){const t=function(e){const t=[];let a=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);if(i>=55296&&i<=56319){const t=i-55296;n++,pr(n<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(n)-56320)}i<128?t[a++]=i:i<2048?(t[a++]=i>>6|192,t[a++]=63&i|128):i<65536?(t[a++]=i>>12|224,t[a++]=i>>6&63|128,t[a++]=63&i|128):(t[a++]=i>>18|240,t[a++]=i>>12&63|128,t[a++]=i>>6&63|128,t[a++]=63&i|128)}return t}(e),a=new al;a.update(t);const n=a.digest();return vr.encodeByteArray(n)},ym=function(...e){let t="";for(let a=0;a<e.length;a++){const n=e[a];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=ym.apply(null,n):t+="object"==typeof n?Gr(n):n,t+=" "}return t};let _m=null,km=!0;const Cm=function(...e){if(!0===km&&(km=!1,null===_m&&!0===vm.get("logging_enabled")&&(pr(!0,"Can't turn on custom loggers persistently."),gm.logLevel=hl.VERBOSE,_m=gm.log.bind(gm))),_m){const t=ym.apply(null,e);_m(t)}},Em=function(e){return function(...t){Cm(e,...t)}},Im=function(...e){const t="FIREBASE INTERNAL ERROR: "+ym(...e);gm.error(t)},Sm=function(...e){const t=`FIREBASE FATAL ERROR: ${ym(...e)}`;throw gm.error(t),new Error(t)},Tm=function(...e){const t="FIREBASE WARNING: "+ym(...e);gm.warn(t)},Nm=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Pm="[MIN_NAME]",Am="[MAX_NAME]",xm=function(e,t){if(e===t)return 0;if(e===Pm||t===Am)return-1;if(t===Pm||e===Am)return 1;{const a=qm(e),n=qm(t);return null!==a?null!==n?a-n===0?e.length-t.length:a-n:-1:null!==n?1:e<t?-1:1}},Rm=function(e,t){return e===t?0:e<t?-1:1},Dm=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Gr(t))},Om=function(e){if("object"!=typeof e||null===e)return Gr(e);const t=[];for(const n in e)t.push(n);t.sort();let a="{";for(let n=0;n<t.length;n++)0!==n&&(a+=","),a+=Gr(t[n]),a+=":",a+=Om(e[t[n]]);return a+="}",a},Lm=function(e,t){const a=e.length;if(a<=t)return[e];const n=[];for(let i=0;i<a;i+=t)i+t>a?n.push(e.substring(i,a)):n.push(e.substring(i,i+t));return n};function Mm(e,t){for(const a in e)e.hasOwnProperty(a)&&t(a,e[a])}const Um=function(e){pr(!Nm(e),"Invalid JSON number");const t=1023;let a,n,i,s,o;0===e?(n=0,i=0,a=1/e==-1/0?1:0):(a=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),t),n=s+t,i=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(n=0,i=Math.round(e/Math.pow(2,-1074))));const r=[];for(o=52;o;o-=1)r.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;o-=1)r.push(n%2?1:0),n=Math.floor(n/2);r.push(a?1:0),r.reverse();const l=r.join("");let c="";for(o=0;o<64;o+=8){let e=parseInt(l.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()};const Fm=new RegExp("^-?(0*)\\d{1,10}$"),qm=function(e){if(Fm.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Bm=function(e){try{e()}catch(t){setTimeout(()=>{const e=t.stack||"";throw Tm("Exception was thrown by user callback.",e),t},Math.floor(0))}},jm=function(e,t){const a=setTimeout(e,t);return"number"==typeof a&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(a):"object"==typeof a&&a.unref&&a.unref(),a};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class $m{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,_c(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,a)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,a):t(null)},0)})}addTokenChangeListener(e){var t;null==(t=this.appCheckProvider)||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){Tm(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zm{constructor(e,t,a){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=a,this.auth_=null,this.auth_=a.getImmediate({optional:!0}),this.auth_||a.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(Cm("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,a)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,a):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Tm(e)}}class Vm{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Vm.OWNER="owner";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Wm=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Hm="ac",Gm="websocket",Km="long_polling";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Jm{constructor(e,t,a,n,i=!1,s="",o=!1,r=!1,l=null){this.secure=t,this.namespace=a,this.webSocketOnly=n,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=r,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=fm.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&fm.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Ym(e,t,a){let n;if(pr("string"==typeof t,"typeof type must == string"),pr("object"==typeof a,"typeof params must == object"),t===Gm)n=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Km)throw new Error("Unknown connection type: "+t);n=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(a.ns=e.namespace);const i=[];return Mm(a,(e,t)=>{i.push(e+"="+t)}),n+i.join("&")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{constructor(){this.counters_={}}incrementCounter(e,t=1){Jr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return _r(this.counters_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zm={},Xm={};function ef(e){const t=e.toString();return Zm[t]||(Zm[t]=new Qm),Zm[t]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class tf{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Bm(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const af="start";class nf{constructor(e,t,a,n,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=a,this.appCheckToken=n,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Em(e),this.stats_=ef(t),this.urlFn=e=>(this.appCheckToken&&(e[Hm]=this.appCheckToken),Ym(t,Km,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new tf(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const a=function(){document.body?t||(t=!0,e()):setTimeout(a,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&a()}),window.attachEvent("onload",a))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new sf((...e)=>{const[t,a,n,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===af)this.id=a,this.password=n;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{const[t,a]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,a)},()=>{this.onClosed_()},this.urlFn);const e={};e[af]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[Hm]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Wm.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){nf.forceAllow_=!0}static forceDisallow(){nf.forceDisallow_=!0}static isAvailable(){return!!nf.forceAllow_||!(nf.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Gr(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const a=br(t),n=Lm(a,1840);for(let i=0;i<n.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const a={dframe:"t"};a.id=e,a.pw=t,this.myDisconnFrame.src=this.urlFn(a),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Gr(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class sf{constructor(e,t,a,n){this.onDisconnect=a,this.urlFn=n,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=bm(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=sf.createIFrame_();let a="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){a='<script>document.domain="'+document.domain+'";<\/script>'}const n="<html><body>"+a+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(n),this.myIFrame.doc.close()}catch(i){Cm("frame writing exception"),i.stack&&Cm(i.stack),Cm(i)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Cm("No IE domain setting required")}catch(t){const a=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+a+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),a="",n=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+a.length<=1870))break;{const e=this.pendingSegs.shift();a=a+"&seg"+n+"="+e.seg+"&ts"+n+"="+e.ts+"&d"+n+"="+e.d,n++}}return t+=a,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,a){this.pendingSegs.push({seg:e,ts:t,d:a}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const a=()=>{this.outstandingRequests.delete(t),this.newRequest_()},n=setTimeout(a,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(n),a()})}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const a=this.myIFrame.doc.createElement("script");a.type="text/javascript",a.async=!0,a.src=e,a.onload=a.onreadystatechange=function(){const e=a.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,a.parentNode&&a.parentNode.removeChild(a),t())},a.onerror=()=>{Cm("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(a)}catch(a){}},Math.floor(1))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let of=null;"undefined"!=typeof MozWebSocket?of=MozWebSocket:"undefined"!=typeof WebSocket&&(of=WebSocket);class rf{constructor(e,t,a,n,i,s,o){this.connId=e,this.applicationId=a,this.appCheckToken=n,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Em(this.connId),this.stats_=ef(t),this.connURL=rf.connectionURL_(t,s,o,n,a),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,a,n,i){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&Wm.test(location.hostname)&&(s.r="f"),t&&(s.s=t),a&&(s.ls=a),n&&(s[Hm]=n),i&&(s.p=i),Ym(e,Gm,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,fm.set("previous_websocket_failure",!0);try{let e;this.mySock=new of(this.connURL,[],e)}catch(a){this.log_("Error instantiating WebSocket.");const e=a.message||a.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){rf.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,a=navigator.userAgent.match(t);a&&a.length>1&&parseFloat(a[1])<4.4&&(e=!0)}return!e&&null!==of&&!rf.forceDisallow_}static previouslyFailed(){return fm.isInMemoryStorage||!0===fm.get("previous_websocket_failure")}markConnectionHealthy(){fm.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=Hr(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(pr(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=Gr(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const a=Lm(t,16384);a.length>1&&this.sendString_(String(a.length));for(let n=0;n<a.length;n++)this.sendString_(a[n])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}rf.responsesRequiredToBeHealthy=2,rf.healthyTimeout=3e4;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class lf{static get ALL_TRANSPORTS(){return[nf,rf]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=rf&&rf.isAvailable();let a=t&&!rf.previouslyFailed();if(e.webSocketOnly&&(t||Tm("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),a=!0),a)this.transports_=[rf];else{const e=this.transports_=[];for(const t of lf.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);lf.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}lf.globalTransportInitialized_=!1;class cf{constructor(e,t,a,n,i,s,o,r,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=a,this.appCheckToken_=n,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=r,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Em("c:"+this.id+":"),this.transportManager_=new lf(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),a=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,a)},Math.floor(0));const n=e.healthyTimeout||0;n>0&&(this.healthyTimeout_=jm(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(n)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Dm("t",e),a=Dm("d",e);if("c"===t)this.onSecondaryControl_(a);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(a)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Dm("t",e),a=Dm("d",e);"c"===t?this.onControl_(a):"d"===t&&this.onDataMessage_(a)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Dm("t",e);if("d"in e){const a=e.d;if("h"===t){const e={...a};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(a):"r"===t?this.onReset_(a):"e"===t?Im("Server Error: "+a):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Im("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,a=e.v,n=e.h;this.sessionId=e.s,this.repoInfo_.host=n,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==a&&Tm("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),a=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,a),jm(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):jm(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(fm.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class df{put(e,t,a,n){}merge(e,t,a,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,a){}onDisconnectMerge(e,t,a){}onDisconnectCancel(e,t){}reportStats(e){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{constructor(e){this.allowedEvents_=e,this.listeners_={},pr(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const a=[...this.listeners_[e]];for(let e=0;e<a.length;e++)a[e].callback.apply(a[e].context,t)}}on(e,t,a){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:a});const n=this.getInitialEvent(e);n&&t.apply(a,n)}off(e,t,a){this.validateEventType_(e);const n=this.listeners_[e]||[];for(let i=0;i<n.length;i++)if(n[i].callback===t&&(!a||a===n[i].context))return void n.splice(i,1)}validateEventType_(e){pr(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hf extends uf{static getInstance(){return new hf}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Fr()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return pr("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function mf(){return new pf("")}function ff(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function vf(e){return e.pieces_.length-e.pieceNum_}function gf(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new pf(e.pieces_,t)}function bf(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function wf(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function yf(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let a=e.pieceNum_;a<e.pieces_.length-1;a++)t.push(e.pieces_[a]);return new pf(t,0)}function _f(e,t){const a=[];for(let n=e.pieceNum_;n<e.pieces_.length;n++)a.push(e.pieces_[n]);if(t instanceof pf)for(let n=t.pieceNum_;n<t.pieces_.length;n++)a.push(t.pieces_[n]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&a.push(e[t])}return new pf(a,0)}function kf(e){return e.pieceNum_>=e.pieces_.length}function Cf(e,t){const a=ff(e),n=ff(t);if(null===a)return t;if(a===n)return Cf(gf(e),gf(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Ef(e,t){if(vf(e)!==vf(t))return!1;for(let a=e.pieceNum_,n=t.pieceNum_;a<=e.pieces_.length;a++,n++)if(e.pieces_[a]!==t.pieces_[n])return!1;return!0}function If(e,t){let a=e.pieceNum_,n=t.pieceNum_;if(vf(e)>vf(t))return!1;for(;a<e.pieces_.length;){if(e.pieces_[a]!==t.pieces_[n])return!1;++a,++n}return!0}class Sf{constructor(e,t){this.errorPrefix_=t,this.parts_=wf(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let a=0;a<this.parts_.length;a++)this.byteLength_+=ol(this.parts_[a]);Tf(this)}}function Tf(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Nf(e))}function Nf(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf extends uf{static getInstance(){return new Pf}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return pr("visible"===e,"Unknown event type: "+e),[this.visible_]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Af=1e3;class xf extends df{constructor(e,t,a,n,i,s,o,r){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=a,this.onConnectStatus_=n,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=r,this.id=xf.nextPersistentConnectionId_++,this.log_=Em("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Af,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,r)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Pf.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&hf.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,a){const n=++this.requestNumber_,i={r:n,a:e,b:t};this.log_(Gr(i)),pr(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),a&&(this.requestCBHash_[n]=a)}get(e){this.initConnection_();const t=new Ar,a={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const a=e.d;"ok"===e.s?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(a),this.outstandingGetCount_++;const n=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(n),t.promise}listen(e,t,a,n){this.initConnection_();const i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),pr(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),pr(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");const o={onComplete:n,hashFn:t,query:e,tag:a};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,a=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(a)})}sendListen_(e){const t=e.query,a=t._path.toString(),n=t._queryIdentifier;this.log_("Listen on "+a+" for "+n);const i={p:a};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,i=>{const s=i.d,o=i.s;xf.warnOnListenWarnings_(s,t);(this.listens.get(a)&&this.listens.get(a).get(n))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(a,n),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&Jr(e,"w")){const a=Yr(e,"w");if(Array.isArray(a)&&~a.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',a=t._path.toString();Tm(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${a} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=Kr(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=Kr(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",a={cred:e};null===this.authOverride_?a.noauth=!0:"object"==typeof this.authOverride_&&(a.authvar=this.authOverride_),this.sendRequest(t,a,t=>{const a=t.s,n=t.d||"error";this.authToken_===e&&("ok"===a?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(a,n))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,a=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,a)})}unlisten(e,t){const a=e._path.toString(),n=e._queryIdentifier;this.log_("Unlisten called for "+a+" "+n),pr(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(a,n)&&this.connected_&&this.sendUnlisten_(a,n,e._queryObject,t)}sendUnlisten_(e,t,a,n){this.log_("Unlisten on "+e+" for "+t);const i={p:e};n&&(i.q=a,i.t=n),this.sendRequest("n",i)}onDisconnectPut(e,t,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,a):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:a})}onDisconnectMerge(e,t,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,a):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:a})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,a,n){const i={p:t,d:a};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{n&&setTimeout(()=>{n(e.s,e.d)},Math.floor(0))})}put(e,t,a,n){this.putInternal("p",e,t,a,n)}merge(e,t,a,n){this.putInternal("m",e,t,a,n)}putInternal(e,t,a,n,i){this.initConnection_();const s={p:t,d:a};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:n}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,a=this.outstandingPuts_[e].request,n=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,a,a=>{this.log_(t+" response",a),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),n&&n(a.s,a.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Gr(e));const t=e.r,a=this.requestCBHash_[t];a&&(delete this.requestCBHash_[t],a(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Im("Unrecognized action received from server: "+Gr(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){pr(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Af,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Af,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Af),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),a=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+xf.nextConnectionId_++,s=this.lastSessionId;let o=!1,r=null;const l=function(){r?r.close():(o=!0,n())},c=function(e){pr(r,"sendRequest call when we're not connected not allowed."),r.sendRequest(e)};this.realtime_={close:l,sendRequest:c};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[e,l]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);o?Cm("getToken() completed but was canceled"):(Cm("getToken() completed. Creating connection."),this.authToken_=e&&e.accessToken,this.appCheckToken_=l&&l.token,r=new cf(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,a,n,e=>{Tm(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&Tm(e),l())}}}interrupt(e){Cm("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Cm("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Qr(this.interruptReasons_)&&(this.reconnectDelay_=Af,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let a;a=t?t.map(e=>Om(e)).join("$"):"default";const n=this.removeListen_(e,a);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(e,t){const a=new pf(e).toString();let n;if(this.listens.has(a)){const e=this.listens.get(a);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(a)}else n=void 0;return n}onAuthRevoked_(e,t){Cm("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Cm("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+dm.replace(/\./g,"-")]=1,Fr()?e["framework.cordova"]=1:qr()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=hf.getInstance().currentlyOnline();return Qr(this.interruptReasons_)&&e}}xf.nextPersistentConnectionId_=0,xf.nextConnectionId_=0;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Rf{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Rf(e,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Df{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const a=new Rf(Pm,e),n=new Rf(Pm,t);return 0!==this.compare(a,n)}minPost(){return Rf.MIN}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Of;class Lf extends Df{static get __EMPTY_NODE(){return Of}static set __EMPTY_NODE(e){Of=e}compare(e,t){return xm(e.name,t.name)}isDefinedOn(e){throw mr("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Rf.MIN}maxPost(){return new Rf(Am,Of)}makePost(e,t){return pr("string"==typeof e,"KeyIndex indexValue must always be a string."),new Rf(e,Of)}toString(){return".key"}}const Mf=new Lf;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uf{constructor(e,t,a,n,i=null){this.isReverse_=n,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?a(e.key,t):1,n&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Ff{constructor(e,t,a,n,i){this.key=e,this.value=t,this.color=null!=a?a:Ff.RED,this.left=null!=n?n:qf.EMPTY_NODE,this.right=null!=i?i:qf.EMPTY_NODE}copy(e,t,a,n,i){return new Ff(null!=e?e:this.key,null!=t?t:this.value,null!=a?a:this.color,null!=n?n:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,a){let n=this;const i=a(e,n.key);return n=i<0?n.copy(null,null,null,n.left.insert(e,t,a),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,a)),n.fixUp_()}removeMin_(){if(this.left.isEmpty())return qf.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let a,n;if(a=this,t(e,a.key)<0)a.left.isEmpty()||a.left.isRed_()||a.left.left.isRed_()||(a=a.moveRedLeft_()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed_()&&(a=a.rotateRight_()),a.right.isEmpty()||a.right.isRed_()||a.right.left.isRed_()||(a=a.moveRedRight_()),0===t(e,a.key)){if(a.right.isEmpty())return qf.EMPTY_NODE;n=a.right.min_(),a=a.copy(n.key,n.value,null,null,a.right.removeMin_())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Ff.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Ff.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Ff.RED=!0,Ff.BLACK=!1;class qf{constructor(e,t=qf.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new qf(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ff.BLACK,null,null))}remove(e){return new qf(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ff.BLACK,null,null))}get(e){let t,a=this.root_;for(;!a.isEmpty();){if(t=this.comparator_(e,a.key),0===t)return a.value;t<0?a=a.left:t>0&&(a=a.right)}return null}getPredecessorKey(e){let t,a=this.root_,n=null;for(;!a.isEmpty();){if(t=this.comparator_(e,a.key),0===t){if(a.left.isEmpty())return n?n.key:null;for(a=a.left;!a.right.isEmpty();)a=a.right;return a.key}t<0?a=a.left:t>0&&(n=a,a=a.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Uf(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Uf(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Uf(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Uf(this.root_,null,this.comparator_,!0,e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Bf(e,t){return xm(e.name,t.name)}function jf(e,t){return xm(e,t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $f;qf.EMPTY_NODE=new class{copy(e,t,a,n,i){return this}insert(e,t,a){return new Ff(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const zf=function(e){return"number"==typeof e?"number:"+Um(e):"string:"+e},Vf=function(e){if(e.isLeafNode()){const t=e.val();pr("string"==typeof t||"number"==typeof t||"object"==typeof t&&Jr(t,".sv"),"Priority must be a string or number.")}else pr(e===$f||e.isEmpty(),"priority of unexpected type.");pr(e===$f||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let Wf,Hf,Gf;class Kf{static set __childrenNodeConstructor(e){Wf=e}static get __childrenNodeConstructor(){return Wf}constructor(e,t=Kf.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,pr(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Vf(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Kf(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Kf.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return kf(e)?this:".priority"===ff(e)?this.priorityNode_:Kf.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Kf.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const a=ff(e);return null===a?t:t.isEmpty()&&".priority"!==a?this:(pr(".priority"!==a||1===vf(e),".priority must be the last token in a path"),this.updateImmediateChild(a,Kf.__childrenNodeConstructor.EMPTY_NODE.updateChild(gf(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+zf(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?Um(this.value_):this.value_,this.lazyHash_=wm(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Kf.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Kf.__childrenNodeConstructor?-1:(pr(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,a=typeof this.value_,n=Kf.VALUE_TYPE_ORDER.indexOf(t),i=Kf.VALUE_TYPE_ORDER.indexOf(a);return pr(n>=0,"Unknown leaf type: "+t),pr(i>=0,"Unknown leaf type: "+a),n===i?"object"===a?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-n}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}Kf.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Jf=new class extends Df{compare(e,t){const a=e.node.getPriority(),n=t.node.getPriority(),i=a.compareTo(n);return 0===i?xm(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Rf.MIN}maxPost(){return new Rf(Am,new Kf("[PRIORITY-POST]",Gf))}makePost(e,t){const a=Hf(e);return new Rf(t,new Kf("[PRIORITY-POST]",a))}toString(){return".priority"}},Yf=Math.log(2);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Yf,10)),this.current_=this.count-1;const a=(n=this.count,parseInt(Array(n+1).join("1"),2));var n;this.bits_=e+1&a}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Zf=function(e,t,a,n){e.sort(t);const i=function(t,n){const s=n-t;let o,r;if(0===s)return null;if(1===s)return o=e[t],r=a?a(o):o,new Ff(r,o.node,Ff.BLACK,null,null);{const l=parseInt(s/2,10)+t,c=i(t,l),d=i(l+1,n);return o=e[l],r=a?a(o):o,new Ff(r,o.node,Ff.BLACK,c,d)}},s=function(t){let n=null,s=null,o=e.length;const r=function(t,n){const s=o-t,r=o;o-=t;const c=i(s+1,r),d=e[s],u=a?a(d):d;l(new Ff(u,d.node,n,null,c))},l=function(e){n?(n.left=e,n=e):(s=e,n=e)};for(let e=0;e<t.count;++e){const a=t.nextBitIsOne(),n=Math.pow(2,t.count-(e+1));a?r(n,Ff.BLACK):(r(n,Ff.BLACK),r(n,Ff.RED))}return s}(new Qf(e.length));return new qf(n||t,s)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xf;const ev={};class tv{static get Default(){return pr(ev&&Jf,"ChildrenNode.ts has not been loaded"),Xf=Xf||new tv({".priority":ev},{".priority":Jf}),Xf}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Yr(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof qf?t:null}hasIndex(e){return Jr(this.indexSet_,e.toString())}addIndex(e,t){pr(e!==Mf,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const a=[];let n=!1;const i=t.getIterator(Rf.Wrap);let s,o=i.getNext();for(;o;)n=n||e.isDefinedOn(o.node),a.push(o),o=i.getNext();s=n?Zf(a,e.getCompare()):ev;const r=e.toString(),l={...this.indexSet_};l[r]=e;const c={...this.indexes_};return c[r]=s,new tv(c,l)}addToIndexes(e,t){const a=Zr(this.indexes_,(a,n)=>{const i=Yr(this.indexSet_,n);if(pr(i,"Missing index implementation for "+n),a===ev){if(i.isDefinedOn(e.node)){const a=[],n=t.getIterator(Rf.Wrap);let s=n.getNext();for(;s;)s.name!==e.name&&a.push(s),s=n.getNext();return a.push(e),Zf(a,i.getCompare())}return ev}{const n=t.get(e.name);let i=a;return n&&(i=i.remove(new Rf(e.name,n))),i.insert(e,e.node)}});return new tv(a,this.indexSet_)}removeFromIndexes(e,t){const a=Zr(this.indexes_,a=>{if(a===ev)return a;{const n=t.get(e.name);return n?a.remove(new Rf(e.name,n)):a}});return new tv(a,this.indexSet_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let av;class nv{static get EMPTY_NODE(){return av||(av=new nv(new qf(jf),null,tv.Default))}constructor(e,t,a){this.children_=e,this.priorityNode_=t,this.indexMap_=a,this.lazyHash_=null,this.priorityNode_&&Vf(this.priorityNode_),this.children_.isEmpty()&&pr(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||av}updatePriority(e){return this.children_.isEmpty()?this:new nv(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?av:t}}getChild(e){const t=ff(e);return null===t?this:this.getImmediateChild(t).getChild(gf(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(pr(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const a=new Rf(e,t);let n,i;t.isEmpty()?(n=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(a,this.children_)):(n=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(a,this.children_));const s=n.isEmpty()?av:this.priorityNode_;return new nv(n,s,i)}}updateChild(e,t){const a=ff(e);if(null===a)return t;{pr(".priority"!==ff(e)||1===vf(e),".priority must be the last token in a path");const n=this.getImmediateChild(a).updateChild(gf(e),t);return this.updateImmediateChild(a,n)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let a=0,n=0,i=!0;if(this.forEachChild(Jf,(s,o)=>{t[s]=o.val(e),a++,i&&nv.INTEGER_REGEXP_.test(s)?n=Math.max(n,Number(s)):i=!1}),!e&&i&&n<2*a){const e=[];for(const a in t)e[a]=t[a];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+zf(this.getPriority().val())+":"),this.forEachChild(Jf,(t,a)=>{const n=a.hash();""!==n&&(e+=":"+t+":"+n)}),this.lazyHash_=""===e?"":wm(e)}return this.lazyHash_}getPredecessorChildName(e,t,a){const n=this.resolveIndex_(a);if(n){const a=n.getPredecessorKey(new Rf(e,t));return a?a.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Rf(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Rf(t,this.children_.get(t)):null}forEachChild(e,t){const a=this.resolveIndex_(e);return a?a.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const a=this.resolveIndex_(t);if(a)return a.getIteratorFrom(e,e=>e);{const a=this.children_.getIteratorFrom(e.name,Rf.Wrap);let n=a.peek();for(;null!=n&&t.compare(n,e)<0;)a.getNext(),n=a.peek();return a}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const a=this.resolveIndex_(t);if(a)return a.getReverseIteratorFrom(e,e=>e);{const a=this.children_.getReverseIteratorFrom(e.name,Rf.Wrap);let n=a.peek();for(;null!=n&&t.compare(n,e)>0;)a.getNext(),n=a.peek();return a}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===iv?-1:0}withIndex(e){if(e===Mf||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new nv(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Mf||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(Jf),a=t.getIterator(Jf);let n=e.getNext(),i=a.getNext();for(;n&&i;){if(n.name!==i.name||!n.node.equals(i.node))return!1;n=e.getNext(),i=a.getNext()}return null===n&&null===i}return!1}return!1}}resolveIndex_(e){return e===Mf?null:this.indexMap_.get(e.toString())}}nv.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const iv=new class extends nv{constructor(){super(new qf(jf),nv.EMPTY_NODE,tv.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return nv.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Rf,{MIN:{value:new Rf(Pm,nv.EMPTY_NODE)},MAX:{value:new Rf(Am,iv)}}),Lf.__EMPTY_NODE=nv.EMPTY_NODE,Kf.__childrenNodeConstructor=nv,$f=iv,function(e){Gf=e}(iv);function sv(e,t=null){if(null===e)return nv.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),pr(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){return new Kf(e,sv(t))}if(e instanceof Array){let a=nv.EMPTY_NODE;return Mm(e,(t,n)=>{if(Jr(e,t)&&"."!==t.substring(0,1)){const e=sv(n);!e.isLeafNode()&&e.isEmpty()||(a=a.updateImmediateChild(t,e))}}),a.updatePriority(sv(t))}{const a=[];let n=!1;if(Mm(e,(e,t)=>{if("."!==e.substring(0,1)){const i=sv(t);i.isEmpty()||(n=n||!i.getPriority().isEmpty(),a.push(new Rf(e,i)))}}),0===a.length)return nv.EMPTY_NODE;const i=Zf(a,Bf,e=>e.name,jf);if(n){const e=Zf(a,Jf.getCompare());return new nv(i,sv(t),new tv({".priority":e},{".priority":Jf}))}return new nv(i,sv(t),tv.Default)}}!function(e){Hf=e}(sv);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ov extends Df{constructor(e){super(),this.indexPath_=e,pr(!kf(e)&&".priority"!==ff(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const a=this.extractChild(e.node),n=this.extractChild(t.node),i=a.compareTo(n);return 0===i?xm(e.name,t.name):i}makePost(e,t){const a=sv(e),n=nv.EMPTY_NODE.updateChild(this.indexPath_,a);return new Rf(t,n)}maxPost(){const e=nv.EMPTY_NODE.updateChild(this.indexPath_,iv);return new Rf(Am,e)}toString(){return wf(this.indexPath_,0).join("/")}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rv=new class extends Df{compare(e,t){const a=e.node.compareTo(t.node);return 0===a?xm(e.name,t.name):a}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Rf.MIN}maxPost(){return Rf.MAX}makePost(e,t){const a=sv(e);return new Rf(t,a)}toString(){return".value"}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lv(e){return{type:"value",snapshotNode:e}}function cv(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function dv(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function uv(e,t,a){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:a}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class hv{constructor(e){this.index_=e}updateChild(e,t,a,n,i,s){pr(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(n).equals(a.getChild(n))&&o.isEmpty()===a.isEmpty()?e:(null!=s&&(a.isEmpty()?e.hasChild(t)?s.trackChildChange(dv(t,o)):pr(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(cv(t,a)):s.trackChildChange(uv(t,a,o))),e.isLeafNode()&&a.isEmpty()?e:e.updateImmediateChild(t,a).withIndex(this.index_))}updateFullNode(e,t,a){return null!=a&&(e.isLeafNode()||e.forEachChild(Jf,(e,n)=>{t.hasChild(e)||a.trackChildChange(dv(e,n))}),t.isLeafNode()||t.forEachChild(Jf,(t,n)=>{if(e.hasChild(t)){const i=e.getImmediateChild(t);i.equals(n)||a.trackChildChange(uv(t,n,i))}else a.trackChildChange(cv(t,n))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?nv.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pv{constructor(e){this.indexedFilter_=new hv(e.getIndex()),this.index_=e.getIndex(),this.startPost_=pv.getStartPost_(e),this.endPost_=pv.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,a=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&a}updateChild(e,t,a,n,i,s){return this.matches(new Rf(t,a))||(a=nv.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,a,n,i,s)}updateFullNode(e,t,a){t.isLeafNode()&&(t=nv.EMPTY_NODE);let n=t.withIndex(this.index_);n=n.updatePriority(nv.EMPTY_NODE);const i=this;return t.forEachChild(Jf,(e,t)=>{i.matches(new Rf(e,t))||(n=n.updateImmediateChild(e,nv.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,n,a)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mv{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new pv(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,a,n,i,s){return this.rangedFilter_.matches(new Rf(t,a))||(a=nv.EMPTY_NODE),e.getImmediateChild(t).equals(a)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,a,n,i,s):this.fullLimitUpdateChild_(e,t,a,i,s)}updateFullNode(e,t,a){let n;if(t.isLeafNode()||t.isEmpty())n=nv.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;n=nv.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let a=0;for(;e.hasNext()&&a<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;n=n.updateImmediateChild(t.name,t.node),a++}}}else{let e;n=t.withIndex(this.index_),n=n.updatePriority(nv.EMPTY_NODE),e=this.reverse_?n.getReverseIterator(this.index_):n.getIterator(this.index_);let a=0;for(;e.hasNext();){const t=e.getNext();a<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?a++:n=n.updateImmediateChild(t.name,nv.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,n,a)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,a,n,i){let s;if(this.reverse_){const e=this.index_.getCompare();s=(t,a)=>e(a,t)}else s=this.index_.getCompare();const o=e;pr(o.numChildren()===this.limit_,"");const r=new Rf(t,a),l=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),c=this.rangedFilter_.matches(r);if(o.hasChild(t)){const e=o.getImmediateChild(t);let d=n.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=d&&(d.name===t||o.hasChild(d.name));)d=n.getChildAfterChild(this.index_,d,this.reverse_);const u=null==d?1:s(d,r);if(c&&!a.isEmpty()&&u>=0)return null!=i&&i.trackChildChange(uv(t,a,e)),o.updateImmediateChild(t,a);{null!=i&&i.trackChildChange(dv(t,e));const a=o.updateImmediateChild(t,nv.EMPTY_NODE);return null!=d&&this.rangedFilter_.matches(d)?(null!=i&&i.trackChildChange(cv(d.name,d.node)),a.updateImmediateChild(d.name,d.node)):a}}return a.isEmpty()?e:c&&s(l,r)>=0?(null!=i&&(i.trackChildChange(dv(l.name,l.node)),i.trackChildChange(cv(t,a))),o.updateImmediateChild(t,a).updateImmediateChild(l.name,nv.EMPTY_NODE)):e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fv{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Jf}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return pr(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return pr(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Pm}hasEnd(){return this.endSet_}getIndexEndValue(){return pr(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return pr(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Am}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return pr(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Jf}copy(){const e=new fv;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function vv(e){const t={};if(e.isDefault())return t;let a;if(e.index_===Jf?a="$priority":e.index_===rv?a="$value":e.index_===Mf?a="$key":(pr(e.index_ instanceof ov,"Unrecognized index type!"),a=e.index_.toString()),t.orderBy=Gr(a),e.startSet_){const a=e.startAfterSet_?"startAfter":"startAt";t[a]=Gr(e.indexStartValue_),e.startNameSet_&&(t[a]+=","+Gr(e.indexStartName_))}if(e.endSet_){const a=e.endBeforeSet_?"endBefore":"endAt";t[a]=Gr(e.indexEndValue_),e.endNameSet_&&(t[a]+=","+Gr(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function gv(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let a=e.viewFrom_;""===a&&(a=e.isViewFromLeft()?"l":"r"),t.vf=a}return e.index_!==Jf&&(t.i=e.index_.toString()),t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bv extends df{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(pr(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,a,n){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=a,this.appCheckTokenProvider_=n,this.log_=Em("p:rest:"),this.listens_={}}listen(e,t,a,n){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const s=bv.getListenId_(e,a),o={};this.listens_[s]=o;const r=vv(e._queryParams);this.restRequest_(i+".json",r,(e,t)=>{let r=t;if(404===e&&(r=null,e=null),null===e&&this.onDataUpdate_(i,r,!1,a),Yr(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",n(t,null)}})}unlisten(e,t){const a=bv.getListenId_(e,t);delete this.listens_[a]}get(e){const t=vv(e._queryParams),a=e._path.toString(),n=new Ar;return this.restRequest_(a+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(a,i,!1,null),n.resolve(i)):n.reject(new Error(i))}),n.promise}refreshAuthToken(e){}restRequest_(e,t={},a){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([n,i])=>{n&&n.accessToken&&(t.auth=n.accessToken),i&&i.token&&(t.ac=i.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+tl(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(a&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let t=null;if(o.status>=200&&o.status<300){try{t=Hr(o.responseText)}catch(e){Tm("Failed to parse JSON response for "+s+": "+o.responseText)}a(null,t)}else 401!==o.status&&404!==o.status&&Tm("Got unsuccessful REST response for "+s+" Status: "+o.status),a(o.status);a=null}},o.open("GET",s,!0),o.send()})}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv{constructor(){this.rootNode_=nv.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yv(){return{value:null,children:new Map}}function _v(e,t,a){if(kf(t))e.value=a,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,a);else{const n=ff(t);e.children.has(n)||e.children.set(n,yv());_v(e.children.get(n),t=gf(t),a)}}function kv(e,t,a){null!==e.value?a(t,e.value):function(e,t){e.children.forEach((e,a)=>{t(a,e)})}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,(e,n)=>{kv(n,new pf(t.toString()+"/"+e),a)})}class Cv{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&Mm(this.last_,(e,a)=>{t[e]=t[e]-a}),this.last_=e,t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ev{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Cv(e);const a=1e4+2e4*Math.random();jm(this.reportStats_.bind(this),Math.floor(a))}reportStats_(){const e=this.statsListener_.get(),t={};let a=!1;Mm(e,(e,n)=>{n>0&&Jr(this.statsToReport_,e)&&(t[e]=n,a=!0)}),a&&this.server_.reportStats(t),jm(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Iv,Sv;function Tv(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(Sv=Iv||(Iv={}))[Sv.OVERWRITE=0]="OVERWRITE",Sv[Sv.MERGE=1]="MERGE",Sv[Sv.ACK_USER_WRITE=2]="ACK_USER_WRITE",Sv[Sv.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class Nv{constructor(e,t,a){this.path=e,this.affectedTree=t,this.revert=a,this.type=Iv.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(kf(this.path)){if(null!=this.affectedTree.value)return pr(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new pf(e));return new Nv(mf(),t,this.revert)}}return pr(ff(this.path)===e,"operationForChild called for unrelated child."),new Nv(gf(this.path),this.affectedTree,this.revert)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pv{constructor(e,t){this.source=e,this.path=t,this.type=Iv.LISTEN_COMPLETE}operationForChild(e){return kf(this.path)?new Pv(this.source,mf()):new Pv(this.source,gf(this.path))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Av{constructor(e,t,a){this.source=e,this.path=t,this.snap=a,this.type=Iv.OVERWRITE}operationForChild(e){return kf(this.path)?new Av(this.source,mf(),this.snap.getImmediateChild(e)):new Av(this.source,gf(this.path),this.snap)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xv{constructor(e,t,a){this.source=e,this.path=t,this.children=a,this.type=Iv.MERGE}operationForChild(e){if(kf(this.path)){const t=this.children.subtree(new pf(e));return t.isEmpty()?null:t.value?new Av(this.source,mf(),t.value):new xv(this.source,mf(),t)}return pr(ff(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new xv(this.source,gf(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rv{constructor(e,t,a){this.node_=e,this.fullyInitialized_=t,this.filtered_=a}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(kf(e))return this.isFullyInitialized()&&!this.filtered_;const t=ff(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dv{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Ov(e,t,a,n,i,s){const o=n.filter(e=>e.type===a);o.sort((t,a)=>function(e,t,a){if(null==t.childName||null==a.childName)throw mr("Should only compare child_ events.");const n=new Rf(t.childName,t.snapshotNode),i=new Rf(a.childName,a.snapshotNode);return e.index_.compare(n,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,a)),o.forEach(a=>{const n=function(e,t,a){return"value"===t.type||"child_removed"===t.type||(t.prevName=a.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,a,s);i.forEach(i=>{i.respondsTo(a.type)&&t.push(i.createEvent(n,e.query_))})})}function Lv(e,t){return{eventCache:e,serverCache:t}}function Mv(e,t,a,n){return Lv(new Rv(t,a,n),e.serverCache)}function Uv(e,t,a,n){return Lv(e.eventCache,new Rv(t,a,n))}function Fv(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function qv(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bv;class jv{static fromObject(e){let t=new jv(null);return Mm(e,(e,a)=>{t=t.set(new pf(e),a)}),t}constructor(e,t=(()=>(Bv||(Bv=new qf(Rm)),Bv))()){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:mf(),value:this.value};if(kf(e))return null;{const a=ff(e),n=this.children.get(a);if(null!==n){const i=n.findRootMostMatchingPathAndValue(gf(e),t);if(null!=i){return{path:_f(new pf(a),i.path),value:i.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(kf(e))return this;{const t=ff(e),a=this.children.get(t);return null!==a?a.subtree(gf(e)):new jv(null)}}set(e,t){if(kf(e))return new jv(t,this.children);{const a=ff(e),n=(this.children.get(a)||new jv(null)).set(gf(e),t),i=this.children.insert(a,n);return new jv(this.value,i)}}remove(e){if(kf(e))return this.children.isEmpty()?new jv(null):new jv(null,this.children);{const t=ff(e),a=this.children.get(t);if(a){const n=a.remove(gf(e));let i;return i=n.isEmpty()?this.children.remove(t):this.children.insert(t,n),null===this.value&&i.isEmpty()?new jv(null):new jv(this.value,i)}return this}}get(e){if(kf(e))return this.value;{const t=ff(e),a=this.children.get(t);return a?a.get(gf(e)):null}}setTree(e,t){if(kf(e))return t;{const a=ff(e),n=(this.children.get(a)||new jv(null)).setTree(gf(e),t);let i;return i=n.isEmpty()?this.children.remove(a):this.children.insert(a,n),new jv(this.value,i)}}fold(e){return this.fold_(mf(),e)}fold_(e,t){const a={};return this.children.inorderTraversal((n,i)=>{a[n]=i.fold_(_f(e,n),t)}),t(e,this.value,a)}findOnPath(e,t){return this.findOnPath_(e,mf(),t)}findOnPath_(e,t,a){const n=!!this.value&&a(t,this.value);if(n)return n;if(kf(e))return null;{const n=ff(e),i=this.children.get(n);return i?i.findOnPath_(gf(e),_f(t,n),a):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,mf(),t)}foreachOnPath_(e,t,a){if(kf(e))return this;{this.value&&a(t,this.value);const n=ff(e),i=this.children.get(n);return i?i.foreachOnPath_(gf(e),_f(t,n),a):new jv(null)}}foreach(e){this.foreach_(mf(),e)}foreach_(e,t){this.children.inorderTraversal((a,n)=>{n.foreach_(_f(e,a),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,a)=>{a.value&&e(t,a.value)})}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $v{constructor(e){this.writeTree_=e}static empty(){return new $v(new jv(null))}}function zv(e,t,a){if(kf(t))return new $v(new jv(a));{const n=e.writeTree_.findRootMostValueAndPath(t);if(null!=n){const i=n.path;let s=n.value;const o=Cf(i,t);return s=s.updateChild(o,a),new $v(e.writeTree_.set(i,s))}{const n=new jv(a),i=e.writeTree_.setTree(t,n);return new $v(i)}}}function Vv(e,t,a){let n=e;return Mm(a,(e,a)=>{n=zv(n,_f(t,e),a)}),n}function Wv(e,t){if(kf(t))return $v.empty();{const a=e.writeTree_.setTree(t,new jv(null));return new $v(a)}}function Hv(e,t){return null!=Gv(e,t)}function Gv(e,t){const a=e.writeTree_.findRootMostValueAndPath(t);return null!=a?e.writeTree_.get(a.path).getChild(Cf(a.path,t)):null}function Kv(e){const t=[],a=e.writeTree_.value;return null!=a?a.isLeafNode()||a.forEachChild(Jf,(e,a)=>{t.push(new Rf(e,a))}):e.writeTree_.children.inorderTraversal((e,a)=>{null!=a.value&&t.push(new Rf(e,a.value))}),t}function Jv(e,t){if(kf(t))return e;{const a=Gv(e,t);return new $v(null!=a?new jv(a):e.writeTree_.subtree(t))}}function Yv(e){return e.writeTree_.isEmpty()}function Qv(e,t){return Zv(mf(),e.writeTree_,t)}function Zv(e,t,a){if(null!=t.value)return a.updateChild(e,t.value);{let n=null;return t.children.inorderTraversal((t,i)=>{".priority"===t?(pr(null!==i.value,"Priority writes must always be leaf nodes"),n=i.value):a=Zv(_f(e,t),i,a)}),a.getChild(e).isEmpty()||null===n||(a=a.updateChild(_f(e,".priority"),n)),a}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xv(e,t){return hg(t,e)}function eg(e,t){const a=e.allWrites.findIndex(e=>e.writeId===t);pr(a>=0,"removeWrite called with nonexistent writeId.");const n=e.allWrites[a];e.allWrites.splice(a,1);let i=n.visible,s=!1,o=e.allWrites.length-1;for(;i&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=a&&tg(t,n.path)?i=!1:If(n.path,t.path)&&(s=!0)),o--}if(i){if(s)return function(e){e.visibleWrites=ng(e.allWrites,ag,mf()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(n.snap)e.visibleWrites=Wv(e.visibleWrites,n.path);else{Mm(n.children,t=>{e.visibleWrites=Wv(e.visibleWrites,_f(n.path,t))})}return!0}return!1}function tg(e,t){if(e.snap)return If(e.path,t);for(const a in e.children)if(e.children.hasOwnProperty(a)&&If(_f(e.path,a),t))return!0;return!1}function ag(e){return e.visible}function ng(e,t,a){let n=$v.empty();for(let i=0;i<e.length;++i){const s=e[i];if(t(s)){const e=s.path;let t;if(s.snap)If(a,e)?(t=Cf(a,e),n=zv(n,t,s.snap)):If(e,a)&&(t=Cf(e,a),n=zv(n,mf(),s.snap.getChild(t)));else{if(!s.children)throw mr("WriteRecord should have .snap or .children");if(If(a,e))t=Cf(a,e),n=Vv(n,t,s.children);else if(If(e,a))if(t=Cf(e,a),kf(t))n=Vv(n,mf(),s.children);else{const e=Yr(s.children,ff(t));if(e){const a=e.getChild(gf(t));n=zv(n,mf(),a)}}}}}return n}function ig(e,t,a,n,i){if(n||i){const s=Jv(e.visibleWrites,t);if(!i&&Yv(s))return a;if(i||null!=a||Hv(s,mf())){const s=function(e){return(e.visible||i)&&(!n||!~n.indexOf(e.writeId))&&(If(e.path,t)||If(t,e.path))};return Qv(ng(e.allWrites,s,t),a||nv.EMPTY_NODE)}return null}{const n=Gv(e.visibleWrites,t);if(null!=n)return n;{const n=Jv(e.visibleWrites,t);if(Yv(n))return a;if(null!=a||Hv(n,mf())){return Qv(n,a||nv.EMPTY_NODE)}return null}}}function sg(e,t,a,n){return ig(e.writeTree,e.treePath,t,a,n)}function og(e,t){return function(e,t,a){let n=nv.EMPTY_NODE;const i=Gv(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(Jf,(e,t)=>{n=n.updateImmediateChild(e,t)}),n;if(a){const i=Jv(e.visibleWrites,t);return a.forEachChild(Jf,(e,t)=>{const a=Qv(Jv(i,new pf(e)),t);n=n.updateImmediateChild(e,a)}),Kv(i).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}return Kv(Jv(e.visibleWrites,t)).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}(e.writeTree,e.treePath,t)}function rg(e,t,a,n){return function(e,t,a,n,i){pr(n||i,"Either existingEventSnap or existingServerSnap must exist");const s=_f(t,a);if(Hv(e.visibleWrites,s))return null;{const t=Jv(e.visibleWrites,s);return Yv(t)?i.getChild(a):Qv(t,i.getChild(a))}}(e.writeTree,e.treePath,t,a,n)}function lg(e,t){return function(e,t){return Gv(e.visibleWrites,t)}(e.writeTree,_f(e.treePath,t))}function cg(e,t,a,n,i,s){return function(e,t,a,n,i,s,o){let r;const l=Jv(e.visibleWrites,t),c=Gv(l,mf());if(null!=c)r=c;else{if(null==a)return[];r=Qv(l,a)}if(r=r.withIndex(o),r.isEmpty()||r.isLeafNode())return[];{const e=[],t=o.getCompare(),a=s?r.getReverseIteratorFrom(n,o):r.getIteratorFrom(n,o);let l=a.getNext();for(;l&&e.length<i;)0!==t(l,n)&&e.push(l),l=a.getNext();return e}}(e.writeTree,e.treePath,t,a,n,i,s)}function dg(e,t,a){return function(e,t,a,n){const i=_f(t,a),s=Gv(e.visibleWrites,i);if(null!=s)return s;if(n.isCompleteForChild(a))return Qv(Jv(e.visibleWrites,i),n.getNode().getImmediateChild(a));return null}(e.writeTree,e.treePath,t,a)}function ug(e,t){return hg(_f(e.treePath,t),e.writeTree)}function hg(e,t){return{treePath:e,writeTree:t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pg{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,a=e.childName;pr("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),pr(".priority"!==a,"Only non-priority child changes can be tracked.");const n=this.changeMap.get(a);if(n){const i=n.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(a,uv(a,e.snapshotNode,n.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(a);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(a,dv(a,n.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(a,cv(a,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw mr("Illegal combination of changes: "+e+" occurred after "+n);this.changeMap.set(a,uv(a,e.snapshotNode,n.oldSnap))}}else this.changeMap.set(a,e)}getChanges(){return Array.from(this.changeMap.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mg=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,a){return null}};class fg{constructor(e,t,a=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=a}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Rv(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return dg(this.writes_,e,t)}}getChildAfterChild(e,t,a){const n=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:qv(this.viewCache_),i=cg(this.writes_,n,t,1,a,e);return 0===i.length?null:i[0]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vg(e,t,a,n,i){const s=new pg;let o,r;if(a.type===Iv.OVERWRITE){const l=a;l.source.fromUser?o=wg(e,t,l.path,l.snap,n,i,s):(pr(l.source.fromServer,"Unknown source."),r=l.source.tagged||t.serverCache.isFiltered()&&!kf(l.path),o=bg(e,t,l.path,l.snap,n,i,r,s))}else if(a.type===Iv.MERGE){const l=a;l.source.fromUser?o=function(e,t,a,n,i,s,o){let r=t;return n.foreach((n,l)=>{const c=_f(a,n);yg(t,ff(c))&&(r=wg(e,r,c,l,i,s,o))}),n.foreach((n,l)=>{const c=_f(a,n);yg(t,ff(c))||(r=wg(e,r,c,l,i,s,o))}),r}(e,t,l.path,l.children,n,i,s):(pr(l.source.fromServer,"Unknown source."),r=l.source.tagged||t.serverCache.isFiltered(),o=kg(e,t,l.path,l.children,n,i,r,s))}else if(a.type===Iv.ACK_USER_WRITE){const r=a;o=r.revert?function(e,t,a,n,i,s){let o;if(null!=lg(n,a))return t;{const r=new fg(n,t,i),l=t.eventCache.getNode();let c;if(kf(a)||".priority"===ff(a)){let a;if(t.serverCache.isFullyInitialized())a=sg(n,qv(t));else{const e=t.serverCache.getNode();pr(e instanceof nv,"serverChildren would be complete if leaf node"),a=og(n,e)}c=e.filter.updateFullNode(l,a,s)}else{const i=ff(a);let d=dg(n,i,t.serverCache);null==d&&t.serverCache.isCompleteForChild(i)&&(d=l.getImmediateChild(i)),c=null!=d?e.filter.updateChild(l,i,d,gf(a),r,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(l,i,nv.EMPTY_NODE,gf(a),r,s):l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=sg(n,qv(t)),o.isLeafNode()&&(c=e.filter.updateFullNode(c,o,s)))}return o=t.serverCache.isFullyInitialized()||null!=lg(n,mf()),Mv(t,c,o,e.filter.filtersNodes())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,r.path,n,i,s):function(e,t,a,n,i,s,o){if(null!=lg(i,a))return t;const r=t.serverCache.isFiltered(),l=t.serverCache;if(null!=n.value){if(kf(a)&&l.isFullyInitialized()||l.isCompleteForPath(a))return bg(e,t,a,l.getNode().getChild(a),i,s,r,o);if(kf(a)){let n=new jv(null);return l.getNode().forEachChild(Mf,(e,t)=>{n=n.set(new pf(e),t)}),kg(e,t,a,n,i,s,r,o)}return t}{let c=new jv(null);return n.foreach((e,t)=>{const n=_f(a,e);l.isCompleteForPath(n)&&(c=c.set(e,l.getNode().getChild(n)))}),kg(e,t,a,c,i,s,r,o)}}(e,t,r.path,r.affectedTree,n,i,s)}else{if(a.type!==Iv.LISTEN_COMPLETE)throw mr("Unknown operation type: "+a.type);o=function(e,t,a,n,i){const s=t.serverCache,o=Uv(t,s.getNode(),s.isFullyInitialized()||kf(a),s.isFiltered());return gg(e,o,a,n,mg,i)}(e,t,a.path,n,s)}const l=s.getChanges();return function(e,t,a){const n=t.eventCache;if(n.isFullyInitialized()){const i=n.getNode().isLeafNode()||n.getNode().isEmpty(),s=Fv(e);(a.length>0||!e.eventCache.isFullyInitialized()||i&&!n.getNode().equals(s)||!n.getNode().getPriority().equals(s.getPriority()))&&a.push(lv(Fv(t)))}}(t,o,l),{viewCache:o,changes:l}}function gg(e,t,a,n,i,s){const o=t.eventCache;if(null!=lg(n,a))return t;{let r,l;if(kf(a))if(pr(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const a=qv(t),i=og(n,a instanceof nv?a:nv.EMPTY_NODE);r=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{const a=sg(n,qv(t));r=e.filter.updateFullNode(t.eventCache.getNode(),a,s)}else{const c=ff(a);if(".priority"===c){pr(1===vf(a),"Can't have a priority with additional path components");const i=o.getNode();l=t.serverCache.getNode();const s=rg(n,a,i,l);r=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{const d=gf(a);let u;if(o.isCompleteForChild(c)){l=t.serverCache.getNode();const e=rg(n,a,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(c).updateChild(d,e):o.getNode().getImmediateChild(c)}else u=dg(n,c,t.serverCache);r=null!=u?e.filter.updateChild(o.getNode(),c,u,d,i,s):o.getNode()}}return Mv(t,r,o.isFullyInitialized()||kf(a),e.filter.filtersNodes())}}function bg(e,t,a,n,i,s,o,r){const l=t.serverCache;let c;const d=o?e.filter:e.filter.getIndexedFilter();if(kf(a))c=d.updateFullNode(l.getNode(),n,null);else if(d.filtersNodes()&&!l.isFiltered()){const e=l.getNode().updateChild(a,n);c=d.updateFullNode(l.getNode(),e,null)}else{const e=ff(a);if(!l.isCompleteForPath(a)&&vf(a)>1)return t;const i=gf(a),s=l.getNode().getImmediateChild(e).updateChild(i,n);c=".priority"===e?d.updatePriority(l.getNode(),s):d.updateChild(l.getNode(),e,s,i,mg,null)}const u=Uv(t,c,l.isFullyInitialized()||kf(a),d.filtersNodes());return gg(e,u,a,i,new fg(i,u,s),r)}function wg(e,t,a,n,i,s,o){const r=t.eventCache;let l,c;const d=new fg(i,t,s);if(kf(a))c=e.filter.updateFullNode(t.eventCache.getNode(),n,o),l=Mv(t,c,!0,e.filter.filtersNodes());else{const i=ff(a);if(".priority"===i)c=e.filter.updatePriority(t.eventCache.getNode(),n),l=Mv(t,c,r.isFullyInitialized(),r.isFiltered());else{const s=gf(a),c=r.getNode().getImmediateChild(i);let u;if(kf(s))u=n;else{const e=d.getCompleteChild(i);u=null!=e?".priority"===bf(s)&&e.getChild(yf(s)).isEmpty()?e:e.updateChild(s,n):nv.EMPTY_NODE}if(c.equals(u))l=t;else{l=Mv(t,e.filter.updateChild(r.getNode(),i,u,s,d,o),r.isFullyInitialized(),e.filter.filtersNodes())}}}return l}function yg(e,t){return e.eventCache.isCompleteForChild(t)}function _g(e,t,a){return a.foreach((e,a)=>{t=t.updateChild(e,a)}),t}function kg(e,t,a,n,i,s,o,r){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l,c=t;l=kf(a)?n:new jv(null).setTree(a,n);const d=t.serverCache.getNode();return l.children.inorderTraversal((a,n)=>{if(d.hasChild(a)){const l=_g(0,t.serverCache.getNode().getImmediateChild(a),n);c=bg(e,c,new pf(a),l,i,s,o,r)}}),l.children.inorderTraversal((a,n)=>{const l=!t.serverCache.isCompleteForChild(a)&&null===n.value;if(!d.hasChild(a)&&!l){const l=_g(0,t.serverCache.getNode().getImmediateChild(a),n);c=bg(e,c,new pf(a),l,i,s,o,r)}}),c}class Cg{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const a=this.query_._queryParams,n=new hv(a.getIndex()),i=(s=a).loadsAllData()?new hv(s.getIndex()):s.hasLimit()?new mv(s):new pv(s);var s;this.processor_=function(e){return{filter:e}}(i);const o=t.serverCache,r=t.eventCache,l=n.updateFullNode(nv.EMPTY_NODE,o.getNode(),null),c=i.updateFullNode(nv.EMPTY_NODE,r.getNode(),null),d=new Rv(l,o.isFullyInitialized(),n.filtersNodes()),u=new Rv(c,r.isFullyInitialized(),i.filtersNodes());this.viewCache_=Lv(u,d),this.eventGenerator_=new Dv(this.query_)}get query(){return this.query_}}function Eg(e,t){const a=qv(e.viewCache_);return a&&(e.query._queryParams.loadsAllData()||!kf(t)&&!a.getImmediateChild(ff(t)).isEmpty())?a.getChild(t):null}function Ig(e){return 0===e.eventRegistrations_.length}function Sg(e,t,a){const n=[];if(a){pr(null==t,"A cancel should cancel all event registrations.");const i=e.query._path;e.eventRegistrations_.forEach(e=>{const t=e.createCancelEvent(a,i);t&&n.push(t)})}if(t){let a=[];for(let n=0;n<e.eventRegistrations_.length;++n){const i=e.eventRegistrations_[n];if(i.matches(t)){if(t.hasAnyCallback()){a=a.concat(e.eventRegistrations_.slice(n+1));break}}else a.push(i)}e.eventRegistrations_=a}else e.eventRegistrations_=[];return n}function Tg(e,t,a,n){t.type===Iv.MERGE&&null!==t.source.queryId&&(pr(qv(e.viewCache_),"We should always have a full cache before handling merges"),pr(Fv(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=vg(e.processor_,i,t,a,n);var o,r;return o=e.processor_,r=s.viewCache,pr(r.eventCache.getNode().isIndexed(o.filter.getIndex()),"Event snap not indexed"),pr(r.serverCache.getNode().isIndexed(o.filter.getIndex()),"Server snap not indexed"),pr(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,Ng(e,s.changes,s.viewCache.eventCache.getNode(),null)}function Ng(e,t,a,n){const i=n?[n]:e.eventRegistrations_;return function(e,t,a,n){const i=[],s=[];return t.forEach(t=>{var a;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((a=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:a}))}),Ov(e,i,"child_removed",t,n,a),Ov(e,i,"child_added",t,n,a),Ov(e,i,"child_moved",s,n,a),Ov(e,i,"child_changed",t,n,a),Ov(e,i,"value",t,n,a),i}(e.eventGenerator_,t,a,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Pg,Ag;class xg{constructor(){this.views=new Map}}function Rg(e,t,a,n){const i=t.source.queryId;if(null!==i){const s=e.views.get(i);return pr(null!=s,"SyncTree gave us an op for an invalid query."),Tg(s,t,a,n)}{let i=[];for(const s of e.views.values())i=i.concat(Tg(s,t,a,n));return i}}function Dg(e,t,a,n,i,s){const o=function(e,t,a,n,i){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=sg(a,i?n:null),s=!1;e?s=!0:n instanceof nv?(e=og(a,n),s=!1):(e=nv.EMPTY_NODE,s=!1);const o=Lv(new Rv(e,s,!1),new Rv(n,i,!1));return new Cg(t,o)}return o}(e,t,n,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,a),function(e,t){const a=e.viewCache_.eventCache,n=[];a.getNode().isLeafNode()||a.getNode().forEachChild(Jf,(e,t)=>{n.push(cv(e,t))});return a.isFullyInitialized()&&n.push(lv(a.getNode())),Ng(e,n,a.getNode(),t)}(o,a)}function Og(e,t,a,n){const i=t._queryIdentifier,s=[];let o=[];const r=qg(e);if("default"===i)for(const[l,c]of e.views.entries())o=o.concat(Sg(c,a,n)),Ig(c)&&(e.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{const t=e.views.get(i);t&&(o=o.concat(Sg(t,a,n)),Ig(t)&&(e.views.delete(i),t.query._queryParams.loadsAllData()||s.push(t.query)))}return r&&!qg(e)&&s.push(new(pr(Pg,"Reference.ts has not been loaded"),Pg)(t._repo,t._path)),{removed:s,events:o}}function Lg(e){const t=[];for(const a of e.views.values())a.query._queryParams.loadsAllData()||t.push(a);return t}function Mg(e,t){let a=null;for(const n of e.views.values())a=a||Eg(n,t);return a}function Ug(e,t){if(t._queryParams.loadsAllData())return Bg(e);{const a=t._queryIdentifier;return e.views.get(a)}}function Fg(e,t){return null!=Ug(e,t)}function qg(e){return null!=Bg(e)}function Bg(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jg=1;class $g{constructor(e){this.listenProvider_=e,this.syncPointTree_=new jv(null),this.pendingWriteTree_={visibleWrites:$v.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function zg(e,t,a,n,i){return function(e,t,a,n,i){pr(n>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:a,writeId:n,visible:i}),i&&(e.visibleWrites=zv(e.visibleWrites,t,a)),e.lastWriteId=n}(e.pendingWriteTree_,t,a,n,i),i?Jg(e,new Av({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,a)):[]}function Vg(e,t,a=!1){const n=function(e,t){for(let a=0;a<e.allWrites.length;a++){const n=e.allWrites[a];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(eg(e.pendingWriteTree_,t)){let t=new jv(null);return null!=n.snap?t=t.set(mf(),!0):Mm(n.children,e=>{t=t.set(new pf(e),!0)}),Jg(e,new Nv(n.path,t,a))}return[]}function Wg(e,t,a){return Jg(e,new Av({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,a))}function Hg(e,t,a,n,i=!1){const s=t._path,o=e.syncPointTree_.get(s);let r=[];if(o&&("default"===t._queryIdentifier||Fg(o,t))){const l=Og(o,t,a,n);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));const c=l.removed;if(r=l.events,!i){const a=-1!==c.findIndex(e=>e._queryParams.loadsAllData()),i=e.syncPointTree_.findOnPath(s,(e,t)=>qg(t));if(a&&!i){const t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){const a=function(e){return e.fold((e,t,a)=>{if(t&&qg(t)){return[Bg(t)]}{let e=[];return t&&(e=Lg(t)),Mm(a,(t,a)=>{e=e.concat(a)}),e}})}(t);for(let t=0;t<a.length;++t){const n=a[t],i=n.query,s=Zg(e,n);e.listenProvider_.startListening(ib(i),Xg(e,i),s.hashFn,s.onComplete)}}}if(!i&&c.length>0&&!n)if(a){const a=null;e.listenProvider_.stopListening(ib(t),a)}else c.forEach(t=>{const a=e.queryToTagMap.get(eb(t));e.listenProvider_.stopListening(ib(t),a)})}!function(e,t){for(let a=0;a<t.length;++a){const n=t[a];if(!n._queryParams.loadsAllData()){const t=eb(n),a=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(a)}}}(e,c)}return r}function Gg(e,t,a,n=!1){const i=t._path;let s=null,o=!1;e.syncPointTree_.foreachOnPath(i,(e,t)=>{const a=Cf(e,i);s=s||Mg(t,a),o=o||qg(t)});let r,l=e.syncPointTree_.get(i);if(l?(o=o||qg(l),s=s||Mg(l,mf())):(l=new xg,e.syncPointTree_=e.syncPointTree_.set(i,l)),null!=s)r=!0;else{r=!1,s=nv.EMPTY_NODE;e.syncPointTree_.subtree(i).foreachChild((e,t)=>{const a=Mg(t,mf());a&&(s=s.updateImmediateChild(e,a))})}const c=Fg(l,t);if(!c&&!t._queryParams.loadsAllData()){const a=eb(t);pr(!e.queryToTagMap.has(a),"View does not exist, but we have a tag");const n=jg++;e.queryToTagMap.set(a,n),e.tagToQueryMap.set(n,a)}let d=Dg(l,t,a,Xv(e.pendingWriteTree_,i),s,r);if(!c&&!o&&!n){const a=Ug(l,t);d=d.concat(function(e,t,a){const n=t._path,i=Xg(e,t),s=Zg(e,a),o=e.listenProvider_.startListening(ib(t),i,s.hashFn,s.onComplete),r=e.syncPointTree_.subtree(n);if(i)pr(!qg(r.value),"If we're adding a query, it shouldn't be shadowed");else{const t=r.fold((e,t,a)=>{if(!kf(e)&&t&&qg(t))return[Bg(t).query];{let e=[];return t&&(e=e.concat(Lg(t).map(e=>e.query))),Mm(a,(t,a)=>{e=e.concat(a)}),e}});for(let a=0;a<t.length;++a){const n=t[a];e.listenProvider_.stopListening(ib(n),Xg(e,n))}}return o}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,a))}return d}function Kg(e,t,a){const n=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,a)=>{const n=Mg(a,Cf(e,t));if(n)return n});return ig(n,t,i,a,!0)}function Jg(e,t){return Yg(t,e.syncPointTree_,null,Xv(e.pendingWriteTree_,mf()))}function Yg(e,t,a,n){if(kf(e.path))return Qg(e,t,a,n);{const i=t.get(mf());null==a&&null!=i&&(a=Mg(i,mf()));let s=[];const o=ff(e.path),r=e.operationForChild(o),l=t.children.get(o);if(l&&r){const e=a?a.getImmediateChild(o):null,t=ug(n,o);s=s.concat(Yg(r,l,e,t))}return i&&(s=s.concat(Rg(i,e,n,a))),s}}function Qg(e,t,a,n){const i=t.get(mf());null==a&&null!=i&&(a=Mg(i,mf()));let s=[];return t.children.inorderTraversal((t,i)=>{const o=a?a.getImmediateChild(t):null,r=ug(n,t),l=e.operationForChild(t);l&&(s=s.concat(Qg(l,i,o,r)))}),i&&(s=s.concat(Rg(i,e,n,a))),s}function Zg(e,t){const a=t.query,n=Xg(e,a);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||nv.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return n?function(e,t,a){const n=tb(e,a);if(n){const a=ab(n),i=a.path,s=a.queryId,o=Cf(i,t);return nb(e,i,new Pv(Tv(s),o))}return[]}(e,a._path,n):function(e,t){return Jg(e,new Pv({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,a._path);{const n=function(e,t){let a="Unknown Error";"too_big"===e?a="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?a="Client doesn't have permission to access the desired data.":"unavailable"===e&&(a="The service is unavailable");const n=new Error(e+" at "+t._path.toString()+": "+a);return n.code=e.toUpperCase(),n}(t,a);return Hg(e,a,null,n)}}}}function Xg(e,t){const a=eb(t);return e.queryToTagMap.get(a)}function eb(e){return e._path.toString()+"$"+e._queryIdentifier}function tb(e,t){return e.tagToQueryMap.get(t)}function ab(e){const t=e.indexOf("$");return pr(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new pf(e.substr(0,t))}}function nb(e,t,a){const n=e.syncPointTree_.get(t);pr(n,"Missing sync point for query tag that we're tracking");return Rg(n,a,Xv(e.pendingWriteTree_,t),null)}function ib(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(pr(Ag,"Reference.ts has not been loaded"),Ag)(e._repo,e._path):e}class sb{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new sb(t)}node(){return this.node_}}class ob{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=_f(this.path_,e);return new ob(this.syncTree_,t)}node(){return Kg(this.syncTree_,this.path_)}}const rb=function(e,t,a){return e&&"object"==typeof e?(pr(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?lb(e[".sv"],t,a):"object"==typeof e[".sv"]?cb(e[".sv"],t):void pr(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},lb=function(e,t,a){if("timestamp"===e)return a.timestamp;pr(!1,"Unexpected server value: "+e)},cb=function(e,t,a){e.hasOwnProperty("increment")||pr(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const n=e.increment;"number"!=typeof n&&pr(!1,"Unexpected increment value: "+n);const i=t.node();if(pr(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return n;const s=i.getValue();return"number"!=typeof s?n:s+n},db=function(e,t,a){return ub(e,new sb(t),a)};function ub(e,t,a){const n=e.getPriority().val(),i=rb(n,t.getImmediateChild(".priority"),a);let s;if(e.isLeafNode()){const n=e,s=rb(n.getValue(),t,a);return s!==n.getValue()||i!==n.getPriority().val()?new Kf(s,sv(i)):e}{const n=e;return s=n,i!==n.getPriority().val()&&(s=s.updatePriority(new Kf(i))),n.forEachChild(Jf,(e,n)=>{const i=ub(n,t.getImmediateChild(e),a);i!==n&&(s=s.updateImmediateChild(e,i))}),s}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hb{constructor(e="",t=null,a={children:{},childCount:0}){this.name=e,this.parent=t,this.node=a}}function pb(e,t){let a=t instanceof pf?t:new pf(t),n=e,i=ff(a);for(;null!==i;){const e=Yr(n.node.children,i)||{children:{},childCount:0};n=new hb(i,n,e),a=gf(a),i=ff(a)}return n}function mb(e){return e.node.value}function fb(e,t){e.node.value=t,yb(e)}function vb(e){return e.node.childCount>0}function gb(e,t){Mm(e.node.children,(a,n)=>{t(new hb(a,e,n))})}function bb(e,t,a,n){a&&t(e),gb(e,e=>{bb(e,t,!0)})}function wb(e){return new pf(null===e.parent?e.name:wb(e.parent)+"/"+e.name)}function yb(e){null!==e.parent&&function(e,t,a){const n=function(e){return void 0===mb(e)&&!vb(e)}(a),i=Jr(e.node.children,t);n&&i?(delete e.node.children[t],e.node.childCount--,yb(e)):n||i||(e.node.children[t]=a.node,e.node.childCount++,yb(e))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e.parent,e.name,e)}const _b=/[\[\].#$\/\u0000-\u001F\u007F]/,kb=/[\[\].#$\u0000-\u001F\u007F]/,Cb=10485760,Eb=function(e){return"string"==typeof e&&0!==e.length&&!_b.test(e)},Ib=function(e){return"string"==typeof e&&0!==e.length&&!kb.test(e)},Sb=function(e,t,a){const n=a instanceof pf?new Sf(a,e):a;if(void 0===t)throw new Error(e+"contains undefined "+Nf(n));if("function"==typeof t)throw new Error(e+"contains a function "+Nf(n)+" with contents = "+t.toString());if(Nm(t))throw new Error(e+"contains "+t.toString()+" "+Nf(n));if("string"==typeof t&&t.length>Cb/3&&ol(t)>Cb)throw new Error(e+"contains a string greater than "+Cb+" utf8 bytes "+Nf(n)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let a=!1,i=!1;if(Mm(t,(t,s)=>{if(".value"===t)a=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!Eb(t)))throw new Error(e+" contains an invalid key ("+t+") "+Nf(n)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var o,r;r=t,(o=n).parts_.length>0&&(o.byteLength_+=1),o.parts_.push(r),o.byteLength_+=ol(r),Tf(o),Sb(e,s,n),function(e){const t=e.parts_.pop();e.byteLength_-=ol(t),e.parts_.length>0&&(e.byteLength_-=1)}(n)}),a&&i)throw new Error(e+' contains ".value" child '+Nf(n)+" in addition to actual children.")}},Tb=function(e,t,a,n){if(!Ib(a))throw new Error(sl(e,t)+'was an invalid path = "'+a+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Nb=function(e,t){const a=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Eb(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==a.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Ib(e)}(a))throw new Error(sl(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Pb{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Ab(e,t){let a=null;for(let n=0;n<t.length;n++){const i=t[n],s=i.getPath();null===a||Ef(s,a.path)||(e.eventLists_.push(a),a=null),null===a&&(a={events:[],path:s}),a.events.push(i)}a&&e.eventLists_.push(a)}function xb(e,t,a){Ab(e,a),Db(e,e=>Ef(e,t))}function Rb(e,t,a){Ab(e,a),Db(e,e=>If(e,t)||If(t,e))}function Db(e,t){e.recursionDepth_++;let a=!0;for(let n=0;n<e.eventLists_.length;n++){const i=e.eventLists_[n];if(i){t(i.path)?(Ob(e.eventLists_[n]),e.eventLists_[n]=null):a=!1}}a&&(e.eventLists_=[]),e.recursionDepth_--}function Ob(e){for(let t=0;t<e.events.length;t++){const a=e.events[t];if(null!==a){e.events[t]=null;const n=a.getEventRunner();_m&&Cm("event: "+a.toString()),Bm(n)}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lb{constructor(e,t,a,n){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=a,this.appCheckProvider_=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Pb,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=yv(),this.transactionQueueTree_=new hb,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Mb(e,t,a){if(e.stats_=ef(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new bv(e.repoInfo_,(t,a,n,i)=>{qb(e,t,a,n,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>Bb(e,!0),0);else{if(null!=a){if("object"!=typeof a)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Gr(a)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}e.persistentConnection_=new xf(e.repoInfo_,t,(t,a,n,i)=>{qb(e,t,a,n,i)},t=>{Bb(e,t)},t=>{!function(e,t){Mm(t,(t,a)=>{jb(e,t,a)})}(e,t)},e.authTokenProvider_,e.appCheckProvider_,a),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){const a=e.toString();return Xm[a]||(Xm[a]=t()),Xm[a]}(e.repoInfo_,()=>new Ev(e.stats_,e.server_)),e.infoData_=new wv,e.infoSyncTree_=new $g({startListening:(t,a,n,i)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=Wg(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),jb(e,"connected",!1),e.serverSyncTree_=new $g({startListening:(t,a,n,i)=>(e.server_.listen(t,n,a,(a,n)=>{const s=i(a,n);Rb(e.eventQueue_,t._path,s)}),[]),stopListening:(t,a)=>{e.server_.unlisten(t,a)}})}function Ub(e){const t=e.infoData_.getNode(new pf(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Fb(e){return(t=(t={timestamp:Ub(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function qb(e,t,a,n,i){e.dataUpdateCount++;const s=new pf(t);a=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,a):a;let o=[];if(i)if(n){const t=Zr(a,e=>sv(e));o=function(e,t,a,n){const i=tb(e,n);if(i){const n=ab(i),s=n.path,o=n.queryId,r=Cf(s,t),l=jv.fromObject(a);return nb(e,s,new xv(Tv(o),r,l))}return[]}(e.serverSyncTree_,s,t,i)}else{const t=sv(a);o=function(e,t,a,n){const i=tb(e,n);if(null!=i){const n=ab(i),s=n.path,o=n.queryId,r=Cf(s,t);return nb(e,s,new Av(Tv(o),r,a))}return[]}(e.serverSyncTree_,s,t,i)}else if(n){const t=Zr(a,e=>sv(e));o=function(e,t,a){const n=jv.fromObject(a);return Jg(e,new xv({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}(e.serverSyncTree_,s,t)}else{const t=sv(a);o=Wg(e.serverSyncTree_,s,t)}let r=s;o.length>0&&(r=Gb(e,s)),Rb(e.eventQueue_,r,o)}function Bb(e,t){jb(e,"connected",t),!1===t&&function(e){Vb(e,"onDisconnectEvents");const t=Fb(e),a=yv();kv(e.onDisconnect_,mf(),(n,i)=>{const s=function(e,t,a,n){return ub(t,new ob(a,e),n)}(n,i,e.serverSyncTree_,t);_v(a,n,s)});let n=[];kv(a,mf(),(t,a)=>{n=n.concat(Wg(e.serverSyncTree_,t,a));const i=function(e,t){const a=wb(Kb(e,t)),n=pb(e.transactionQueueTree_,t);return function(e,t){let a=e.parent;for(;null!==a;){if(t(a))return!0;a=a.parent}}(n,t=>{Zb(e,t)}),Zb(e,n),bb(n,t=>{Zb(e,t)}),a}(e,t);Gb(e,i)}),e.onDisconnect_=yv(),Rb(e.eventQueue_,mf(),n)}(e)}function jb(e,t,a){const n=new pf("/.info/"+t),i=sv(a);e.infoData_.updateSnapshot(n,i);const s=Wg(e.infoSyncTree_,n,i);Rb(e.eventQueue_,n,s)}function $b(e){return e.nextWriteId_++}function zb(e,t,a){let n;n=".info"===ff(t._path)?Hg(e.infoSyncTree_,t,a):Hg(e.serverSyncTree_,t,a),xb(e.eventQueue_,t._path,n)}function Vb(e,...t){let a="";e.persistentConnection_&&(a=e.persistentConnection_.id+":"),Cm(a,...t)}function Wb(e,t,a){return Kg(e.serverSyncTree_,t,a)||nv.EMPTY_NODE}function Hb(e,t=e.transactionQueueTree_){if(t||Qb(e,t),mb(t)){const a=Jb(e,t);pr(a.length>0,"Sending zero length transaction queue");a.every(e=>0===e.status)&&function(e,t,a){const n=a.map(e=>e.currentWriteId),i=Wb(e,t,n);let s=i;const o=i.hash();for(let c=0;c<a.length;c++){const e=a[c];pr(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const n=Cf(t,e.path);s=s.updateChild(n,e.currentOutputSnapshotRaw)}const r=s.val(!0),l=t;e.server_.put(l.toString(),r,n=>{Vb(e,"transaction put response",{path:l.toString(),status:n});let i=[];if("ok"===n){const n=[];for(let t=0;t<a.length;t++)a[t].status=2,i=i.concat(Vg(e.serverSyncTree_,a[t].currentWriteId)),a[t].onComplete&&n.push(()=>a[t].onComplete(null,!0,a[t].currentOutputSnapshotResolved)),a[t].unwatcher();Qb(e,pb(e.transactionQueueTree_,t)),Hb(e,e.transactionQueueTree_),Rb(e.eventQueue_,t,i);for(let e=0;e<n.length;e++)Bm(n[e])}else{if("datastale"===n)for(let e=0;e<a.length;e++)3===a[e].status?a[e].status=4:a[e].status=0;else{Tm("transaction at "+l.toString()+" failed: "+n);for(let e=0;e<a.length;e++)a[e].status=4,a[e].abortReason=n}Gb(e,t)}},o)}(e,wb(t),a)}else vb(t)&&gb(t,t=>{Hb(e,t)})}function Gb(e,t){const a=Kb(e,t),n=wb(a);return function(e,t,a){if(0===t.length)return;const n=[];let i=[];const s=t.filter(e=>0===e.status),o=s.map(e=>e.currentWriteId);for(let r=0;r<t.length;r++){const s=t[r],l=Cf(a,s.path);let c,d=!1;if(pr(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===s.status)d=!0,c=s.abortReason,i=i.concat(Vg(e.serverSyncTree_,s.currentWriteId,!0));else if(0===s.status)if(s.retryCount>=25)d=!0,c="maxretry",i=i.concat(Vg(e.serverSyncTree_,s.currentWriteId,!0));else{const a=Wb(e,s.path,o);s.currentInputSnapshot=a;const n=t[r].update(a.val());if(void 0!==n){Sb("transaction failed: Data returned ",n,s.path);let t=sv(n);"object"==typeof n&&null!=n&&Jr(n,".priority")||(t=t.updatePriority(a.getPriority()));const r=s.currentWriteId,l=Fb(e),c=db(t,a,l);s.currentOutputSnapshotRaw=t,s.currentOutputSnapshotResolved=c,s.currentWriteId=$b(e),o.splice(o.indexOf(r),1),i=i.concat(zg(e.serverSyncTree_,s.path,c,s.currentWriteId,s.applyLocally)),i=i.concat(Vg(e.serverSyncTree_,r,!0))}else d=!0,c="nodata",i=i.concat(Vg(e.serverSyncTree_,s.currentWriteId,!0))}Rb(e.eventQueue_,a,i),i=[],d&&(t[r].status=2,function(e){setTimeout(e,Math.floor(0))}(t[r].unwatcher),t[r].onComplete&&("nodata"===c?n.push(()=>t[r].onComplete(null,!1,t[r].currentInputSnapshot)):n.push(()=>t[r].onComplete(new Error(c),!1,null))))}Qb(e,e.transactionQueueTree_);for(let r=0;r<n.length;r++)Bm(n[r]);Hb(e,e.transactionQueueTree_)}(e,Jb(e,a),n),n}function Kb(e,t){let a,n=e.transactionQueueTree_;for(a=ff(t);null!==a&&void 0===mb(n);)n=pb(n,a),a=ff(t=gf(t));return n}function Jb(e,t){const a=[];return Yb(e,t,a),a.sort((e,t)=>e.order-t.order),a}function Yb(e,t,a){const n=mb(t);if(n)for(let i=0;i<n.length;i++)a.push(n[i]);gb(t,t=>{Yb(e,t,a)})}function Qb(e,t){const a=mb(t);if(a){let e=0;for(let t=0;t<a.length;t++)2!==a[t].status&&(a[e]=a[t],e++);a.length=e,fb(t,a.length>0?a:void 0)}gb(t,t=>{Qb(e,t)})}function Zb(e,t){const a=mb(t);if(a){const n=[];let i=[],s=-1;for(let t=0;t<a.length;t++)3===a[t].status||(1===a[t].status?(pr(s===t-1,"All SENT items should be at beginning of queue."),s=t,a[t].status=3,a[t].abortReason="set"):(pr(0===a[t].status,"Unexpected transaction status in abort"),a[t].unwatcher(),i=i.concat(Vg(e.serverSyncTree_,a[t].currentWriteId,!0)),a[t].onComplete&&n.push(a[t].onComplete.bind(null,new Error("set"),!1,null))));-1===s?fb(t,void 0):a.length=s+1,Rb(e.eventQueue_,wb(t),i);for(let e=0;e<n.length;e++)Bm(n[e])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xb=function(e,t){const a=ew(e),n=a.namespace;"firebase.com"===a.domain&&Sm(a.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===a.domain||Sm("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),a.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Tm("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const i="ws"===a.scheme||"wss"===a.scheme;return{repoInfo:new Jm(a.host,a.secure,n,i,t,"",n!==a.subdomain),path:new pf(a.pathString)}},ew=function(e){let t="",a="",n="",i="",s="",o=!0,r="https",l=443;if("string"==typeof e){let c=e.indexOf("//");c>=0&&(r=e.substring(0,c-1),e=e.substring(c+2));let d=e.indexOf("/");-1===d&&(d=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(d,u)),d<u&&(i=function(e){let t="";const a=e.split("/");for(let i=0;i<a.length;i++)if(a[i].length>0){let e=a[i];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(n){}t+="/"+e}return t}(e.substring(d,u)));const h=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const a of e.split("&")){if(0===a.length)continue;const n=a.split("=");2===n.length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Tm(`Invalid query segment '${a}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));c=t.indexOf(":"),c>=0?(o="https"===r||"wss"===r,l=parseInt(t.substring(c+1),10)):c=t.length;const p=t.slice(0,c);if("localhost"===p.toLowerCase())a="localhost";else if(p.split(".").length<=2)a=p;else{const e=t.indexOf(".");n=t.substring(0,e).toLowerCase(),a=t.substring(e+1),s=n}"ns"in h&&(s=h.ns)}return{host:t,port:l,domain:a,subdomain:n,secure:o,scheme:r,pathString:i,namespace:s}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class tw{constructor(e,t,a,n){this.eventType=e,this.eventRegistration=t,this.snapshot=a,this.prevName=n}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Gr(this.snapshot.exportVal())}}class aw{constructor(e,t,a){this.eventRegistration=e,this.error=t,this.path=a}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nw{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return pr(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iw{constructor(e,t,a,n){this._repo=e,this._path=t,this._queryParams=a,this._orderByCalled=n}get key(){return kf(this._path)?null:bf(this._path)}get ref(){return new sw(this._repo,this._path)}get _queryIdentifier(){const e=gv(this._queryParams),t=Om(e);return"{}"===t?"default":t}get _queryObject(){return gv(this._queryParams)}isEqual(e){if(!((e=rl(e))instanceof iw))return!1;const t=this._repo===e._repo,a=Ef(this._path,e._path),n=this._queryIdentifier===e._queryIdentifier;return t&&a&&n}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let a=e.pieceNum_;a<e.pieces_.length;a++)""!==e.pieces_[a]&&(t+="/"+encodeURIComponent(String(e.pieces_[a])));return t||"/"}(this._path)}}class sw extends iw{constructor(e,t){super(e,t,new fv,!1)}get parent(){const e=yf(this._path);return null===e?null:new sw(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ow{constructor(e,t,a){this._node=e,this.ref=t,this._index=a}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new pf(e),a=lw(this.ref,e);return new ow(this._node.getChild(t),a,Jf)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,(t,a)=>e(new ow(a,lw(this.ref,t),Jf)))}hasChild(e){const t=new pf(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function rw(e,t){return(e=rl(e))._checkNotDeleted("ref"),void 0!==t?lw(e._root,t):e._root}function lw(e,t){var a,n,i;return null===ff((e=rl(e))._path)?(a="child",n="path",(i=t)&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),Tb(a,n,i)):Tb("child","path",t),new sw(e._repo,_f(e._path,t))}class cw{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const a=t._queryParams.getIndex();return new tw("value",this,new ow(e.snapshotNode,new sw(t._repo,t._path),a))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new aw(this,e,t):null}matches(e){return e instanceof cw&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}function dw(e,t,a,n,i){let s;if("object"==typeof n&&(s=void 0,i=n),"function"==typeof n&&(s=n),i&&i.onlyOnce){const t=a,n=(a,n)=>{zb(e._repo,e,r),t(a,n)};n.userCallback=a.userCallback,n.context=a.context,a=n}const o=new nw(a,s||void 0),r=new cw(o);return function(e,t,a){let n;n=".info"===ff(t._path)?Gg(e.infoSyncTree_,t,a):Gg(e.serverSyncTree_,t,a),xb(e.eventQueue_,t._path,n)}(e._repo,e,r),()=>zb(e._repo,e,r)}function uw(e,t,a,n){return dw(e,0,t,a,n)}function hw(e,t,a){zb(e._repo,e,null)}!function(e){pr(!Pg,"__referenceConstructor has already been defined"),Pg=e}(sw),function(e){pr(!Ag,"__referenceConstructor has already been defined"),Ag=e}(sw);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const pw={};let mw=!1;function fw(e,t,a,n,i){let s=n||e.options.databaseURL;void 0===s&&(e.options.projectId||Sm("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Cm("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,r=Xb(s,i),l=r.repoInfo;"undefined"!=typeof process&&rm&&(o=rm.FIREBASE_DATABASE_EMULATOR_HOST),o?(s=`http://${o}?ns=${l.namespace}`,r=Xb(s,i),l=r.repoInfo):r.repoInfo.secure;const c=new zm(e.name,e.options,t);Nb("Invalid Firebase Database URL",r),kf(r.path)||Sm("Database URL must point to the root of a Firebase Database (not including a child path).");const d=function(e,t,a,n){let i=pw[t.name];i||(i={},pw[t.name]=i);let s=i[e.toURLString()];s&&Sm("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new Lb(e,mw,a,n),i[e.toURLString()]=s,s}(l,e,c,new $m(e,a));return new vw(d,e)}class vw{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Mb(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new sw(this._repo,mf())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const a=pw[t];a&&a[e.key]===e||Sm(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete a[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Sm("Cannot call "+e+" on a deleted database.")}}function gw(e=Sc(),t){const a=yc(e,"database").getImmediate({identifier:t});if(!a._instanceStarted){const e=Tr("database");e&&bw(a,...e)}return a}function bw(e,t,a,n={}){(e=rl(e))._checkNotDeleted("useEmulator");const i=`${t}:${a}`,s=e._repoInternal;if(e._instanceStarted){if(i===e._repoInternal.repoInfo_.host&&Xr(n,s.repoInfo_.emulatorOptions))return;Sm("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)n.mockUserToken&&Sm('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Vm(Vm.OWNER);else if(n.mockUserToken){const t="string"==typeof n.mockUserToken?n.mockUserToken:Dr(n.mockUserToken,e.app.options.projectId);o=new Vm(t)}xr(t)&&(Rr(t),Mr("Database",!0)),function(e,t,a,n){const i=t.lastIndexOf(":"),s=xr(t.substring(0,i));e.repoInfo_=new Jm(t,s,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,a),n&&(e.authTokenProvider_=n)}(s,i,n,o)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */xf.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},xf.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},function(e){um(Ec),wc(new ll("database",(e,{instanceIdentifier:t})=>fw(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),Tc(lm,cm,e),Tc(lm,cm,"esm2020")}();const ww=Object.freeze(Object.defineProperty({__proto__:null,DataSnapshot:ow,Database:vw,_QueryImpl:iw,_QueryParams:fv,_ReferenceImpl:sw,_repoManagerDatabaseFromApp:fw,_setSDKVersion:um,_validatePathString:Tb,child:lw,connectDatabaseEmulator:bw,getDatabase:gw,off:hw,onValue:uw,ref:rw},Symbol.toStringTag,{value:"Module"}));let yw,_w;async function kw(){if(_w)return _w;const{getDatabase:e}=await H(async()=>{const{getDatabase:e}=await Promise.resolve().then(()=>ww);return{getDatabase:e}},void 0),t=yw||await(yw||Oa.initializeFirebaseApp().then(e=>(yw=null==e?void 0:e.app,yw)));if(!t)throw new Error("Firebase app no inicializada");return _w=e(t),_w}class Cw{constructor(e){this.waiterId=e,this.listeners=new Map,this.activeCalls=new Map,this.db=null,this.initializing=!1,this._expectedInitialCallIds=new Set,this._initialSetProcessed=!1}async startListening(){if(!this.db)try{this.db=await kw()}catch(t){return void console.error("❌ No se pudo obtener instancia Realtime DB:",t)}const e=uw(rw(this.db,`waiters/${this.waiterId}/active_calls`),e=>{const t=e.val()||[];this.initializing&&!this._initialSetProcessed&&(this._expectedInitialCallIds=new Set(t.map(e=>String(e))),0===this._expectedInitialCallIds.size&&(this.initializing=!1,this._initialSetProcessed=!0)),this.updateActiveCallsListeners(t)},e=>{console.error("🚨 Error en UNIFIED listener:",e),this.handleError(e)});this.initializing=!0,this.listeners.set("waiter",e),console.log(`⚡ UNIFIED WebSocket conectado para mozo ${this.waiterId}`)}updateActiveCallsListeners(e){Array.from(this.activeCalls.keys()).forEach(t=>{e.includes(t)||(this.removeCallListener(t),this.onCallRemoved(t))}),e.forEach(e=>{this.activeCalls.has(e)||this.addCallListener(e)})}addCallListener(e){if(!this.db)return;const t=uw(rw(this.db,`active_calls/${e}`),t=>{const a=t.val();if(a){const t=!this.activeCalls.has(e);this.activeCalls.set(e,a);const n=this.normalizeCallData(a);t?this.onNewCall(n):this.onCallUpdated(n),"acknowledged"!==a.status&&"completed"!==a.status||setTimeout(()=>{this.onCallMovedToHistory(e,n)},400),this.initializing&&!this._initialSetProcessed&&(this._expectedInitialCallIds.has(String(e))&&this._expectedInitialCallIds.delete(String(e)),0===this._expectedInitialCallIds.size&&(this.initializing=!1,this._initialSetProcessed=!0))}});this.listeners.set(`call_${e}`,t)}removeCallListener(e){const t=`call_${e}`;if(this.listeners.has(t)){this.listeners.get(t)(),this.listeners.delete(t)}this.activeCalls.delete(e)}onNewCall(e){console.debug("⚡ UNIFIED: Nueva llamada:",e.id,e);"pending"===e.status?(window.dispatchEvent(new CustomEvent("newWaiterCall",{detail:e})),window.dispatchEvent(new CustomEvent("ultraFastAddCall",{detail:e})),this.initializing||(this.playUltraFastSound(),this.vibrateUltraFast(),this.scheduleNativeNotification(e),this.showBrowserNotification(e)),this.logStatus(e,"pending")):this.onCallMovedToHistory(e.id,e)}onCallUpdated(e){"acknowledged"===e.status&&(this.showStatusUpdate(`Mesa ${e.table_number} - Atendiendo`),this.logStatus(e,"acknowledged")),window.dispatchEvent(new CustomEvent("updateCallStatus",{detail:e}))}onCallRemoved(e){this.showStatusUpdate("Servicio completado"),window.dispatchEvent(new CustomEvent("removeCall",{detail:{callId:e}}))}onCallMovedToHistory(e,t){let a="";switch(t.status){case"acknowledged":a=`Mesa ${t.table_number} - Atendiendo`;break;case"completed":a=`Mesa ${t.table_number} - Completado`;break;default:a=`Mesa ${t.table_number} - Actualizado`}this.showStatusUpdate(a),window.dispatchEvent(new CustomEvent("removeCall",{detail:{callId:e}})),window.dispatchEvent(new CustomEvent("callMovedToHistory",{detail:{callId:e,callData:t,status:t.status}})),"acknowledged"===t.status?this.logStatus(t,"acknowledged"):"completed"===t.status&&this.logStatus(t,"completed")}logStatus(e,t){try{if(!e||!e.id)return;switch(t){case"pending":console.info("[UNIFIED][PENDING]",`id=${e.id}`,`mesa=${e.table_number}`,`t=${e.called_at}`);break;case"acknowledged":console.info("[UNIFIED][ACKNOWLEDGED]",`id=${e.id}`,`mesa=${e.table_number}`,`ack=${e.acknowledged_at}`);break;case"completed":console.info("[UNIFIED][COMPLETED]",`id=${e.id}`,`mesa=${e.table_number}`,`comp=${e.completed_at}`)}}catch(a){}}normalizeCallData(e){var t,a;return{id:e.id,table_number:(null==(t=e.table)?void 0:t.number)||e.table_number,message:e.message||"Cliente solicita atención",urgency:e.urgency||"normal",status:e.status,called_at:e.called_at,acknowledged_at:e.acknowledged_at,completed_at:e.completed_at,timestamp:e.called_at,waiter_id:(null==(a=e.waiter)?void 0:a.id)||this.waiterId,client_info:e.client_info,table:e.table,waiter:e.waiter}}scheduleNativeNotification(e){try{Ba&&Ba.isPluginAvailable&&Ba.isPluginAvailable("LocalNotifications")&&H(async()=>{const{LocalNotifications:e}=await import("./index-DlE1A72V.js");return{LocalNotifications:e}},__vite__mapDeps([9,1,2])).then(({LocalNotifications:t})=>{t.schedule({notifications:[{title:`Mesa ${e.table_number} · ${e.urgency?e.urgency.toUpperCase():""}`,body:e.message||"Solicita atención",id:Number(Date.now()%1e5),extra:{callId:e.id,source:"unified-realtime"},schedule:null,smallIcon:void 0}]}).then(()=>{}).catch(e=>console.warn("⚠️ Error scheduling local notification:",e))}).catch(e=>{console.warn("⚠️ Error importing LocalNotifications:",e)})}catch(t){console.warn("⚠️ Exception scheduling native notification:",t)}}showBrowserNotification(e){try{if("undefined"==typeof Notification)return;if("granted"!==Notification.permission)return;const t=new Notification(`⚡ Mesa ${e.table_number}`,{body:`${e.message||"Solicita atención"} (UNIFIED)`,icon:"/favicon.ico",tag:`unified-call-${e.id}`,requireInteraction:!0});t.onclick=()=>{window.focus(),t.close()}}catch(t){}}playUltraFastSound(){try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),a=e.createGain();t.connect(a),a.connect(e.destination),t.frequency.setValueAtTime(800,e.currentTime),t.frequency.setValueAtTime(400,e.currentTime+.1),a.gain.setValueAtTime(.3,e.currentTime),a.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),t.start(e.currentTime),t.stop(e.currentTime+.3)}catch(e){const t=new Audio;t.src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+nfvnUjBjd+zO/eizEIDGKw5+mqWRMJRZzp4b5+JgU2jdXzzX4tBSF1xe/ejzQIElyx6OyrYRYJSKXi67RiHAY8k9nyyXkpBSR+zO/ijDEIDWOz6OyrXRQIR6Hn4L55KAU5jNTx0IAvBh1qtOnnqlkSCUig5OqyYhsGPJHY8sp7KgUle8vt3o4yBxFYr+ftrWIaBjeL0/LNfjAGIn3M7+CNMA==",t.volume=.7,t.play().catch(e=>{})}}vibrateUltraFast(){navigator.vibrate&&navigator.vibrate([100,50,100,50,200])}showStatusUpdate(e){const t=document.createElement("div");t.className="status-update",t.textContent=`⚡ ${e}`,document.body.appendChild(t),setTimeout(()=>t.classList.add("show"),10),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>t.remove(),200)},2e3)}async acknowledgeCall(e){try{const a=localStorage.getItem("token");let n=null;try{const t=await H(()=>Promise.resolve().then(()=>om),void 0),a=t&&(t.default||t);if(a&&"function"==typeof a.acknowledgCall)n=await a.acknowledgCall(e);else{if(!a||"function"!=typeof a.acknowledgeCall)throw new Error("No acknowledge helper found");n=await a.acknowledgeCall(e)}}catch(t){n=await fetch(`https://mozoqr.com/api/waiter/calls/${e}/acknowledge`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}})}let i=!1;if(n&&"boolean"==typeof n.ok?i=n.ok:n&&"boolean"==typeof n.success?i=!1!==n.success:n&&(i=!0),!i){const e=n&&(n.status||n.code||"unknown");throw new Error(`Acknowledge failed: ${e}`)}window.dispatchEvent(new CustomEvent("callAcknowledged",{detail:{callId:e}}))}catch(a){console.error("UNIFIED: Error reconociendo llamada:",a),this.showError("Error al reconocer la llamada")}}async completeCall(e){try{const a=localStorage.getItem("token");let n=null;try{const t=await H(()=>Promise.resolve().then(()=>om),void 0),a=t&&(t.default||t);if(a&&"function"==typeof a.completeCall)n=await a.completeCall(e);else{if(!a||"function"!=typeof a.complete)throw new Error("No complete helper found");n=await a.complete(e)}}catch(t){n=await fetch(`https://mozoqr.com/api/waiter/calls/${e}/complete`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}})}let i=!1;if(n&&"boolean"==typeof n.ok?i=n.ok:n&&"boolean"==typeof n.success?i=!1!==n.success:n&&(i=!0),!i){const e=n&&(n.status||n.code||"unknown");throw new Error(`Complete failed: ${e}`)}console.log("⚡ UNIFIED: Llamada completada"),window.dispatchEvent(new CustomEvent("removeCall",{detail:{callId:e}}));try{const{useNotificationsStore:t}=await H(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>lr);return{useNotificationsStore:e}},void 0);t().removeNotification(e)}catch(t){console.warn("⚠️ Unable to remove notification from store:",t)}}catch(a){console.error("UNIFIED: Error completando llamada:",a),this.showError("Error al completar la llamada")}}stopListening(){this.listeners.forEach(e=>{e()}),this.listeners.clear(),this.activeCalls.clear(),console.log("🛑 UNIFIED listener detenido")}async createTestCall(){console.log("🧪 UNIFIED: Creando llamada de prueba...");try{(await fetch("https://mozoqr.com/api/tables/1/call-waiter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Llamada de prueba UNIFIED",urgency:"high"})})).ok&&console.log("✅ UNIFIED: Llamada de prueba creada")}catch(e){console.error("❌ UNIFIED: Error creando llamada de prueba:",e)}}handleError(e){console.error("🚨 UNIFIED: Error en listener:",e),this.showError("Error de conexión en tiempo real")}showError(e){const t=document.createElement("div");t.className="ultra-fast-error",t.innerHTML=`\n            <p>❌ ${e}</p>\n            <p>Reintentando automáticamente...</p>\n            <button onclick="this.remove()">Cerrar</button>\n        `,document.body.appendChild(t),setTimeout(()=>{t.parentElement&&t.remove()},5e3),setTimeout(()=>{this.startListening()},2e3)}}window.addEventListener("beforeunload",()=>{window.unifiedNotifications&&window.unifiedNotifications.stopListening()});const Ew={class:"modal-header"},Iw={class:"modal-body"},Sw={key:0,class:"loading-state"},Tw={key:1},Nw={key:0,class:"selection-summary"},Pw={class:"tables-grid"},Aw=["onClick"],xw={class:"table-checkbox"},Rw=["checked","onChange"],Dw={class:"table-info"},Ow={class:"table-number"},Lw={key:0,class:"table-name"},Mw={class:"table-details"},Uw={key:0},Fw={key:1},qw={key:0,class:"empty-state"},Bw={key:1,class:"quick-actions"},jw={class:"modal-footer"},$w=["disabled"],zw=Lh({__name:"TableSelector",props:{availableTables:{type:Array,default:()=>[]},assignedTables:{type:Array,default:()=>[]}},emits:["close","tables-selected"],setup(e,{emit:t}){const i=e,u=t,h=a([]),p=a(!1),m=n(()=>i.availableTables||[]),f=e=>{const t=h.value.indexOf(e);-1===t?h.value.push(e):h.value.splice(t,1)},v=()=>{h.value=m.value.map(e=>e.id)},b=()=>{h.value=[]},y=()=>{console.log("🎯 TableSelector: Confirmando selección de mesas:",h.value),u("tables-selected",h.value)};return s(()=>{console.log("🏠 TableSelector mounted"),console.log("📋 Mesas disponibles recibidas:",i.availableTables),console.log("📋 Mesas asignadas recibidas:",i.assignedTables),console.log("Available tables:",m.value),console.log("Assigned tables:",i.assignedTables)}),(e,t)=>(w(),o("div",{class:"modal-overlay",onClick:t[4]||(t[4]=t=>e.$emit("close"))},[r("div",{class:"modal-content",onClick:t[3]||(t[3]=d(()=>{},["stop"]))},[r("div",Ew,[t[6]||(t[6]=r("h3",null,[r("i",{class:"fas fa-table"}),g(" Seleccionar Mesas para Activar ")],-1)),r("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},t[5]||(t[5]=[r("i",{class:"fas fa-times"},null,-1)]))]),r("div",Iw,[p.value?(w(),o("div",Sw,t[7]||(t[7]=[r("div",{class:"spinner"},null,-1),r("p",null,"Cargando mesas disponibles...",-1)]))):(w(),o("div",Tw,[h.value.length>0?(w(),o("div",Nw,[r("strong",null,c(h.value.length)+" mesa(s) seleccionada(s)",1)])):l("",!0),r("div",Pw,[(w(!0),o(_,null,k(m.value,e=>(w(),o("div",{key:e.id,class:C(["table-card",{selected:h.value.includes(e.id)}]),onClick:t=>f(e.id)},[r("div",xw,[r("input",{type:"checkbox",checked:h.value.includes(e.id),onClick:t[1]||(t[1]=d(()=>{},["stop"])),onChange:t=>f(e.id)},null,40,Rw)]),r("div",Dw,[r("div",Ow,"Mesa "+c(e.number),1),e.name&&e.name!==`Mesa ${e.number}`?(w(),o("div",Lw,c(e.name),1)):l("",!0),r("div",Mw,[e.capacity?(w(),o("span",Uw,[t[8]||(t[8]=r("i",{class:"fas fa-users"},null,-1)),g(" "+c(e.capacity)+" personas ",1)])):l("",!0),e.location?(w(),o("span",Fw,[t[9]||(t[9]=r("i",{class:"fas fa-map-marker-alt"},null,-1)),g(" "+c(e.location),1)])):l("",!0)])])],10,Aw))),128)),0===m.value.length?(w(),o("div",qw,t[10]||(t[10]=[r("i",{class:"fas fa-table"},null,-1),r("p",null,"No hay mesas disponibles para activar",-1),r("small",null,"Todas las mesas ya están asignadas a otros mozos",-1)]))):l("",!0)]),m.value.length>0?(w(),o("div",Bw,[r("button",{onClick:v,class:"quick-btn"},[t[11]||(t[11]=r("i",{class:"fas fa-check-double"},null,-1)),g(" Seleccionar Todas ("+c(m.value.length)+") ",1)]),h.value.length>0?(w(),o("button",{key:0,onClick:b,class:"quick-btn"},t[12]||(t[12]=[r("i",{class:"fas fa-times"},null,-1),g(" Deseleccionar Todas ")]))):l("",!0)])):l("",!0)]))]),r("div",jw,[r("button",{onClick:t[2]||(t[2]=t=>e.$emit("close")),class:"btn btn-secondary"}," Cancelar "),r("button",{onClick:y,class:"btn btn-primary",disabled:0===h.value.length||p.value},[t[13]||(t[13]=r("i",{class:"fas fa-check"},null,-1)),g(" Activar "+c(h.value.length)+" Mesa(s) ",1)],8,$w)])])]))}},[["__scopeId","data-v-f6fe2c8a"]]);function Vw(e){const t=rr(),a={id:`staff_join_success_${Date.now()}`,type:"staff_join_success",data:{title:"🎉 ¡Bienvenido al equipo!",message:`Te has unido exitosamente a ${e}`,route:"/waiter/dashboard",business_name:e},created_at:(new Date).toISOString()};return t.addNewNotification(a),a}const Ww={class:"business-selector"},Hw={key:0,class:"business-dropdown"},Gw={class:"business-details"},Kw={class:"business-name"},Jw={class:"business-subtitle"},Yw={class:"dropdown-arrow"},Qw={key:0,class:"dropdown-menu"},Zw={class:"dropdown-header"},Xw={class:"businesses-list"},ey=["onClick"],ty={class:"business-info"},ay={class:"business-name"},ny={class:"business-address"},iy={key:0,class:"current-indicator"},sy={class:"dropdown-footer"},oy={key:1,class:"no-business-state"},ry={class:"no-business-content"},ly={class:"modal-content"},cy={class:"modal-body"},dy={class:"form-group"},uy=["disabled"],hy={class:"modal-footer"},py=["disabled"],my=["disabled"],fy={key:0,class:"fas fa-spinner fa-spin"},vy={key:1},gy={__name:"BusinessSelector",emits:["business-changed","businesses-loaded"],setup(e,{expose:t,emit:n}){const i=n,p=a([]),m=a(null),f=a(!1),v=a(!1),b=a(""),y=a(!1),I=a(!1),S=async()=>{I.value=!0;try{const t=await sm.getWaiterBusinesses();if(t.success){if(p.value=t.businesses||[],t.active_business_id&&p.value.length>0?m.value=p.value.find(e=>e.id===t.active_business_id)||null:m.value=t.active_business||null,!m.value&&1===p.value.length)try{const e=p.value[0];(await sm.setActiveWaiterBusiness(e.id)).success&&(m.value=e)}catch(e){}i("businesses-loaded",{businesses:p.value,activeBusiness:m.value,needsBusiness:!m.value})}else console.error("❌ Error en respuesta de negocios:",t.message),sr(t.message||"Error cargando negocios")}catch(t){console.error("💥 Error loading businesses:",t),sr("Error cargando negocios")}finally{I.value=!1}},T=async()=>{var e,t,a,n,i,s;if(b.value.trim()){y.value=!0;try{const i=await sm.joinBusinessWithCode(b.value.trim());if(i.success){const s=(null==(e=i.business)?void 0:e.name)||(null==(a=null==(t=i.data)?void 0:t.business)?void 0:a.name)||"el negocio";"pending"===(null==(n=i.staff_request)?void 0:n.status)?ir("Solicitud enviada al administrador. Te notificaremos cuando sea aprobada."):(ir(i.message||"Te has unido al negocio exitosamente"),Vw(s)),b.value="",N(),await S()}else sr(i.message||"Error uniéndose al negocio")}catch(o){console.error("Error joining business:",o);const e=(null==(s=null==(i=o.response)?void 0:i.data)?void 0:s.message)||o.message||"Error uniéndose al negocio";sr(e)}finally{y.value=!1}}},N=()=>{v.value=!1,b.value="",y.value=!1},P=e=>{e.target.closest(".business-dropdown")||(f.value=!1)};return s(async()=>{await S(),document.addEventListener("click",P)}),E(()=>{document.removeEventListener("click",P)}),t({loadBusinesses:S,getCurrentBusiness:()=>m.value}),(e,t)=>{var a;return w(),o("div",Ww,[p.value.length>0?(w(),o("div",Hw,[r("div",{class:"current-business",onClick:t[0]||(t[0]=e=>f.value=!f.value)},[t[5]||(t[5]=r("div",{class:"business-icon"},[r("i",{class:"fas fa-building"})],-1)),r("div",Gw,[r("div",Kw,c((null==(a=m.value)?void 0:a.name)||"Seleccionar Negocio"),1),r("div",Jw,c(p.value.length)+" negocio"+c(1!==p.value.length?"s":""),1)]),r("div",Yw,[r("i",{class:C(["fas fa-chevron-down",{rotated:f.value}])},null,2)])]),f.value?(w(),o("div",Qw,[r("div",Zw,[t[7]||(t[7]=r("h4",null,"Mis Negocios",-1)),r("button",{onClick:t[1]||(t[1]=e=>f.value=!1),class:"close-btn"},t[6]||(t[6]=[r("i",{class:"fas fa-times"},null,-1)]))]),r("div",Xw,[(w(!0),o(_,null,k(p.value,e=>{var a,n;return w(),o("button",{key:e.id,onClick:t=>(async e=>{try{const t=await sm.setActiveWaiterBusiness(e.id);t.success?(m.value=e,f.value=!1,ir(`Negocio "${e.name}" seleccionado`),i("business-changed",e)):sr(t.message||"Error seleccionando negocio")}catch(t){console.error("Error selecting business:",t),sr("Error seleccionando negocio")}})(e),class:C(["business-item",{active:(null==(a=m.value)?void 0:a.id)===e.id}])},[r("div",ty,[r("div",ay,c(e.name),1),r("div",ny,c(e.address||"Sin dirección"),1)]),(null==(n=m.value)?void 0:n.id)===e.id?(w(),o("div",iy,t[8]||(t[8]=[r("i",{class:"fas fa-check"},null,-1)]))):l("",!0)],10,ey)}),128))]),r("div",sy,[r("button",{onClick:t[2]||(t[2]=e=>{v.value=!0,f.value=!1}),class:"join-btn"},t[9]||(t[9]=[r("i",{class:"fas fa-plus"},null,-1),g(" Unirse a nuevo negocio ")]))])])):l("",!0)])):(w(),o("div",oy,[r("div",ry,[t[11]||(t[11]=r("i",{class:"fas fa-building"},null,-1)),t[12]||(t[12]=r("h3",null,"Sin negocios asignados",-1)),t[13]||(t[13]=r("p",null,"Necesitas unirte a un negocio para empezar a trabajar",-1)),r("button",{onClick:t[3]||(t[3]=e=>v.value=!0),class:"join-btn primary"},t[10]||(t[10]=[r("i",{class:"fas fa-plus"},null,-1),g(" Unirse a negocio ")]))])])),v.value?(w(),o("div",{key:2,class:"modal-overlay",onClick:d(N,["self"])},[r("div",ly,[r("div",{class:"modal-header"},[t[15]||(t[15]=r("h3",null,"Unirse a negocio",-1)),r("button",{onClick:N,class:"close-btn"},t[14]||(t[14]=[r("i",{class:"fas fa-times"},null,-1)]))]),r("div",cy,[t[17]||(t[17]=r("p",null,"Ingresa el código del negocio al que deseas unirte:",-1)),r("form",{onSubmit:d(T,["prevent"])},[r("div",dy,[t[16]||(t[16]=r("label",{for:"businessCode"},"Código del negocio:",-1)),u(r("input",{id:"businessCode","onUpdate:modelValue":t[4]||(t[4]=e=>b.value=e),type:"text",class:"form-input",placeholder:"Ej: ABC123",disabled:y.value,required:""},null,8,uy),[[h,b.value]])])],32)]),r("div",hy,[r("button",{onClick:N,class:"btn btn-secondary",disabled:y.value}," Cancelar ",8,py),r("button",{onClick:T,class:"btn btn-primary",disabled:y.value||!b.value.trim()},[y.value?(w(),o("i",fy)):(w(),o("span",vy,"Unirse"))],8,my)])])])):l("",!0)])}}},by=Lh(gy,[["__scopeId","data-v-be090741"]]),wy={class:"business-tables-manager"},yy={class:"manager-header"},_y={class:"manager-stats"},ky={class:"stat-item"},Cy={class:"stat-number"},Ey={class:"stat-item success"},Iy={class:"stat-number"},Sy={class:"stat-item warning"},Ty={class:"stat-number"},Ny={class:"stat-item danger"},Py={class:"stat-number"},Ay={class:"tables-container"},xy={key:0,class:"loading-state"},Ry={key:1,class:"tables-grid"},Dy={class:"table-header"},Oy={class:"table-number"},Ly={class:"table-status"},My={key:0,class:"fas fa-exclamation-triangle status-icon urgent",title:"Tiene llamadas pendientes"},Uy={key:1,class:"fas fa-volume-mute status-icon silenced",title:"Silenciada"},Fy={key:2,class:"fas fa-check status-icon active",title:"Activa y asignada"},qy={key:3,class:"fas fa-ban status-icon silenced",title:"Mesa silenciada"},By={key:4,class:"fas fa-circle status-icon available",title:"Disponible"},jy={class:"table-info"},$y={key:0,class:"table-name"},zy={class:"table-details"},Vy={key:0},Wy={key:1},Hy={key:1,class:"assigned-waiter"},Gy={class:"table-actions"},Ky=["onClick"],Jy=["onClick"],Yy=["onClick"],Qy=["onClick"],Zy={key:2,class:"no-actions"},Xy={key:0},e_={key:1},t_={key:0,class:"empty-state"},a_={class:"quick-actions"},n_=["disabled"],i_={__name:"BusinessTablesManager",props:{businessId:{type:[String,Number],required:!0},businessName:{type:String,default:"Negocio"}},emits:["tables-updated"],setup(e,{expose:t,emit:i}){const d=e,u=i,h=a([]),p=a(!1),m=n(()=>h.value.length),f=n(()=>h.value.filter(e=>e.assigned_to_me).length),v=n(()=>h.value.filter(e=>!e.assigned_to_me&&!e.is_silenced).length),b=n(()=>h.value.filter(e=>e.is_silenced).length),y=n(()=>h.value.filter(e=>e.assigned_to_me)),E=n(()=>h.value.filter(e=>!e.assigned_to_me&&!e.is_silenced)),I=async()=>{p.value=!0,console.log("🏢 Cargando mesas del negocio:",d.businessId);try{const e=await sm.getWaiterBusinessTables(d.businessId);console.log("📋 Respuesta de mesas del negocio:",e),e.success?(h.value=e.tables||[],console.log("✅ Mesas cargadas:",h.value.length,h.value),h.value.forEach((e,t)=>{t<3&&console.log(`🔍 Mesa ${e.number}:`,{id:e.id,assigned_to_me:e.assigned_to_me,is_silenced:e.is_silenced,assigned_waiter:e.assigned_waiter})}),console.log("📊 Estadísticas calculadas:"),console.log("  - Total mesas:",h.value.length),console.log("  - Asignadas a mí:",h.value.filter(e=>e.assigned_to_me).length),console.log("  - Disponibles:",h.value.filter(e=>!e.assigned_to_me&&!e.is_silenced).length),console.log("  - Silenciadas:",h.value.filter(e=>e.is_silenced).length),u("tables-updated",h.value)):(console.error("❌ Error en respuesta:",e.message),sr(e.message||"Error cargando mesas del negocio"))}catch(e){console.error("💥 Error loading business tables:",e),sr("Error cargando mesas del negocio")}finally{p.value=!1}},S=async()=>{await I()},T=async()=>{var e;const t=E.value;if(0!==t.length)try{if(await or("¿Tomar todas las mesas disponibles?",`Se asignarán ${t.length} mesas a tu cuenta.`,"Tomar todas","Cancelar","info")){const a=t.map(e=>e.id),n=await sm.activateMultipleTables(a);n.success?(ir(`${(null==(e=n.summary)?void 0:e.successful)||t.length} mesas asignadas`),await I()):sr(n.message||"Error asignando mesas")}}catch(a){console.error("Error activating multiple tables:",a),sr("Error asignando mesas múltiples")}},N=async()=>{var e;const t=y.value;if(0!==t.length)try{if(await or("¿Desasignarte de todas las mesas?",`Se desasignarán ${t.length} mesas de tu cuenta.`,"Desasignar todas","Cancelar","warning")){const a=t.map(e=>e.id),n=await sm.deactivateMultipleTables(a);n.success?(ir(`${(null==(e=n.summary)?void 0:e.successful)||t.length} mesas desasignadas`),await I()):sr(n.message||"Error desasignando mesas")}}catch(a){console.error("Error deactivating multiple tables:",a),sr("Error desasignando mesas múltiples")}};return s(()=>{console.log("🏢 BusinessTablesManager mounted with businessId:",d.businessId),I()}),t({loadBusinessTables:I,refreshTables:S}),(t,a)=>(w(),o("div",wy,[r("div",yy,[r("h3",null,[a[0]||(a[0]=r("i",{class:"fas fa-table"},null,-1)),g(" Mesas de "+c(e.businessName),1)]),r("div",_y,[r("div",ky,[r("div",Cy,c(m.value),1),a[1]||(a[1]=r("div",{class:"stat-label"},"Total mesas",-1))]),r("div",Ey,[r("div",Iy,c(f.value),1),a[2]||(a[2]=r("div",{class:"stat-label"},"Asignadas a mí",-1))]),r("div",Sy,[r("div",Ty,c(v.value),1),a[3]||(a[3]=r("div",{class:"stat-label"},"Disponibles",-1))]),r("div",Ny,[r("div",Py,c(b.value),1),a[4]||(a[4]=r("div",{class:"stat-label"},"Silenciadas",-1))])])]),r("div",Ay,[p.value?(w(),o("div",xy,a[5]||(a[5]=[r("div",{class:"spinner"},null,-1),r("p",null,"Cargando mesas del negocio...",-1)]))):(w(),o("div",Ry,[(w(!0),o(_,null,k(h.value,e=>(w(),o("div",{key:e.id,class:C(["table-card",{assigned:e.assigned_to_me,available:!e.assigned_to_me&&!e.is_silenced,silenced:e.is_silenced,"has-calls":e.pending_calls_count>0}])},[r("div",Dy,[r("div",Oy,"Mesa "+c(e.number),1),r("div",Ly,[e.assigned_to_me&&e.pending_calls_count>0?(w(),o("i",My)):e.assigned_to_me&&e.is_silenced?(w(),o("i",Uy)):e.assigned_to_me?(w(),o("i",Fy)):e.is_silenced?(w(),o("i",qy)):(w(),o("i",By))])]),r("div",jy,[e.name&&e.name!==`Mesa ${e.number}`?(w(),o("div",$y,c(e.name),1)):l("",!0),r("div",zy,[e.capacity?(w(),o("span",Vy,[a[6]||(a[6]=r("i",{class:"fas fa-users"},null,-1)),g(" "+c(e.capacity)+" personas ",1)])):l("",!0),e.pending_calls_count>0?(w(),o("span",Wy,[a[7]||(a[7]=r("i",{class:"fas fa-bell"},null,-1)),g(" "+c(e.pending_calls_count)+" llamada(s) ",1)])):l("",!0)]),e.assigned_waiter&&!e.assigned_to_me?(w(),o("div",Hy,[a[8]||(a[8]=r("i",{class:"fas fa-user"},null,-1)),g(" Asignada a: "+c(e.assigned_waiter.name),1)])):l("",!0)]),r("div",Gy,[e.assigned_to_me?(w(),o(_,{key:0},[e.is_silenced?(w(),o("button",{key:0,onClick:t=>(async e=>{try{const t=await sm.unsilenceTable(e);t.success?(ir(t.message||"Mesa activada"),await I()):sr(t.message||"Error activando mesa")}catch(t){console.error("Error unsilencing table:",t),sr("Error activando mesa")}})(e.id),class:"action-btn unsilence",title:"Activar mesa"},a[9]||(a[9]=[r("i",{class:"fas fa-volume-up"},null,-1)]),8,Ky)):(w(),o("button",{key:1,onClick:t=>(async e=>{try{if(await or("¿Silenciar mesa?","La mesa no podrá realizar llamadas durante 30 minutos.","Silenciar","Cancelar","warning")){const t=await sm.silenceTable(e,30);t.success?(ir(t.message||"Mesa silenciada"),await I()):sr(t.message||"Error silenciando mesa")}}catch(t){console.error("Error silencing table:",t),sr("Error silenciando mesa")}})(e.id),class:"action-btn silence",title:"Silenciar mesa"},a[10]||(a[10]=[r("i",{class:"fas fa-volume-mute"},null,-1)]),8,Jy)),r("button",{onClick:t=>(async e=>{try{if(await or("¿Desasignarte de esta mesa?","Ya no recibirás llamadas de esta mesa.","Desasignar","Cancelar","warning")){const t=await sm.deactivateTable(e);t.success?(ir(t.message||"Mesa desasignada"),await I()):sr(t.message||"Error desasignando mesa")}}catch(t){console.error("Error deactivating table:",t),sr("Error desasignando mesa")}})(e.id),class:"action-btn deactivate",title:"Desasignarme de esta mesa"},a[11]||(a[11]=[r("i",{class:"fas fa-times"},null,-1)]),8,Yy)],64)):e.is_silenced?(w(),o("div",Zy,[e.is_silenced?(w(),o("span",Xy,"Mesa silenciada")):(w(),o("span",e_,"No disponible"))])):(w(),o("button",{key:1,onClick:t=>(async e=>{console.log("🚀 BusinessTablesManager: Iniciando activación de mesa:",e);try{const t=await sm.activateTable(e);console.log("📊 BusinessTablesManager: Respuesta de activación:",t),t.success?(console.log("✅ BusinessTablesManager: Mesa activada exitosamente"),ir(t.message||"Mesa activada"),console.log("🔄 BusinessTablesManager: Recargando mesas del negocio..."),await I()):(console.error("❌ BusinessTablesManager: Error en respuesta:",t.message),sr(t.message||"Error activando mesa"))}catch(t){console.error("💥 BusinessTablesManager: Error completo activando mesa:",t),sr("Error activando mesa")}})(e.id),class:"action-btn activate",title:"Asignarme esta mesa"},a[12]||(a[12]=[r("i",{class:"fas fa-plus"},null,-1),g(" Tomar ")]),8,Qy))])],2))),128)),0===h.value.length?(w(),o("div",t_,a[13]||(a[13]=[r("i",{class:"fas fa-table"},null,-1),r("h4",null,"Sin mesas registradas",-1),r("p",null,"Este negocio no tiene mesas registradas aún.",-1)]))):l("",!0)]))]),r("div",a_,[r("button",{onClick:S,class:"action-btn primary",disabled:p.value},[r("i",{class:C(["fas fa-sync-alt",{"fa-spin":p.value}])},null,2),a[14]||(a[14]=g(" Actualizar "))],8,n_),y.value.length>0?(w(),o("button",{key:0,onClick:N,class:"action-btn danger"},[a[15]||(a[15]=r("i",{class:"fas fa-sign-out-alt"},null,-1)),g(" Desasignarme de todas ("+c(y.value.length)+") ",1)])):l("",!0),E.value.length>0?(w(),o("button",{key:1,onClick:T,class:"action-btn success"},[a[16]||(a[16]=r("i",{class:"fas fa-check-double"},null,-1)),g(" Tomar todas disponibles ("+c(E.value.length)+") ",1)])):l("",!0)])]))}},s_=Lh(i_,[["__scopeId","data-v-0cdb7b2a"]]),o_={class:"table-profiles-manager"},r_={class:"profiles-header"},l_={key:0,class:"profiles-list"},c_={class:"profile-header"},d_={class:"profile-info"},u_={class:"profile-name"},h_={key:0,class:"active-badge"},p_={class:"profile-meta"},m_={class:"table-count"},f_={class:"created-date"},v_={class:"profile-actions"},g_=["onClick","disabled"],b_=["onClick","disabled"],w_=["onClick"],y_=["onClick"],__={class:"profile-tables"},k_={class:"tables-list"},C_={key:0,class:"fas fa-exclamation-triangle",title:"En conflicto con otro mozo"},E_={key:0,class:"conflict-info"},I_={key:1,class:"activation-summary"},S_={key:0,class:"summary-item success"},T_={key:1,class:"summary-item info"},N_={key:2,class:"summary-item warning"},P_={key:0,class:"empty-state"},A_={key:1,class:"loading-state"},x_={class:"modal-content"},R_={class:"modal-header"},D_={class:"modal-body"},O_={class:"form-group"},L_={class:"form-group"},M_={class:"tables-grid"},U_=["value","disabled"],F_={class:"table-info"},q_={class:"table-number"},B_={key:0,class:"table-name"},j_={key:1,class:"status-badge mine"},$_={key:2,class:"status-badge conflict"},z_={key:3,class:"status-badge available"},V_={class:"form-help"},W_={class:"form-actions"},H_=["disabled"],G_={key:0,class:"fas fa-spinner fa-spin"},K_={key:1,class:"fas fa-save"},J_={__name:"TableProfilesManager",props:{businessId:{type:Number,required:!0},availableTables:{type:Array,default:()=>[]},assignedTables:{type:Array,default:()=>[]}},emits:["profiles-updated"],setup(e,{emit:t}){const a=e,i=t,p=I({profiles:[],loading:!1,processing:null,saving:!1,showCreateModal:!1,editingProfile:null,formData:{name:"",table_ids:[]}}),f=n(()=>p.profiles),v=n(()=>p.loading),b=n(()=>p.processing),y=n(()=>p.saving),E=n({get:()=>p.showCreateModal,set:e=>p.showCreateModal=e}),S=n(()=>p.editingProfile),T=n(()=>p.formData),N=n(()=>[...a.availableTables,...a.assignedTables].map(e=>({...e,is_assigned_to_me:a.assignedTables.some(t=>t.id===e.id),is_assigned_to_other:e.assigned_waiter&&"Tú"!==e.assigned_waiter,assigned_waiter:e.assigned_waiter||"Disponible"}))),P=async()=>{p.loading=!0;try{const e=await va.getWaiterTableProfiles();e.data.success?(p.profiles=e.data.profiles||[],console.log("✅ Perfiles cargados:",p.profiles.length)):sr(e.data.message||"Error cargando perfiles")}catch(e){console.error("Error loading profiles:",e),sr("Error cargando perfiles")}finally{p.loading=!1}},A=async()=>{if(p.formData.name.trim()&&0!==p.formData.table_ids.length){p.saving=!0;try{const e={name:p.formData.name.trim(),table_ids:p.formData.table_ids};let t;t=p.editingProfile?await va.updateWaiterTableProfile(p.editingProfile.id,e):await va.createWaiterTableProfile(e),t.data.success?(ir(t.data.message||`Perfil ${p.editingProfile?"actualizado":"creado"} correctamente`),x(),await P(),i("profiles-updated")):sr(t.data.message||`Error ${p.editingProfile?"actualizando":"creando"} perfil`)}catch(e){console.error("Error saving profile:",e),sr(`Error ${p.editingProfile?"actualizando":"creando"} perfil`)}finally{p.saving=!1}}else sr("Completa todos los campos requeridos")},x=()=>{p.showCreateModal=!1,p.editingProfile=null,p.formData={name:"",table_ids:[]}},R=e=>a.assignedTables.some(t=>t.number===e),D=e=>{if(!e)return"";return new Date(e).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})};return s(async()=>{console.log("🏠 TableProfilesManager mounted"),await P()}),(e,t)=>(w(),o("div",o_,[r("div",r_,[t[5]||(t[5]=r("div",{class:"header-info"},[r("h3",null,[r("i",{class:"fas fa-bookmark"}),g(" Mis Perfiles de Mesa ")]),r("p",{class:"header-description"}," Crea perfiles con conjuntos de mesas para activar rápidamente ")],-1)),r("button",{onClick:t[0]||(t[0]=e=>E.value=!0),class:"btn btn-primary"},t[4]||(t[4]=[r("i",{class:"fas fa-plus"},null,-1),g(" Crear Perfil ")]))]),v.value?l("",!0):(w(),o("div",l_,[(w(!0),o(_,null,k(f.value,e=>{var a,n,s;return w(),o("div",{key:e.id,class:C(["profile-card",{active:e.is_active,"has-conflicts":(null==(a=e.conflict_tables)?void 0:a.length)>0}])},[r("div",c_,[r("div",d_,[r("h4",u_,[g(c(e.name)+" ",1),e.is_active?(w(),o("span",h_,"ACTIVO")):l("",!0)]),r("div",p_,[r("span",m_,[t[6]||(t[6]=r("i",{class:"fas fa-table"},null,-1)),g(" "+c((null==(n=e.table_numbers)?void 0:n.length)||0)+" mesas ",1)]),r("span",f_," Creado "+c(D(e.created_at)),1)])]),r("div",v_,[e.is_active?l("",!0):(w(),o("button",{key:0,onClick:t=>(async e=>{p.processing=e;try{const t=await va.activateWaiterTableProfile(e);t.data.success?(ir(t.data.message||"Perfil activado"),await P(),i("profiles-updated")):sr(t.data.message||"Error activando perfil")}catch(t){console.error("Error activating profile:",t),sr("Error activando perfil")}finally{p.processing=null}})(e.id),class:"action-btn activate",disabled:b.value===e.id,title:"Activar perfil"},t[7]||(t[7]=[r("i",{class:"fas fa-play"},null,-1)]),8,g_)),e.is_active?(w(),o("button",{key:1,onClick:t=>(async e=>{if(await or("¿Desactivar perfil?","Se desasignarán todas las mesas de este perfil.","Desactivar","Cancelar","warning")){p.processing=e;try{const t=await va.deactivateWaiterTableProfile(e);t.data.success?(ir(t.data.message||"Perfil desactivado"),await P(),i("profiles-updated")):sr(t.data.message||"Error desactivando perfil")}catch(t){console.error("Error deactivating profile:",t),sr("Error desactivando perfil")}finally{p.processing=null}}})(e.id),class:"action-btn deactivate",disabled:b.value===e.id,title:"Desactivar perfil"},t[8]||(t[8]=[r("i",{class:"fas fa-pause"},null,-1)]),8,b_)):l("",!0),r("button",{onClick:t=>(e=>{p.editingProfile=e,p.formData={name:e.name,table_ids:[...e.table_ids||[]]},p.showCreateModal=!1})(e),class:"action-btn edit",title:"Editar perfil"},t[9]||(t[9]=[r("i",{class:"fas fa-edit"},null,-1)]),8,w_),r("button",{onClick:t=>(async(e,t)=>{if(await or(`¿Eliminar perfil "${t}"?`,"Esta acción no se puede deshacer.","Eliminar","Cancelar","danger"))try{const t=await va.deleteWaiterTableProfile(e);t.data.success?(ir(t.data.message||"Perfil eliminado"),await P(),i("profiles-updated")):sr(t.data.message||"Error eliminando perfil")}catch(a){console.error("Error deleting profile:",a),sr("Error eliminando perfil")}})(e.id,e.name),class:"action-btn delete",title:"Eliminar perfil"},t[10]||(t[10]=[r("i",{class:"fas fa-trash"},null,-1)]),8,y_)])]),r("div",__,[r("div",k_,[(w(!0),o(_,null,k(e.table_numbers,t=>{var a,n;return w(),o("span",{key:t,class:C(["table-tag",{conflict:null==(a=e.conflict_tables)?void 0:a.includes(t),assigned:R(t)}])},[g(" Mesa "+c(t)+" ",1),(null==(n=e.conflict_tables)?void 0:n.includes(t))?(w(),o("i",C_)):l("",!0)],2)}),128))])]),(null==(s=e.conflict_tables)?void 0:s.length)>0?(w(),o("div",E_,[t[11]||(t[11]=r("i",{class:"fas fa-exclamation-triangle"},null,-1)),r("span",null,c(e.conflict_tables.length)+" mesa(s) en conflicto con otros mozos",1)])):l("",!0),e.is_active&&e.activation_summary?(w(),o("div",I_,[e.activation_summary.activated>0?(w(),o("div",S_,[t[12]||(t[12]=r("i",{class:"fas fa-check"},null,-1)),g(" "+c(e.activation_summary.activated)+" activadas ",1)])):l("",!0),e.activation_summary.already_yours>0?(w(),o("div",T_,[t[13]||(t[13]=r("i",{class:"fas fa-user-check"},null,-1)),g(" "+c(e.activation_summary.already_yours)+" ya eran tuyas ",1)])):l("",!0),e.activation_summary.conflicts>0?(w(),o("div",N_,[t[14]||(t[14]=r("i",{class:"fas fa-exclamation-triangle"},null,-1)),g(" "+c(e.activation_summary.conflicts)+" en conflicto ",1)])):l("",!0)])):l("",!0)],2)}),128)),0===f.value.length?(w(),o("div",P_,[t[16]||(t[16]=r("i",{class:"fas fa-bookmark"},null,-1)),t[17]||(t[17]=r("h4",null,"No tienes perfiles creados",-1)),t[18]||(t[18]=r("p",null,"Crea tu primer perfil para agrupar mesas que usas frecuentemente",-1)),r("button",{onClick:t[1]||(t[1]=e=>E.value=!0),class:"btn btn-primary"},t[15]||(t[15]=[r("i",{class:"fas fa-plus"},null,-1),g(" Crear Primer Perfil ")]))])):l("",!0)])),v.value?(w(),o("div",A_,t[19]||(t[19]=[r("i",{class:"fas fa-spinner fa-spin"},null,-1),r("p",null,"Cargando perfiles...",-1)]))):l("",!0),E.value||S.value?(w(),o("div",{key:2,class:"modal-overlay",onClick:d(x,["self"])},[r("div",x_,[r("div",R_,[r("h3",null,[t[20]||(t[20]=r("i",{class:"fas fa-bookmark"},null,-1)),g(" "+c(S.value?"Editar Perfil":"Crear Nuevo Perfil"),1)]),r("button",{onClick:x,class:"close-btn"},t[21]||(t[21]=[r("i",{class:"fas fa-times"},null,-1)]))]),r("div",D_,[r("form",{onSubmit:d(A,["prevent"])},[r("div",O_,[t[22]||(t[22]=r("label",{for:"profileName"},"Nombre del perfil",-1)),u(r("input",{id:"profileName","onUpdate:modelValue":t[2]||(t[2]=e=>T.value.name=e),type:"text",class:"form-input",placeholder:"Ej: Zona A, Terraza, Mesas VIP...",maxlength:"50",required:""},null,512),[[h,T.value.name]]),t[23]||(t[23]=r("small",{class:"form-help"}," Máximo 50 caracteres. Debe ser único. ",-1))]),r("div",L_,[t[24]||(t[24]=r("label",null,"Selecciona las mesas (máximo 20)",-1)),r("div",M_,[(w(!0),o(_,null,k(N.value,e=>(w(),o("label",{key:e.id,class:C(["table-checkbox",{selected:T.value.table_ids.includes(e.id),assigned:e.is_assigned_to_me,conflict:e.is_assigned_to_other}])},[u(r("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":t[3]||(t[3]=e=>T.value.table_ids=e),disabled:T.value.table_ids.length>=20&&!T.value.table_ids.includes(e.id)},null,8,U_),[[m,T.value.table_ids]]),r("span",F_,[r("span",q_,"Mesa "+c(e.number),1),e.name&&e.name!==`Mesa ${e.number}`?(w(),o("span",B_,c(e.name),1)):l("",!0),e.is_assigned_to_me?(w(),o("span",j_,"Tuya")):e.is_assigned_to_other?(w(),o("span",$_,c(e.assigned_waiter),1)):(w(),o("span",z_,"Disponible"))])],2))),128))]),r("small",V_," Seleccionadas: "+c(T.value.table_ids.length)+"/20 ",1)]),r("div",W_,[r("button",{type:"button",onClick:x,class:"btn btn-secondary"}," Cancelar "),r("button",{type:"submit",class:"btn btn-primary",disabled:!T.value.name.trim()||0===T.value.table_ids.length||y.value},[y.value?(w(),o("i",G_)):(w(),o("i",K_)),g(" "+c(S.value?"Actualizar":"Crear")+" Perfil ",1)],8,H_)])],32)])])])):l("",!0)]))}},Y_=Lh(J_,[["__scopeId","data-v-ad74d18c"]]),Q_={class:"waiter-dashboard-root"},Z_={class:"waiter-dashboard"},X_={class:"dashboard-header"},ek={class:"waiter-info"},tk={class:"waiter-details"},ak={class:"business-selector-container"},nk={class:"dashboard-stats"},ik={class:"stat-item"},sk={class:"stat-number"},ok={class:"stat-item urgent"},rk={class:"stat-number"},lk={class:"stat-item"},ck={class:"stat-number"},dk={class:"dashboard-content"},uk={class:"left-column"},hk={class:"section-card"},pk={class:"section-header"},mk={class:"section-actions"},fk=["disabled"],vk={class:"tables-list"},gk={class:"table-info"},bk={class:"table-name"},wk={key:0,class:"urgency-icon"},yk=["title"],_k={key:2,class:"ok-icon"},kk={key:0,class:"table-subtitle"},Ck={key:1,class:"table-silenced-info"},Ek={class:"table-actions"},Ik=["onClick"],Sk=["onClick"],Tk=["onClick"],Nk=["onClick"],Pk={key:0,class:"empty-state"},Ak={key:0},xk={key:1},Rk={class:"right-column"},Dk={class:"section-card"},Ok={class:"notifications-list",id:"calls-container"},Lk={class:"notification-info"},Mk={class:"notification-title"},Uk={class:"notification-message"},Fk={class:"notification-time"},qk={key:0,class:"urgent-badge"},Bk={key:1,class:"spam-badge"},jk={key:0,class:"client-info"},$k={key:0,class:"source-badge"},zk={class:"notification-actions"},Vk=["onClick","disabled"],Wk=["onClick","disabled"],Hk=["onClick"],Gk=["onClick","disabled"],Kk={key:0,class:"empty-notifications"},Jk={key:0},Yk={key:1},Qk={class:"section-card"},Zk={class:"acknowledged-list"},Xk={class:"notification-info"},eC={class:"notification-title"},tC={class:"notification-message"},aC={class:"notification-time"},nC={class:"notification-actions"},iC=["onClick","disabled"],sC={key:0,class:"empty-notifications"},oC={class:"section-card"},rC={class:"section-header"},lC=["disabled"],cC={class:"blocked-ips-list-sidebar"},dC={class:"blocked-ip-info"},uC={class:"blocked-ip-address"},hC={class:"blocked-ip-details"},pC={class:"blocked-detail"},mC={class:"blocked-detail"},fC={class:"blocked-detail"},vC={key:0,class:"blocked-detail expires"},gC={key:1,class:"blocked-detail permanent"},bC={key:2,class:"blocked-detail notes"},wC={class:"blocked-ip-actions"},yC=["onClick"],_C={key:0,class:"empty-notifications"},kC={key:0},CC={key:1},EC={class:"modal-content large"},IC={class:"modal-header"},SC={class:"modal-body"},TC={class:"modal-content large"},NC={class:"modal-header"},PC={class:"modal-body"},AC={class:"modal-content large"},xC={class:"modal-header"},RC={class:"modal-body"},DC={class:"anti-spam-section"},OC={key:0,class:"spam-alerts"},LC={class:"ip-info"},MC={class:"call-count"},UC={class:"ip-calls"},FC=["onClick"],qC={class:"blocked-ips-list"},BC={key:0,class:"empty-state"},jC={key:1,class:"blocked-ip-cards"},$C={class:"blocked-ip-header"},zC={class:"ip-address"},VC={class:"block-reason"},WC={class:"blocked-ip-details"},HC={class:"detail-item"},GC={class:"detail-item"},KC={key:0,class:"detail-item"},JC={key:1,class:"detail-item"},YC={key:2,class:"detail-item"},QC={class:"blocked-ip-actions"},ZC=["onClick"],XC={class:"modal-content large"},eE={class:"modal-header"},tE={class:"modal-body ip-debug-body"},aE={class:"ip-debug-form"},nE={class:"actions"},iE=["disabled"],sE={key:0,class:"fas fa-search"},oE={key:1,class:"fas fa-spinner fa-spin"},rE=["disabled"],lE={key:0,class:"error-box"},cE={key:0,class:"ip-debug-result"},dE={class:"summary-line"},uE={key:0,class:"locks-section"},hE={key:1,class:"locks-section"},pE={class:"raw-json"},mE={key:1,class:"hint-box"},fE={__name:"Dashboard",setup(e){const t=b(),m=en(),f=I({assignedTables:[],availableTables:[],pendingCalls:[],callHistory:[],silencedTables:[],businesses:[],currentBusiness:null,needsBusiness:!1,loading:!1,processingCall:null,showTableSelector:!1,showTablesManager:!1,showProfilesManager:!1,showBlockedIpsManager:!1,blockedIps:[],showIpDebugPanel:!1}),v=n(()=>f.availableTables),y=n(()=>f.silencedTables),N=n(()=>f.loading),P=n(()=>f.processingCall),A=n({get:()=>f.showTableSelector,set:e=>f.showTableSelector=e}),x=n({get:()=>f.showTablesManager,set:e=>f.showTablesManager=e}),R=n({get:()=>f.showProfilesManager,set:e=>f.showProfilesManager=e}),D=n({get:()=>f.showBlockedIpsManager,set:e=>f.showBlockedIpsManager=e}),O=n({get:()=>f.showIpDebugPanel,set:e=>f.showIpDebugPanel=e}),L=a(""),M=a(!1),U=a(null),F=a(null),q=n(()=>f.blockedIps||[]),B=a(null);n(()=>f.businesses);const j=n(()=>f.currentBusiness),$=n(()=>f.needsBusiness);n(()=>{var e;return(null==(e=f.currentBusiness)?void 0:e.name)||"Seleccionar Negocio"}),n(()=>{try{if(window&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls){const e=new Set(Array.from(window.ultraFastNotifications.activeCalls.keys()).map(e=>String(e)));return f.pendingCalls.filter(t=>!e.has(String(t.id)))}}catch(e){}return f.pendingCalls});const z=n(()=>{try{const e=new Set(window&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls?Array.from(window.ultraFastNotifications.activeCalls.keys()).map(e=>String(e)):[]);return f.callHistory.filter(t=>!e.has(String(t.id)))}catch(e){return f.callHistory}});n(()=>{try{if(window&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls){const e=new Set(Array.from(window.ultraFastNotifications.activeCalls.keys()).map(e=>String(e)));return f.pendingCalls.filter(t=>!e.has(String(t.id)))}}catch(e){}return f.pendingCalls});const V=n(()=>f.assignedTables.map(e=>{var t,a;const n=null==(t=e.calls)?void 0:t.pending_count,i=f.pendingCalls.filter(t=>{var a;return t.table_id===e.id||(null==(a=t.table)?void 0:a.id)===e.id}).length;return{...e,is_silenced:(null==(a=e.silence)?void 0:a.is_silenced)??e.is_silenced??!1,pending_calls_count:"number"==typeof n?n:i}})),W=n(()=>{if(!f.pendingCalls||!Array.isArray(f.pendingCalls))return{};const e=Date.now()-6e5,t={};return f.pendingCalls.forEach(a=>{var n;const i=null==(n=a.client_info)?void 0:n.ip_address;!i||!a.called_at||a.called_at<e||(t[i]||(t[i]={count:0,calls:[]}),t[i].count++,t[i].calls.push(a))}),t}),G=n(()=>Object.entries(W.value).filter(([e,t])=>t.count>=2).map(([e,t])=>({ip:e,...t}))),K=n(()=>f.pendingCalls&&Array.isArray(f.pendingCalls)?f.pendingCalls.map(e=>{var t;const a=null==(t=e.client_info)?void 0:t.ip_address,n=W.value[a];return{...e,is_potential_spam:n&&n.count>=2,ip_call_count:n?n.count:1}}):[]);function J(e){const t=String(e.id);f.callHistory=f.callHistory.filter(e=>String(e.id)!==t);const a=f.pendingCalls.findIndex(e=>String(e.id)===t),n=Date.now(),i=e.called_at||e.timestamp||n,s=Math.max(0,Math.floor((n-i)/6e4)),o={...e,minutes_ago:s};-1===a?f.pendingCalls.unshift(o):f.pendingCalls[a]={...f.pendingCalls[a],...o}}function Y(e){try{const t=null==e?void 0:e.detail;if(!t||!t.id)return;console.debug("Dashboard handler ultraFastAddCall",t.id,t),J(t)}catch(t){console.warn("Error handling ultraFastAddCall:",t)}}function Q(e){try{const t=null==e?void 0:e.detail;if(!t||!t.id)return;J(t)}catch(t){console.warn("Error handling updateCallStatus:",t)}}function Z(e){var t;try{const a=null==(t=null==e?void 0:e.detail)?void 0:t.callId;if(!a)return;const n=String(a);f.pendingCalls=f.pendingCalls.filter(e=>String(e.id)!==n)}catch(a){console.warn("Error handling removeCall:",a)}}function X(){f.pendingCalls=[]}function ee(e){var t;try{const a=null==(t=null==e?void 0:e.detail)?void 0:t.callId;if(!a)return;const n=f.pendingCalls.findIndex(e=>String(e.id)===String(a));if(-1!==n){const e={...f.pendingCalls[n],status:"acknowledged"};f.pendingCalls.splice(n,1),f.callHistory.unshift(e)}}catch(a){console.warn("Error handling callAcknowledged:",a)}}function te(e){try{const t=(null==e?void 0:e.detail)||{},a=t.callId||t.callData&&t.callData.id,n=t.callData||null;if(!a)return;if(n&&"pending"===n.status)return;f.pendingCalls=f.pendingCalls.filter(e=>String(e.id)!==String(a));const i=f.callHistory.find(e=>String(e.id)===String(a));i?Object.assign(i,n||{}):n&&f.callHistory.unshift(n)}catch(t){console.warn("Error manejando callMovedToHistory en Dashboard:",t)}}let ae=null;const ne=async()=>{if(!f.needsBusiness&&f.currentBusiness){f.loading=!0;try{await Promise.all([ie(),se(),oe(),re(),ye()])}catch(e){console.error("Error loading dashboard data:",e),sr("Error cargando datos del dashboard")}finally{f.loading=!1}}};s(async()=>{await ne(),window.__waiterDashboardListenersRegistered||(window.addEventListener("newWaiterCall",Y),window.addEventListener("updateCallStatus",Q),window.addEventListener("removeCall",Z),window.addEventListener("clearAllCalls",X),window.addEventListener("callAcknowledged",ee),window.addEventListener("callMovedToHistory",te),window.__waiterDashboardListenersRegistered=!0);try{window.debugUltra=()=>({pendingCalls:f.pendingCalls.slice(),activeCalls:window.ultraFastNotifications?Array.from(window.ultraFastNotifications.activeCalls.keys()):[]})}catch(e){}}),E(()=>{try{window.__waiterDashboardListenersRegistered&&(window.removeEventListener("newWaiterCall",Y),window.removeEventListener("updateCallStatus",Q),window.removeEventListener("removeCall",Z),window.removeEventListener("clearAllCalls",X),window.removeEventListener("callAcknowledged",ee),window.removeEventListener("callMovedToHistory",te),window.__waiterDashboardListenersRegistered=!1)}catch(e){console.warn("Error removing ultraFast event listeners:",e)}try{ae&&ae.stopListening&&ae.stopListening()}catch(e){console.warn("Error stopping ultraFastNotifications on unmount:",e)}});const ie=async()=>{var e;if(f.currentBusiness)try{const t=await sm.getWaiterBusinessTables(f.currentBusiness.id);if(t.success){const a=(null==(e=t.tables)?void 0:e.filter(e=>{var t;return"assigned_to_me"===(null==(t=e.status)?void 0:t.assignment)}))||[];f.assignedTables=a}}catch(t){console.error("❌ Error cargando mesas asignadas:",t),sr("Error al cargar las mesas asignadas")}},se=async()=>{},oe=async()=>{try{const e=await sm.getAvailableTables();e.success&&(f.availableTables=e.available_tables||[])}catch(e){console.error("💥 Error loading available tables:",e)}},re=async()=>{try{const e=await sm.getSilencedTables();e.success&&(f.silencedTables=e.silenced_tables||[])}catch(e){console.error("Error loading silenced tables:",e)}},le=async e=>{try{if(await or("¿Silenciar mesa?","La mesa no podrá realizar llamadas durante 30 minutos.","Silenciar","Cancelar","warning")){const t=await sm.silenceTable(e,30);t.success?(ir(t.message||"Mesa silenciada"),await ie(),await re()):sr(t.message||"Error silenciando mesa")}}catch(t){console.error("Error silencing table:",t),sr("Error silenciando mesa")}},ce=async()=>{await ne()},de=async()=>{try{if(await or("¿Finalizar turno?","Te desasignarás de todas las mesas y saldrás de la aplicación.","Finalizar Turno","Cancelar","danger")){if(f.assignedTables.length>0){const e=f.assignedTables.map(e=>e.id);await sm.deactivateMultipleTables(e)}ge(),await m.logout(),ir("Turno finalizado correctamente"),await t.push("/login")}}catch(e){console.error("Error ending shift:",e),sr("Error finalizando turno")}},ue=e=>{f.businesses=e.businesses||[],f.currentBusiness=e.activeBusiness||null,f.needsBusiness=e.needsBusiness||!1,f.currentBusiness&&!f.needsBusiness&&(ne(),ve())},he=e=>{f.currentBusiness=e,f.assignedTables=[],f.availableTables=[],f.pendingCalls=[],f.silencedTables=[],ne(),ve()};S(()=>f.showTableSelector,async e=>{e&&f.currentBusiness&&!f.needsBusiness&&await oe()});const pe=async e=>{var t;if(f.showTableSelector=!1,0!==e.length)try{const a=await sm.activateMultipleTables(e);a.success?(console.log("✅ Dashboard: Mesas activadas exitosamente"),ir(a.message||`${(null==(t=a.summary)?void 0:t.successful)||e.length} mesas activadas`),await ie(),await oe(),ve()):sr(a.message||"Error activando mesas")}catch(a){console.error("💥 Dashboard: Error completo activando mesas múltiples:",a),sr("Error activando mesas")}},me=async e=>{await ne()},fe=async()=>{await ne()},ve=async()=>{if(m.user&&!f.needsBusiness)try{ae=function(e){"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission();try{Ba&&Ba.isPluginAvailable&&Ba.isPluginAvailable("LocalNotifications")&&H(async()=>{const{LocalNotifications:e}=await import("./index-DlE1A72V.js");return{LocalNotifications:e}},__vite__mapDeps([9,1,2])).then(({LocalNotifications:e})=>{e.requestPermissions().then(e=>{console.log("UNIFIED: LocalNotifications permissions:",e)}).catch(e=>{console.warn("Error pidiendo permisos LocalNotifications:",e)}),e.createChannel&&e.createChannel({id:"mozo_waiter",name:"Mozo - Llamadas",importance:5,visibility:1,description:"Notificaciones de llamadas y eventos importantes para mozos"}).then(()=>{console.log("✅ UNIFIED: Canal mozo_waiter creado")}).catch(e=>{console.warn("⚠️ Error creando canal mozo_waiter:",e)})}).catch(e=>console.warn("⚠️ No se pudo importar LocalNotifications:",e))}catch(a){console.warn("⚠️ Excepción al preparar LocalNotifications:",a)}const t=new Cw(e);return t.startListening(),console.log("⚡ UNIFIED notifications inicializadas"),t}(m.user.id.toString())}catch(e){console.error("❌ Error configurando Ultra Fast Firebase:",e),sr("Error configurando notificaciones ultra rápidas")}},ge=async()=>{try{ae&&(ae.stopListening(),ae=null)}catch(e){console.error("❌ Error desconectando Ultra Fast Firebase:",e)}};s(async()=>{}),E(()=>{ge()});const be=async()=>{if(ae)try{const e=await ae.createTestCall();ir(`🧪 Llamada de prueba creada: Mesa ${e.table_number}`)}catch(e){console.error("Error creando llamada de prueba:",e),sr("Error al crear la llamada de prueba")}else sr("Sistema de notificaciones ultra rápidas no disponible")},we=async e=>{var t;if(null==(t=e.client_info)?void 0:t.ip_address)try{if(await or("¿Bloquear IP por spam?",`Se bloqueará la IP ${e.client_info.ip_address} por 24 horas. Esta IP no podrá realizar más llamadas.`,"Bloquear IP","Cancelar","error")){f.processingCall=e.id;const t=await sm.blockIpForSpam(e.id,{reason:"spam",duration_hours:24,notes:`Bloqueada desde Mesa ${e.table_number} - IP: ${e.client_info.ip_address}`});if(t.success){ir(`IP ${e.client_info.ip_address} bloqueada por 24 horas`);const t=e.client_info.ip_address;f.pendingCalls=f.pendingCalls.filter(e=>{var a;return(null==(a=e.client_info)?void 0:a.ip_address)!==t}),await ye()}else sr(t.message||"Error bloqueando IP")}}catch(a){console.error("Error blocking IP for spam:",a),sr("Error bloqueando IP por spam")}finally{f.processingCall=null}else sr("No se puede bloquear: IP no disponible")},ye=async()=>{try{const e=await sm.getBlockedIps({active_only:!0});e.success?f.blockedIps=e.blocked_ips||[]:f.blockedIps=[]}catch(e){console.error("Error loading blocked IPs:",e),f.blockedIps=[]}},_e=async e=>{var t;try{if(await or("¿Desbloquear IP?",`Se desbloqueará la IP ${e} y podrá volver a realizar llamadas.`,"Desbloquear","Cancelar","warning")){const a=await sm.unblockIp(e,null==(t=f.currentBusiness)?void 0:t.id);a.success?(ir(`IP ${e} desbloqueada`),await ye()):sr(a.message||"Error desbloqueando IP")}}catch(a){console.error("Error unblocking IP:",a),sr("Error desbloqueando IP")}},ke=()=>{f.showIpDebugPanel=!0,L.value="",U.value=null,F.value=null},Ce=async()=>{var e;if(L.value){M.value=!0,F.value=null,U.value=null;try{const t=await sm.debugBlockedIp(L.value,null==(e=f.currentBusiness)?void 0:e.id);t.success?U.value=t.data||t:F.value=t.message||"Diagnóstico fallido"}catch(t){console.error("Error debug IP:",t),F.value=t.message||"Error de red"}finally{M.value=!1}}},Ee=async()=>{var e,t;if(!(null==(e=U.value)?void 0:e.ip_address))return;if(await or("¿Force Unblock?",`Se forzará el desbloqueo completo de la IP ${U.value.ip_address}.`,"Desbloquear","Cancelar","warning")){M.value=!0;try{const e=await sm.forceUnblockIp(U.value.ip_address,null==(t=f.currentBusiness)?void 0:t.id);e.success?(ir("IP desbloqueada forzadamente"),await Ce(),await ye()):sr(e.message||"No se pudo desbloquear")}catch(a){console.error("Error force unblock:",a),sr(a.message||"Error desconocido")}finally{M.value=!1}}},Ie=e=>{if(!e)return"N/A";try{const t=new Date(e),a=new Date-t,n=Math.floor(a/864e5),i=Math.floor(a/36e5),s=Math.floor(a/6e4);return s<60?`Hace ${s}m`:i<24?`Hace ${i}h`:n<7?`Hace ${n}d`:t.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(t){return console.error("Error formatting date:",t),"Fecha inválida"}};return(e,t)=>{var a,n,s,b,E,I,S;return w(),o("div",Q_,[r("div",Z_,[r("div",X_,[r("div",ek,[t[15]||(t[15]=r("div",{class:"waiter-avatar"},[r("i",{class:"fas fa-user-circle"})],-1)),r("div",tk,[r("h2",null,c((null==(a=i(m).user)?void 0:a.name)||"Mozo"),1),r("div",ak,[p(by,{onBusinessChanged:he,onBusinessesLoaded:ue,ref_key:"businessSelector",ref:B},null,512)])])]),r("div",nk,[r("div",ik,[r("div",sk,c(V.value.length),1),t[16]||(t[16]=r("div",{class:"stat-label"},"Mesas asignadas",-1))]),r("div",ok,[r("div",rk,c(K.value.length),1),t[17]||(t[17]=r("div",{class:"stat-label"},"Llamadas pendientes",-1))]),r("div",lk,[r("div",ck,c(y.value.length),1),t[18]||(t[18]=r("div",{class:"stat-label"},"Mesas silenciadas",-1))])])]),r("div",dk,[r("div",uk,[r("div",hk,[r("div",pk,[t[25]||(t[25]=r("h3",null,[r("i",{class:"fas fa-table"}),g(" Todas ")],-1)),r("div",mk,[$.value?l("",!0):(w(),o("button",{key:0,onClick:t[0]||(t[0]=e=>R.value=!0),class:"action-btn info"},t[19]||(t[19]=[r("i",{class:"fas fa-bookmark"},null,-1),g(" Perfiles ")]))),$.value?l("",!0):(w(),o("button",{key:1,onClick:t[1]||(t[1]=e=>D.value=!0),class:"action-btn danger"},t[20]||(t[20]=[r("i",{class:"fas fa-shield-alt"},null,-1),g(" Anti-Spam ")]))),$.value?l("",!0):(w(),o("button",{key:2,onClick:ke,class:"action-btn secondary"},t[21]||(t[21]=[r("i",{class:"fas fa-bug"},null,-1),g(" IP Debug ")]))),$.value?l("",!0):(w(),o("button",{key:3,onClick:t[2]||(t[2]=e=>x.value=!0),class:"action-btn secondary"},t[22]||(t[22]=[r("i",{class:"fas fa-cog"},null,-1),g(" Gestionar Mesas ")]))),$.value?l("",!0):(w(),o("button",{key:4,onClick:t[3]||(t[3]=e=>A.value=!0),class:"action-btn primary"},t[23]||(t[23]=[r("i",{class:"fas fa-plus"},null,-1),g(" Activar Mesas ")]))),r("button",{onClick:ce,class:"action-btn",disabled:N.value},[r("i",{class:C(["fas fa-sync-alt",{"fa-spin":N.value}])},null,2)],8,fk),r("button",{onClick:be,class:"action-btn warning"},t[24]||(t[24]=[r("i",{class:"fas fa-flask"},null,-1),g(" Test Call ")]))])]),r("div",vk,[(w(!0),o(_,null,k(V.value,e=>{var a,n,i,s,d,u,h;return w(),o("div",{key:e.id,class:C(["table-item",{"has-calls":e.pending_calls_count>0,silenced:e.is_silenced}])},[r("div",gk,[r("div",bk,[g(" Mesa "+c(e.number)+" ",1),e.pending_calls_count>0?(w(),o("span",wk,t[26]||(t[26]=[r("i",{class:"fas fa-exclamation-triangle"},null,-1)]))):e.is_silenced?(w(),o("span",{key:1,class:"silence-icon",title:(null==(a=e.silence)?void 0:a.remaining_time)||"Mesa silenciada"},t[27]||(t[27]=[r("i",{class:"fas fa-volume-mute"},null,-1)]),8,yk)):(w(),o("span",_k,t[28]||(t[28]=[r("i",{class:"fas fa-check"},null,-1)])))]),e.name&&e.name!==`Mesa ${e.number}`?(w(),o("div",kk,c(e.name),1)):l("",!0),e.is_silenced?(w(),o("div",Ck,[t[29]||(t[29]=r("i",{class:"fas fa-volume-mute"},null,-1)),r("span",null,c((null==(n=e.silence)?void 0:n.remaining_time)||("manual"===(null==(i=e.silence)?void 0:i.reason)?"Silenciada manualmente":"Mesa silenciada")),1)])):l("",!0)]),r("div",Ek,[(null==(s=e.actions_available)?void 0:s.can_activate)?(w(),o("button",{key:0,onClick:t=>(async e=>{try{const t=await sm.activateTable(e);t.success?(ir(t.message||"Mesa activada"),await ie(),ve()):sr(t.message||"Error activando mesa")}catch(t){console.error("💥 Dashboard: Error completo activando mesa:",t),sr("Error activando mesa")}})(e.id),class:"table-action-btn activate",title:"Activar llamadas"},t[30]||(t[30]=[r("i",{class:"fas fa-check"},null,-1)]),8,Ik)):l("",!0),(null==(d=e.actions_available)?void 0:d.can_silence)?(w(),o("button",{key:1,onClick:t=>le(e.id),class:"table-action-btn silence",title:"Silenciar"},t[31]||(t[31]=[r("i",{class:"fas fa-volume-mute"},null,-1)]),8,Sk)):l("",!0),(null==(u=e.actions_available)?void 0:u.can_unsilence)?(w(),o("button",{key:2,onClick:t=>(async e=>{try{const t=await sm.unsilenceTable(e);t.success?(ir(t.message||"Silencio removido"),await ie(),await re()):sr(t.message||"Error removiendo silencio")}catch(t){console.error("Error unsilencing table:",t),sr("Error removiendo silencio")}})(e.id),class:"table-action-btn unsilence",title:"Quitar silencio"},t[32]||(t[32]=[r("i",{class:"fas fa-volume-up"},null,-1)]),8,Tk)):l("",!0),(null==(h=e.actions_available)?void 0:h.can_deactivate)?(w(),o("button",{key:3,onClick:t=>(async e=>{try{if(await or("¿Desactivar mesa?","Te desasignarás de esta mesa y no recibirás más llamadas.","Desactivar","Cancelar","warning")){const t=await sm.deactivateTable(e);t.success?(ir(t.message||"Mesa desactivada"),await ie(),await oe(),await se(),ve()):sr(t.message||"Error desactivando mesa")}}catch(t){console.error("Error deactivating table:",t),sr("Error desactivando mesa")}})(e.id),class:"table-action-btn deactivate",title:"Desactivar"},t[33]||(t[33]=[r("i",{class:"fas fa-times"},null,-1)]),8,Nk)):l("",!0)])],2)}),128)),0===V.value.length?(w(),o("div",Pk,[t[34]||(t[34]=r("i",{class:"fas fa-table"},null,-1)),$.value?(w(),o("p",xk,"Selecciona un negocio para ver las mesas disponibles")):(w(),o("p",Ak,"No tienes mesas asignadas")),$.value?l("",!0):(w(),o("button",{key:2,onClick:t[4]||(t[4]=e=>A.value=!0),class:"btn btn-primary"}," Activar Mesas "))])):l("",!0)])])]),r("div",Rk,[r("div",Dk,[t[40]||(t[40]=r("div",{class:"section-header"},[r("h3",null,"Notificaciones:")],-1)),r("div",Ok,[(w(!0),o(_,null,k(K.value,e=>{var a,n,i;return w(),o("div",{key:e.id,class:C(["notification-item",{urgent:"high"===e.urgency,old:e.minutes_ago>5,"potential-spam":e.is_potential_spam}])},[r("div",Lk,[r("div",Mk," Mesa "+c(e.table_number||(null==(a=e.table)?void 0:a.number))+": ",1),r("div",Uk,c(e.message||"Solicita mozo"),1),r("div",Fk,[g(" Hace "+c(e.minutes_ago)+"m ",1),"high"===e.urgency?(w(),o("span",qk,"URGENTE")):l("",!0),e.is_potential_spam?(w(),o("span",Bk," POSIBLE SPAM ("+c(e.ip_call_count)+"x) ",1)):l("",!0)]),(null==(n=e.client_info)?void 0:n.ip_address)?(w(),o("div",jk,[g(" IP: "+c(e.client_info.ip_address)+" ",1),e.client_info.source_type?(w(),o("span",$k,c(e.client_info.source_type),1)):l("",!0)])):l("",!0)]),r("div",zk,[r("button",{onClick:t=>(async e=>{if(ae)try{f.processingCall=e,await ae.acknowledgeCall(e)}catch(t){console.error("Error reconociendo llamada:",t),sr("Error al reconocer la llamada")}finally{f.processingCall=null}else sr("Sistema de notificaciones ultra rápidas no disponible")})(e.id),class:"notification-action-btn ok",disabled:P.value===e.id,title:"OK - Confirmar llamada"},t[35]||(t[35]=[r("i",{class:"fas fa-check"},null,-1)]),8,Vk),r("button",{onClick:t=>(async e=>{if(ae)try{f.processingCall=e,await ae.completeCall(e)}catch(t){console.error("Error completando llamada:",t),sr("Error al completar la llamada")}finally{f.processingCall=null}else sr("Sistema de notificaciones ultra rápidas no disponible")})(e.id),class:"notification-action-btn complete",disabled:P.value===e.id,title:"Completar atención"},t[36]||(t[36]=[r("i",{class:"fas fa-check-double"},null,-1)]),8,Wk),r("button",{onClick:t=>(async e=>{await le(e),await se()})(e.table.id),class:"notification-action-btn silence",title:"Silenciar mesa"},t[37]||(t[37]=[r("i",{class:"fas fa-volume-mute"},null,-1)]),8,Hk),(null==(i=e.client_info)?void 0:i.ip_address)?(w(),o("button",{key:0,onClick:t=>we(e),class:"notification-action-btn block-ip",disabled:P.value===e.id,title:"Bloquear IP por spam"},t[38]||(t[38]=[r("i",{class:"fas fa-ban"},null,-1)]),8,Gk)):l("",!0)])],2)}),128)),0===K.value.length?(w(),o("div",Kk,[t[39]||(t[39]=r("i",{class:"fas fa-bell-slash"},null,-1)),$.value?(w(),o("p",Yk,"Selecciona un negocio para ver las llamadas")):(w(),o("p",Jk,"No hay llamadas pendientes"))])):l("",!0)])]),r("div",Qk,[t[43]||(t[43]=r("div",{class:"section-header"},[r("h3",null,"Historial")],-1)),r("div",Zk,[(w(!0),o(_,null,k(z.value,e=>{var a;return w(),o("div",{key:`hist-${e.id}`,class:"notification-item acknowledged"},[r("div",Xk,[r("div",eC,"Mesa "+c(e.table_number||(null==(a=e.table)?void 0:a.number))+":",1),r("div",tC,c(e.message||"Solicita mozo"),1),r("div",aC,c(e.acknowledged_at?"Atendida":""),1)]),r("div",nC,[r("button",{onClick:t=>(async e=>{if(e){f.processingCall=e;try{ae&&ae.completeCall?await ae.completeCall(e):await sm.completeCall(e),f.callHistory=f.callHistory.filter(t=>String(t.id)!==String(e)),ir("Llamada marcada como completada")}catch(t){console.error("Error completing call from history:",t),sr("Error completando la llamada")}finally{f.processingCall=null}}})(e.id),class:"notification-action-btn complete",disabled:P.value===e.id,title:"Completar desde historial"},t[41]||(t[41]=[r("i",{class:"fas fa-check-double"},null,-1)]),8,iC)])])}),128)),0===z.value.length?(w(),o("div",sC,t[42]||(t[42]=[r("i",{class:"fas fa-history"},null,-1),r("p",null,"No hay historial disponible",-1)]))):l("",!0)])]),r("div",oC,[r("div",rC,[t[44]||(t[44]=r("h3",null,[r("i",{class:"fas fa-ban"}),g(" IPs Bloqueadas ")],-1)),r("button",{onClick:ye,class:"action-btn",disabled:N.value,title:"Actualizar"},[r("i",{class:C(["fas fa-sync-alt",{"fa-spin":N.value}])},null,2)],8,lC)]),r("div",cC,[(w(!0),o(_,null,k(q.value,e=>(w(),o("div",{key:e.ip_address,class:"blocked-ip-item"},[r("div",dC,[r("div",uC,[t[45]||(t[45]=r("i",{class:"fas fa-shield-alt"},null,-1)),g(" "+c(e.ip_address),1)]),r("div",hC,[r("div",pC,[t[46]||(t[46]=r("strong",null,"Razón:",-1)),g(" "+c(e.reason),1)]),r("div",mC,[t[47]||(t[47]=r("strong",null,"Por:",-1)),g(" "+c(e.blocked_by),1)]),r("div",fC,[t[48]||(t[48]=r("strong",null,"Fecha:",-1)),g(" "+c(Ie(e.blocked_at)),1)]),e.expires_at?(w(),o("div",vC,[t[49]||(t[49]=r("strong",null,"Expira:",-1)),g(" "+c(Ie(e.expires_at)),1)])):(w(),o("div",gC,t[50]||(t[50]=[r("strong",null,"Duración:",-1),g(" Permanente ")]))),e.notes?(w(),o("div",bC,[t[51]||(t[51]=r("strong",null,"Notas:",-1)),g(" "+c(e.notes),1)])):l("",!0)])]),r("div",wC,[r("button",{onClick:t=>_e(e.ip_address),class:"blocked-action-btn unblock",title:"Desbloquear IP"},t[52]||(t[52]=[r("i",{class:"fas fa-unlock"},null,-1),g(" Desbloquear ")]),8,yC)])]))),128)),0===q.value.length?(w(),o("div",_C,[t[53]||(t[53]=r("i",{class:"fas fa-shield-check"},null,-1)),$.value?(w(),o("p",CC,"Selecciona un negocio para ver IPs bloqueadas")):(w(),o("p",kC,"No hay IPs bloqueadas"))])):l("",!0)])]),r("div",{class:"section-card"},[r("button",{onClick:de,class:"end-shift-btn"},t[54]||(t[54]=[r("i",{class:"fas fa-sign-out-alt"},null,-1),g(" Salir y desactivar notificaciones ")]))])])]),A.value&&!$.value?(w(),T(zw,{key:0,"available-tables":v.value,"assigned-tables":V.value,onClose:t[5]||(t[5]=e=>A.value=!1),onTablesSelected:pe},null,8,["available-tables","assigned-tables"])):l("",!0),x.value&&j.value?(w(),o("div",{key:1,class:"modal-overlay",onClick:t[7]||(t[7]=d(e=>x.value=!1,["self"]))},[r("div",EC,[r("div",IC,[r("h3",null,[t[55]||(t[55]=r("i",{class:"fas fa-building"},null,-1)),g(" "+c(j.value.name)+" - Gestión de Mesas ",1)]),r("button",{onClick:t[6]||(t[6]=e=>x.value=!1),class:"close-btn"},t[56]||(t[56]=[r("i",{class:"fas fa-times"},null,-1)]))]),r("div",SC,[p(s_,{"business-id":j.value.id,"business-name":j.value.name,onTablesUpdated:me},null,8,["business-id","business-name"])])])])):l("",!0),R.value&&j.value?(w(),o("div",{key:2,class:"modal-overlay",onClick:t[9]||(t[9]=d(e=>R.value=!1,["self"]))},[r("div",TC,[r("div",NC,[t[58]||(t[58]=r("h3",null,[r("i",{class:"fas fa-bookmark"}),g(" Perfiles de Mesa ")],-1)),r("button",{onClick:t[8]||(t[8]=e=>R.value=!1),class:"close-btn"},t[57]||(t[57]=[r("i",{class:"fas fa-times"},null,-1)]))]),r("div",PC,[p(Y_,{"business-id":j.value.id,"available-tables":v.value,"assigned-tables":V.value,onProfilesUpdated:fe},null,8,["business-id","available-tables","assigned-tables"])])])])):l("",!0),D.value&&j.value?(w(),o("div",{key:3,class:"modal-overlay",onClick:t[11]||(t[11]=d(e=>D.value=!1,["self"]))},[r("div",AC,[r("div",xC,[t[60]||(t[60]=r("h3",null,[r("i",{class:"fas fa-shield-alt"}),g(" Sistema Anti-Spam - IPs Bloqueadas ")],-1)),r("button",{onClick:t[10]||(t[10]=e=>D.value=!1),class:"close-btn"},t[59]||(t[59]=[r("i",{class:"fas fa-times"},null,-1)]))]),r("div",RC,[r("div",DC,[G.value.length>0?(w(),o("div",OC,[t[62]||(t[62]=r("h4",null,[r("i",{class:"fas fa-exclamation-triangle"}),g(" IPs Sospechosas Activas")],-1)),(w(!0),o(_,null,k(G.value,e=>(w(),o("div",{key:e.ip,class:"suspicious-ip-card"},[r("div",LC,[r("strong",null,c(e.ip),1),r("span",MC,c(e.count)+" llamadas en 10 min",1)]),r("div",UC,[(w(!0),o(_,null,k(e.calls,e=>(w(),o("div",{key:e.id,class:"mini-call"}," Mesa "+c(e.table_number)+" - "+c(e.message),1))),128))]),r("button",{onClick:t=>we(e.calls[0]),class:"btn-block-ip"},t[61]||(t[61]=[r("i",{class:"fas fa-ban"},null,-1),g(" Bloquear IP ")]),8,FC)]))),128))])):l("",!0),r("div",qC,[r("div",{class:"section-header"},[t[64]||(t[64]=r("h4",null,[r("i",{class:"fas fa-ban"}),g(" IPs Bloqueadas")],-1)),r("button",{onClick:ye,class:"btn btn-secondary btn-sm"},t[63]||(t[63]=[r("i",{class:"fas fa-sync"},null,-1),g(" Actualizar ")]))]),0===q.value.length?(w(),o("div",BC,t[65]||(t[65]=[r("i",{class:"fas fa-shield-check"},null,-1),r("p",null,"No hay IPs bloqueadas actualmente",-1)]))):(w(),o("div",jC,[(w(!0),o(_,null,k(q.value,e=>(w(),o("div",{key:e.ip_address,class:"blocked-ip-card"},[r("div",$C,[r("div",zC,c(e.ip_address),1),r("div",VC,c(e.reason),1)]),r("div",WC,[r("div",HC,[t[66]||(t[66]=r("strong",null,"Bloqueada por:",-1)),g(" "+c(e.blocked_by),1)]),r("div",GC,[t[67]||(t[67]=r("strong",null,"Fecha:",-1)),g(" "+c(new Date(e.blocked_at).toLocaleString()),1)]),e.expires_at?(w(),o("div",KC,[t[68]||(t[68]=r("strong",null,"Expira:",-1)),g(" "+c(new Date(e.expires_at).toLocaleString()),1)])):(w(),o("div",JC,t[69]||(t[69]=[r("strong",null,"Duración:",-1),g(" Permanente ")]))),e.notes?(w(),o("div",YC,[t[70]||(t[70]=r("strong",null,"Notas:",-1)),g(" "+c(e.notes),1)])):l("",!0)]),r("div",QC,[r("button",{onClick:t=>_e(e.ip_address),class:"btn btn-warning btn-sm"},t[71]||(t[71]=[r("i",{class:"fas fa-unlock"},null,-1),g(" Desbloquear ")]),8,ZC)])]))),128))]))])])])])])):l("",!0)]),O.value?(w(),o("div",{key:0,class:"modal-overlay",onClick:t[14]||(t[14]=d(e=>O.value=!1,["self"]))},[r("div",XC,[r("div",eE,[t[73]||(t[73]=r("h3",null,[r("i",{class:"fas fa-bug"}),g(" Debug de IP (Anti-Spam) ")],-1)),r("button",{onClick:t[12]||(t[12]=e=>O.value=!1),class:"close-btn"},t[72]||(t[72]=[r("i",{class:"fas fa-times"},null,-1)]))]),r("div",tE,[r("div",aE,[t[77]||(t[77]=r("label",null,"IP a diagnosticar",-1)),u(r("input",{"onUpdate:modelValue":t[13]||(t[13]=e=>L.value=e),type:"text",placeholder:"Ej: 190.123.45.67",class:"ip-input"},null,512),[[h,L.value]]),r("div",nE,[r("button",{class:"btn btn-primary",onClick:Ce,disabled:!L.value||M.value},[M.value?(w(),o("i",oE)):(w(),o("i",sE)),t[74]||(t[74]=g(" Diagnosticar "))],8,iE),(null==(s=null==(n=U.value)?void 0:n.active_locks)?void 0:s.length)?(w(),o("button",{key:0,class:"btn btn-warning",onClick:Ee,disabled:M.value},[t[75]||(t[75]=r("i",{class:"fas fa-unlock"},null,-1)),g(" Force Unblock ("+c(U.value.active_locks.length)+") ",1)],8,rE)):l("",!0)]),F.value?(w(),o("div",lE,[t[76]||(t[76]=r("i",{class:"fas fa-exclamation-triangle"},null,-1)),g(" "+c(F.value),1)])):l("",!0)]),U.value?(w(),o("div",cE,[t[84]||(t[84]=r("h4",null,"Resultado:",-1)),r("div",dE,[t[78]||(t[78]=r("strong",null,"IP:",-1)),g(" "+c(U.value.ip_address)+" ",1),t[79]||(t[79]=r("strong",{style:{"margin-left":"16px"}},"Locks activos:",-1)),g(" "+c((null==(b=U.value.active_locks)?void 0:b.length)||0)+" ",1),t[80]||(t[80]=r("strong",{style:{"margin-left":"16px"}},"Total registros:",-1)),g(" "+c((null==(E=U.value.all_locks)?void 0:E.length)||0),1)]),(null==(I=U.value.active_locks)?void 0:I.length)?(w(),o("div",uE,[t[81]||(t[81]=r("h5",null,"Locks Activos",-1)),r("ul",null,[(w(!0),o(_,null,k(U.value.active_locks,e=>(w(),o("li",{key:e.id}," ID "+c(e.id)+" - expira: "+c(e.expires_at||e.unblock_at||"N/D")+" - razón: "+c(e.reason),1))),128))])])):l("",!0),(null==(S=U.value.inactive_locks)?void 0:S.length)?(w(),o("div",hE,[t[82]||(t[82]=r("h5",null,"Locks Inactivos",-1)),r("ul",null,[(w(!0),o(_,null,k(U.value.inactive_locks,e=>(w(),o("li",{key:"i-"+e.id}," ID "+c(e.id)+" - desbloqueado: "+c(e.unblocked_at||"N/D")+" - razón: "+c(e.reason),1))),128))])])):l("",!0),r("details",pE,[t[83]||(t[83]=r("summary",null,"Ver JSON crudo",-1)),r("pre",null,c(U.value),1)])])):M.value?l("",!0):(w(),o("div",mE," Ingrese una IP y presione Diagnosticar para ver su estado en el sistema anti-spam. "))])])])):l("",!0)])}}},vE=Lh(fE,[["__scopeId","data-v-13dfd164"]]),gE=t("admin",()=>{const e=a(localStorage.getItem("businessId")||null),t=a(null),i=a(null),s=a(0),o=a(0),r=a(0),l=a(null),c=a(null),d=a([]),u=a([]),h=a([]),p=a([]),m=a([]),f=a([]),v=a([]),g=a(null),b=a(!1),w=a(null),y=a({next:null,prev:null}),_=a({current_page:1,last_page:1}),k=a(!1),C=n(()=>h.value.length>0),E=n(()=>p.value.length>0),I=n(()=>m.value.filter(e=>"pending"===e.status)),S=async(a=!1)=>{if(!a&&t.value&&t.value.id)return t.value;b.value=!0,w.value=null;try{const a=(await va.getBusinessInfo()).data.business||{};if(k.value=!0===a.requires_business_setup,k.value)return{requires_business_setup:!0};const n=a.business||a;return t.value=n,i.value=a.active_business_id??(null==n?void 0:n.id)??null,s.value=a.tables_count??0,o.value=a.menus_count??0,r.value=a.qr_codes_count??0,l.value=a.invitation_code??null,c.value=a.invitation_url??null,d.value=Array.isArray(a.available_businesses)?a.available_businesses:[],i.value?(e.value=i.value,localStorage.setItem("businessId",String(i.value))):n&&n.id&&(e.value=n.id,localStorage.setItem("businessId",String(n.id))),{business:t.value,active_business_id:i.value,tables_count:s.value,menus_count:o.value,qr_codes_count:r.value,invitation_code:l.value,invitation_url:c.value,available_businesses:d.value}}catch(n){throw w.value=n.message||"Error al cargar datos del negocio",n}finally{b.value=!1}},T=async()=>{var e;b.value=!0,w.value=null;try{const t=await va.getMenus(),a=(null==(e=t.data)?void 0:e.menus)??t.data,n=Array.isArray(a)?a:[];return h.value=n.map(e=>({id:e.id,name:e.name,url:e.view_url||e.file_path,thumbnailUrl:e.preview_url||e.thumbnail_url||"/src/assets/pdf-thumb.png",isDefault:e.is_default})),h.value}catch(t){throw w.value=t.message||"Error al cargar menús",t}finally{b.value=!1}},N=async()=>{var e;b.value=!0,w.value=null;try{const t=await va.getTables();return p.value=(null==(e=t.data)?void 0:e.tables)||t.data||[],p.value}catch(t){throw w.value=t.message||"Error al obtener mesas",t}finally{b.value=!1}},P=async()=>{var e;b.value=!0,w.value=null;try{const t=await va.getStaffRequests(),a=(null==(e=t.data)?void 0:e.requests)??t.data,n=Array.isArray(a)?a:[];return m.value=n,m.value}catch(t){throw w.value=t.message||"Error al cargar solicitudes de personal",t}finally{b.value=!1}},A=async()=>{var e,t;b.value=!0,w.value=null;try{const a=await va.getArchivedStaffRequests(),n=(null==(e=a.data)?void 0:e.archived_requests)??(null==(t=a.data)?void 0:t.requests)??a.data,i=Array.isArray(n)?n:[];return f.value=i,f.value}catch(a){throw w.value=a.message||"Error al cargar solicitudes archivadas",a}finally{b.value=!1}},x=async(e=1)=>{var t,a,n,i,s,o,r,l,c,d;b.value=!0,w.value=null;try{const u="string"==typeof e?await fa.get(e.replace(fa.defaults.baseURL+"/","")):await va.getStaff(e),h=(null==(t=u.data)?void 0:t.staff)??(null==(a=u.data)?void 0:a.data)??u.data;return v.value=Array.isArray(h)?h:[],y.value={next:(null==(i=null==(n=u.data)?void 0:n.links)?void 0:i.next)??null,prev:(null==(o=null==(s=u.data)?void 0:s.links)?void 0:o.prev)??null},_.value={current_page:(null==(l=null==(r=u.data)?void 0:r.meta)?void 0:l.current_page)??1,last_page:(null==(d=null==(c=u.data)?void 0:c.meta)?void 0:d.last_page)??1},v.value}catch(u){throw w.value=u.message||"Error al cargar el personal",u}finally{b.value=!1}};return{businessId:e,businessData:t,activeBusinessId:i,tablesCount:s,menusCount:o,qrCodesCount:r,invitationCode:l,invitationUrl:c,availableBusinesses:d,allBusinesses:u,menus:h,tables:p,staffRequests:m,archivedRequests:f,staff:v,statistics:g,isLoading:b,error:w,staffLinks:y,staffMeta:_,requiresBusinessSetup:k,hasMenus:C,hasTables:E,pendingRequests:I,fetchBusinessData:S,fetchAllBusinesses:async()=>{var e;if(d.value&&d.value.length>0)return d.value;b.value=!0,w.value=null;try{const t=await va.getAdminBusinesses(),a=(null==(e=t.data)?void 0:e.businesses)??t.data;return u.value=Array.isArray(a)?a:[],d.value=u.value,u.value}catch(t){throw w.value=t.message||"Error al listar negocios",t}finally{b.value=!1}},fetchMenus:T,setDefaultMenu:async e=>{b.value=!0,w.value=null;try{return await va.setDefaultMenu({menu_id:e}),await T(),!0}catch(t){throw w.value=t.message||"Error al establecer menú predeterminado",t}finally{b.value=!1}},uploadMenu:async e=>{b.value=!0,w.value=null;try{const t=await va.uploadMenu(e);return await T(),t.data}catch(t){throw w.value=t.message||"Error al subir menú",t}finally{b.value=!1}},fetchTables:N,createTable:async e=>{var t;b.value=!0,w.value=null;try{const a=await va.createTable(e),n=(null==(t=a.data)?void 0:t.table)||a.data;return n&&p.value.push(n),n}catch(a){throw w.value=a.message||"Error al crear mesa",a}finally{b.value=!1}},updateTable:async(e,t)=>{var a;b.value=!0,w.value=null;try{const n=await va.updateTable(e,t),i=(null==(a=n.data)?void 0:a.table)||n.data,s=p.value.findIndex(t=>t.id===e);return-1!==s&&i&&(p.value[s]=i),i}catch(n){throw w.value=n.message||"Error al actualizar mesa",n}finally{b.value=!1}},deleteTable:async e=>{b.value=!0,w.value=null;try{return await va.deleteTable(e),p.value=p.value.filter(t=>t.id!==e),!0}catch(t){throw w.value=t.message||"Error al eliminar mesa",t}finally{b.value=!1}},fetchStaffRequests:P,fetchArchivedRequests:A,handleStaffRequest:async(e,t)=>{b.value=!0,w.value=null;try{return await va.handleStaffRequest(e,{action:t}),await P(),await A(),"confirm"===t&&await x(),!0}catch(a){throw w.value=a.message||"Error al procesar solicitud",a}finally{b.value=!1}},fetchStaff:x,inviteStaff:async e=>{b.value=!0,w.value=null;try{const t=await va.inviteStaff(e);return await P(),t.data}catch(t){throw w.value=t.message||"Error al enviar invitación",t}finally{b.value=!1}},approveStaffRequest:async(e,t={})=>{b.value=!0,w.value=null;try{const a=await va.approveStaff(e,t);return await P(),await x(),a.data}catch(a){throw w.value=a.message||"Error al aprobar solicitud",a}finally{b.value=!1}},rejectStaffRequest:async(e,t={})=>{b.value=!0,w.value=null;try{const a=await va.rejectStaff(e,t);return await P(),await A(),a.data}catch(a){throw w.value=a.message||"Error al rechazar solicitud",a}finally{b.value=!1}},inviteStaffMember:async e=>{b.value=!0,w.value=null;try{const t=await va.inviteStaffMember(e);return await P(),t.data}catch(t){throw w.value=t.message||"Error al enviar invitación",t}finally{b.value=!1}},fetchDashboardStats:async()=>{var e;b.value=!0,w.value=null;try{const t=await va.getAdminStatistics();return(null==(e=t.data)?void 0:e.statistics)??t.data}catch(t){throw w.value=t.message||"Error al cargar estadísticas",t}finally{b.value=!1}},fetchStaffMember:async e=>{var t;b.value=!0,w.value=null;try{const a=await va.getStaffMember(e);return(null==(t=a.data)?void 0:t.staff)??a.data}catch(a){throw w.value=a.message||"Error al cargar datos del miembro del personal",a}finally{b.value=!1}},updateStaffMember:async(e,t)=>{b.value=!0,w.value=null;try{const a=await va.updateStaffMember(e,t),n=v.value.findIndex(t=>t.id===e);return-1!==n&&(v.value[n]={...v.value[n],...a.data}),a.data}catch(a){throw w.value=a.message||"Error al actualizar miembro del personal",a}finally{b.value=!1}},removeStaff:async e=>{b.value=!0,w.value=null;try{return await va.removeStaff(e),v.value=v.value.filter(t=>t.id!==e),!0}catch(t){throw w.value=t.message||"Error al eliminar miembro del personal",t}finally{b.value=!1}},addReview:async(e,t)=>{b.value=!0,w.value=null;try{return(await va.addReview(e,t)).data}catch(a){throw w.value=a.message||"Error al añadir reseña",a}finally{b.value=!1}},deleteReview:async(e,t)=>{b.value=!0,w.value=null;try{return await va.deleteReview(e,t),!0}catch(a){throw w.value=a.message||"Error al eliminar reseña",a}finally{b.value=!1}},renameMenu:async(e,t)=>{b.value=!0,w.value=null;try{return await va.renameMenu(e,{name:t}),await T(),!0}catch(a){return w.value=a.message||"Error al renombrar menú",!1}finally{b.value=!1}},deleteMenu:async e=>{b.value=!0,w.value=null;try{return await va.deleteMenu(e),await T(),!0}catch(t){throw w.value=t.message||"Error al eliminar menú",t}finally{b.value=!1}},reorderMenus:async e=>{try{const t=e.map((e,t)=>({menu_id:e,display_order:t+1}));await va.reorderMenus(t),h.value.sort((t,a)=>e.indexOf(t.id)-e.indexOf(a.id))}catch(t){console.error("Error reordenando menús",t)}},previewMenu:async e=>{try{const t=await va.previewMenu(e);return URL.createObjectURL(t.data)}catch(t){return console.error("Error obteniendo preview",t),null}},cloneTable:async(e,t)=>{b.value=!0;try{const a=await va.cloneTable(e,t);p.value.push(a.data)}catch(a){console.error("Error clonando mesa",a)}finally{b.value=!1}},generateQrCode:async e=>{b.value=!0,w.value=null;try{await va.generateQRCode(e),await N()}catch(t){throw w.value=t.message||"Error al generar código QR",t}finally{b.value=!1}},regenerateQrCode:async e=>{b.value=!0,w.value=null;try{await va.regenerateQRCode(e),await N()}catch(t){throw w.value=t.message||"Error al regenerar código QR",t}finally{b.value=!1}},getSettings:async()=>{var e;const t=await va.getSettings();return(null==(e=t.data)?void 0:e.settings)||t.data},updateBusinessData:async e=>{var t;const a=await va.updateSettings({settings:e});return(null==(t=a.data)?void 0:t.settings)||a.data},regenerateInvitation:async()=>{const e=(await va.regenerateInvitationCode()).data||{};return l.value=e.invitation_code??l.value,c.value=e.invitation_url??c.value,e},selectActiveBusiness:async t=>{b.value=!0,w.value=null;try{const a=(await va.selectRole("admin",t)).data||{};return i.value=t,e.value=t,localStorage.setItem("businessId",String(t)),await Promise.all([S(),N(),T()]),a}catch(a){throw w.value=a.message||"Error al seleccionar negocio",a}finally{b.value=!1}},createBusiness:async t=>{var a,n,s,o,r,d;b.value=!0,w.value=null;try{const o=await va.createBusiness(t),r=o.data||{};return 201===o.status||r.business,t.value=r.business,e.value=null==(a=r.business)?void 0:a.id,i.value=null==(n=r.business)?void 0:n.id,l.value=null==(s=r.business)?void 0:s.invitation_code,c.value=r.invitation_url,k.value=!1,e.value&&localStorage.setItem("businessId",String(e.value)),r}catch(u){if(u.response&&422===u.response.status){const e=null==(o=u.response.data)?void 0:o.errors,t=e&&(null==(r=Object.values(e)[0])?void 0:r[0]);w.value=t||(null==(d=u.response.data)?void 0:d.message)||"Los datos proporcionados no son válidos"}else w.value=u.message||"Error al crear negocio";throw u}finally{b.value=!1}},joinBusinessWithCode:async a=>{var n,s;b.value=!0,w.value=null;try{const o=(await va.joinBusiness(a)).data||{};return t.value=o.business,e.value=null==(n=o.business)?void 0:n.id,i.value=null==(s=o.business)?void 0:s.id,k.value=!1,e.value&&localStorage.setItem("businessId",String(e.value)),await S(),o}catch(o){throw w.value=o.message||"Error al unirse al negocio",o}finally{b.value=!1}}}}),bE=Object.freeze(Object.defineProperty({__proto__:null,useAdminStore:gE},Symbol.toStringTag,{value:"Module"})),wE={key:0,class:"field-label"},yE={key:1,class:"edit-container"},_E=["type","placeholder"],kE=["placeholder","min","max"],CE=["value"],EE={key:1,class:"error-message"},IE={__name:"EditableField",props:{value:{type:[String,Number],default:""},label:{type:String,default:""},type:{type:String,default:"text"},placeholder:{type:String,default:""},options:{type:Array,default:()=>[]},editable:{type:Boolean,default:!0},min:{type:[Number,String],default:null},max:{type:[Number,String],default:null},unit:{type:String,default:""},displayValue:{type:String,default:""},hasError:{type:Boolean,default:!1},errorMessage:{type:String,default:""}},emits:["update:value"],setup(e,{emit:t}){const i=e,s=t,p=a(i.value),m=a(!1),f=a(null);S(()=>i.value,e=>{m.value||(p.value=e)});const v=n(()=>{if(i.displayValue)return i.displayValue;if("select"===i.type&&i.options.length){const e=i.options.find(e=>e.value===p.value);return e?e.label:p.value}return p.value+(i.unit?" "+i.unit:"")}),b=()=>{i.editable&&(m.value=!0,setTimeout(()=>{f.value&&f.value.focus()},100))},y=()=>{m.value=!1,s("update:value",p.value)},E=e=>{"Enter"===e.key?y():"Escape"===e.key&&(m.value=!1,p.value=i.value)},I=()=>{m.value=!1,p.value=i.value};return(t,a)=>(w(),o("div",{class:C(["editable-field",{"has-error":e.hasError}])},[e.label?(w(),o("div",wE,c(e.label),1)):l("",!0),r("div",{class:C(["field-content",{"is-editing":m.value,error:e.hasError}])},[m.value?(w(),o("div",yE,["text"===e.type||"email"===e.type||"tel"===e.type?u((w(),o("input",{key:0,ref_key:"inputRef",ref:f,type:e.type,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e),placeholder:e.placeholder,class:C(["edit-input",{"input-error":e.hasError}]),onKeydown:E,onChange:y,onBlur:I},null,42,_E)),[[N,p.value]]):"number"===e.type?u((w(),o("input",{key:1,ref_key:"inputRef",ref:f,type:"number","onUpdate:modelValue":a[1]||(a[1]=e=>p.value=e),placeholder:e.placeholder,min:e.min,max:e.max,class:C(["edit-input",{"input-error":e.hasError}]),onKeydown:E,onChange:y,onBlur:I},null,42,kE)),[[h,p.value]]):"date"===e.type?u((w(),o("input",{key:2,ref_key:"inputRef",ref:f,type:"date","onUpdate:modelValue":a[2]||(a[2]=e=>p.value=e),class:C(["edit-input",{"input-error":e.hasError}]),onKeydown:E,onChange:y,onBlur:I},null,34)),[[h,p.value]]):"textarea"===e.type?u((w(),o("textarea",{key:3,ref_key:"inputRef",ref:f,"onUpdate:modelValue":a[3]||(a[3]=e=>p.value=e),rows:"3",class:C(["edit-input",{"input-error":e.hasError}]),onKeydown:E,onChange:y,onBlur:I},null,34)),[[h,p.value]]):"select"===e.type?u((w(),o("select",{key:4,ref_key:"inputRef",ref:f,"onUpdate:modelValue":a[4]||(a[4]=e=>p.value=e),class:C(["edit-select",{"input-error":e.hasError}]),onChange:y,onBlur:I},[(w(!0),o(_,null,k(e.options,e=>(w(),o("option",{key:e.value,value:e.value},c(e.label),9,CE))),128))],34)),[[P,p.value]]):l("",!0),r("div",{class:"edit-actions"},[r("button",{type:"button",class:"action-button save-button",onClick:y},a[6]||(a[6]=[r("i",{class:"bi bi-check"},null,-1)])),r("button",{type:"button",class:"action-button cancel-button",onClick:I},a[7]||(a[7]=[r("i",{class:"bi bi-x"},null,-1)]))])])):(w(),o("div",{key:0,class:"display-value",onClick:b},[g(c(v.value)+" ",1),e.editable?(w(),o("button",{key:0,class:"edit-button",onClick:d(b,["stop"])},a[5]||(a[5]=[r("i",{class:"bi bi-pencil"},null,-1)]))):l("",!0)]))],2),e.hasError&&e.errorMessage?(w(),o("div",EE,c(e.errorMessage),1)):l("",!0)],2))}},SE=Lh(IE,[["__scopeId","data-v-8303ada0"]]),TE=["src","alt"],NE={key:0,class:"avatar-overlay"},PE={key:1,class:"avatar-loading"},AE={__name:"ProfileAvatar",props:{src:{type:String,default:""},alt:{type:String,default:"Foto de perfil"},editable:{type:Boolean,default:!1}},emits:["update:src","file-selected"],setup(e,{emit:t}){const n=e,i=t,s=a(n.src),c=a(!1),d=a(null);S(()=>n.src,e=>{s.value=e});const u=()=>{n.editable&&d.value&&d.value.click()},h=e=>{const t=e.target.files[0];if(!t)return;c.value=!0;const a=new FileReader;a.onload=e=>{s.value=e.target.result,i("update:src",s.value),i("file-selected",t),c.value=!1},a.readAsDataURL(t)};return(t,a)=>(w(),o("div",{class:C(["profile-avatar",{editable:e.editable}]),onClick:u},[r("img",{src:s.value,alt:e.alt,class:"avatar-image"},null,8,TE),e.editable?(w(),o("div",NE,a[0]||(a[0]=[r("i",{class:"bi bi-camera"},null,-1)]))):l("",!0),c.value?(w(),o("div",PE,a[1]||(a[1]=[r("div",{class:"spinner"},null,-1)]))):l("",!0),e.editable?(w(),o("input",{key:2,ref_key:"fileInput",ref:d,type:"file",accept:"image/*",class:"file-input",onChange:h},null,544)):l("",!0)],2))}},xE=Lh(AE,[["__scopeId","data-v-b3232b9c"]]),RE=["type","disabled"],DE={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},OE={__name:"BaseButton",props:{variant:{type:String,default:"primary",validator:e=>["primary","secondary","outline-primary","outline-secondary","success","danger","warning","info","light","dark","link"].includes(e)},size:{type:String,default:"",validator:e=>["","sm","lg"].includes(e)},block:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},type:{type:String,default:"button"}},emits:["click"],setup(e,{emit:t}){const a=e,i=t,s=n(()=>{const e=["btn"];return e.push(`btn-${a.variant}`),a.size&&e.push(`btn-${a.size}`),a.block&&e.push("w-100"),a.loading&&e.push("position-relative"),e.join(" ")}),c=e=>{a.disabled||a.loading||i("click",e)};return(t,a)=>(w(),o("button",{type:e.type,class:C(s.value),disabled:e.disabled||e.loading,onClick:c},[e.loading?(w(),o("div",DE)):l("",!0),r("span",{class:C({"opacity-0":e.loading})},[A(t.$slots,"default",{},void 0)],2)],10,RE))}},LE=Lh(OE,[["__scopeId","data-v-9b101dda"]]),ME={class:"modal-content rounded-4"},UE={class:"modal-header"},FE={class:"modal-title"},qE={class:"modal-body"},BE={key:0,class:"modal-footer"},jE={__name:"BaseModal",props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:""},size:{type:String,default:"",validator:e=>["","sm","lg","xl"].includes(e)},centered:{type:Boolean,default:!0},scrollable:{type:Boolean,default:!1},staticBackdrop:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const i=e,d=t,u=a(null);let h=null;s(()=>{u.value&&(h=new V(u.value,{backdrop:!i.staticBackdrop||"static",keyboard:!i.staticBackdrop}),u.value.addEventListener("hidden.bs.modal",()=>{d("update:modelValue",!1)}),i.modelValue&&h.show())}),x(()=>{h&&h.dispose()}),S(()=>i.modelValue,e=>{!h&&u.value&&(h=new V(u.value,{backdrop:!i.staticBackdrop||"static",keyboard:!i.staticBackdrop})),e&&h?h.show():!e&&h&&h.hide()});const p=n(()=>{const e=["modal-dialog"];return i.centered&&e.push("modal-dialog-centered"),i.scrollable&&e.push("modal-dialog-scrollable"),i.size&&e.push(`modal-${i.size}`),e.join(" ")});return(t,a)=>(w(),o("div",{ref_key:"modalElement",ref:u,class:"modal fade",tabindex:"-1","aria-hidden":"true"},[r("div",{class:C(p.value)},[r("div",ME,[r("div",UE,[r("h5",FE,c(e.title),1),r("button",{type:"button",class:"btn-close",onClick:a[0]||(a[0]=e=>d("update:modelValue",!1)),"aria-label":"Close"})]),r("div",qE,[A(t.$slots,"default",{},void 0)]),t.$slots.footer?(w(),o("div",BE,[A(t.$slots,"footer",{},void 0)])):l("",!0)])],2)],512))}},$E=Lh(jE,[["__scopeId","data-v-aefedeba"]]),zE={class:"profile-container"},VE={key:0,class:"loading-container"},WE={key:1,class:"alert alert-danger"},HE={key:2,class:"alert alert-success"},GE={key:3,class:"profile-content"},KE={key:0,class:"d-none profile-card completeness-card"},JE={class:"card-header"},YE={class:"completeness-percentage"},QE={class:"completeness-content"},ZE={class:"progress-bar"},XE={class:"completeness-text"},eI={key:0,class:"missing-fields"},tI={class:"profile-card"},aI={class:"profile-main"},nI={class:"profile-image-section"},iI={class:"profile-data"},sI={class:"data-row"},oI={class:"data-row"},rI={key:0,class:"age-display"},lI={class:"data-row"},cI={class:"data-row"},dI={class:"data-row"},uI={class:"data-row"},hI={class:"profile-card"},pI={class:"profile-data"},mI={class:"data-row"},fI={class:"data-row"},vI={class:"data-row"},gI={class:"profile-card"},bI={class:"profile-data"},wI={class:"data-row"},yI={class:"data-row"},_I={class:"data-row"},kI={class:"availability-toggle"},CI={class:"toggle-container"},EI={for:"availability-toggle",class:"toggle-label"},II={class:"profile-card"},SI={class:"skills-section"},TI={class:"skills-list"},NI=["onClick"],PI={class:"add-skill"},AI={class:"profile-card"},xI={class:"card-header"},RI={class:"work-history"},DI={class:"work-item-header"},OI={class:"work-actions"},LI=["onClick"],MI=["onClick"],UI={class:"work-details"},FI={class:"work-dates"},qI={key:0,class:"work-description"},BI={key:0,class:"empty-state"},jI={class:"profile-card"},$I={class:"businesses-list"},zI={class:"business-main-info"},VI={class:"business-name"},WI={key:0,class:"business-code"},HI={key:0,class:"business-stats"},GI={class:"stat-item"},KI={class:"stat-value"},JI={class:"stat-item"},YI={class:"stat-value"},QI={key:0,class:"stat-item"},ZI={class:"stat-value"},XI={key:1,class:"stat-item"},eS={class:"stat-value"},tS={class:"business-actions"},aS=["onClick","disabled"],nS={key:0,class:"empty-state"},iS={class:"profile-card"},sS={class:"form-group"},oS=["disabled"],rS={class:"form-group"},lS=["disabled"],cS={key:0,class:"form-text error"},dS={class:"form-group"},uS=["disabled"],hS={key:0,class:"form-text error"},pS={key:0},mS={key:1},fS={class:"profile-card danger-zone"},vS={class:"danger-content"},gS={class:"form-group"},bS={class:"form-group"},wS={class:"form-group"},yS={class:"form-row"},_S={class:"form-group"},kS={class:"form-group"},CS={key:0},ES={key:1},IS={class:"delete-account-content"},SS={class:"form-group"},TS=["disabled"],NS={key:0},PS=Lh({__name:"Profile",setup(e){const t=b(),i=en(),v=gE(),E=a({display_name:"",bio:"",phone:"",birth_date:"",height:null,weight:null,gender:"",experience_years:null,employment_type:"",current_schedule:"",current_location:"",latitude:null,longitude:null,availability_hours:[],skills:[],is_available:!0,avatar:"",business_id:null}),I=a([]),T=a([]),N=a({current:"",new:"",confirm:""}),P=a(!0),A=a(!1),x=a(""),M=a("");a(null),a(null);const U=a({}),F=a(!1),q=a(""),B=a(!1),j=a(!1),$=a(null),z=a({business_name:"",position:"",description:"",start_date:"",end_date:""}),V=a({is_complete:!1,missing_fields:[],completed_fields:0,total_required_fields:0,completion_percentage:0}),W=n(()=>!N.value.new||N.value.new.length>=8),H=n(()=>!N.value.new||!N.value.confirm||N.value.new===N.value.confirm),G=n(()=>{if(!E.value.birth_date)return null;const e=new Date(E.value.birth_date),t=new Date;let a=t.getFullYear()-e.getFullYear();const n=t.getMonth()-e.getMonth();return(n<0||0===n&&t.getDate()<e.getDate())&&a--,a}),K=[{value:"masculino",label:"Masculino"},{value:"femenino",label:"Femenino"},{value:"otro",label:"Otro"}],J=[{value:"full-time",label:"Tiempo completo"},{value:"part-time",label:"Medio tiempo"},{value:"hourly",label:"Por horas"},{value:"weekends-only",label:"Solo fines de semana"}],Y=async()=>{P.value=!0,x.value="";try{const e=(null==v?void 0:v.activeBusinessId)??localStorage.getItem("businessId")??null,t=(await va.getActiveUserProfile(e?Number(e):null)).data.data.profile_data;E.value=t?{display_name:t.display_name||"",bio:t.bio||"",phone:t.phone||"",birth_date:t.birth_date||"",height:t.height||null,weight:t.weight||null,gender:t.gender||"",experience_years:t.experience_years||null,employment_type:t.employment_type||"",current_schedule:t.current_schedule||"",current_location:t.current_location||"",latitude:t.latitude||null,longitude:t.longitude||null,availability_hours:t.availability_hours||[],skills:t.skills||[],is_available:void 0===t.is_available||t.is_available,avatar:t.avatar||"",business_id:t.business_id}:{display_name:"Mozo",bio:"",phone:"",birth_date:"",height:null,weight:null,gender:"",experience_years:null,employment_type:"",current_schedule:"",current_location:"",latitude:null,longitude:null,availability_hours:[],skills:[],is_available:!0,avatar:"",business_id:null},await Q(),await Z()}catch(e){console.error("Error al cargar datos del usuario:",e),x.value="No se pudieron cargar tus datos. Por favor, inténtalo de nuevo."}finally{P.value=!1}},Q=async()=>{var e;try{const e=await va.listWorkHistory();I.value=e.data.data.items||[]}catch(t){console.error("❌ Error al cargar historial laboral:",t),console.error("❌ Respuesta del error:",null==(e=t.response)?void 0:e.data),I.value=[]}},Z=async()=>{var e;try{console.log("🏪 Cargando negocios asociados activos hoy...");const e=await va.getWaiterBusinessesActiveToday();console.log("🏪 Respuesta de businesses/active-today:",e.data),T.value=(e.data.businesses||[]).map(e=>({id:e.id,name:e.name,code:e.code,status:e.is_active?"active":"inactive",assigned_tables:e.assigned_tables||0,calls_today:e.calls_today||0,count:e.count||0,date:e.date,is_active:e.is_active})),console.log("🏪 Negocios procesados:",T.value)}catch(t){console.error("❌ Error al cargar negocios asociados:",t),console.error("❌ Respuesta del error:",null==(e=t.response)?void 0:e.data),T.value=[]}},X=async e=>{var t,a,n,i,s;if(e)if(e.size>2097152)x.value="La imagen no puede ser mayor a 2MB";else try{A.value=!0;const t=new FormData;E.value.display_name&&t.append("display_name",E.value.display_name),E.value.bio&&t.append("bio",E.value.bio),E.value.phone&&t.append("phone",E.value.phone),E.value.birth_date&&t.append("birth_date",E.value.birth_date),E.value.height&&t.append("height",E.value.height),E.value.weight&&t.append("weight",E.value.weight),E.value.gender&&t.append("gender",E.value.gender),E.value.experience_years&&t.append("experience_years",E.value.experience_years),E.value.employment_type&&t.append("employment_type",E.value.employment_type),E.value.current_schedule&&t.append("current_schedule",E.value.current_schedule),E.value.current_location&&t.append("current_location",E.value.current_location),E.value.latitude&&t.append("latitude",E.value.latitude),E.value.longitude&&t.append("longitude",E.value.longitude),t.append("availability_hours",JSON.stringify(E.value.availability_hours||[])),t.append("skills",JSON.stringify(E.value.skills||[])),t.append("is_available",E.value.is_available?"1":"0"),t.append("avatar",e);const a=await va.updateWaiterUserProfile(t),n=new FileReader;n.onload=e=>{E.value.profile_picture=e.target.result},n.readAsDataURL(e),M.value=a.data.message||"Foto de perfil actualizada"}catch(o){422===(null==(t=o.response)?void 0:t.status)&&(null==(n=null==(a=o.response)?void 0:a.data)?void 0:n.errors)?(U.value=o.response.data.errors,x.value=o.response.data.message||"Por favor, corrige los errores en el formulario"):x.value=(null==(s=null==(i=o.response)?void 0:i.data)?void 0:s.message)||"Error al subir la imagen"}finally{A.value=!1,x.value||(await Y(),await te())}},ee=async(e,t)=>{var a,n,i,s,o;try{A.value=!0,U.value={},x.value="",E.value[e]=t;const a=new FormData;a.append(e,t||"");const n=await va.updateWaiterUserProfile(a);n.data.data&&(E.value.avatar=n.data.data.avatar,E.value.display_name=n.data.data.display_name),M.value=n.data.message||"Campo actualizado correctamente"}catch(r){422===(null==(a=r.response)?void 0:a.status)&&(null==(i=null==(n=r.response)?void 0:n.data)?void 0:i.errors)?(U.value=r.response.data.errors,x.value=r.response.data.message||"Por favor, corrige los errores en el formulario"):x.value=(null==(o=null==(s=r.response)?void 0:s.data)?void 0:o.message)||`Error al actualizar ${e}`}finally{A.value=!1,x.value||(await Y(),await te())}},te=async()=>{try{const e=await va.getProfileCompleteness();V.value=e.data}catch(e){console.error("Error checking profile completeness:",e)}},ae=async()=>{var e,t;if(N.value.current&&N.value.new&&N.value.confirm)if(W.value&&H.value)try{A.value=!0,await va.changePassword({current_password:N.value.current,password:N.value.new,password_confirmation:N.value.confirm}),N.value.current="",N.value.new="",N.value.confirm="",M.value="Contraseña actualizada correctamente"}catch(a){x.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"Error al cambiar contraseña"}finally{A.value=!1}else x.value="Verifica que la contraseña sea válida y coincida";else x.value="Por favor completa todos los campos de contraseña"},ne=()=>{$.value=null,z.value={business_name:"",position:"",description:"",start_date:"",end_date:""},j.value=!0},ie=async()=>{var e,t;try{A.value=!0;const e={business_name:z.value.business_name,position:z.value.position,description:z.value.description||"",start_date:z.value.start_date,end_date:z.value.end_date||null};if($.value){const t=await va.updateWorkHistory($.value.id,e),a=I.value.findIndex(e=>e.id===$.value.id);-1!==a&&(I.value[a]=t.data)}else{const t=await va.addWorkHistory(e);I.value.push(t.data)}j.value=!1,M.value=$.value?"Experiencia actualizada correctamente":"Experiencia agregada correctamente"}catch(a){console.error("Error al guardar experiencia laboral:",a),x.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"Error al guardar experiencia laboral"}finally{A.value=!1}},se=async()=>{var e,a;if("ELIMINAR"===q.value){B.value=!0;try{await va.deleteAccount({password:N.value.current}),await i.logout(),t.push({name:"login"})}catch(n){console.error("Error al eliminar cuenta:",n),x.value=(null==(a=null==(e=n.response)?void 0:e.data)?void 0:a.message)||"No se pudo eliminar la cuenta. Por favor, inténtalo de nuevo.",F.value=!1,q.value="",B.value=!1}}},oe=()=>{t.push({name:"waiter-dashboard"})};return s(()=>{Y(),te()}),y(),R((e,t)=>{Y(),te()}),S(M,e=>{e&&setTimeout(()=>{M.value=""},5e3)}),S(x,e=>{e&&setTimeout(()=>{x.value=""},8e3)}),(e,t)=>{var a,n,i,s,v,b,y,S,R,Y;const Q=L('else"');return w(),o("div",zE,[r("div",{class:"profile-header"},[r("button",{class:"back-button",onClick:oe},t[28]||(t[28]=[r("i",{class:"bi bi-arrow-left"},null,-1),g(" Volver ")]))]),P.value?(w(),o("div",VE,t[29]||(t[29]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"Cargando perfil...",-1)]))):l("",!0),x.value?(w(),o("div",WE,c(x.value),1)):l("",!0),M.value?(w(),o("div",HE,c(M.value),1)):l("",!0),P.value?l("",!0):(w(),o("div",GE,[V.value.is_complete?l("",!0):(w(),o("div",KE,[r("div",JE,[t[30]||(t[30]=r("h3",null,"Completitud del Perfil",-1)),r("span",YE,c(V.value.completion_percentage)+"%",1)]),r("div",QE,[r("div",ZE,[r("div",{class:"progress-fill",style:D({width:V.value.completion_percentage+"%"})},null,4)]),r("p",XE,c(V.value.completed_fields)+" de "+c(V.value.total_required_fields)+" campos completados ",1),(null==(n=null==(a=V.value)?void 0:a.missing_fields)?void 0:n.length)?(w(),o("div",eI,[t[31]||(t[31]=r("p",null,[r("strong",null,"Campos faltantes:")],-1)),r("ul",null,[(w(!0),o(_,null,k(V.value.missing_fields,e=>(w(),o("li",{key:e.field},c(e.label),1))),128))])])):l("",!0)])])),r("div",tI,[t[32]||(t[32]=r("div",{class:"card-header"},[r("h2",null,"Información Personal")],-1)),r("div",aI,[r("div",nI,[p(xE,{src:E.value.avatar,alt:`Foto de ${E.value.display_name}`,editable:!0,onFileSelected:X},null,8,["src","alt"])]),r("div",iI,[r("div",sI,[p(SE,{value:E.value.display_name,"onUpdate:value":t[0]||(t[0]=e=>ee("display_name",e)),type:"text",label:"Nombre para mostrar",placeholder:"Tu nombre como mozo",editable:!0,"has-error":!!U.value.display_name,"error-message":null==(i=U.value.display_name)?void 0:i[0]},null,8,["value","has-error","error-message"])]),r("div",oI,[p(SE,{value:E.value.birth_date,"onUpdate:value":t[1]||(t[1]=e=>ee("birth_date",e)),type:"date",label:"Fecha de nacimiento",editable:!0,"has-error":!!U.value.birth_date,"error-message":null==(s=U.value.birth_date)?void 0:s[0]},null,8,["value","has-error","error-message"]),G.value?(w(),o("div",rI," Edad: "+c(G.value)+" años ",1)):l("",!0)]),r("div",lI,[p(SE,{value:E.value.height,"onUpdate:value":t[2]||(t[2]=e=>ee("height",e)),type:"number",label:"Estatura",min:1,max:2.5,step:.01,unit:"mt",editable:!0,"has-error":!!U.value.height,"error-message":null==(v=U.value.height)?void 0:v[0]},null,8,["value","has-error","error-message"])]),r("div",cI,[p(SE,{value:E.value.weight,"onUpdate:value":t[3]||(t[3]=e=>ee("weight",e)),type:"number",label:"Peso",min:30,max:200,unit:"kg",editable:!0,"has-error":!!U.value.weight,"error-message":null==(b=U.value.weight)?void 0:b[0]},null,8,["value","has-error","error-message"])]),r("div",dI,[p(SE,{value:E.value.gender,"onUpdate:value":t[4]||(t[4]=e=>ee("gender",e)),type:"select",label:"Sexo",options:K,editable:!0,"has-error":!!U.value.gender,"error-message":null==(y=U.value.gender)?void 0:y[0]},null,8,["value","has-error","error-message"])]),r("div",uI,[p(SE,{value:E.value.experience_years,"onUpdate:value":t[5]||(t[5]=e=>ee("experience_years",e)),type:"number",label:"Años de experiencia",min:0,max:50,unit:"años",editable:!0},null,8,["value"])])])])]),r("div",hI,[t[33]||(t[33]=r("div",{class:"card-header"},[r("h3",null,"Información de Contacto")],-1)),r("div",pI,[r("div",mI,[p(SE,{value:E.value.current_location,"onUpdate:value":t[6]||(t[6]=e=>ee("current_location",e)),type:"text",label:"Ubicación actual",editable:!0},null,8,["value"])]),r("div",fI,[p(SE,{value:E.value.phone,"onUpdate:value":t[7]||(t[7]=e=>ee("phone",e)),type:"tel",label:"Teléfono",editable:!0,"has-error":!!U.value.phone,"error-message":null==(S=U.value.phone)?void 0:S[0]},null,8,["value","has-error","error-message"])]),r("div",vI,[p(SE,{value:E.value.bio,"onUpdate:value":t[8]||(t[8]=e=>ee("bio",e)),type:"textarea",label:"Descripción personal",editable:!0},null,8,["value"])])])]),r("div",gI,[t[35]||(t[35]=r("div",{class:"card-header"},[r("h3",null,"Información Laboral")],-1)),r("div",bI,[r("div",wI,[p(SE,{value:E.value.employment_type,"onUpdate:value":t[9]||(t[9]=e=>ee("employment_type",e)),type:"select",label:"Modalidad",options:J,editable:!0,"has-error":!!U.value.employment_type,"error-message":null==(R=U.value.employment_type)?void 0:R[0]},null,8,["value","has-error","error-message"])]),r("div",yI,[p(SE,{value:E.value.current_schedule,"onUpdate:value":t[10]||(t[10]=e=>ee("current_schedule",e)),type:"text",label:"Horario de trabajo actual",editable:!0,"has-error":!!U.value.current_schedule,"error-message":null==(Y=U.value.current_schedule)?void 0:Y[0]},null,8,["value","has-error","error-message"])]),r("div",_I,[r("div",kI,[t[34]||(t[34]=r("label",{class:"form-label"},"Disponibilidad",-1)),r("div",CI,[u(r("input",{type:"checkbox",id:"availability-toggle","onUpdate:modelValue":t[11]||(t[11]=e=>E.value.is_available=e),onChange:t[12]||(t[12]=e=>ee("is_available",E.value.is_available)),class:"toggle-input"},null,544),[[m,E.value.is_available]]),r("label",EI,c(E.value.is_available?"Disponible":"No disponible"),1)])])])])]),r("div",II,[t[37]||(t[37]=r("div",{class:"card-header"},[r("h3",null,"Habilidades")],-1)),r("div",SI,[r("div",TI,[(w(!0),o(_,null,k(E.value.skills,e=>(w(),o("span",{key:e,class:"skill-tag"},[g(c(e)+" ",1),r("button",{onClick:t=>(e=>{E.value.skills=E.value.skills.filter(t=>t!==e),ee("skills",E.value.skills)})(e),class:"skill-remove"},t[36]||(t[36]=[r("i",{class:"bi bi-x"},null,-1)]),8,NI)]))),128))]),r("div",PI,[r("input",{type:"text",placeholder:"Agregar habilidad",onKeyup:t[13]||(t[13]=O(e=>{var t;(t=e.target.value)&&!E.value.skills.includes(t)&&(E.value.skills.push(t),ee("skills",E.value.skills)),e.target.value=""},["enter"])),class:"skill-input"},null,32)])])]),r("div",AI,[r("div",xI,[t[39]||(t[39]=r("h3",null,"Historial Laboral",-1)),p(LE,{onClick:ne,variant:"primary",size:"sm"},{default:f(()=>t[38]||(t[38]=[r("i",{class:"bi bi-plus"},null,-1),g(" Agregar Experiencia ")])),_:1,__:[38]})]),r("div",RI,[(w(!0),o(_,null,k(I.value,e=>(w(),o("div",{key:e.id,class:"work-item"},[r("div",DI,[r("h4",null,c(e.position)+" - "+c(e.business_name),1),r("div",OI,[r("button",{onClick:t=>(e=>{$.value=e,z.value={...e},j.value=!0})(e),class:"btn btn-sm btn-outline-primary"},t[40]||(t[40]=[r("i",{class:"bi bi-pencil"},null,-1)]),8,LI),r("button",{onClick:t=>(async e=>{var t,a;if(confirm("¿Estás seguro de que deseas eliminar esta experiencia laboral?"))try{A.value=!0,await va.deleteWorkHistory(e),I.value=I.value.filter(t=>t.id!==e),M.value="Experiencia eliminada correctamente"}catch(n){console.error("Error al eliminar experiencia:",n),x.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al eliminar experiencia"}finally{A.value=!1}})(e.id),class:"btn btn-sm btn-outline-danger"},t[41]||(t[41]=[r("i",{class:"bi bi-trash"},null,-1)]),8,MI)])]),r("div",UI,[r("div",FI,c(e.start_date)+c(e.end_date?" - "+e.end_date:" - Actualidad"),1),e.description?(w(),o("div",qI,c(e.description),1)):l("",!0)])]))),128)),I.value.length?l("",!0):(w(),o("div",BI," No has agregado experiencia laboral aún. "))])]),r("div",jI,[t[47]||(t[47]=r("div",{class:"card-header"},[r("h3",null,"Negocios Asociados Hoy")],-1)),r("div",$I,[(w(!0),o(_,null,k(T.value,e=>(w(),o("div",{key:e.id,class:"business-item detailed"},[r("div",zI,[r("div",VI,c(e.name),1),e.code?(w(),o("div",WI,"Código: "+c(e.code),1)):l("",!0),r("div",{class:C(["business-status",e.status])},c(e.is_active?"Activo hoy":"Inactivo"),3)]),e.is_active?(w(),o("div",HI,[r("div",GI,[t[42]||(t[42]=r("span",{class:"stat-label"},"Mesas asignadas:",-1)),r("span",KI,c(e.assigned_tables||0),1)]),r("div",JI,[t[43]||(t[43]=r("span",{class:"stat-label"},"Llamadas hoy:",-1)),r("span",YI,c(e.calls_today||0),1)]),void 0!==e.count?(w(),o("div",QI,[t[44]||(t[44]=r("span",{class:"stat-label"},"Total:",-1)),r("span",ZI,c(e.count),1)])):l("",!0),e.date?(w(),o("div",XI,[t[45]||(t[45]=r("span",{class:"stat-label"},"Fecha:",-1)),r("span",eS,c(new Date(e.date).toLocaleDateString()),1)])):l("",!0)])):l("",!0),r("div",tS,[r("button",{onClick:t=>(async(e,t)=>{var a,n,i;if(confirm(`¿Estás seguro de que deseas abandonar el negocio "${t}"?`))try{A.value=!0,console.log("🚪 Abandonando negocio:",{businessId:e,businessName:t});const a=await va.leaveBusinessAsWaiter({business_id:e});console.log("🚪 Respuesta de leave-business:",a.data),await Z(),M.value=`Has abandonado el negocio "${t}" correctamente`}catch(s){console.error("❌ Error al abandonar negocio:",s),console.error("❌ Respuesta del error:",null==(a=s.response)?void 0:a.data),x.value=(null==(i=null==(n=s.response)?void 0:n.data)?void 0:i.message)||"Error al abandonar el negocio"}finally{A.value=!1}})(e.id,e.name),class:"btn btn-sm btn-outline-danger",disabled:A.value},t[46]||(t[46]=[r("i",{class:"bi bi-box-arrow-left"},null,-1),g(" Abandonar ")]),8,aS)])]))),128)),T.value.length?l("",!0):(w(),o("div",nS," No estás asociado a ningún negocio actualmente. "))])]),r("div",iS,[t[51]||(t[51]=r("div",{class:"card-header"},[r("h3",null,"Cambiar Contraseña")],-1)),r("form",{onSubmit:d(ae,["prevent"]),class:"password-form"},[r("div",sS,[t[48]||(t[48]=r("label",null,"Contraseña actual",-1)),u(r("input",{type:"password","onUpdate:modelValue":t[14]||(t[14]=e=>N.value.current=e),class:"form-control",disabled:A.value},null,8,oS),[[h,N.value.current]])]),r("div",rS,[t[49]||(t[49]=r("label",null,"Nueva contraseña",-1)),u(r("input",{type:"password","onUpdate:modelValue":t[15]||(t[15]=e=>N.value.new=e),class:"form-control",disabled:A.value},null,8,lS),[[h,N.value.new]]),N.value.new&&!W.value?(w(),o("div",cS," La contraseña debe tener al menos 8 caracteres ")):l("",!0)]),r("div",dS,[t[50]||(t[50]=r("label",null,"Confirmar nueva contraseña",-1)),u(r("input",{type:"password","onUpdate:modelValue":t[16]||(t[16]=e=>N.value.confirm=e),class:"form-control",disabled:A.value},null,8,uS),[[h,N.value.confirm]]),N.value.confirm&&!H.value?(w(),o("div",hS," Las contraseñas no coinciden ")):l("",!0)]),p(LE,{type:"submit",variant:"primary",disabled:A.value||!N.value.current||!N.value.new||!N.value.confirm||!W.value||!H.value},{default:f(()=>[A.value?(w(),o("span",pS,"Actualizando...")):(w(),o("span",mS,"Cambiar Contraseña"))]),_:1},8,["disabled"])],32)]),r("div",fS,[t[54]||(t[54]=r("div",{class:"card-header"},[r("h3",null,"Zona de Peligro")],-1)),r("div",vS,[t[53]||(t[53]=r("p",null,"Una vez que elimines tu cuenta, no hay vuelta atrás. Por favor, está seguro.",-1)),p(LE,{onClick:t[17]||(t[17]=e=>F.value=!0),variant:"danger",disabled:A.value},{default:f(()=>t[52]||(t[52]=[g(" Eliminar Cuenta ")])),_:1,__:[52]},8,["disabled"])])])])),p($E,{modelValue:j.value,"onUpdate:modelValue":t[24]||(t[24]=e=>j.value=e),title:$.value?"Editar Experiencia":"Agregar Experiencia",size:"md"},{footer:f(()=>[p(LE,{onClick:t[23]||(t[23]=e=>j.value=!1),variant:"secondary"},{default:f(()=>t[60]||(t[60]=[g(" Cancelar ")])),_:1,__:[60]}),p(LE,{onClick:ie,variant:"primary",disabled:A.value},{default:f(()=>[A.value?(w(),o("span",CS,"Guardando...")):(w(),o("span",ES,"Guardar"))]),_:1},8,["disabled"])]),default:f(()=>[r("form",{onSubmit:d(ie,["prevent"])},[r("div",gS,[t[55]||(t[55]=r("label",null,"Nombre del local/empresa",-1)),u(r("input",{type:"text","onUpdate:modelValue":t[18]||(t[18]=e=>z.value.business_name=e),class:"form-control",required:""},null,512),[[h,z.value.business_name]])]),r("div",bS,[t[56]||(t[56]=r("label",null,"Cargo",-1)),u(r("input",{type:"text","onUpdate:modelValue":t[19]||(t[19]=e=>z.value.position=e),class:"form-control",required:""},null,512),[[h,z.value.position]])]),r("div",wS,[t[57]||(t[57]=r("label",null,"Descripción del puesto",-1)),u(r("textarea",{"onUpdate:modelValue":t[20]||(t[20]=e=>z.value.description=e),class:"form-control",rows:"3"},null,512),[[h,z.value.description]])]),r("div",yS,[r("div",_S,[t[58]||(t[58]=r("label",null,"Fecha de ingreso",-1)),u(r("input",{type:"date","onUpdate:modelValue":t[21]||(t[21]=e=>z.value.start_date=e),class:"form-control",required:""},null,512),[[h,z.value.start_date]])]),r("div",kS,[t[59]||(t[59]=r("label",null,"Fecha de salida (opcional)",-1)),u(r("input",{type:"date","onUpdate:modelValue":t[22]||(t[22]=e=>z.value.end_date=e),class:"form-control"},null,512),[[h,z.value.end_date]])])])],32)]),_:1},8,["modelValue","title"]),p($E,{modelValue:F.value,"onUpdate:modelValue":t[27]||(t[27]=e=>F.value=e),title:"Eliminar Cuenta",size:"md"},{footer:f(()=>[p(LE,{onClick:t[26]||(t[26]=e=>F.value=!1),variant:"secondary",disabled:B.value},{default:f(()=>t[64]||(t[64]=[g(" Cancelar ")])),_:1,__:[64]},8,["disabled"]),p(LE,{onClick:se,variant:"danger",disabled:"ELIMINAR"!==q.value||B.value},{default:f(()=>[B.value?(w(),o("span",NS,"Eliminando...")):l("",!0),u((w(),o("span",null,t[65]||(t[65]=[g("Eliminar mi cuenta")]))),[[Q]])]),_:1},8,["disabled"])]),default:f(()=>[r("div",IS,[t[62]||(t[62]=r("p",null,"¿Estás seguro de que deseas eliminar tu cuenta? Esta acción no se puede deshacer.",-1)),t[63]||(t[63]=r("div",{class:"alert alert-danger"},[r("i",{class:"bi bi-exclamation-triangle-fill"}),g(" Al eliminar tu cuenta perderás todo el acceso a tus datos y negocios asociados. ")],-1)),r("div",SS,[t[61]||(t[61]=r("label",null,'Escribe "ELIMINAR" para confirmar',-1)),u(r("input",{type:"text","onUpdate:modelValue":t[25]||(t[25]=e=>q.value=e),class:"form-control",disabled:B.value},null,8,TS),[[h,q.value]])])])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-bce4d566"]]),AS=t("waiter",()=>{const e=a(localStorage.getItem("waiterBusinessId")||null),t=a(null),i=a([]),s=a([]),o=a([]),r=a(!1),l=a(null),c=n(()=>!!e.value),d=n(()=>o.value.filter(e=>"pending"===e.status).sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp))),u=e=>({...e,name:String(e.number),notifications_on:e.notifications_enabled??!0,is_muted:!(e.notifications_enabled??1),color:e.color??null,alert:!1});return{businessId:e,businessData:t,tables:i,profiles:s,notifications:o,isLoading:r,error:l,isAssociated:c,activeNotifications:d,associateBusiness:async a=>{var n,i;r.value=!0,l.value=null;try{const n=await va.waiterOnboard(a),{business:i}=n.data;return e.value=i.id,t.value=i,localStorage.setItem("waiterBusinessId",i.id),!0}catch(s){throw l.value=(null==(i=null==(n=s.response)?void 0:n.data)?void 0:i.message)||"Error al asociar el negocio.",s}finally{r.value=!1}},fetchInitialData:async()=>{var e,t,a;if(c.value){r.value=!0,l.value=null;try{const[t,a,n]=await Promise.all([va.getWaiterTables(),va.listWaiterProfiles(),va.getWaiterNotifications()]),r=(null==(e=t.data)?void 0:e.tables)??t.data;i.value=Array.isArray(r)?r.map(u):[],s.value=a.data,o.value=n.data}catch(n){l.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al cargar los datos iniciales.",console.error(n)}finally{r.value=!1}}},toggleTableNotifications:async e=>{var t,a;const n=e.notifications_on;e.notifications_on=!n,e.is_muted=!e.notifications_on;try{await va.toggleTableNotifications(e.id,{value:e.notifications_on})}catch(i){e.notifications_on=n,e.is_muted=!n,l.value=(null==(a=null==(t=i.response)?void 0:t.data)?void 0:a.message)||"Error al actualizar la mesa.",console.error(i)}},fetchNotifications:async()=>{try{const e=await va.getWaiterNotifications();o.value=e.data}catch(e){console.error("Error fetching notifications:",e)}},handleNotification:async(e,t)=>{var a,n;try{await va.handleWaiterNotification(e,{action:t}),o.value=o.value.filter(t=>t.id!==e)}catch(i){l.value=(null==(n=null==(a=i.response)?void 0:a.data)?void 0:n.message)||"Error al procesar la notificación.",console.error(i)}},createProfile:async e=>{var t,a;try{const t=await va.createWaiterProfile({name:e});s.value.push(t.data)}catch(n){l.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al crear el perfil.",console.error(n)}},deleteProfile:async e=>{var t,a;try{await va.deleteWaiterProfile(e),s.value=s.value.filter(t=>t.id!==e)}catch(n){l.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al eliminar el perfil.",console.error(n)}},clearWaiterData:()=>{e.value=null,t.value=null,i.value=[],s.value=[],o.value=[],localStorage.removeItem("waiterBusinessId")}}}),xS={class:"onboarding-container"},RS={class:"content-wrapper"},DS=["src"],OS={class:"form-container"},LS=["disabled"],MS={key:0,class:"spinner"},US={key:1},FS=["onInput","onKeydown"],qS={key:0,class:"error-feedback"},BS=Lh({__name:"Onboarding",setup(e){const t=b(),n=AS(),s=en(),u=a(["","","",""]),h=a(!1),p=a(""),m=a([]),f=e=>{e.preventDefault();const t=e.clipboardData.getData("text").trim().slice(0,4);/^\d{4}$/.test(t)&&(t.split("").forEach((e,t)=>{u.value[t]=e,m.value[t].value=e}),m.value[3].focus(),v())},v=async()=>{const e=u.value.join("");if(4===e.length){h.value=!0,p.value="";try{await n.associateBusiness(e),await s.fetchUser(),t.push({name:"waiter-dashboard"})}catch(a){p.value=a.message||"El código es incorrecto o ha expirado.","vibrate"in navigator&&navigator.vibrate(100)}finally{h.value=!1}}else p.value="El código debe tener 4 dígitos."},g=()=>{t.push({name:"profile"})};return(e,t)=>{var a;return w(),o("div",xS,[r("div",RS,[r("div",{class:"user-header",onClick:g,title:"Editar perfil"},[r("img",{src:(null==(a=i(s).user)?void 0:a.avatar)||"/src/assets/default-avatar.png",alt:"Avatar",class:"user-avatar"},null,8,DS),t[0]||(t[0]=r("div",{class:"business-selector-wrapper",title:"Vincúlate introduciendo un código"},[r("span",null,"Negocio:"),r("select",{disabled:""},[r("option",null,"Ninguno")])],-1))]),r("div",OS,[r("form",{onSubmit:d(v,["prevent"])},[r("button",{type:"submit",class:"btn-primary",disabled:h.value},[h.value?(w(),o("span",MS)):(w(),o("span",US,"AGREGAR NEGOCIO"))],8,LS),t[1]||(t[1]=r("h2",{class:"code-prompt"},"Código",-1)),r("div",{class:"otp-inputs",onPaste:f},[(w(),o(_,null,k(4,e=>r("input",{key:e,type:"text",inputmode:"numeric",maxlength:"1",class:"otp-box",ref_for:!0,ref:t=>m.value[e-1]=t,onInput:t=>((e,t)=>{const a=e.target;let n=a.value;/^\d*$/.test(n)?(u.value[t-1]=n,n&&a.nextElementSibling&&a.nextElementSibling.focus()):a.value=""})(t,e),onKeydown:e=>{var t;"Backspace"===(t=e).key&&!t.target.value&&t.target.previousElementSibling&&t.target.previousElementSibling.focus()}},null,40,FS)),64))],32)],32),p.value?(w(),o("p",qS,c(p.value),1)):l("",!0)])])])}}},[["__scopeId","data-v-8759152c"]]),jS={class:"staff-invitations"},$S={class:"container"},zS={key:0,class:"loading-state"},VS={key:1,class:"empty-state"},WS={key:2,class:"invitations-grid"},HS={class:"card-header"},GS={class:"business-info"},KS={class:"business-logo"},JS=["src","alt"],YS={key:1,class:"fas fa-building"},QS={class:"business-details"},ZS={class:"position"},XS={key:0},eT={key:1},tT={key:2},aT={class:"card-body"},nT={class:"invitation-details"},iT={key:0,class:"detail-item"},sT={key:1,class:"detail-item"},oT={class:"detail-item"},rT={key:0,class:"invitation-message"},lT={key:0,class:"card-actions"},cT=["onClick","disabled"],dT={key:0,class:"fas fa-spinner fa-spin"},uT={key:1,class:"fas fa-check"},hT=["onClick","disabled"],pT={key:0,class:"fas fa-spinner fa-spin"},mT={key:1,class:"fas fa-times"},fT={key:1,class:"card-actions"},vT={key:3,class:"back-button"},gT=Lh({__name:"StaffInvitations",setup(e){const t=b(),n=en(),i=a([]),d=a(!1),u=a(!1),h=a(null),p=e=>{if(!e.invitation_sent_at)return!1;const t=new Date(e.invitation_sent_at);return(new Date-t)/864e5>7},m=e=>{if(!e)return"Fecha desconocida";const t=new Date(e),a=new Date,n=Math.abs(a-t),i=Math.ceil(n/864e5);return 1===i?"hace 1 día":i<7?`hace ${i} días`:t.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})};return s(()=>{(async()=>{var e,t,a;d.value=!0;try{const n=(null==(a=null==(t=null==(e=(await va.getWaiterNotifications()).data)?void 0:e.unread_notifications)?void 0:t.filter(e=>"staff_invitation"===e.type))?void 0:a.map(e=>{var t,a,n,i,s,o,r,l;return{id:(null==(t=e.data)?void 0:t.staff_invitation_id)||e.id,business_name:null==(a=e.data)?void 0:a.business_name,business_logo:null==(n=e.data)?void 0:n.business_logo,business_address:null==(i=e.data)?void 0:i.business_address,position:(null==(s=e.data)?void 0:s.position)||"Mozo",salary:null==(o=e.data)?void 0:o.salary,status:"invited",invitation_sent_at:e.created_at,invitation_token:null==(r=e.data)?void 0:r.invitation_token,notes:null==(l=e.data)?void 0:l.message}}))||[];i.value=n}catch(n){console.error("Error loading invitations:",n),sr("Error al cargar invitaciones")}finally{d.value=!1}})()}),(e,a)=>(w(),o("div",jS,[r("div",$S,[a[15]||(a[15]=r("div",{class:"header"},[r("h1",null,[r("i",{class:"fas fa-envelope"}),g(" Invitaciones de Trabajo ")]),r("p",{class:"subtitle"},"Revisa y gestiona tus invitaciones para trabajar en diferentes negocios")],-1)),d.value?(w(),o("div",zS,a[2]||(a[2]=[r("div",{class:"spinner"},null,-1),r("p",null,"Cargando invitaciones...",-1)]))):0===i.value.length?(w(),o("div",VS,[a[4]||(a[4]=r("div",{class:"empty-icon"},[r("i",{class:"fas fa-inbox"})],-1)),a[5]||(a[5]=r("h3",null,"No tienes invitaciones",-1)),a[6]||(a[6]=r("p",null,"Cuando los administradores te inviten a trabajar, aparecerán aquí.",-1)),r("button",{onClick:a[0]||(a[0]=t=>e.$router.push("/waiter/dashboard")),class:"btn btn-primary"},a[3]||(a[3]=[r("i",{class:"fas fa-arrow-left"},null,-1),g(" Volver al Dashboard ")]))])):(w(),o("div",WS,[(w(!0),o(_,null,k(i.value,e=>(w(),o("div",{key:e.id,class:C(["invitation-card",{expired:p(e)}])},[r("div",HS,[r("div",GS,[r("div",KS,[e.business_logo?(w(),o("img",{key:0,src:e.business_logo,alt:e.business_name},null,8,JS)):(w(),o("i",YS))]),r("div",QS,[r("h3",null,c(e.business_name),1),r("p",ZS,c(e.position||"Mozo"),1)])]),r("div",{class:C(["invitation-status",e.status])},["invited"===e.status?(w(),o("span",XS,"📩 Pendiente")):"confirmed"===e.status?(w(),o("span",eT,"✅ Aceptada")):"rejected"===e.status?(w(),o("span",tT,"❌ Rechazada")):l("",!0)],2)]),r("div",aT,[r("div",nT,[e.business_address?(w(),o("div",iT,[a[7]||(a[7]=r("i",{class:"fas fa-map-marker-alt"},null,-1)),r("span",null,c(e.business_address),1)])):l("",!0),e.salary?(w(),o("div",sT,[a[8]||(a[8]=r("i",{class:"fas fa-dollar-sign"},null,-1)),r("span",null,"$"+c(e.salary.toLocaleString()),1)])):l("",!0),r("div",oT,[a[9]||(a[9]=r("i",{class:"fas fa-clock"},null,-1)),r("span",null,"Invitado "+c(m(e.invitation_sent_at)),1)])]),e.notes?(w(),o("div",rT,[a[10]||(a[10]=r("i",{class:"fas fa-comment"},null,-1)),r("p",null,c(e.notes),1)])):l("",!0)]),"invited"!==e.status||p(e)?p(e)?(w(),o("div",fT,a[13]||(a[13]=[r("div",{class:"expired-message"},[r("i",{class:"fas fa-exclamation-triangle"}),g(" Esta invitación ha expirado ")],-1)]))):l("",!0):(w(),o("div",lT,[r("button",{onClick:a=>(async e=>{var a,s,o,r;u.value=!0,h.value=e.id;try{const o={user_id:n.user.id},r=await va.joinStaffWithToken(e.invitation_token,o);if(!(null==(a=r.data)?void 0:a.success)&&!r.success)throw new Error((null==(s=r.data)?void 0:s.message)||"Error al aceptar invitación");{ir(`¡Te has unido exitosamente a ${e.business_name}!`),Vw(e.business_name);const a=i.value.findIndex(t=>t.id===e.id);-1!==a&&(i.value[a].status="confirmed"),setTimeout(()=>{t.push("/waiter/dashboard")},2e3)}}catch(l){console.error("Error accepting invitation:",l);const e=(null==(r=null==(o=l.response)?void 0:o.data)?void 0:r.message)||l.message||"Error al aceptar invitación";sr(e)}finally{u.value=!1,h.value=null}})(e),disabled:u.value,class:"btn btn-success"},[u.value&&h.value===e.id?(w(),o("i",dT)):(w(),o("i",uT)),a[11]||(a[11]=g(" Aceptar "))],8,cT),r("button",{onClick:t=>(async e=>{u.value=!0,h.value=e.id;try{ir(`Has declinado la invitación de ${e.business_name}`);const t=i.value.findIndex(t=>t.id===e.id);-1!==t&&(i.value[t].status="rejected")}catch(t){console.error("Error declining invitation:",t),sr("Error al declinar invitación")}finally{u.value=!1,h.value=null}})(e),disabled:u.value,class:"btn btn-danger"},[u.value&&h.value===e.id?(w(),o("i",pT)):(w(),o("i",mT)),a[12]||(a[12]=g(" Declinar "))],8,hT)]))],2))),128))])),i.value.length>0?(w(),o("div",vT,[r("button",{onClick:a[1]||(a[1]=t=>e.$router.push("/waiter/dashboard")),class:"btn btn-outline"},a[14]||(a[14]=[r("i",{class:"fas fa-arrow-left"},null,-1),g(" Volver al Dashboard ")]))])):l("",!0)])]))}},[["__scopeId","data-v-35a9f1e6"]]),bT={class:"dashboard"},wT={class:"container py-3"},yT={class:"role-section"},_T={key:0,class:"business-dropdown ms-auto me-2"},kT=["disabled"],CT={key:0,class:"bi bi-arrow-clockwise spin ms-1"},ET=["onClick"],IT={key:0,class:"text-success ms-2"},ST={class:"user-id-container d-flex align-items-center ms-auto"},TT={class:"user-id me-2"},NT={key:0,class:"text-center py-5"},PT={key:1,class:"alert alert-danger"},AT={key:2},xT={key:0,class:"alert alert-warning d-flex justify-content-between align-items-center"},RT={class:"card mb-3"},DT={class:"card-body d-flex flex-wrap align-items-center justify-content-between gap-3"},OT={class:"me-auto"},LT={class:"mb-1"},MT={class:"text-muted small"},UT={class:"d-flex gap-3"},FT={class:"text-center"},qT={class:"fw-bold"},BT={class:"text-center"},jT={class:"fw-bold"},$T={class:"text-center"},zT={class:"fw-bold"},VT={class:"card-footer d-flex flex-wrap align-items-center gap-2"},WT={class:"me-auto small"},HT={key:0,class:"ms-2"},GT=["href"],KT={class:"row g-3 card-grid"},JT={class:"col-6"},YT={class:"col-6"},QT={class:"col-6"},ZT={class:"col-6"},XT=Lh({__name:"Home",setup(e){const t=b(),d=gE();en();const u=a(!1),h=a(""),m=a(!1),y=a(!1),I=a(""),S=n(()=>d.availableBusinesses||[]),T=n(()=>{var e;const t=S.value.find(e=>e.id===d.activeBusinessId);return(null==t?void 0:t.name)||(null==(e=d.businessData)?void 0:e.name)||"Negocio"}),N=a({activeRequests:0,pendingRequests:0,totalOrders:0,totalSales:0,salesThisMonth:0}),P=async()=>{try{let e=d.businessData;if(e&&e.id||(e=await d.fetchBusinessData()),d.requiresBusinessSetup||(null==e?void 0:e.requires_business_setup))return void t.replace({name:"admin-onboard"});const a=[];d.requiresBusinessSetup||d.availableBusinesses&&0!==d.availableBusinesses.length||a.push(d.fetchAllBusinesses().catch(e=>{console.warn("Error al cargar lista de negocios:",e)})),d.staffRequests&&0!==d.staffRequests.length||a.push(d.fetchStaffRequests()),a.push(d.fetchDashboardStats().then(e=>{N.value=e})),await Promise.allSettled(a),d.businessData&&d.invitationCode&&(I.value=d.invitationCode)}catch(e){h.value=e.message||"Error al cargar datos del negocio"}};s(async()=>{u.value=!0,h.value="",await P(),document.addEventListener("click",e=>{const t=document.querySelector(".business-dropdown");t&&!t.contains(e.target)&&(m.value=!1)}),u.value=!1}),E(()=>{document.removeEventListener("click",()=>{})});const A=()=>{d.businessId&&navigator.clipboard.writeText(d.businessId).then(()=>{alert("ID de negocio copiado al portapapeles")}).catch(()=>{alert("No se pudo copiar el ID de negocio")})},x=()=>{m.value=!m.value},R=()=>{navigator.clipboard.writeText(I.value).then(()=>{console.log("Código copiado al portapapeles")}).catch(e=>{console.error("Error al copiar al portapapeles:",e)})};return(e,t)=>{var a;const n=v("RouterLink");return w(),o("div",bT,[r("div",wT,[r("div",yT,[t[7]||(t[7]=M('<div class="role-dropdown me-2" data-v-2c279fc9><button class="btn btn-outline-secondary dropdown-toggle" id="roleMenu" data-bs-toggle="dropdown" data-v-2c279fc9> Rol Admin </button><ul class="dropdown-menu" aria-labelledby="roleMenu" data-v-2c279fc9><li data-v-2c279fc9><a class="dropdown-item" href="#" data-v-2c279fc9>Admin</a></li><li data-v-2c279fc9><a class="dropdown-item" href="#" data-v-2c279fc9>Mozo</a></li></ul></div>',1)),S.value.length>1?(w(),o("div",_T,[r("button",{class:"btn btn-outline-primary dropdown-toggle btn-sm",onClick:x,disabled:y.value},[t[3]||(t[3]=r("i",{class:"bi bi-building me-1"},null,-1)),g(" "+c(y.value?"Cambiando...":T.value)+" ",1),y.value?(w(),o("i",CT)):l("",!0)],8,kT),r("div",{class:C(["dropdown-menu",{show:m.value}])},[(w(!0),o(_,null,k(S.value,e=>(w(),o("div",{key:e.id,class:"dropdown-item-wrapper"},[r("a",{class:C(["dropdown-item",{active:e.id===i(d).activeBusinessId}]),href:"#",onClick:t=>(async e=>{if(e.id!==d.activeBusinessId)try{y.value=!0,m.value=!1,await d.selectActiveBusiness(e.id),I.value=d.invitationCode||"",await P()}catch(t){console.error("Error al cambiar negocio:",t)}finally{y.value=!1}else m.value=!1})(e)},[t[5]||(t[5]=r("i",{class:"bi bi-building me-2"},null,-1)),g(" "+c(e.name)+" ",1),e.id===i(d).activeBusinessId?(w(),o("small",IT,t[4]||(t[4]=[r("i",{class:"bi bi-check-circle-fill"},null,-1)]))):l("",!0)],10,ET)]))),128))],2)])):l("",!0),r("div",ST,[r("span",TT,"ID:"+c(I.value),1),r("button",{class:"btn btn-sm btn-outline-secondary",onClick:R,title:"Copiar al portapapeles"},t[6]||(t[6]=[r("i",{class:"bi bi-clipboard"},null,-1)]))])]),u.value?(w(),o("div",NT,t[8]||(t[8]=[r("div",{class:"spinner-border text-primary",role:"status"},[r("span",{class:"visually-hidden"},"Cargando...")],-1),r("p",{class:"mt-2"},"Cargando...",-1)]))):h.value?(w(),o("div",PT,[r("p",null,c(h.value),1),r("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=t=>e.$router.go(0))}," Reintentar ")])):(w(),o("div",AT,[i(d).requiresBusinessSetup?(w(),o("div",xT,[t[9]||(t[9]=r("span",null,"Aún no tienes un negocio configurado.",-1)),r("button",{class:"btn btn-sm btn-primary",onClick:t[1]||(t[1]=t=>e.$router.replace({name:"admin-onboard"}))},"Configurar ahora")])):l("",!0),r("div",RT,[r("div",DT,[r("div",OT,[r("h5",LT,c((null==(a=i(d).businessData)?void 0:a.name)||"Mi negocio"),1),r("div",MT,"Negocio activo: #"+c(i(d).activeBusinessId),1)]),r("div",UT,[r("div",FT,[r("div",qT,c(i(d).tablesCount),1),t[10]||(t[10]=r("div",{class:"small text-muted"},"Mesas",-1))]),r("div",BT,[r("div",jT,c(i(d).menusCount),1),t[11]||(t[11]=r("div",{class:"small text-muted"},"Menús",-1))]),r("div",$T,[r("div",zT,c(i(d).qrCodesCount),1),t[12]||(t[12]=r("div",{class:"small text-muted"},"QRs",-1))])])]),r("div",VT,[r("div",WT,[t[13]||(t[13]=r("span",{class:"text-muted"},"Código de invitación: ",-1)),r("code",null,c(i(d).invitationCode||"—"),1),i(d).invitationUrl?(w(),o("span",HT,[r("a",{href:i(d).invitationUrl,target:"_blank"},"Enlace",8,GT)])):l("",!0)]),r("button",{class:"btn btn-sm btn-outline-primary",onClick:t[2]||(t[2]=()=>i(d).regenerateInvitation().then(()=>i(d).fetchBusinessData()))},"Regenerar"),r("button",{class:"btn btn-sm btn-outline-secondary",onClick:A},"Copiar ID")])]),r("div",KT,[r("div",JT,[p(n,{to:{name:"admin-qr"},class:"card dashboard-card text-center text-decoration-none"},{default:f(()=>t[14]||(t[14]=[r("div",{class:"card-body"},[r("i",{class:"bi bi-qr-code"})],-1),r("div",{class:"card-footer"},"QR",-1)])),_:1,__:[14]})]),r("div",YT,[p(n,{to:{name:"admin-stats"},class:"card dashboard-card text-center text-decoration-none"},{default:f(()=>t[15]||(t[15]=[r("div",{class:"card-body"},[r("i",{class:"bi bi-graph-up"})],-1),r("div",{class:"card-footer"},"ESTADÍSTICAS",-1)])),_:1,__:[15]})]),r("div",QT,[p(n,{to:{name:"admin-staff"},class:"card dashboard-card text-center text-decoration-none"},{default:f(()=>t[16]||(t[16]=[r("div",{class:"card-body"},[r("i",{class:"bi bi-person-fill"})],-1),r("div",{class:"card-footer"},"PERSONAL",-1)])),_:1,__:[16]})]),r("div",ZT,[p(n,{to:{name:"admin-settings"},class:"card dashboard-card text-center text-decoration-none"},{default:f(()=>t[17]||(t[17]=[r("div",{class:"card-body"},[r("i",{class:"bi bi-gear-fill"})],-1),r("div",{class:"card-footer"},"CONFIGURACIÓN",-1)])),_:1,__:[17]})])])]))])])}}},[["__scopeId","data-v-2c279fc9"]]),eN={class:"mb-3"},tN={class:"form-label"},aN=["type","placeholder"],nN=["disabled"],iN={__name:"InputModal",props:{modelValue:Boolean,title:{type:String,default:"Ingresar dato"},label:{type:String,default:""},placeholder:{type:String,default:""},defaultValue:{type:[String,Number],default:""},inputType:{type:String,default:"text"}},emits:["update:modelValue","confirm"],setup(e,{emit:t}){const n=e,i=t,s=a(n.defaultValue);S(()=>n.modelValue,e=>{e&&(s.value=n.defaultValue)});const o=()=>{const e="number"===n.inputType?s.value:s.value.trim();i("confirm",e),i("update:modelValue",!1)};return(t,a)=>(w(),T($E,{"model-value":e.modelValue,"onUpdate:modelValue":a[2]||(a[2]=e=>t.$emit("update:modelValue",e)),title:e.title,size:"sm"},{footer:f(()=>[r("button",{class:"btn btn-secondary",onClick:a[1]||(a[1]=e=>t.$emit("update:modelValue",!1))},"Cancelar"),r("button",{class:"btn btn-primary",disabled:!s.value.toString().trim(),onClick:o},"Aceptar",8,nN)]),default:f(()=>[r("div",eN,[r("label",tN,c(e.label),1),u(r("input",{type:e.inputType,class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),placeholder:e.placeholder},null,8,aN),[[N,s.value]])])]),_:1},8,["model-value","title"]))}},sN=Lh({__name:"SkeletonLoader",props:{width:{type:String,default:"100%"},height:{type:String,default:"1rem"},borderRadius:{type:String,default:"4px"}},setup:e=>(t,a)=>(w(),o("div",{class:"skeleton",style:D({width:e.width,height:e.height,borderRadius:e.borderRadius})},null,4))},[["__scopeId","data-v-7bfd6ab9"]]),oN={class:"menu-card-skeleton"},rN={class:"skeleton-info"},lN=Lh({__name:"MenuCardSkeleton",setup:e=>(e,t)=>(w(),o("div",oN,[p(sN,{height:"150px",borderRadius:"12px 12px 0 0"}),r("div",rN,[p(sN,{width:"70%",height:"1.25rem",borderRadius:"4px"}),p(sN,{width:"40%",height:"1rem",borderRadius:"4px",style:{"margin-top":"8px"}})])]))},[["__scopeId","data-v-01f8ef4d"]]),cN={class:"table-item-skeleton"},dN=Lh({__name:"TableListItemSkeleton",setup:e=>(e,t)=>(w(),o("div",cN,[p(sN,{width:"80%",height:"24px",borderRadius:"6px"})]))},[["__scopeId","data-v-41c50015"]]),uN={class:"qr-container"},hN={class:"tabs-container"},pN={class:"tabs-header d-flex justify-content-center align-items-center"},mN={key:0,class:"loading-container"},fN={key:1,class:"alert alert-danger"},vN={class:"qr-content"},gN={key:0,class:"qr-layout"},bN={class:"tables-panel"},wN={class:"select-all-container"},yN=["checked"],_N={key:0,class:"tables-list"},kN={key:1,class:"tables-list"},CN=["onClick"],EN=["checked","onChange"],IN={class:"table-name"},SN=["onClick"],TN=["onClick"],NN={class:"qr-panel"},PN={key:0,class:"qr-display-multiple"},AN={class:"share-buttons"},xN={key:1,class:"qr-display"},RN={class:"qr-table-name"},DN={key:0,class:"qr-code-item"},ON={key:0,class:"qr-image-loader"},LN=["src"],MN={key:2,class:"qr-image-error"},UN={class:"share-buttons"},FN={key:1,class:"no-qr-codes"},qN={key:2,class:"qr-placeholder"},BN={key:1,class:"menu-layout"},jN={key:0,class:"menu-grid"},$N={key:1,class:"menu-grid"},zN=["onClick"],VN={class:"card-content"},WN={class:"menu-info"},HN={class:"menu-name"},GN={key:0,class:"menu-badge"},KN=["onClick"],JN=["onClick"],YN=["onClick"],QN=["onClick"],ZN=["onClick"],XN={key:0,class:"processing-overlay"},eP={class:"edit-table-content"},tP={class:"form-group"},aP={class:"form-group"},nP={class:"download-modal-content"},iP={class:"form-group"},sP={class:"email-modal-content"},oP={class:"form-group"},rP={class:"form-group"},lP={class:"form-group"},cP={class:"form-group"},dP=Lh({__name:"QR",setup(e){b();const t=gE(),i=n(()=>t.isLoading),m=n(()=>t.error),v=n(()=>t.tables),y=n(()=>t.menus),E=a(null);a("");const I=a(localStorage.getItem("adminQRTab")||"tables"),T=a(!1),N=a(""),A=a(!1),x=a({id:null,number:null,name:""}),R=a(null),D=a(null),O=a([]),L=a(!1),M=a("pdf");let U=[];const F=a(""),q=a(!1),B=a(!1),j=a("pdf"),$=a(""),z=a("Mesas QR"),V=a("Te comparto los códigos.");let W=[];const H=e=>O.value.some(t=>t.id===e.id),G=e=>{e.target.checked?O.value=[...v.value]:O.value=[]},K=e=>{I.value=e,localStorage.setItem("adminQRTab",e)},J=()=>{N.value="",T.value=!0},Y=async e=>{const a=parseInt(e,10);if(isNaN(a)||a<=0)sr("Por favor, ingresa un número de mesa válido y mayor a cero.");else try{await t.createTable({number:a}),ir("Mesa creada correctamente")}catch(n){sr(n.message||"Error al crear la mesa")}},Q=async()=>{if(!x.value.number||x.value.number<=0)sr("Por favor, ingresa un número de mesa válido y mayor a cero.");else try{const e={number:x.value.number,name:x.value.name||null};if(await t.updateTable(x.value.id,e),A.value=!1,E.value&&E.value.id===x.value.id){const e=v.value.find(e=>e.id===x.value.id);e&&(E.value=e)}ir("Mesa actualizada correctamente")}catch(e){sr(e.message||"Error al actualizar la mesa")}},Z=async()=>{if(E.value)try{const e=E.value.qr_code,a=e?"regenerado":"generado";e?await t.regenerateQrCode(E.value.id):await t.generateQrCode(E.value.id);const n=v.value.find(e=>e.id===E.value.id);n&&(E.value=n),ir(`Código QR ${a} exitosamente.`)}catch(e){sr(e.message||"Error al procesar código QR")}},X=async()=>{const{value:e}=await ar.fire({title:"Selecciona un PDF",input:"file",inputAttributes:{accept:"application/pdf"},confirmButtonText:"Subir",showCancelButton:!0,cancelButtonText:"Cancelar"});if(!e)return;const a=e.size/1048576;if(a>50)return void sr(`El archivo (${a.toFixed(2)} MB) supera el límite de 50 MB`);const{value:n}=await ar.fire({title:"Nombre del menú",input:"text",inputValue:e.name.replace(/\.pdf$/i,""),showCancelButton:!0,confirmButtonText:"Guardar"});if(!n)return;const i=new FormData;i.append("file",e),i.append("name",n),await t.uploadMenu(i),ir("Menú subido")},ee=async()=>{try{const e=await fa.post("/debug/fix-php-limits",{});console.log("🐛 DEBUG RESULT:",e.data),ar.fire({title:"✅ DEBUG Success",text:e.data,icon:"success"})}catch(e){console.error("🐛 DEBUG ERROR:",e),ar.fire({title:"❌ DEBUG Error",text:e.message||"Error al ejecutar el debug",icon:"error"})}},te=e=>{U=e,L.value=!0},ae=async()=>{L.value=!1;const e=U.filter(e=>e.qr_code&&e.qr_code.id).map(e=>e.qr_code.id);if(0===e.length)return void sr("Ninguna de las mesas seleccionadas tiene un QR para exportar.");const t=M.value;try{const a=await fa.post("/admin/qr/export",{qr_ids:e,format:t},{responseType:"blob"}),n=window.URL.createObjectURL(a.data),i=document.createElement("a");i.href=n;const s=a.headers["content-disposition"];let o;if(s){const e=s.match(/filename="(.+)"/);e&&2===e.length&&(o=e[1])}if(!o){const a=t;if(1===e.length){o=`QR_Mesa_${U.find(t=>t.qr_code&&t.qr_code.id===e[0]).number}.${a}`}else o=`QRs_Export.${a}`}i.download=o,document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(n)}catch(a){sr("Error al exportar los códigos QR.")}},ne=e=>{W=e,B.value=!0},ie=async()=>{B.value=!1;const e=$.value.split(",").map(e=>e.trim()).filter(e=>e);if(0===e.length)return void sr("Ingresa al menos un destinatario.");const t=W.filter(e=>e.qr_code&&e.qr_code.id).map(e=>e.qr_code.id);if(0===t.length)return void sr("Ninguna de las mesas seleccionadas tiene un QR para enviar.");const a={qr_ids:t,format:j.value,recipients:e,subject:z.value,body:V.value};try{await fa.post("/admin/qr/email",a),ir("Correo enviado correctamente.")}catch(n){sr(n.message||"Error al enviar el correo.")}};return s(()=>{t.fetchTables(),t.fetchMenus()}),S(E,async e=>{if(F.value&&(URL.revokeObjectURL(F.value),F.value=""),e&&e.qr_code){q.value=!0;try{const t=await fa.get(`/admin/qr/preview/${e.id}`,{responseType:"blob"});F.value=URL.createObjectURL(t.data)}catch(t){console.error("Error fetching QR code image:",t),sr("No se pudo cargar la imagen del QR.")}finally{q.value=!1}}}),S(v,e=>{if(E.value){const t=e.find(e=>e.id===E.value.id);t&&t!==E.value&&(E.value=t)}},{deep:!0}),(e,a)=>(w(),o("div",uN,[r("div",hN,[r("div",pN,[r("button",{class:C(["tab-button",{active:"tables"===I.value}]),onClick:a[0]||(a[0]=e=>K("tables"))}," MESAS ",2),r("button",{class:C(["tab-button",{active:"menus"===I.value}]),onClick:a[1]||(a[1]=e=>K("menus"))}," MENÚ ",2)])]),i.value&&!v.value.length?(w(),o("div",mN,a[24]||(a[24]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"Cargando datos...",-1)]))):l("",!0),m.value&&!i.value?(w(),o("div",fN,c(m.value),1)):l("",!0),r("div",vN,["tables"===I.value?(w(),o("div",gN,[r("div",bN,[a[28]||(a[28]=r("h2",{class:"panel-title"},"Selecciona una mesa",-1)),r("div",wN,[r("input",{type:"checkbox",onChange:G,checked:v.value.length>0&&O.value.length===v.value.length,class:"form-check-input"},null,40,yN),a[25]||(a[25]=r("label",null,"Seleccionar todo",-1))]),i.value?(w(),o("div",_N,[(w(),o(_,null,k(8,e=>p(dN,{key:e})),64))])):(w(),o("div",kN,[(w(!0),o(_,null,k(v.value,e=>(w(),o("div",{key:e.id,class:C(["table-item",{active:E.value&&E.value.id===e.id}]),onClick:t=>(e=>{E.value=e})(e)},[r("input",{type:"checkbox",checked:H(e),onChange:t=>(e=>{const t=O.value.findIndex(t=>t.id===e.id);-1===t?O.value.push(e):O.value.splice(t,1)})(e),onClick:a[2]||(a[2]=d(()=>{},["stop"])),class:"form-check-input"},null,40,EN),r("span",IN,c((e.name||`MESA ${e.number}`).toUpperCase()),1),r("div",{class:"table-actions",onClick:a[3]||(a[3]=d(()=>{},["stop"]))},[r("button",{onClick:t=>(e=>{x.value={id:e.id,number:e.number,name:e.name||""},A.value=!0})(e),class:"btn-action edit",title:"Editar mesa"},a[26]||(a[26]=[r("i",{class:"bi bi-pencil"},null,-1)]),8,SN),r("button",{onClick:a=>(async e=>{if((await ar.fire({title:"¿Eliminar mesa?",html:`¿Estás seguro de que deseas eliminar la mesa <strong>${e.name||`MESA ${e.number}`}</strong>?<br><br><small class="text-danger">Esta acción no se puede deshacer y eliminará también su código QR.</small>`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{await t.deleteTable(e.id),E.value&&E.value.id===e.id&&(E.value=null),O.value=O.value.filter(t=>t.id!==e.id),ir(`Mesa ${e.name||e.number} eliminada correctamente`)}catch(a){sr(a.message||"Error al eliminar la mesa")}})(e),class:"btn-action delete",title:"Eliminar mesa"},a[27]||(a[27]=[r("i",{class:"bi bi-trash"},null,-1)]),8,TN)])],10,CN))),128))])),r("button",{class:"add-table-btn",onClick:J},"MESA ＋")]),r("div",NN,[O.value.length>0?(w(),o("div",PN,[r("h3",null,c(O.value.length)+" mesa(s) seleccionada(s)",1),a[31]||(a[31]=r("p",null,"Selecciona una acción para aplicar a todas las mesas seleccionadas.",-1)),r("div",AN,[r("button",{onClick:a[4]||(a[4]=e=>te(O.value)),class:"share-btn download"},a[29]||(a[29]=[r("i",{class:"bi bi-download"},null,-1),g(" Descargar QRs ")])),r("button",{onClick:a[5]||(a[5]=e=>ne(O.value)),class:"share-btn email"},a[30]||(a[30]=[r("i",{class:"bi bi-envelope-fill"},null,-1),g(" Enviar por correo ")]))])])):E.value?(w(),o("div",xN,[r("h3",RN,"Mesa "+c(E.value.number),1),E.value.qr_code?(w(),o("div",DN,[q.value?(w(),o("div",ON,a[32]||(a[32]=[r("div",{class:"loading-spinner-small"},null,-1)]))):F.value?(w(),o("img",{key:1,src:F.value,alt:"Código QR",class:"qr-image"},null,8,LN)):(w(),o("div",MN,a[33]||(a[33]=[r("i",{class:"bi bi-exclamation-triangle-fill"},null,-1),r("span",null,"Error al cargar QR",-1)]))),r("div",UN,[r("button",{onClick:a[6]||(a[6]=e=>te([E.value])),class:"share-btn download"},a[34]||(a[34]=[r("i",{class:"bi bi-download"},null,-1),g(" Descargar ")])),r("button",{onClick:a[7]||(a[7]=e=>(async e=>{if(e&&e.qr_code)try{const t=await fa.post("/admin/qr/export",{qr_ids:[e.qr_code.id],format:"png"},{responseType:"blob"}),a=new File([t.data],`QR_Mesa_${e.number}.png`,{type:"image/png"});if(navigator.canShare&&navigator.canShare({files:[a]}))await navigator.share({files:[a],title:`Código QR para Mesa ${e.number}`,text:`Aquí está el código QR para la mesa ${e.number}.`});else{const e=window.URL.createObjectURL(a),t=document.createElement("a");t.href=e,t.download=a.name,document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(e),ir("Archivo descargado (el navegador no admite compartir).")}}catch(t){"AbortError"!==t.name&&sr("Error al intentar compartir el código QR.")}else sr("La mesa no tiene un QR para compartir.")})(E.value)),class:"share-btn share"},a[35]||(a[35]=[r("i",{class:"bi bi-share-fill"},null,-1),g(" Compartir ")])),r("button",{onClick:a[8]||(a[8]=e=>ne([E.value])),class:"share-btn email"},a[36]||(a[36]=[r("i",{class:"bi bi-envelope-fill"},null,-1),g(" Enviar ")]))]),r("button",{class:"btn btn-secondary mt-3",onClick:Z},"Regenerar QR")])):(w(),o("div",FN,[a[37]||(a[37]=r("p",null,"Esta mesa aún no tiene un código QR.",-1)),r("button",{class:"btn btn-primary mt-3",onClick:Z},"Generar QR")]))])):(w(),o("div",qN,a[38]||(a[38]=[r("p",null,"Selecciona una mesa para ver su código QR",-1)])))])])):(w(),o("div",BN,[a[46]||(a[46]=r("div",{class:"row mb-3"},[r("div",{class:"col-12 d-flex flex-column align-items-start justify-content-start"},[r("h2",null,"Menús"),r("p",{class:"text-left"},"Administra tus menús para que tus clientes puedan escanearlos y verlos en su mesa.")])],-1)),i.value?(w(),o("div",jN,[(w(),o(_,null,k(6,e=>p(lN,{key:e})),64))])):(w(),o("div",$N,[(w(!0),o(_,null,k(y.value,e=>(w(),o("div",{key:e.id,class:C(["menu-card",{default:e.isDefault,processing:D.value===e.id}]),onClick:t=>{return a=e.id,void(R.value=R.value===a?null:a);var a}},[r("div",VN,[a[39]||(a[39]=r("div",{class:"menu-cover"},null,-1)),r("div",WN,[r("span",HN,c(e.name),1),e.isDefault?(w(),o("span",GN,"PREDETERMINADO")):l("",!0)])]),r("div",{class:C(["menu-actions",{show:R.value===e.id}]),onClick:a[9]||(a[9]=d(()=>{},["stop"]))},[e.isPredefined?l("",!0):(w(),o("button",{key:0,onClick:a=>(async e=>{D.value=e.id;try{await t.setDefaultMenu(e.id),ir("Menú predeterminado actualizado"),R.value=null}catch(a){sr(a.message||"Error al establecer menú predeterminado")}finally{D.value=null}})(e),class:"action-item"},a[40]||(a[40]=[r("span",{class:"action-icon select"},[r("i",{class:"bi bi-check-lg"})],-1),r("span",{class:"action-label"},"Seleccionar",-1)]),8,KN)),r("button",{onClick:a=>(async e=>{const a=await t.previewMenu(e.id);a&&window.open(a,"_blank")})(e),class:"action-item"},a[41]||(a[41]=[r("span",{class:"action-icon view"},[r("i",{class:"bi bi-eye-fill"})],-1),r("span",{class:"action-label"},"Ver",-1)]),8,JN),r("button",{onClick:a=>(async e=>{const{value:a}=await ar.fire({title:"Nuevo nombre",input:"text",inputValue:e.name,showCancelButton:!0});if(a&&a!==e.name){D.value=e.id;try{await t.renameMenu(e.id,a),ir("Nombre cambiado"),R.value=null}catch(n){sr(n.message||"Error al renombrar menú")}finally{D.value=null}}})(e),class:"action-item"},a[42]||(a[42]=[r("span",{class:"action-icon rename"},[r("i",{class:"bi bi-pencil-fill"})],-1),r("span",{class:"action-label"},"Renombrar",-1)]),8,YN),r("button",{onClick:t=>(async e=>{D.value=e.id;try{const t=await fa.get(`/menus/${e.id}/download`,{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=a;const i=t.headers["content-disposition"];let s=`${e.name}.pdf`;if(i){const e=i.match(/filename="(.+)"/);e&&2===e.length&&(s=e[1])}n.setAttribute("download",s),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(a),R.value=null}catch(t){sr(t.message||"Error al descargar el archivo.")}finally{D.value=null}})(e),class:"action-item"},a[43]||(a[43]=[r("span",{class:"action-icon download"},[r("i",{class:"bi bi-download"})],-1),r("span",{class:"action-label"},"Descargar",-1)]),8,QN),e.isPredefined?l("",!0):(w(),o("button",{key:1,onClick:a=>(async e=>{if(e.isPredefined)return void sr("No puedes eliminar el menú predeterminado.");if((await ar.fire({title:`¿Eliminar "${e.name}"?`,text:"Esta acción es irreversible",icon:"warning",showCancelButton:!0})).isConfirmed){D.value=e.id;try{await t.deleteMenu(e.id),ir("Menú eliminado"),R.value=null}catch(a){sr(a.message||"Error al eliminar el menú")}finally{D.value=null}}})(e),class:"action-item"},a[44]||(a[44]=[r("span",{class:"action-icon delete"},[r("i",{class:"bi bi-trash-fill"})],-1),r("span",{class:"action-label"},"Eliminar",-1)]),8,ZN))],2),D.value===e.id?(w(),o("div",XN,a[45]||(a[45]=[r("div",{class:"loading-spinner-small"},null,-1)]))):l("",!0)],10,zN))),128)),r("div",{class:"add-menu-card w-100",onClick:X}," ＋ Agregar menú (PDF) "),r("div",{class:"debug-menu-card w-100",onClick:ee}," 🐛 DEBUG Upload Test ")]))]))]),p(iN,{modelValue:T.value,"onUpdate:modelValue":a[10]||(a[10]=e=>T.value=e),title:"Nueva mesa",label:"Número de la mesa",placeholder:"Ej: 5","input-type":"number",onConfirm:Y},null,8,["modelValue"]),p($E,{modelValue:A.value,"onUpdate:modelValue":a[14]||(a[14]=e=>A.value=e),title:"Editar Mesa"},{footer:f(()=>[r("button",{class:"btn btn-secondary",onClick:a[13]||(a[13]=e=>A.value=!1)},"Cancelar"),r("button",{class:"btn btn-primary",onClick:Q},"Guardar Cambios")]),default:f(()=>[r("div",eP,[r("div",tP,[a[47]||(a[47]=r("label",{for:"edit-table-number"},"Número de la mesa:",-1)),u(r("input",{id:"edit-table-number","onUpdate:modelValue":a[11]||(a[11]=e=>x.value.number=e),type:"number",class:"form-control",min:"1"},null,512),[[h,x.value.number,void 0,{number:!0}]])]),r("div",aP,[a[48]||(a[48]=r("label",{for:"edit-table-name"},"Nombre personalizado (opcional):",-1)),u(r("input",{id:"edit-table-name","onUpdate:modelValue":a[12]||(a[12]=e=>x.value.name=e),type:"text",class:"form-control",placeholder:"Ej: Mesa VIP, Mesa Terraza..."},null,512),[[h,x.value.name]])])])]),_:1},8,["modelValue"]),p($E,{modelValue:L.value,"onUpdate:modelValue":a[17]||(a[17]=e=>L.value=e),title:"Exportar Códigos QR"},{footer:f(()=>[r("button",{class:"btn btn-secondary",onClick:a[16]||(a[16]=e=>L.value=!1)},"Cancelar"),r("button",{class:"btn btn-primary",onClick:ae},"Descargar")]),default:f(()=>[r("div",nP,[a[51]||(a[51]=r("p",null,"Selecciona el formato en el que deseas descargar los códigos QR.",-1)),r("div",iP,[a[50]||(a[50]=r("label",{for:"format-select"},"Formato:",-1)),u(r("select",{id:"format-select","onUpdate:modelValue":a[15]||(a[15]=e=>M.value=e),class:"form-control"},a[49]||(a[49]=[r("option",{value:"pdf"},"PDF",-1),r("option",{value:"png"},"PNG",-1),r("option",{value:"svg"},"SVG",-1),r("option",{value:"zip"},"ZIP (PNGs comprimidos)",-1)]),512),[[P,M.value]])])])]),_:1},8,["modelValue"]),p($E,{modelValue:B.value,"onUpdate:modelValue":a[23]||(a[23]=e=>B.value=e),title:"Enviar Códigos QR por Email"},{footer:f(()=>[r("button",{class:"btn btn-secondary",onClick:a[22]||(a[22]=e=>B.value=!1)},"Cancelar"),r("button",{class:"btn btn-primary",onClick:ie},"Enviar")]),default:f(()=>[r("div",sP,[r("div",oP,[a[52]||(a[52]=r("label",{for:"recipients-input"},"Destinatarios (separa correos con coma):",-1)),u(r("input",{id:"recipients-input","onUpdate:modelValue":a[18]||(a[18]=e=>$.value=e),type:"text",class:"form-control",placeholder:"ej: correo@dominio.com, otro@dominio.com"},null,512),[[h,$.value]])]),r("div",rP,[a[53]||(a[53]=r("label",{for:"subject-input"},"Asunto:",-1)),u(r("input",{id:"subject-input","onUpdate:modelValue":a[19]||(a[19]=e=>z.value=e),type:"text",class:"form-control"},null,512),[[h,z.value]])]),r("div",lP,[a[54]||(a[54]=r("label",{for:"body-input"},"Mensaje:",-1)),u(r("textarea",{id:"body-input","onUpdate:modelValue":a[20]||(a[20]=e=>V.value=e),class:"form-control",rows:"3"},null,512),[[h,V.value]])]),r("div",cP,[a[56]||(a[56]=r("label",{for:"email-format-select"},"Formato:",-1)),u(r("select",{id:"email-format-select","onUpdate:modelValue":a[21]||(a[21]=e=>j.value=e),class:"form-control"},a[55]||(a[55]=[r("option",{value:"pdf"},"PDF",-1),r("option",{value:"png"},"PNG",-1)]),512),[[P,j.value]])])])]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-4ea07d37"]]),uP={class:"stats-container"};const hP=Lh({},[["render",function(e,t){return w(),o("div",uP,t[0]||(t[0]=[r("div",{class:"coming-soon-container"},[r("i",{class:"bi bi-bar-chart-line-fill icon"}),r("h1",null,"Estadísticas"),r("p",null,"Esta sección estará disponible próximamente."),r("p",null,"Estamos trabajando para ofrecerte los mejores análisis para tu negocio.")],-1)]))}],["__scopeId","data-v-29de642f"]]),pP={class:"request-card"},mP={class:"requester-info"},fP=["src","alt"],vP={class:"text-info"},gP={class:"name"},bP={class:"email"},wP={key:0,class:"phone"},yP={class:"profile-details"},_P={key:0,class:"experience"},kP={key:1,class:"schedule"},CP={key:2,class:"employment"},EP={key:1,class:"skills"},IP={key:2,class:"bio"},SP={class:"actions"},TP=["title"],NP={__name:"RequestCard",props:{request:{type:Object,required:!0},isArchived:{type:Boolean,default:!1}},emits:["confirm","archive","reject","unarchive","invite"],setup:(e,{emit:t})=>(t,a)=>{var n,i,s,u,h,p,m,f,v,b,y,C,E,I,S;return w(),o("div",pP,[e.isArchived?l("",!0):(w(),o("button",{key:0,class:"close-button",onClick:a[0]||(a[0]=d(a=>t.$emit("reject",e.request),["stop"]))},a[6]||(a[6]=[r("i",{class:"bi bi-x"},null,-1)]))),r("div",mP,[r("img",{src:(null==(n=e.request.user_profile)?void 0:n.avatar)||"/default-avatar.png",alt:`Avatar de ${(null==(i=e.request.user)?void 0:i.name)||(null==(s=e.request.user_profile)?void 0:s.display_name)}`,class:"avatar"},null,8,fP),r("div",vP,[r("h4",gP,c((null==(u=e.request.user)?void 0:u.name)||(null==(h=e.request.user_profile)?void 0:h.display_name)),1),r("p",bP,c(null==(p=e.request.user)?void 0:p.email),1),(null==(m=e.request.user_profile)?void 0:m.phone)?(w(),o("p",wP,c(e.request.user_profile.phone),1)):l("",!0),r("div",yP,[(null==(f=e.request.user_profile)?void 0:f.experience_years)?(w(),o("p",_P,[a[7]||(a[7]=r("i",{class:"bi bi-briefcase"},null,-1)),g(" "+c(e.request.user_profile.experience_years)+" años de experiencia ",1)])):l("",!0),(null==(v=e.request.user_profile)?void 0:v.current_schedule)?(w(),o("p",kP,[a[8]||(a[8]=r("i",{class:"bi bi-clock"},null,-1)),g(" "+c(e.request.user_profile.current_schedule),1)])):l("",!0),(null==(b=e.request.user_profile)?void 0:b.employment_type)?(w(),o("p",CP,[a[9]||(a[9]=r("i",{class:"bi bi-person-badge"},null,-1)),g(" "+c(e.request.user_profile.employment_type),1)])):l("",!0)]),(null==(C=null==(y=e.request.user_profile)?void 0:y.skills)?void 0:C.length)?(w(),o("div",EP,[(w(!0),o(_,null,k(e.request.user_profile.skills,e=>(w(),o("span",{class:"skill-tag",key:e},c(e),1))),128))])):l("",!0),(null==(E=e.request.user_profile)?void 0:E.bio)?(w(),o("p",IP,c(e.request.user_profile.bio),1)):l("",!0)])]),r("div",SP,[e.isArchived?(w(),o("button",{key:1,class:"btn btn-primary",onClick:a[5]||(a[5]=d(a=>t.$emit("unarchive",e.request),["stop"]))},a[14]||(a[14]=[r("i",{class:"bi bi-arrow-counterclockwise"},null,-1),g(" Desarchivar ")]))):(w(),o(_,{key:0},[r("button",{class:"btn btn-primary",onClick:a[1]||(a[1]=d(a=>t.$emit("confirm",e.request),["stop"]))},a[10]||(a[10]=[r("i",{class:"bi bi-check-lg"},null,-1),g(" Confirmar ")])),r("button",{class:"btn btn-info",onClick:a[2]||(a[2]=d(a=>t.$emit("invite",e.request),["stop"])),title:"Enviar invitación a "+((null==(I=e.request.user)?void 0:I.name)||(null==(S=e.request.user_profile)?void 0:S.display_name))},a[11]||(a[11]=[r("i",{class:"bi bi-envelope"},null,-1),g(" Invitar ")]),8,TP),r("button",{class:"btn btn-secondary",onClick:a[3]||(a[3]=d(a=>t.$emit("archive",e.request),["stop"]))},a[12]||(a[12]=[r("i",{class:"bi bi-archive"},null,-1),g(" Archivar ")])),r("button",{class:"btn btn-danger",onClick:a[4]||(a[4]=d(a=>t.$emit("reject",e.request),["stop"]))},a[13]||(a[13]=[r("i",{class:"bi bi-x-lg"},null,-1),g(" Rechazar ")]))],64))])])}},PP=Lh(NP,[["__scopeId","data-v-f3cb5e00"]]),AP={class:"staff-avatar"},xP=["src","alt"],RP={class:"employee-name"},DP={key:0,class:"employee-email"},OP={class:"staff-info"},LP={key:0,class:"profile-details"},MP={key:0,class:"detail-item"},UP={key:1,class:"detail-item"},FP={key:2,class:"detail-item"},qP={class:"rating-container"},BP={class:"stars"},jP={class:"comments-count"},$P={__name:"StaffCard",props:{employee:{type:Object,required:!0}},emits:["view","remove"],setup(e,{emit:t}){const a=e,n=t,i=()=>{n("view",a.employee)},s=e=>{e.stopPropagation(),n("remove",a.employee)};return(t,a)=>{var n,d,u,h,p,m,f,v,g,b,y,E,I,S;return w(),o("div",{class:"staff-card",onClick:i},[r("button",{class:"remove-button",onClick:s},a[0]||(a[0]=[r("i",{class:"bi bi-x"},null,-1)])),r("div",AP,[r("img",{src:(null==(d=null==(n=e.employee.user)?void 0:n.user_profile)?void 0:d.avatar)||(null==(h=null==(u=e.employee.user)?void 0:u.user_profile)?void 0:h.avatar_url)||"https://randomuser.me/api/portraits/men/32.jpg",alt:(null==(p=e.employee.user)?void 0:p.name)||(null==(f=null==(m=e.employee.user)?void 0:m.user_profile)?void 0:f.display_name),class:"avatar-image"},null,8,xP)]),r("h3",RP,c((null==(v=e.employee.user)?void 0:v.name)||(null==(b=null==(g=e.employee.user)?void 0:g.user_profile)?void 0:b.display_name)),1),(null==(y=e.employee.user)?void 0:y.email)?(w(),o("p",DP,c(e.employee.user.email),1)):l("",!0),r("div",OP,[(null==(E=e.employee.user)?void 0:E.user_profile)?(w(),o("div",LP,[e.employee.user.user_profile.experience_years?(w(),o("div",MP,[a[1]||(a[1]=r("i",{class:"bi bi-briefcase"},null,-1)),r("span",null,c(e.employee.user.user_profile.experience_years)+" años",1)])):l("",!0),e.employee.user.user_profile.current_schedule?(w(),o("div",UP,[a[2]||(a[2]=r("i",{class:"bi bi-clock"},null,-1)),r("span",null,c(e.employee.user.user_profile.current_schedule),1)])):l("",!0),e.employee.user.user_profile.employment_type?(w(),o("div",FP,[a[3]||(a[3]=r("i",{class:"bi bi-person-badge"},null,-1)),r("span",null,c(e.employee.user.user_profile.employment_type),1)])):l("",!0)])):l("",!0),r("div",qP,[r("div",BP,[(w(),o(_,null,k(5,t=>{var a,n;return r("i",{key:t,class:C(["bi",t<=Math.round((null==(n=null==(a=e.employee.user)?void 0:a.user_profile)?void 0:n.rating)||0)?"bi-star-fill":"bi-star"])},null,2)}),64))]),r("div",jP,[a[4]||(a[4]=r("i",{class:"bi bi-chat-left-text"},null,-1)),r("span",null,c((null==(S=null==(I=e.employee.user)?void 0:I.user_profile)?void 0:S.total_reviews)||0)+" comentarios",1)])])])])}}},zP=Lh($P,[["__scopeId","data-v-6de59a5a"]]),VP={class:"staff-card-skeleton"},WP={class:"avatar-skeleton"},HP={class:"info-skeleton"},GP={__name:"StaffCardSkeleton",setup:e=>(e,t)=>(w(),o("div",VP,[r("div",WP,[p(sN,{width:"64px",height:"64px",borderRadius:"50%"})]),r("div",HP,[p(sN,{width:"60%",height:"1.2rem",borderRadius:"4px"}),p(sN,{width:"40%",height:"1rem",borderRadius:"4px",style:{"margin-top":"8px"}})])]))},KP=Lh(GP,[["__scopeId","data-v-77a45dbe"]]),JP={class:"request-card-skeleton"},YP={class:"info-skeleton"},QP={class:"actions-skeleton"},ZP={__name:"RequestCardSkeleton",setup:e=>(e,t)=>(w(),o("div",JP,[r("div",YP,[p(sN,{width:"50%",height:"1.1rem",borderRadius:"4px"}),p(sN,{width:"30%",height:"0.9rem",borderRadius:"4px",style:{"margin-top":"8px"}})]),r("div",QP,[p(sN,{width:"40px",height:"40px",borderRadius:"50%"}),p(sN,{width:"40px",height:"40px",borderRadius:"50%"})])]))},XP=Lh(ZP,[["__scopeId","data-v-8e0a7703"]]),eA={class:"staff-page"},tA={class:"page-header"},aA={key:0,class:"header-stats"},nA={class:"stat-item"},iA={class:"stat-value"},sA={class:"stat-item"},oA={class:"stat-value"},rA={key:0,class:"loading-container"},lA={key:1,class:"error-container"},cA={class:"error-message"},dA={key:2,class:"staff-content"},uA={class:"staff-section"},hA={class:"section-header"},pA={class:"section-title"},mA={key:0,class:"badge bg-primary rounded-pill"},fA={key:0,class:"section-actions"},vA={key:0,class:"requests-list"},gA={key:1},bA={key:0,class:"text-center p-4 text-muted"},wA={key:1,class:"requests-list"},yA={class:"staff-section"},_A={class:"section-header"},kA={key:0,class:"staff-grid"},CA={key:1,class:"staff-grid"},EA={key:0},IA={key:2,class:"pagination-container"},SA=["disabled"],TA=["disabled"],NA={class:"invite-form"},PA={class:"form-group"},AA={class:"form-group"},xA=["disabled"],RA={key:0},DA={key:1},OA=["disabled"],LA={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},MA={__name:"Staff",setup(e){const t=b(),i=gE(),d=a(!1),m=a(""),v=n(()=>i.staff),y=n(()=>i.staffRequests),C=n(()=>i.archivedRequests),E=a(!1),I=a(!1);a(!1),a(!1);const S=a(null);a(null);const N=a(""),A=a(""),x=a("waiter"),R=a(!1),D=n(()=>i.staffLinks),O=n(()=>i.staffMeta),L=n(()=>{if(!v.value.length)return[];let e=[...v.value];if(N.value){const t=N.value.toLowerCase();e=e.filter(e=>{var a,n,i,s,o,r,l,c,d,u,h,p,m;return(null==(n=null==(a=e.user)?void 0:a.name)?void 0:n.toLowerCase().includes(t))||(null==(s=null==(i=e.user)?void 0:i.email)?void 0:s.toLowerCase().includes(t))||(null==(l=null==(r=null==(o=e.user)?void 0:o.user_profile)?void 0:r.display_name)?void 0:l.toLowerCase().includes(t))||(null==(u=null==(d=null==(c=e.user)?void 0:c.user_profile)?void 0:d.bio)?void 0:u.toLowerCase().includes(t))||(null==(m=null==(p=null==(h=e.user)?void 0:h.user_profile)?void 0:p.employment_type)?void 0:m.toLowerCase().includes(t))})}return e}),M=n(()=>R.value?C.value:y.value),U=n(()=>{if(!v.value.length)return{total:0,avgRating:0};const e=v.value.length;return{total:e,avgRating:(v.value.reduce((e,t)=>{var a,n;return e+((null==(n=null==(a=t.user)?void 0:a.user_profile)?void 0:n.rating)||0)},0)/e).toFixed(1)}});s(async()=>{d.value=!0,m.value="";try{await Promise.all([i.fetchStaff(),i.fetchStaffRequests(),i.fetchArchivedRequests()])}catch(e){m.value=e.message||"Error al cargar datos de personal"}finally{d.value=!1}});const F=async()=>{if(A.value&&x.value){d.value=!0,m.value="";try{(await i.inviteStaff({email:A.value,role:x.value,position:"waiter"===x.value?"Mozo":x.value})).invitation_url?ir(`Invitación enviada a ${A.value}. Se ha enviado un enlace por email.`):ir(`Invitación creada para ${A.value}`),A.value="",x.value="waiter",E.value=!1}catch(e){m.value=e.message||"Error al enviar invitación"}finally{d.value=!1}}else m.value="Por favor, completa todos los campos"},q=async e=>{var t,a;d.value=!0,m.value="";try{const n=e.id;if(!n)throw console.error("Request object:",e),new Error("ID de solicitud no encontrado");const s={hire_date:(new Date).toISOString().split("T")[0],notes:"Aprobado desde panel de administración"};await i.approveStaffRequest(n,s),ir(`Solicitud de ${(null==(t=e.user)?void 0:t.name)||(null==(a=e.user_profile)?void 0:a.display_name)} aprobada exitosamente`)}catch(n){m.value=n.message||"Error al confirmar solicitud"}finally{d.value=!1}},B=async e=>{d.value=!0,m.value="";try{const t=e.id;if(!t)throw console.error("Request object:",e),new Error("ID de solicitud no encontrado");await i.handleStaffRequest(t,"archive")}catch(t){m.value=t.message||"Error al archivar solicitud"}finally{d.value=!1}},j=async e=>{d.value=!0,m.value="";try{const t=e.id;if(!t)throw console.error("Request object:",e),new Error("ID de solicitud archivada no encontrado");console.log("Unarchiving request with ID:",t),await i.handleStaffRequest(t,"unarchive")}catch(t){console.error("Error unarchiving request:",t),m.value=t.message||"Error al desarchivar solicitud"}finally{d.value=!1}},$=async e=>{var t,a;d.value=!0,m.value="";try{const n=e.id;if(!n)throw console.error("Request object:",e),new Error("ID de solicitud no encontrado");const s={notes:"Rechazado desde panel de administración"};await i.rejectStaffRequest(n,s),ir(`Solicitud de ${(null==(t=e.user)?void 0:t.name)||(null==(a=e.user_profile)?void 0:a.display_name)} rechazada`)}catch(n){m.value=n.message||"Error al rechazar solicitud"}finally{d.value=!1}},z=async()=>{if(y.value.length){d.value=!0,m.value="";try{const e={hire_date:(new Date).toISOString().split("T")[0],notes:"Aprobación masiva desde panel de administración"};for(const t of y.value){const a=t.id;a&&await i.approveStaffRequest(a,e)}ir(`${y.value.length} solicitudes aprobadas exitosamente`)}catch(e){m.value=e.message||"Error al confirmar todas las solicitudes"}finally{d.value=!1}}},V=async e=>{var t,a,n,s;d.value=!0,m.value="";try{const o=e.id;if(!o)throw console.error("Request object:",e),new Error("ID de solicitud no encontrado");(await i.inviteStaffMember(o)).invitation_url?ir(`Invitación enviada a ${(null==(t=e.user)?void 0:t.name)||(null==(a=e.user_profile)?void 0:a.display_name)}. Se ha enviado el enlace por email/WhatsApp.`):ir(`Token de invitación generado para ${(null==(n=e.user)?void 0:n.name)||(null==(s=e.user_profile)?void 0:s.display_name)}`)}catch(o){m.value=o.message||"Error al enviar invitación"}finally{d.value=!1}},W=async()=>{if(y.value.length){d.value=!0,m.value="";try{for(const e of y.value){const t=e.id;t&&await i.handleStaffRequest(t,"archive")}}catch(e){m.value=e.message||"Error al archivar todas las solicitudes"}finally{d.value=!1}}},H=e=>{S.value=e,I.value=!0},G=async()=>{var e;if(S.value){d.value=!0,m.value="";try{const t=S.value.staff_id||(null==(e=S.value.user)?void 0:e.id);if(!t)throw new Error("ID de empleado no encontrado");await i.removeStaff(t),I.value=!1,S.value=null}catch(t){m.value=t.message||"Error al eliminar miembro del personal"}finally{d.value=!1}}},K=()=>{R.value=!R.value},J=e=>{var a;const n=e.staff_id||(null==(a=e.user)?void 0:a.id);t.push("/admin/staff/"+n)},Y=()=>{E.value=!0},Q=async()=>{D.value.next&&(d.value=!0,await i.fetchStaff(D.value.next),d.value=!1)},Z=async()=>{D.value.prev&&(d.value=!0,await i.fetchStaff(D.value.prev),d.value=!1)};return(e,t)=>(w(),o("div",eA,[r("div",tA,[t[11]||(t[11]=r("h1",{class:"page-title"},"Gestión de Personal",-1)),!d.value&&v.value.length>0?(w(),o("div",aA,[r("div",nA,[r("span",iA,c(U.value.total),1),t[8]||(t[8]=r("span",{class:"stat-label"},"Total",-1))]),r("div",sA,[r("span",oA,c(U.value.avgRating),1),t[9]||(t[9]=r("span",{class:"stat-label"},"Rating promedio",-1))])])):l("",!0),p(LE,{onClick:Y,variant:"primary",icon:"fas fa-plus"},{default:f(()=>t[10]||(t[10]=[g(" Invitar Personal ")])),_:1,__:[10]})]),d.value?(w(),o("div",rA,t[12]||(t[12]=[r("div",{class:"spinner"},null,-1),r("p",null,"Cargando personal...",-1)]))):m.value?(w(),o("div",lA,[r("p",cA,c(m.value),1),p(LE,{onClick:t[0]||(t[0]=t=>e.$router.go(0)),variant:"primary"},{default:f(()=>t[13]||(t[13]=[g(" Reintentar ")])),_:1,__:[13]})])):(w(),o("div",dA,[r("section",uA,[r("div",hA,[r("div",null,[r("h2",pA,[g(c(R.value?"Solicitudes Archivadas":"Solicitudes Pendientes")+" ",1),!R.value&&y.value.length?(w(),o("span",mA,c(y.value.length),1)):l("",!0)])]),R.value?l("",!0):(w(),o("div",fA,[p(LE,{onClick:W,size:"sm",disabled:!y.value.length},{default:f(()=>t[14]||(t[14]=[g("Archivar Todo")])),_:1,__:[14]},8,["disabled"]),p(LE,{onClick:z,size:"sm",variant:"success",disabled:!y.value.length},{default:f(()=>t[15]||(t[15]=[g("Confirmar Todo")])),_:1,__:[15]},8,["disabled"])]))]),d.value?(w(),o("div",vA,[(w(),o(_,null,k(3,e=>p(XP,{key:e})),64))])):(w(),o("div",gA,[M.value.length?(w(),o("div",wA,[(w(!0),o(_,null,k(M.value,e=>(w(),T(PP,{key:e.id,request:e,"is-archived":R.value,onConfirm:q,onInvite:V,onArchive:B,onUnarchive:j,onReject:$},null,8,["request","is-archived"]))),128))])):(w(),o("div",bA,t[16]||(t[16]=[r("p",null,"No hay solicitudes para mostrar.",-1)])))])),p(LE,{onClick:K,size:"sm",class:"mt-3"},{default:f(()=>[g(c(R.value?"Ver Pendientes":"Ver Archivadas"),1)]),_:1})]),r("section",yA,[r("div",_A,[t[17]||(t[17]=r("h2",{class:"section-title"},"Tu Personal",-1)),u(r("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>N.value=e),class:"search-input",placeholder:"Buscar personal..."},null,512),[[h,N.value]])]),d.value?(w(),o("div",kA,[(w(),o(_,null,k(4,e=>p(KP,{key:e})),64))])):(w(),o("div",CA,[L.value.length?l("",!0):(w(),o("p",EA,"No se encontró personal.")),(w(!0),o(_,null,k(L.value,e=>(w(),T(zP,{key:e.id,employee:e,onRemove:H,onView:J},null,8,["employee"]))),128))])),O.value.last_page>1?(w(),o("div",IA,[r("button",{class:"pagination-button",disabled:!D.value.prev,onClick:Z},"Anterior",8,SA),r("span",null,c(O.value.current_page)+" / "+c(O.value.last_page),1),r("button",{class:"pagination-button",disabled:!D.value.next,onClick:Q},"Siguiente",8,TA)])):l("",!0)])])),p($E,{modelValue:E.value,"onUpdate:modelValue":t[5]||(t[5]=e=>E.value=e),title:"Invitar Personal",size:"md"},{footer:f(()=>[r("button",{class:"btn btn-secondary",onClick:t[4]||(t[4]=e=>E.value=!1)}," Cancelar "),r("button",{class:"btn btn-primary",onClick:F,disabled:!A.value||d.value},[d.value?(w(),o("span",RA,"Enviando...")):(w(),o("span",DA,"Enviar invitación"))],8,xA)]),default:f(()=>[r("div",NA,[r("div",PA,[t[18]||(t[18]=r("label",{for:"invite-email"},"Correo electrónico",-1)),u(r("input",{id:"invite-email",type:"email","onUpdate:modelValue":t[2]||(t[2]=e=>A.value=e),placeholder:"Ingresa el correo electrónico",class:"form-control"},null,512),[[h,A.value]])]),r("div",AA,[t[20]||(t[20]=r("label",{for:"invite-role"},"Cargo",-1)),u(r("select",{id:"invite-role","onUpdate:modelValue":t[3]||(t[3]=e=>x.value=e),class:"form-control"},t[19]||(t[19]=[r("option",{value:"waiter"},"Mozo",-1),r("option",{value:"kitchen"},"Cocinero",-1),r("option",{value:"cashier"},"Cajero",-1),r("option",{value:"manager"},"Gerente",-1),r("option",{value:"cleaning"},"Limpieza",-1)]),512),[[P,x.value]])])])]),_:1},8,["modelValue"]),p($E,{modelValue:I.value,"onUpdate:modelValue":t[7]||(t[7]=e=>I.value=e),title:"Desvincular empleado",size:"sm"},{footer:f(()=>[r("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=e=>I.value=!1)}," Cancelar "),r("button",{class:"btn btn-danger",onClick:G,disabled:d.value},[d.value?(w(),o("span",LA)):l("",!0),t[21]||(t[21]=g(" Desvincular "))],8,OA)]),default:f(()=>{var e,a,n,i,s;return[r("p",null,"¿Estás seguro de que deseas desvincular a "+c((null==(a=null==(e=S.value)?void 0:e.user)?void 0:a.name)||(null==(s=null==(i=null==(n=S.value)?void 0:n.user)?void 0:i.user_profile)?void 0:s.display_name))+"?",1),t[22]||(t[22]=r("p",{class:"warning-text"},"Esta acción no se puede deshacer.",-1))]}),_:1,__:[22]},8,["modelValue"])]))}},UA=Lh(MA,[["__scopeId","data-v-75ee98d0"]]),FA={class:"review-card"},qA={class:"review-header"},BA={class:"reviewer-info"},jA=["src","alt"],$A={class:"reviewer-name"},zA={class:"review-rating"},VA={class:"stars-container"},WA={class:"rating-value"},HA={class:"review-text"},GA={class:"review-footer"},KA={key:0,class:"review-date"},JA={__name:"ReviewCard",props:{review:{type:Object,required:!0},canDelete:{type:Boolean,default:!1}},emits:["delete"],setup(e,{emit:t}){const n=e,i=t,s=a(!1),d=()=>{s.value=!0},u=()=>{i("delete",n.review.id),s.value=!1},h=e=>{if(!e)return"";return new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})};return(t,a)=>{var n,i,p;return w(),o("div",FA,[r("div",qA,[r("div",BA,[r("img",{src:null==(n=e.review.reviewer)?void 0:n.avatar,alt:null==(i=e.review.reviewer)?void 0:i.name,class:"reviewer-avatar"},null,8,jA),r("h3",$A,c(null==(p=e.review.reviewer)?void 0:p.name),1)]),r("div",zA,[r("div",VA,[(w(),o(_,null,k(5,t=>r("i",{key:t,class:C(["bi",t<=e.review.rating?"bi-star-fill":"bi-star"])},null,2)),64))]),r("span",WA,c(e.review.rating),1)]),e.canDelete?(w(),o("button",{key:0,class:"delete-button",onClick:d,"aria-label":"Eliminar reseña"},a[2]||(a[2]=[r("i",{class:"bi bi-trash"},null,-1)]))):l("",!0)]),r("p",HA,c(e.review.comment),1),r("div",GA,[e.review.date?(w(),o("span",KA,c(h(e.review.date)),1)):l("",!0)]),s.value?(w(),T($E,{key:0,modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value=e),title:"Eliminar reseña",size:"sm"},{footer:f(()=>[r("button",{class:"btn btn-secondary",onClick:a[0]||(a[0]=e=>s.value=!1)}," Cancelar "),r("button",{class:"btn btn-danger",onClick:u}," Eliminar ")]),default:f(()=>[a[3]||(a[3]=r("p",null,"¿Estás seguro de que deseas eliminar esta reseña?",-1)),a[4]||(a[4]=r("p",{class:"warning-text"},"Esta acción no se puede deshacer.",-1))]),_:1,__:[3,4]},8,["modelValue"])):l("",!0)])}}},YA=Lh(JA,[["__scopeId","data-v-99cedcd8"]]),QA={class:"base-input-wrapper"},ZA={key:0,class:"base-input-label"},XA={key:0,class:"required-indicator"},ex=["type","value","placeholder","disabled","required","autocomplete","name"],tx={key:1,class:"base-input-error-message"},ax={__name:"BaseInput",props:{modelValue:{type:[String,Number],default:""},label:{type:String,default:""},placeholder:{type:String,default:""},type:{type:String,default:"text"},error:{type:String,default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},autocomplete:{type:String,default:"off"},name:{type:String,default:""}},emits:["update:modelValue","focus","blur"],setup(e,{emit:t}){const i=e,s=t,d=a(i.modelValue),u=a(!1);S(()=>i.modelValue,e=>{d.value=e});const h=e=>{const t=e.target.value;d.value=t,s("update:modelValue",t)},p=e=>{u.value=!0,s("focus",e)},m=e=>{u.value=!1,s("blur",e)},f=n(()=>["base-input",{"base-input-disabled":i.disabled},{"base-input-error":i.error},{"base-input-focused":u.value}]);return(t,a)=>(w(),o("div",QA,[e.label?(w(),o("label",ZA,[g(c(e.label)+" ",1),e.required?(w(),o("span",XA,"*")):l("",!0)])):l("",!0),r("input",{type:e.type,value:d.value,placeholder:e.placeholder,disabled:e.disabled,required:e.required,autocomplete:e.autocomplete,name:e.name,class:C(f.value),onInput:h,onFocus:p,onBlur:m},null,42,ex),e.error?(w(),o("p",tx,c(e.error),1)):l("",!0)]))}},nx=Lh(ax,[["__scopeId","data-v-da9b847d"]]),ix={class:"form-group"},sx={class:"form-group"},ox={__name:"SendNotificationModal",props:{modelValue:Boolean,loading:Boolean},emits:["update:modelValue","submit"],setup(e,{emit:t}){const i=t,s=a({title:"",body:""}),o=n(()=>""!==s.value.title.trim()&&""!==s.value.body.trim()),l=()=>{o.value&&i("submit",{...s.value})};return(t,a)=>(w(),T($E,{"model-value":e.modelValue,title:"Enviar Notificación","onUpdate:modelValue":a[3]||(a[3]=e=>t.$emit("update:modelValue",e))},{body:f(()=>[r("form",{onSubmit:d(l,["prevent"]),class:"send-notification-form"},[r("div",ix,[a[4]||(a[4]=r("label",{for:"title"},"Título",-1)),p(nx,{id:"title",modelValue:s.value.title,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value.title=e),placeholder:"Ej: Recordatorio de reunión",required:""},null,8,["modelValue"])]),r("div",sx,[a[5]||(a[5]=r("label",{for:"body"},"Mensaje",-1)),u(r("textarea",{id:"body","onUpdate:modelValue":a[1]||(a[1]=e=>s.value.body=e),rows:"4",placeholder:"Escribe aquí el mensaje de la notificación...",required:"",class:"textarea-input"},null,512),[[h,s.value.body]])])],32)]),footer:f(()=>[p(LE,{onClick:a[2]||(a[2]=e=>t.$emit("update:modelValue",!1)),variant:"secondary"},{default:f(()=>a[6]||(a[6]=[g(" Cancelar ")])),_:1,__:[6]}),p(LE,{onClick:l,loading:e.loading,disabled:!o.value},{default:f(()=>a[7]||(a[7]=[g(" Enviar ")])),_:1,__:[7]},8,["loading","disabled"])]),_:1},8,["model-value"]))}},rx=Lh(ox,[["__scopeId","data-v-a3aa051f"]]),lx={class:"staff-detail-container"},cx={key:0,class:"loading-container"},dx={key:1,class:"error-container"},ux={key:2,class:"staff-detail-content"},hx={class:"profile-card"},px={class:"profile-header"},mx={class:"profile-name-container"},fx={class:"profile-data"},vx={class:"data-row"},gx={key:0,class:"text-muted",style:{"font-size":"0.875rem"}},bx={class:"data-row"},wx={class:"data-row"},yx={class:"data-row"},_x={class:"data-row"},kx={class:"data-row"},Cx={class:"data-row"},Ex={class:"data-row"},Ix={class:"data-row"},Sx={class:"data-row"},Tx={class:"data-row"},Nx={class:"data-row"},Px={class:"data-row"},Ax={class:"data-row"},xx={class:"data-row"},Rx={class:"profile-actions"},Dx={class:"reviews-section d-none"},Ox={class:"reviews-header"},Lx={class:"average-rating"},Mx={class:"stars-container"},Ux={class:"rating-text"},Fx={class:"add-review-buttons"},qx={key:0,class:"empty-reviews"},Bx={key:1,class:"reviews-list"},jx={class:"confirm-content"},$x={class:"confirm-input"},zx=["disabled"],Vx={class:"add-review-form"},Wx={class:"rating-input"},Hx={class:"star-rating"},Gx=["onClick"],Kx={class:"comment-input"},Jx=["disabled"],Yx={key:0},Qx={key:1},Zx=Lh({__name:"StaffDetail",setup(e){const t=y(),d=b(),m=gE(),v=t.params.id,E=a(!1),I=a(""),S=a(null),N=a(!1),P=a(!1),A=a(""),x=a({rating:5,comment:""}),R=a(!1),D=a(!1),O=a(!1),L={experience:"experience_years",seniority:"seniority_years",schedule:"employment_type",currentSchedule:"current_schedule"};s(async()=>{E.value=!0,I.value="";try{const e=await m.fetchStaffMember(v);S.value=e}catch(e){I.value=e.message||"Error al cargar datos del empleado"}finally{E.value=!1}});const M=async()=>{if("DESVINCULAR"===A.value){E.value=!0,I.value="";try{await m.removeStaff(v),d.push("/admin/staff")}catch(e){I.value=e.message||"Error al eliminar al miembro del personal"}finally{E.value=!1,N.value=!1}}},U=async(e,t)=>{if(!S.value)return;if("birth_date"===e){const e=new Date(t),a=new Date;let n=a.getFullYear()-e.getFullYear();const i=a.getMonth()-e.getMonth();if((i<0||0===i&&a.getDate()<e.getDate())&&n--,n<16)return void(I.value="El empleado debe ser mayor de 16 años")}R.value=!0;const a=L[e]||e;try{if(await m.updateStaffMember(v,{[a]:t}),S.value[a]=t,S.value[e]=t,"birth_date"===e){const e=new Date(t).toLocaleDateString("es-ES");S.value.birthdate_formatted=e}if("hire_date"===e){const e=new Date(t).toLocaleDateString("es-ES");S.value.hire_date_formatted=e}}catch(n){I.value=n.message||`Error al actualizar ${e}`}finally{R.value=!1}},F=async e=>{if(S.value)try{R.value=!0,await m.deleteReview(v,e),S.value.reviews=S.value.reviews.filter(t=>t.id!==e)}catch(t){I.value=t.message||"Error al eliminar reseña"}finally{R.value=!1}},q=async()=>{if(S.value&&x.value.comment)try{R.value=!0;const e=await m.addReview(v,x.value);S.value.reviews.push(e),x.value={rating:5,comment:""},P.value=!1}catch(e){I.value=e.message||"Error al agregar reseña"}finally{R.value=!1}},B=()=>{if(S.value&&S.value.phone){const e=S.value.phone.replace(/[^0-9]/g,""),t=encodeURIComponent("Hola, te contacto desde la app MOZO.");window.open(`https://wa.me/${e}?text=${t}`,"_blank")}},j=()=>{if(S.value&&S.value.email){const e=encodeURIComponent("Contacto desde app MOZO"),t=encodeURIComponent("Hola, te contacto desde la app MOZO.");window.open(`mailto:${S.value.email}?subject=${e}&body=${t}`,"_blank")}},$=()=>{d.push("/admin/staff")},z=[{value:"masculino",label:"Masculino"},{value:"femenino",label:"Femenino"},{value:"otro",label:"Otro"}],V=[{value:"Gerente",label:"Gerente"},{value:"Mozo",label:"Mozo"},{value:"Cajero",label:"Cajero"},{value:"Cocinero",label:"Cocinero"},{value:"Limpieza",label:"Limpieza"}],W=[{value:"full-time",label:"Tiempo completo"},{value:"part-time",label:"Medio tiempo"},{value:"hourly",label:"Por horas"},{value:"weekends-only",label:"Solo fines de semana"}],H=()=>{P.value=!0},G=n(()=>{if(!S.value||!S.value.reviews.length)return 0;return(S.value.reviews.reduce((e,t)=>e+t.rating,0)/S.value.reviews.length).toFixed(1)}),K=n(()=>S.value&&S.value.reviews.length?[...S.value.reviews].sort((e,t)=>new Date(t.date)-new Date(e.date)):[]),J=n(()=>{if(!S.value||!S.value.birth_date)return null;const e=new Date(S.value.birth_date),t=new Date;let a=t.getFullYear()-e.getFullYear();const n=t.getMonth()-e.getMonth();return(n<0||0===n&&t.getDate()<e.getDate())&&a--,a}),Y=async e=>{var t,a;O.value=!0;try{const t={user_id:S.value.user.id,title:e.title,body:e.body},a=await va.sendPushToUser(t);ir(a.message||"Notificación enviada con éxito"),D.value=!1}catch(n){sr((null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al enviar la notificación")}finally{O.value=!1}},Q=()=>{N.value=!0};return(e,t)=>(w(),o("div",lx,[r("div",{class:"staff-header"},[r("button",{class:"back-button",onClick:$},t[25]||(t[25]=[r("i",{class:"bi bi-arrow-left"},null,-1),g(" Volver ")]))]),E.value?(w(),o("div",cx,t[26]||(t[26]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"Cargando datos del empleado...",-1)]))):I.value?(w(),o("div",dx,[r("p",null,c(I.value),1),p(LE,{onClick:t[0]||(t[0]=t=>e.$router.go(0)),variant:"primary"},{default:f(()=>t[27]||(t[27]=[g(" Reintentar ")])),_:1,__:[27]})])):S.value?(w(),o("div",ux,[r("div",hx,[r("div",px,[p(xE,{src:S.value.avatar_url,alt:`Foto de ${S.value.name}`,editable:!1},null,8,["src","alt"]),r("div",mx,[p(SE,{value:S.value.name,"onUpdate:value":t[1]||(t[1]=e=>U("name",e)),type:"text",placeholder:"Nombre completo",editable:!1,class:"profile-name"},null,8,["value"])])]),r("div",fx,[r("div",vx,[p(SE,{value:S.value.birth_date,"display-value":S.value.birthdate_formatted,label:"Fecha de nacimiento","onUpdate:value":t[2]||(t[2]=e=>U("birth_date",e)),type:"date",editable:!1},null,8,["value","display-value"]),J.value?(w(),o("div",gx,"Edad: "+c(J.value)+" años",1)):l("",!0)]),r("div",bx,[p(SE,{value:S.value.height,label:"Estatura","onUpdate:value":t[3]||(t[3]=e=>U("height",e)),type:"number",min:1,max:2.5,step:.01,unit:"mt",editable:!1},null,8,["value"])]),r("div",wx,[p(SE,{value:S.value.weight,label:"Peso","onUpdate:value":t[4]||(t[4]=e=>U("weight",e)),type:"number",min:30,max:200,unit:"kg",editable:!1},null,8,["value"])]),r("div",yx,[p(SE,{value:S.value.gender,label:"Sexo","onUpdate:value":t[5]||(t[5]=e=>U("gender",e)),type:"select",options:z,editable:!1},null,8,["value"])]),r("div",_x,[p(SE,{value:S.value.experience_years,label:"Años de experiencia","onUpdate:value":t[6]||(t[6]=e=>U("experience",e)),type:"number",min:0,max:50,unit:"años",editable:!1},null,8,["value"])]),r("div",kx,[p(SE,{value:S.value.seniority_years,label:"Antigüedad","onUpdate:value":t[7]||(t[7]=e=>U("seniority",e)),type:"number",min:0,max:50,unit:"años de antigüedad",editable:!1},null,8,["value"])]),r("div",Cx,[p(SE,{value:S.value.email,label:"Email","onUpdate:value":t[8]||(t[8]=e=>U("email",e)),type:"text",editable:!1},null,8,["value"])]),r("div",Ex,[p(SE,{value:S.value.phone,label:"Teléfono","onUpdate:value":t[9]||(t[9]=e=>U("phone",e)),type:"text",editable:!1},null,8,["value"])]),r("div",Ix,[p(SE,{value:S.value.hire_date,"display-value":S.value.hire_date_formatted,label:"Fecha de contratación","onUpdate:value":t[10]||(t[10]=e=>U("hire_date",e)),type:"date",editable:!1},null,8,["value","display-value"])]),r("div",Sx,[p(SE,{value:S.value.position,label:"Cargo","onUpdate:value":t[11]||(t[11]=e=>U("position",e)),type:"select",options:V,editable:!0},null,8,["value"])]),r("div",Tx,[p(SE,{value:S.value.salary,label:"Salario","onUpdate:value":t[12]||(t[12]=e=>U("salary",e)),type:"number",min:0,step:.01,unit:"$",editable:!0},null,8,["value"])]),r("div",Nx,[p(SE,{value:S.value.notes,label:"Notas","onUpdate:value":t[13]||(t[13]=e=>U("notes",e)),type:"textarea",editable:!0},null,8,["value"])]),r("div",Px,[p(SE,{value:S.value.education,label:"Condición","onUpdate:value":t[14]||(t[14]=e=>U("education",e)),type:"text",editable:!0},null,8,["value"])]),r("div",Ax,[p(SE,{value:S.value.employment_type,label:"Modalidad","onUpdate:value":t[15]||(t[15]=e=>U("schedule",e)),type:"select",options:W,editable:!1},null,8,["value"])]),r("div",xx,[p(SE,{value:S.value.current_schedule,label:"Horario actual","onUpdate:value":t[16]||(t[16]=e=>U("currentSchedule",e)),type:"text",editable:!1},null,8,["value"])])]),r("div",Rx,[p(LE,{variant:"primary",onClick:t[17]||(t[17]=t=>e.$router.push(`/admin/staff/${i(v)}/history`)),class:"action-button d-none"},{default:f(()=>t[28]||(t[28]=[g(" Ver historial ")])),_:1,__:[28]}),p(LE,{variant:"secondary",onClick:B,class:"action-button",disabled:!S.value.phone},{default:f(()=>t[29]||(t[29]=[r("i",{class:"bi bi-whatsapp"},null,-1),g(" WhatsApp ")])),_:1,__:[29]},8,["disabled"]),!S.value.phone&&S.value.email?(w(),T(LE,{key:0,variant:"secondary",onClick:j,class:"action-button"},{default:f(()=>t[30]||(t[30]=[r("i",{class:"bi bi-envelope"},null,-1),g(" Enviar Correo ")])),_:1,__:[30]})):l("",!0),p(LE,{variant:"danger",onClick:Q,class:"action-button"},{default:f(()=>t[31]||(t[31]=[r("i",{class:"bi bi-person-dash"},null,-1),g(" Desvincular ")])),_:1,__:[31]})])]),r("div",Dx,[r("div",Ox,[t[34]||(t[34]=r("h2",{class:"section-title"},"Reseñas",-1)),r("div",Lx,[r("div",Mx,[(w(),o(_,null,k(5,e=>r("i",{key:e,class:C(["bi",e<=Math.round(S.value.rating)?"bi-star-fill":"bi-star"])},null,2)),64))]),r("span",Ux,c(G.value),1)]),r("div",Fx,[p(LE,{onClick:H,variant:"primary",class:"add-review-button"},{default:f(()=>t[32]||(t[32]=[r("i",{class:"bi bi-plus-lg"},null,-1),g(" Añadir reseña ")])),_:1,__:[32]}),p(LE,{onClick:B,variant:"secondary"},{default:f(()=>t[33]||(t[33]=[r("i",{class:"bi bi-whatsapp"},null,-1),g(" Contactar ")])),_:1,__:[33]})])]),K.value.length?(w(),o("div",Bx,[(w(!0),o(_,null,k(K.value,e=>(w(),T(YA,{key:e.id,review:e,"can-delete":!0,onDelete:F},null,8,["review"]))),128))])):(w(),o("div",qx,t[35]||(t[35]=[r("p",null,"No hay reseñas todavía.",-1)])))])])):l("",!0),p($E,{modelValue:N.value,"onUpdate:modelValue":t[20]||(t[20]=e=>N.value=e),title:"Desvincular empleado",size:"md"},{footer:f(()=>[r("button",{class:"btn btn-secondary",onClick:t[19]||(t[19]=e=>N.value=!1)}," Cancelar "),r("button",{class:"btn btn-danger",onClick:M,disabled:"DESVINCULAR"!==A.value}," Desvincular ",8,zx)]),default:f(()=>{var e;return[r("div",jx,[r("p",null,"¿Estás seguro de que deseas desvincular a "+c(null==(e=S.value)?void 0:e.name)+" del personal?",1),t[37]||(t[37]=r("p",{class:"confirm-warning"},"Esta acción no se puede deshacer.",-1)),r("div",$x,[t[36]||(t[36]=r("label",{for:"confirm-text"},'Escribe "DESVINCULAR" para confirmar',-1)),u(r("input",{type:"text",id:"confirm-text","onUpdate:modelValue":t[18]||(t[18]=e=>A.value=e),class:"form-control"},null,512),[[h,A.value]])])])]}),_:1},8,["modelValue"]),p($E,{modelValue:P.value,"onUpdate:modelValue":t[23]||(t[23]=e=>P.value=e),title:"Añadir nueva reseña",size:"md"},{footer:f(()=>[r("button",{class:"btn btn-secondary",onClick:t[22]||(t[22]=e=>P.value=!1)}," Cancelar "),r("button",{class:"btn btn-primary",onClick:q,disabled:!x.value.comment||R.value},[R.value?(w(),o("span",Yx,"Guardando...")):(w(),o("span",Qx,"Guardar reseña"))],8,Jx)]),default:f(()=>[r("div",Vx,[r("div",Wx,[t[38]||(t[38]=r("label",null,"Calificación",-1)),r("div",Hx,[(w(),o(_,null,k(5,e=>r("button",{key:e,type:"button",class:C(["star-button",{active:e<=x.value.rating}]),onClick:t=>x.value.rating=e},[r("i",{class:C(["bi",e<=x.value.rating?"bi-star-fill":"bi-star"])},null,2)],10,Gx)),64))])]),r("div",Kx,[t[39]||(t[39]=r("label",{for:"review-comment"},"Comentario",-1)),u(r("textarea",{id:"review-comment","onUpdate:modelValue":t[21]||(t[21]=e=>x.value.comment=e),rows:"4",placeholder:"Escribe tu comentario aquí...",class:"form-control"},null,512),[[h,x.value.comment]])])])]),_:1},8,["modelValue"]),p(rx,{modelValue:D.value,"onUpdate:modelValue":t[24]||(t[24]=e=>D.value=e),loading:O.value,onSubmit:Y},null,8,["modelValue","loading"])]))}},[["__scopeId","data-v-2fe9964d"]]),Xx={class:"profile-container"},eR={key:0,class:"loading-container"},tR={key:1,class:"alert alert-danger"},aR={key:2,class:"alert alert-success"},nR={key:3,class:"profile-content"},iR={class:"profile-card"},sR={class:"profile-main"},oR={class:"profile-image-container"},rR=["src"],lR={class:"profile-info"},cR={class:"form-group"},dR=["disabled"],uR={class:"form-group"},hR=["disabled"],pR={class:"form-group"},mR=["disabled"],fR={class:"form-group"},vR=["disabled"],gR={class:"form-group"},bR=["disabled"],wR={class:"form-group"},yR=["disabled"],_R={class:"form-group"},kR=["disabled"],CR={key:0,class:"form-text"},ER={class:"form-group"},IR=["disabled"],SR={key:0,class:"form-text"},TR={class:"profile-actions"},NR=["disabled"],PR={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},AR=["disabled"],xR=["disabled"],RR={class:"confirm-content"},DR={class:"confirm-input"},OR=["disabled"],LR=["disabled"],MR=["disabled"],UR={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},FR=Lh({__name:"Profile",setup(e){const t=b(),i=en(),m=a({display_name:"",business_name:"",position:"",corporate_email:"",corporate_phone:"",avatar:"",business_id:null}),v=a({current:"",new:"",confirm:""}),y=a(!0),_=a(!1),k=a(""),C=a(""),E=a(null),I=a(null),S=a(!1),T=a(""),N=a(!1),P=n(()=>!v.value.new||v.value.new.length>=8),A=n(()=>!v.value.new||!v.value.confirm||v.value.new===v.value.confirm),x=n(()=>!!m.value.display_name&&(!(v.value.current||v.value.new||v.value.confirm)||v.value.current&&P.value&&A.value)),R=async()=>{y.value=!0,k.value="";try{const e=(await va.getActiveUserProfile()).data.data,t=e.profile_data;e&&"admin"===e.type?m.value={display_name:e.display_name||"",business_name:t.business_name||"",position:t.position||"Administrador",corporate_email:t.corporate_email||"",corporate_phone:t.corporate_phone||"",avatar:e.avatar||"",business_id:e.business_id}:m.value={display_name:"Administrador",business_name:"Mi Negocio",position:"Administrador",corporate_email:"",corporate_phone:"",avatar:"",business_id:null}}catch(e){console.error("Error al cargar datos del usuario:",e),k.value="No se pudieron cargar tus datos. Por favor, inténtalo de nuevo."}finally{y.value=!1}},D=e=>{const t=e.target.files[0];if(!t)return;if(t.size>5242880)return void(k.value="La imagen no puede ser mayor a 5MB");I.value=t;const a=new FileReader;a.onload=e=>{E.value=e.target.result},a.readAsDataURL(t)},O=async()=>{var e,t;if(x.value){_.value=!0,k.value="",C.value="";try{const e=new FormData;m.value.display_name&&e.append("display_name",m.value.display_name),m.value.business_name&&e.append("business_name",m.value.business_name),m.value.position&&e.append("position",m.value.position),m.value.corporate_email&&e.append("corporate_email",m.value.corporate_email),m.value.corporate_phone&&e.append("corporate_phone",m.value.corporate_phone),I.value&&e.append("avatar",I.value);const t=await va.updateAdminUserProfile(e);t.data.data&&(m.value.avatar=t.data.data.avatar,m.value.display_name=t.data.data.display_name),I.value=null,E.value=null,C.value=t.data.message||"Perfil actualizado correctamente",v.value.current&&v.value.new&&await L()}catch(a){console.error("Error al actualizar perfil:",a),k.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"No se pudo actualizar el perfil. Por favor, inténtalo de nuevo."}finally{_.value=!1,k.value||await R()}}},L=async()=>{var e,t;if(v.value.current&&v.value.new&&v.value.confirm&&P.value&&A.value)try{await va.changePassword({current_password:v.value.current,password:v.value.new,password_confirmation:v.value.confirm}),v.value.current="",v.value.new="",v.value.confirm="",C.value="Contraseña actualizada correctamente"}catch(a){k.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"Error al cambiar contraseña"}},M=async()=>{var e,a;if("ELIMINAR"===T.value){N.value=!0;try{await va.deleteAccount({password:v.value.current}),await i.logout(),t.push("/login")}catch(n){console.error("Error al eliminar cuenta:",n),k.value=(null==(a=null==(e=n.response)?void 0:e.data)?void 0:a.message)||"No se pudo eliminar la cuenta. Por favor, inténtalo de nuevo.",S.value=!1,T.value="",N.value=!1}}},U=()=>{t.push("/admin")};return s(()=>{R()}),(e,t)=>(w(),o("div",Xx,[r("div",{class:"profile-header"},[r("button",{class:"back-button",onClick:U}," ← Volver ")]),y.value&&!m.value.name?(w(),o("div",eR,t[12]||(t[12]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"Cargando datos del perfil...",-1)]))):l("",!0),k.value?(w(),o("div",tR,c(k.value),1)):l("",!0),C.value?(w(),o("div",aR,c(C.value),1)):l("",!0),!y.value||m.value.name?(w(),o("div",nR,[r("div",iR,[r("div",sR,[r("div",oR,[r("img",{src:E.value||m.value.avatar||"/placeholder-avatar.png",alt:"Foto de perfil",class:"profile-image"},null,8,rR),t[13]||(t[13]=r("label",{for:"avatar-upload",class:"avatar-edit-btn"},[r("i",{class:"bi bi-camera"})],-1)),r("input",{type:"file",id:"avatar-upload",accept:"image/*",class:"visually-hidden",onChange:D},null,32)]),r("div",lR,[r("form",{onSubmit:d(O,["prevent"])},[r("div",cR,[t[14]||(t[14]=r("label",{for:"display-name"},"Nombre para mostrar",-1)),u(r("input",{type:"text",id:"display-name","onUpdate:modelValue":t[0]||(t[0]=e=>m.value.display_name=e),class:"form-control",required:"",disabled:_.value,placeholder:"Tu nombre como administrador"},null,8,dR),[[h,m.value.display_name]])]),r("div",uR,[t[15]||(t[15]=r("label",{for:"business-name"},"Nombre del negocio",-1)),u(r("input",{type:"text",id:"business-name","onUpdate:modelValue":t[1]||(t[1]=e=>m.value.business_name=e),class:"form-control",disabled:_.value,placeholder:"Nombre de tu negocio"},null,8,hR),[[h,m.value.business_name]])]),r("div",pR,[t[16]||(t[16]=r("label",{for:"position"},"Cargo/Posición",-1)),u(r("input",{type:"text",id:"position","onUpdate:modelValue":t[2]||(t[2]=e=>m.value.position=e),class:"form-control",disabled:_.value,placeholder:"Administrador, Gerente, etc."},null,8,mR),[[h,m.value.position]])]),r("div",fR,[t[17]||(t[17]=r("label",{for:"corporate-email"},"Email corporativo",-1)),u(r("input",{type:"email",id:"corporate-email","onUpdate:modelValue":t[3]||(t[3]=e=>m.value.corporate_email=e),class:"form-control",disabled:_.value,placeholder:"email@empresa.com"},null,8,vR),[[h,m.value.corporate_email]])]),r("div",gR,[t[18]||(t[18]=r("label",{for:"corporate-phone"},"Teléfono corporativo",-1)),u(r("input",{type:"tel",id:"corporate-phone","onUpdate:modelValue":t[4]||(t[4]=e=>m.value.corporate_phone=e),class:"form-control",disabled:_.value,placeholder:"+1234567890"},null,8,bR),[[h,m.value.corporate_phone]])]),t[23]||(t[23]=r("div",{class:"profile-divider"},[r("h3",null,"Cambiar contraseña")],-1)),r("div",wR,[t[19]||(t[19]=r("label",{for:"current-password"},"Contraseña actual",-1)),u(r("input",{type:"password",id:"current-password","onUpdate:modelValue":t[5]||(t[5]=e=>v.value.current=e),class:"form-control",disabled:_.value},null,8,yR),[[h,v.value.current]])]),r("div",_R,[t[20]||(t[20]=r("label",{for:"new-password"},"Nueva contraseña",-1)),u(r("input",{type:"password",id:"new-password","onUpdate:modelValue":t[6]||(t[6]=e=>v.value.new=e),class:"form-control",disabled:_.value},null,8,kR),[[h,v.value.new]]),v.value.new&&!P.value?(w(),o("div",CR," La contraseña debe tener al menos 8 caracteres ")):l("",!0)]),r("div",ER,[t[21]||(t[21]=r("label",{for:"confirm-password"},"Confirmar nueva contraseña",-1)),u(r("input",{type:"password",id:"confirm-password","onUpdate:modelValue":t[7]||(t[7]=e=>v.value.confirm=e),class:"form-control",disabled:_.value},null,8,IR),[[h,v.value.confirm]]),v.value.confirm&&!A.value?(w(),o("div",SR," Las contraseñas no coinciden ")):l("",!0)]),r("div",TR,[r("button",{type:"submit",class:"btn btn-primary",disabled:_.value||!x.value},[_.value?(w(),o("span",PR)):l("",!0),t[22]||(t[22]=g(" Guardar perfil "))],8,NR),r("button",{type:"button",class:"btn btn-secondary",onClick:L,disabled:_.value||!v.value.current||!v.value.new||!v.value.confirm||!P.value||!A.value}," Cambiar contraseña ",8,AR),r("button",{type:"button",class:"btn btn-danger",onClick:t[8]||(t[8]=e=>S.value=!0),disabled:_.value}," Eliminar cuenta ",8,xR)])],32)])])])])):l("",!0),p($E,{modelValue:S.value,"onUpdate:modelValue":t[11]||(t[11]=e=>S.value=e),title:"Eliminar cuenta",size:"md"},{footer:f(()=>[r("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=e=>S.value=!1),disabled:N.value}," Cancelar ",8,LR),r("button",{type:"button",class:"btn btn-danger",onClick:M,disabled:"ELIMINAR"!==T.value||N.value},[N.value?(w(),o("span",UR)):l("",!0),t[27]||(t[27]=g(" Eliminar mi cuenta "))],8,MR)]),default:f(()=>[r("div",RR,[t[25]||(t[25]=r("p",null,"¿Estás seguro de que deseas eliminar tu cuenta? Esta acción no se puede deshacer.",-1)),t[26]||(t[26]=r("div",{class:"alert alert-danger"},[r("i",{class:"bi bi-exclamation-triangle-fill me-2"}),g(" Al eliminar tu cuenta perderás todo el acceso a tus datos y negocios asociados. ")],-1)),r("div",DR,[t[24]||(t[24]=r("label",{for:"confirm-delete"},'Escribe "ELIMINAR" para confirmar',-1)),u(r("input",{type:"text",class:"form-control",id:"confirm-delete","onUpdate:modelValue":t[9]||(t[9]=e=>T.value=e),disabled:N.value},null,8,OR),[[h,T.value]])])])]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-fce061a7"]]),qR={class:"settings-container"},BR={key:0,class:"loading-container"},jR={key:1,class:"error-container"},$R={key:2,class:"settings-content"},zR={key:0,class:"success-message"},VR={class:"settings-section"},WR={key:0,class:"form-group mb-3"},HR=["value"],GR=["value"],KR={class:"form-group"},JR={class:"form-group"},YR={class:"form-row"},QR={class:"form-group"},ZR={class:"form-group"},XR={class:"form-group"},eD={class:"form-actions"},tD={class:"settings-section danger-zone"},aD={class:"form-row"},nD={class:"form-group"},iD={class:"form-group"},sD={class:"form-group"},oD={class:"form-row"},rD={class:"form-group"},lD={class:"form-group"},cD={class:"form-group"},dD={class:"confirm-content"},uD=Lh({__name:"Settings",setup(e){const t=b(),n=gE(),m=en(),v=a(!1),y=a(""),C=a(""),E=a(null),S=a([]),N=a([]),P=a(!1),A=a(!1),x=a(!1),R=a(null),D=I({number:"",name:"",capacity:4});s(async()=>{v.value=!0,y.value="";try{const[e,t,a]=await Promise.all([n.fetchBusinessData(),n.fetchTables(),n.fetchAllBusinesses().catch(()=>[])]);E.value=e.business||{},S.value=t||[],N.value=a||[]}catch(e){y.value=e.message||"Error al cargar datos"}finally{v.value=!1}});const O=async()=>{if(E.value){v.value=!0,y.value="",C.value="";try{await n.updateBusinessData(E.value),C.value="Configuración guardada con éxito"}catch(e){y.value=e.message||"Error al guardar configuración"}finally{v.value=!1}}},L=async()=>{if(D.number&&D.capacity){v.value=!0,y.value="";try{const e=await n.createTable(D);e&&(S.value.push(e),D.number="",D.name="",D.capacity=4,P.value=!1)}catch(e){y.value=e.message||"Error al crear mesa"}finally{v.value=!1}}else y.value="Por favor, completa todos los campos requeridos"},M=async()=>{if(R.value){v.value=!0,y.value="";try{await n.updateTable(R.value),S.value=S.value.map(e=>e.id===R.value.id?R.value:e),A.value=!1,R.value=null}catch(e){y.value=e.message||"Error al actualizar mesa"}finally{v.value=!1}}},U=async()=>{if(R.value){v.value=!0,y.value="";try{await n.deleteTable(R.value.id),S.value=S.value.filter(e=>e.id!==R.value.id),x.value=!1,R.value=null}catch(e){y.value=e.message||"Error al eliminar mesa"}finally{v.value=!1}}},F=()=>{t.push({name:"admin"})},q=async()=>{await m.logout(),t.push("/login")},B=async e=>{const t=Number(e.target.value);if(t&&t!==n.activeBusinessId){v.value=!0,y.value="",C.value="";try{await n.selectActiveBusiness(t);const e=await n.fetchBusinessData();E.value=e||E.value,C.value="Negocio activo actualizado"}catch(a){y.value=a.message||"No se pudo cambiar el negocio activo"}finally{v.value=!1}}};return(e,t)=>(w(),o("div",qR,[r("div",{class:"settings-header"},[r("button",{class:"back-button",onClick:F}," ← Volver "),t[18]||(t[18]=r("h1",null,"Configuración",-1))]),v.value?(w(),o("div",BR,t[19]||(t[19]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"Cargando configuración...",-1)]))):y.value?(w(),o("div",jR,[r("p",null,c(y.value),1),p(LE,{onClick:t[0]||(t[0]=t=>e.$router.go(0)),variant:"primary"},{default:f(()=>t[20]||(t[20]=[g(" Reintentar ")])),_:1,__:[20]})])):E.value?(w(),o("div",$R,[C.value?(w(),o("div",zR,c(C.value),1)):l("",!0),r("div",VR,[t[28]||(t[28]=r("h2",null,"Información del negocio",-1)),N.value.length>1?(w(),o("div",WR,[t[21]||(t[21]=r("label",{for:"active-business"},"Negocio activo",-1)),r("select",{id:"active-business",class:"form-select",value:i(n).activeBusinessId,onChange:B},[(w(!0),o(_,null,k(N.value,e=>(w(),o("option",{key:e.id,value:e.id},c(e.name),9,GR))),128))],40,HR)])):l("",!0),r("form",{onSubmit:d(O,["prevent"]),class:"business-form"},[r("div",KR,[t[22]||(t[22]=r("label",{for:"business-name"},"Nombre del restaurante",-1)),u(r("input",{id:"business-name",type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>E.value.name=e),required:""},null,512),[[h,E.value.name]])]),r("div",JR,[t[23]||(t[23]=r("label",{for:"business-address"},"Dirección",-1)),u(r("input",{id:"business-address",type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>E.value.address=e)},null,512),[[h,E.value.address]])]),r("div",YR,[r("div",QR,[t[24]||(t[24]=r("label",{for:"business-phone"},"Teléfono",-1)),u(r("input",{id:"business-phone",type:"tel","onUpdate:modelValue":t[3]||(t[3]=e=>E.value.phone=e)},null,512),[[h,E.value.phone]])]),r("div",ZR,[t[25]||(t[25]=r("label",{for:"business-email"},"Email",-1)),u(r("input",{id:"business-email",type:"email","onUpdate:modelValue":t[4]||(t[4]=e=>E.value.email=e)},null,512),[[h,E.value.email]])])]),r("div",XR,[t[26]||(t[26]=r("label",{for:"business-description"},"Descripción",-1)),u(r("textarea",{id:"business-description","onUpdate:modelValue":t[5]||(t[5]=e=>E.value.description=e),rows:"3"},null,512),[[h,E.value.description]])]),r("div",eD,[p(LE,{type:"submit",variant:"primary",loading:v.value},{default:f(()=>t[27]||(t[27]=[g(" Guardar cambios ")])),_:1,__:[27]},8,["loading"])])],32)]),r("div",tD,[t[30]||(t[30]=r("h2",null,"Cerrar Sesión",-1)),t[31]||(t[31]=r("p",null,"Finaliza tu sesión actual de forma segura.",-1)),p(LE,{onClick:q,variant:"danger-outline"},{default:f(()=>t[29]||(t[29]=[g(" Cerrar sesión ")])),_:1,__:[29]})])])):l("",!0),p($E,{modelValue:P.value,"onUpdate:modelValue":t[10]||(t[10]=e=>P.value=e),title:"Añadir nueva mesa",size:"md"},{footer:f(()=>[p(LE,{onClick:t[9]||(t[9]=e=>P.value=!1),variant:"outline"},{default:f(()=>t[35]||(t[35]=[g(" Cancelar ")])),_:1,__:[35]}),p(LE,{onClick:L,variant:"primary",loading:v.value},{default:f(()=>t[36]||(t[36]=[g(" Añadir ")])),_:1,__:[36]},8,["loading"])]),default:f(()=>[r("form",{onSubmit:d(L,["prevent"]),class:"table-form"},[r("div",aD,[r("div",nD,[t[32]||(t[32]=r("label",{for:"table-number"},"Número*",-1)),u(r("input",{id:"table-number",type:"number","onUpdate:modelValue":t[6]||(t[6]=e=>D.number=e),min:"1",required:""},null,512),[[h,D.number]])]),r("div",iD,[t[33]||(t[33]=r("label",{for:"table-capacity"},"Capacidad*",-1)),u(r("input",{id:"table-capacity",type:"number","onUpdate:modelValue":t[7]||(t[7]=e=>D.capacity=e),min:"1",required:""},null,512),[[h,D.capacity]])])]),r("div",sD,[t[34]||(t[34]=r("label",{for:"table-name"},"Nombre (opcional)",-1)),u(r("input",{id:"table-name",type:"text","onUpdate:modelValue":t[8]||(t[8]=e=>D.name=e),placeholder:"Ej: Terraza 1"},null,512),[[h,D.name]])])],32)]),_:1},8,["modelValue"]),R.value?(w(),T($E,{key:3,modelValue:A.value,"onUpdate:modelValue":t[15]||(t[15]=e=>A.value=e),title:"Editar mesa",size:"md"},{footer:f(()=>[p(LE,{onClick:t[14]||(t[14]=e=>A.value=!1),variant:"outline"},{default:f(()=>t[40]||(t[40]=[g(" Cancelar ")])),_:1,__:[40]}),p(LE,{onClick:M,variant:"primary",loading:v.value},{default:f(()=>t[41]||(t[41]=[g(" Guardar ")])),_:1,__:[41]},8,["loading"])]),default:f(()=>[r("form",{onSubmit:d(M,["prevent"]),class:"table-form"},[r("div",oD,[r("div",rD,[t[37]||(t[37]=r("label",{for:"edit-table-number"},"Número*",-1)),u(r("input",{id:"edit-table-number",type:"number","onUpdate:modelValue":t[11]||(t[11]=e=>R.value.number=e),min:"1",required:""},null,512),[[h,R.value.number]])]),r("div",lD,[t[38]||(t[38]=r("label",{for:"edit-table-capacity"},"Capacidad*",-1)),u(r("input",{id:"edit-table-capacity",type:"number","onUpdate:modelValue":t[12]||(t[12]=e=>R.value.capacity=e),min:"1",required:""},null,512),[[h,R.value.capacity]])])]),r("div",cD,[t[39]||(t[39]=r("label",{for:"edit-table-name"},"Nombre (opcional)",-1)),u(r("input",{id:"edit-table-name",type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>R.value.name=e),placeholder:"Ej: Terraza 1"},null,512),[[h,R.value.name]])])],32)]),_:1},8,["modelValue"])):l("",!0),R.value?(w(),T($E,{key:4,modelValue:x.value,"onUpdate:modelValue":t[17]||(t[17]=e=>x.value=e),title:"Eliminar mesa",size:"sm"},{footer:f(()=>[p(LE,{onClick:t[16]||(t[16]=e=>x.value=!1),variant:"outline"},{default:f(()=>t[43]||(t[43]=[g(" Cancelar ")])),_:1,__:[43]}),p(LE,{onClick:U,variant:"danger",loading:v.value},{default:f(()=>t[44]||(t[44]=[g(" Eliminar ")])),_:1,__:[44]},8,["loading"])]),default:f(()=>[r("div",dD,[r("p",null,"¿Estás seguro de que deseas eliminar la mesa "+c(R.value.number)+"?",1),t[42]||(t[42]=r("p",{class:"confirm-warning"},"Esta acción no se puede deshacer.",-1))])]),_:1},8,["modelValue"])):l("",!0)]))}},[["__scopeId","data-v-3112fe12"]]),hD={class:"debug-panel"},pD={class:"debug-section"},mD={class:"status-grid"},fD={class:"status-icon"},vD={class:"status-icon"},gD={class:"status-icon"},bD={class:"status-item"},wD={class:"debug-section"},yD={class:"button-grid"},_D=["disabled"],kD=["disabled"],CD=["disabled"],ED=["disabled"],ID={class:"debug-section"},SD={class:"test-form"},TD={class:"form-row"},ND={class:"form-row"},PD={class:"form-row"},AD=["disabled"],xD={class:"debug-section"},RD={class:"token-actions"},DD=["disabled"],OD={key:0,class:"debug-section"},LD={class:"debug-logs"},MD={class:"log-time"},UD={class:"log-message"},FD={class:"debug-section"},qD={class:"tech-info"},BD={class:"info-item"},jD={class:"info-item"},$D={class:"info-item"},zD={class:"info-item"},VD={__name:"NotificationDebugPanel",setup(e){const t=en(),d=rr(),p=a(!1),m=a([]),f=a(null),v=a({title:"🧪 Notificación de Prueba",body:"Esta es una notificación de prueba desde el panel de debug",type:"all"}),b=n(()=>t.isAuthenticated),y=a(!1),E=n(()=>!!f.value),S=I({browser:"",pushSupport:!1,serviceWorkerSupport:!1,firebaseProject:""});function T(e,t="info"){m.value.push({id:Date.now()+Math.random(),timestamp:new Date,message:e,type:t}),console.log(`[NotificationDebug] ${e}`)}function N(){m.value=[],T("🧹 Log limpiado","info")}function A(){const e=m.value.map(e=>`[${e.timestamp.toLocaleString()}] ${e.type.toUpperCase()}: ${e.message}`).join("\n"),t=new Blob([e],{type:"text/plain"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=`notification-debug-${(new Date).toISOString().slice(0,10)}.log`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a),T("💾 Log descargado","success")}async function x(){if(!p.value){p.value=!0,T("🔔 Solicitando permisos de notificación...","info");try{if(!("Notification"in window))throw new Error("Este navegador no soporta notificaciones push");const e=await Notification.requestPermission();T(`📋 Resultado de permisos: ${e}`,"info"),"granted"===e?(systemStatus.permissions=!0,T("✅ Permisos concedidos","success"),ir("Permisos de notificación concedidos"),await R()):(systemStatus.permissions=!1,T("❌ Permisos denegados","error"),sr("Permisos de notificación denegados"))}catch(e){T(`❌ Error pidiendo permisos: ${e.message}`,"error"),sr(`Error: ${e.message}`)}finally{p.value=!1}}}async function R(){if(!p.value){p.value=!0,T("🚀 Inicializando Firebase Cloud Messaging...","info");try{if(!t.isAuthenticated)throw new Error("Usuario no autenticado");await Sa();const e=await Ta();if(!e)throw new Error("No se pudo obtener el token FCM");f.value=e,T(`🔑 Token FCM obtenido: ${e.substring(0,20)}...`,"success"),T("🔥 Listener de mensajes en primer plano configurado","success"),await D()}catch(e){T(`❌ Error inicializando FCM: ${e.message}`,"error"),sr(`Error inicializando FCM: ${e.message}`)}finally{p.value=!1}}}async function D(){if(p.value)return;const e=f.value||localStorage.getItem("fcm_token");if(e){p.value=!0,T("📤 Enviando token al servidor...","info");try{await ga.storeDeviceToken(e,"web",t.user.id);T("✅ Token enviado al servidor exitosamente","success"),ir("Token FCM registrado en el servidor")}catch(a){T(`❌ Error enviando token: ${a.message}`,"error"),sr(`Error enviando token: ${a.message}`)}finally{p.value=!1}}else T("❌ No hay token FCM para enviar","error")}async function O(){if(!p.value){p.value=!0,T("📥 Cargando notificaciones...","info");try{await d.loadNotifications(),T(`📬 ${d.totalUnreadCount} notificaciones no leídas cargadas`,"success"),ir("Notificaciones cargadas")}catch(e){T(`❌ Error cargando notificaciones: ${e.message}`,"error"),sr(`Error cargando notificaciones: ${e.message}`)}finally{p.value=!1}}}async function L(){if(p.value)return;if(!v.value.title.trim()||!v.value.body.trim())return void sr("Título y mensaje son requeridos");p.value=!0;const{title:e,body:a,type:n}=v.value;T(`📨 Enviando notificación tipo: ${n}`,"info");try{let i;switch(n){case"all":i=await ga.sendNotificationToAll(e,a),T("✅ Notificación enviada a todos los usuarios","success");break;case"user":i=await ga.sendNotificationToUser(t.user.id,e,a),T("✅ Notificación enviada solo para ti","success");break;case"device":const n=f.value||localStorage.getItem("fcm_token");if(!n)throw new Error("No hay token FCM disponible");i=await ga.sendNotificationToDevice(n,e,a),T("✅ Notificación enviada a tu dispositivo","success");break;default:throw new Error("Tipo de notificación no válido")}ir("Notificación enviada exitosamente"),T(`📝 Respuesta: ${JSON.stringify(i)}`,"info")}catch(i){T(`❌ Error enviando notificación: ${i.message}`,"error"),sr(`Error enviando notificación: ${i.message}`)}finally{p.value=!1}}function M(){const e=f.value||localStorage.getItem("fcm_token");e?(T("🔑 Token FCM actual:","info"),T(e,"info"),ir("Token mostrado en el log")):(T("❌ No hay token FCM disponible","error"),sr("No hay token FCM disponible"))}async function U(){const e=f.value||localStorage.getItem("fcm_token");if(e)try{await navigator.clipboard.writeText(e),T("📋 Token copiado al portapapeles","success"),ir("Token copiado al portapapeles")}catch(t){T("❌ Error copiando token","error"),sr("Error copiando token")}else sr("No hay token para copiar")}async function F(){if(p.value)return;if(f.value||localStorage.getItem("fcm_token")){p.value=!0,T("🗑️ Eliminando token...","info");try{f.value=null,localStorage.removeItem("fcm_token"),T("✅ Token eliminado","success"),ir("Token eliminado")}catch(e){T(`❌ Error eliminando token: ${e.message}`,"error"),sr(`Error eliminando token: ${e.message}`)}finally{p.value=!1}}else sr("No hay token para eliminar")}return s(()=>{T("🔧 Panel de debug cargado","info"),S.browser=navigator.userAgent.split("(")[0].trim(),S.pushSupport="Notification"in window,S.serviceWorkerSupport="serviceWorker"in navigator,S.firebaseProject="mozoqr-7d32c","Notification"in window&&(y.value="granted"===Notification.permission,T(`📋 Permisos actuales: ${Notification.permission}`,"info"));const e=localStorage.getItem("fcm_token");e&&(f.value=e,T(`🔑 Token FCM encontrado: ${e.substring(0,20)}...`,"info")),T("👤 Usuario autenticado: "+(t.isAuthenticated?"Sí":"No"),"info"),t.user&&T(`👤 ID: ${t.user.id} | Email: ${t.user.email}`,"info")}),(e,t)=>(w(),o("div",hD,[t[21]||(t[21]=r("div",{class:"debug-header"},[r("h3",null,"🧪 Debug de Notificaciones FCM"),r("p",{class:"debug-subtitle"},"Panel para probar y debuggear notificaciones push")],-1)),r("div",pD,[t[7]||(t[7]=r("h4",null,"📊 Estado del Sistema",-1)),r("div",mD,[r("div",{class:C(["status-item",{active:b.value}])},[r("span",fD,c(b.value?"✅":"❌"),1),t[3]||(t[3]=r("span",null,"Usuario Autenticado",-1))],2),r("div",{class:C(["status-item",{active:y.value}])},[r("span",vD,c(y.value?"✅":"❌"),1),t[4]||(t[4]=r("span",null,"Permisos Push",-1))],2),r("div",{class:C(["status-item",{active:E.value}])},[r("span",gD,c(E.value?"✅":"❌"),1),t[5]||(t[5]=r("span",null,"Token FCM",-1))],2),r("div",bD,[t[6]||(t[6]=r("span",{class:"status-icon"},"🔔",-1)),r("span",null,c(i(d).totalUnreadCount)+" no leídas",1)])])]),r("div",wD,[t[8]||(t[8]=r("h4",null,"⚡ Acciones Rápidas",-1)),r("div",yD,[r("button",{onClick:x,disabled:p.value,class:"debug-btn primary"},c(p.value?"Procesando...":"🔔 Pedir Permisos"),9,_D),r("button",{onClick:R,disabled:p.value,class:"debug-btn secondary"}," 🚀 Inicializar FCM ",8,kD),r("button",{onClick:D,disabled:p.value,class:"debug-btn secondary"}," 📤 Enviar Token al Servidor ",8,CD),r("button",{onClick:O,disabled:p.value,class:"debug-btn info"}," 📥 Cargar Notificaciones ",8,ED)])]),r("div",ID,[t[13]||(t[13]=r("h4",null,"📤 Enviar Notificaciones de Prueba",-1)),r("div",SD,[r("div",TD,[t[9]||(t[9]=r("label",null,"Título:",-1)),u(r("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>v.value.title=e),placeholder:"Título de la notificación"},null,512),[[h,v.value.title]])]),r("div",ND,[t[10]||(t[10]=r("label",null,"Mensaje:",-1)),u(r("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>v.value.body=e),placeholder:"Cuerpo del mensaje",rows:"2"},null,512),[[h,v.value.body]])]),r("div",PD,[t[12]||(t[12]=r("label",null,"Tipo:",-1)),u(r("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>v.value.type=e)},t[11]||(t[11]=[r("option",{value:"all"},"🌐 Enviar a Todos",-1),r("option",{value:"user"},"👤 Enviar Solo a Mí",-1),r("option",{value:"device"},"📱 Enviar a Mi Device",-1)]),512),[[P,v.value.type]])]),r("button",{onClick:L,disabled:p.value,class:"debug-btn primary full-width"},c(p.value?"Enviando...":"📨 Enviar Notificación"),9,AD)])]),r("div",xD,[t[14]||(t[14]=r("h4",null,"🔑 Gestión de Device Tokens",-1)),r("div",RD,[r("button",{onClick:M,class:"debug-btn secondary"}," 👀 Ver Token Actual "),r("button",{onClick:U,class:"debug-btn secondary"}," 📋 Copiar Token "),r("button",{onClick:F,disabled:p.value,class:"debug-btn danger"}," 🗑️ Eliminar Token ",8,DD)])]),m.value.length>0?(w(),o("div",OD,[t[15]||(t[15]=r("h4",null,"📝 Log de Eventos",-1)),r("div",LD,[(w(!0),o(_,null,k(m.value.slice(-10),e=>{return w(),o("div",{key:e.id,class:C(["log-item",e.type])},[r("span",MD,c((t=e.timestamp,t.toLocaleTimeString())),1),r("span",UD,c(e.message),1)],2);var t}),128))]),r("div",{class:"log-actions"},[r("button",{onClick:N,class:"debug-btn small"},"Limpiar Log"),r("button",{onClick:A,class:"debug-btn small"},"💾 Descargar Log")])])):l("",!0),r("div",FD,[t[20]||(t[20]=r("h4",null,"🔧 Información Técnica",-1)),r("div",qD,[r("div",BD,[t[16]||(t[16]=r("strong",null,"Navegador:",-1)),g(" "+c(S.browser),1)]),r("div",jD,[t[17]||(t[17]=r("strong",null,"Soporte Push:",-1)),g(" "+c(S.pushSupport?"Sí":"No"),1)]),r("div",$D,[t[18]||(t[18]=r("strong",null,"Service Worker:",-1)),g(" "+c(S.serviceWorkerSupport?"Sí":"No"),1)]),r("div",zD,[t[19]||(t[19]=r("strong",null,"Firebase Project:",-1)),g(" "+c(S.firebaseProject),1)])])])]))}},WD=Lh(VD,[["__scopeId","data-v-03f702b6"]]),HD={class:"notification-debug"},GD={key:0,class:"current-notifications"},KD={class:"notifications-list"},JD={class:"notification-header"},YD={class:"notification-time"},QD={class:"notification-body"},ZD={class:"notification-meta"},XD={class:"notification-type"},eO={class:"notification-status"},tO=Lh({__name:"NotificationDebug",setup(e){const t=rr(),a=n(()=>[...t.unreadNotifications,...t.readNotifications]);async function i(){try{await(async()=>{try{console.log("🧪 Enviando notificación de prueba para app cerrada...");const e=await va.post("/notifications/test-background",{title:"🔔 Prueba App Cerrada",message:"Esta notificación debe aparecer cuando la app está cerrada",data:{type:"background_test",timestamp:(new Date).toISOString(),test_mode:!0}});return console.log("✅ Notificación de prueba enviada:",e.data),e.data}catch(e){throw console.error("❌ Error enviando notificación de prueba:",e),e}})(),alert("✅ Notificación de prueba enviada. Cierra la app y verifica que llegue la notificación.")}catch(e){alert("❌ Error enviando notificación: "+e.message)}}async function s(){try{await(async(e=10)=>{try{console.log(`🕐 Programando notificación de prueba en ${e} segundos...`);const t=await va.post("/notifications/schedule-test",{delay:e,title:"⏰ Notificación Programada",message:`Esta notificación fue programada hace ${e} segundos`,data:{type:"scheduled_test",scheduled_at:(new Date).toISOString(),delay_seconds:e}});return console.log("✅ Notificación programada:",t.data),t.data}catch(t){throw console.error("❌ Error programando notificación:",t),t}})(15),alert("✅ Notificación programada para 15 segundos. Cierra la app y espera.")}catch(e){alert("❌ Error programando notificación: "+e.message)}}function d(){const e={steps:["1. Asegúrate de estar autenticado en la app","2. Ejecuta sendTestBackgroundNotification() o scheduleTestNotification()","3. Cierra completamente la aplicación (no solo minimizar)","4. Espera unos segundos","5. Deberías ver la notificación en la barra de notificaciones","6. Al tocar la notificación, la app debe abrirse"],note:"Para Android, asegúrate de que los permisos de notificaciones estén activados y que la app no esté en modo ahorro de batería."},t=`\nInstrucciones para probar notificaciones:\n\n${e.steps.join("\n")}\n\nNota: ${e.note}\n  `;alert(t)}return(e,t)=>(w(),o("div",HD,[t[2]||(t[2]=r("div",{class:"page-header"},[r("h1",null,"Panel de Debug - Notificaciones"),r("p",{class:"subtitle"},"Prueba y monitorea el sistema de notificaciones FCM")],-1)),p(WD),r("div",{class:"background-tests"},[t[0]||(t[0]=r("h2",null,"📴 Pruebas App Cerrada",-1)),t[1]||(t[1]=r("p",{class:"test-description"}," Estas pruebas envían notificaciones que deben llegar cuando la aplicación está completamente cerrada. ",-1)),r("div",{class:"test-buttons"},[r("button",{onClick:i,class:"test-btn primary"}," 🧪 Probar App Cerrada "),r("button",{onClick:s,class:"test-btn secondary"}," ⏰ Notificación en 15s "),r("button",{onClick:d,class:"test-btn info"}," 📋 Ver Instrucciones ")])]),a.value.length>0?(w(),o("div",GD,[r("h2",null,"📬 Notificaciones Actuales ("+c(a.value.length)+")",1),r("div",KD,[(w(!0),o(_,null,k(a.value.slice(0,10),e=>{var t,a,n;return w(),o("div",{key:e.id,class:C(["notification-preview",{unread:!e.read_at}])},[r("div",JD,[r("strong",null,c((null==(t=e.data)?void 0:t.title)||e.title||"Sin título"),1),r("span",YD,c((n=e.created_at||e.timestamp,new Date(n).toLocaleString())),1)]),r("p",QD,c((null==(a=e.data)?void 0:a.message)||e.body||"Sin mensaje"),1),r("div",ZD,[r("span",XD,c(e.type||"notification"),1),r("span",eO,c(e.read_at?"Leída":"No leída"),1)])],2)}),128))])])):l("",!0),t[3]||(t[3]=M('<div class="instructions" data-v-da0dde4d><h2 data-v-da0dde4d>📋 Instrucciones de Uso</h2><div class="instruction-steps" data-v-da0dde4d><div class="step" data-v-da0dde4d><span class="step-number" data-v-da0dde4d>1</span><div class="step-content" data-v-da0dde4d><strong data-v-da0dde4d>Inicializar Sistema:</strong><p data-v-da0dde4d>Haz clic en &quot;Inicializar Sistema&quot; para configurar FCM y obtener permisos.</p></div></div><div class="step" data-v-da0dde4d><span class="step-number" data-v-da0dde4d>2</span><div class="step-content" data-v-da0dde4d><strong data-v-da0dde4d>Probar Notificaciones:</strong><p data-v-da0dde4d>Usa &quot;Test Local&quot; para notificaciones inmediatas o &quot;Servidor&quot; para probar el backend.</p></div></div><div class="step" data-v-da0dde4d><span class="step-number" data-v-da0dde4d>3</span><div class="step-content" data-v-da0dde4d><strong data-v-da0dde4d>Verificar en el Bell:</strong><p data-v-da0dde4d>Las notificaciones aparecerán en el icono de campana en la barra superior.</p></div></div></div></div>',1))]))}},[["__scopeId","data-v-da0dde4d"]]),aO={class:"onboarding-container"},nO={class:"content-wrapper"},iO={class:"options"},sO={key:0,class:"card"},oO={class:"form-group"},rO={class:"form-group"},lO={class:"form-row"},cO={class:"form-group"},dO={class:"form-group"},uO={class:"form-group"},hO={class:"actions"},pO=["disabled"],mO={key:0,class:"spinner"},fO={key:1},vO=["disabled"],gO={key:0,class:"error"},bO={key:1,class:"card"},wO={class:"form-group"},yO=Lh({__name:"Onboarding",setup(e){const t=b(),n=gE(),i=a("create"),p=a(!1),m=a(""),f=I({name:"",address:"",phone:"",email:"",description:""}),v=a("");s(async()=>{!n.requiresBusinessSetup&&n.activeBusinessId&&t.replace({name:"admin"})});const y=async()=>{if(m.value="",f.name&&f.address)if(!f.email||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f.email)){p.value=!0;try{const e={name:f.name,address:f.address,phone:f.phone||void 0,email:f.email||void 0,description:f.description||void 0};await n.createBusiness(e),t.replace({name:"admin"})}catch(e){m.value=e.message||"No se pudo crear el negocio."}finally{p.value=!1}}else m.value="El email no es válido.";else m.value="Nombre y dirección son obligatorios."},_=async()=>{},k=()=>{t.replace({name:"admin"})};return(e,t)=>(w(),o("div",aO,[r("div",nO,[t[15]||(t[15]=r("div",{class:"header"},[r("h1",null,"Configura tu negocio"),r("p",{class:"subtitle"},"Eres admin y aún no tienes un negocio configurado.")],-1)),r("div",iO,[r("button",{class:C(["tab-btn",{active:"create"===i.value}]),onClick:t[0]||(t[0]=e=>i.value="create")}," Crear negocio ",2),r("button",{class:C(["tab-btn hidden",{active:"join"===i.value}]),onClick:t[1]||(t[1]=e=>i.value="join"),disabled:""}," Unirse a negocio (próximamente) ",2)]),"create"===i.value?(w(),o("div",sO,[r("form",{onSubmit:d(y,["prevent"])},[r("div",oO,[t[8]||(t[8]=r("label",null,[g("Nombre del negocio"),r("span",{class:"req"},"*")],-1)),u(r("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>f.name=e),type:"text",maxlength:"255",required:"",placeholder:"Ej: Café Central"},null,512),[[h,f.name,void 0,{trim:!0}]])]),r("div",rO,[t[9]||(t[9]=r("label",null,[g("Dirección"),r("span",{class:"req"},"*")],-1)),u(r("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>f.address=e),type:"text",maxlength:"255",required:"",placeholder:"Calle 123, Ciudad"},null,512),[[h,f.address,void 0,{trim:!0}]])]),r("div",lO,[r("div",cO,[t[10]||(t[10]=r("label",null,"Teléfono",-1)),u(r("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>f.phone=e),type:"text",maxlength:"20",placeholder:"Opcional"},null,512),[[h,f.phone,void 0,{trim:!0}]])]),r("div",dO,[t[11]||(t[11]=r("label",null,"Email",-1)),u(r("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>f.email=e),type:"email",maxlength:"255",placeholder:"Opcional"},null,512),[[h,f.email,void 0,{trim:!0}]])])]),r("div",uO,[t[12]||(t[12]=r("label",null,"Descripción",-1)),u(r("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>f.description=e),maxlength:"500",rows:"3",placeholder:"Opcional"},null,512),[[h,f.description,void 0,{trim:!0}]])]),r("div",hO,[r("button",{type:"submit",class:"btn-primary",disabled:p.value},[p.value?(w(),o("span",mO)):(w(),o("span",fO,"Crear negocio"))],8,pO),r("button",{type:"button",class:"btn-secondary",onClick:k,disabled:p.value},"Cancelar",8,vO)]),m.value?(w(),o("p",gO,c(m.value),1)):l("",!0)],32)])):(w(),o("div",bO,[r("form",{onSubmit:d(_,["prevent"])},[r("div",wO,[t[13]||(t[13]=r("label",null,"Código de invitación",-1)),u(r("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>v.value=e),type:"text",maxlength:"32",placeholder:"Ej: ABCD1234",disabled:""},null,512),[[h,v.value,void 0,{trim:!0}]])]),t[14]||(t[14]=r("div",{class:"actions"},[r("button",{type:"submit",class:"btn-primary",disabled:""},"Unirse")],-1))],32)]))])]))}},[["__scopeId","data-v-d90919cc"]]),_O={class:"call-waiter-container"},kO={key:0,class:"call-idle-state"},CO=["disabled"],EO={key:0},IO={key:1},SO={key:1,class:"call-calling-state"},TO={key:2,class:"call-waiting-state"},NO={class:"call-status-card"},PO={class:"wait-time"},AO={key:3,class:"call-acknowledged-state"},xO={key:4,class:"call-error-state"},RO={class:"call-status-card error"},DO={class:"urgency-options"},OO=Lh({__name:"CallWaiterButton",props:{tableId:{type:[String,Number],required:!0},businessId:{type:[String,Number],required:!0},tableNumber:{type:[String,Number],default:null}},emits:["call-status-change"],setup(e,{emit:t}){const a=e,i=t,u=I({callState:"idle",loading:!1,showUrgencyOptions:!1,waitTimeSeconds:0,errorMessage:{},currentCallId:null,waitTimer:null}),h=n(()=>u.callState),p=n(()=>u.loading),m=n({get:()=>u.showUrgencyOptions,set:e=>u.showUrgencyOptions=e}),f=n(()=>u.waitTimeSeconds),v=n(()=>u.errorMessage),b=n(()=>{const e=u.waitTimeSeconds;if(e<60)return`${e}s`;return`${Math.floor(e/60)}m ${e%60}s`}),y=()=>{u.showUrgencyOptions=!0},_=()=>{k("urgent")},k=async(e="normal")=>{u.showUrgencyOptions=!1,u.callState="calling",u.loading=!0,i("call-status-change","calling");try{console.log("📞 Calling waiter...",{tableId:a.tableId,urgency:e,tableNumber:a.tableNumber});const t=await sm.callWaiter(a.tableId,{message:"urgent"===e?"Solicitud urgente":"Solicita mozo",urgency:"urgent"===e?"high":"normal",client_info:{timestamp:(new Date).toISOString(),table_number:a.tableNumber}});t.success?(console.log("✅ Waiter called successfully:",t),u.currentCallId=t.call_id,u.callState="waiting",u.waitTimeSeconds=0,N(),A(),i("call-status-change","waiting")):S(t)}catch(t){console.error("❌ Error calling waiter:",t),S(t)}finally{u.loading=!1}},S=e=>{var t,a;u.callState="error",(null==(t=e.message)?void 0:t.includes("no_waiter_assigned"))?u.errorMessage={title:"Mozo no disponible",description:"No hay un mozo asignado a esta mesa actualmente. Por favor, solicite ayuda al personal del establecimiento."}:(null==(a=e.message)?void 0:a.includes("table_silenced"))?u.errorMessage={title:"Mesa temporalmente silenciada",description:"Su mesa está temporalmente silenciada. Inténtelo de nuevo en unos minutos."}:u.errorMessage={title:"Error en la conexión",description:"No pudimos procesar su solicitud. Verifique su conexión a internet e inténtelo nuevamente."},i("call-status-change","error")},T=()=>{P(),x(),u.callState="idle",u.currentCallId=null,u.waitTimeSeconds=0,u.errorMessage={},i("call-status-change","idle")},N=()=>{P(),u.waitTimer=setInterval(()=>{u.waitTimeSeconds+=1},1e3)},P=()=>{u.waitTimer&&(clearInterval(u.waitTimer),u.waitTimer=null)},A=()=>{window.addEventListener("waiter-call-acknowledged",R),window.addEventListener("waiter-call-completed",D)},x=()=>{window.removeEventListener("waiter-call-acknowledged",R),window.removeEventListener("waiter-call-completed",D)},R=e=>{console.log("✅ Waiter acknowledged call:",e.detail),e.detail.call_id===u.currentCallId&&(P(),u.callState="acknowledged",i("call-status-change","acknowledged"))},D=e=>{console.log("✅ Waiter completed call:",e.detail),e.detail.call_id===u.currentCallId&&T()};return s(()=>{console.log("🔔 CallWaiterButton mounted",{tableId:a.tableId,businessId:a.businessId,tableNumber:a.tableNumber})}),E(()=>{P(),x()}),(e,t)=>(w(),o("div",_O,["idle"===h.value?(w(),o("div",kO,[t[5]||(t[5]=r("div",{class:"call-info"},[r("h3",null,[r("i",{class:"fas fa-concierge-bell"}),g(" ¿Necesitas ayuda? ")]),r("p",null,"Presiona el botón para llamar a tu mozo")],-1)),r("button",{onClick:y,class:"call-button primary",disabled:p.value},[r("i",{class:C(["fas fa-bell",{"fa-spin":p.value}])},null,2),p.value?(w(),o("span",IO,"Conectando...")):(w(),o("span",EO,"Llamar Mozo"))],8,CO)])):"calling"===h.value?(w(),o("div",SO,t[6]||(t[6]=[r("div",{class:"call-status-card"},[r("div",{class:"status-icon calling"},[r("i",{class:"fas fa-paper-plane"})]),r("h3",null,"Llamando mozo..."),r("p",null,"Estamos notificando a tu mozo"),r("div",{class:"loading-dots"},[r("span"),r("span"),r("span")])],-1)]))):"waiting"===h.value?(w(),o("div",TO,[r("div",NO,[t[9]||(t[9]=r("div",{class:"status-icon waiting"},[r("i",{class:"fas fa-clock"})],-1)),t[10]||(t[10]=r("h3",null,"¡Mozo notificado!",-1)),t[11]||(t[11]=r("p",null,"Aguarde por favor, su mozo fue notificado y lo atenderá en breve",-1)),r("div",PO,[t[7]||(t[7]=r("i",{class:"fas fa-hourglass-half"},null,-1)),r("span",null,"Tiempo de espera: "+c(b.value),1)]),f.value>120?(w(),o("button",{key:0,onClick:_,class:"call-button urgent"},t[8]||(t[8]=[r("i",{class:"fas fa-exclamation-triangle"},null,-1),g(" Llamar urgente ")]))):l("",!0)])])):"acknowledged"===h.value?(w(),o("div",AO,[r("div",{class:"call-status-card success"},[t[13]||(t[13]=r("div",{class:"status-icon acknowledged"},[r("i",{class:"fas fa-check"})],-1)),t[14]||(t[14]=r("h3",null,"¡Mozo en camino!",-1)),t[15]||(t[15]=r("p",null,"Su mozo confirmó la llamada y se dirige a su mesa",-1)),r("button",{onClick:T,class:"call-button secondary"},t[12]||(t[12]=[r("i",{class:"fas fa-redo"},null,-1),g(" Nueva solicitud ")]))])])):"error"===h.value?(w(),o("div",xO,[r("div",RO,[t[17]||(t[17]=r("div",{class:"status-icon error"},[r("i",{class:"fas fa-exclamation-triangle"})],-1)),r("h3",null,c(v.value.title||"Error en la llamada"),1),r("p",null,c(v.value.description||"No pudimos contactar con su mozo. Intente nuevamente."),1),r("button",{onClick:T,class:"call-button primary"},t[16]||(t[16]=[r("i",{class:"fas fa-redo"},null,-1),g(" Intentar nuevamente ")]))])])):l("",!0),m.value?(w(),o("div",{key:5,class:"urgency-modal-overlay",onClick:t[4]||(t[4]=e=>m.value=!1)},[r("div",{class:"urgency-modal",onClick:t[3]||(t[3]=d(()=>{},["stop"]))},[t[20]||(t[20]=r("h4",null,"Tipo de solicitud",-1)),r("div",DO,[r("button",{onClick:t[0]||(t[0]=e=>k("normal")),class:"urgency-option normal"},t[18]||(t[18]=[r("i",{class:"fas fa-bell"},null,-1),r("span",null,"Normal",-1),r("small",null,"Solicitud general",-1)])),r("button",{onClick:t[1]||(t[1]=e=>k("urgent")),class:"urgency-option urgent"},t[19]||(t[19]=[r("i",{class:"fas fa-exclamation-triangle"},null,-1),r("span",null,"Urgente",-1),r("small",null,"Necesito atención inmediata",-1)]))]),r("button",{onClick:t[2]||(t[2]=e=>m.value=!1),class:"cancel-btn"}," Cancelar ")])])):l("",!0)]))}},[["__scopeId","data-v-28254294"]]),LO="0.0.86",MO=()=>`v${LO}`,UO={class:"menu-table-page"},FO={class:"business-header"},qO={class:"business-info"},BO={key:0,class:"business-logo"},jO=["src","alt"],$O={class:"business-details"},zO={class:"table-info"},VO={key:0,class:"business-address"},WO={class:"main-content"},HO={class:"menu-section"},GO={key:0,class:"loading-state"},KO={key:1,class:"error-state"},JO={key:2,class:"pdf-container"},YO=["src"],QO={class:"pdf-actions"},ZO=["href"],XO={key:3,class:"no-menu-state"},eL={class:"waiter-call-section"},tL={class:"page-footer"},aL={class:"app-branding"},nL={class:"version"},iL=Lh({__name:"MenuTable",setup(e){const t=y(),a=n(()=>t.params.tableId),d=n(()=>t.query.business_id),u=n(()=>t.query.table_number||a.value),h=I({businessData:{},menuPdfUrl:null,loadingMenu:!0,loadingBusiness:!0,menuError:!1,businessError:!1,callStatus:"idle"}),m=n(()=>h.businessData),f=n(()=>h.menuPdfUrl),v=n(()=>h.loadingMenu),b=n(()=>h.menuError),_=async()=>{if(d.value)try{h.loadingBusiness=!0,h.businessError=!1;const e=await va.get(`/public/business/${d.value}`);if(!e.data.success)throw new Error(e.data.message||"Error loading business info");h.businessData=e.data.business,console.log("✅ Business info loaded:",h.businessData)}catch(e){console.error("❌ Error loading business info:",e),h.businessError=!0,h.businessData={name:"Restaurante",address:null,logo:null}}finally{h.loadingBusiness=!1}else console.error("Business ID not provided")},k=async()=>{if(!d.value)return console.error("Business ID not provided for menu"),void(h.loadingMenu=!1);try{h.loadingMenu=!0,h.menuError=!1;const e=await va.get(`/public/business/${d.value}/menu`);e.data.success&&e.data.menu_pdf_url?(h.menuPdfUrl=e.data.menu_pdf_url,console.log("✅ Menu PDF loaded:",h.menuPdfUrl)):(console.warn("⚠️ No menu available for this business"),h.menuPdfUrl=null)}catch(e){console.error("❌ Error loading menu:",e),h.menuError=!0}finally{h.loadingMenu=!1}},C=e=>{h.callStatus=e,console.log("📱 Call status changed:",e)};return s(async()=>{console.log("🏠 MenuTable mounted",{tableId:a.value,businessId:d.value,tableNumber:u.value}),a.value&&d.value?await Promise.all([_(),k()]):console.error("❌ Missing required parameters")}),(e,t)=>(w(),o("div",UO,[r("div",FO,[r("div",qO,[m.value.logo?(w(),o("div",BO,[r("img",{src:m.value.logo,alt:m.value.name},null,8,jO)])):l("",!0),r("div",$O,[r("h1",null,c(m.value.name||"Bienvenido"),1),r("div",zO,[t[0]||(t[0]=r("i",{class:"fas fa-table"},null,-1)),r("span",null,"Mesa "+c(u.value),1)]),m.value.address?(w(),o("div",VO,[t[1]||(t[1]=r("i",{class:"fas fa-map-marker-alt"},null,-1)),r("span",null,c(m.value.address),1)])):l("",!0)])])]),r("div",WO,[r("div",HO,[t[8]||(t[8]=r("div",{class:"section-header"},[r("h2",null,[r("i",{class:"fas fa-utensils"}),g(" Nuestro Menú ")])],-1)),v.value?(w(),o("div",GO,t[2]||(t[2]=[r("div",{class:"spinner"},null,-1),r("p",null,"Cargando menú...",-1)]))):b.value?(w(),o("div",KO,[t[4]||(t[4]=r("i",{class:"fas fa-exclamation-triangle"},null,-1)),t[5]||(t[5]=r("p",null,"No pudimos cargar el menú",-1)),r("button",{onClick:k,class:"retry-btn"},t[3]||(t[3]=[r("i",{class:"fas fa-refresh"},null,-1),g(" Reintentar ")]))])):f.value?(w(),o("div",JO,[r("iframe",{src:f.value,class:"pdf-viewer",title:"Menú del restaurante",frameborder:"0"},null,8,YO),r("div",QO,[r("a",{href:f.value,target:"_blank",class:"pdf-action-btn"},t[6]||(t[6]=[r("i",{class:"fas fa-external-link-alt"},null,-1),g(" Ver menú completo ")]),8,ZO)])])):(w(),o("div",XO,t[7]||(t[7]=[r("i",{class:"fas fa-file-pdf"},null,-1),r("p",null,"Menú no disponible temporalmente",-1),r("small",null,"Consulte con el personal del establecimiento",-1)])))]),r("div",eL,[p(OO,{"table-id":a.value,"business-id":d.value,"table-number":u.value,onCallStatusChange:C},null,8,["table-id","business-id","table-number"])])]),r("div",tL,[r("div",aL,[t[9]||(t[9]=r("span",null,"Powered by",-1)),t[10]||(t[10]=r("strong",null,"MozoApp",-1)),r("span",nL,c(i(MO)()),1)])])]))}},[["__scopeId","data-v-eae715a0"]]),sL=U({history:F("/"),routes:[{path:"/",name:"root",beforeEnter:(e,t,a)=>{const n=en(),{isAuthenticated:i,currentRole:s}=q(n);if(i.value){const e=s.value;if(!e)return a({name:"role-selection"});return a({name:"waiter"===e?"waiter-dashboard":"admin"})}return a({name:"login"})}},{path:"/login",name:"login",component:Zh,meta:{requiresGuest:!0}},{path:"/register",name:"register",component:wp,meta:{requiresGuest:!0}},{path:"/forgot-password",name:"forgot-password",component:Ap,meta:{requiresGuest:!0}},{path:"/join/:token",name:"join-staff",component:()=>H(()=>import("./JoinStaff-erESBuF5.js"),__vite__mapDeps([10,1,2,11])),meta:{requiresGuest:!1}},{path:"/reset-password",name:"reset-password",component:Kp,meta:{requiresGuest:!0}},{path:"/role-selection",name:"role-selection",component:im,meta:{requiresAuth:!0}},{path:"/waiter/dashboard",name:"waiter-dashboard",component:vE,meta:{requiresAuth:!0,role:"waiter"}},{path:"/waiter/onboard",name:"waiter-onboard",component:BS,meta:{requiresAuth:!0,role:"waiter"}},{path:"/staff/invitations",name:"staff-invitations",component:gT,meta:{requiresAuth:!0}},{path:"/profile",name:"profile",component:PS,meta:{requiresAuth:!0}},{path:"/completeness",name:"completeness",component:()=>H(()=>import("./Completeness-BxBBsYqb.js"),__vite__mapDeps([12,1,2,13])),meta:{requiresAuth:!0}},{path:"/admin",name:"admin",component:XT,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/onboard",name:"admin-onboard",component:yO,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/home",redirect:{name:"admin"}},{path:"/admin/qr",name:"admin-qr",component:dP,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/stats",name:"admin-stats",component:hP,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/staff",name:"admin-staff",component:UA,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/staff/:id",name:"admin-staff-detail",component:Zx,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/profile",name:"admin-profile",component:FR,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/settings",name:"admin-settings",component:uD,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/notification-debug",name:"admin-notification-debug",component:tO,meta:{requiresAuth:!0,role:"admin"}},{path:"/menu/mesa/:tableId",name:"menu-table",component:iL,meta:{isPublic:!0}},{path:"/:pathMatch(.*)*",redirect:"/"}]});sL.beforeEach(async(e,t,a)=>{var n;const i=en(),{isAuthenticated:s,currentRole:o,initialized:r}=q(i),{useAdminStore:l}=await H(async()=>{const{useAdminStore:e}=await Promise.resolve().then(()=>bE);return{useAdminStore:e}},void 0),c=l();if(e.meta.isPublic)return a();if(e.meta.requiresGuest)return s.value?a({name:"root"}):a();if(e.meta.requiresAuth){if(!r.value)try{await i.tryToLogin()}catch(d){}if(!s.value)return a({name:"login"});if(i.user||await i.fetchUser(!1),e.meta.role){if(!o.value)return a({name:"role-selection"});const t=o.value;if(e.meta.role!==t)return a({name:"waiter"===t?"waiter-dashboard":"admin"})}if((null==(n=e.name)?void 0:n.toString().startsWith("admin"))&&"admin-onboard"!==e.name)try{if(!1===c.requiresBusinessSetup&&c.activeBusinessId);else{const e=await c.fetchBusinessData();if(c.requiresBusinessSetup||(null==e?void 0:e.requires_business_setup))return a({name:"admin-onboard"})}}catch(d){}}return a()});const oL=t("ui",()=>{const e=a(!1);return{isOffCanvasOpen:e,toggleOffCanvas:function(){e.value=!e.value},closeOffCanvas:function(){e.value=!1}}}),rL={class:"notification-bell-container"},lL={key:0,class:"notification-badge"},cL={class:"dropdown-header"},dL={class:"notification-count"},uL={key:0,class:"notification-list"},hL=["onClick"],pL={class:"notification-content"},mL={class:"notification-title"},fL={class:"notification-message"},vL={class:"notification-time"},gL={key:0,class:"unread-dot"},bL={key:1,class:"empty-notifications"},wL={key:2,class:"dropdown-footer"},yL=Lh({__name:"NotificationBell",setup(e){const t=rr(),i=a(!1),u=n(()=>t.totalUnreadCount),h=n(()=>t.hasUnreadNotifications),p=n(()=>t.allUnreadNotifications.concat(t.allReadNotifications)),m=n(()=>u.value>99?"99+":u.value);function f(){i.value=!i.value}function v(){i.value=!1}function g(){t.allUnreadNotifications.forEach(e=>{t.handleNotification(e.id,"read")}),v()}function b(e){if(!e)return"";const t=new Date(e),a=new Date-t,n=Math.floor(a/36e5),i=Math.floor(a/6e4);return n>24?t.toLocaleDateString():n>0?`${n}h`:i>0?`${i}m`:"ahora"}function y(e){e.target.closest(".notification-bell-container")||v()}return s(()=>{document.addEventListener("click",y)}),E(()=>{document.removeEventListener("click",y)}),(e,a)=>(w(),o("div",rL,[r("button",{onClick:f,class:C(["notification-bell",{"has-notifications":h.value}])},[a[1]||(a[1]=r("i",{class:"bi bi-bell"},null,-1)),u.value>0?(w(),o("span",lL,c(m.value),1)):l("",!0)],2),i.value?(w(),o("div",{key:0,class:"notification-dropdown",onClick:a[0]||(a[0]=d(()=>{},["stop"]))},[r("div",cL,[a[2]||(a[2]=r("h4",null,"Notificaciones",-1)),r("span",dL,c(u.value)+" nuevas",1)]),p.value.length>0?(w(),o("div",uL,[(w(!0),o(_,null,k(p.value.slice(0,5),e=>{var a,n;return w(),o("div",{key:e.id,class:C(["notification-item",{unread:!e.read_at}]),onClick:a=>function(e){e.read_at||t.handleNotification(e.id,"read")}(e)},[r("div",pL,[r("div",mL,c((null==(a=e.data)?void 0:a.title)||e.title||"Notificación"),1),r("div",fL,c((null==(n=e.data)?void 0:n.message)||e.body||"Nueva notificación recibida"),1),r("div",vL,c(b(e.created_at)),1)]),e.read_at?l("",!0):(w(),o("div",gL))],10,hL)}),128))])):(w(),o("div",bL,a[3]||(a[3]=[r("i",{class:"bi bi-bell-slash"},null,-1),r("p",null,"No hay notificaciones",-1)]))),p.value.length>0?(w(),o("div",wL,[r("button",{onClick:g,class:"action-btn"},"Marcar todas como leídas")])):l("",!0)])):l("",!0)]))}},[["__scopeId","data-v-3a3df5a8"]]),_L={class:"navbar-container"},kL={class:"top-bar"},CL={class:"navbar-left"},EL={class:"app-title"},IL={key:0,class:"navbar-right"},SL=Lh({__name:"Navbar",props:{title:{type:String,default:"MÖZÖ"}},setup(e){const t=oL(),a=en();return(n,s)=>(w(),o("div",_L,[r("header",kL,[r("div",CL,[r("button",{class:"menu-toggle",onClick:s[0]||(s[0]=(...e)=>i(t).toggleOffCanvas&&i(t).toggleOffCanvas(...e)),"aria-label":"Abrir menú"},s[1]||(s[1]=[r("i",{class:"bi bi-list"},null,-1)])),r("h1",EL,c(e.title),1)]),i(a).isAuthenticated?(w(),o("div",IL,[p(yL)])):l("",!0)])]))}},[["__scopeId","data-v-33d07fba"]]),TL={class:"off-canvas-panel"},NL={class:"panel-header"},PL={class:"panel-nav"},AL={key:0},xL={key:1},RL={key:2},DL={key:3},OL=Lh({__name:"OffCanvasNavbar",setup(e){const t=oL(),a=en(),{currentRole:c}=q(a),u=b(),h=n(()=>t.isOffCanvasOpen),m=n(()=>c.value);s(()=>{try{console.log("OffCanvasNavbar - mounted - userRole:",m.value),console.log("OffCanvasNavbar - mounted - isAuthenticated:",a.isAuthenticated),console.log("OffCanvasNavbar - mounted - currentRole:",a.currentRole)}catch(e){}});const y=async()=>{t.closeOffCanvas(),await a.logout(),u.push({name:"login"})};return(e,a)=>{const n=v("RouterLink");return w(),o("div",{class:C(["off-canvas-container",{open:h.value}])},[r("div",{class:"off-canvas-backdrop",onClick:a[0]||(a[0]=(...e)=>i(t).closeOffCanvas&&i(t).closeOffCanvas(...e))}),r("aside",TL,[r("header",NL,[a[9]||(a[9]=r("h3",null,"Menú",-1)),r("button",{onClick:a[1]||(a[1]=(...e)=>i(t).closeOffCanvas&&i(t).closeOffCanvas(...e)),class:"close-btn"},"×")]),r("nav",PL,[r("ul",null,["admin"===m.value?(w(),o("li",AL,[p(n,{to:{name:"admin"},class:"nav-link",onClick:a[2]||(a[2]=e=>i(t).closeOffCanvas())},{default:f(()=>a[10]||(a[10]=[r("i",{class:"bi bi-speedometer2"},null,-1),g(" Dashboard ")])),_:1,__:[10]})])):l("",!0),r("li",null,[p(n,{to:{name:"admin-notification-debug"},class:"nav-link",onClick:a[3]||(a[3]=e=>i(t).closeOffCanvas())},{default:f(()=>a[11]||(a[11]=[r("i",{class:"bi bi-bug"},null,-1),g(" Debug Notificaciones ")])),_:1,__:[11]})]),"waiter"===m.value?(w(),o("li",xL,[p(n,{to:{name:"waiter-dashboard"},class:"nav-link",onClick:a[4]||(a[4]=e=>i(t).closeOffCanvas())},{default:f(()=>a[12]||(a[12]=[r("i",{class:"bi bi-grid-1x2-fill"},null,-1),g(" Tablero ")])),_:1,__:[12]})])):l("",!0),r("li",null,[p(n,{to:{name:"staff-invitations"},class:"nav-link",onClick:a[5]||(a[5]=e=>i(t).closeOffCanvas())},{default:f(()=>a[13]||(a[13]=[r("i",{class:"bi bi-envelope"},null,-1),g(" Invitaciones ")])),_:1,__:[13]})]),"admin"===m.value?(w(),o("li",RL,[p(n,{to:{name:"admin-profile"},class:"nav-link",onClick:a[6]||(a[6]=e=>i(t).closeOffCanvas())},{default:f(()=>a[14]||(a[14]=[r("i",{class:"bi bi-person-fill"},null,-1),g(" Mi Perfil ")])),_:1,__:[14]})])):l("",!0),"waiter"===m.value?(w(),o("li",DL,[p(n,{to:{name:"profile"},class:"nav-link",onClick:a[7]||(a[7]=e=>i(t).closeOffCanvas())},{default:f(()=>a[15]||(a[15]=[r("i",{class:"bi bi-person-fill"},null,-1),g(" Mi Perfil ")])),_:1,__:[15]})])):l("",!0),r("li",null,[p(n,{to:{name:"role-selection"},class:"nav-link",onClick:a[8]||(a[8]=e=>i(t).closeOffCanvas())},{default:f(()=>a[16]||(a[16]=[r("i",{class:"bi bi-person-badge-fill"},null,-1),g(" Cambiar Rol ")])),_:1,__:[16]})]),a[18]||(a[18]=r("li",{class:"separator"},null,-1)),r("li",null,[r("a",{onClick:d(y,["prevent"]),class:"nav-link"},a[17]||(a[17]=[r("i",{class:"bi bi-box-arrow-right"},null,-1),g(" Cerrar Sesión ")]))])])])])],2)}}},[["__scopeId","data-v-bb729341"]]),LL={class:"app-container"},ML={key:2,class:"app-footer"},UL={class:"footer-content"},FL={class:"version"},qL={__name:"App",setup(e){const t=y(),a=b(),d=en(),u=rr(),h=n(()=>!["login","register","forgot-password","reset-password","role-selection"].includes(t.name)),m=n(()=>void 0===d.initialized||d.initialized),g=()=>{["login","register","forgot-password","reset-password","role-selection"].includes(t.name)?Ah.exitApp():a.options.history.state.back?a.back():Ah.exitApp()};return s(async()=>{if((async()=>{try{await Ah.addListener("backButton",g)}catch(e){console.warn("No se pudo configurar el listener del botón atrás:",e)}})(),await d.tryToLogin(),d.isAuthenticated){u.loadNotifications(),u.initializeRealTimeNotifications();try{const e=!!window.Capacitor&&window.Capacitor.getPlatform&&"web"!==window.Capacitor.getPlatform(),t=localStorage.getItem("fcm_token");if(!e&&!t&&!window.__pushInitStarted){window.__pushInitStarted=!0,console.log("🔔 (Fallback) Inicializando push porque fcm_token está vacío tras login restaurado...");const{initializePushNotifications:e}=await H(async()=>{const{initializePushNotifications:e}=await Promise.resolve().then(()=>JL);return{initializePushNotifications:e}},void 0);await e();const t=localStorage.getItem("fcm_token");console.log("🔔 (Fallback) Resultado obtención token:",t?t.substring(0,25)+"...":"NO TOKEN"),t||console.warn("⚠️ (Fallback) No se pudo obtener token FCM en inicialización tardía.")}}catch(e){console.warn("⚠️ (Fallback) Error asegurando token FCM:",e)}}}),E(()=>{(async()=>{try{await Ah.removeAllListeners("backButton")}catch(e){console.warn("Error al limpiar listeners del botón atrás:",e)}})(),d.isAuthenticated&&u.disconnectRealTimeNotifications()}),(e,t)=>{const a=v("router-view");return w(),o("div",LL,[h.value&&m.value?(w(),T(SL,{key:0})):l("",!0),h.value&&m.value?(w(),T(OL,{key:1})):l("",!0),r("main",{class:C({"with-navbar":h.value})},[p(a,null,{default:f(({Component:e})=>[p(B,{name:"fade",mode:"out-in"},{default:f(()=>[(w(),T(j(e)))]),_:2},1024)]),_:1})],2),h.value&&m.value?(w(),o("footer",ML,[r("div",UL,[t[0]||(t[0]=r("span",{class:"app-name"},"MozoApp",-1)),r("span",FL,c(i(MO)()),1)])])):l("",!0)])}}},BL=ja("PushNotifications",{}),jL=Object.freeze(Object.defineProperty({__proto__:null,PushNotifications:BL},Symbol.toStringTag,{value:"Module"})),$L={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_DEBUG_MODE:"true",VITE_FIREBASE_ANDROID_APP_ID:"1:175482362472:android:f2589ca9ec71fd0cb6b9dd",VITE_FIREBASE_API_KEY:"AIzaSyBlupKSIy7qtTsXukqROyVjMNx03X8CCzU",VITE_FIREBASE_APP_ID:"1:175482362472:web:308070c885bacc71b6b9dd",VITE_FIREBASE_AUTH_DOMAIN:"mozoqr-7d32c.firebaseapp.com",VITE_FIREBASE_DATABASE_URL:"https://mozoqr-7d32c-default-rtdb.firebaseio.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"175482362472",VITE_FIREBASE_PROJECT_ID:"mozoqr-7d32c",VITE_FIREBASE_STORAGE_BUCKET:"mozoqr-7d32c.firebasestorage.app",VITE_FIREBASE_VAPID_KEY:"BNJgpNkgB0a0y7gHT-SNBFLMGIZw-Xx8NTBDCn_4dVqekzgmnGmKMIn10t-6gWl3Qj_msyCcfbsVycnAp8USs6M",VITE_GOOGLE_ANDROID_CLIENT_ID:"175482362472-d8i8so3lpdbkl30ls0gme012t18f9q8q.apps.googleusercontent.com",VITE_GOOGLE_API_KEY:"AIzaSyAytXxncmi_89lUiLeXKDy6tPpV-BrxWFY",VITE_GOOGLE_CLIENT_ID:"175482362472-sbae126lpnl34rlsf24p8lmdau1obob3.apps.googleusercontent.com",VITE_GOOGLE_IOS_CLIENT_ID:"175482362472-qv7ql9v55gu9tq0um54u3u54up6584ud.apps.googleusercontent.com",VITE_MEASUREMENT_ID:"G-6N7J4X94DH",VITE_PUSHER_APP_CLUSTER:"us2",VITE_PUSHER_APP_KEY:"bd06ab967cc733531514",VITE_QR_BASE_URL:"https://mozoqr.com",VITE_URL_API:"https://mozoqr.com/api/"},zL=a({configured:!1,tokenExists:!1}),VL=async()=>{if(!Ba.isPluginAvailable("PushNotifications"))return{available:!1,reason:"Plugin no disponible"};try{const e=await BL.checkPermissions(),t=localStorage.getItem("fcm_token");return{available:!0,permissions:e.receive,hasToken:!!t,token:t?`${t.substring(0,20)}...`:null,platform:Ba.getPlatform()}}catch(e){return{available:!1,reason:e.message}}},WL=()=>{const e=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_PROJECT_ID"].filter(e=>!$L[e]);return{configured:0===e.length,missing:e,config:{apiKey:"Configurada",projectId:"Configurada"}}};(async()=>{try{if(Ba.isPluginAvailable&&Ba.isPluginAvailable("LocalNotifications")){const t=(await H(()=>import("./index-DlE1A72V.js"),__vite__mapDeps([9,1,2]))).LocalNotifications;try{t&&t.createChannel&&(await t.createChannel({id:"mozo_waiter",name:"Mozo - Llamadas",importance:5,visibility:1,description:"Notificaciones de llamadas y eventos importantes para mozos"}),console.log("✅ Canal mozo_waiter creado al importar pushNotifications"))}catch(e){console.warn("⚠️ Error creando canal mozo_waiter al importar:",e)}}}catch(e){console.warn("⚠️ No se pudo crear canal mozo_waiter al importar pushNotifications:",e)}})();const HL=e=>{try{const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      top: 50px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: rgba(0,0,0,0.9);\n      color: white;\n      padding: 12px 20px;\n      border-radius: 8px;\n      z-index: 10000;\n      font-size: 14px;\n      font-weight: bold;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.5);\n      max-width: 90%;\n      text-align: center;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.parentElement&&t.remove()},3e3)}catch(t){console.warn("Toast debug failed:",t)}},GL=e=>{try{if(!e.data)return!1;const t="string"==typeof e.data?JSON.parse(e.data):e.data;return"acknowledged"===t.status||"completed"===t.status?(console.log("🚫 Filtrando actualización de estado:",t.status),!0):e.android&&"normal"===e.android.priority?(console.log("🚫 Filtrando notificación de prioridad normal (posible confirmación)"),!0):"normal"===t.priority&&"new_call"!==t.type&&(console.log("🚫 Filtrando notificación normal que no es llamada nueva"),!0)}catch(t){return console.warn("⚠️ Error filtering notification:",t),!1}},KL=e=>{console.log("🔄 Procesando notificación del backend...");let t={title:e.title||"Nueva notificación",body:e.body||"Tienes una nueva notificación",data:e.data||{}};if(e.data){const a="string"==typeof e.data?JSON.parse(e.data):e.data;switch(console.log("🔄 Datos de notificación:",a),a.type){case"TestNotification":t={title:"Notificación de Prueba",body:"Esta es una notificación de prueba enviada a todos los usuarios del negocio",data:{...a,icon:"🧪",priority:"normal",channels:["Database","Broadcast","FCM"]}};break;case"UserSpecificNotification":t={title:a.title||"Notificación Personalizada",body:a.message||"Tienes una nueva notificación personalizada",data:{...a,icon:"👤",priority:"high",channels:["Database","Broadcast","FCM"]}};break;case"WebSocketTestNotification":t={title:"⚡ Prueba WebSocket + FCM",body:"Esta notificación llega por WebSocket (tiempo real) y FCM (push)",data:{...a,icon:"⚡",priority:"high",test_mode:"websocket_fcm"}};break;case"WebSocketOnlyNotification":t={title:"🔌 Prueba Solo WebSocket",body:"Esta notificación SOLO llega por WebSocket en tiempo real",data:{...a,icon:"🔌",priority:"normal",test_mode:"websocket_only"}};break;default:e.title&&e.body&&(t={title:e.title,body:e.body,data:{...a,icon:"📱",priority:"normal"}})}}return console.log("✅ Notificación procesada:",t),t},JL=Object.freeze(Object.defineProperty({__proto__:null,checkFirebaseConfig:WL,fcmStatus:zL,getNotificationStatus:VL,initializePushNotifications:async()=>{console.log("🔔 Inicializando sistema de notificaciones push...");const e=Ba.getPlatform();console.log("🔔 Plataforma detectada:",e),await(async()=>{if(console.log("🔔 Setting up push notification listeners..."),"web"===Ba.getPlatform())try{return console.log("🔔 Setting up Firebase listeners for web..."),await Oa.setupForegroundMessageListener(e=>{console.log("🚨 FCM NOTIFICATION RECEIVED IN REAL-TIME:",e),console.log("⏰ Received at:",(new Date).toLocaleTimeString()),H(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>lr);return{useNotificationsStore:e}},void 0).then(({useNotificationsStore:t})=>{var a,n,i,s;const o=t(),r=(null==(a=e.data)?void 0:a.call_id)||(null==(n=e.data)?void 0:n.callId)||(null==(i=e.data)?void 0:i.callID)||null,l={id:r||`fcm-${Date.now()}`,type:(null==(s=e.data)?void 0:s.type)||(r?"waiter_call":"FCMNotification"),data:{title:e.title,message:e.body,...e.data},created_at:(new Date).toISOString(),read_at:null,source:"fcm-realtime"};try{if(r&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls&&window.ultraFastNotifications.activeCalls.has(r))return void console.log("🔍 Skipping FCM store add for call already in UltraFast activeCalls:",r)}catch(c){console.warn("⚠️ Error checking ultraFastNotifications activeCalls for dedupe:",c)}console.log("📨 Adding notification to store:",l),r&&(o.waiterUnreadNotifications.find(e=>e.id===r)||o.unreadNotifications.find(e=>e.id===r))?console.log("🔁 Duplicate notification skipped (canonicalCallId):",r):(o.addNewNotification(l),console.log("✅ Notification added to reactive store!"))}).catch(e=>{console.error("❌ Error importing notifications store:",e)})}),void console.log("✅ Firebase listeners configured for web")}catch(e){return void console.error("❌ Error setting up Firebase listeners:",e)}if(Ba.isPluginAvailable("PushNotifications"))try{BL.addListener("registration",async t=>{var a,n,i,s;console.log("✅ Push registration success, token:",t.value),localStorage.setItem("fcm_token",t.value);let o=0;const r=e=>new Promise(t=>setTimeout(t,e));for(;o<5;)try{const e=en();if(console.log("🔔 Intento de envío de token - intento",o+1,"authState:",{isAuthenticated:e.isAuthenticated,userId:null==(a=e.user)?void 0:a.id}),e.isAuthenticated&&(null==(n=e.user)?void 0:n.id)){const a=Ba.getPlatform();console.log("🔔 Enviando token al backend (móvil):",{token:t.value.substring(0,20)+"...",platform:a,userId:null==(i=e.user)?void 0:i.id});const n=await ga.storeDeviceToken(t.value,a,null==(s=e.user)?void 0:s.id);console.log("✅ Device token stored successfully (móvil):",n);break}o++,console.log("⚠️ Usuario no autenticado aún, reintentando en 500ms..."),await r(500);continue}catch(e){console.error("❌ Error intentando enviar token (móvil):",e),o++,await r(500)}5===o&&console.warn("⚠️ No se pudo enviar token al backend después de varios intentos. Se dejó guardado localmente.")}),BL.addListener("registrationError",e=>{console.error("❌ Error on registration:",JSON.stringify(e))}),BL.addListener("pushNotificationReceived",e=>{var t,a,n;const i=(null==(t=e.android)?void 0:t.priority)||(null==(a=e.data)?void 0:a.priority)||"unknown",s=(null==(n=e.data)?void 0:n.status)||"unknown";if(console.log(`🔔 Push received - Priority: ${i}, Status: ${s}`),console.log("🔔 Full notification:",JSON.stringify(e,null,2)),HL(`📨 Push: ${i}/${s}`),GL(e))return console.log(`🚫 Notificación filtrada - Priority: ${i}, Status: ${s}`),void HL(`🚫 FILTRADA: ${i}/${s}`);console.log(`✅ Notificación permitida - Priority: ${i}, Status: ${s}`),HL(`✅ PERMITIDA: ${i}/${s}`);const o=KL(e);try{H(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>lr);return{useNotificationsStore:e}},void 0).then(({useNotificationsStore:e})=>{var t,a,n,i,s;const r=e(),l={id:(null==(t=o.data)?void 0:t.staff_request_id)||(null==(a=o.data)?void 0:a.id)||`push-${Date.now()}`,type:(null==(n=o.data)?void 0:n.type)||"push",data:{title:o.title,message:o.body,route:(null==(i=o.data)?void 0:i.route)||(null==(s=o.data)?void 0:s.url),...o.data},created_at:(new Date).toISOString(),read_at:null,source:"push-foreground"};r.addNewNotification(l)}).catch(e=>console.error("Error adding push notification to store",e))}catch(r){console.error("Error importing notifications store for pushNotificationReceived",r)}Ba.isPluginAvailable("LocalNotifications")?H(async()=>{const{LocalNotifications:e}=await import("./index-DlE1A72V.js");return{LocalNotifications:e}},__vite__mapDeps([9,1,2])).then(({LocalNotifications:e})=>{e.schedule({notifications:[{title:o.title,body:o.body,id:(new Date).getTime(),sound:null,actionTypeId:"OPEN_APP",extra:{...o.data,receivedAt:(new Date).toISOString(),source:"push-foreground"}}]}).catch(e=>{console.error("❌ Error programando notificación local:",e)})}).catch(e=>{console.error("❌ Error importando LocalNotifications:",e)}):"Notification"in window&&"granted"===Notification.permission&&new Notification(o.title,{body:o.body,icon:"/favicon.ico",tag:"push-notification",data:o.data})}),BL.addListener("pushNotificationActionPerformed",e=>{console.log("🔔 Push action performed:",JSON.stringify(e,null,2));const t=e.notification&&(e.notification.data||e.notification.extra||e.notification);try{const e=t&&(t.route||t.url);if(e){console.log("🔔 Navegando a (mobile):",e);try{sL.push(e)}catch(a){console.warn("Error navigating to route from push action",a)}}else window.dispatchEvent(new CustomEvent("pushNotificationAction",{detail:t}))}catch(n){console.error("Error handling pushNotificationActionPerformed data",n)}}),console.log("✅ Listeners de notificaciones configurados correctamente")}catch(e){console.error("❌ Error configurando listeners:",e)}else console.log("⚠️ Plugin PushNotifications no disponible para listeners")})();const t=await(async()=>{var e;console.log("🔔 Starting push notification registration...");const t=Ba.getPlatform(),a=Ba.isNativePlatform();if(console.log("🔔 DETECTED - Platform:",t,"Native:",a),"web"===t&&!a)try{if(console.log("🔔 Web platform detected, using Firebase FCM..."),!(await Oa.initializeFirebase()))return{success:!1,error:"Firebase initialization failed"};const t=await Oa.getFCMToken();console.log("🔔 FCM token obtained for web:",t.substring(0,20)+"..."),localStorage.setItem("fcm_token",t);const a=en();if(a.isAuthenticated)try{const n=await ga.storeDeviceToken(t,"web",null==(e=a.user)?void 0:e.id);console.log("✅ Device token stored:",n),zL.value={configured:!0,tokenExists:!0}}catch(n){console.error("❌ Error storing device token:",n)}else console.warn("⚠️ User not authenticated - token not sent to server");return{success:!0,token:t}}catch(n){return console.error("❌ FCM registration error:",n),{success:!1,error:n.message}}try{if(console.log("🔔 MOBILE: Starting Capacitor push notification registration..."),console.log("🔔 MOBILE: Platform:",Ba.getPlatform()),console.log("🔔 MOBILE: Native platform:",Ba.isNativePlatform()),!Ba.isPluginAvailable("PushNotifications"))return console.warn("⚠️ Plugin PushNotifications no disponible para registro (móvil)"),{success:!1,error:"PushNotifications plugin not available"};console.log("✅ MOBILE: PushNotifications plugin available");try{console.log("🔔 MOBILE: Requesting push permissions...");const e=await BL.requestPermissions();if(console.log("🔔 MOBILE: Push permission result:",e),e&&"denied"===e.receive)return console.error("❌ MOBILE: Push permissions DENIED"),{success:!1,error:"Push permissions denied"};console.log("✅ MOBILE: Push permissions OK")}catch(i){console.warn("⚠️ MOBILE: Error requesting push permissions:",i)}return console.log("🔔 MOBILE: Calling PushNotifications.register()..."),await BL.register(),console.log("✅ MOBILE: PushNotifications.register() completed"),{success:!0,token:null}}catch(n){return console.error("❌ Mobile push registration error:",n),{success:!1,error:n.message}}})();Ba.isPluginAvailable&&Ba.isPluginAvailable("LocalNotifications")&&H(async()=>{const{LocalNotifications:e}=await import("./index-DlE1A72V.js");return{LocalNotifications:e}},__vite__mapDeps([9,1,2])).then(({LocalNotifications:e})=>{try{e&&e.createChannel&&e.createChannel({id:"mozo_waiter",name:"Mozo - Llamadas",importance:5,visibility:1,description:"Notificaciones de llamadas y eventos importantes para mozos"}).then(()=>{console.log("✅ Canal de notificaciones Android creado: mozo_waiter")}).catch(e=>{console.warn("⚠️ Error creando canal LocalNotifications:",e)})}catch(t){console.warn("⚠️ Excepción creando canal LocalNotifications:",t)}}).catch(e=>{console.warn("⚠️ No se pudo importar LocalNotifications para crear canal:",e)});const a=await VL(),n=WL(),i=Oa.getFirebaseStatus();return console.log("🔔 Estado final de notificaciones:",{platform:e,registration:t,status:a,firebase:n,firebaseStatus:i}),{platform:e,registration:t,status:a,firebase:n,firebaseStatus:i}}},Symbol.toStringTag,{value:"Module"}));const YL=$(qL),QL=z();YL.use(QL),YL.use(sL),(async()=>{try{const t=en();t.initialized||await t.tryToLogin();try{const{checkForRedirectResult:e}=await H(async()=>{const{checkForRedirectResult:e}=await import("./redirectResultHandler-w4lVDc6c.js");return{checkForRedirectResult:e}},__vite__mapDeps([14,1,2])),a=await e();a&&await t.loginWithGoogle({provider:"google",id_token:a.token,email:a.email,name:a.name,avatar:a.imageUrl,uid:a.uid,access_token:a.accessToken})}catch(e){}}catch(e){}await sL.isReady(),YL.mount("#app")})(),"undefined"!=typeof window&&navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",e=>{if(e.data){if("fcm_event"===e.data.type){const n=e.data.payload,i=n.data||{},s=G(),o=i.call_id||i.callId;o&&(s.has(o)||s.upsert({id:o,table_id:i.table_id,table_number:i.table_number,status:i.status||(t=i.type,"new_call"===t?"pending":"acknowledged"===t?"acknowledged":"completed"===t?"completed":"pending"),urgency:i.urgency,called_at:i.timestamp||Date.now(),last_updated:Date.now(),event_type:i.type||"event"}));try{H(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>lr);return{useNotificationsStore:e}},void 0).then(({useNotificationsStore:e})=>{var t,a;const s=e(),r={id:o||`fcm-${Date.now()}`,type:i.type||"FCMNotification",data:{title:(null==(t=n.notification)?void 0:t.title)||i.title||"Nueva notificación",message:(null==(a=n.notification)?void 0:a.body)||i.body||i.message||"",route:i.route||i.url,...i},created_at:(new Date).toISOString(),read_at:null,source:"fcm-sw"};s.addNewNotification(r)}).catch(e=>console.error("Error adding FCM message to notifications store",e))}catch(a){console.error("Error importing notifications store for fcm_event",a)}return}if("notification_click"===e.data.type)try{const t=e.data.data||{},a=t.route||t.url;a?(window.focus(),sL.push(a).catch(()=>{})):window.dispatchEvent(new CustomEvent("notification_click",{detail:t}))}catch(a){console.error("Error handling notification_click message",a)}}var t});const ZL=(()=>{try{if(!window.Capacitor)return!1;if("function"==typeof window.Capacitor.isNativePlatform){return window.Capacitor.isNativePlatform()}if("function"==typeof window.Capacitor.getPlatform){const e=window.Capacitor.getPlatform();return"android"===e||"ios"===e}return!1}catch(e){return!1}})();ZL&&"android"===(null==(e=window.Capacitor)?void 0:e.getPlatform())&&setTimeout(async()=>{try{const e=await H(()=>import("./androidFCM-CtXznQHW.js"),__vite__mapDeps([15,1,2]));(null==e?void 0:e.initializeAndroidFCM)&&await e.initializeAndroidFCM()}catch(e){console.error("❌ Error inicializando Android FCM:",e),console.error("❌ Stack trace:",e.stack)}},3e3),!ZL&&"serviceWorker"in navigator&&navigator.serviceWorker.register("/firebase-messaging-sw.js").then(e=>console.log("Service Worker registrado:",e.scope)).catch(e=>console.warn("No se pudo registrar el Service Worker:",e)),ZL?console.log("Saltando runNotificationDiagnostics en entorno nativo"):async function(){try{if("serviceWorker"in navigator)try{await navigator.serviceWorker.getRegistration("/firebase-messaging-sw.js")}catch(e){}const n="undefined"!=typeof Notification?Notification.permission:"unsupported";if(localStorage.getItem("fcm_token"),"denied"===n);else try{if("default"===n&&"granted"!==await Notification.requestPermission())return;if(await Oa.initializeFirebase())try{const e=await Oa.getFCMToken();if(e&&localStorage.setItem("fcm_token",e),localStorage.getItem("token"))try{await ga.storeDeviceToken(e,"web")}catch(t){console.warn("[NotificationDiagnostics] Error enviando token al backend:",(null==t?void 0:t.message)||t)}}catch(a){console.warn("[NotificationDiagnostics] Error obteniendo FCM token:",(null==a?void 0:a.message)||a)}else console.warn("[NotificationDiagnostics] No se pudo inicializar Firebase (revisar variables env y SW)")}catch(e){console.warn("[NotificationDiagnostics] Error durante diagnóstico FCM:",e)}}finally{console.groupEnd()}}().catch(e=>console.warn("Error ejecutando diagnósticos de notificación:",e));export{$r as A,LE as B,Ba as C,pc as D,Vr as E,zr as F,lu as G,Rl as H,Tr as I,xr as J,Rr as K,Mr as L,Xr as M,Dr as N,bl as O,hl as P,cr as Q,ba as R,Ec as S,tn as T,Ph as U,jL as V,$a as W,H as _,uw as a,gw as b,Tc as c,bc as d,fc as e,gc as f,Ia as g,yc as h,Ea as i,_c as j,wc as k,vc as l,Sc as m,Ic as n,hw as o,ja as p,Lh as q,rw as r,Jp as s,va as t,en as u,ll as v,xl as w,rl as x,jr as y,Br as z};
