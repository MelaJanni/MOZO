const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-CWH0Jbc6.js","assets/vendor-C8q6etev.js","assets/bootstrap--QliLv9A.js","assets/echo-CKaDY4WX.js","assets/index.esm-CF7LdUBZ.js","assets/index.esm-TkqytPRP.js","assets/index.esm-D4mIwqXE.js","assets/index-B_qQR_LU.js","assets/androidFCM-DakZu76G.js"])))=>i.map(i=>d[i]);
var e,t,a;import{d as n,r as i,c as s,u as o,o as r,a as l,b as c,e as d,f as u,g as h,t as p,n as m,w as f,F as g,h as v,i as b,j as w,k as y,l as _,m as C,p as k,q as E,T as S,s as T,v as I,x as N,y as x,z as A,A as P,B as R,C as D,D as M,E as L,G as O,H as F,I as U,J as B,K as q,L as j,M as $}from"./vendor-C8q6etev.js";import{M as z}from"./bootstrap--QliLv9A.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const V={},W=function(e,t,a){let n=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=(null==a?void 0:a.nonce)||(null==a?void 0:a.getAttribute("nonce"));n=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in V)return;V[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,i&&n.setAttribute("nonce",i),document.head.appendChild(n),t?new Promise((t,a)=>{n.addEventListener("load",t),n.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)})},H=n("calls",{state:()=>({calls:{},waiterActiveIds:[],businessActiveIds:[],stats:{pending_count:0,total_active_calls:0},initialized:!1,loading:!1,lastSync:null}),getters:{list:e=>Object.values(e.calls).sort((e,t)=>(t.called_at||0)-(e.called_at||0)),pending:e=>Object.values(e.calls).filter(e=>"pending"===e.status),acknowledged:e=>Object.values(e.calls).filter(e=>"acknowledged"===e.status),active:e=>Object.values(e.calls).filter(e=>"completed"!==e.status),has:e=>t=>!!e.calls[t]},actions:{upsert(e){if(!e||!e.id)return;const t=this.calls[e.id];if(t){const a={pending:1,acknowledged:2,completed:3};if(a[e.status]<a[t.status])return}this.calls[e.id]={...t||{},...e},this.lastSync=Date.now()},remove(e){this.calls[e]&&delete this.calls[e]},setWaiterActive(e){this.waiterActiveIds=e||[]},updateStats(e){this.stats={...this.stats,...e||{}}},markInitialized(){this.initialized=!0}}});
/*! Capacitor: https://capacitorjs.com/ - MIT License */
var G,Y;(Y=G||(G={})).Unimplemented="UNIMPLEMENTED",Y.Unavailable="UNAVAILABLE";class K extends Error{constructor(e,t,a){super(e),this.message=e,this.code=t,this.data=a}}const Q=e=>{const t=e.CapacitorCustomPlatform||null,a=e.Capacitor||{},n=a.Plugins=a.Plugins||{},i=()=>null!==t?t.name:(e=>{var t,a;return(null==e?void 0:e.androidBridge)?"android":(null===(a=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===a?void 0:a.bridge)?"ios":"web"})(e),s=e=>{var t;return null===(t=a.PluginHeaders)||void 0===t?void 0:t.find(t=>t.name===e)},o=new Map;return a.convertFileSrc||(a.convertFileSrc=e=>e),a.getPlatform=i,a.handleError=t=>e.console.error(t),a.isNativePlatform=()=>"web"!==i(),a.isPluginAvailable=e=>{const t=o.get(e);return!!(null==t?void 0:t.platforms.has(i()))||!!s(e)},a.registerPlugin=(e,r={})=>{const l=o.get(e);if(l)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),l.proxy;const c=i(),d=s(e);let u;const h=n=>{let i;const s=(...s)=>{const o=(async()=>(!u&&c in r?u=u="function"==typeof r[c]?await r[c]():r[c]:null!==t&&!u&&"web"in r&&(u=u="function"==typeof r.web?await r.web():r.web),u))().then(t=>{const o=((t,n)=>{var i,s;if(!d){if(t)return null===(s=t[n])||void 0===s?void 0:s.bind(t);throw new K(`"${e}" plugin is not implemented on ${c}`,G.Unimplemented)}{const s=null==d?void 0:d.methods.find(e=>n===e.name);if(s)return"promise"===s.rtype?t=>a.nativePromise(e,n.toString(),t):(t,i)=>a.nativeCallback(e,n.toString(),t,i);if(t)return null===(i=t[n])||void 0===i?void 0:i.bind(t)}})(t,n);if(o){const e=o(...s);return i=null==e?void 0:e.remove,e}throw new K(`"${e}.${n}()" is not implemented on ${c}`,G.Unimplemented)});return"addListener"===n&&(o.remove=async()=>i()),o};return s.toString=()=>`${n.toString()}() { [capacitor code] }`,Object.defineProperty(s,"name",{value:n,writable:!1,configurable:!1}),s},p=h("addListener"),m=h("removeListener"),f=(e,t)=>{const a=p({eventName:e},t),n=async()=>{const n=await a;m({eventName:e,callbackId:n},t)},i=new Promise(e=>a.then(()=>e({remove:n})));return i.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await n()},i},g=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return d?f:p;case"removeListener":return m;default:return h(t)}}});return n[e]=g,o.set(e,{name:e,proxy:g,platforms:new Set([...Object.keys(r),...d?[c]:[]])}),g},a.Exception=K,a.DEBUG=!!a.DEBUG,a.isLoggingEnabled=!!a.isLoggingEnabled,a},J=(e=>e.Capacitor=Q(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),Z=J.registerPlugin;class X{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let a=!1;this.listeners[e]||(this.listeners[e]=[],a=!0),this.listeners[e].push(t);const n=this.windowListeners[e];n&&!n.registered&&this.addWindowListener(n),a&&this.sendRetainedArgumentsForEvent(e);return Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,a){const n=this.listeners[e];if(n)n.forEach(e=>e(t));else if(a){let a=this.retainedEventArguments[e];a||(a=[]),a.push(t),this.retainedEventArguments[e]=a}}hasListeners(e){var t;return!!(null===(t=this.listeners[e])||void 0===t?void 0:t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new J.Exception(e,G.Unimplemented)}unavailable(e="not available"){return new J.Exception(e,G.Unavailable)}async removeListener(e,t){const a=this.listeners[e];if(!a)return;const n=a.indexOf(t);this.listeners[e].splice(n,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(t=>{this.notifyListeners(e,t)}))}}const ee=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),te=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class ae extends X{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[a,n]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");a=te(a).trim(),n=te(n).trim(),t[a]=n}),t}async setCookie(e){try{const t=ee(e.key),a=ee(e.value),n=`; expires=${(e.expires||"").replace("expires=","")}`,i=(e.path||"/").replace("path=",""),s=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${a||""}${n}; path=${i}; ${s};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}Z("CapacitorCookies",{web:()=>new ae});const ne=(e,t={})=>{const a=Object.assign({method:e.method||"GET",headers:e.headers},t),n=((e={})=>{const t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((a,n,i)=>(a[n]=e[t[i]],a),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)a.body=e.data;else if(n.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[a,n]of Object.entries(e.data||{}))t.set(a,n);a.body=t.toString()}else if(n.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,a)=>{t.append(a,e)});else for(const a of Object.keys(e.data))t.append(a,e.data[a]);a.body=t;const n=new Headers(a.headers);n.delete("content-type"),a.headers=n}else(n.includes("application/json")||"object"==typeof e.data)&&(a.body=JSON.stringify(e.data));return a};class ie extends X{async request(e){const t=ne(e,e.webFetchExtra),a=((e,t=!0)=>e?Object.entries(e).reduce((e,a)=>{const[n,i]=a;let s,o;return Array.isArray(i)?(o="",i.forEach(e=>{s=t?encodeURIComponent(e):e,o+=`${n}=${s}&`}),o.slice(0,-1)):(s=t?encodeURIComponent(i):i,o=`${n}=${s}`),`${e}&${o}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),n=a?`${e.url}?${a}`:e.url,i=await fetch(n,t),s=i.headers.get("content-type")||"";let o,r,{responseType:l="text"}=i.ok?e:{};switch(s.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":r=await i.blob(),o=await(async e=>new Promise((t,a)=>{const n=new FileReader;n.onload=()=>{const e=n.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},n.onerror=e=>a(e),n.readAsDataURL(e)}))(r);break;case"json":o=await i.json();break;default:o=await i.text()}const c={};return i.headers.forEach((e,t)=>{c[t]=e}),{data:o,headers:c,status:i.status,url:i.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}Z("CapacitorHttp",{web:()=>new ie});const se=Object.freeze(Object.defineProperty({__proto__:null,Capacitor:J,CapacitorException:K,get ExceptionCode(){return G},WebPlugin:X,buildRequestInit:ne,registerPlugin:Z},Symbol.toStringTag,{value:"Module"})),oe=Z("App",{web:()=>W(()=>import("./web-CWH0Jbc6.js"),__vite__mapDeps([0,1,2])).then(e=>new e.AppWeb)}),re=n("ui",()=>{const e=i(!1);return{isOffCanvasOpen:e,toggleOffCanvas:function(){e.value=!e.value},closeOffCanvas:function(){e.value=!1}}});function le(e,t){return function(){return e.apply(t,arguments)}}const{toString:ce}=Object.prototype,{getPrototypeOf:de}=Object,{iterator:ue,toStringTag:he}=Symbol,pe=(e=>t=>{const a=ce.call(t);return e[a]||(e[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),me=e=>(e=e.toLowerCase(),t=>pe(t)===e),fe=e=>t=>typeof t===e,{isArray:ge}=Array,ve=fe("undefined");const be=me("ArrayBuffer");const we=fe("string"),ye=fe("function"),_e=fe("number"),Ce=e=>null!==e&&"object"==typeof e,ke=e=>{if("object"!==pe(e))return!1;const t=de(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||he in e||ue in e)},Ee=me("Date"),Se=me("File"),Te=me("Blob"),Ie=me("FileList"),Ne=me("URLSearchParams"),[xe,Ae,Pe,Re]=["ReadableStream","Request","Response","Headers"].map(me);function De(e,t,{allOwnKeys:a=!1}={}){if(null==e)return;let n,i;if("object"!=typeof e&&(e=[e]),ge(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const i=a?Object.getOwnPropertyNames(e):Object.keys(e),s=i.length;let o;for(n=0;n<s;n++)o=i[n],t.call(null,e[o],o,e)}}function Me(e,t){t=t.toLowerCase();const a=Object.keys(e);let n,i=a.length;for(;i-- >0;)if(n=a[i],t===n.toLowerCase())return n;return null}const Le="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Oe=e=>!ve(e)&&e!==Le;const Fe=(e=>t=>e&&t instanceof e)("undefined"!=typeof Uint8Array&&de(Uint8Array)),Ue=me("HTMLFormElement"),Be=(({hasOwnProperty:e})=>(t,a)=>e.call(t,a))(Object.prototype),qe=me("RegExp"),je=(e,t)=>{const a=Object.getOwnPropertyDescriptors(e),n={};De(a,(a,i)=>{let s;!1!==(s=t(a,i,e))&&(n[i]=s||a)}),Object.defineProperties(e,n)};const $e=me("AsyncFunction"),ze=(Ve="function"==typeof setImmediate,We=ye(Le.postMessage),Ve?setImmediate:We?(He=`axios@${Math.random()}`,Ge=[],Le.addEventListener("message",({source:e,data:t})=>{e===Le&&t===He&&Ge.length&&Ge.shift()()},!1),e=>{Ge.push(e),Le.postMessage(He,"*")}):e=>setTimeout(e));var Ve,We,He,Ge;const Ye="undefined"!=typeof queueMicrotask?queueMicrotask.bind(Le):"undefined"!=typeof process&&process.nextTick||ze,Ke={isArray:ge,isArrayBuffer:be,isBuffer:function(e){return null!==e&&!ve(e)&&null!==e.constructor&&!ve(e.constructor)&&ye(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||ye(e.append)&&("formdata"===(t=pe(e))||"object"===t&&ye(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&be(e.buffer),t},isString:we,isNumber:_e,isBoolean:e=>!0===e||!1===e,isObject:Ce,isPlainObject:ke,isReadableStream:xe,isRequest:Ae,isResponse:Pe,isHeaders:Re,isUndefined:ve,isDate:Ee,isFile:Se,isBlob:Te,isRegExp:qe,isFunction:ye,isStream:e=>Ce(e)&&ye(e.pipe),isURLSearchParams:Ne,isTypedArray:Fe,isFileList:Ie,forEach:De,merge:function e(){const{caseless:t}=Oe(this)&&this||{},a={},n=(n,i)=>{const s=t&&Me(a,i)||i;ke(a[s])&&ke(n)?a[s]=e(a[s],n):ke(n)?a[s]=e({},n):ge(n)?a[s]=n.slice():a[s]=n};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&De(arguments[i],n);return a},extend:(e,t,a,{allOwnKeys:n}={})=>(De(t,(t,n)=>{a&&ye(t)?e[n]=le(t,a):e[n]=t},{allOwnKeys:n}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,a,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),a&&Object.assign(e.prototype,a)},toFlatObject:(e,t,a,n)=>{let i,s,o;const r={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)o=i[s],n&&!n(o,e,t)||r[o]||(t[o]=e[o],r[o]=!0);e=!1!==a&&de(e)}while(e&&(!a||a(e,t))&&e!==Object.prototype);return t},kindOf:pe,kindOfTest:me,endsWith:(e,t,a)=>{e=String(e),(void 0===a||a>e.length)&&(a=e.length),a-=t.length;const n=e.indexOf(t,a);return-1!==n&&n===a},toArray:e=>{if(!e)return null;if(ge(e))return e;let t=e.length;if(!_e(t))return null;const a=new Array(t);for(;t-- >0;)a[t]=e[t];return a},forEachEntry:(e,t)=>{const a=(e&&e[ue]).call(e);let n;for(;(n=a.next())&&!n.done;){const a=n.value;t.call(e,a[0],a[1])}},matchAll:(e,t)=>{let a;const n=[];for(;null!==(a=e.exec(t));)n.push(a);return n},isHTMLForm:Ue,hasOwnProperty:Be,hasOwnProp:Be,reduceDescriptors:je,freezeMethods:e=>{je(e,(t,a)=>{if(ye(e)&&-1!==["arguments","caller","callee"].indexOf(a))return!1;const n=e[a];ye(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")}))})},toObjectSet:(e,t)=>{const a={},n=e=>{e.forEach(e=>{a[e]=!0})};return ge(e)?n(e):n(String(e).split(t)),a},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,a){return t.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Me,global:Le,isContextDefined:Oe,isSpecCompliantForm:function(e){return!!(e&&ye(e.append)&&"FormData"===e[he]&&e[ue])},toJSONObject:e=>{const t=new Array(10),a=(e,n)=>{if(Ce(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const i=ge(e)?[]:{};return De(e,(e,t)=>{const s=a(e,n+1);!ve(s)&&(i[t]=s)}),t[n]=void 0,i}}return e};return a(e,0)},isAsyncFn:$e,isThenable:e=>e&&(Ce(e)||ye(e))&&ye(e.then)&&ye(e.catch),setImmediate:ze,asap:Ye,isIterable:e=>null!=e&&ye(e[ue])};function Qe(e,t,a,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),a&&(this.config=a),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}Ke.inherits(Qe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ke.toJSONObject(this.config),code:this.code,status:this.status}}});const Je=Qe.prototype,Ze={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Ze[e]={value:e}}),Object.defineProperties(Qe,Ze),Object.defineProperty(Je,"isAxiosError",{value:!0}),Qe.from=(e,t,a,n,i,s)=>{const o=Object.create(Je);return Ke.toFlatObject(e,o,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),Qe.call(o,e.message,t,a,n,i),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};function Xe(e){return Ke.isPlainObject(e)||Ke.isArray(e)}function et(e){return Ke.endsWith(e,"[]")?e.slice(0,-2):e}function tt(e,t,a){return e?e.concat(t).map(function(e,t){return e=et(e),!a&&t?"["+e+"]":e}).join(a?".":""):t}const at=Ke.toFlatObject(Ke,{},null,function(e){return/^is[A-Z]/.test(e)});function nt(e,t,a){if(!Ke.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(a=Ke.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!Ke.isUndefined(t[e])})).metaTokens,i=a.visitor||c,s=a.dots,o=a.indexes,r=(a.Blob||"undefined"!=typeof Blob&&Blob)&&Ke.isSpecCompliantForm(t);if(!Ke.isFunction(i))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(Ke.isDate(e))return e.toISOString();if(!r&&Ke.isBlob(e))throw new Qe("Blob is not supported. Use a Buffer instead.");return Ke.isArrayBuffer(e)||Ke.isTypedArray(e)?r&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,a,i){let r=e;if(e&&!i&&"object"==typeof e)if(Ke.endsWith(a,"{}"))a=n?a:a.slice(0,-2),e=JSON.stringify(e);else if(Ke.isArray(e)&&function(e){return Ke.isArray(e)&&!e.some(Xe)}(e)||(Ke.isFileList(e)||Ke.endsWith(a,"[]"))&&(r=Ke.toArray(e)))return a=et(a),r.forEach(function(e,n){!Ke.isUndefined(e)&&null!==e&&t.append(!0===o?tt([a],n,s):null===o?a:a+"[]",l(e))}),!1;return!!Xe(e)||(t.append(tt(i,a,s),l(e)),!1)}const d=[],u=Object.assign(at,{defaultVisitor:c,convertValue:l,isVisitable:Xe});if(!Ke.isObject(e))throw new TypeError("data must be an object");return function e(a,n){if(!Ke.isUndefined(a)){if(-1!==d.indexOf(a))throw Error("Circular reference detected in "+n.join("."));d.push(a),Ke.forEach(a,function(a,s){!0===(!(Ke.isUndefined(a)||null===a)&&i.call(t,a,Ke.isString(s)?s.trim():s,n,u))&&e(a,n?n.concat(s):[s])}),d.pop()}}(e),t}function it(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function st(e,t){this._pairs=[],e&&nt(e,this,t)}const ot=st.prototype;function rt(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function lt(e,t,a){if(!t)return e;const n=a&&a.encode||rt;Ke.isFunction(a)&&(a={serialize:a});const i=a&&a.serialize;let s;if(s=i?i(t,a):Ke.isURLSearchParams(t)?t.toString():new st(t,a).toString(n),s){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}ot.append=function(e,t){this._pairs.push([e,t])},ot.toString=function(e){const t=e?function(t){return e.call(this,t,it)}:it;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};class ct{constructor(){this.handlers=[]}use(e,t,a){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!a&&a.synchronous,runWhen:a?a.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ke.forEach(this.handlers,function(t){null!==t&&e(t)})}}const dt={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ut={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:st,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},ht="undefined"!=typeof window&&"undefined"!=typeof document,pt="object"==typeof navigator&&navigator||void 0,mt=ht&&(!pt||["ReactNative","NativeScript","NS"].indexOf(pt.product)<0),ft="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,gt=ht&&window.location.href||"http://localhost",vt={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ht,hasStandardBrowserEnv:mt,hasStandardBrowserWebWorkerEnv:ft,navigator:pt,origin:gt},Symbol.toStringTag,{value:"Module"})),...ut};function bt(e){function t(e,a,n,i){let s=e[i++];if("__proto__"===s)return!0;const o=Number.isFinite(+s),r=i>=e.length;if(s=!s&&Ke.isArray(n)?n.length:s,r)return Ke.hasOwnProp(n,s)?n[s]=[n[s],a]:n[s]=a,!o;n[s]&&Ke.isObject(n[s])||(n[s]=[]);return t(e,a,n[s],i)&&Ke.isArray(n[s])&&(n[s]=function(e){const t={},a=Object.keys(e);let n;const i=a.length;let s;for(n=0;n<i;n++)s=a[n],t[s]=e[s];return t}(n[s])),!o}if(Ke.isFormData(e)&&Ke.isFunction(e.entries)){const a={};return Ke.forEachEntry(e,(e,n)=>{t(function(e){return Ke.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),n,a,0)}),a}return null}const wt={transitional:dt,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const a=t.getContentType()||"",n=a.indexOf("application/json")>-1,i=Ke.isObject(e);i&&Ke.isHTMLForm(e)&&(e=new FormData(e));if(Ke.isFormData(e))return n?JSON.stringify(bt(e)):e;if(Ke.isArrayBuffer(e)||Ke.isBuffer(e)||Ke.isStream(e)||Ke.isFile(e)||Ke.isBlob(e)||Ke.isReadableStream(e))return e;if(Ke.isArrayBufferView(e))return e.buffer;if(Ke.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(a.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return nt(e,new vt.classes.URLSearchParams,Object.assign({visitor:function(e,t,a,n){return vt.isNode&&Ke.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((s=Ke.isFileList(e))||a.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return nt(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),function(e,t,a){if(Ke.isString(e))try{return(t||JSON.parse)(e),Ke.trim(e)}catch(n){if("SyntaxError"!==n.name)throw n}return(a||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||wt.transitional,a=t&&t.forcedJSONParsing,n="json"===this.responseType;if(Ke.isResponse(e)||Ke.isReadableStream(e))return e;if(e&&Ke.isString(e)&&(a&&!this.responseType||n)){const a=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(i){if(a){if("SyntaxError"===i.name)throw Qe.from(i,Qe.ERR_BAD_RESPONSE,this,null,this.response);throw i}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:vt.classes.FormData,Blob:vt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ke.forEach(["delete","get","head","post","put","patch"],e=>{wt.headers[e]={}});const yt=Ke.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),_t=Symbol("internals");function Ct(e){return e&&String(e).trim().toLowerCase()}function kt(e){return!1===e||null==e?e:Ke.isArray(e)?e.map(kt):String(e)}function Et(e,t,a,n,i){return Ke.isFunction(n)?n.call(this,t,a):(i&&(t=a),Ke.isString(t)?Ke.isString(n)?-1!==t.indexOf(n):Ke.isRegExp(n)?n.test(t):void 0:void 0)}let St=class{constructor(e){e&&this.set(e)}set(e,t,a){const n=this;function i(e,t,a){const i=Ct(t);if(!i)throw new Error("header name must be a non-empty string");const s=Ke.findKey(n,i);(!s||void 0===n[s]||!0===a||void 0===a&&!1!==n[s])&&(n[s||t]=kt(e))}const s=(e,t)=>Ke.forEach(e,(e,a)=>i(e,a,t));if(Ke.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(Ke.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))s((e=>{const t={};let a,n,i;return e&&e.split("\n").forEach(function(e){i=e.indexOf(":"),a=e.substring(0,i).trim().toLowerCase(),n=e.substring(i+1).trim(),!a||t[a]&&yt[a]||("set-cookie"===a?t[a]?t[a].push(n):t[a]=[n]:t[a]=t[a]?t[a]+", "+n:n)}),t})(e),t);else if(Ke.isObject(e)&&Ke.isIterable(e)){let a,n,i={};for(const t of e){if(!Ke.isArray(t))throw TypeError("Object iterator must return a key-value pair");i[n=t[0]]=(a=i[n])?Ke.isArray(a)?[...a,t[1]]:[a,t[1]]:t[1]}s(i,t)}else null!=e&&i(t,e,a);return this}get(e,t){if(e=Ct(e)){const a=Ke.findKey(this,e);if(a){const e=this[a];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=a.exec(e);)t[n[1]]=n[2];return t}(e);if(Ke.isFunction(t))return t.call(this,e,a);if(Ke.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ct(e)){const a=Ke.findKey(this,e);return!(!a||void 0===this[a]||t&&!Et(0,this[a],a,t))}return!1}delete(e,t){const a=this;let n=!1;function i(e){if(e=Ct(e)){const i=Ke.findKey(a,e);!i||t&&!Et(0,a[i],i,t)||(delete a[i],n=!0)}}return Ke.isArray(e)?e.forEach(i):i(e),n}clear(e){const t=Object.keys(this);let a=t.length,n=!1;for(;a--;){const i=t[a];e&&!Et(0,this[i],i,e,!0)||(delete this[i],n=!0)}return n}normalize(e){const t=this,a={};return Ke.forEach(this,(n,i)=>{const s=Ke.findKey(a,i);if(s)return t[s]=kt(n),void delete t[i];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,a)=>t.toUpperCase()+a)}(i):String(i).trim();o!==i&&delete t[i],t[o]=kt(n),a[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Ke.forEach(this,(a,n)=>{null!=a&&!1!==a&&(t[n]=e&&Ke.isArray(a)?a.join(", "):a)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const a=new this(e);return t.forEach(e=>a.set(e)),a}static accessor(e){const t=(this[_t]=this[_t]={accessors:{}}).accessors,a=this.prototype;function n(e){const n=Ct(e);t[n]||(!function(e,t){const a=Ke.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+a,{value:function(e,a,i){return this[n].call(this,t,e,a,i)},configurable:!0})})}(a,e),t[n]=!0)}return Ke.isArray(e)?e.forEach(n):n(e),this}};function Tt(e,t){const a=this||wt,n=t||a,i=St.from(n.headers);let s=n.data;return Ke.forEach(e,function(e){s=e.call(a,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function It(e){return!(!e||!e.__CANCEL__)}function Nt(e,t,a){Qe.call(this,null==e?"canceled":e,Qe.ERR_CANCELED,t,a),this.name="CanceledError"}function xt(e,t,a){const n=a.config.validateStatus;a.status&&n&&!n(a.status)?t(new Qe("Request failed with status code "+a.status,[Qe.ERR_BAD_REQUEST,Qe.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a)):e(a)}St.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ke.reduceDescriptors(St.prototype,({value:e},t)=>{let a=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[a]=e}}}),Ke.freezeMethods(St),Ke.inherits(Nt,Qe,{__CANCEL__:!0});const At=(e,t,a=3)=>{let n=0;const i=function(e,t){e=e||10;const a=new Array(e),n=new Array(e);let i,s=0,o=0;return t=void 0!==t?t:1e3,function(r){const l=Date.now(),c=n[o];i||(i=l),a[s]=r,n[s]=l;let d=o,u=0;for(;d!==s;)u+=a[d++],d%=e;if(s=(s+1)%e,s===o&&(o=(o+1)%e),l-i<t)return;const h=c&&l-c;return h?Math.round(1e3*u/h):void 0}}(50,250);return function(e,t){let a,n,i=0,s=1e3/t;const o=(t,s=Date.now())=>{i=s,a=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[(...e)=>{const t=Date.now(),r=t-i;r>=s?o(e,t):(a=e,n||(n=setTimeout(()=>{n=null,o(a)},s-r)))},()=>a&&o(a)]}(a=>{const s=a.loaded,o=a.lengthComputable?a.total:void 0,r=s-n,l=i(r);n=s;e({loaded:s,total:o,progress:o?s/o:void 0,bytes:r,rate:l||void 0,estimated:l&&o&&s<=o?(o-s)/l:void 0,event:a,lengthComputable:null!=o,[t?"download":"upload"]:!0})},a)},Pt=(e,t)=>{const a=null!=e;return[n=>t[0]({lengthComputable:a,total:e,loaded:n}),t[1]]},Rt=e=>(...t)=>Ke.asap(()=>e(...t)),Dt=vt.hasStandardBrowserEnv?((e,t)=>a=>(a=new URL(a,vt.origin),e.protocol===a.protocol&&e.host===a.host&&(t||e.port===a.port)))(new URL(vt.origin),vt.navigator&&/(msie|trident)/i.test(vt.navigator.userAgent)):()=>!0,Mt=vt.hasStandardBrowserEnv?{write(e,t,a,n,i,s){const o=[e+"="+encodeURIComponent(t)];Ke.isNumber(a)&&o.push("expires="+new Date(a).toGMTString()),Ke.isString(n)&&o.push("path="+n),Ke.isString(i)&&o.push("domain="+i),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Lt(e,t,a){let n=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(n||0==a)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Ot=e=>e instanceof St?{...e}:e;function Ft(e,t){t=t||{};const a={};function n(e,t,a,n){return Ke.isPlainObject(e)&&Ke.isPlainObject(t)?Ke.merge.call({caseless:n},e,t):Ke.isPlainObject(t)?Ke.merge({},t):Ke.isArray(t)?t.slice():t}function i(e,t,a,i){return Ke.isUndefined(t)?Ke.isUndefined(e)?void 0:n(void 0,e,0,i):n(e,t,0,i)}function s(e,t){if(!Ke.isUndefined(t))return n(void 0,t)}function o(e,t){return Ke.isUndefined(t)?Ke.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function r(a,i,s){return s in t?n(a,i):s in e?n(void 0,a):void 0}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:r,headers:(e,t,a)=>i(Ot(e),Ot(t),0,!0)};return Ke.forEach(Object.keys(Object.assign({},e,t)),function(n){const s=l[n]||i,o=s(e[n],t[n],n);Ke.isUndefined(o)&&s!==r||(a[n]=o)}),a}const Ut=e=>{const t=Ft({},e);let a,{data:n,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:o,headers:r,auth:l}=t;if(t.headers=r=St.from(r),t.url=lt(Lt(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&r.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),Ke.isFormData(n))if(vt.hasStandardBrowserEnv||vt.hasStandardBrowserWebWorkerEnv)r.setContentType(void 0);else if(!1!==(a=r.getContentType())){const[e,...t]=a?a.split(";").map(e=>e.trim()).filter(Boolean):[];r.setContentType([e||"multipart/form-data",...t].join("; "))}if(vt.hasStandardBrowserEnv&&(i&&Ke.isFunction(i)&&(i=i(t)),i||!1!==i&&Dt(t.url))){const e=s&&o&&Mt.read(o);e&&r.set(s,e)}return t},Bt="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,a){const n=Ut(e);let i=n.data;const s=St.from(n.headers).normalize();let o,r,l,c,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=n;function m(){c&&c(),d&&d(),n.cancelToken&&n.cancelToken.unsubscribe(o),n.signal&&n.signal.removeEventListener("abort",o)}let f=new XMLHttpRequest;function g(){if(!f)return;const n=St.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());xt(function(e){t(e),m()},function(e){a(e),m()},{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:n,config:e,request:f}),f=null}f.open(n.method.toUpperCase(),n.url,!0),f.timeout=n.timeout,"onloadend"in f?f.onloadend=g:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(g)},f.onabort=function(){f&&(a(new Qe("Request aborted",Qe.ECONNABORTED,e,f)),f=null)},f.onerror=function(){a(new Qe("Network Error",Qe.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const i=n.transitional||dt;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),a(new Qe(t,i.clarifyTimeoutError?Qe.ETIMEDOUT:Qe.ECONNABORTED,e,f)),f=null},void 0===i&&s.setContentType(null),"setRequestHeader"in f&&Ke.forEach(s.toJSON(),function(e,t){f.setRequestHeader(t,e)}),Ke.isUndefined(n.withCredentials)||(f.withCredentials=!!n.withCredentials),u&&"json"!==u&&(f.responseType=n.responseType),p&&([l,d]=At(p,!0),f.addEventListener("progress",l)),h&&f.upload&&([r,c]=At(h),f.upload.addEventListener("progress",r),f.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(o=t=>{f&&(a(!t||t.type?new Nt(null,e,f):t),f.abort(),f=null)},n.cancelToken&&n.cancelToken.subscribe(o),n.signal&&(n.signal.aborted?o():n.signal.addEventListener("abort",o)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);v&&-1===vt.protocols.indexOf(v)?a(new Qe("Unsupported protocol "+v+":",Qe.ERR_BAD_REQUEST,e)):f.send(i||null)})},qt=(e,t)=>{const{length:a}=e=e?e.filter(Boolean):[];if(t||a){let a,n=new AbortController;const i=function(e){if(!a){a=!0,o();const t=e instanceof Error?e:this.reason;n.abort(t instanceof Qe?t:new Nt(t instanceof Error?t.message:t))}};let s=t&&setTimeout(()=>{s=null,i(new Qe(`timeout ${t} of ms exceeded`,Qe.ETIMEDOUT))},t);const o=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)}),e=null)};e.forEach(e=>e.addEventListener("abort",i));const{signal:r}=n;return r.unsubscribe=()=>Ke.asap(o),r}},jt=function*(e,t){let a=e.byteLength;if(a<t)return void(yield e);let n,i=0;for(;i<a;)n=i+t,yield e.slice(i,n),i=n},$t=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:a}=await t.read();if(e)break;yield a}}finally{await t.cancel()}},zt=(e,t,a,n)=>{const i=async function*(e,t){for await(const a of $t(e))yield*jt(a,t)}(e,t);let s,o=0,r=e=>{s||(s=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await i.next();if(t)return r(),void e.close();let s=n.byteLength;if(a){let e=o+=s;a(e)}e.enqueue(new Uint8Array(n))}catch(t){throw r(t),t}},cancel:e=>(r(e),i.return())},{highWaterMark:2})},Vt="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,Wt=Vt&&"function"==typeof ReadableStream,Ht=Vt&&("function"==typeof TextEncoder?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),Gt=(e,...t)=>{try{return!!e(...t)}catch(a){return!1}},Yt=Wt&&Gt(()=>{let e=!1;const t=new Request(vt.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),Kt=Wt&&Gt(()=>Ke.isReadableStream(new Response("").body)),Qt={stream:Kt&&(e=>e.body)};var Jt;Vt&&(Jt=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Qt[e]&&(Qt[e]=Ke.isFunction(Jt[e])?t=>t[e]():(t,a)=>{throw new Qe(`Response type '${e}' is not supported`,Qe.ERR_NOT_SUPPORT,a)})}));const Zt=async(e,t)=>{const a=Ke.toFiniteNumber(e.getContentLength());return null==a?(async e=>{if(null==e)return 0;if(Ke.isBlob(e))return e.size;if(Ke.isSpecCompliantForm(e)){const t=new Request(vt.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return Ke.isArrayBufferView(e)||Ke.isArrayBuffer(e)?e.byteLength:(Ke.isURLSearchParams(e)&&(e+=""),Ke.isString(e)?(await Ht(e)).byteLength:void 0)})(t):a},Xt={http:null,xhr:Bt,fetch:Vt&&(async e=>{let{url:t,method:a,data:n,signal:i,cancelToken:s,timeout:o,onDownloadProgress:r,onUploadProgress:l,responseType:c,headers:d,withCredentials:u="same-origin",fetchOptions:h}=Ut(e);c=c?(c+"").toLowerCase():"text";let p,m=qt([i,s&&s.toAbortSignal()],o);const f=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let g;try{if(l&&Yt&&"get"!==a&&"head"!==a&&0!==(g=await Zt(d,n))){let e,a=new Request(t,{method:"POST",body:n,duplex:"half"});if(Ke.isFormData(n)&&(e=a.headers.get("content-type"))&&d.setContentType(e),a.body){const[e,t]=Pt(g,At(Rt(l)));n=zt(a.body,65536,e,t)}}Ke.isString(u)||(u=u?"include":"omit");const i="credentials"in Request.prototype;p=new Request(t,{...h,signal:m,method:a.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:i?u:void 0});let s=await fetch(p);const o=Kt&&("stream"===c||"response"===c);if(Kt&&(r||o&&f)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=s[t]});const t=Ke.toFiniteNumber(s.headers.get("content-length")),[a,n]=r&&Pt(t,At(Rt(r),!0))||[];s=new Response(zt(s.body,65536,a,()=>{n&&n(),f&&f()}),e)}c=c||"text";let v=await Qt[Ke.findKey(Qt,c)||"text"](s,e);return!o&&f&&f(),await new Promise((t,a)=>{xt(t,a,{data:v,headers:St.from(s.headers),status:s.status,statusText:s.statusText,config:e,request:p})})}catch(v){if(f&&f(),v&&"TypeError"===v.name&&/Load failed|fetch/i.test(v.message))throw Object.assign(new Qe("Network Error",Qe.ERR_NETWORK,e,p),{cause:v.cause||v});throw Qe.from(v,v&&v.code,e,p)}})};Ke.forEach(Xt,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(a){}Object.defineProperty(e,"adapterName",{value:t})}});const ea=e=>`- ${e}`,ta=e=>Ke.isFunction(e)||null===e||!1===e,aa=e=>{e=Ke.isArray(e)?e:[e];const{length:t}=e;let a,n;const i={};for(let s=0;s<t;s++){let t;if(a=e[s],n=a,!ta(a)&&(n=Xt[(t=String(a)).toLowerCase()],void 0===n))throw new Qe(`Unknown adapter '${t}'`);if(n)break;i[t||"#"+s]=n}if(!n){const e=Object.entries(i).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new Qe("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(ea).join("\n"):" "+ea(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n};function na(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Nt(null,e)}function ia(e){na(e),e.headers=St.from(e.headers),e.data=Tt.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return aa(e.adapter||wt.adapter)(e).then(function(t){return na(e),t.data=Tt.call(e,e.transformResponse,t),t.headers=St.from(t.headers),t},function(t){return It(t)||(na(e),t&&t.response&&(t.response.data=Tt.call(e,e.transformResponse,t.response),t.response.headers=St.from(t.response.headers))),Promise.reject(t)})}const sa="1.9.0",oa={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{oa[e]=function(a){return typeof a===e||"a"+(t<1?"n ":" ")+e}});const ra={};oa.transitional=function(e,t,a){function n(e,t){return"[Axios v1.9.0] Transitional option '"+e+"'"+t+(a?". "+a:"")}return(a,i,s)=>{if(!1===e)throw new Qe(n(i," has been removed"+(t?" in "+t:"")),Qe.ERR_DEPRECATED);return t&&!ra[i]&&(ra[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(a,i,s)}},oa.spelling=function(e){return(t,a)=>(console.warn(`${a} is likely a misspelling of ${e}`),!0)};const la={assertOptions:function(e,t,a){if("object"!=typeof e)throw new Qe("options must be an object",Qe.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let i=n.length;for(;i-- >0;){const s=n[i],o=t[s];if(o){const t=e[s],a=void 0===t||o(t,s,e);if(!0!==a)throw new Qe("option "+s+" must be "+a,Qe.ERR_BAD_OPTION_VALUE);continue}if(!0!==a)throw new Qe("Unknown option "+s,Qe.ERR_BAD_OPTION)}},validators:oa},ca=la.validators;let da=class{constructor(e){this.defaults=e||{},this.interceptors={request:new ct,response:new ct}}async request(e,t){try{return await this._request(e,t)}catch(a){if(a instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{a.stack?t&&!String(a.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(a.stack+="\n"+t):a.stack=t}catch(n){}}throw a}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Ft(this.defaults,t);const{transitional:a,paramsSerializer:n,headers:i}=t;void 0!==a&&la.assertOptions(a,{silentJSONParsing:ca.transitional(ca.boolean),forcedJSONParsing:ca.transitional(ca.boolean),clarifyTimeoutError:ca.transitional(ca.boolean)},!1),null!=n&&(Ke.isFunction(n)?t.paramsSerializer={serialize:n}:la.assertOptions(n,{encode:ca.function,serialize:ca.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),la.assertOptions(t,{baseUrl:ca.spelling("baseURL"),withXsrfToken:ca.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&Ke.merge(i.common,i[t.method]);i&&Ke.forEach(["delete","get","head","post","put","patch","common"],e=>{delete i[e]}),t.headers=St.concat(s,i);const o=[];let r=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(r=r&&e.synchronous,o.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let d,u=0;if(!r){const e=[ia.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,l),d=e.length,c=Promise.resolve(t);u<d;)c=c.then(e[u++],e[u++]);return c}d=o.length;let h=t;for(u=0;u<d;){const e=o[u++],t=o[u++];try{h=e(h)}catch(p){t.call(this,p);break}}try{c=ia.call(this,h)}catch(p){return Promise.reject(p)}for(u=0,d=l.length;u<d;)c=c.then(l[u++],l[u++]);return c}getUri(e){return lt(Lt((e=Ft(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Ke.forEach(["delete","get","head","options"],function(e){da.prototype[e]=function(t,a){return this.request(Ft(a||{},{method:e,url:t,data:(a||{}).data}))}}),Ke.forEach(["post","put","patch"],function(e){function t(t){return function(a,n,i){return this.request(Ft(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:a,data:n}))}}da.prototype[e]=t(),da.prototype[e+"Form"]=t(!0)});const ua={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ua).forEach(([e,t])=>{ua[t]=e});const ha=function e(t){const a=new da(t),n=le(da.prototype.request,a);return Ke.extend(n,da.prototype,a,{allOwnKeys:!0}),Ke.extend(n,a,null,{allOwnKeys:!0}),n.create=function(a){return e(Ft(t,a))},n}(wt);ha.Axios=da,ha.CanceledError=Nt,ha.CancelToken=class e{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const a=this;this.promise.then(e=>{if(!a._listeners)return;let t=a._listeners.length;for(;t-- >0;)a._listeners[t](e);a._listeners=null}),this.promise.then=e=>{let t;const n=new Promise(e=>{a.subscribe(e),t=e}).then(e);return n.cancel=function(){a.unsubscribe(t)},n},e(function(e,n,i){a.reason||(a.reason=new Nt(e,n,i),t(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;return{token:new e(function(e){t=e}),cancel:t}}},ha.isCancel=It,ha.VERSION=sa,ha.toFormData=nt,ha.AxiosError=Qe,ha.Cancel=ha.CanceledError,ha.all=function(e){return Promise.all(e)},ha.spread=function(e){return function(t){return e.apply(null,t)}},ha.isAxiosError=function(e){return Ke.isObject(e)&&!0===e.isAxiosError},ha.mergeConfig=Ft,ha.AxiosHeaders=St,ha.formToJSON=e=>bt(Ke.isHTMLForm(e)?new FormData(e):e),ha.getAdapter=aa,ha.HttpStatusCode=ua,ha.default=ha;const{Axios:pa,AxiosError:ma,CanceledError:fa,isCancel:ga,CancelToken:va,VERSION:ba,all:wa,Cancel:ya,isAxiosError:_a,spread:Ca,toFormData:ka,AxiosHeaders:Ea,HttpStatusCode:Sa,formToJSON:Ta,getAdapter:Ia,mergeConfig:Na}=ha,xa=ha.create({baseURL:"https://mozoqr.com/api",headers:{"Content-Type":"application/json",Accept:"application/json"}});xa.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),xa.interceptors.response.use(e=>{try{const t=e.data;if(t){const e=t.token||t.access_token||t.plainTextToken||t.user&&t.user.token||t.user&&t.user.access_token;e&&localStorage.setItem("token",e)}}catch(t){}return e},e=>(e.response&&401===e.response.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),e.message=(e=>{if(e.response){const t=e.response.data;if(t){if("string"==typeof t)return t;if(t.message)return t.message;if(t.error)return t.error}return`Error ${e.response.status}: ${e.response.statusText||"Error en la respuesta del servidor"}`}return e.request?"No se recibió respuesta del servidor. Verifique su conexión.":e.message||"Ocurrió un error desconocido."})(e),Promise.reject(e)));const Aa={login:e=>xa.post("login",e),loginWithGoogle:e=>xa.post("login/google",{token:e}),forgotPassword:e=>xa.post("forgot-password",e),resetPassword:e=>xa.post("reset-password",e),callWaiter:e=>xa.post(`tables/${e}/call-waiter`),register:e=>xa.post("register",e),getCurrentUser:()=>xa.get("user"),logout:()=>xa.post("logout"),selectRole:e=>xa.post("role/select",{role:e}),updateProfile:e=>xa.post("profile/update",e,{headers:{"Content-Type":"multipart/form-data"}}),sendWhatsAppMessage:e=>xa.post("profile/whatsapp/send",e),getNotifications:()=>xa.get("notifications"),handleNotification:(e,t)=>xa.post(`notifications/handle/${e}`,t),globalNotifications:e=>xa.post("notifications/global",e),storeDeviceToken:e=>xa.post("device-token",e),deleteDeviceToken:e=>xa.delete("device-token",{data:e}),toggleTableNotifications:e=>xa.post(`tables/toggle-notifications/${e}`),waiterOnboard:e=>xa.post("waiter/onboard",{code:e}),getWaiterTables:()=>xa.get("waiter/tables"),listWaiterProfiles:()=>xa.get("waiter/profiles"),createWaiterProfile:e=>xa.post("waiter/profiles",e),deleteWaiterProfile:e=>xa.delete(`waiter/profiles/${e}`),getWaiterNotifications:()=>xa.get("waiter/notifications"),handleWaiterNotification:(e,t)=>xa.post(`waiter/notifications/handle/${e}`,t),waiterGlobalNotifications:e=>xa.post("waiter/notifications/global",e),waiterToggleTableNotifications:e=>xa.post(`waiter/tables/toggle-notifications/${e}`),getBusinessInfo:()=>xa.get("admin/business"),switchView:e=>xa.post("admin/switch-view",e),removeStaff:e=>xa.delete(`admin/staff/${e}`),handleStaffRequest:(e,t)=>xa.post(`admin/staff/request/${e}`,t),getStaffRequests:()=>xa.get("admin/staff/requests"),getArchivedStaffRequests:()=>xa.get("admin/staff/requests/archived"),getTables:()=>xa.get("tables"),createTable:e=>xa.post("tables",e),updateTable:(e,t)=>xa.put(`tables/${e}`,t),deleteTable:e=>xa.delete(`tables/${e}`),getMenus:()=>xa.get("menus"),uploadMenu:e=>xa.post("menus",e,{headers:{"Content-Type":"multipart/form-data"}}),setDefaultMenu:e=>xa.post("menus/default",e),generateQRCode:e=>{const t="https://mozoqr.com";return console.log("🔍 Generating QR with base URL:",t),console.log("📋 Environment vars:",{VITE_QR_BASE_URL:"https://mozoqr.com",VITE_URL_API:"https://mozoqr.com/api/",window_origin:window.location.origin}),xa.post(`admin/qr/generate/${e}`,{base_url:t})},exportQR:e=>xa.post("admin/qr/export",e),getSettings:()=>xa.get("admin/settings"),updateSettings:e=>xa.post("admin/settings",e),deleteMenu:e=>xa.delete(`menus/${e}`),renameMenu:(e,t)=>xa.put(`menus/${e}`,t),reorderMenus:e=>xa.post("menus/reorder",{menu_order:e}),previewMenu:e=>xa.get(`menus/${e}/preview`,{responseType:"blob"}),cloneTable:(e,t)=>xa.post(`tables/clone/${e}`,t),getStaff:(e=1)=>xa.get(`admin/staff?page=${e}`),getStaffMember:e=>xa.get(`admin/staff/${e}`),updateStaffMember:(e,t)=>t instanceof FormData?xa.post(`admin/staff/${e}?_method=PUT`,t,{headers:{"Content-Type":"multipart/form-data"}}):xa.put(`admin/staff/${e}`,t),inviteStaff:e=>xa.post("admin/staff/invite",e),addReview:(e,t)=>xa.post(`admin/staff/${e}/reviews`,t),deleteReview:(e,t)=>xa.delete(`admin/staff/${e}/reviews/${t}`),changePassword:e=>xa.post("change-password",e),deleteAccount:e=>xa.delete("delete-account",{data:e}),getAdminStatistics:()=>xa.get("admin/statistics"),sendQrEmail:e=>xa.post("admin/qr/email",e),getAdminNotifications:()=>xa.get("admin/notifications"),listWorkHistory:()=>xa.get("profile/work-history"),addWorkHistory:e=>xa.post("profile/work-history",e),updateWorkHistory:(e,t)=>xa.put(`profile/work-history/${e}`,t),deleteWorkHistory:e=>xa.delete(`profile/work-history/${e}`),getAdminTables:()=>xa.get("admin/tables"),getAdminTableDetails:e=>xa.get(`admin/tables/${e}`),updateAdminTable:(e,t)=>xa.put(`admin/tables/${e}`,t),deleteAdminTable:e=>xa.delete(`admin/tables/${e}`),getAdminStaff:()=>xa.get("admin/staff"),getAdminStaffDetails:e=>xa.get(`admin/staff/${e}`),createAdminStaff:e=>xa.post("admin/staff",e),updateAdminStaff:(e,t)=>xa.post(`admin/staff/${e}`,t),deleteAdminStaff:e=>xa.delete(`admin/staff/${e}`),getAdminMenus:()=>xa.get("admin/menus"),getAdminMenuDetails:e=>xa.get(`admin/menus/${e}`),createAdminMenu:e=>xa.post("admin/menus",e),updateAdminMenu:(e,t)=>xa.post(`admin/menus/update/${e}`,t),deleteAdminMenu:e=>xa.delete(`admin/menus/${e}`),getAdminRequests:()=>xa.get("admin/requests"),sendNotificationToAll:e=>xa.post("admin/notifications/send-to-all",e),sendNotificationToUser:e=>xa.post("admin/notifications/send-to-user",e),sendNotificationToDevice:e=>xa.post("admin/notifications/send-to-device",e),sendNotificationToTopic:e=>xa.post("admin/notifications/send-to-topic",e),subscribeToTopic:e=>xa.post("admin/notifications/subscribe-to-topic",e),unsubscribeFromTopic:e=>xa.post("admin/notifications/unsubscribe-from-topic",e),storeDeviceToken:e=>xa.post("device-token",e),getDeviceTokens:e=>xa.get(`device-tokens/${e}`),deleteDeviceToken:e=>xa.delete(`device-token/${e}`),sendPushToUser:e=>xa.post("admin/notifications/send-to-user",e),healthCheck:()=>xa.get("health-check"),getFirebaseConfig:()=>xa.get("firebase/config"),registerWaiterFcm:e=>xa.post("waiter/fcm/register",e),refreshWaiterFcm:e=>xa.post("waiter/fcm/refresh",e),deleteWaiterFcmToken:e=>xa.delete("waiter/fcm/token",{data:e}),testWaiterFcm:e=>xa.post("waiter/fcm/test",e),getPendingCalls:()=>xa.get("waiter/calls/pending"),acknowledgeCall:e=>xa.post(`waiter/calls/${e}/acknowledge`),completeCall:e=>xa.post(`waiter/calls/${e}/complete`),getWaiterCallHistory:(e={})=>xa.get("waiter/calls/history",{params:e}),getAdminCallHistory:(e={})=>xa.get("admin/calls/history",{params:e}),activateTable:e=>xa.post(`waiter/tables/${e}/activate`),deactivateTable:e=>xa.delete(`waiter/tables/${e}/activate`),activateMultipleTables:e=>xa.post("waiter/tables/activate/multiple",e),deactivateMultipleTables:e=>xa.post("waiter/tables/deactivate/multiple",e),silenceTable:(e,t)=>xa.post(`waiter/tables/${e}/silence`,t),unsilenceTable:e=>xa.delete(`waiter/tables/${e}/silence`),silenceMultipleTables:e=>xa.post("waiter/tables/silence/multiple",e),unsilenceMultipleTables:e=>xa.post("waiter/tables/unsilence/multiple",e),getSilencedTables:()=>xa.get("waiter/tables/silenced"),getAssignedTables:()=>xa.get("waiter/tables/assigned"),getAvailableTables:()=>xa.get("waiter/tables/available"),getAdminSilencedTables:()=>xa.get("admin/tables/silenced"),adminUnsilenceTable:e=>xa.delete(`admin/tables/${e}/silence`),getWaiterTableProfiles:()=>xa.get("waiter/table-profiles"),getWaiterTableProfile:e=>xa.get(`waiter/table-profiles/${e}`),createWaiterTableProfile:e=>xa.post("waiter/table-profiles",e),updateWaiterTableProfile:(e,t)=>xa.put(`waiter/table-profiles/${e}`,t),deleteWaiterTableProfile:e=>xa.delete(`waiter/table-profiles/${e}`),activateWaiterTableProfile:e=>xa.post(`waiter/table-profiles/${e}/activate`),deactivateWaiterTableProfile:e=>xa.post(`waiter/table-profiles/${e}/deactivate`),getWaiterTableProfileNotifications:()=>xa.get("waiter/table-profiles/notifications"),getWaiterDashboard:()=>xa.get("waiter/dashboard"),getWaiterTableStatus:()=>xa.get("waiter/tables/status"),getWaiterBusinesses:()=>xa.get("waiter/businesses"),setActiveWaiterBusiness:e=>xa.post("waiter/set-active-business",{business_id:e}),getActiveWaiterBusiness:()=>xa.get("waiter/businesses/active"),getWaiterBusinessTables:e=>xa.get(`waiter/businesses/${e}/tables`),joinBusinessWithCode:e=>xa.post("waiter/join-business",{business_code:e}),leaveWaiterBusiness:e=>xa.delete(`waiter/businesses/${e}/leave`)},Pa={async getNotifications(){try{return(await Aa.getNotifications()).data}catch(e){throw console.error("Error obteniendo notificaciones:",e),e}},async handleNotification(e,t){try{return(await Aa.handleNotification(e,{action:t})).data}catch(a){throw console.error("Error manejando notificación:",a),a}},async globalNotifications(e){try{return(await Aa.globalNotifications({enabled:e})).data}catch(t){throw console.error("Error configurando notificaciones globales:",t),t}},async getWaiterNotifications(){try{return(await Aa.getWaiterNotifications()).data}catch(e){throw console.error("Error obteniendo notificaciones de mozo:",e),e}},async handleWaiterNotification(e,t){try{return(await Aa.handleWaiterNotification(e,{action:t})).data}catch(a){throw console.error("Error manejando notificación de mozo:",a),a}},async waiterGlobalNotifications(e){try{return(await Aa.waiterGlobalNotifications({enabled:e})).data}catch(t){throw console.error("Error configurando notificaciones globales de mozo:",t),t}},async waiterToggleTableNotifications(e){try{return(await Aa.waiterToggleTableNotifications(e)).data}catch(t){throw console.error("Error alternando notificaciones de mesa para mozo:",t),t}},async getAdminNotifications(){try{return(await Aa.getAdminNotifications()).data}catch(e){throw console.error("Error obteniendo notificaciones de administrador:",e),e}},async storeDeviceToken(e,t="web",a=null){try{const n={token:e,platform:t};a&&(n.user_id=a);return(await Aa.storeDeviceToken(n)).data}catch(n){throw console.error("Error guardando token de dispositivo:",n),n}},async deleteDeviceToken(e){try{return(await Aa.deleteDeviceToken(e)).data}catch(t){throw console.error("Error eliminando token de dispositivo:",t),t}},async getDeviceTokens(e){try{return(await Aa.getDeviceTokens(e)).data}catch(t){throw console.error("Error obteniendo tokens de dispositivo:",t),t}},async sendNotificationToAll(e,t,a=null){try{const n={title:e,body:t};a&&(n.data=a);return(await Aa.sendNotificationToAll(n)).data}catch(n){throw console.error("Error enviando notificación a todos:",n),n}},async sendNotificationToUser(e,t,a,n=null){try{const i={user_id:e,title:t,body:a};n&&(i.data=n);return(await Aa.sendNotificationToUser(i)).data}catch(i){throw console.error("Error enviando notificación a usuario:",i),i}},async sendNotificationToDevice(e,t,a,n=null){try{const i={token:e,title:t,body:a};n&&(i.data=n);return(await Aa.sendNotificationToDevice(i)).data}catch(i){throw console.error("Error enviando notificación a dispositivo:",i),i}},async sendNotificationToTopic(e,t,a,n=null){try{const i={topic:e,title:t,body:a};n&&(i.data=n);return(await Aa.sendNotificationToTopic(i)).data}catch(i){throw console.error("Error enviando notificación a topic:",i),i}},async subscribeToTopic(e,t){try{const a={tokens:Array.isArray(e)?e:[e],topic:t};return(await Aa.subscribeToTopic(a)).data}catch(a){throw console.error("Error suscribiendo a topic:",a),a}},async unsubscribeFromTopic(e,t){try{const a={tokens:Array.isArray(e)?e:[e],topic:t};return(await Aa.unsubscribeFromTopic(a)).data}catch(a){throw console.error("Error desuscribiendo de topic:",a),a}},async toggleTableNotifications(e){try{return(await Aa.toggleTableNotifications(e)).data}catch(t){throw console.error("Error alternando notificaciones de mesa:",t),t}},async callWaiter(e){try{return(await Aa.callWaiter(e)).data}catch(t){throw console.error("Error llamando al camarero:",t),t}},async markAllAsRead(e){try{const t=e.map(e=>this.handleNotification(e.id,"mark_as_read"));return await Promise.all(t)}catch(t){throw console.error("Error marcando todas como leídas:",t),t}},async deleteAllRead(e){try{const t=e.map(e=>this.handleNotification(e.id,"delete"));return await Promise.all(t)}catch(t){throw console.error("Error eliminando todas las leídas:",t),t}},async getNotificationsByRole(e){try{switch(e){case"waiter":return await this.getWaiterNotifications();case"admin":return await this.getAdminNotifications();default:return await this.getNotifications()}}catch(t){throw console.error("Error obteniendo notificaciones por rol:",t),t}},async healthCheck(){try{return await Aa.healthCheck()}catch(e){throw console.error("Error en el health check de la API:",e),e}},async testWebSocketConnection(){try{if(!localStorage.getItem("token"))throw new Error("No hay token de autenticación");const e=localStorage.getItem("user"),{initializeEcho:t}=(e&&JSON.parse(e),await W(async()=>{const{initializeEcho:e}=await import("./echo-CKaDY4WX.js");return{initializeEcho:e}},__vite__mapDeps([3,1,2]))),a=t();if(!a)throw new Error("No se pudo inicializar Echo");if(!a.connector||!a.connector.pusher)throw new Error("Pusher no está disponible en Echo");return await new Promise((e,t)=>{const n=setTimeout(()=>{t(new Error("Timeout en la conexión WebSocket (5 segundos)"))},5e3);a.connector.pusher.connection.bind("connected",()=>{clearTimeout(n),e()}),a.connector.pusher.connection.bind("error",e=>{clearTimeout(n),console.error("🔍 Error en WebSocket:",e),t(new Error(`Error de conexión: ${e.message||"Error desconocido"}`))}),a.connector.pusher.connection.bind("disconnected",()=>{}),a.connector.pusher.connection.bind("connecting",()=>{})}),{success:!0,message:"Conexión WebSocket exitosa"}}catch(e){throw console.error("🔍 Error en testWebSocketConnection:",e),console.error("🔍 Stack trace:",e.stack),e}}},Ra=Object.freeze(Object.defineProperty({__proto__:null,default:Pa},Symbol.toStringTag,{value:"Module"})),Da={apiKey:"AIzaSyBlupKSIy7qtTsXukqROyVjMNx03X8CCzU",authDomain:"mozoqr-7d32c.firebaseapp.com",projectId:"mozoqr-7d32c",storageBucket:"mozoqr-7d32c.firebasestorage.app",databaseURL:"https://mozoqr-7d32c-default-rtdb.firebaseio.com",messagingSenderId:"175482362472",appId:"1:175482362472:web:308070c885bacc71b6b9dd",measurementId:"G-6N7J4X94DH"};let Ma=null,La=null,Oa=null;const Fa=async()=>{try{if("undefined"==typeof window)return console.log("🔥 Firebase: Not supported in non-browser environment"),null;const e=Object.entries(Da).filter(([e,t])=>!t).map(([e,t])=>e);if(e.length>0)return console.error("🔥 Firebase: Incomplete configuration. Missing keys:",e),null;console.log("🔥 Initializing Firebase...");const{initializeApp:t}=await W(async()=>{const{initializeApp:e}=await import("./index.esm-CF7LdUBZ.js");return{initializeApp:e}},__vite__mapDeps([4,1,2]));Ma=t(Da),console.log("🔥 Firebase App initialized appId=",Da.appId,"projectId=",Da.projectId);const{getFirestore:a}=await W(async()=>{const{getFirestore:e}=await import("./index.esm-TkqytPRP.js");return{getFirestore:e}},__vite__mapDeps([5,1,2]));return Oa=a(Ma),console.log("🔥 Firestore initialized"),{app:Ma,db:Oa}}catch(e){return console.error("🔥 Firebase App initialization error:",e),null}},Ua=async()=>{try{if(!Ma){if(!(await Fa()))return null}if("serviceWorker"in navigator)try{await navigator.serviceWorker.register("/firebase-messaging-sw.js");console.log("🔥 Service Worker registered successfully")}catch(e){console.error("🔥 Service Worker registration failed:",e)}const{getMessaging:t,isSupported:a}=await W(async()=>{const{getMessaging:e,isSupported:t}=await import("./index.esm-D4mIwqXE.js");return{getMessaging:e,isSupported:t}},__vite__mapDeps([6,1,2]));return await a()?(La=t(Ma),console.log("🔥 Firebase Messaging initialized"),{app:Ma,messaging:La,db:Oa}):(console.log("🔥 Firebase Messaging not supported in this browser"),{app:Ma,messaging:null,db:Oa})}catch(e){return console.error("🔥 Firebase initialization error:",e),{app:Ma,messaging:null,db:Oa}}},Ba=async()=>{try{if(!La){if(!(await Ua()))throw new Error("Firebase initialization failed")}const{getToken:e}=await W(async()=>{const{getToken:e}=await import("./index.esm-D4mIwqXE.js");return{getToken:e}},__vite__mapDeps([6,1,2]));if("undefined"==typeof Notification)console.warn("🔥 Notification API no disponible en este entorno (probablemente WebView). Saltando solicitud de permisos.");else{let e=Notification.permission;if(console.log("🔥 Current notification permission:",e),"default"===e&&(console.log("🔥 Requesting notification permissions..."),e=await Notification.requestPermission(),console.log("🔥 Permission after request:",e)),"denied"===e)throw console.error("🔥 Notification permissions DENIED by user"),console.error('🔥 SOLUTION: Click the 🔒 in the address bar and change Notifications to "Allow"'),new Error('Notification permissions denied. Click the 🔒 in the address bar and change Notifications to "Allow", then reload the page.');if("granted"!==e)throw new Error("Notification permissions not granted");console.log("✅ Notification permissions granted")}console.log("🔥 Getting FCM token...");const t="BNJgpNkgB0a0y7gHT-SNBFLMGIZw-Xx8NTBDCn_4dVqekzgmnGmKMIn10t-6gWl3Qj_msyCcfbsVycnAp8USs6M",a={};t&&(console.log("🔥 Using VAPID key:",t.substring(0,10)+"..."),a.vapidKey=t);const n=await e(La,a);if(!n)throw new Error("Failed to obtain FCM token");return console.log("🔥 FCM token obtained (length="+n.length+"):",n.substring(0,25)+"..."),localStorage.setItem("fcm_token",n),n}catch(e){throw console.error("🔥 FCM token error:",e),e}},qa=async e=>{try{if(!La){if(!(await Ua()))return}const{onMessage:t}=await W(async()=>{const{onMessage:e}=await import("./index.esm-D4mIwqXE.js");return{onMessage:e}},__vite__mapDeps([6,1,2]));console.log("🔥 Setting up foreground message listener..."),t(La,t=>{console.log("🔥🚨 FCM MESSAGE RECEIVED (Firebase onMessage):",t),console.log("🔥📱 Detailed payload:",{notification:t.notification,data:t.data,from:t.from,messageId:t.messageId}),console.log("🔥⏰ Timestamp:",(new Date).toLocaleTimeString());const a=ja(t);if(e&&"function"==typeof e)try{e(a)}catch(n){console.error("🔥❌ Error in onMessage callback:",n)}try{W(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>rr);return{useNotificationsStore:e}},void 0).then(({useNotificationsStore:e})=>{var t;const n=e(),i={id:`fcm-${Date.now()}`,type:(null==(t=a.data)?void 0:t.type)||"FCMNotification",data:{title:a.title,message:a.body,...a.data},created_at:(new Date).toISOString(),read_at:null,source:"firebase-foreground"};console.log("🔥📨 Adding FCM notification to store:",i),n.addNewNotification(i)})}catch(n){console.error("🔥❌ Error adding FCM notification to store:",n)}"granted"===Notification.permission&&$a(a)}),console.log("🔥 Foreground message listener configured")}catch(t){console.error("🔥 Error setting up message listener:",t)}},ja=e=>{var t,a,n;console.log("🔄 Processing notification payload...");let i={title:(null==(t=e.notification)?void 0:t.title)||"Nueva notificación",body:(null==(a=e.notification)?void 0:a.body)||"Tienes una nueva notificación",data:e.data||{}};if(null==(n=e.data)?void 0:n.type){const t=e.data.type;switch(console.log("🔄 Notification type:",t),t){case"TestNotification":i={title:"🧪 Test Notification",body:"This is a test notification sent to all business users",data:{...e.data,icon:"🧪",priority:"normal",channels:["Database","Broadcast","FCM"]}};break;case"UserSpecificNotification":i={title:e.data.title||"👤 Personalized Notification",body:e.data.message||"You have a new personalized notification",data:{...e.data,icon:"👤",priority:"high",channels:["Database","Broadcast","FCM"]}};break;case"WebSocketTestNotification":i={title:"⚡ WebSocket + FCM Test",body:"This notification arrives via WebSocket (real-time) and FCM (push)",data:{...e.data,icon:"⚡",priority:"high",test_mode:"websocket_fcm"}};break;case"WebSocketOnlyNotification":i={title:"🔌 WebSocket Only Test",body:"This notification ONLY arrives via WebSocket in real-time",data:{...e.data,icon:"🔌",priority:"normal",test_mode:"websocket_only"}};break;default:e.notification&&(i={title:e.notification.title,body:e.notification.body,data:{...e.data,icon:"📱",priority:"normal"}})}}return console.log("✅ Notification processed:",i),i},$a=e=>{try{const{title:t,body:a,data:n}=e;if(t||a){const e=new Notification(t||"Nueva notificación",{body:a||"Tienes una nueva notificación",icon:"/favicon.ico",tag:`fcm-notification-${Date.now()}`,data:n,requireInteraction:!0});console.log("🔥🔔 Browser notification displayed:",e)}}catch(t){console.error("🔥❌ Error showing browser notification:",t)}},za=async()=>{try{if(!La)return void console.log("🔥 Firebase Messaging not initialized");const{deleteToken:e}=await W(async()=>{const{deleteToken:e}=await import("./index.esm-D4mIwqXE.js");return{deleteToken:e}},__vite__mapDeps([6,1,2]));await e(La),localStorage.removeItem("fcm_token"),console.log("🔥 FCM token deleted successfully")}catch(e){throw console.error("🔥 FCM token deletion error:",e),e}},Va=()=>Oa||(console.error("🔥 Firestore not initialized. Call initializeFirebase() first."),null),Wa=()=>{const e={configured:!1,initialized:!1,messagingAvailable:!1,firestoreAvailable:!1,tokenExists:!1,notificationPermission:"undefined"!=typeof Notification?Notification.permission:"unavailable"};try{const t=Object.entries(Da).filter(([e,t])=>!t).map(([e,t])=>e);return e.configured=0===t.length,e.initialized=!!Ma&&!!La&&!!Oa,e.messagingAvailable=!!La,e.firestoreAvailable=!!Oa,e.tokenExists=!!localStorage.getItem("fcm_token"),"Notification"in window&&(e.notificationPermission=Notification.permission),e}catch(t){return console.error("🔥 Error getting Firebase status:",t),e}},Ha={initializeFirebase:Ua,initializeFirebaseApp:Fa,getFCMToken:Ba,setupForegroundMessageListener:qa,deleteFCMToken:za,getFirestore:Va,getFirebaseStatus:Wa,config:Da},Ga=Object.freeze(Object.defineProperty({__proto__:null,default:Ha,deleteFCMToken:za,getFCMToken:Ba,getFirebaseStatus:Wa,getFirestore:Va,initializeFirebase:Ua,initializeFirebaseApp:Fa,setupForegroundMessageListener:qa},Symbol.toStringTag,{value:"Module"})),Ya=()=>{try{const e=J.getPlatform();return"android"===e?"android":"ios"===e?"ios":"web"}catch(e){return"web"}};async function Ka(){try{if(!(await Ha.initializeFirebase()))return null;return await Ha.getFCMToken()}catch(e){return console.warn("notificationClient: no se pudo obtener FCM token:",(null==e?void 0:e.message)||e),null}}async function Qa(e={},t={}){const a=t.platformOverride||Ya();let n=null;try{n=await Ka()}catch(o){}const i={...e};n&&(i.fcm_token=n,i.platform=a);const s=await Aa.login(i);if(!n)try{const e=await Ka();e&&await async function(e,t=null){try{const a=t||Ya();return await Pa.storeDeviceToken(e,a),localStorage.setItem("fcm_token",e),!0}catch(a){return console.warn("notificationClient: error registrando token despues de login:",(null==a?void 0:a.message)||a),!1}}(e,a)}catch(o){}return s}const Ja=e=>{try{return"object"==typeof e&&null!==e&&"value"in e?o(e):e}catch(t){return console.warn("Error accessing reactive value:",t),null}},Za=e=>{try{const t=Ja(e);return t?String(t):""}catch(t){return console.warn("Error converting token to string:",t),""}},Xa=n("auth",()=>{const e=i(null),t=i(localStorage.getItem("token")||null),a=i(!1),n=i(!!Za(t)),o=i(!1),r=i(null),l=i(null),c=localStorage.getItem("user");if(c)try{const t=JSON.parse(c);t.selectedRole&&(l.value=t.selectedRole,t.role=t.selectedRole),e.value=t}catch(h){console.error("AuthStore - Error al parsear usuario de localStorage:",h)}const d=s(()=>{var t;return l.value||(null==(t=e.value)?void 0:t.role)||null}),u=async()=>{try{await async function(){try{const t=localStorage.getItem("fcm_token");if(t){try{await Pa.deleteDeviceToken({token:t})}catch(h){try{await Aa.delete("device-token",{data:{token:t}})}catch(e){console.warn("notificationClient: fallback delete failed",e)}}localStorage.removeItem("fcm_token")}try{await Aa.logout()}catch(e){}return localStorage.removeItem("token"),localStorage.removeItem("user"),!0}catch(r){return console.warn("notificationClient: error en logoutAndUnregister",r),!1}}()}catch(a){console.warn("AuthStore - Error en logoutAndUnregister:",a)}e.value=null,t.value=null,n.value=!1,l.value=null,localStorage.removeItem("token"),localStorage.removeItem("userRole"),localStorage.removeItem("user"),localStorage.removeItem("fcm_token");try{const{deleteFCMToken:e}=await W(async()=>{const{deleteFCMToken:e}=await Promise.resolve().then(()=>Ga);return{deleteFCMToken:e}},void 0);await e()}catch(a){console.warn("Error eliminando token FCM:",a)}try{const{useNotificationsStore:e}=await W(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>rr);return{useNotificationsStore:e}},void 0);e().disconnectRealTimeNotifications()}catch(a){console.warn("Error desconectando Firestore listeners:",a)}return!0};return{user:e,token:t,isAuthenticated:n,initialized:a,isLoading:o,error:r,selectedRole:l,currentRole:d,login:async i=>{var s;o.value=!0,r.value=null;try{const o=(await Qa(i)).data||{},r=o.token||o.access_token||o.plainTextToken;e.value=o.user,t.value=r||null,n.value=!0,l.value=(null==(s=o.user)?void 0:s.selectedRole)||null;const d=Za(t);d&&localStorage.setItem("token",d),localStorage.setItem("user",JSON.stringify(o.user)),a.value=!0;try{const{initializePushNotifications:e}=await W(async()=>{const{initializePushNotifications:e}=await Promise.resolve().then(()=>hx);return{initializePushNotifications:e}},void 0),{useNotificationsStore:t}=((await W(async()=>{const{Capacitor:e}=await Promise.resolve().then(()=>se);return{Capacitor:e}},void 0)).Capacitor.getPlatform(),await e(),await W(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>rr);return{useNotificationsStore:e}},void 0));t().initializeRealTimeNotifications()}catch(c){}return o.user}catch(h){throw console.error("AuthStore - Error en login:",h),r.value=h.message||"Error al iniciar sesión",h}finally{o.value=!1}},register:async a=>{o.value=!0,r.value=null;try{const i=(await Aa.register(a)).data||{};e.value=i.user,t.value=i.token||null,n.value=!0,l.value=null;const s=Za(t);return s&&localStorage.setItem("token",s),localStorage.setItem("user",JSON.stringify(i.user)),i.user}catch(h){throw r.value=h.message||"Error al registrarse",h}finally{o.value=!1}},logout:u,fetchUser:async()=>{if(e.value)return;const t=localStorage.getItem("user");if(t)try{e.value=JSON.parse(t)}catch(h){}else n.value&&u()},updateProfile:async t=>{try{const a=Object.fromEntries(t.entries());return e.value={...e.value,...a},localStorage.setItem("user",JSON.stringify(e.value)),{data:{user:e.value}}}catch(a){throw console.error("Error actualizando el perfil:",a),a}},forgotPassword:async e=>{o.value=!0,r.value=null;try{return!0}catch(h){throw r.value=h.message||"Error al enviar email de recuperación",h}finally{o.value=!1}},resetPassword:async(e,t)=>{o.value=!0,r.value=null;try{return!0}catch(h){throw r.value=h.message||"Error al restablecer contraseña",h}finally{o.value=!1}},setSelectedRole:a=>{l.value=a,e.value&&(e.value={...e.value,role:a});const i=localStorage.getItem("user");if(i)try{const e=JSON.parse(i);e.selectedRole=a,e.role=a,localStorage.setItem("user",JSON.stringify(e))}catch(h){console.error("AuthStore - Error actualizando usuario en localStorage:",h)}try{const e=localStorage.getItem("token");e&&(t.value=e,n.value=!0)}catch(h){console.warn("AuthStore - Error sincronizando token desde localStorage:",h)}},getSelectedRole:()=>Ja(l),tryToLogin:async()=>{const i=localStorage.getItem("token"),s=localStorage.getItem("user");if(!i)return!1;try{if(t.value=i,s){const t=JSON.parse(s);e.value=t,l.value=t.selectedRole||t.role}return await Aa.getCurrentUser()?(n.value=!0,a.value=!0,!0):(u(),!1)}catch(h){return await u(),a.value=!0,!1}}}}),en=Object.freeze(Object.defineProperty({__proto__:null,useAuthStore:Xa},Symbol.toStringTag,{value:"Module"}));
/*!
* sweetalert2 v11.22.0
* Released under the MIT License.
*/
function tn(e,t,a){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:a;throw new TypeError("Private element is not present on this object")}function an(e,t){return e.get(tn(e,t))}function nn(e,t,a){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,a)}const sn={},on=e=>new Promise(t=>{if(!e)return t();const a=window.scrollX,n=window.scrollY;sn.restoreFocusTimeout=setTimeout(()=>{sn.previousActiveElement instanceof HTMLElement?(sn.previousActiveElement.focus(),sn.previousActiveElement=null):document.body&&document.body.focus(),t()},100),window.scrollTo(a,n)}),rn="swal2-",ln=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error","draggable","dragging"].reduce((e,t)=>(e[t]=rn+t,e),{}),cn=["success","warning","info","question","error"].reduce((e,t)=>(e[t]=rn+t,e),{}),dn="SweetAlert2:",un=e=>e.charAt(0).toUpperCase()+e.slice(1),hn=e=>{console.warn(`${dn} ${"object"==typeof e?e.join(" "):e}`)},pn=e=>{console.error(`${dn} ${e}`)},mn=[],fn=(e,t=null)=>{var a;a=`"${e}" is deprecated and will be removed in the next major release.${t?` Use "${t}" instead.`:""}`,mn.includes(a)||(mn.push(a),hn(a))},gn=e=>"function"==typeof e?e():e,vn=e=>e&&"function"==typeof e.toPromise,bn=e=>vn(e)?e.toPromise():Promise.resolve(e),wn=e=>e&&Promise.resolve(e)===e,yn=()=>document.body.querySelector(`.${ln.container}`),_n=e=>{const t=yn();return t?t.querySelector(e):null},Cn=e=>_n(`.${e}`),kn=()=>Cn(ln.popup),En=()=>Cn(ln.icon),Sn=()=>Cn(ln.title),Tn=()=>Cn(ln["html-container"]),In=()=>Cn(ln.image),Nn=()=>Cn(ln["progress-steps"]),xn=()=>Cn(ln["validation-message"]),An=()=>_n(`.${ln.actions} .${ln.confirm}`),Pn=()=>_n(`.${ln.actions} .${ln.cancel}`),Rn=()=>_n(`.${ln.actions} .${ln.deny}`),Dn=()=>_n(`.${ln.loader}`),Mn=()=>Cn(ln.actions),Ln=()=>Cn(ln.footer),On=()=>Cn(ln["timer-progress-bar"]),Fn=()=>Cn(ln.close),Un=()=>{const e=kn();if(!e)return[];const t=e.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),a=Array.from(t).sort((e,t)=>{const a=parseInt(e.getAttribute("tabindex")||"0"),n=parseInt(t.getAttribute("tabindex")||"0");return a>n?1:a<n?-1:0}),n=e.querySelectorAll('\n  a[href],\n  area[href],\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled]),\n  button:not([disabled]),\n  iframe,\n  object,\n  embed,\n  [tabindex="0"],\n  [contenteditable],\n  audio[controls],\n  video[controls],\n  summary\n'),i=Array.from(n).filter(e=>"-1"!==e.getAttribute("tabindex"));return[...new Set(a.concat(i))].filter(e=>ai(e))},Bn=()=>$n(document.body,ln.shown)&&!$n(document.body,ln["toast-shown"])&&!$n(document.body,ln["no-backdrop"]),qn=()=>{const e=kn();return!!e&&$n(e,ln.toast)},jn=(e,t)=>{if(e.textContent="",t){const a=(new DOMParser).parseFromString(t,"text/html"),n=a.querySelector("head");n&&Array.from(n.childNodes).forEach(t=>{e.appendChild(t)});const i=a.querySelector("body");i&&Array.from(i.childNodes).forEach(t=>{t instanceof HTMLVideoElement||t instanceof HTMLAudioElement?e.appendChild(t.cloneNode(!0)):e.appendChild(t)})}},$n=(e,t)=>{if(!t)return!1;const a=t.split(/\s+/);for(let n=0;n<a.length;n++)if(!e.classList.contains(a[n]))return!1;return!0},zn=(e,t,a)=>{if(((e,t)=>{Array.from(e.classList).forEach(a=>{Object.values(ln).includes(a)||Object.values(cn).includes(a)||Object.values(t.showClass||{}).includes(a)||e.classList.remove(a)})})(e,t),!t.customClass)return;const n=t.customClass[a];n&&("string"==typeof n||n.forEach?Gn(e,n):hn(`Invalid type of customClass.${a}! Expected string or iterable object, got "${typeof n}"`))},Vn=(e,t)=>{if(!t)return null;switch(t){case"select":case"textarea":case"file":return e.querySelector(`.${ln.popup} > .${ln[t]}`);case"checkbox":return e.querySelector(`.${ln.popup} > .${ln.checkbox} input`);case"radio":return e.querySelector(`.${ln.popup} > .${ln.radio} input:checked`)||e.querySelector(`.${ln.popup} > .${ln.radio} input:first-child`);case"range":return e.querySelector(`.${ln.popup} > .${ln.range} input`);default:return e.querySelector(`.${ln.popup} > .${ln.input}`)}},Wn=e=>{if(e.focus(),"file"!==e.type){const t=e.value;e.value="",e.value=t}},Hn=(e,t,a)=>{e&&t&&("string"==typeof t&&(t=t.split(/\s+/).filter(Boolean)),t.forEach(t=>{Array.isArray(e)?e.forEach(e=>{a?e.classList.add(t):e.classList.remove(t)}):a?e.classList.add(t):e.classList.remove(t)}))},Gn=(e,t)=>{Hn(e,t,!0)},Yn=(e,t)=>{Hn(e,t,!1)},Kn=(e,t)=>{const a=Array.from(e.children);for(let n=0;n<a.length;n++){const e=a[n];if(e instanceof HTMLElement&&$n(e,t))return e}},Qn=(e,t,a)=>{a===`${parseInt(a)}`&&(a=parseInt(a)),a||0===parseInt(a)?e.style.setProperty(t,"number"==typeof a?`${a}px`:a):e.style.removeProperty(t)},Jn=(e,t="flex")=>{e&&(e.style.display=t)},Zn=e=>{e&&(e.style.display="none")},Xn=(e,t="block")=>{e&&new MutationObserver(()=>{ti(e,e.innerHTML,t)}).observe(e,{childList:!0,subtree:!0})},ei=(e,t,a,n)=>{const i=e.querySelector(t);i&&i.style.setProperty(a,n)},ti=(e,t,a="flex")=>{t?Jn(e,a):Zn(e)},ai=e=>!(!e||!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)),ni=e=>!!(e.scrollHeight>e.clientHeight),ii=e=>{const t=window.getComputedStyle(e),a=parseFloat(t.getPropertyValue("animation-duration")||"0"),n=parseFloat(t.getPropertyValue("transition-duration")||"0");return a>0||n>0},si=(e,t=!1)=>{const a=On();a&&ai(a)&&(t&&(a.style.transition="none",a.style.width="100%"),setTimeout(()=>{a.style.transition=`width ${e/1e3}s linear`,a.style.width="0%"},10))},oi=`\n <div aria-labelledby="${ln.title}" aria-describedby="${ln["html-container"]}" class="${ln.popup}" tabindex="-1">\n   <button type="button" class="${ln.close}"></button>\n   <ul class="${ln["progress-steps"]}"></ul>\n   <div class="${ln.icon}"></div>\n   <img class="${ln.image}" />\n   <h2 class="${ln.title}" id="${ln.title}"></h2>\n   <div class="${ln["html-container"]}" id="${ln["html-container"]}"></div>\n   <input class="${ln.input}" id="${ln.input}" />\n   <input type="file" class="${ln.file}" />\n   <div class="${ln.range}">\n     <input type="range" />\n     <output></output>\n   </div>\n   <select class="${ln.select}" id="${ln.select}"></select>\n   <div class="${ln.radio}"></div>\n   <label class="${ln.checkbox}">\n     <input type="checkbox" id="${ln.checkbox}" />\n     <span class="${ln.label}"></span>\n   </label>\n   <textarea class="${ln.textarea}" id="${ln.textarea}"></textarea>\n   <div class="${ln["validation-message"]}" id="${ln["validation-message"]}"></div>\n   <div class="${ln.actions}">\n     <div class="${ln.loader}"></div>\n     <button type="button" class="${ln.confirm}"></button>\n     <button type="button" class="${ln.deny}"></button>\n     <button type="button" class="${ln.cancel}"></button>\n   </div>\n   <div class="${ln.footer}"></div>\n   <div class="${ln["timer-progress-bar-container"]}">\n     <div class="${ln["timer-progress-bar"]}"></div>\n   </div>\n </div>\n`.replace(/(^|\n)\s*/g,""),ri=()=>{sn.currentInstance.resetValidationMessage()},li=e=>{const t=(()=>{const e=yn();return!!e&&(e.remove(),Yn([document.documentElement,document.body],[ln["no-backdrop"],ln["toast-shown"],ln["has-column"]]),!0)})();if("undefined"==typeof window||"undefined"==typeof document)return void pn("SweetAlert2 requires document to initialize");const a=document.createElement("div");a.className=ln.container,t&&Gn(a,ln["no-transition"]),jn(a,oi),a.dataset.swal2Theme=e.theme;const n="string"==typeof(i=e.target)?document.querySelector(i):i;var i;n.appendChild(a),e.topLayer&&(a.setAttribute("popover",""),a.showPopover()),(e=>{const t=kn();t.setAttribute("role",e.toast?"alert":"dialog"),t.setAttribute("aria-live",e.toast?"polite":"assertive"),e.toast||t.setAttribute("aria-modal","true")})(e),(e=>{"rtl"===window.getComputedStyle(e).direction&&Gn(yn(),ln.rtl)})(n),(()=>{const e=kn(),t=Kn(e,ln.input),a=Kn(e,ln.file),n=e.querySelector(`.${ln.range} input`),i=e.querySelector(`.${ln.range} output`),s=Kn(e,ln.select),o=e.querySelector(`.${ln.checkbox} input`),r=Kn(e,ln.textarea);t.oninput=ri,a.onchange=ri,s.onchange=ri,o.onchange=ri,r.oninput=ri,n.oninput=()=>{ri(),i.value=n.value},n.onchange=()=>{ri(),i.value=n.value}})()},ci=(e,t)=>{e instanceof HTMLElement?t.appendChild(e):"object"==typeof e?di(e,t):e&&jn(t,e)},di=(e,t)=>{e.jquery?ui(t,e):jn(t,e.toString())},ui=(e,t)=>{if(e.textContent="",0 in t)for(let a=0;a in t;a++)e.appendChild(t[a].cloneNode(!0));else e.appendChild(t.cloneNode(!0))},hi=(e,t)=>{const a=Mn(),n=Dn();a&&n&&(t.showConfirmButton||t.showDenyButton||t.showCancelButton?Jn(a):Zn(a),zn(a,t,"actions"),function(e,t,a){const n=An(),i=Rn(),s=Pn();if(!n||!i||!s)return;mi(n,"confirm",a),mi(i,"deny",a),mi(s,"cancel",a),function(e,t,a,n){if(!n.buttonsStyling)return void Yn([e,t,a],ln.styled);Gn([e,t,a],ln.styled),n.confirmButtonColor&&e.style.setProperty("--swal2-confirm-button-background-color",n.confirmButtonColor);n.denyButtonColor&&t.style.setProperty("--swal2-deny-button-background-color",n.denyButtonColor);n.cancelButtonColor&&a.style.setProperty("--swal2-cancel-button-background-color",n.cancelButtonColor);pi(e),pi(t),pi(a)}(n,i,s,a),a.reverseButtons&&(a.toast?(e.insertBefore(s,n),e.insertBefore(i,n)):(e.insertBefore(s,t),e.insertBefore(i,t),e.insertBefore(n,t)))}(a,n,t),jn(n,t.loaderHtml||""),zn(n,t,"loader"))};function pi(e){const t=window.getComputedStyle(e);if(t.getPropertyValue("--swal2-action-button-focus-box-shadow"))return;const a=t.backgroundColor.replace(/rgba?\((\d+), (\d+), (\d+).*/,"rgba($1, $2, $3, 0.5)");e.style.setProperty("--swal2-action-button-focus-box-shadow",t.getPropertyValue("--swal2-outline").replace(/ rgba\(.*/,` ${a}`))}function mi(e,t,a){const n=un(t);ti(e,a[`show${n}Button`],"inline-block"),jn(e,a[`${t}ButtonText`]||""),e.setAttribute("aria-label",a[`${t}ButtonAriaLabel`]||""),e.className=ln[t],zn(e,a,`${t}Button`)}const fi=(e,t)=>{const a=yn();a&&(!function(e,t){"string"==typeof t?e.style.background=t:t||Gn([document.documentElement,document.body],ln["no-backdrop"])}(a,t.backdrop),function(e,t){if(!t)return;t in ln?Gn(e,ln[t]):(hn('The "position" parameter is not valid, defaulting to "center"'),Gn(e,ln.center))}(a,t.position),function(e,t){if(!t)return;Gn(e,ln[`grow-${t}`])}(a,t.grow),zn(a,t,"container"))};var gi={innerParams:new WeakMap,domCache:new WeakMap};const vi=["input","file","range","select","radio","checkbox","textarea"],bi=e=>{if(!e.input)return;if(!Si[e.input])return void pn(`Unexpected type of input! Expected ${Object.keys(Si).join(" | ")}, got "${e.input}"`);const t=ki(e.input);if(!t)return;const a=Si[e.input](t,e);Jn(t),e.inputAutoFocus&&setTimeout(()=>{Wn(a)})},wi=(e,t)=>{const a=kn();if(!a)return;const n=Vn(a,e);if(n){(e=>{for(let t=0;t<e.attributes.length;t++){const a=e.attributes[t].name;["id","type","value","style"].includes(a)||e.removeAttribute(a)}})(n);for(const e in t)n.setAttribute(e,t[e])}},yi=e=>{if(!e.input)return;const t=ki(e.input);t&&zn(t,e,"input")},_i=(e,t)=>{!e.placeholder&&t.inputPlaceholder&&(e.placeholder=t.inputPlaceholder)},Ci=(e,t,a)=>{if(a.inputLabel){const n=document.createElement("label"),i=ln["input-label"];n.setAttribute("for",e.id),n.className=i,"object"==typeof a.customClass&&Gn(n,a.customClass.inputLabel),n.innerText=a.inputLabel,t.insertAdjacentElement("beforebegin",n)}},ki=e=>{const t=kn();if(t)return Kn(t,ln[e]||ln.input)},Ei=(e,t)=>{["string","number"].includes(typeof t)?e.value=`${t}`:wn(t)||hn(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof t}"`)},Si={};Si.text=Si.email=Si.password=Si.number=Si.tel=Si.url=Si.search=Si.date=Si["datetime-local"]=Si.time=Si.week=Si.month=(e,t)=>(Ei(e,t.inputValue),Ci(e,e,t),_i(e,t),e.type=t.input,e),Si.file=(e,t)=>(Ci(e,e,t),_i(e,t),e),Si.range=(e,t)=>{const a=e.querySelector("input"),n=e.querySelector("output");return Ei(a,t.inputValue),a.type=t.input,Ei(n,t.inputValue),Ci(a,e,t),e},Si.select=(e,t)=>{if(e.textContent="",t.inputPlaceholder){const a=document.createElement("option");jn(a,t.inputPlaceholder),a.value="",a.disabled=!0,a.selected=!0,e.appendChild(a)}return Ci(e,e,t),e},Si.radio=e=>(e.textContent="",e),Si.checkbox=(e,t)=>{const a=Vn(kn(),"checkbox");a.value="1",a.checked=Boolean(t.inputValue);const n=e.querySelector("span");return jn(n,t.inputPlaceholder||t.inputLabel),a},Si.textarea=(e,t)=>{Ei(e,t.inputValue),_i(e,t),Ci(e,e,t);return setTimeout(()=>{if("MutationObserver"in window){const a=parseInt(window.getComputedStyle(kn()).width);new MutationObserver(()=>{if(!document.body.contains(e))return;const n=e.offsetWidth+(i=e,parseInt(window.getComputedStyle(i).marginLeft)+parseInt(window.getComputedStyle(i).marginRight));var i;n>a?kn().style.width=`${n}px`:Qn(kn(),"width",t.width)}).observe(e,{attributes:!0,attributeFilter:["style"]})}}),e};const Ti=(e,t)=>{const a=Tn();a&&(Xn(a),zn(a,t,"htmlContainer"),t.html?(ci(t.html,a),Jn(a,"block")):t.text?(a.textContent=t.text,Jn(a,"block")):Zn(a),((e,t)=>{const a=kn();if(!a)return;const n=gi.innerParams.get(e),i=!n||t.input!==n.input;vi.forEach(e=>{const n=Kn(a,ln[e]);n&&(wi(e,t.inputAttributes),n.className=ln[e],i&&Zn(n))}),t.input&&(i&&bi(t),yi(t))})(e,t))},Ii=(e,t)=>{for(const[a,n]of Object.entries(cn))t.icon!==a&&Yn(e,n);Gn(e,t.icon&&cn[t.icon]),Ai(e,t),Ni(),zn(e,t,"icon")},Ni=()=>{const e=kn();if(!e)return;const t=window.getComputedStyle(e).getPropertyValue("background-color"),a=e.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let n=0;n<a.length;n++)a[n].style.backgroundColor=t},xi=(e,t)=>{if(!t.icon&&!t.iconHtml)return;let a=e.innerHTML,n="";if(t.iconHtml)n=Pi(t.iconHtml);else if("success"===t.icon)n='\n  <div class="swal2-success-circular-line-left"></div>\n  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>\n  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>\n  <div class="swal2-success-circular-line-right"></div>\n',a=a.replace(/ style=".*?"/g,"");else if("error"===t.icon)n='\n  <span class="swal2-x-mark">\n    <span class="swal2-x-mark-line-left"></span>\n    <span class="swal2-x-mark-line-right"></span>\n  </span>\n';else if(t.icon){n=Pi({question:"?",warning:"!",info:"i"}[t.icon])}a.trim()!==n.trim()&&jn(e,n)},Ai=(e,t)=>{if(t.iconColor){e.style.color=t.iconColor,e.style.borderColor=t.iconColor;for(const a of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])ei(e,a,"background-color",t.iconColor);ei(e,".swal2-success-ring","border-color",t.iconColor)}},Pi=e=>`<div class="${ln["icon-content"]}">${e}</div>`;let Ri=!1,Di=0,Mi=0,Li=0,Oi=0;const Fi=e=>{const t=kn();if(e.target===t||En().contains(e.target)){Ri=!0;const a=qi(e);Di=a.clientX,Mi=a.clientY,Li=parseInt(t.style.insetInlineStart)||0,Oi=parseInt(t.style.insetBlockStart)||0,Gn(t,"swal2-dragging")}},Ui=e=>{const t=kn();if(Ri){let{clientX:a,clientY:n}=qi(e);t.style.insetInlineStart=`${Li+(a-Di)}px`,t.style.insetBlockStart=`${Oi+(n-Mi)}px`}},Bi=()=>{const e=kn();Ri=!1,Yn(e,"swal2-dragging")},qi=e=>{let t=0,a=0;return e.type.startsWith("mouse")?(t=e.clientX,a=e.clientY):e.type.startsWith("touch")&&(t=e.touches[0].clientX,a=e.touches[0].clientY),{clientX:t,clientY:a}},ji=(e,t)=>{const a=yn(),n=kn();if(a&&n){if(t.toast){Qn(a,"width",t.width),n.style.width="100%";const e=Dn();e&&n.insertBefore(e,En())}else Qn(n,"width",t.width);Qn(n,"padding",t.padding),t.color&&(n.style.color=t.color),t.background&&(n.style.background=t.background),Zn(xn()),$i(n,t),t.draggable&&!t.toast?(Gn(n,ln.draggable),(e=>{e.addEventListener("mousedown",Fi),document.body.addEventListener("mousemove",Ui),e.addEventListener("mouseup",Bi),e.addEventListener("touchstart",Fi),document.body.addEventListener("touchmove",Ui),e.addEventListener("touchend",Bi)})(n)):(Yn(n,ln.draggable),(e=>{e.removeEventListener("mousedown",Fi),document.body.removeEventListener("mousemove",Ui),e.removeEventListener("mouseup",Bi),e.removeEventListener("touchstart",Fi),document.body.removeEventListener("touchmove",Ui),e.removeEventListener("touchend",Bi)})(n))}},$i=(e,t)=>{const a=t.showClass||{};e.className=`${ln.popup} ${ai(e)?a.popup:""}`,t.toast?(Gn([document.documentElement,document.body],ln["toast-shown"]),Gn(e,ln.toast)):Gn(e,ln.modal),zn(e,t,"popup"),"string"==typeof t.customClass&&Gn(e,t.customClass),t.icon&&Gn(e,ln[`icon-${t.icon}`])},zi=e=>{const t=document.createElement("li");return Gn(t,ln["progress-step"]),jn(t,e),t},Vi=e=>{const t=document.createElement("li");return Gn(t,ln["progress-step-line"]),e.progressStepsDistance&&Qn(t,"width",e.progressStepsDistance),t},Wi=(e,t)=>{ji(0,t),fi(0,t),((e,t)=>{const a=Nn();if(!a)return;const{progressSteps:n,currentProgressStep:i}=t;n&&0!==n.length&&void 0!==i?(Jn(a),a.textContent="",i>=n.length&&hn("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),n.forEach((e,s)=>{const o=zi(e);if(a.appendChild(o),s===i&&Gn(o,ln["active-progress-step"]),s!==n.length-1){const e=Vi(t);a.appendChild(e)}})):Zn(a)})(0,t),((e,t)=>{const a=gi.innerParams.get(e),n=En();if(!n)return;if(a&&t.icon===a.icon)return xi(n,t),void Ii(n,t);if(!t.icon&&!t.iconHtml)return void Zn(n);if(t.icon&&-1===Object.keys(cn).indexOf(t.icon))return pn(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${t.icon}"`),void Zn(n);Jn(n),xi(n,t),Ii(n,t),Gn(n,t.showClass&&t.showClass.icon),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",Ni)})(e,t),((e,t)=>{const a=In();a&&(t.imageUrl?(Jn(a,""),a.setAttribute("src",t.imageUrl),a.setAttribute("alt",t.imageAlt||""),Qn(a,"width",t.imageWidth),Qn(a,"height",t.imageHeight),a.className=ln.image,zn(a,t,"image")):Zn(a))})(0,t),((e,t)=>{const a=Sn();a&&(Xn(a),ti(a,t.title||t.titleText,"block"),t.title&&ci(t.title,a),t.titleText&&(a.innerText=t.titleText),zn(a,t,"title"))})(0,t),((e,t)=>{const a=Fn();a&&(jn(a,t.closeButtonHtml||""),zn(a,t,"closeButton"),ti(a,t.showCloseButton),a.setAttribute("aria-label",t.closeButtonAriaLabel||""))})(0,t),Ti(e,t),hi(0,t),((e,t)=>{const a=Ln();a&&(Xn(a),ti(a,t.footer,"block"),t.footer&&ci(t.footer,a),zn(a,t,"footer"))})(0,t);const a=kn();"function"==typeof t.didRender&&a&&t.didRender(a),sn.eventEmitter.emit("didRender",a)},Hi=()=>{var e;return null===(e=An())||void 0===e?void 0:e.click()},Gi=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),Yi=e=>{e.keydownTarget&&e.keydownHandlerAdded&&(e.keydownTarget.removeEventListener("keydown",e.keydownHandler,{capture:e.keydownListenerCapture}),e.keydownHandlerAdded=!1)},Ki=(e,t)=>{var a;const n=Un();if(n.length)return-2===(e+=t)&&(e=n.length-1),e===n.length?e=0:-1===e&&(e=n.length-1),void n[e].focus();null===(a=kn())||void 0===a||a.focus()},Qi=["ArrowRight","ArrowDown"],Ji=["ArrowLeft","ArrowUp"],Zi=(e,t,a)=>{e&&(t.isComposing||229===t.keyCode||(e.stopKeydownPropagation&&t.stopPropagation(),"Enter"===t.key?Xi(t,e):"Tab"===t.key?es(t):[...Qi,...Ji].includes(t.key)?ts(t.key):"Escape"===t.key&&as(t,e,a)))},Xi=(e,t)=>{if(!gn(t.allowEnterKey))return;const a=Vn(kn(),t.input);if(e.target&&a&&e.target instanceof HTMLElement&&e.target.outerHTML===a.outerHTML){if(["textarea","file"].includes(t.input))return;Hi(),e.preventDefault()}},es=e=>{const t=e.target,a=Un();let n=-1;for(let i=0;i<a.length;i++)if(t===a[i]){n=i;break}e.shiftKey?Ki(n,-1):Ki(n,1),e.stopPropagation(),e.preventDefault()},ts=e=>{const t=Mn(),a=An(),n=Rn(),i=Pn();if(!(t&&a&&n&&i))return;const s=[a,n,i];if(document.activeElement instanceof HTMLElement&&!s.includes(document.activeElement))return;const o=Qi.includes(e)?"nextElementSibling":"previousElementSibling";let r=document.activeElement;if(r){for(let e=0;e<t.children.length;e++){if(r=r[o],!r)return;if(r instanceof HTMLButtonElement&&ai(r))break}r instanceof HTMLButtonElement&&r.focus()}},as=(e,t,a)=>{gn(t.allowEscapeKey)&&(e.preventDefault(),a(Gi.esc))};var ns={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const is=()=>{Array.from(document.body.children).forEach(e=>{e.hasAttribute("data-previous-aria-hidden")?(e.setAttribute("aria-hidden",e.getAttribute("data-previous-aria-hidden")||""),e.removeAttribute("data-previous-aria-hidden")):e.removeAttribute("aria-hidden")})},ss="undefined"!=typeof window&&!!window.GestureEvent,os=()=>{const e=yn();if(!e)return;let t;e.ontouchstart=e=>{t=rs(e)},e.ontouchmove=e=>{t&&(e.preventDefault(),e.stopPropagation())}},rs=e=>{const t=e.target,a=yn(),n=Tn();return!(!a||!n)&&(!ls(e)&&!cs(e)&&(t===a||!(ni(a)||!(t instanceof HTMLElement)||((e,t)=>{let a=e;for(;a&&a!==t;){if(ni(a))return!0;a=a.parentElement}return!1})(t,n)||"INPUT"===t.tagName||"TEXTAREA"===t.tagName||ni(n)&&n.contains(t))))},ls=e=>e.touches&&e.touches.length&&"stylus"===e.touches[0].touchType,cs=e=>e.touches&&e.touches.length>1;let ds=null;const us=e=>{null===ds&&(document.body.scrollHeight>window.innerHeight||"scroll"===e)&&(ds=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${ds+(()=>{const e=document.createElement("div");e.className=ln["scrollbar-measure"],document.body.appendChild(e);const t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t})()}px`)};function hs(e,t,a,n){qn()?ys(e,n):(on(a).then(()=>ys(e,n)),Yi(sn)),ss?(t.setAttribute("style","display:none !important"),t.removeAttribute("class"),t.innerHTML=""):t.remove(),Bn()&&(null!==ds&&(document.body.style.paddingRight=`${ds}px`,ds=null),(()=>{if($n(document.body,ln.iosfix)){const e=parseInt(document.body.style.top,10);Yn(document.body,ln.iosfix),document.body.style.top="",document.body.scrollTop=-1*e}})(),is()),Yn([document.documentElement,document.body],[ln.shown,ln["height-auto"],ln["no-backdrop"],ln["toast-shown"]])}function ps(e){e=vs(e);const t=ns.swalPromiseResolve.get(this),a=ms(this);this.isAwaitingPromise?e.isDismissed||(gs(this),t(e)):a&&t(e)}const ms=e=>{const t=kn();if(!t)return!1;const a=gi.innerParams.get(e);if(!a||$n(t,a.hideClass.popup))return!1;Yn(t,a.showClass.popup),Gn(t,a.hideClass.popup);const n=yn();return Yn(n,a.showClass.backdrop),Gn(n,a.hideClass.backdrop),bs(e,t,a),!0};function fs(e){const t=ns.swalPromiseReject.get(this);gs(this),t&&t(e)}const gs=e=>{e.isAwaitingPromise&&(delete e.isAwaitingPromise,gi.innerParams.get(e)||e._destroy())},vs=e=>void 0===e?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},e),bs=(e,t,a)=>{var n;const i=yn(),s=ii(t);"function"==typeof a.willClose&&a.willClose(t),null===(n=sn.eventEmitter)||void 0===n||n.emit("willClose",t),s?ws(e,t,i,a.returnFocus,a.didClose):hs(e,i,a.returnFocus,a.didClose)},ws=(e,t,a,n,i)=>{sn.swalCloseEventFinishedCallback=hs.bind(null,e,a,n,i);const s=function(e){var a;e.target===t&&(null===(a=sn.swalCloseEventFinishedCallback)||void 0===a||a.call(sn),delete sn.swalCloseEventFinishedCallback,t.removeEventListener("animationend",s),t.removeEventListener("transitionend",s))};t.addEventListener("animationend",s),t.addEventListener("transitionend",s)},ys=(e,t)=>{setTimeout(()=>{var a;"function"==typeof t&&t.bind(e.params)(),null===(a=sn.eventEmitter)||void 0===a||a.emit("didClose"),e._destroy&&e._destroy()})},_s=e=>{let t=kn();if(t||new tr,t=kn(),!t)return;const a=Dn();qn()?Zn(En()):Cs(t,e),Jn(a),t.setAttribute("data-loading","true"),t.setAttribute("aria-busy","true"),t.focus()},Cs=(e,t)=>{const a=Mn(),n=Dn();a&&n&&(!t&&ai(An())&&(t=An()),Jn(a),t&&(Zn(t),n.setAttribute("data-button-to-replace",t.className),a.insertBefore(n,t)),Gn([e,a],ln.loading))},ks=e=>e.checked?1:0,Es=e=>e.checked?e.value:null,Ss=e=>e.files&&e.files.length?null!==e.getAttribute("multiple")?e.files:e.files[0]:null,Ts=(e,t)=>{const a=kn();if(!a)return;const n=e=>{"select"===t.input?function(e,t,a){const n=Kn(e,ln.select);if(!n)return;const i=(e,t,n)=>{const i=document.createElement("option");i.value=n,jn(i,t),i.selected=xs(n,a.inputValue),e.appendChild(i)};t.forEach(e=>{const t=e[0],a=e[1];if(Array.isArray(a)){const e=document.createElement("optgroup");e.label=t,e.disabled=!1,n.appendChild(e),a.forEach(t=>i(e,t[1],t[0]))}else i(n,a,t)}),n.focus()}(a,Ns(e),t):"radio"===t.input&&function(e,t,a){const n=Kn(e,ln.radio);if(!n)return;t.forEach(e=>{const t=e[0],i=e[1],s=document.createElement("input"),o=document.createElement("label");s.type="radio",s.name=ln.radio,s.value=t,xs(t,a.inputValue)&&(s.checked=!0);const r=document.createElement("span");jn(r,i),r.className=ln.label,o.appendChild(s),o.appendChild(r),n.appendChild(o)});const i=n.querySelectorAll("input");i.length&&i[0].focus()}(a,Ns(e),t)};vn(t.inputOptions)||wn(t.inputOptions)?(_s(An()),bn(t.inputOptions).then(t=>{e.hideLoading(),n(t)})):"object"==typeof t.inputOptions?n(t.inputOptions):pn("Unexpected type of inputOptions! Expected object, Map or Promise, got "+typeof t.inputOptions)},Is=(e,t)=>{const a=e.getInput();a&&(Zn(a),bn(t.inputValue).then(n=>{a.value="number"===t.input?`${parseFloat(n)||0}`:`${n}`,Jn(a),a.focus(),e.hideLoading()}).catch(t=>{pn(`Error in inputValue promise: ${t}`),a.value="",Jn(a),a.focus(),e.hideLoading()}))};const Ns=e=>{const t=[];return e instanceof Map?e.forEach((e,a)=>{let n=e;"object"==typeof n&&(n=Ns(n)),t.push([a,n])}):Object.keys(e).forEach(a=>{let n=e[a];"object"==typeof n&&(n=Ns(n)),t.push([a,n])}),t},xs=(e,t)=>!!t&&t.toString()===e.toString(),As=(e,t)=>{const a=gi.innerParams.get(e);if(!a.input)return void pn(`The "input" parameter is needed to be set when using returnInputValueOn${un(t)}`);const n=e.getInput(),i=((e,t)=>{const a=e.getInput();if(!a)return null;switch(t.input){case"checkbox":return ks(a);case"radio":return Es(a);case"file":return Ss(a);default:return t.inputAutoTrim?a.value.trim():a.value}})(e,a);a.inputValidator?Ps(e,i,t):n&&!n.checkValidity()?(e.enableButtons(),e.showValidationMessage(a.validationMessage||n.validationMessage)):"deny"===t?Rs(e,i):Ls(e,i)},Ps=(e,t,a)=>{const n=gi.innerParams.get(e);e.disableInput();Promise.resolve().then(()=>bn(n.inputValidator(t,n.validationMessage))).then(n=>{e.enableButtons(),e.enableInput(),n?e.showValidationMessage(n):"deny"===a?Rs(e,t):Ls(e,t)})},Rs=(e,t)=>{const a=gi.innerParams.get(e||void 0);if(a.showLoaderOnDeny&&_s(Rn()),a.preDeny){e.isAwaitingPromise=!0;Promise.resolve().then(()=>bn(a.preDeny(t,a.validationMessage))).then(a=>{!1===a?(e.hideLoading(),gs(e)):e.close({isDenied:!0,value:void 0===a?t:a})}).catch(t=>Ms(e||void 0,t))}else e.close({isDenied:!0,value:t})},Ds=(e,t)=>{e.close({isConfirmed:!0,value:t})},Ms=(e,t)=>{e.rejectPromise(t)},Ls=(e,t)=>{const a=gi.innerParams.get(e||void 0);if(a.showLoaderOnConfirm&&_s(),a.preConfirm){e.resetValidationMessage(),e.isAwaitingPromise=!0;Promise.resolve().then(()=>bn(a.preConfirm(t,a.validationMessage))).then(a=>{ai(xn())||!1===a?(e.hideLoading(),gs(e)):Ds(e,void 0===a?t:a)}).catch(t=>Ms(e||void 0,t))}else Ds(e,t)};function Os(){const e=gi.innerParams.get(this);if(!e)return;const t=gi.domCache.get(this);Zn(t.loader),qn()?e.icon&&Jn(En()):Fs(t),Yn([t.popup,t.actions],ln.loading),t.popup.removeAttribute("aria-busy"),t.popup.removeAttribute("data-loading"),t.confirmButton.disabled=!1,t.denyButton.disabled=!1,t.cancelButton.disabled=!1}const Fs=e=>{const t=e.popup.getElementsByClassName(e.loader.getAttribute("data-button-to-replace"));t.length?Jn(t[0],"inline-block"):ai(An())||ai(Rn())||ai(Pn())||Zn(e.actions)};function Us(){const e=gi.innerParams.get(this),t=gi.domCache.get(this);return t?Vn(t.popup,e.input):null}function Bs(e,t,a){const n=gi.domCache.get(e);t.forEach(e=>{n[e].disabled=a})}function qs(e,t){const a=kn();if(a&&e)if("radio"===e.type){const e=a.querySelectorAll(`[name="${ln.radio}"]`);for(let a=0;a<e.length;a++)e[a].disabled=t}else e.disabled=t}function js(){Bs(this,["confirmButton","denyButton","cancelButton"],!1)}function $s(){Bs(this,["confirmButton","denyButton","cancelButton"],!0)}function zs(){qs(this.getInput(),!1)}function Vs(){qs(this.getInput(),!0)}function Ws(e){const t=gi.domCache.get(this),a=gi.innerParams.get(this);jn(t.validationMessage,e),t.validationMessage.className=ln["validation-message"],a.customClass&&a.customClass.validationMessage&&Gn(t.validationMessage,a.customClass.validationMessage),Jn(t.validationMessage);const n=this.getInput();n&&(n.setAttribute("aria-invalid","true"),n.setAttribute("aria-describedby",ln["validation-message"]),Wn(n),Gn(n,ln.inputerror))}function Hs(){const e=gi.domCache.get(this);e.validationMessage&&Zn(e.validationMessage);const t=this.getInput();t&&(t.removeAttribute("aria-invalid"),t.removeAttribute("aria-describedby"),Yn(t,ln.inputerror))}const Gs={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,draggable:!1,animation:!0,theme:"light",showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0,topLayer:!1},Ys=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","draggable","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","theme","willClose"],Ks={allowEnterKey:void 0},Qs=["allowOutsideClick","allowEnterKey","backdrop","draggable","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],Js=e=>Object.prototype.hasOwnProperty.call(Gs,e),Zs=e=>-1!==Ys.indexOf(e),Xs=e=>Ks[e],eo=e=>{Js(e)||hn(`Unknown parameter "${e}"`)},to=e=>{Qs.includes(e)&&hn(`The parameter "${e}" is incompatible with toasts`)},ao=e=>{const t=Xs(e);t&&fn(e,t)},no=e=>{!1===e.backdrop&&e.allowOutsideClick&&hn('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`'),e.theme&&!["light","dark","auto","minimal","borderless","embed-iframe","bulma","bulma-light","bulma-dark"].includes(e.theme)&&hn(`Invalid theme "${e.theme}"`);for(const t in e)eo(t),e.toast&&to(t),ao(t)};function io(e){const t=yn(),a=kn(),n=gi.innerParams.get(this);if(!a||$n(a,n.hideClass.popup))return void hn("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");const i=so(e),s=Object.assign({},n,i);no(s),t.dataset.swal2Theme=s.theme,Wi(this,s),gi.innerParams.set(this,s),Object.defineProperties(this,{params:{value:Object.assign({},this.params,e),writable:!1,enumerable:!0}})}const so=e=>{const t={};return Object.keys(e).forEach(a=>{Zs(a)?t[a]=e[a]:hn(`Invalid parameter to update: ${a}`)}),t};function oo(){const e=gi.domCache.get(this),t=gi.innerParams.get(this);t?(e.popup&&sn.swalCloseEventFinishedCallback&&(sn.swalCloseEventFinishedCallback(),delete sn.swalCloseEventFinishedCallback),"function"==typeof t.didDestroy&&t.didDestroy(),sn.eventEmitter.emit("didDestroy"),ro(this)):lo(this)}const ro=e=>{lo(e),delete e.params,delete sn.keydownHandler,delete sn.keydownTarget,delete sn.currentInstance},lo=e=>{e.isAwaitingPromise?(co(gi,e),e.isAwaitingPromise=!0):(co(ns,e),co(gi,e),delete e.isAwaitingPromise,delete e.disableButtons,delete e.enableButtons,delete e.getInput,delete e.disableInput,delete e.enableInput,delete e.hideLoading,delete e.disableLoading,delete e.showValidationMessage,delete e.resetValidationMessage,delete e.close,delete e.closePopup,delete e.closeModal,delete e.closeToast,delete e.rejectPromise,delete e.update,delete e._destroy)},co=(e,t)=>{for(const a in e)e[a].delete(t)};var uo=Object.freeze({__proto__:null,_destroy:oo,close:ps,closeModal:ps,closePopup:ps,closeToast:ps,disableButtons:$s,disableInput:Vs,disableLoading:Os,enableButtons:js,enableInput:zs,getInput:Us,handleAwaitingPromise:gs,hideLoading:Os,rejectPromise:fs,resetValidationMessage:Hs,showValidationMessage:Ws,update:io});const ho=(e,t,a)=>{t.popup.onclick=()=>{e&&(po(e)||e.timer||e.input)||a(Gi.close)}},po=e=>!!(e.showConfirmButton||e.showDenyButton||e.showCancelButton||e.showCloseButton);let mo=!1;const fo=e=>{e.popup.onmousedown=()=>{e.container.onmouseup=function(t){e.container.onmouseup=()=>{},t.target===e.container&&(mo=!0)}}},go=e=>{e.container.onmousedown=t=>{t.target===e.container&&t.preventDefault(),e.popup.onmouseup=function(t){e.popup.onmouseup=()=>{},(t.target===e.popup||t.target instanceof HTMLElement&&e.popup.contains(t.target))&&(mo=!0)}}},vo=(e,t,a)=>{t.container.onclick=n=>{mo?mo=!1:n.target===t.container&&gn(e.allowOutsideClick)&&a(Gi.backdrop)}},bo=e=>e instanceof Element||(e=>"object"==typeof e&&e.jquery)(e);const wo=()=>{if(sn.timeout)return(()=>{const e=On();if(!e)return;const t=parseInt(window.getComputedStyle(e).width);e.style.removeProperty("transition"),e.style.width="100%";const a=t/parseInt(window.getComputedStyle(e).width)*100;e.style.width=`${a}%`})(),sn.timeout.stop()},yo=()=>{if(sn.timeout){const e=sn.timeout.start();return si(e),e}};let _o=!1;const Co={};const ko=e=>{for(let t=e.target;t&&t!==document;t=t.parentNode)for(const e in Co){const a=t.getAttribute(e);if(a)return void Co[e].fire({template:a})}};sn.eventEmitter=new class{constructor(){this.events={}}_getHandlersByEventName(e){return void 0===this.events[e]&&(this.events[e]=[]),this.events[e]}on(e,t){const a=this._getHandlersByEventName(e);a.includes(t)||a.push(t)}once(e,t){const a=(...n)=>{this.removeListener(e,a),t.apply(this,n)};this.on(e,a)}emit(e,...t){this._getHandlersByEventName(e).forEach(e=>{try{e.apply(this,t)}catch(a){console.error(a)}})}removeListener(e,t){const a=this._getHandlersByEventName(e),n=a.indexOf(t);n>-1&&a.splice(n,1)}removeAllListeners(e){void 0!==this.events[e]&&(this.events[e].length=0)}reset(){this.events={}}};var Eo=Object.freeze({__proto__:null,argsToParams:e=>{const t={};return"object"!=typeof e[0]||bo(e[0])?["title","html","icon"].forEach((a,n)=>{const i=e[n];"string"==typeof i||bo(i)?t[a]=i:void 0!==i&&pn(`Unexpected type of ${a}! Expected "string" or "Element", got ${typeof i}`)}):Object.assign(t,e[0]),t},bindClickHandler:function(e="data-swal-template"){Co[e]=this,_o||(document.body.addEventListener("click",ko),_o=!0)},clickCancel:()=>{var e;return null===(e=Pn())||void 0===e?void 0:e.click()},clickConfirm:Hi,clickDeny:()=>{var e;return null===(e=Rn())||void 0===e?void 0:e.click()},enableLoading:_s,fire:function(...e){return new this(...e)},getActions:Mn,getCancelButton:Pn,getCloseButton:Fn,getConfirmButton:An,getContainer:yn,getDenyButton:Rn,getFocusableElements:Un,getFooter:Ln,getHtmlContainer:Tn,getIcon:En,getIconContent:()=>Cn(ln["icon-content"]),getImage:In,getInputLabel:()=>Cn(ln["input-label"]),getLoader:Dn,getPopup:kn,getProgressSteps:Nn,getTimerLeft:()=>sn.timeout&&sn.timeout.getTimerLeft(),getTimerProgressBar:On,getTitle:Sn,getValidationMessage:xn,increaseTimer:e=>{if(sn.timeout){const t=sn.timeout.increase(e);return si(t,!0),t}},isDeprecatedParameter:Xs,isLoading:()=>{const e=kn();return!!e&&e.hasAttribute("data-loading")},isTimerRunning:()=>!(!sn.timeout||!sn.timeout.isRunning()),isUpdatableParameter:Zs,isValidParameter:Js,isVisible:()=>ai(kn()),mixin:function(e){return class extends(this){_main(t,a){return super._main(t,Object.assign({},e,a))}}},off:(e,t)=>{e?t?sn.eventEmitter.removeListener(e,t):sn.eventEmitter.removeAllListeners(e):sn.eventEmitter.reset()},on:(e,t)=>{sn.eventEmitter.on(e,t)},once:(e,t)=>{sn.eventEmitter.once(e,t)},resumeTimer:yo,showLoading:_s,stopTimer:wo,toggleTimer:()=>{const e=sn.timeout;return e&&(e.running?wo():yo())}});class So{constructor(e,t){this.callback=e,this.remaining=t,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=(new Date).getTime()-this.started.getTime()),this.remaining}increase(e){const t=this.running;return t&&this.stop(),this.remaining+=e,t&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const To=["swal-title","swal-html","swal-footer"],Io=e=>{const t={};return Array.from(e.querySelectorAll("swal-param")).forEach(e=>{Lo(e,["name","value"]);const a=e.getAttribute("name"),n=e.getAttribute("value");a&&n&&(t[a]="boolean"==typeof Gs[a]?"false"!==n:"object"==typeof Gs[a]?JSON.parse(n):n)}),t},No=e=>{const t={};return Array.from(e.querySelectorAll("swal-function-param")).forEach(e=>{const a=e.getAttribute("name"),n=e.getAttribute("value");a&&n&&(t[a]=new Function(`return ${n}`)())}),t},xo=e=>{const t={};return Array.from(e.querySelectorAll("swal-button")).forEach(e=>{Lo(e,["type","color","aria-label"]);const a=e.getAttribute("type");a&&["confirm","cancel","deny"].includes(a)&&(t[`${a}ButtonText`]=e.innerHTML,t[`show${un(a)}Button`]=!0,e.hasAttribute("color")&&(t[`${a}ButtonColor`]=e.getAttribute("color")),e.hasAttribute("aria-label")&&(t[`${a}ButtonAriaLabel`]=e.getAttribute("aria-label")))}),t},Ao=e=>{const t={},a=e.querySelector("swal-image");return a&&(Lo(a,["src","width","height","alt"]),a.hasAttribute("src")&&(t.imageUrl=a.getAttribute("src")||void 0),a.hasAttribute("width")&&(t.imageWidth=a.getAttribute("width")||void 0),a.hasAttribute("height")&&(t.imageHeight=a.getAttribute("height")||void 0),a.hasAttribute("alt")&&(t.imageAlt=a.getAttribute("alt")||void 0)),t},Po=e=>{const t={},a=e.querySelector("swal-icon");return a&&(Lo(a,["type","color"]),a.hasAttribute("type")&&(t.icon=a.getAttribute("type")),a.hasAttribute("color")&&(t.iconColor=a.getAttribute("color")),t.iconHtml=a.innerHTML),t},Ro=e=>{const t={},a=e.querySelector("swal-input");a&&(Lo(a,["type","label","placeholder","value"]),t.input=a.getAttribute("type")||"text",a.hasAttribute("label")&&(t.inputLabel=a.getAttribute("label")),a.hasAttribute("placeholder")&&(t.inputPlaceholder=a.getAttribute("placeholder")),a.hasAttribute("value")&&(t.inputValue=a.getAttribute("value")));const n=Array.from(e.querySelectorAll("swal-input-option"));return n.length&&(t.inputOptions={},n.forEach(e=>{Lo(e,["value"]);const a=e.getAttribute("value");if(!a)return;const n=e.innerHTML;t.inputOptions[a]=n})),t},Do=(e,t)=>{const a={};for(const n in t){const i=t[n],s=e.querySelector(i);s&&(Lo(s,[]),a[i.replace(/^swal-/,"")]=s.innerHTML.trim())}return a},Mo=e=>{const t=To.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(e.children).forEach(e=>{const a=e.tagName.toLowerCase();t.includes(a)||hn(`Unrecognized element <${a}>`)})},Lo=(e,t)=>{Array.from(e.attributes).forEach(a=>{-1===t.indexOf(a.name)&&hn([`Unrecognized attribute "${a.name}" on <${e.tagName.toLowerCase()}>.`,""+(t.length?`Allowed attributes are: ${t.join(", ")}`:"To set the value, use HTML within the element.")])})},Oo=e=>{const t=yn(),a=kn();"function"==typeof e.willOpen&&e.willOpen(a),sn.eventEmitter.emit("willOpen",a);const n=window.getComputedStyle(document.body).overflowY;qo(t,a,e),setTimeout(()=>{Uo(t,a)},10),Bn()&&(Bo(t,e.scrollbarPadding,n),(()=>{const e=yn();Array.from(document.body.children).forEach(t=>{t.contains(e)||(t.hasAttribute("aria-hidden")&&t.setAttribute("data-previous-aria-hidden",t.getAttribute("aria-hidden")||""),t.setAttribute("aria-hidden","true"))})})()),qn()||sn.previousActiveElement||(sn.previousActiveElement=document.activeElement),"function"==typeof e.didOpen&&setTimeout(()=>e.didOpen(a)),sn.eventEmitter.emit("didOpen",a),Yn(t,ln["no-transition"])},Fo=e=>{const t=kn();if(e.target!==t)return;const a=yn();t.removeEventListener("animationend",Fo),t.removeEventListener("transitionend",Fo),a.style.overflowY="auto"},Uo=(e,t)=>{ii(t)?(e.style.overflowY="hidden",t.addEventListener("animationend",Fo),t.addEventListener("transitionend",Fo)):e.style.overflowY="auto"},Bo=(e,t,a)=>{(()=>{if(ss&&!$n(document.body,ln.iosfix)){const e=document.body.scrollTop;document.body.style.top=-1*e+"px",Gn(document.body,ln.iosfix),os()}})(),t&&"hidden"!==a&&us(a),setTimeout(()=>{e.scrollTop=0})},qo=(e,t,a)=>{Gn(e,a.showClass.backdrop),a.animation?(t.style.setProperty("opacity","0","important"),Jn(t,"grid"),setTimeout(()=>{Gn(t,a.showClass.popup),t.style.removeProperty("opacity")},10)):Jn(t,"grid"),Gn([document.documentElement,document.body],ln.shown),a.heightAuto&&a.backdrop&&!a.toast&&Gn([document.documentElement,document.body],ln["height-auto"])};var jo=(e,t)=>/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(e)?Promise.resolve():Promise.resolve(t||"Invalid email address"),$o=(e,t)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(e)?Promise.resolve():Promise.resolve(t||"Invalid URL");function zo(e){!function(e){e.inputValidator||("email"===e.input&&(e.inputValidator=jo),"url"===e.input&&(e.inputValidator=$o))}(e),e.showLoaderOnConfirm&&!e.preConfirm&&hn("showLoaderOnConfirm is set to true, but preConfirm is not defined.\nshowLoaderOnConfirm should be used together with preConfirm, see usage example:\nhttps://sweetalert2.github.io/#ajax-request"),function(e){(!e.target||"string"==typeof e.target&&!document.querySelector(e.target)||"string"!=typeof e.target&&!e.target.appendChild)&&(hn('Target parameter is not valid, defaulting to "body"'),e.target="body")}(e),"string"==typeof e.title&&(e.title=e.title.split("\n").join("<br />")),li(e)}let Vo;var Wo=new WeakMap;class Ho{constructor(...e){if(nn(this,Wo,void 0),"undefined"==typeof window)return;Vo=this;const t=Object.freeze(this.constructor.argsToParams(e));var a,n,i;this.params=t,this.isAwaitingPromise=!1,a=Wo,n=this,i=this._main(Vo.params),a.set(tn(a,n),i)}_main(e,t={}){if(no(Object.assign({},t,e)),sn.currentInstance){const e=ns.swalPromiseResolve.get(sn.currentInstance),{isAwaitingPromise:t}=sn.currentInstance;sn.currentInstance._destroy(),t||e({isDismissed:!0}),Bn()&&is()}sn.currentInstance=Vo;const a=Yo(e,t);zo(a),Object.freeze(a),sn.timeout&&(sn.timeout.stop(),delete sn.timeout),clearTimeout(sn.restoreFocusTimeout);const n=Ko(Vo);return Wi(Vo,a),gi.innerParams.set(Vo,a),Go(Vo,n,a)}then(e){return an(Wo,this).then(e)}finally(e){return an(Wo,this).finally(e)}}const Go=(e,t,a)=>new Promise((n,i)=>{const s=t=>{e.close({isDismissed:!0,dismiss:t})};ns.swalPromiseResolve.set(e,n),ns.swalPromiseReject.set(e,i),t.confirmButton.onclick=()=>{(e=>{const t=gi.innerParams.get(e);e.disableButtons(),t.input?As(e,"confirm"):Ls(e,!0)})(e)},t.denyButton.onclick=()=>{(e=>{const t=gi.innerParams.get(e);e.disableButtons(),t.returnInputValueOnDeny?As(e,"deny"):Rs(e,!1)})(e)},t.cancelButton.onclick=()=>{((e,t)=>{e.disableButtons(),t(Gi.cancel)})(e,s)},t.closeButton.onclick=()=>{s(Gi.close)},((e,t,a)=>{e.toast?ho(e,t,a):(fo(t),go(t),vo(e,t,a))})(a,t,s),((e,t,a)=>{Yi(e),t.toast||(e.keydownHandler=e=>Zi(t,e,a),e.keydownTarget=t.keydownListenerCapture?window:kn(),e.keydownListenerCapture=t.keydownListenerCapture,e.keydownTarget.addEventListener("keydown",e.keydownHandler,{capture:e.keydownListenerCapture}),e.keydownHandlerAdded=!0)})(sn,a,s),((e,t)=>{"select"===t.input||"radio"===t.input?Ts(e,t):["text","email","number","tel","textarea"].some(e=>e===t.input)&&(vn(t.inputValue)||wn(t.inputValue))&&(_s(An()),Is(e,t))})(e,a),Oo(a),Qo(sn,a,s),Jo(t,a),setTimeout(()=>{t.container.scrollTop=0})}),Yo=(e,t)=>{const a=(e=>{const t="string"==typeof e.template?document.querySelector(e.template):e.template;if(!t)return{};const a=t.content;return Mo(a),Object.assign(Io(a),No(a),xo(a),Ao(a),Po(a),Ro(a),Do(a,To))})(e),n=Object.assign({},Gs,t,a,e);return n.showClass=Object.assign({},Gs.showClass,n.showClass),n.hideClass=Object.assign({},Gs.hideClass,n.hideClass),!1===n.animation&&(n.showClass={backdrop:"swal2-noanimation"},n.hideClass={}),n},Ko=e=>{const t={popup:kn(),container:yn(),actions:Mn(),confirmButton:An(),denyButton:Rn(),cancelButton:Pn(),loader:Dn(),closeButton:Fn(),validationMessage:xn(),progressSteps:Nn()};return gi.domCache.set(e,t),t},Qo=(e,t,a)=>{const n=On();Zn(n),t.timer&&(e.timeout=new So(()=>{a("timer"),delete e.timeout},t.timer),t.timerProgressBar&&(Jn(n),zn(n,t,"timerProgressBar"),setTimeout(()=>{e.timeout&&e.timeout.running&&si(t.timer)})))},Jo=(e,t)=>{if(!t.toast)return gn(t.allowEnterKey)?void(Zo(e)||Xo(e,t)||Ki(-1,1)):(fn("allowEnterKey"),void er())},Zo=e=>{const t=Array.from(e.popup.querySelectorAll("[autofocus]"));for(const a of t)if(a instanceof HTMLElement&&ai(a))return a.focus(),!0;return!1},Xo=(e,t)=>t.focusDeny&&ai(e.denyButton)?(e.denyButton.focus(),!0):t.focusCancel&&ai(e.cancelButton)?(e.cancelButton.focus(),!0):!(!t.focusConfirm||!ai(e.confirmButton))&&(e.confirmButton.focus(),!0),er=()=>{document.activeElement instanceof HTMLElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()};if("undefined"!=typeof window&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|by|xn--p1ai)$/)){const e=new Date,t=localStorage.getItem("swal-initiation");t?(e.getTime()-Date.parse(t))/864e5>3&&setTimeout(()=>{document.body.style.pointerEvents="none";const e=document.createElement("audio");e.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",e.loop=!0,document.body.appendChild(e),setTimeout(()=>{e.play().catch(()=>{})},2500)},500):localStorage.setItem("swal-initiation",`${e}`)}Ho.prototype.disableButtons=$s,Ho.prototype.enableButtons=js,Ho.prototype.getInput=Us,Ho.prototype.disableInput=Vs,Ho.prototype.enableInput=zs,Ho.prototype.hideLoading=Os,Ho.prototype.disableLoading=Os,Ho.prototype.showValidationMessage=Ws,Ho.prototype.resetValidationMessage=Hs,Ho.prototype.close=ps,Ho.prototype.closePopup=ps,Ho.prototype.closeModal=ps,Ho.prototype.closeToast=ps,Ho.prototype.rejectPromise=fs,Ho.prototype.update=io,Ho.prototype._destroy=oo,Object.assign(Ho,Eo),Object.keys(uo).forEach(e=>{Ho[e]=function(...t){return Vo&&Vo[e]?Vo[e](...t):null}}),Ho.DismissReason=Gi,Ho.version="11.22.0";const tr=Ho;tr.default=tr,"undefined"!=typeof document&&function(e,t){var a=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(a),a.styleSheet)a.styleSheet.disabled||(a.styleSheet.cssText=t);else try{a.innerHTML=t}catch(n){a.innerText=t}}(document,':root{--swal2-outline: 0 0 0 3px rgba(100, 150, 200, 0.5);--swal2-container-padding: 0.625em;--swal2-backdrop: rgba(0, 0, 0, 0.4);--swal2-backdrop-transition: background-color 0.1s;--swal2-width: 32em;--swal2-padding: 0 0 1.25em;--swal2-border: none;--swal2-border-radius: 0.3125rem;--swal2-background: white;--swal2-color: #545454;--swal2-show-animation: swal2-show 0.3s;--swal2-hide-animation: swal2-hide 0.15s forwards;--swal2-icon-zoom: 1;--swal2-icon-animations: true;--swal2-title-padding: 0.8em 1em 0;--swal2-html-container-padding: 1em 1.6em 0.3em;--swal2-input-border: 1px solid #d9d9d9;--swal2-input-border-radius: 0.1875em;--swal2-input-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-background: transparent;--swal2-input-transition: border-color 0.2s, box-shadow 0.2s;--swal2-input-hover-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-focus-border: 1px solid #b4dbed;--swal2-input-focus-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px $swal2-outline-color;--swal2-progress-step-background: #add8e6;--swal2-validation-message-background: #f0f0f0;--swal2-validation-message-color: #666;--swal2-footer-border-color: #eee;--swal2-footer-background: transparent;--swal2-footer-color: inherit;--swal2-close-button-position: initial;--swal2-close-button-inset: auto;--swal2-close-button-font-size: 2.5em;--swal2-close-button-color: #ccc;--swal2-close-button-transition: color 0.2s, box-shadow 0.2s;--swal2-close-button-outline: initial;--swal2-close-button-box-shadow: inset 0 0 0 3px transparent;--swal2-close-button-focus-box-shadow: inset var(--swal2-outline);--swal2-close-button-hover-transform: none;--swal2-actions-justify-content: center;--swal2-actions-width: auto;--swal2-actions-margin: 1.25em auto 0;--swal2-actions-padding: 0;--swal2-actions-border-radius: 0;--swal2-actions-background: transparent;--swal2-action-button-transition: background-color 0.2s, box-shadow 0.2s;--swal2-action-button-hover: black 10%;--swal2-action-button-active: black 10%;--swal2-confirm-button-box-shadow: none;--swal2-confirm-button-border-radius: 0.25em;--swal2-confirm-button-background-color: #7066e0;--swal2-confirm-button-color: #fff;--swal2-deny-button-box-shadow: none;--swal2-deny-button-border-radius: 0.25em;--swal2-deny-button-background-color: #dc3741;--swal2-deny-button-color: #fff;--swal2-cancel-button-box-shadow: none;--swal2-cancel-button-border-radius: 0.25em;--swal2-cancel-button-background-color: #6e7881;--swal2-cancel-button-color: #fff;--swal2-toast-show-animation: swal2-toast-show 0.5s;--swal2-toast-hide-animation: swal2-toast-hide 0.1s forwards;--swal2-toast-border: none;--swal2-toast-box-shadow: 0 0 1px hsl(0deg 0% 0% / 0.075), 0 1px 2px hsl(0deg 0% 0% / 0.075), 1px 2px 4px hsl(0deg 0% 0% / 0.075), 1px 3px 8px hsl(0deg 0% 0% / 0.075), 2px 4px 16px hsl(0deg 0% 0% / 0.075)}[data-swal2-theme=dark]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}@media(prefers-color-scheme: dark){[data-swal2-theme=auto]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px var(--swal2-backdrop)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:var(--swal2-container-padding);overflow-x:hidden;transition:var(--swal2-backdrop-transition);-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:var(--swal2-backdrop)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container)[popover]{width:auto;border:0}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:var(--swal2-width);max-width:100%;padding:var(--swal2-padding);border:var(--swal2-border);border-radius:var(--swal2-border-radius);background:var(--swal2-background);color:var(--swal2-color);font-family:inherit;font-size:1rem;container-name:swal2-popup}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:var(--swal2-title-padding);color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:var(--swal2-actions-justify-content);width:var(--swal2-actions-width);margin:var(--swal2-actions-margin);padding:var(--swal2-actions-padding);border-radius:var(--swal2-actions-border-radius);background:var(--swal2-actions-background)}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:var(--swal2-action-button-transition);border:none;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border-radius:var(--swal2-confirm-button-border-radius);background:initial;background-color:var(--swal2-confirm-button-background-color);box-shadow:var(--swal2-confirm-button-box-shadow);color:var(--swal2-confirm-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):hover{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):active{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border-radius:var(--swal2-deny-button-border-radius);background:initial;background-color:var(--swal2-deny-button-background-color);box-shadow:var(--swal2-deny-button-box-shadow);color:var(--swal2-deny-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):hover{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):active{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border-radius:var(--swal2-cancel-button-border-radius);background:initial;background-color:var(--swal2-cancel-button-background-color);box-shadow:var(--swal2-cancel-button-box-shadow);color:var(--swal2-cancel-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):hover{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):active{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none;box-shadow:var(--swal2-action-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-styled)[disabled]:not(.swal2-loading){opacity:.4}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid var(--swal2-footer-border-color);background:var(--swal2-footer-background);color:var(--swal2-footer-color);font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:var(--swal2-border-radius);border-bottom-left-radius:var(--swal2-border-radius)}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){position:var(--swal2-close-button-position);inset:var(--swal2-close-button-inset);z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:var(--swal2-close-button-transition);border:none;border-radius:var(--swal2-border-radius);outline:var(--swal2-close-button-outline);background:rgba(0,0,0,0);color:var(--swal2-close-button-color);font-family:monospace;font-size:var(--swal2-close-button-font-size);cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:var(--swal2-close-button-hover-transform);background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:var(--swal2-close-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:var(--swal2-html-container-padding);overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:var(--swal2-input-transition);border:var(--swal2-input-border);border-radius:var(--swal2-input-border-radius);background:var(--swal2-input-background);box-shadow:var(--swal2-input-box-shadow);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):hover,div:where(.swal2-container) input:where(.swal2-file):hover,div:where(.swal2-container) textarea:where(.swal2-textarea):hover{box-shadow:var(--swal2-input-hover-box-shadow)}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:var(--swal2-input-focus-border);outline:none;box-shadow:var(--swal2-input-focus-box-shadow)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:var(--swal2-background)}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:var(--swal2-input-background);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:var(--swal2-input-background);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:var(--swal2-background);color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:var(--swal2-validation-message-background);color:var(--swal2-validation-message-color);font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:var(--swal2-progress-step-background);color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:var(--swal2-progress-step-background)}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;zoom:var(--swal2-icon-zoom);border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}}div:where(.swal2-icon).swal2-warning{border-color:#f8bb86;color:#f8bb86}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}}div:where(.swal2-icon).swal2-info{border-color:#3fc3ee;color:#3fc3ee}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}}div:where(.swal2-icon).swal2-question{border-color:#87adbd;color:#87adbd}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:var(--swal2-show-animation)}.swal2-hide{animation:var(--swal2-hide-animation)}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;border:var(--swal2-toast-border);background:var(--swal2-background);box-shadow:var(--swal2-toast-box-shadow);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}@container swal2-popup style(--swal2-icon-animations:true){.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}}.swal2-toast.swal2-show{animation:var(--swal2-toast-show-animation)}.swal2-toast.swal2-hide{animation:var(--swal2-toast-hide-animation)}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}');const ar=tr.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",tr.stopTimer),e.addEventListener("mouseleave",tr.resumeTimer)}}),nr=e=>{ar.fire({icon:"success",title:e})},ir=e=>{ar.fire({icon:"error",title:e})},sr=async(e,t,a="Confirmar",n="Cancelar",i="warning")=>(await tr.fire({title:e,text:t,icon:i,showCancelButton:!0,confirmButtonColor:"danger"===i?"#dc3545":"#007bff",cancelButtonColor:"#6c757d",confirmButtonText:a,cancelButtonText:n,reverseButtons:!0})).isConfirmed,or=n("notifications",{state:()=>({unreadNotifications:[],readNotifications:[],unreadCount:0,waiterUnreadNotifications:[],waiterReadNotifications:[],waiterUnreadCount:0,adminNotifications:[],loading:!1,loadingWaiter:!1,loadingAdmin:!1,globalNotificationsEnabled:!0,tableNotificationsEnabled:{},isConnected:!1}),getters:{allUnreadNotifications:e=>[...e.unreadNotifications,...e.waiterUnreadNotifications],allReadNotifications:e=>[...e.readNotifications,...e.waiterReadNotifications],totalUnreadCount:e=>e.unreadCount+e.waiterUnreadCount,hasUnreadNotifications:e=>e.unreadCount>0||e.waiterUnreadCount>0,getNotificationsByType:e=>t=>[...e.unreadNotifications,...e.readNotifications,...e.waiterUnreadNotifications,...e.waiterReadNotifications].filter(e=>e.type===t),hasNotification:e=>t=>!!(e.unreadNotifications.find(e=>e.id===t)||e.readNotifications.find(e=>e.id===t)||e.waiterUnreadNotifications.find(e=>e.id===t)||e.waiterReadNotifications.find(e=>e.id===t))},actions:{async loadNotifications(){try{this.loading=!0;const e=await Pa.getNotifications();return this.unreadNotifications=e.unread_notifications||[],this.readNotifications=e.read_notifications||[],this.unreadCount=e.unread_count||0,e}catch(e){throw console.error("Error cargando notificaciones:",e),ir("Error al cargar las notificaciones"),e}finally{this.loading=!1}},async handleNotification(e,t){try{const a=await Pa.handleNotification(e,t);if("mark_as_read"===t){const t=this.unreadNotifications.find(t=>t.id===e);t&&(this.unreadNotifications=this.unreadNotifications.filter(t=>t.id!==e),this.readNotifications.unshift(t),this.unreadCount=Math.max(0,this.unreadCount-1))}else"delete"===t&&(this.unreadNotifications=this.unreadNotifications.filter(t=>t.id!==e),this.readNotifications=this.readNotifications.filter(t=>t.id!==e));return nr(a.message||"Notificación procesada correctamente"),a}catch(a){throw console.error("Error manejando notificación:",a),ir("Error al procesar la notificación"),a}},async markAllAsRead(){try{if(0===this.unreadNotifications.length)return;await Pa.markAllAsRead(this.unreadNotifications),this.readNotifications.unshift(...this.unreadNotifications),this.unreadNotifications=[],this.unreadCount=0,nr("Todas las notificaciones marcadas como leídas")}catch(e){throw console.error("Error marcando todas como leídas:",e),ir("Error al marcar como leídas"),e}},async deleteAllRead(){try{if(0===this.readNotifications.length)return;await Pa.deleteAllRead(this.readNotifications),this.readNotifications=[],nr("Notificaciones leídas eliminadas")}catch(e){throw console.error("Error eliminando notificaciones leídas:",e),ir("Error al eliminar notificaciones"),e}},async loadWaiterNotifications(){try{this.loadingWaiter=!0;const e=await Pa.getWaiterNotifications();return this.waiterUnreadNotifications=e.unread_notifications||[],this.waiterReadNotifications=e.read_notifications||[],this.waiterUnreadCount=e.unread_count||0,e}catch(e){throw console.error("Error cargando notificaciones de mozo:",e),ir("Error al cargar las notificaciones"),e}finally{this.loadingWaiter=!1}},async handleWaiterNotification(e,t){try{const a=await Pa.handleWaiterNotification(e,t);if("mark_as_read"===t){const t=this.waiterUnreadNotifications.find(t=>t.id===e);t&&(this.waiterUnreadNotifications=this.waiterUnreadNotifications.filter(t=>t.id!==e),this.waiterReadNotifications.unshift(t),this.waiterUnreadCount=Math.max(0,this.waiterUnreadCount-1))}else"delete"===t&&(this.waiterUnreadNotifications=this.waiterUnreadNotifications.filter(t=>t.id!==e),this.waiterReadNotifications=this.waiterReadNotifications.filter(t=>t.id!==e));return nr(a.message||"Notificación procesada correctamente"),a}catch(a){throw console.error("Error manejando notificación de mozo:",a),ir("Error al procesar la notificación"),a}},async setWaiterGlobalNotifications(e){try{const t=await Pa.waiterGlobalNotifications(e);return this.globalNotificationsEnabled=e,nr(t.message||"Configuración actualizada"),t}catch(t){throw console.error("Error configurando notificaciones globales:",t),ir("Error al actualizar la configuración"),t}},async loadAdminNotifications(){try{this.loadingAdmin=!0;const e=await Pa.getAdminNotifications();return this.adminNotifications=e.notifications||[],e}catch(e){throw console.error("Error cargando notificaciones de administrador:",e),ir("Error al cargar las notificaciones"),e}finally{this.loadingAdmin=!1}},async storeDeviceToken(e,t="web"){try{const a=await Pa.storeDeviceToken(e,t);return nr("Token de dispositivo guardado"),a}catch(a){throw console.error("Error guardando token de dispositivo:",a),ir("Error al guardar el token"),a}},async deleteDeviceToken(e){try{const t=await Pa.deleteDeviceToken(e);return nr("Token de dispositivo eliminado"),t}catch(t){throw console.error("Error eliminando token de dispositivo:",t),ir("Error al eliminar el token"),t}},async toggleTableNotifications(e){try{const t=await Pa.toggleTableNotifications(e);return this.tableNotificationsEnabled[e]=t.notifications_enabled,nr(t.message||"Estado de notificaciones actualizado"),t}catch(t){throw console.error("Error alternando notificaciones de mesa:",t),ir("Error al actualizar notificaciones de mesa"),t}},async initializeRealTimeNotifications(){return Xa(),console.log("🔥 Notificaciones en tiempo real delegadas a Firebase Realtime"),console.log("ℹ️ Las notificaciones de mozo se manejan directamente con Firebase"),this.isConnected=!0,!0},async disconnectRealTimeNotifications(){console.log("🔥 Desconectando notificaciones en tiempo real..."),this.isConnected=!1,console.log("✅ Notificaciones desconectadas")},addNewNotification(e){const t=this.unreadNotifications.find(t=>t.id===e.id),a=this.waiterUnreadNotifications.find(t=>t.id===e.id);if(t||a)return console.log("🔍 Notificación ya existe, actualizando...",e.id),void this.updateExistingNotification(e);"waiter_call"===e.type||"table_call"===e.type?(this.waiterUnreadNotifications.unshift(e),this.waiterUnreadCount++,console.log("🍽️ Nueva notificación de mozo agregada:",e.title||e.body)):(this.unreadNotifications.unshift(e),this.unreadCount++,console.log("🔔 Nueva notificación general agregada:",e.title||e.body));const n=e.title||e.body||e.message||"Tienes una nueva notificación";nr(`Nueva notificación: ${n}`)},updateExistingNotification(e){const t=this.unreadNotifications.findIndex(t=>t.id===e.id);if(-1!==t){if(this.unreadNotifications[t]=e,e.read_at){const e=this.unreadNotifications.splice(t,1)[0];this.readNotifications.unshift(e),this.unreadCount=Math.max(0,this.unreadCount-1)}return}const a=this.waiterUnreadNotifications.findIndex(t=>t.id===e.id);if(-1===a)console.log("⚠️ No se encontró la notificación para actualizar:",e.id);else if(this.waiterUnreadNotifications[a]=e,e.read_at){const e=this.waiterUnreadNotifications.splice(a,1)[0];this.waiterReadNotifications.unshift(e),this.waiterUnreadCount=Math.max(0,this.waiterUnreadCount-1)}},removeNotification(e){this.unreadNotifications=this.unreadNotifications.filter(t=>t.id!==e),this.readNotifications=this.readNotifications.filter(t=>t.id!==e),this.waiterUnreadNotifications=this.waiterUnreadNotifications.filter(t=>t.id!==e),this.waiterReadNotifications=this.waiterReadNotifications.filter(t=>t.id!==e),this.unreadCount=this.unreadNotifications.length,this.waiterUnreadCount=this.waiterUnreadNotifications.length,console.log("🗑️ Notificación eliminada:",e)},clearState(){this.unreadNotifications=[],this.readNotifications=[],this.unreadCount=0,this.waiterUnreadNotifications=[],this.waiterReadNotifications=[],this.waiterUnreadCount=0,this.adminNotifications=[],this.loading=!1,this.loadingWaiter=!1,this.loadingAdmin=!1,this.globalNotificationsEnabled=!0,this.tableNotificationsEnabled={}}}}),rr=Object.freeze(Object.defineProperty({__proto__:null,useNotificationsStore:or},Symbol.toStringTag,{value:"Module"})),lr=(e,t)=>{const a=e.__vccOpts||e;for(const[n,i]of t)a[n]=i;return a},cr={class:"notification-bell-container"},dr={key:0,class:"notification-badge"},ur={class:"dropdown-header"},hr={class:"notification-count"},pr={key:0,class:"notification-list"},mr=["onClick"],fr={class:"notification-content"},gr={class:"notification-title"},vr={class:"notification-message"},br={class:"notification-time"},wr={key:0,class:"unread-dot"},yr={key:1,class:"empty-notifications"},_r={key:2,class:"dropdown-footer"},Cr=lr({__name:"NotificationBell",setup(e){const t=or(),a=i(!1),n=s(()=>t.totalUnreadCount),o=s(()=>t.hasUnreadNotifications),b=s(()=>t.allUnreadNotifications.concat(t.allReadNotifications)),w=s(()=>n.value>99?"99+":n.value);function y(){a.value=!a.value}function _(){a.value=!1}function C(){t.allUnreadNotifications.forEach(e=>{t.handleNotification(e.id,"read")}),_()}function k(e){if(!e)return"";const t=new Date(e),a=new Date-t,n=Math.floor(a/36e5),i=Math.floor(a/6e4);return n>24?t.toLocaleDateString():n>0?`${n}h`:i>0?`${i}m`:"ahora"}function E(e){e.target.closest(".notification-bell-container")||_()}return r(()=>{document.addEventListener("click",E)}),l(()=>{document.removeEventListener("click",E)}),(e,i)=>(d(),c("div",cr,[u("button",{onClick:y,class:m(["notification-bell",{"has-notifications":o.value}])},[i[1]||(i[1]=u("i",{class:"bi bi-bell"},null,-1)),n.value>0?(d(),c("span",dr,p(w.value),1)):h("",!0)],2),a.value?(d(),c("div",{key:0,class:"notification-dropdown",onClick:i[0]||(i[0]=f(()=>{},["stop"]))},[u("div",ur,[i[2]||(i[2]=u("h4",null,"Notificaciones",-1)),u("span",hr,p(n.value)+" nuevas",1)]),b.value.length>0?(d(),c("div",pr,[(d(!0),c(g,null,v(b.value.slice(0,5),e=>{var a,n;return d(),c("div",{key:e.id,class:m(["notification-item",{unread:!e.read_at}]),onClick:a=>function(e){e.read_at||t.handleNotification(e.id,"read")}(e)},[u("div",fr,[u("div",gr,p((null==(a=e.data)?void 0:a.title)||e.title||"Notificación"),1),u("div",vr,p((null==(n=e.data)?void 0:n.message)||e.body||"Nueva notificación recibida"),1),u("div",br,p(k(e.created_at)),1)]),e.read_at?h("",!0):(d(),c("div",wr))],10,mr)}),128))])):(d(),c("div",yr,i[3]||(i[3]=[u("i",{class:"bi bi-bell-slash"},null,-1),u("p",null,"No hay notificaciones",-1)]))),b.value.length>0?(d(),c("div",_r,[u("button",{onClick:C,class:"action-btn"},"Marcar todas como leídas")])):h("",!0)])):h("",!0)]))}},[["__scopeId","data-v-3a3df5a8"]]),kr={class:"navbar-container"},Er={class:"top-bar"},Sr={class:"navbar-left"},Tr={class:"app-title"},Ir={key:0,class:"navbar-right"},Nr=lr({__name:"Navbar",props:{title:{type:String,default:"MÖZÖ"}},setup(e){const t=re(),a=Xa();return(n,i)=>(d(),c("div",kr,[u("header",Er,[u("div",Sr,[u("button",{class:"menu-toggle",onClick:i[0]||(i[0]=(...e)=>o(t).toggleOffCanvas&&o(t).toggleOffCanvas(...e)),"aria-label":"Abrir menú"},i[1]||(i[1]=[u("i",{class:"bi bi-list"},null,-1)])),u("h1",Tr,p(e.title),1)]),o(a).isAuthenticated?(d(),c("div",Ir,[b(Cr)])):h("",!0)])]))}},[["__scopeId","data-v-33d07fba"]]),xr={class:"off-canvas-panel"},Ar={class:"panel-header"},Pr={class:"panel-nav"},Rr={key:0},Dr={key:1},Mr=lr({__name:"OffCanvasNavbar",setup(e){const t=re(),a=Xa(),n=w(),i=s(()=>t.isOffCanvasOpen),l=s(()=>a.currentRole);r(()=>{});const p=async()=>{t.closeOffCanvas(),await a.logout(),n.push("/login")},f=e=>{t.closeOffCanvas(),n.push({name:e})};return(e,a)=>(d(),c("div",{class:m(["off-canvas-container",{open:i.value}])},[u("div",{class:"off-canvas-backdrop",onClick:a[0]||(a[0]=(...e)=>o(t).closeOffCanvas&&o(t).closeOffCanvas(...e))}),u("aside",xr,[u("header",Ar,[a[7]||(a[7]=u("h3",null,"Menú",-1)),u("button",{onClick:a[1]||(a[1]=(...e)=>o(t).closeOffCanvas&&o(t).closeOffCanvas(...e)),class:"close-btn"},"×")]),u("nav",Pr,[u("ul",null,["admin"===l.value?(d(),c("li",Rr,[u("a",{onClick:a[2]||(a[2]=e=>f("admin-home"))},a[8]||(a[8]=[u("i",{class:"bi bi-speedometer2"},null,-1),y(" Dashboard ")]))])):h("",!0),u("li",null,[u("a",{onClick:a[3]||(a[3]=e=>f("admin-notification-debug"))},a[9]||(a[9]=[u("i",{class:"bi bi-bug"},null,-1),y(" Debug Notificaciones ")]))]),"waiter"===l.value?(d(),c("li",Dr,[u("a",{onClick:a[4]||(a[4]=e=>f("waiter-dashboard"))},a[10]||(a[10]=[u("i",{class:"bi bi-grid-1x2-fill"},null,-1),y(" Tablero ")]))])):h("",!0),u("li",null,[u("a",{onClick:a[5]||(a[5]=e=>f("profile"))},a[11]||(a[11]=[u("i",{class:"bi bi-person-fill"},null,-1),y(" Mi Perfil ")]))]),u("li",null,[u("a",{onClick:a[6]||(a[6]=e=>f("role-selection"))},a[12]||(a[12]=[u("i",{class:"bi bi-person-badge-fill"},null,-1),y(" Cambiar Rol ")]))]),a[14]||(a[14]=u("li",{class:"separator"},null,-1)),u("li",null,[u("a",{onClick:p},a[13]||(a[13]=[u("i",{class:"bi bi-box-arrow-right"},null,-1),y(" Cerrar Sesión ")]))])])])])],2))}},[["__scopeId","data-v-7bd94440"]]),Lr="0.0.61",Or=()=>`v${Lr}`,Fr={class:"app-container"},Ur={key:2,class:"app-footer"},Br={class:"footer-content"},qr={class:"version"},jr={__name:"App",setup(e){const t=_(),a=w(),n=Xa(),i=or(),f=s(()=>!["login","register","forgot-password","reset-password","role-selection"].includes(t.name)),g=s(()=>void 0===n.initialized||n.initialized),v=()=>{["login","register","forgot-password","reset-password","role-selection"].includes(t.name)?oe.exitApp():a.options.history.state.back?a.back():oe.exitApp()};return r(async()=>{if((async()=>{try{await oe.addListener("backButton",v)}catch(e){console.warn("No se pudo configurar el listener del botón atrás:",e)}})(),await n.tryToLogin(),n.isAuthenticated){i.loadNotifications(),i.initializeRealTimeNotifications();try{const e=!!window.Capacitor&&window.Capacitor.getPlatform&&"web"!==window.Capacitor.getPlatform(),t=localStorage.getItem("fcm_token");if(!e&&!t&&!window.__pushInitStarted){window.__pushInitStarted=!0,console.log("🔔 (Fallback) Inicializando push porque fcm_token está vacío tras login restaurado...");const{initializePushNotifications:e}=await W(async()=>{const{initializePushNotifications:e}=await Promise.resolve().then(()=>hx);return{initializePushNotifications:e}},void 0);await e();const t=localStorage.getItem("fcm_token");console.log("🔔 (Fallback) Resultado obtención token:",t?t.substring(0,25)+"...":"NO TOKEN"),t||console.warn("⚠️ (Fallback) No se pudo obtener token FCM en inicialización tardía.")}}catch(e){console.warn("⚠️ (Fallback) Error asegurando token FCM:",e)}}}),l(()=>{(async()=>{try{await oe.removeAllListeners("backButton")}catch(e){console.warn("Error al limpiar listeners del botón atrás:",e)}})(),n.isAuthenticated&&i.disconnectRealTimeNotifications()}),(e,t)=>{const a=E("router-view");return d(),c("div",Fr,[f.value&&g.value?(d(),C(Nr,{key:0})):h("",!0),f.value&&g.value?(d(),C(Mr,{key:1})):h("",!0),u("main",{class:m({"with-navbar":f.value})},[b(a,null,{default:k(({Component:e})=>[b(S,{name:"fade",mode:"out-in"},{default:k(()=>[(d(),C(T(e)))]),_:2},1024)]),_:1})],2),f.value&&g.value?(d(),c("footer",Ur,[u("div",Br,[t[0]||(t[0]=u("span",{class:"app-name"},"MozoApp",-1)),u("span",qr,p(o(Or)()),1)])])):h("",!0)])}}},$r={setToken(e){e?localStorage.setItem("token",e):console.error("Intento de guardar un token inválido:",e)},getToken:()=>localStorage.getItem("token"),removeToken(){localStorage.removeItem("token")},setUser(e){localStorage.setItem("user",JSON.stringify(e))},getUser(){const e=localStorage.getItem("user");return e?JSON.parse(e):null},removeUser(){localStorage.removeItem("user")},isAuthenticated(){return!!this.getToken()},async login(e,t){var a,n;try{const i=await Aa.login({email:e,password:t}),s=i.data.token||i.data.access_token||i.data.plainTextToken||i.data.user&&i.data.user.token||i.data.user&&i.data.user.access_token||(null==(n=null==(a=i.headers)?void 0:a.authorization)?void 0:n.replace("Bearer ",""));if(!s)throw console.error("No se encontró un token válido en la respuesta:",i.data),new Error("No se recibió un token válido del servidor");return this.setToken(s),this.setUser(i.data.user),i.data}catch(i){throw console.error("Error en login:",i),i}},async loginWithGoogle(e){try{const t=await Aa.loginWithGoogle(e),a=t.data.token||t.data.access_token||t.data.plainTextToken||t.data.user&&t.data.user.token||t.data.user&&t.data.user.access_token;if(!a)throw new Error("No se recibió un token válido del servidor");return this.setToken(a),this.setUser(t.data.user),t.data}catch(t){throw console.error("Error en loginWithGoogle:",t),t}},async register(e,t,a,n){try{return(await Aa.register({name:e,email:t,password:a,password_confirmation:n})).data}catch(i){throw i}},async forgotPassword(e){try{return(await Aa.forgotPassword({email:e})).data}catch(t){throw t}},async resetPassword(e,t,a,n){try{return(await Aa.resetPassword({token:e,email:t,password:a,password_confirmation:n})).data}catch(i){throw i}},async logout(){try{const e=localStorage.getItem("fcm_token");this.isAuthenticated()&&e&&await Aa.deleteDeviceToken({token:e}),this.isAuthenticated()&&await Aa.logout()}catch(e){console.error("Error durante el logout en el servidor:",e)}finally{or().disconnectRealTimeNotifications(),this.removeToken(),this.removeUser(),localStorage.removeItem("fcm_token")}},async getCurrentUser(){try{const e=await Aa.getCurrentUser();return this.setUser(e.data),e.data}catch(e){throw e}},async selectRole(e){try{const t=(await Aa.selectRole(e)).data||{},a=t.token||t.access_token||t.plainTextToken||t.user&&t.user.token||t.user&&t.user.access_token;a&&this.setToken(a);const n=this.getUser();return n&&(n.role=e,this.setUser(n)),t}catch(t){throw console.error("Error en selectRole:",t),t}}},zr={class:"auth-container"},Vr={class:"auth-card"},Wr={key:0,class:"alert alert-danger"},Hr={class:"mb-3"},Gr=["disabled"],Yr={class:"mb-3"},Kr=["disabled"],Qr={class:"d-flex justify-content-between align-items-center mb-4"},Jr={class:"form-check"},Zr=["disabled"],Xr={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},el=["disabled"],tl={class:"text-center mt-4"};const al=lr({name:"LoginView",setup(){const e=w(),t=i(""),a=i(""),n=i(!1),o=i(""),r=i(!1),l=s(()=>""!==t.value.trim()&&""!==a.value.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.value));return{email:t,password:a,remember:n,error:o,loading:r,isFormValid:l,handleLogin:async()=>{var n,i;if(l.value){r.value=!0,o.value="";try{await $r.login(t.value,a.value),e.push({name:"role-selection"})}catch(s){console.error("Error de inicio de sesión:",s),o.value=(null==(i=null==(n=s.response)?void 0:n.data)?void 0:i.message)||"Error al iniciar sesión. Por favor, inténtalo de nuevo."}finally{r.value=!1}}},handleGoogleLogin:async()=>{alert("La función de inicio de sesión con Google será implementada próximamente")}}}},[["render",function(e,t,a,n,i,s){const o=E("router-link");return d(),c("div",zr,[u("div",Vr,[t[14]||(t[14]=u("div",{class:"text-center mb-4"},[u("h1",{class:"h3"},"Iniciar Sesión"),u("p",{class:"text-muted"},"Accede a tu cuenta de MOZO")],-1)),n.error?(d(),c("div",Wr,p(n.error),1)):h("",!0),u("form",{onSubmit:t[4]||(t[4]=f((...e)=>n.handleLogin&&n.handleLogin(...e),["prevent"]))},[u("div",Hr,[t[5]||(t[5]=u("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),I(u("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,Gr),[[N,n.email]])]),u("div",Yr,[t[6]||(t[6]=u("label",{for:"password",class:"form-label"},"Contraseña",-1)),I(u("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),required:"",disabled:n.loading,placeholder:"Tu contraseña"},null,8,Kr),[[N,n.password]])]),u("div",Qr,[u("div",Jr,[I(u("input",{class:"form-check-input",type:"checkbox",id:"remember","onUpdate:modelValue":t[2]||(t[2]=e=>n.remember=e)},null,512),[[x,n.remember]]),t[7]||(t[7]=u("label",{class:"form-check-label",for:"remember"}," Recordarme ",-1))]),b(o,{to:"/forgot-password",class:"link-primary"},{default:k(()=>t[8]||(t[8]=[y("¿Olvidaste tu contraseña?")])),_:1,__:[8]})]),u("button",{type:"submit",class:"btn btn-primary w-100 mb-3",disabled:n.loading||!n.isFormValid},[n.loading?(d(),c("span",Xr)):h("",!0),t[9]||(t[9]=y(" Iniciar sesión "))],8,Zr),t[13]||(t[13]=u("div",{class:"text-center my-3"},[u("span",{class:"text-muted"},"O continúa con")],-1)),u("button",{type:"button",class:"btn btn-outline-secondary w-100 mb-3",onClick:t[3]||(t[3]=(...e)=>n.handleGoogleLogin&&n.handleGoogleLogin(...e)),disabled:n.loading},t[10]||(t[10]=[u("i",{class:"bi bi-google me-2"},null,-1),y(" Google ")]),8,el),u("div",tl,[t[12]||(t[12]=u("span",{class:"text-muted"},"¿No tienes una cuenta?",-1)),b(o,{to:"/register",class:"link-primary ms-1"},{default:k(()=>t[11]||(t[11]=[y("Registrarse")])),_:1,__:[11]})])],32)])])}],["__scopeId","data-v-5d787c1e"]]),nl={class:"auth-container"},il={class:"auth-card"},sl={key:0,class:"alert alert-danger"},ol={class:"mb-3"},rl=["disabled"],ll={class:"mb-3"},cl=["disabled"],dl={key:0,class:"form-text text-danger"},ul={class:"mb-3"},hl=["disabled"],pl={key:0,class:"form-text text-danger"},ml={class:"mb-4"},fl=["disabled"],gl={key:0,class:"form-text text-danger"},vl=["disabled"],bl={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},wl={class:"text-center"};const yl=lr({name:"RegisterView",setup(){const e=w(),t=i(""),a=i(""),n=i(""),o=i(""),r=i(""),l=i(!1),c=s(()=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.value)),d=s(()=>n.value.length>=8),u=s(()=>n.value===o.value),h=s(()=>""!==t.value.trim()&&c.value&&d.value&&u.value);return{name:t,email:a,password:n,passwordConfirmation:o,error:r,loading:l,isEmailValid:c,isPasswordValid:d,doPasswordsMatch:u,isFormValid:h,handleRegister:async()=>{var i,s;if(h.value){l.value=!0,r.value="";try{await $r.register(t.value,a.value,n.value,o.value),e.push({path:"/login",query:{registered:"success"}})}catch(c){console.error("Error de registro:",c),r.value=(null==(s=null==(i=c.response)?void 0:i.data)?void 0:s.message)||"Error al crear la cuenta. Por favor, inténtalo de nuevo."}finally{l.value=!1}}}}}},[["render",function(e,t,a,n,i,s){const o=E("router-link");return d(),c("div",nl,[u("div",il,[t[12]||(t[12]=u("div",{class:"text-center mb-4"},[u("h1",{class:"h3"},"Crear cuenta"),u("p",{class:"text-muted"},"Regístrate para acceder a MOZO")],-1)),n.error?(d(),c("div",sl,p(n.error),1)):h("",!0),u("form",{onSubmit:t[4]||(t[4]=f((...e)=>n.handleRegister&&n.handleRegister(...e),["prevent"]))},[u("div",ol,[t[5]||(t[5]=u("label",{for:"name",class:"form-label"},"Nombre completo",-1)),I(u("input",{type:"text",class:"form-control",id:"name","onUpdate:modelValue":t[0]||(t[0]=e=>n.name=e),required:"",disabled:n.loading,placeholder:"Tu nombre completo"},null,8,rl),[[N,n.name]])]),u("div",ll,[t[6]||(t[6]=u("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),I(u("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[1]||(t[1]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,cl),[[N,n.email]]),!n.isEmailValid&&n.email?(d(),c("div",dl," Introduce un correo electrónico válido ")):h("",!0)]),u("div",ul,[t[7]||(t[7]=u("label",{for:"password",class:"form-label"},"Contraseña",-1)),I(u("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[2]||(t[2]=e=>n.password=e),required:"",disabled:n.loading,placeholder:"Mínimo 8 caracteres"},null,8,hl),[[N,n.password]]),!n.isPasswordValid&&n.password?(d(),c("div",pl," La contraseña debe tener al menos 8 caracteres ")):h("",!0)]),u("div",ml,[t[8]||(t[8]=u("label",{for:"passwordConfirmation",class:"form-label"},"Confirmar contraseña",-1)),I(u("input",{type:"password",class:"form-control",id:"passwordConfirmation","onUpdate:modelValue":t[3]||(t[3]=e=>n.passwordConfirmation=e),required:"",disabled:n.loading,placeholder:"Repite tu contraseña"},null,8,fl),[[N,n.passwordConfirmation]]),!n.doPasswordsMatch&&n.passwordConfirmation?(d(),c("div",gl," Las contraseñas no coinciden ")):h("",!0)]),u("button",{type:"submit",class:"btn btn-primary w-100 mb-4",disabled:n.loading||!n.isFormValid},[n.loading?(d(),c("span",bl)):h("",!0),t[9]||(t[9]=y(" Crear cuenta "))],8,vl),u("div",wl,[t[11]||(t[11]=u("span",{class:"text-muted"},"¿Ya tienes una cuenta?",-1)),b(o,{to:"/login",class:"link-primary ms-1"},{default:k(()=>t[10]||(t[10]=[y("Iniciar sesión")])),_:1,__:[10]})])],32)])])}],["__scopeId","data-v-0e5d0e5f"]]),_l={class:"auth-container"},Cl={class:"auth-card"},kl={key:0,class:"alert alert-success"},El={key:1,class:"alert alert-danger"},Sl={class:"mb-4"},Tl=["disabled"],Il=["disabled"],Nl={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},xl={class:"text-center"},Al={key:3,class:"text-center mt-3"};const Pl=lr({name:"ForgotPasswordView",setup(){const e=i(""),t=i(""),a=i(""),n=i(!1),o=s(()=>""!==e.value.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value));return{email:e,error:t,success:a,loading:n,isFormValid:o,handleForgotPassword:async()=>{var i,s;if(o.value){n.value=!0,t.value="",a.value="";try{await $r.forgotPassword(e.value),a.value="Se ha enviado un enlace de recuperación a tu correo electrónico. Por favor, revisa tu bandeja de entrada.",e.value=""}catch(r){console.error("Error al solicitar recuperación de contraseña:",r),t.value=(null==(s=null==(i=r.response)?void 0:i.data)?void 0:s.message)||"No se pudo enviar el enlace de recuperación. Por favor, inténtalo de nuevo."}finally{n.value=!1}}}}}},[["render",function(e,t,a,n,i,s){const o=E("router-link");return d(),c("div",_l,[u("div",Cl,[t[6]||(t[6]=u("div",{class:"text-center mb-4"},[u("h1",{class:"h3"},"Recuperar contraseña"),u("p",{class:"text-muted"},"Ingresa tu correo electrónico para recibir un enlace de recuperación")],-1)),n.success?(d(),c("div",kl,p(n.success),1)):h("",!0),n.error?(d(),c("div",El,p(n.error),1)):h("",!0),n.success?h("",!0):(d(),c("form",{key:2,onSubmit:t[1]||(t[1]=f((...e)=>n.handleForgotPassword&&n.handleForgotPassword(...e),["prevent"]))},[u("div",Sl,[t[2]||(t[2]=u("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),I(u("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,Tl),[[N,n.email]])]),u("button",{type:"submit",class:"btn btn-primary w-100 mb-4",disabled:n.loading||!n.isFormValid},[n.loading?(d(),c("span",Nl)):h("",!0),t[3]||(t[3]=y(" Enviar enlace de recuperación "))],8,Il),u("div",xl,[b(o,{to:"/login",class:"link-primary"},{default:k(()=>t[4]||(t[4]=[u("i",{class:"bi bi-arrow-left me-1"},null,-1),y(" Volver a inicio de sesión ")])),_:1,__:[4]})])],32)),n.success?(d(),c("div",Al,[b(o,{to:"/login",class:"btn btn-outline-primary"},{default:k(()=>t[5]||(t[5]=[y(" Volver a inicio de sesión ")])),_:1,__:[5]})])):h("",!0)])])}],["__scopeId","data-v-af089bfd"]]),Rl={name:"ResetPasswordView",setup(){w();const e=_(),t=i(""),a=i(""),n=i(""),o=i(""),l=i(""),c=i(""),d=i(!1),u=s(()=>n.value.length>=8),h=s(()=>n.value===o.value),p=s(()=>""!==t.value&&""!==a.value.trim()&&u.value&&h.value);r(()=>{t.value=e.query.token||"",a.value=e.query.email||"",t.value||(l.value="Token de restablecimiento no válido o expirado. Por favor, solicita un nuevo enlace de recuperación.")});return{email:a,password:n,passwordConfirmation:o,error:l,success:c,loading:d,isPasswordValid:u,doPasswordsMatch:h,isFormValid:p,handleResetPassword:async()=>{var e,i;if(p.value){d.value=!0,l.value="",c.value="";try{await $r.resetPassword(t.value,a.value,n.value,o.value),c.value="Tu contraseña ha sido restablecida con éxito. Ya puedes iniciar sesión con tu nueva contraseña.",n.value="",o.value=""}catch(s){console.error("Error al restablecer contraseña:",s),l.value=(null==(i=null==(e=s.response)?void 0:e.data)?void 0:i.message)||"No se pudo restablecer la contraseña. Por favor, inténtalo de nuevo o solicita un nuevo enlace."}finally{d.value=!1}}}}}},Dl={class:"auth-container"},Ml={class:"auth-card"},Ll={key:0,class:"alert alert-success"},Ol={key:1,class:"alert alert-danger"},Fl={class:"mb-3"},Ul=["disabled"],Bl={class:"mb-3"},ql=["disabled"],jl={key:0,class:"form-text text-danger"},$l={class:"mb-4"},zl=["disabled"],Vl={key:0,class:"form-text text-danger"},Wl=["disabled"],Hl={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Gl={class:"text-center"},Yl={key:3,class:"text-center mt-3"};const Kl=lr(Rl,[["render",function(e,t,a,n,i,s){const o=E("router-link");return d(),c("div",Dl,[u("div",Ml,[t[10]||(t[10]=u("div",{class:"text-center mb-4"},[u("h1",{class:"h3"},"Restablecer contraseña"),u("p",{class:"text-muted"},"Crea una nueva contraseña segura")],-1)),n.success?(d(),c("div",Ll,p(n.success),1)):h("",!0),n.error?(d(),c("div",Ol,p(n.error),1)):h("",!0),n.success?h("",!0):(d(),c("form",{key:2,onSubmit:t[3]||(t[3]=f((...e)=>n.handleResetPassword&&n.handleResetPassword(...e),["prevent"]))},[u("div",Fl,[t[4]||(t[4]=u("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),I(u("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,Ul),[[N,n.email]])]),u("div",Bl,[t[5]||(t[5]=u("label",{for:"password",class:"form-label"},"Nueva contraseña",-1)),I(u("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),required:"",disabled:n.loading,placeholder:"Mínimo 8 caracteres"},null,8,ql),[[N,n.password]]),!n.isPasswordValid&&n.password?(d(),c("div",jl," La contraseña debe tener al menos 8 caracteres ")):h("",!0)]),u("div",$l,[t[6]||(t[6]=u("label",{for:"passwordConfirmation",class:"form-label"},"Confirmar nueva contraseña",-1)),I(u("input",{type:"password",class:"form-control",id:"passwordConfirmation","onUpdate:modelValue":t[2]||(t[2]=e=>n.passwordConfirmation=e),required:"",disabled:n.loading,placeholder:"Repite tu nueva contraseña"},null,8,zl),[[N,n.passwordConfirmation]]),!n.doPasswordsMatch&&n.passwordConfirmation?(d(),c("div",Vl," Las contraseñas no coinciden ")):h("",!0)]),u("button",{type:"submit",class:"btn btn-primary w-100 mb-4",disabled:n.loading||!n.isFormValid},[n.loading?(d(),c("span",Hl)):h("",!0),t[7]||(t[7]=y(" Cambiar contraseña "))],8,Wl),u("div",Gl,[b(o,{to:"/login",class:"link-primary"},{default:k(()=>t[8]||(t[8]=[u("i",{class:"bi bi-arrow-left me-1"},null,-1),y(" Volver a inicio de sesión ")])),_:1,__:[8]})])],32)),n.success?(d(),c("div",Yl,[b(o,{to:"/login",class:"btn btn-primary"},{default:k(()=>t[9]||(t[9]=[y(" Ir a inicio de sesión ")])),_:1,__:[9]})])):h("",!0)])])}],["__scopeId","data-v-9859a781"]]),Ql={class:"container d-flex justify-content-center align-items-center vh-100"},Jl={class:"row justify-content-center align-items-center w-100"},Zl={class:"role-card col-11 d-flex flex-column justify-content-center align-items-center"},Xl={class:"row justify-content-between align-items-center w-100"},ec={class:"col me-2 d-flex flex-column justify-content-center align-items-center px-0"},tc={class:"col ms-2 d-flex flex-column justify-content-center align-items-center px-0"},ac={class:"mt-5 text-center row justify-content-center align-items-center w-100"},nc=["disabled"],ic=lr({__name:"RoleSelection",props:[],setup(e){const t=w(),a=i(""),n=i(!1),s=i(""),o=Xa(),r=async e=>{if(s.value)return;s.value=e,a.value="";try{console.log("RoleSelection - Inicio de selección de rol:",e),console.log("RoleSelection - Token antes de selectRole:",localStorage.getItem("token"));const t=await $r.selectRole(e);console.log("RoleSelection - Respuesta de selectRole:",t),console.log("RoleSelection - Token después de selectRole:",localStorage.getItem("token"))}catch(i){console.warn("RoleSelection - selectRole falló, se continúa localmente:",(null==i?void 0:i.message)||i),console.error("RoleSelection - Error completo:",i)}console.log("RoleSelection - Actualizando estado local con setSelectedRole"),o.setSelectedRole(e),console.log("RoleSelection - Estado actualizado, token actual:",localStorage.getItem("token"));const n="waiter"===e?"waiter-dashboard":"admin";console.log("RoleSelection - Redirigiendo a:",n),t.push({name:n}),s.value=""},l=async()=>{try{await $r.logout(),o.logout(),t.push({name:"login"})}catch(e){t.push({name:"login"})}};return(e,t)=>(d(),c("div",Ql,[u("div",Jl,[u("div",Zl,[t[5]||(t[5]=u("div",{class:"text-center mb-4 row justify-content-center align-items-center w-100"},[u("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+DQogIDwhLS0gRm9uZG8gZGVsIGxvZ28gLS0+DQogIDxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiByeD0iNDAiIGZpbGw9IiM3QzZDRjMiLz4NCiAgDQogIDwhLS0gT2pvcyAtLT4NCiAgPGNpcmNsZSBjeD0iNzAiIGN5PSI4MCIgcj0iMTUiIGZpbGw9ImJsYWNrIi8+DQogIDxjaXJjbGUgY3g9IjEzMCIgY3k9IjgwIiByPSIxNSIgZmlsbD0iYmxhY2siLz4NCiAgDQogIDwhLS0gQ2VqYXMgLS0+DQogIDxsaW5lIHgxPSI1MCIgeTE9IjYwIiB4Mj0iOTAiIHkyPSI2MCIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSI1IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4NCiAgPGxpbmUgeDE9IjExMCIgeTE9IjYwIiB4Mj0iMTUwIiB5Mj0iNjAiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+DQogIA0KICA8IS0tIEJvY2Egc29ucmllbnRlIC0tPg0KICA8cGF0aCBkPSJNNzAgMTMwIFExMDAgMTYwIDEzMCAxMzAiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+DQogIA0KICA8IS0tIFRleHRvICJNT1pPIiAtLT4NCiAgPHRleHQgeD0iMTAwIiB5PSIxMTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZvbnQtc2l6ZT0iMzQiIGZpbGw9ImJsYWNrIj5NT1pPPC90ZXh0Pg0KPC9zdmc+IA==",alt:"MOZO Logo",class:"logo mb-3"}),u("h1",{class:"h3"},"¿Qué rol tienes?")],-1)),u("div",Xl,[u("div",ec,[u("div",{class:"role-option static",onClick:t[0]||(t[0]=e=>r("admin"))},t[2]||(t[2]=[u("div",{class:"role-icon"},[u("i",{class:"bi bi-house-door"})],-1),u("h3",{class:"h5 mt-3"},"Dueño",-1)]))]),u("div",tc,[u("div",{class:"role-option static",onClick:t[1]||(t[1]=e=>r("waiter"))},t[3]||(t[3]=[u("div",{class:"role-icon"},[u("i",{class:"bi bi-person"})],-1),u("h3",{class:"h5 mt-3"},"Mozo",-1)]))])]),u("div",ac,[u("button",{class:"btn btn-outline-secondary w-100",onClick:l,disabled:n.value||!!s.value},t[4]||(t[4]=[u("i",{class:"bi bi-box-arrow-left me-1"},null,-1),y(" Cerrar sesión ")]),8,nc)])])])]))}},[["__scopeId","data-v-22e7f38d"]]);const sc=new class{async callWaiter(e,t={}){const{message:a,urgency:n="normal",client_info:i}=t;try{return(await Aa.callWaiter(e)).data}catch(s){throw console.error("Error calling waiter:",s),this.handleError(s)}}async getPendingCalls(){try{return(await Aa.getPendingCalls()).data}catch(e){throw this.handleError(e)}}async acknowledgCall(e){try{return(await Aa.acknowledgeCall(e)).data}catch(t){throw this.handleError(t)}}async completeCall(e){try{return(await Aa.completeCall(e)).data}catch(t){throw this.handleError(t)}}async getWaiterCallHistory(e="today",t=1,a=20){try{return(await Aa.getWaiterCallHistory({filter:e,page:t,limit:a})).data}catch(n){throw this.handleError(n)}}async getAdminCallHistory(e="today",t=1,a=20){try{return(await Aa.getAdminCallHistory({filter:e,page:t,limit:a})).data}catch(n){throw this.handleError(n)}}async activateTable(e){var t;try{return(await Aa.activateTable(e)).data}catch(a){throw console.error("❌ Error activating table:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data),this.handleError(a)}}async deactivateTable(e){try{return(await Aa.deactivateTable(e)).data}catch(t){throw console.error("Error deactivating table:",t),this.handleError(t)}}async activateMultipleTables(e){var t;try{return(await Aa.activateMultipleTables({table_ids:e})).data}catch(a){throw console.error("❌ Error activating multiple tables:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data),this.handleError(a)}}async deactivateMultipleTables(e){try{return(await Aa.deactivateMultipleTables({table_ids:e})).data}catch(t){throw console.error("Error deactivating multiple tables:",t),this.handleError(t)}}async silenceTable(e,t=30,a=""){var n;const i={duration_minutes:t,notes:"string"==typeof a?a:""};try{const t=await Aa.silenceTable(e,i);return console.log("✅ Respuesta silenciar mesa:",t.data),t.data}catch(s){throw console.error("❌ Error silencing table:",s),console.error("❌ Error details:",null==(n=s.response)?void 0:n.data),this.handleError(s)}}async unsilenceTable(e){var t;console.log("🔊 Quitando silencio de mesa:",e);try{const t=await Aa.unsilenceTable(e);return console.log("✅ Respuesta quitar silencio:",t.data),t.data}catch(a){console.error("❌ Error unsilencing table:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data)}}async silenceMultipleTables(e,t=30,a=""){try{return(await Aa.post("/waiter/tables/silence/multiple",{table_ids:e,duration_minutes:t,notes:a})).data}catch(n){throw console.error("Error silencing multiple tables:",n),this.handleError(n)}}async unsilenceMultipleTables(e){try{return(await Aa.post("/waiter/tables/unsilence/multiple",{table_ids:e})).data}catch(t){throw console.error("Error unsilencing multiple tables:",t),this.handleError(t)}}async getSilencedTables(){try{return(await Aa.getSilencedTables()).data}catch(e){throw console.error("Error getting silenced tables:",e),this.handleError(e)}}async getAssignedTables(){try{return(await Aa.getAssignedTables()).data}catch(e){throw console.error("Error getting assigned tables:",e),this.handleError(e)}}async getAvailableTables(){try{return(await Aa.getAvailableTables()).data}catch(e){throw console.error("Error getting available tables:",e),this.handleError(e)}}async getWaiterBusinesses(){try{return(await Aa.getWaiterBusinesses()).data}catch(e){throw console.error("Error getting waiter businesses:",e),this.handleError(e)}}async setActiveWaiterBusiness(e){try{return(await Aa.setActiveWaiterBusiness(e)).data}catch(t){throw console.error("Error setting active business:",t),this.handleError(t)}}async getActiveWaiterBusiness(){try{return(await Aa.getActiveWaiterBusiness()).data}catch(e){throw console.error("Error getting active business:",e),this.handleError(e)}}async getWaiterBusinessTables(e){var t;try{return(await Aa.getWaiterBusinessTables(e)).data}catch(a){throw console.error("❌ Error getting business tables:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data),this.handleError(a)}}async joinBusinessWithCode(e){try{return(await Aa.joinBusinessWithCode(e)).data}catch(t){throw console.error("Error joining business with code:",t),this.handleError(t)}}async leaveWaiterBusiness(e){try{return(await Aa.leaveWaiterBusiness(e)).data}catch(t){throw console.error("Error leaving business:",t),this.handleError(t)}}async getAdminSilencedTables(){try{return(await Aa.get("/admin/tables/silenced")).data}catch(e){throw console.error("Error getting admin silenced tables:",e),this.handleError(e)}}async adminUnsilenceTable(e){try{return(await Aa.delete(`/admin/tables/${e}/silence`)).data}catch(t){throw console.error("Error admin unsilencing table:",t),this.handleError(t)}}handleError(e){var t;return(null==(t=e.response)?void 0:t.data)?{success:!1,message:e.response.data.message||"Error en la solicitud",code:e.response.status,data:e.response.data}:{success:!1,message:e.message||"Error de conexión",code:"NETWORK_ERROR"}}formatResponseTime(e){if(e<60)return`${e}s`;if(e<3600){const t=Math.floor(e/60),a=e%60;return a>0?`${t}m ${a}s`:`${t}m`}{const t=Math.floor(e/3600),a=Math.floor(e%3600/60);return a>0?`${t}h ${a}m`:`${t}h`}}formatTimeAgo(e){const t=new Date-new Date(e),a=Math.floor(t/6e4);if(a<1)return"Ahora";if(a<60)return`${a}m`;if(a<1440){return`${Math.floor(a/60)}h`}return`${Math.floor(a/1440)}d`}getUrgencyColor(e,t=0){return"high"===e?"#dc3545":t>5?"#fd7e14":"#007bff"}getUrgencyIcon(e,t=0){return"high"===e?"🚨":t>5?"⏰":"🔔"}},oc=Object.freeze(Object.defineProperty({__proto__:null,default:sc},Symbol.toStringTag,{value:"Module"}));var rc={};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lc="${JSCORE_VERSION}",cc=function(e,t){if(!e)throw dc(t)},dc=function(e){return new Error("Firebase Database ("+lc+") INTERNAL ASSERT FAILED: "+e)},uc=function(e){const t=[];let a=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[a++]=i:i<2048?(t[a++]=i>>6|192,t[a++]=63&i|128):55296==(64512&i)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[a++]=i>>18|240,t[a++]=i>>12&63|128,t[a++]=i>>6&63|128,t[a++]=63&i|128):(t[a++]=i>>12|224,t[a++]=i>>6&63|128,t[a++]=63&i|128)}return t},hc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const a=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,r=i+2<e.length,l=r?e[i+2]:0,c=t>>2,d=(3&t)<<4|o>>4;let u=(15&o)<<2|l>>6,h=63&l;r||(h=64,s||(u=64)),n.push(a[c],a[d],a[u],a[h])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(uc(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let a=0,n=0;for(;a<e.length;){const i=e[a++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[a++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[a++])<<12|(63&e[a++])<<6|63&e[a++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{const s=e[a++],o=e[a++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const a=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<e.length;){const t=a[e.charAt(i++)],s=i<e.length?a[e.charAt(i)]:0;++i;const o=i<e.length?a[e.charAt(i)]:64;++i;const r=i<e.length?a[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==r)throw new pc;const l=t<<2|s>>4;if(n.push(l),64!==o){const e=s<<4&240|o>>2;if(n.push(e),64!==r){const e=o<<6&192|r;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const mc=function(e){const t=uc(e);return hc.encodeByteArray(t,!0)},fc=function(e){return mc(e).replace(/\./g,"")},gc=function(e){try{return hc.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function vc(e){return bc(void 0,e)}function bc(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const a in t)t.hasOwnProperty(a)&&wc(a)&&(e[a]=bc(e[a],t[a]));return e}function wc(e){return"__proto__"!==e}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const yc=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,_c=()=>{try{return yc()||(()=>{if("undefined"==typeof process)return;const e=rc.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(a){return}const t=e&&gc(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},Cc=e=>{const t=(e=>{var t,a;return null==(a=null==(t=_c())?void 0:t.emulatorHosts)?void 0:a[e]})(e);if(!t)return;const a=t.lastIndexOf(":");if(a<=0||a+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(a+1),10);return"["===t[0]?[t.substring(1,a-1),n]:[t.substring(0,a),n]},kc=()=>{var e;return null==(e=_c())?void 0:e.config};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ec{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,a)=>{t?this.reject(t):this.resolve(a),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,a))}}}
/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sc(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Tc(e){return(await fetch(e,{credentials:"include"})).ok}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ic(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const a=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s={iss:`https://securetoken.google.com/${a}`,aud:a,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[fc(JSON.stringify({alg:"none",type:"JWT"})),fc(JSON.stringify(s)),""].join(".")}const Nc={};let xc=!1;function Ac(e,t){if("undefined"==typeof window||"undefined"==typeof document||!Sc(window.location.host)||Nc[e]===t||Nc[e]||xc)return;function a(e){return`__firebase__banner__${e}`}Nc[e]=t;const n="__firebase__banner",i=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(Nc))Nc[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{xc=!0,function(){const e=document.getElementById(n);e&&e.remove()}()},e}function o(){const e=function(e){let t=document.getElementById(e),a=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),a=!0),{created:a,element:t}}(n),t=a("text"),o=document.getElementById(t)||document.createElement("span"),r=a("learnmore"),l=document.getElementById(r)||document.createElement("a"),c=a("preprendIcon"),d=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(l,r);const a=s();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(d,c),t.append(d,o,l,a),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",d.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(d.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pc(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function Rc(){try{return"object"==typeof indexedDB}catch(e){return!1}}function Dc(){return new Promise((e,t)=>{try{let a=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),a||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{a=!1},i.onerror=()=>{var e;t((null==(e=i.error)?void 0:e.message)||"")}}catch(a){t(a)}})}function Mc(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc extends Error{constructor(e,t,a){super(t),this.code=e,this.customData=a,this.name="FirebaseError",Object.setPrototypeOf(this,Lc.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Oc.prototype.create)}}class Oc{constructor(e,t,a){this.service=e,this.serviceName=t,this.errors=a}create(e,...t){const a=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(Fc,(e,a)=>{const n=t[a];return null!=n?String(n):`<${a}?>`})}(i,a):"Error",o=`${this.serviceName}: ${s} (${n}).`;return new Lc(n,o,a)}}const Fc=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uc(e){return JSON.parse(e)}function Bc(e){return JSON.stringify(e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qc=function(e){let t={},a={},n={},i="";try{const s=e.split(".");t=Uc(gc(s[0])||""),a=Uc(gc(s[1])||""),i=s[2],n=a.d||{},delete a.d}catch(s){}return{header:t,claims:a,data:n,signature:i}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function jc(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function $c(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function zc(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Vc(e,t,a){const n={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=t.call(a,e[i],i,e));return n}function Wc(e,t){if(e===t)return!0;const a=Object.keys(e),n=Object.keys(t);for(const i of a){if(!n.includes(i))return!1;const a=e[i],s=t[i];if(Hc(a)&&Hc(s)){if(!Wc(a,s))return!1}else if(a!==s)return!1}for(const i of n)if(!a.includes(i))return!1;return!0}function Hc(e){return null!==e&&"object"==typeof e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Gc{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const a=this.W_;if("string"==typeof e)for(let d=0;d<16;d++)a[d]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let d=0;d<16;d++)a[d]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let d=16;d<80;d++){const e=a[d-3]^a[d-8]^a[d-14]^a[d-16];a[d]=4294967295&(e<<1|e>>>31)}let n,i,s=this.chain_[0],o=this.chain_[1],r=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let d=0;d<80;d++){d<40?d<20?(n=l^o&(r^l),i=1518500249):(n=o^r^l,i=1859775393):d<60?(n=o&r|l&(o|r),i=2400959708):(n=o^r^l,i=3395469782);const e=(s<<5|s>>>27)+n+c+i+a[d]&4294967295;c=l,l=r,r=4294967295&(o<<30|o>>>2),o=s,s=e}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+r&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const a=t-this.blockSize;let n=0;const i=this.buf_;let s=this.inbuf_;for(;n<t;){if(0===s)for(;n<=a;)this.compress_(e,n),n+=this.blockSize;if("string"==typeof e){for(;n<t;)if(i[s]=e.charCodeAt(n),++s,++n,s===this.blockSize){this.compress_(i),s=0;break}}else for(;n<t;)if(i[s]=e[n],++s,++n,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);let a=0;for(let n=0;n<5;n++)for(let t=24;t>=0;t-=8)e[a]=this.chain_[n]>>t&255,++a;return e}}function Yc(e,t){return`${e} failed: ${t} argument `}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kc=function(e){let t=0;for(let a=0;a<e.length;a++){const n=e.charCodeAt(a);n<128?t++:n<2048?t+=2:n>=55296&&n<=56319?(t+=4,a++):t+=3}return t};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Qc(e){return e&&e._delegate?e._delegate:e}class Jc{constructor(e,t,a){this.name=e,this.instanceFactory=t,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zc="[DEFAULT]";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Ec;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&e.resolve(a)}catch(a){}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),a=(null==e?void 0:e.optional)??!1;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(a)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(n){if(a)return null;throw n}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e))try{this.getOrInitializeService({instanceIdentifier:Zc})}catch(t){}for(const[e,a]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});a.resolve(e)}catch(t){}}}}clearInstance(e=Zc){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=Zc){return this.instances.has(e)}getOptions(e=Zc){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:a,options:t});for(const[i,s]of this.instancesDeferred.entries()){a===this.normalizeInstanceIdentifier(i)&&s.resolve(n)}return n}onInit(e,t){const a=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(a)??new Set;n.add(e),this.onInitCallbacks.set(a,n);const i=this.instances.get(a);return i&&e(i,a),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){const a=this.onInitCallbacks.get(t);if(a)for(const n of a)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===Zc?void 0:n),options:t}),this.instances.set(e,a),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}var n;return a||null}normalizeInstanceIdentifier(e=Zc){return this.component?this.component.multipleInstances?e:Zc:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ed{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Xc(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var td,ad;(ad=td||(td={}))[ad.DEBUG=0]="DEBUG",ad[ad.VERBOSE=1]="VERBOSE",ad[ad.INFO=2]="INFO",ad[ad.WARN=3]="WARN",ad[ad.ERROR=4]="ERROR",ad[ad.SILENT=5]="SILENT";const nd={debug:td.DEBUG,verbose:td.VERBOSE,info:td.INFO,warn:td.WARN,error:td.ERROR,silent:td.SILENT},id=td.INFO,sd={[td.DEBUG]:"log",[td.VERBOSE]:"log",[td.INFO]:"info",[td.WARN]:"warn",[td.ERROR]:"error"},od=(e,t,...a)=>{if(t<e.logLevel)return;const n=(new Date).toISOString(),i=sd[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${n}]  ${e.name}:`,...a)};class rd{constructor(e){this.name=e,this._logLevel=id,this._logHandler=od,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in td))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?nd[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,td.DEBUG,...e),this._logHandler(this,td.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,td.VERBOSE,...e),this._logHandler(this,td.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,td.INFO,...e),this._logHandler(this,td.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,td.WARN,...e),this._logHandler(this,td.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,td.ERROR,...e),this._logHandler(this,td.ERROR,...e)}}let ld,cd;const dd=new WeakMap,ud=new WeakMap,hd=new WeakMap,pd=new WeakMap,md=new WeakMap;let fd={get(e,t,a){if(e instanceof IDBTransaction){if("done"===t)return ud.get(e);if("objectStoreNames"===t)return e.objectStoreNames||hd.get(e);if("store"===t)return a.objectStoreNames[1]?void 0:a.objectStore(a.objectStoreNames[0])}return bd(e[t])},set:(e,t,a)=>(e[t]=a,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function gd(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(cd||(cd=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(wd(this),t),bd(dd.get(this))}:function(...t){return bd(e.apply(wd(this),t))}:function(t,...a){const n=e.call(wd(this),t,...a);return hd.set(n,t.sort?t.sort():[t]),bd(n)}}function vd(e){return"function"==typeof e?gd(e):(e instanceof IDBTransaction&&function(e){if(ud.has(e))return;const t=new Promise((t,a)=>{const n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{a(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});ud.set(e,t)}(e),t=e,(ld||(ld=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,fd):e);var t}function bd(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,a)=>{const n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(bd(e.result)),n()},s=()=>{a(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&dd.set(t,e)}).catch(()=>{}),md.set(t,e),t}(e);if(pd.has(e))return pd.get(e);const t=vd(e);return t!==e&&(pd.set(e,t),md.set(t,e)),t}const wd=e=>md.get(e);function yd(e,t,{blocked:a,upgrade:n,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),r=bd(o);return n&&o.addEventListener("upgradeneeded",e=>{n(bd(o.result),e.oldVersion,e.newVersion,bd(o.transaction),e)}),a&&o.addEventListener("blocked",e=>a(e.oldVersion,e.newVersion,e)),r.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),r}function _d(e,{blocked:t}={}){const a=indexedDB.deleteDatabase(e);return t&&a.addEventListener("blocked",e=>t(e.oldVersion,e)),bd(a).then(()=>{})}const Cd=["get","getKey","getAll","getAllKeys","count"],kd=["put","add","delete","clear"],Ed=new Map;function Sd(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Ed.get(t))return Ed.get(t);const a=t.replace(/FromIndex$/,""),n=t!==a,i=kd.includes(a);if(!(a in(n?IDBIndex:IDBObjectStore).prototype)||!i&&!Cd.includes(a))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[a](...t),i&&s.done]))[0]};return Ed.set(t,s),s}fd=(e=>({...e,get:(t,a,n)=>Sd(t,a)||e.get(t,a,n),has:(t,a)=>!!Sd(t,a)||e.has(t,a)}))(fd);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Td{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const Id="@firebase/app",Nd="0.14.1",xd=new rd("@firebase/app"),Ad="@firebase/app-compat",Pd="@firebase/analytics-compat",Rd="@firebase/analytics",Dd="@firebase/app-check-compat",Md="@firebase/app-check",Ld="@firebase/auth",Od="@firebase/auth-compat",Fd="@firebase/database",Ud="@firebase/data-connect",Bd="@firebase/database-compat",qd="@firebase/functions",jd="@firebase/functions-compat",$d="@firebase/installations",zd="@firebase/installations-compat",Vd="@firebase/messaging",Wd="@firebase/messaging-compat",Hd="@firebase/performance",Gd="@firebase/performance-compat",Yd="@firebase/remote-config",Kd="@firebase/remote-config-compat",Qd="@firebase/storage",Jd="@firebase/storage-compat",Zd="@firebase/firestore",Xd="@firebase/ai",eu="@firebase/firestore-compat",tu="firebase",au="[DEFAULT]",nu={[Id]:"fire-core",[Ad]:"fire-core-compat",[Rd]:"fire-analytics",[Pd]:"fire-analytics-compat",[Md]:"fire-app-check",[Dd]:"fire-app-check-compat",[Ld]:"fire-auth",[Od]:"fire-auth-compat",[Fd]:"fire-rtdb",[Ud]:"fire-data-connect",[Bd]:"fire-rtdb-compat",[qd]:"fire-fn",[jd]:"fire-fn-compat",[$d]:"fire-iid",[zd]:"fire-iid-compat",[Vd]:"fire-fcm",[Wd]:"fire-fcm-compat",[Hd]:"fire-perf",[Gd]:"fire-perf-compat",[Yd]:"fire-rc",[Kd]:"fire-rc-compat",[Qd]:"fire-gcs",[Jd]:"fire-gcs-compat",[Zd]:"fire-fst",[eu]:"fire-fst-compat",[Xd]:"fire-vertex","fire-js":"fire-js",[tu]:"fire-js-all"},iu=new Map,su=new Map,ou=new Map;function ru(e,t){try{e.container.addComponent(t)}catch(a){xd.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,a)}}function lu(e){const t=e.name;if(ou.has(t))return xd.debug(`There were multiple attempts to register component ${t}.`),!1;ou.set(t,e);for(const a of iu.values())ru(a,e);for(const a of su.values())ru(a,e);return!0}function cu(e,t){const a=e.container.getProvider("heartbeat").getImmediate({optional:!0});return a&&a.triggerHeartbeat(),e.container.getProvider(t)}function du(e){return null!=e&&void 0!==e.settings}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uu=new Oc("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class hu{constructor(e,t,a){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Jc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw uu.create("app-deleted",{appName:this._name})}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pu="12.1.0";function mu(e,t={}){let a=e;if("object"!=typeof t){t={name:t}}const n={name:au,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw uu.create("bad-app-name",{appName:String(i)});if(a||(a=kc()),!a)throw uu.create("no-options");const s=iu.get(i);if(s){if(Wc(a,s.options)&&Wc(n,s.config))return s;throw uu.create("duplicate-app",{appName:i})}const o=new ed(i);for(const l of ou.values())o.addComponent(l);const r=new hu(a,n,o);return iu.set(i,r),r}function fu(e=au){const t=iu.get(e);if(!t&&e===au&&kc())return mu();if(!t)throw uu.create("no-app",{appName:e});return t}function gu(e,t,a){let n=nu[e]??e;a&&(n+=`-${a}`);const i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){const e=[`Unable to register library "${n}" with version "${t}":`];return i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void xd.warn(e.join(" "))}lu(new Jc(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vu="firebase-heartbeat-store";let bu=null;function wu(){return bu||(bu=yd("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(vu)}catch(a){console.warn(a)}}}).catch(e=>{throw uu.create("idb-open",{originalErrorMessage:e.message})})),bu}async function yu(e,t){try{const a=(await wu()).transaction(vu,"readwrite"),n=a.objectStore(vu);await n.put(t,_u(e)),await a.done}catch(a){if(a instanceof Lc)xd.warn(a.message);else{const e=uu.create("idb-set",{originalErrorMessage:null==a?void 0:a.message});xd.warn(e.message)}}}function _u(e){return`${e.name}!${e.options.appId}`}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Eu(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=ku();if(null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:a}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,a=e[0].date;for(let n=1;n<e.length;n++)e[n].date<a&&(a=e[n].date,t=n);return t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){xd.warn(a)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=ku(),{heartbeatsToSend:a,unsentEntries:n}=function(e,t=1024){const a=[];let n=e.slice();for(const i of e){const e=a.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),Su(a)>t){e.dates.pop();break}}else if(a.push({agent:i.agent,dates:[i.date]}),Su(a)>t){a.pop();break}n=n.slice(1)}return{heartbeatsToSend:a,unsentEntries:n}}(this._heartbeatsCache.heartbeats),i=fc(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return xd.warn(t),""}}}function ku(){return(new Date).toISOString().substring(0,10)}class Eu{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Rc()&&Dc().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await wu()).transaction(vu),a=await t.objectStore(vu).get(_u(e));return await t.done,a}catch(t){if(t instanceof Lc)xd.warn(t.message);else{const e=uu.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});xd.warn(e.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return yu(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return yu(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function Su(e){return fc(JSON.stringify({version:2,heartbeats:e})).length}var Tu;Tu="",lu(new Jc("platform-logger",e=>new Td(e),"PRIVATE")),lu(new Jc("heartbeat",e=>new Cu(e),"PRIVATE")),gu(Id,Nd,Tu),gu(Id,Nd,"esm2020"),gu("fire-js","");var Iu={};const Nu="@firebase/database",xu="1.1.0";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let Au="";function Pu(e){Au=e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ru{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Bc(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Uc(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Du{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return jc(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mu=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Ru(t)}}catch(t){}return new Du},Lu=Mu("localStorage"),Ou=Mu("sessionStorage"),Fu=new rd("@firebase/database"),Uu=function(){let e=1;return function(){return e++}}(),Bu=function(e){const t=function(e){const t=[];let a=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);if(i>=55296&&i<=56319){const t=i-55296;n++,cc(n<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(n)-56320)}i<128?t[a++]=i:i<2048?(t[a++]=i>>6|192,t[a++]=63&i|128):i<65536?(t[a++]=i>>12|224,t[a++]=i>>6&63|128,t[a++]=63&i|128):(t[a++]=i>>18|240,t[a++]=i>>12&63|128,t[a++]=i>>6&63|128,t[a++]=63&i|128)}return t}(e),a=new Gc;a.update(t);const n=a.digest();return hc.encodeByteArray(n)},qu=function(...e){let t="";for(let a=0;a<e.length;a++){const n=e[a];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=qu.apply(null,n):t+="object"==typeof n?Bc(n):n,t+=" "}return t};let ju=null,$u=!0;const zu=function(...e){if(!0===$u&&($u=!1,null===ju&&!0===Ou.get("logging_enabled")&&(cc(!0,"Can't turn on custom loggers persistently."),Fu.logLevel=td.VERBOSE,ju=Fu.log.bind(Fu))),ju){const t=qu.apply(null,e);ju(t)}},Vu=function(e){return function(...t){zu(e,...t)}},Wu=function(...e){const t="FIREBASE INTERNAL ERROR: "+qu(...e);Fu.error(t)},Hu=function(...e){const t=`FIREBASE FATAL ERROR: ${qu(...e)}`;throw Fu.error(t),new Error(t)},Gu=function(...e){const t="FIREBASE WARNING: "+qu(...e);Fu.warn(t)},Yu=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Ku="[MIN_NAME]",Qu="[MAX_NAME]",Ju=function(e,t){if(e===t)return 0;if(e===Ku||t===Qu)return-1;if(t===Ku||e===Qu)return 1;{const a=sh(e),n=sh(t);return null!==a?null!==n?a-n===0?e.length-t.length:a-n:-1:null!==n?1:e<t?-1:1}},Zu=function(e,t){return e===t?0:e<t?-1:1},Xu=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Bc(t))},eh=function(e){if("object"!=typeof e||null===e)return Bc(e);const t=[];for(const n in e)t.push(n);t.sort();let a="{";for(let n=0;n<t.length;n++)0!==n&&(a+=","),a+=Bc(t[n]),a+=":",a+=eh(e[t[n]]);return a+="}",a},th=function(e,t){const a=e.length;if(a<=t)return[e];const n=[];for(let i=0;i<a;i+=t)i+t>a?n.push(e.substring(i,a)):n.push(e.substring(i,i+t));return n};function ah(e,t){for(const a in e)e.hasOwnProperty(a)&&t(a,e[a])}const nh=function(e){cc(!Yu(e),"Invalid JSON number");const t=1023;let a,n,i,s,o;0===e?(n=0,i=0,a=1/e==-1/0?1:0):(a=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),t),n=s+t,i=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(n=0,i=Math.round(e/Math.pow(2,-1074))));const r=[];for(o=52;o;o-=1)r.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;o-=1)r.push(n%2?1:0),n=Math.floor(n/2);r.push(a?1:0),r.reverse();const l=r.join("");let c="";for(o=0;o<64;o+=8){let e=parseInt(l.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()};const ih=new RegExp("^-?(0*)\\d{1,10}$"),sh=function(e){if(ih.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},oh=function(e){try{e()}catch(t){setTimeout(()=>{const e=t.stack||"";throw Gu("Exception was thrown by user callback.",e),t},Math.floor(0))}},rh=function(e,t){const a=setTimeout(e,t);return"number"==typeof a&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(a):"object"==typeof a&&a.unref&&a.unref(),a};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class lh{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,du(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,a)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,a):t(null)},0)})}addTokenChangeListener(e){var t;null==(t=this.appCheckProvider)||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){Gu(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ch{constructor(e,t,a){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=a,this.auth_=null,this.auth_=a.getImmediate({optional:!0}),this.auth_||a.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(zu("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,a)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,a):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Gu(e)}}class dh{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}dh.OWNER="owner";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const uh=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,hh="ac",ph="websocket",mh="long_polling";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class fh{constructor(e,t,a,n,i=!1,s="",o=!1,r=!1,l=null){this.secure=t,this.namespace=a,this.webSocketOnly=n,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=r,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Lu.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Lu.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function gh(e,t,a){let n;if(cc("string"==typeof t,"typeof type must == string"),cc("object"==typeof a,"typeof params must == object"),t===ph)n=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==mh)throw new Error("Unknown connection type: "+t);n=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(a.ns=e.namespace);const i=[];return ah(a,(e,t)=>{i.push(e+"="+t)}),n+i.join("&")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vh{constructor(){this.counters_={}}incrementCounter(e,t=1){jc(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return vc(this.counters_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bh={},wh={};function yh(e){const t=e.toString();return bh[t]||(bh[t]=new vh),bh[t]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class _h{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&oh(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ch="start";class kh{constructor(e,t,a,n,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=a,this.appCheckToken=n,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Vu(e),this.stats_=yh(t),this.urlFn=e=>(this.appCheckToken&&(e[hh]=this.appCheckToken),gh(t,mh,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new _h(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const a=function(){document.body?t||(t=!0,e()):setTimeout(a,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&a()}),window.attachEvent("onload",a))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Eh((...e)=>{const[t,a,n,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===Ch)this.id=a,this.password=n;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{const[t,a]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,a)},()=>{this.onClosed_()},this.urlFn);const e={};e[Ch]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[hh]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&uh.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){kh.forceAllow_=!0}static forceDisallow(){kh.forceDisallow_=!0}static isAvailable(){return!!kh.forceAllow_||!(kh.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Bc(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const a=mc(t),n=th(a,1840);for(let i=0;i<n.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const a={dframe:"t"};a.id=e,a.pw=t,this.myDisconnFrame.src=this.urlFn(a),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Bc(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Eh{constructor(e,t,a,n){this.onDisconnect=a,this.urlFn=n,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Uu(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Eh.createIFrame_();let a="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){a='<script>document.domain="'+document.domain+'";<\/script>'}const n="<html><body>"+a+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(n),this.myIFrame.doc.close()}catch(i){zu("frame writing exception"),i.stack&&zu(i.stack),zu(i)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||zu("No IE domain setting required")}catch(t){const a=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+a+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),a="",n=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+a.length<=1870))break;{const e=this.pendingSegs.shift();a=a+"&seg"+n+"="+e.seg+"&ts"+n+"="+e.ts+"&d"+n+"="+e.d,n++}}return t+=a,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,a){this.pendingSegs.push({seg:e,ts:t,d:a}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const a=()=>{this.outstandingRequests.delete(t),this.newRequest_()},n=setTimeout(a,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(n),a()})}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const a=this.myIFrame.doc.createElement("script");a.type="text/javascript",a.async=!0,a.src=e,a.onload=a.onreadystatechange=function(){const e=a.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,a.parentNode&&a.parentNode.removeChild(a),t())},a.onerror=()=>{zu("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(a)}catch(a){}},Math.floor(1))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sh=null;"undefined"!=typeof MozWebSocket?Sh=MozWebSocket:"undefined"!=typeof WebSocket&&(Sh=WebSocket);class Th{constructor(e,t,a,n,i,s,o){this.connId=e,this.applicationId=a,this.appCheckToken=n,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Vu(this.connId),this.stats_=yh(t),this.connURL=Th.connectionURL_(t,s,o,n,a),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,a,n,i){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&uh.test(location.hostname)&&(s.r="f"),t&&(s.s=t),a&&(s.ls=a),n&&(s[hh]=n),i&&(s.p=i),gh(e,ph,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Lu.set("previous_websocket_failure",!0);try{let e;this.mySock=new Sh(this.connURL,[],e)}catch(a){this.log_("Error instantiating WebSocket.");const e=a.message||a.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){Th.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,a=navigator.userAgent.match(t);a&&a.length>1&&parseFloat(a[1])<4.4&&(e=!0)}return!e&&null!==Sh&&!Th.forceDisallow_}static previouslyFailed(){return Lu.isInMemoryStorage||!0===Lu.get("previous_websocket_failure")}markConnectionHealthy(){Lu.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=Uc(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(cc(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=Bc(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const a=th(t,16384);a.length>1&&this.sendString_(String(a.length));for(let n=0;n<a.length;n++)this.sendString_(a[n])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Th.responsesRequiredToBeHealthy=2,Th.healthyTimeout=3e4;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ih{static get ALL_TRANSPORTS(){return[kh,Th]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Th&&Th.isAvailable();let a=t&&!Th.previouslyFailed();if(e.webSocketOnly&&(t||Gu("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),a=!0),a)this.transports_=[Th];else{const e=this.transports_=[];for(const t of Ih.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);Ih.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Ih.globalTransportInitialized_=!1;class Nh{constructor(e,t,a,n,i,s,o,r,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=a,this.appCheckToken_=n,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=r,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Vu("c:"+this.id+":"),this.transportManager_=new Ih(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),a=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,a)},Math.floor(0));const n=e.healthyTimeout||0;n>0&&(this.healthyTimeout_=rh(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(n)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Xu("t",e),a=Xu("d",e);if("c"===t)this.onSecondaryControl_(a);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(a)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Xu("t",e),a=Xu("d",e);"c"===t?this.onControl_(a):"d"===t&&this.onDataMessage_(a)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Xu("t",e);if("d"in e){const a=e.d;if("h"===t){const e={...a};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(a):"r"===t?this.onReset_(a):"e"===t?Wu("Server Error: "+a):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Wu("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,a=e.v,n=e.h;this.sessionId=e.s,this.repoInfo_.host=n,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==a&&Gu("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),a=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,a),rh(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):rh(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Lu.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xh{put(e,t,a,n){}merge(e,t,a,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,a){}onDisconnectMerge(e,t,a){}onDisconnectCancel(e,t){}reportStats(e){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah{constructor(e){this.allowedEvents_=e,this.listeners_={},cc(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const a=[...this.listeners_[e]];for(let e=0;e<a.length;e++)a[e].callback.apply(a[e].context,t)}}on(e,t,a){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:a});const n=this.getInitialEvent(e);n&&t.apply(a,n)}off(e,t,a){this.validateEventType_(e);const n=this.listeners_[e]||[];for(let i=0;i<n.length;i++)if(n[i].callback===t&&(!a||a===n[i].context))return void n.splice(i,1)}validateEventType_(e){cc(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ph extends Ah{static getInstance(){return new Ph}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Pc()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return cc("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rh{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Dh(){return new Rh("")}function Mh(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Lh(e){return e.pieces_.length-e.pieceNum_}function Oh(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Rh(e.pieces_,t)}function Fh(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Uh(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Bh(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let a=e.pieceNum_;a<e.pieces_.length-1;a++)t.push(e.pieces_[a]);return new Rh(t,0)}function qh(e,t){const a=[];for(let n=e.pieceNum_;n<e.pieces_.length;n++)a.push(e.pieces_[n]);if(t instanceof Rh)for(let n=t.pieceNum_;n<t.pieces_.length;n++)a.push(t.pieces_[n]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&a.push(e[t])}return new Rh(a,0)}function jh(e){return e.pieceNum_>=e.pieces_.length}function $h(e,t){const a=Mh(e),n=Mh(t);if(null===a)return t;if(a===n)return $h(Oh(e),Oh(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function zh(e,t){if(Lh(e)!==Lh(t))return!1;for(let a=e.pieceNum_,n=t.pieceNum_;a<=e.pieces_.length;a++,n++)if(e.pieces_[a]!==t.pieces_[n])return!1;return!0}function Vh(e,t){let a=e.pieceNum_,n=t.pieceNum_;if(Lh(e)>Lh(t))return!1;for(;a<e.pieces_.length;){if(e.pieces_[a]!==t.pieces_[n])return!1;++a,++n}return!0}class Wh{constructor(e,t){this.errorPrefix_=t,this.parts_=Uh(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let a=0;a<this.parts_.length;a++)this.byteLength_+=Kc(this.parts_[a]);Hh(this)}}function Hh(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Gh(e))}function Gh(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yh extends Ah{static getInstance(){return new Yh}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return cc("visible"===e,"Unknown event type: "+e),[this.visible_]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kh=1e3;class Qh extends xh{constructor(e,t,a,n,i,s,o,r){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=a,this.onConnectStatus_=n,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=r,this.id=Qh.nextPersistentConnectionId_++,this.log_=Vu("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Kh,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,r)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Yh.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Ph.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,a){const n=++this.requestNumber_,i={r:n,a:e,b:t};this.log_(Bc(i)),cc(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),a&&(this.requestCBHash_[n]=a)}get(e){this.initConnection_();const t=new Ec,a={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const a=e.d;"ok"===e.s?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(a),this.outstandingGetCount_++;const n=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(n),t.promise}listen(e,t,a,n){this.initConnection_();const i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),cc(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),cc(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");const o={onComplete:n,hashFn:t,query:e,tag:a};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,a=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(a)})}sendListen_(e){const t=e.query,a=t._path.toString(),n=t._queryIdentifier;this.log_("Listen on "+a+" for "+n);const i={p:a};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,i=>{const s=i.d,o=i.s;Qh.warnOnListenWarnings_(s,t);(this.listens.get(a)&&this.listens.get(a).get(n))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(a,n),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&jc(e,"w")){const a=$c(e,"w");if(Array.isArray(a)&&~a.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',a=t._path.toString();Gu(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${a} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=qc(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=qc(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",a={cred:e};null===this.authOverride_?a.noauth=!0:"object"==typeof this.authOverride_&&(a.authvar=this.authOverride_),this.sendRequest(t,a,t=>{const a=t.s,n=t.d||"error";this.authToken_===e&&("ok"===a?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(a,n))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,a=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,a)})}unlisten(e,t){const a=e._path.toString(),n=e._queryIdentifier;this.log_("Unlisten called for "+a+" "+n),cc(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(a,n)&&this.connected_&&this.sendUnlisten_(a,n,e._queryObject,t)}sendUnlisten_(e,t,a,n){this.log_("Unlisten on "+e+" for "+t);const i={p:e};n&&(i.q=a,i.t=n),this.sendRequest("n",i)}onDisconnectPut(e,t,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,a):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:a})}onDisconnectMerge(e,t,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,a):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:a})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,a,n){const i={p:t,d:a};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{n&&setTimeout(()=>{n(e.s,e.d)},Math.floor(0))})}put(e,t,a,n){this.putInternal("p",e,t,a,n)}merge(e,t,a,n){this.putInternal("m",e,t,a,n)}putInternal(e,t,a,n,i){this.initConnection_();const s={p:t,d:a};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:n}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,a=this.outstandingPuts_[e].request,n=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,a,a=>{this.log_(t+" response",a),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),n&&n(a.s,a.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Bc(e));const t=e.r,a=this.requestCBHash_[t];a&&(delete this.requestCBHash_[t],a(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Wu("Unrecognized action received from server: "+Bc(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){cc(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Kh,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Kh,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Kh),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),a=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Qh.nextConnectionId_++,s=this.lastSessionId;let o=!1,r=null;const l=function(){r?r.close():(o=!0,n())},c=function(e){cc(r,"sendRequest call when we're not connected not allowed."),r.sendRequest(e)};this.realtime_={close:l,sendRequest:c};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[e,l]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);o?zu("getToken() completed but was canceled"):(zu("getToken() completed. Creating connection."),this.authToken_=e&&e.accessToken,this.appCheckToken_=l&&l.token,r=new Nh(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,a,n,e=>{Gu(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&Gu(e),l())}}}interrupt(e){zu("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){zu("Resuming connection for reason: "+e),delete this.interruptReasons_[e],zc(this.interruptReasons_)&&(this.reconnectDelay_=Kh,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let a;a=t?t.map(e=>eh(e)).join("$"):"default";const n=this.removeListen_(e,a);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(e,t){const a=new Rh(e).toString();let n;if(this.listens.has(a)){const e=this.listens.get(a);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(a)}else n=void 0;return n}onAuthRevoked_(e,t){zu("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){zu("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+Au.replace(/\./g,"-")]=1,Pc()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Ph.getInstance().currentlyOnline();return zc(this.interruptReasons_)&&e}}Qh.nextPersistentConnectionId_=0,Qh.nextConnectionId_=0;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Jh{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Jh(e,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zh{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const a=new Jh(Ku,e),n=new Jh(Ku,t);return 0!==this.compare(a,n)}minPost(){return Jh.MIN}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xh;class ep extends Zh{static get __EMPTY_NODE(){return Xh}static set __EMPTY_NODE(e){Xh=e}compare(e,t){return Ju(e.name,t.name)}isDefinedOn(e){throw dc("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Jh.MIN}maxPost(){return new Jh(Qu,Xh)}makePost(e,t){return cc("string"==typeof e,"KeyIndex indexValue must always be a string."),new Jh(e,Xh)}toString(){return".key"}}const tp=new ep;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ap{constructor(e,t,a,n,i=null){this.isReverse_=n,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?a(e.key,t):1,n&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class np{constructor(e,t,a,n,i){this.key=e,this.value=t,this.color=null!=a?a:np.RED,this.left=null!=n?n:ip.EMPTY_NODE,this.right=null!=i?i:ip.EMPTY_NODE}copy(e,t,a,n,i){return new np(null!=e?e:this.key,null!=t?t:this.value,null!=a?a:this.color,null!=n?n:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,a){let n=this;const i=a(e,n.key);return n=i<0?n.copy(null,null,null,n.left.insert(e,t,a),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,a)),n.fixUp_()}removeMin_(){if(this.left.isEmpty())return ip.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let a,n;if(a=this,t(e,a.key)<0)a.left.isEmpty()||a.left.isRed_()||a.left.left.isRed_()||(a=a.moveRedLeft_()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed_()&&(a=a.rotateRight_()),a.right.isEmpty()||a.right.isRed_()||a.right.left.isRed_()||(a=a.moveRedRight_()),0===t(e,a.key)){if(a.right.isEmpty())return ip.EMPTY_NODE;n=a.right.min_(),a=a.copy(n.key,n.value,null,null,a.right.removeMin_())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,np.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,np.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}np.RED=!0,np.BLACK=!1;class ip{constructor(e,t=ip.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new ip(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,np.BLACK,null,null))}remove(e){return new ip(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,np.BLACK,null,null))}get(e){let t,a=this.root_;for(;!a.isEmpty();){if(t=this.comparator_(e,a.key),0===t)return a.value;t<0?a=a.left:t>0&&(a=a.right)}return null}getPredecessorKey(e){let t,a=this.root_,n=null;for(;!a.isEmpty();){if(t=this.comparator_(e,a.key),0===t){if(a.left.isEmpty())return n?n.key:null;for(a=a.left;!a.right.isEmpty();)a=a.right;return a.key}t<0?a=a.left:t>0&&(n=a,a=a.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ap(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new ap(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new ap(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new ap(this.root_,null,this.comparator_,!0,e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function sp(e,t){return Ju(e.name,t.name)}function op(e,t){return Ju(e,t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rp;ip.EMPTY_NODE=new class{copy(e,t,a,n,i){return this}insert(e,t,a){return new np(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const lp=function(e){return"number"==typeof e?"number:"+nh(e):"string:"+e},cp=function(e){if(e.isLeafNode()){const t=e.val();cc("string"==typeof t||"number"==typeof t||"object"==typeof t&&jc(t,".sv"),"Priority must be a string or number.")}else cc(e===rp||e.isEmpty(),"priority of unexpected type.");cc(e===rp||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let dp,up,hp;class pp{static set __childrenNodeConstructor(e){dp=e}static get __childrenNodeConstructor(){return dp}constructor(e,t=pp.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,cc(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),cp(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new pp(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:pp.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return jh(e)?this:".priority"===Mh(e)?this.priorityNode_:pp.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:pp.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const a=Mh(e);return null===a?t:t.isEmpty()&&".priority"!==a?this:(cc(".priority"!==a||1===Lh(e),".priority must be the last token in a path"),this.updateImmediateChild(a,pp.__childrenNodeConstructor.EMPTY_NODE.updateChild(Oh(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+lp(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?nh(this.value_):this.value_,this.lazyHash_=Bu(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===pp.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof pp.__childrenNodeConstructor?-1:(cc(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,a=typeof this.value_,n=pp.VALUE_TYPE_ORDER.indexOf(t),i=pp.VALUE_TYPE_ORDER.indexOf(a);return cc(n>=0,"Unknown leaf type: "+t),cc(i>=0,"Unknown leaf type: "+a),n===i?"object"===a?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-n}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}pp.VALUE_TYPE_ORDER=["object","boolean","number","string"];const mp=new class extends Zh{compare(e,t){const a=e.node.getPriority(),n=t.node.getPriority(),i=a.compareTo(n);return 0===i?Ju(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Jh.MIN}maxPost(){return new Jh(Qu,new pp("[PRIORITY-POST]",hp))}makePost(e,t){const a=up(e);return new Jh(t,new pp("[PRIORITY-POST]",a))}toString(){return".priority"}},fp=Math.log(2);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gp{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/fp,10)),this.current_=this.count-1;const a=(n=this.count,parseInt(Array(n+1).join("1"),2));var n;this.bits_=e+1&a}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const vp=function(e,t,a,n){e.sort(t);const i=function(t,n){const s=n-t;let o,r;if(0===s)return null;if(1===s)return o=e[t],r=a?a(o):o,new np(r,o.node,np.BLACK,null,null);{const l=parseInt(s/2,10)+t,c=i(t,l),d=i(l+1,n);return o=e[l],r=a?a(o):o,new np(r,o.node,np.BLACK,c,d)}},s=function(t){let n=null,s=null,o=e.length;const r=function(t,n){const s=o-t,r=o;o-=t;const c=i(s+1,r),d=e[s],u=a?a(d):d;l(new np(u,d.node,n,null,c))},l=function(e){n?(n.left=e,n=e):(s=e,n=e)};for(let e=0;e<t.count;++e){const a=t.nextBitIsOne(),n=Math.pow(2,t.count-(e+1));a?r(n,np.BLACK):(r(n,np.BLACK),r(n,np.RED))}return s}(new gp(e.length));return new ip(n||t,s)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bp;const wp={};class yp{static get Default(){return cc(wp&&mp,"ChildrenNode.ts has not been loaded"),bp=bp||new yp({".priority":wp},{".priority":mp}),bp}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=$c(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ip?t:null}hasIndex(e){return jc(this.indexSet_,e.toString())}addIndex(e,t){cc(e!==tp,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const a=[];let n=!1;const i=t.getIterator(Jh.Wrap);let s,o=i.getNext();for(;o;)n=n||e.isDefinedOn(o.node),a.push(o),o=i.getNext();s=n?vp(a,e.getCompare()):wp;const r=e.toString(),l={...this.indexSet_};l[r]=e;const c={...this.indexes_};return c[r]=s,new yp(c,l)}addToIndexes(e,t){const a=Vc(this.indexes_,(a,n)=>{const i=$c(this.indexSet_,n);if(cc(i,"Missing index implementation for "+n),a===wp){if(i.isDefinedOn(e.node)){const a=[],n=t.getIterator(Jh.Wrap);let s=n.getNext();for(;s;)s.name!==e.name&&a.push(s),s=n.getNext();return a.push(e),vp(a,i.getCompare())}return wp}{const n=t.get(e.name);let i=a;return n&&(i=i.remove(new Jh(e.name,n))),i.insert(e,e.node)}});return new yp(a,this.indexSet_)}removeFromIndexes(e,t){const a=Vc(this.indexes_,a=>{if(a===wp)return a;{const n=t.get(e.name);return n?a.remove(new Jh(e.name,n)):a}});return new yp(a,this.indexSet_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _p;class Cp{static get EMPTY_NODE(){return _p||(_p=new Cp(new ip(op),null,yp.Default))}constructor(e,t,a){this.children_=e,this.priorityNode_=t,this.indexMap_=a,this.lazyHash_=null,this.priorityNode_&&cp(this.priorityNode_),this.children_.isEmpty()&&cc(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||_p}updatePriority(e){return this.children_.isEmpty()?this:new Cp(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?_p:t}}getChild(e){const t=Mh(e);return null===t?this:this.getImmediateChild(t).getChild(Oh(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(cc(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const a=new Jh(e,t);let n,i;t.isEmpty()?(n=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(a,this.children_)):(n=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(a,this.children_));const s=n.isEmpty()?_p:this.priorityNode_;return new Cp(n,s,i)}}updateChild(e,t){const a=Mh(e);if(null===a)return t;{cc(".priority"!==Mh(e)||1===Lh(e),".priority must be the last token in a path");const n=this.getImmediateChild(a).updateChild(Oh(e),t);return this.updateImmediateChild(a,n)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let a=0,n=0,i=!0;if(this.forEachChild(mp,(s,o)=>{t[s]=o.val(e),a++,i&&Cp.INTEGER_REGEXP_.test(s)?n=Math.max(n,Number(s)):i=!1}),!e&&i&&n<2*a){const e=[];for(const a in t)e[a]=t[a];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+lp(this.getPriority().val())+":"),this.forEachChild(mp,(t,a)=>{const n=a.hash();""!==n&&(e+=":"+t+":"+n)}),this.lazyHash_=""===e?"":Bu(e)}return this.lazyHash_}getPredecessorChildName(e,t,a){const n=this.resolveIndex_(a);if(n){const a=n.getPredecessorKey(new Jh(e,t));return a?a.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Jh(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Jh(t,this.children_.get(t)):null}forEachChild(e,t){const a=this.resolveIndex_(e);return a?a.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const a=this.resolveIndex_(t);if(a)return a.getIteratorFrom(e,e=>e);{const a=this.children_.getIteratorFrom(e.name,Jh.Wrap);let n=a.peek();for(;null!=n&&t.compare(n,e)<0;)a.getNext(),n=a.peek();return a}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const a=this.resolveIndex_(t);if(a)return a.getReverseIteratorFrom(e,e=>e);{const a=this.children_.getReverseIteratorFrom(e.name,Jh.Wrap);let n=a.peek();for(;null!=n&&t.compare(n,e)>0;)a.getNext(),n=a.peek();return a}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===kp?-1:0}withIndex(e){if(e===tp||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Cp(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===tp||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(mp),a=t.getIterator(mp);let n=e.getNext(),i=a.getNext();for(;n&&i;){if(n.name!==i.name||!n.node.equals(i.node))return!1;n=e.getNext(),i=a.getNext()}return null===n&&null===i}return!1}return!1}}resolveIndex_(e){return e===tp?null:this.indexMap_.get(e.toString())}}Cp.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const kp=new class extends Cp{constructor(){super(new ip(op),Cp.EMPTY_NODE,yp.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Cp.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Jh,{MIN:{value:new Jh(Ku,Cp.EMPTY_NODE)},MAX:{value:new Jh(Qu,kp)}}),ep.__EMPTY_NODE=Cp.EMPTY_NODE,pp.__childrenNodeConstructor=Cp,rp=kp,function(e){hp=e}(kp);function Ep(e,t=null){if(null===e)return Cp.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),cc(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){return new pp(e,Ep(t))}if(e instanceof Array){let a=Cp.EMPTY_NODE;return ah(e,(t,n)=>{if(jc(e,t)&&"."!==t.substring(0,1)){const e=Ep(n);!e.isLeafNode()&&e.isEmpty()||(a=a.updateImmediateChild(t,e))}}),a.updatePriority(Ep(t))}{const a=[];let n=!1;if(ah(e,(e,t)=>{if("."!==e.substring(0,1)){const i=Ep(t);i.isEmpty()||(n=n||!i.getPriority().isEmpty(),a.push(new Jh(e,i)))}}),0===a.length)return Cp.EMPTY_NODE;const i=vp(a,sp,e=>e.name,op);if(n){const e=vp(a,mp.getCompare());return new Cp(i,Ep(t),new yp({".priority":e},{".priority":mp}))}return new Cp(i,Ep(t),yp.Default)}}!function(e){up=e}(Ep);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Sp extends Zh{constructor(e){super(),this.indexPath_=e,cc(!jh(e)&&".priority"!==Mh(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const a=this.extractChild(e.node),n=this.extractChild(t.node),i=a.compareTo(n);return 0===i?Ju(e.name,t.name):i}makePost(e,t){const a=Ep(e),n=Cp.EMPTY_NODE.updateChild(this.indexPath_,a);return new Jh(t,n)}maxPost(){const e=Cp.EMPTY_NODE.updateChild(this.indexPath_,kp);return new Jh(Qu,e)}toString(){return Uh(this.indexPath_,0).join("/")}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tp=new class extends Zh{compare(e,t){const a=e.node.compareTo(t.node);return 0===a?Ju(e.name,t.name):a}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Jh.MIN}maxPost(){return Jh.MAX}makePost(e,t){const a=Ep(e);return new Jh(t,a)}toString(){return".value"}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ip(e){return{type:"value",snapshotNode:e}}function Np(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function xp(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Ap(e,t,a){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:a}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Pp{constructor(e){this.index_=e}updateChild(e,t,a,n,i,s){cc(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(n).equals(a.getChild(n))&&o.isEmpty()===a.isEmpty()?e:(null!=s&&(a.isEmpty()?e.hasChild(t)?s.trackChildChange(xp(t,o)):cc(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(Np(t,a)):s.trackChildChange(Ap(t,a,o))),e.isLeafNode()&&a.isEmpty()?e:e.updateImmediateChild(t,a).withIndex(this.index_))}updateFullNode(e,t,a){return null!=a&&(e.isLeafNode()||e.forEachChild(mp,(e,n)=>{t.hasChild(e)||a.trackChildChange(xp(e,n))}),t.isLeafNode()||t.forEachChild(mp,(t,n)=>{if(e.hasChild(t)){const i=e.getImmediateChild(t);i.equals(n)||a.trackChildChange(Ap(t,n,i))}else a.trackChildChange(Np(t,n))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Cp.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rp{constructor(e){this.indexedFilter_=new Pp(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Rp.getStartPost_(e),this.endPost_=Rp.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,a=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&a}updateChild(e,t,a,n,i,s){return this.matches(new Jh(t,a))||(a=Cp.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,a,n,i,s)}updateFullNode(e,t,a){t.isLeafNode()&&(t=Cp.EMPTY_NODE);let n=t.withIndex(this.index_);n=n.updatePriority(Cp.EMPTY_NODE);const i=this;return t.forEachChild(mp,(e,t)=>{i.matches(new Jh(e,t))||(n=n.updateImmediateChild(e,Cp.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,n,a)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new Rp(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,a,n,i,s){return this.rangedFilter_.matches(new Jh(t,a))||(a=Cp.EMPTY_NODE),e.getImmediateChild(t).equals(a)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,a,n,i,s):this.fullLimitUpdateChild_(e,t,a,i,s)}updateFullNode(e,t,a){let n;if(t.isLeafNode()||t.isEmpty())n=Cp.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;n=Cp.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let a=0;for(;e.hasNext()&&a<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;n=n.updateImmediateChild(t.name,t.node),a++}}}else{let e;n=t.withIndex(this.index_),n=n.updatePriority(Cp.EMPTY_NODE),e=this.reverse_?n.getReverseIterator(this.index_):n.getIterator(this.index_);let a=0;for(;e.hasNext();){const t=e.getNext();a<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?a++:n=n.updateImmediateChild(t.name,Cp.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,n,a)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,a,n,i){let s;if(this.reverse_){const e=this.index_.getCompare();s=(t,a)=>e(a,t)}else s=this.index_.getCompare();const o=e;cc(o.numChildren()===this.limit_,"");const r=new Jh(t,a),l=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),c=this.rangedFilter_.matches(r);if(o.hasChild(t)){const e=o.getImmediateChild(t);let d=n.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=d&&(d.name===t||o.hasChild(d.name));)d=n.getChildAfterChild(this.index_,d,this.reverse_);const u=null==d?1:s(d,r);if(c&&!a.isEmpty()&&u>=0)return null!=i&&i.trackChildChange(Ap(t,a,e)),o.updateImmediateChild(t,a);{null!=i&&i.trackChildChange(xp(t,e));const a=o.updateImmediateChild(t,Cp.EMPTY_NODE);return null!=d&&this.rangedFilter_.matches(d)?(null!=i&&i.trackChildChange(Np(d.name,d.node)),a.updateImmediateChild(d.name,d.node)):a}}return a.isEmpty()?e:c&&s(l,r)>=0?(null!=i&&(i.trackChildChange(xp(l.name,l.node)),i.trackChildChange(Np(t,a))),o.updateImmediateChild(t,a).updateImmediateChild(l.name,Cp.EMPTY_NODE)):e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mp{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=mp}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return cc(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return cc(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ku}hasEnd(){return this.endSet_}getIndexEndValue(){return cc(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return cc(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Qu}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return cc(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===mp}copy(){const e=new Mp;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Lp(e){const t={};if(e.isDefault())return t;let a;if(e.index_===mp?a="$priority":e.index_===Tp?a="$value":e.index_===tp?a="$key":(cc(e.index_ instanceof Sp,"Unrecognized index type!"),a=e.index_.toString()),t.orderBy=Bc(a),e.startSet_){const a=e.startAfterSet_?"startAfter":"startAt";t[a]=Bc(e.indexStartValue_),e.startNameSet_&&(t[a]+=","+Bc(e.indexStartName_))}if(e.endSet_){const a=e.endBeforeSet_?"endBefore":"endAt";t[a]=Bc(e.indexEndValue_),e.endNameSet_&&(t[a]+=","+Bc(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function Op(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let a=e.viewFrom_;""===a&&(a=e.isViewFromLeft()?"l":"r"),t.vf=a}return e.index_!==mp&&(t.i=e.index_.toString()),t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fp extends xh{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(cc(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,a,n){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=a,this.appCheckTokenProvider_=n,this.log_=Vu("p:rest:"),this.listens_={}}listen(e,t,a,n){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const s=Fp.getListenId_(e,a),o={};this.listens_[s]=o;const r=Lp(e._queryParams);this.restRequest_(i+".json",r,(e,t)=>{let r=t;if(404===e&&(r=null,e=null),null===e&&this.onDataUpdate_(i,r,!1,a),$c(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",n(t,null)}})}unlisten(e,t){const a=Fp.getListenId_(e,t);delete this.listens_[a]}get(e){const t=Lp(e._queryParams),a=e._path.toString(),n=new Ec;return this.restRequest_(a+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(a,i,!1,null),n.resolve(i)):n.reject(new Error(i))}),n.promise}refreshAuthToken(e){}restRequest_(e,t={},a){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([n,i])=>{n&&n.accessToken&&(t.auth=n.accessToken),i&&i.token&&(t.ac=i.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+function(e){const t=[];for(const[a,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(a)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(a)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(a&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let t=null;if(o.status>=200&&o.status<300){try{t=Uc(o.responseText)}catch(e){Gu("Failed to parse JSON response for "+s+": "+o.responseText)}a(null,t)}else 401!==o.status&&404!==o.status&&Gu("Got unsuccessful REST response for "+s+" Status: "+o.status),a(o.status);a=null}},o.open("GET",s,!0),o.send()})}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Up{constructor(){this.rootNode_=Cp.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bp(){return{value:null,children:new Map}}function qp(e,t,a){if(jh(t))e.value=a,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,a);else{const n=Mh(t);e.children.has(n)||e.children.set(n,Bp());qp(e.children.get(n),t=Oh(t),a)}}function jp(e,t,a){null!==e.value?a(t,e.value):function(e,t){e.children.forEach((e,a)=>{t(a,e)})}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,(e,n)=>{jp(n,new Rh(t.toString()+"/"+e),a)})}class $p{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&ah(this.last_,(e,a)=>{t[e]=t[e]-a}),this.last_=e,t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zp{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new $p(e);const a=1e4+2e4*Math.random();rh(this.reportStats_.bind(this),Math.floor(a))}reportStats_(){const e=this.statsListener_.get(),t={};let a=!1;ah(e,(e,n)=>{n>0&&jc(this.statsToReport_,e)&&(t[e]=n,a=!0)}),a&&this.server_.reportStats(t),rh(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vp,Wp;function Hp(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(Wp=Vp||(Vp={}))[Wp.OVERWRITE=0]="OVERWRITE",Wp[Wp.MERGE=1]="MERGE",Wp[Wp.ACK_USER_WRITE=2]="ACK_USER_WRITE",Wp[Wp.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class Gp{constructor(e,t,a){this.path=e,this.affectedTree=t,this.revert=a,this.type=Vp.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(jh(this.path)){if(null!=this.affectedTree.value)return cc(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Rh(e));return new Gp(Dh(),t,this.revert)}}return cc(Mh(this.path)===e,"operationForChild called for unrelated child."),new Gp(Oh(this.path),this.affectedTree,this.revert)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yp{constructor(e,t){this.source=e,this.path=t,this.type=Vp.LISTEN_COMPLETE}operationForChild(e){return jh(this.path)?new Yp(this.source,Dh()):new Yp(this.source,Oh(this.path))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kp{constructor(e,t,a){this.source=e,this.path=t,this.snap=a,this.type=Vp.OVERWRITE}operationForChild(e){return jh(this.path)?new Kp(this.source,Dh(),this.snap.getImmediateChild(e)):new Kp(this.source,Oh(this.path),this.snap)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qp{constructor(e,t,a){this.source=e,this.path=t,this.children=a,this.type=Vp.MERGE}operationForChild(e){if(jh(this.path)){const t=this.children.subtree(new Rh(e));return t.isEmpty()?null:t.value?new Kp(this.source,Dh(),t.value):new Qp(this.source,Dh(),t)}return cc(Mh(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Qp(this.source,Oh(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jp{constructor(e,t,a){this.node_=e,this.fullyInitialized_=t,this.filtered_=a}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(jh(e))return this.isFullyInitialized()&&!this.filtered_;const t=Mh(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zp{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Xp(e,t,a,n,i,s){const o=n.filter(e=>e.type===a);o.sort((t,a)=>function(e,t,a){if(null==t.childName||null==a.childName)throw dc("Should only compare child_ events.");const n=new Jh(t.childName,t.snapshotNode),i=new Jh(a.childName,a.snapshotNode);return e.index_.compare(n,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,a)),o.forEach(a=>{const n=function(e,t,a){return"value"===t.type||"child_removed"===t.type||(t.prevName=a.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,a,s);i.forEach(i=>{i.respondsTo(a.type)&&t.push(i.createEvent(n,e.query_))})})}function em(e,t){return{eventCache:e,serverCache:t}}function tm(e,t,a,n){return em(new Jp(t,a,n),e.serverCache)}function am(e,t,a,n){return em(e.eventCache,new Jp(t,a,n))}function nm(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function im(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sm;class om{static fromObject(e){let t=new om(null);return ah(e,(e,a)=>{t=t.set(new Rh(e),a)}),t}constructor(e,t=(()=>(sm||(sm=new ip(Zu)),sm))()){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Dh(),value:this.value};if(jh(e))return null;{const a=Mh(e),n=this.children.get(a);if(null!==n){const i=n.findRootMostMatchingPathAndValue(Oh(e),t);if(null!=i){return{path:qh(new Rh(a),i.path),value:i.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(jh(e))return this;{const t=Mh(e),a=this.children.get(t);return null!==a?a.subtree(Oh(e)):new om(null)}}set(e,t){if(jh(e))return new om(t,this.children);{const a=Mh(e),n=(this.children.get(a)||new om(null)).set(Oh(e),t),i=this.children.insert(a,n);return new om(this.value,i)}}remove(e){if(jh(e))return this.children.isEmpty()?new om(null):new om(null,this.children);{const t=Mh(e),a=this.children.get(t);if(a){const n=a.remove(Oh(e));let i;return i=n.isEmpty()?this.children.remove(t):this.children.insert(t,n),null===this.value&&i.isEmpty()?new om(null):new om(this.value,i)}return this}}get(e){if(jh(e))return this.value;{const t=Mh(e),a=this.children.get(t);return a?a.get(Oh(e)):null}}setTree(e,t){if(jh(e))return t;{const a=Mh(e),n=(this.children.get(a)||new om(null)).setTree(Oh(e),t);let i;return i=n.isEmpty()?this.children.remove(a):this.children.insert(a,n),new om(this.value,i)}}fold(e){return this.fold_(Dh(),e)}fold_(e,t){const a={};return this.children.inorderTraversal((n,i)=>{a[n]=i.fold_(qh(e,n),t)}),t(e,this.value,a)}findOnPath(e,t){return this.findOnPath_(e,Dh(),t)}findOnPath_(e,t,a){const n=!!this.value&&a(t,this.value);if(n)return n;if(jh(e))return null;{const n=Mh(e),i=this.children.get(n);return i?i.findOnPath_(Oh(e),qh(t,n),a):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Dh(),t)}foreachOnPath_(e,t,a){if(jh(e))return this;{this.value&&a(t,this.value);const n=Mh(e),i=this.children.get(n);return i?i.foreachOnPath_(Oh(e),qh(t,n),a):new om(null)}}foreach(e){this.foreach_(Dh(),e)}foreach_(e,t){this.children.inorderTraversal((a,n)=>{n.foreach_(qh(e,a),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,a)=>{a.value&&e(t,a.value)})}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm{constructor(e){this.writeTree_=e}static empty(){return new rm(new om(null))}}function lm(e,t,a){if(jh(t))return new rm(new om(a));{const n=e.writeTree_.findRootMostValueAndPath(t);if(null!=n){const i=n.path;let s=n.value;const o=$h(i,t);return s=s.updateChild(o,a),new rm(e.writeTree_.set(i,s))}{const n=new om(a),i=e.writeTree_.setTree(t,n);return new rm(i)}}}function cm(e,t,a){let n=e;return ah(a,(e,a)=>{n=lm(n,qh(t,e),a)}),n}function dm(e,t){if(jh(t))return rm.empty();{const a=e.writeTree_.setTree(t,new om(null));return new rm(a)}}function um(e,t){return null!=hm(e,t)}function hm(e,t){const a=e.writeTree_.findRootMostValueAndPath(t);return null!=a?e.writeTree_.get(a.path).getChild($h(a.path,t)):null}function pm(e){const t=[],a=e.writeTree_.value;return null!=a?a.isLeafNode()||a.forEachChild(mp,(e,a)=>{t.push(new Jh(e,a))}):e.writeTree_.children.inorderTraversal((e,a)=>{null!=a.value&&t.push(new Jh(e,a.value))}),t}function mm(e,t){if(jh(t))return e;{const a=hm(e,t);return new rm(null!=a?new om(a):e.writeTree_.subtree(t))}}function fm(e){return e.writeTree_.isEmpty()}function gm(e,t){return vm(Dh(),e.writeTree_,t)}function vm(e,t,a){if(null!=t.value)return a.updateChild(e,t.value);{let n=null;return t.children.inorderTraversal((t,i)=>{".priority"===t?(cc(null!==i.value,"Priority writes must always be leaf nodes"),n=i.value):a=vm(qh(e,t),i,a)}),a.getChild(e).isEmpty()||null===n||(a=a.updateChild(qh(e,".priority"),n)),a}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bm(e,t){return Pm(t,e)}function wm(e,t){const a=e.allWrites.findIndex(e=>e.writeId===t);cc(a>=0,"removeWrite called with nonexistent writeId.");const n=e.allWrites[a];e.allWrites.splice(a,1);let i=n.visible,s=!1,o=e.allWrites.length-1;for(;i&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=a&&ym(t,n.path)?i=!1:Vh(n.path,t.path)&&(s=!0)),o--}if(i){if(s)return function(e){e.visibleWrites=Cm(e.allWrites,_m,Dh()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(n.snap)e.visibleWrites=dm(e.visibleWrites,n.path);else{ah(n.children,t=>{e.visibleWrites=dm(e.visibleWrites,qh(n.path,t))})}return!0}return!1}function ym(e,t){if(e.snap)return Vh(e.path,t);for(const a in e.children)if(e.children.hasOwnProperty(a)&&Vh(qh(e.path,a),t))return!0;return!1}function _m(e){return e.visible}function Cm(e,t,a){let n=rm.empty();for(let i=0;i<e.length;++i){const s=e[i];if(t(s)){const e=s.path;let t;if(s.snap)Vh(a,e)?(t=$h(a,e),n=lm(n,t,s.snap)):Vh(e,a)&&(t=$h(e,a),n=lm(n,Dh(),s.snap.getChild(t)));else{if(!s.children)throw dc("WriteRecord should have .snap or .children");if(Vh(a,e))t=$h(a,e),n=cm(n,t,s.children);else if(Vh(e,a))if(t=$h(e,a),jh(t))n=cm(n,Dh(),s.children);else{const e=$c(s.children,Mh(t));if(e){const a=e.getChild(Oh(t));n=lm(n,Dh(),a)}}}}}return n}function km(e,t,a,n,i){if(n||i){const s=mm(e.visibleWrites,t);if(!i&&fm(s))return a;if(i||null!=a||um(s,Dh())){const s=function(e){return(e.visible||i)&&(!n||!~n.indexOf(e.writeId))&&(Vh(e.path,t)||Vh(t,e.path))};return gm(Cm(e.allWrites,s,t),a||Cp.EMPTY_NODE)}return null}{const n=hm(e.visibleWrites,t);if(null!=n)return n;{const n=mm(e.visibleWrites,t);if(fm(n))return a;if(null!=a||um(n,Dh())){return gm(n,a||Cp.EMPTY_NODE)}return null}}}function Em(e,t,a,n){return km(e.writeTree,e.treePath,t,a,n)}function Sm(e,t){return function(e,t,a){let n=Cp.EMPTY_NODE;const i=hm(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(mp,(e,t)=>{n=n.updateImmediateChild(e,t)}),n;if(a){const i=mm(e.visibleWrites,t);return a.forEachChild(mp,(e,t)=>{const a=gm(mm(i,new Rh(e)),t);n=n.updateImmediateChild(e,a)}),pm(i).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}return pm(mm(e.visibleWrites,t)).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}(e.writeTree,e.treePath,t)}function Tm(e,t,a,n){return function(e,t,a,n,i){cc(n||i,"Either existingEventSnap or existingServerSnap must exist");const s=qh(t,a);if(um(e.visibleWrites,s))return null;{const t=mm(e.visibleWrites,s);return fm(t)?i.getChild(a):gm(t,i.getChild(a))}}(e.writeTree,e.treePath,t,a,n)}function Im(e,t){return function(e,t){return hm(e.visibleWrites,t)}(e.writeTree,qh(e.treePath,t))}function Nm(e,t,a,n,i,s){return function(e,t,a,n,i,s,o){let r;const l=mm(e.visibleWrites,t),c=hm(l,Dh());if(null!=c)r=c;else{if(null==a)return[];r=gm(l,a)}if(r=r.withIndex(o),r.isEmpty()||r.isLeafNode())return[];{const e=[],t=o.getCompare(),a=s?r.getReverseIteratorFrom(n,o):r.getIteratorFrom(n,o);let l=a.getNext();for(;l&&e.length<i;)0!==t(l,n)&&e.push(l),l=a.getNext();return e}}(e.writeTree,e.treePath,t,a,n,i,s)}function xm(e,t,a){return function(e,t,a,n){const i=qh(t,a),s=hm(e.visibleWrites,i);if(null!=s)return s;if(n.isCompleteForChild(a))return gm(mm(e.visibleWrites,i),n.getNode().getImmediateChild(a));return null}(e.writeTree,e.treePath,t,a)}function Am(e,t){return Pm(qh(e.treePath,t),e.writeTree)}function Pm(e,t){return{treePath:e,writeTree:t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,a=e.childName;cc("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),cc(".priority"!==a,"Only non-priority child changes can be tracked.");const n=this.changeMap.get(a);if(n){const i=n.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(a,Ap(a,e.snapshotNode,n.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(a);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(a,xp(a,n.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(a,Np(a,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw dc("Illegal combination of changes: "+e+" occurred after "+n);this.changeMap.set(a,Ap(a,e.snapshotNode,n.oldSnap))}}else this.changeMap.set(a,e)}getChanges(){return Array.from(this.changeMap.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dm=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,a){return null}};class Mm{constructor(e,t,a=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=a}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Jp(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return xm(this.writes_,e,t)}}getChildAfterChild(e,t,a){const n=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:im(this.viewCache_),i=Nm(this.writes_,n,t,1,a,e);return 0===i.length?null:i[0]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lm(e,t,a,n,i){const s=new Rm;let o,r;if(a.type===Vp.OVERWRITE){const l=a;l.source.fromUser?o=Um(e,t,l.path,l.snap,n,i,s):(cc(l.source.fromServer,"Unknown source."),r=l.source.tagged||t.serverCache.isFiltered()&&!jh(l.path),o=Fm(e,t,l.path,l.snap,n,i,r,s))}else if(a.type===Vp.MERGE){const l=a;l.source.fromUser?o=function(e,t,a,n,i,s,o){let r=t;return n.foreach((n,l)=>{const c=qh(a,n);Bm(t,Mh(c))&&(r=Um(e,r,c,l,i,s,o))}),n.foreach((n,l)=>{const c=qh(a,n);Bm(t,Mh(c))||(r=Um(e,r,c,l,i,s,o))}),r}(e,t,l.path,l.children,n,i,s):(cc(l.source.fromServer,"Unknown source."),r=l.source.tagged||t.serverCache.isFiltered(),o=jm(e,t,l.path,l.children,n,i,r,s))}else if(a.type===Vp.ACK_USER_WRITE){const r=a;o=r.revert?function(e,t,a,n,i,s){let o;if(null!=Im(n,a))return t;{const r=new Mm(n,t,i),l=t.eventCache.getNode();let c;if(jh(a)||".priority"===Mh(a)){let a;if(t.serverCache.isFullyInitialized())a=Em(n,im(t));else{const e=t.serverCache.getNode();cc(e instanceof Cp,"serverChildren would be complete if leaf node"),a=Sm(n,e)}c=e.filter.updateFullNode(l,a,s)}else{const i=Mh(a);let d=xm(n,i,t.serverCache);null==d&&t.serverCache.isCompleteForChild(i)&&(d=l.getImmediateChild(i)),c=null!=d?e.filter.updateChild(l,i,d,Oh(a),r,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(l,i,Cp.EMPTY_NODE,Oh(a),r,s):l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=Em(n,im(t)),o.isLeafNode()&&(c=e.filter.updateFullNode(c,o,s)))}return o=t.serverCache.isFullyInitialized()||null!=Im(n,Dh()),tm(t,c,o,e.filter.filtersNodes())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,r.path,n,i,s):function(e,t,a,n,i,s,o){if(null!=Im(i,a))return t;const r=t.serverCache.isFiltered(),l=t.serverCache;if(null!=n.value){if(jh(a)&&l.isFullyInitialized()||l.isCompleteForPath(a))return Fm(e,t,a,l.getNode().getChild(a),i,s,r,o);if(jh(a)){let n=new om(null);return l.getNode().forEachChild(tp,(e,t)=>{n=n.set(new Rh(e),t)}),jm(e,t,a,n,i,s,r,o)}return t}{let c=new om(null);return n.foreach((e,t)=>{const n=qh(a,e);l.isCompleteForPath(n)&&(c=c.set(e,l.getNode().getChild(n)))}),jm(e,t,a,c,i,s,r,o)}}(e,t,r.path,r.affectedTree,n,i,s)}else{if(a.type!==Vp.LISTEN_COMPLETE)throw dc("Unknown operation type: "+a.type);o=function(e,t,a,n,i){const s=t.serverCache,o=am(t,s.getNode(),s.isFullyInitialized()||jh(a),s.isFiltered());return Om(e,o,a,n,Dm,i)}(e,t,a.path,n,s)}const l=s.getChanges();return function(e,t,a){const n=t.eventCache;if(n.isFullyInitialized()){const i=n.getNode().isLeafNode()||n.getNode().isEmpty(),s=nm(e);(a.length>0||!e.eventCache.isFullyInitialized()||i&&!n.getNode().equals(s)||!n.getNode().getPriority().equals(s.getPriority()))&&a.push(Ip(nm(t)))}}(t,o,l),{viewCache:o,changes:l}}function Om(e,t,a,n,i,s){const o=t.eventCache;if(null!=Im(n,a))return t;{let r,l;if(jh(a))if(cc(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const a=im(t),i=Sm(n,a instanceof Cp?a:Cp.EMPTY_NODE);r=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{const a=Em(n,im(t));r=e.filter.updateFullNode(t.eventCache.getNode(),a,s)}else{const c=Mh(a);if(".priority"===c){cc(1===Lh(a),"Can't have a priority with additional path components");const i=o.getNode();l=t.serverCache.getNode();const s=Tm(n,a,i,l);r=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{const d=Oh(a);let u;if(o.isCompleteForChild(c)){l=t.serverCache.getNode();const e=Tm(n,a,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(c).updateChild(d,e):o.getNode().getImmediateChild(c)}else u=xm(n,c,t.serverCache);r=null!=u?e.filter.updateChild(o.getNode(),c,u,d,i,s):o.getNode()}}return tm(t,r,o.isFullyInitialized()||jh(a),e.filter.filtersNodes())}}function Fm(e,t,a,n,i,s,o,r){const l=t.serverCache;let c;const d=o?e.filter:e.filter.getIndexedFilter();if(jh(a))c=d.updateFullNode(l.getNode(),n,null);else if(d.filtersNodes()&&!l.isFiltered()){const e=l.getNode().updateChild(a,n);c=d.updateFullNode(l.getNode(),e,null)}else{const e=Mh(a);if(!l.isCompleteForPath(a)&&Lh(a)>1)return t;const i=Oh(a),s=l.getNode().getImmediateChild(e).updateChild(i,n);c=".priority"===e?d.updatePriority(l.getNode(),s):d.updateChild(l.getNode(),e,s,i,Dm,null)}const u=am(t,c,l.isFullyInitialized()||jh(a),d.filtersNodes());return Om(e,u,a,i,new Mm(i,u,s),r)}function Um(e,t,a,n,i,s,o){const r=t.eventCache;let l,c;const d=new Mm(i,t,s);if(jh(a))c=e.filter.updateFullNode(t.eventCache.getNode(),n,o),l=tm(t,c,!0,e.filter.filtersNodes());else{const i=Mh(a);if(".priority"===i)c=e.filter.updatePriority(t.eventCache.getNode(),n),l=tm(t,c,r.isFullyInitialized(),r.isFiltered());else{const s=Oh(a),c=r.getNode().getImmediateChild(i);let u;if(jh(s))u=n;else{const e=d.getCompleteChild(i);u=null!=e?".priority"===Fh(s)&&e.getChild(Bh(s)).isEmpty()?e:e.updateChild(s,n):Cp.EMPTY_NODE}if(c.equals(u))l=t;else{l=tm(t,e.filter.updateChild(r.getNode(),i,u,s,d,o),r.isFullyInitialized(),e.filter.filtersNodes())}}}return l}function Bm(e,t){return e.eventCache.isCompleteForChild(t)}function qm(e,t,a){return a.foreach((e,a)=>{t=t.updateChild(e,a)}),t}function jm(e,t,a,n,i,s,o,r){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l,c=t;l=jh(a)?n:new om(null).setTree(a,n);const d=t.serverCache.getNode();return l.children.inorderTraversal((a,n)=>{if(d.hasChild(a)){const l=qm(0,t.serverCache.getNode().getImmediateChild(a),n);c=Fm(e,c,new Rh(a),l,i,s,o,r)}}),l.children.inorderTraversal((a,n)=>{const l=!t.serverCache.isCompleteForChild(a)&&null===n.value;if(!d.hasChild(a)&&!l){const l=qm(0,t.serverCache.getNode().getImmediateChild(a),n);c=Fm(e,c,new Rh(a),l,i,s,o,r)}}),c}class $m{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const a=this.query_._queryParams,n=new Pp(a.getIndex()),i=(s=a).loadsAllData()?new Pp(s.getIndex()):s.hasLimit()?new Dp(s):new Rp(s);var s;this.processor_=function(e){return{filter:e}}(i);const o=t.serverCache,r=t.eventCache,l=n.updateFullNode(Cp.EMPTY_NODE,o.getNode(),null),c=i.updateFullNode(Cp.EMPTY_NODE,r.getNode(),null),d=new Jp(l,o.isFullyInitialized(),n.filtersNodes()),u=new Jp(c,r.isFullyInitialized(),i.filtersNodes());this.viewCache_=em(u,d),this.eventGenerator_=new Zp(this.query_)}get query(){return this.query_}}function zm(e,t){const a=im(e.viewCache_);return a&&(e.query._queryParams.loadsAllData()||!jh(t)&&!a.getImmediateChild(Mh(t)).isEmpty())?a.getChild(t):null}function Vm(e){return 0===e.eventRegistrations_.length}function Wm(e,t,a){const n=[];if(a){cc(null==t,"A cancel should cancel all event registrations.");const i=e.query._path;e.eventRegistrations_.forEach(e=>{const t=e.createCancelEvent(a,i);t&&n.push(t)})}if(t){let a=[];for(let n=0;n<e.eventRegistrations_.length;++n){const i=e.eventRegistrations_[n];if(i.matches(t)){if(t.hasAnyCallback()){a=a.concat(e.eventRegistrations_.slice(n+1));break}}else a.push(i)}e.eventRegistrations_=a}else e.eventRegistrations_=[];return n}function Hm(e,t,a,n){t.type===Vp.MERGE&&null!==t.source.queryId&&(cc(im(e.viewCache_),"We should always have a full cache before handling merges"),cc(nm(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=Lm(e.processor_,i,t,a,n);var o,r;return o=e.processor_,r=s.viewCache,cc(r.eventCache.getNode().isIndexed(o.filter.getIndex()),"Event snap not indexed"),cc(r.serverCache.getNode().isIndexed(o.filter.getIndex()),"Server snap not indexed"),cc(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,Gm(e,s.changes,s.viewCache.eventCache.getNode(),null)}function Gm(e,t,a,n){const i=n?[n]:e.eventRegistrations_;return function(e,t,a,n){const i=[],s=[];return t.forEach(t=>{var a;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((a=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:a}))}),Xp(e,i,"child_removed",t,n,a),Xp(e,i,"child_added",t,n,a),Xp(e,i,"child_moved",s,n,a),Xp(e,i,"child_changed",t,n,a),Xp(e,i,"value",t,n,a),i}(e.eventGenerator_,t,a,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ym,Km;class Qm{constructor(){this.views=new Map}}function Jm(e,t,a,n){const i=t.source.queryId;if(null!==i){const s=e.views.get(i);return cc(null!=s,"SyncTree gave us an op for an invalid query."),Hm(s,t,a,n)}{let i=[];for(const s of e.views.values())i=i.concat(Hm(s,t,a,n));return i}}function Zm(e,t,a,n,i,s){const o=function(e,t,a,n,i){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=Em(a,i?n:null),s=!1;e?s=!0:n instanceof Cp?(e=Sm(a,n),s=!1):(e=Cp.EMPTY_NODE,s=!1);const o=em(new Jp(e,s,!1),new Jp(n,i,!1));return new $m(t,o)}return o}(e,t,n,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,a),function(e,t){const a=e.viewCache_.eventCache,n=[];a.getNode().isLeafNode()||a.getNode().forEachChild(mp,(e,t)=>{n.push(Np(e,t))});return a.isFullyInitialized()&&n.push(Ip(a.getNode())),Gm(e,n,a.getNode(),t)}(o,a)}function Xm(e,t,a,n){const i=t._queryIdentifier,s=[];let o=[];const r=sf(e);if("default"===i)for(const[l,c]of e.views.entries())o=o.concat(Wm(c,a,n)),Vm(c)&&(e.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{const t=e.views.get(i);t&&(o=o.concat(Wm(t,a,n)),Vm(t)&&(e.views.delete(i),t.query._queryParams.loadsAllData()||s.push(t.query)))}return r&&!sf(e)&&s.push(new(cc(Ym,"Reference.ts has not been loaded"),Ym)(t._repo,t._path)),{removed:s,events:o}}function ef(e){const t=[];for(const a of e.views.values())a.query._queryParams.loadsAllData()||t.push(a);return t}function tf(e,t){let a=null;for(const n of e.views.values())a=a||zm(n,t);return a}function af(e,t){if(t._queryParams.loadsAllData())return of(e);{const a=t._queryIdentifier;return e.views.get(a)}}function nf(e,t){return null!=af(e,t)}function sf(e){return null!=of(e)}function of(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rf=1;class lf{constructor(e){this.listenProvider_=e,this.syncPointTree_=new om(null),this.pendingWriteTree_={visibleWrites:rm.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function cf(e,t,a,n,i){return function(e,t,a,n,i){cc(n>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:a,writeId:n,visible:i}),i&&(e.visibleWrites=lm(e.visibleWrites,t,a)),e.lastWriteId=n}(e.pendingWriteTree_,t,a,n,i),i?ff(e,new Kp({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,a)):[]}function df(e,t,a=!1){const n=function(e,t){for(let a=0;a<e.allWrites.length;a++){const n=e.allWrites[a];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(wm(e.pendingWriteTree_,t)){let t=new om(null);return null!=n.snap?t=t.set(Dh(),!0):ah(n.children,e=>{t=t.set(new Rh(e),!0)}),ff(e,new Gp(n.path,t,a))}return[]}function uf(e,t,a){return ff(e,new Kp({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,a))}function hf(e,t,a,n,i=!1){const s=t._path,o=e.syncPointTree_.get(s);let r=[];if(o&&("default"===t._queryIdentifier||nf(o,t))){const l=Xm(o,t,a,n);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));const c=l.removed;if(r=l.events,!i){const a=-1!==c.findIndex(e=>e._queryParams.loadsAllData()),i=e.syncPointTree_.findOnPath(s,(e,t)=>sf(t));if(a&&!i){const t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){const a=function(e){return e.fold((e,t,a)=>{if(t&&sf(t)){return[of(t)]}{let e=[];return t&&(e=ef(t)),ah(a,(t,a)=>{e=e.concat(a)}),e}})}(t);for(let t=0;t<a.length;++t){const n=a[t],i=n.query,s=bf(e,n);e.listenProvider_.startListening(Ef(i),wf(e,i),s.hashFn,s.onComplete)}}}if(!i&&c.length>0&&!n)if(a){const a=null;e.listenProvider_.stopListening(Ef(t),a)}else c.forEach(t=>{const a=e.queryToTagMap.get(yf(t));e.listenProvider_.stopListening(Ef(t),a)})}!function(e,t){for(let a=0;a<t.length;++a){const n=t[a];if(!n._queryParams.loadsAllData()){const t=yf(n),a=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(a)}}}(e,c)}return r}function pf(e,t,a,n=!1){const i=t._path;let s=null,o=!1;e.syncPointTree_.foreachOnPath(i,(e,t)=>{const a=$h(e,i);s=s||tf(t,a),o=o||sf(t)});let r,l=e.syncPointTree_.get(i);if(l?(o=o||sf(l),s=s||tf(l,Dh())):(l=new Qm,e.syncPointTree_=e.syncPointTree_.set(i,l)),null!=s)r=!0;else{r=!1,s=Cp.EMPTY_NODE;e.syncPointTree_.subtree(i).foreachChild((e,t)=>{const a=tf(t,Dh());a&&(s=s.updateImmediateChild(e,a))})}const c=nf(l,t);if(!c&&!t._queryParams.loadsAllData()){const a=yf(t);cc(!e.queryToTagMap.has(a),"View does not exist, but we have a tag");const n=rf++;e.queryToTagMap.set(a,n),e.tagToQueryMap.set(n,a)}let d=Zm(l,t,a,bm(e.pendingWriteTree_,i),s,r);if(!c&&!o&&!n){const a=af(l,t);d=d.concat(function(e,t,a){const n=t._path,i=wf(e,t),s=bf(e,a),o=e.listenProvider_.startListening(Ef(t),i,s.hashFn,s.onComplete),r=e.syncPointTree_.subtree(n);if(i)cc(!sf(r.value),"If we're adding a query, it shouldn't be shadowed");else{const t=r.fold((e,t,a)=>{if(!jh(e)&&t&&sf(t))return[of(t).query];{let e=[];return t&&(e=e.concat(ef(t).map(e=>e.query))),ah(a,(t,a)=>{e=e.concat(a)}),e}});for(let a=0;a<t.length;++a){const n=t[a];e.listenProvider_.stopListening(Ef(n),wf(e,n))}}return o}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,a))}return d}function mf(e,t,a){const n=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,a)=>{const n=tf(a,$h(e,t));if(n)return n});return km(n,t,i,a,!0)}function ff(e,t){return gf(t,e.syncPointTree_,null,bm(e.pendingWriteTree_,Dh()))}function gf(e,t,a,n){if(jh(e.path))return vf(e,t,a,n);{const i=t.get(Dh());null==a&&null!=i&&(a=tf(i,Dh()));let s=[];const o=Mh(e.path),r=e.operationForChild(o),l=t.children.get(o);if(l&&r){const e=a?a.getImmediateChild(o):null,t=Am(n,o);s=s.concat(gf(r,l,e,t))}return i&&(s=s.concat(Jm(i,e,n,a))),s}}function vf(e,t,a,n){const i=t.get(Dh());null==a&&null!=i&&(a=tf(i,Dh()));let s=[];return t.children.inorderTraversal((t,i)=>{const o=a?a.getImmediateChild(t):null,r=Am(n,t),l=e.operationForChild(t);l&&(s=s.concat(vf(l,i,o,r)))}),i&&(s=s.concat(Jm(i,e,n,a))),s}function bf(e,t){const a=t.query,n=wf(e,a);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||Cp.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return n?function(e,t,a){const n=_f(e,a);if(n){const a=Cf(n),i=a.path,s=a.queryId,o=$h(i,t);return kf(e,i,new Yp(Hp(s),o))}return[]}(e,a._path,n):function(e,t){return ff(e,new Yp({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,a._path);{const n=function(e,t){let a="Unknown Error";"too_big"===e?a="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?a="Client doesn't have permission to access the desired data.":"unavailable"===e&&(a="The service is unavailable");const n=new Error(e+" at "+t._path.toString()+": "+a);return n.code=e.toUpperCase(),n}(t,a);return hf(e,a,null,n)}}}}function wf(e,t){const a=yf(t);return e.queryToTagMap.get(a)}function yf(e){return e._path.toString()+"$"+e._queryIdentifier}function _f(e,t){return e.tagToQueryMap.get(t)}function Cf(e){const t=e.indexOf("$");return cc(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Rh(e.substr(0,t))}}function kf(e,t,a){const n=e.syncPointTree_.get(t);cc(n,"Missing sync point for query tag that we're tracking");return Jm(n,a,bm(e.pendingWriteTree_,t),null)}function Ef(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(cc(Km,"Reference.ts has not been loaded"),Km)(e._repo,e._path):e}class Sf{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Sf(t)}node(){return this.node_}}class Tf{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=qh(this.path_,e);return new Tf(this.syncTree_,t)}node(){return mf(this.syncTree_,this.path_)}}const If=function(e,t,a){return e&&"object"==typeof e?(cc(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Nf(e[".sv"],t,a):"object"==typeof e[".sv"]?xf(e[".sv"],t):void cc(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Nf=function(e,t,a){if("timestamp"===e)return a.timestamp;cc(!1,"Unexpected server value: "+e)},xf=function(e,t,a){e.hasOwnProperty("increment")||cc(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const n=e.increment;"number"!=typeof n&&cc(!1,"Unexpected increment value: "+n);const i=t.node();if(cc(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return n;const s=i.getValue();return"number"!=typeof s?n:s+n},Af=function(e,t,a){return Pf(e,new Sf(t),a)};function Pf(e,t,a){const n=e.getPriority().val(),i=If(n,t.getImmediateChild(".priority"),a);let s;if(e.isLeafNode()){const n=e,s=If(n.getValue(),t,a);return s!==n.getValue()||i!==n.getPriority().val()?new pp(s,Ep(i)):e}{const n=e;return s=n,i!==n.getPriority().val()&&(s=s.updatePriority(new pp(i))),n.forEachChild(mp,(e,n)=>{const i=Pf(n,t.getImmediateChild(e),a);i!==n&&(s=s.updateImmediateChild(e,i))}),s}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rf{constructor(e="",t=null,a={children:{},childCount:0}){this.name=e,this.parent=t,this.node=a}}function Df(e,t){let a=t instanceof Rh?t:new Rh(t),n=e,i=Mh(a);for(;null!==i;){const e=$c(n.node.children,i)||{children:{},childCount:0};n=new Rf(i,n,e),a=Oh(a),i=Mh(a)}return n}function Mf(e){return e.node.value}function Lf(e,t){e.node.value=t,qf(e)}function Of(e){return e.node.childCount>0}function Ff(e,t){ah(e.node.children,(a,n)=>{t(new Rf(a,e,n))})}function Uf(e,t,a,n){a&&t(e),Ff(e,e=>{Uf(e,t,!0)})}function Bf(e){return new Rh(null===e.parent?e.name:Bf(e.parent)+"/"+e.name)}function qf(e){null!==e.parent&&function(e,t,a){const n=function(e){return void 0===Mf(e)&&!Of(e)}(a),i=jc(e.node.children,t);n&&i?(delete e.node.children[t],e.node.childCount--,qf(e)):n||i||(e.node.children[t]=a.node,e.node.childCount++,qf(e))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e.parent,e.name,e)}const jf=/[\[\].#$\/\u0000-\u001F\u007F]/,$f=/[\[\].#$\u0000-\u001F\u007F]/,zf=10485760,Vf=function(e){return"string"==typeof e&&0!==e.length&&!jf.test(e)},Wf=function(e){return"string"==typeof e&&0!==e.length&&!$f.test(e)},Hf=function(e,t,a){const n=a instanceof Rh?new Wh(a,e):a;if(void 0===t)throw new Error(e+"contains undefined "+Gh(n));if("function"==typeof t)throw new Error(e+"contains a function "+Gh(n)+" with contents = "+t.toString());if(Yu(t))throw new Error(e+"contains "+t.toString()+" "+Gh(n));if("string"==typeof t&&t.length>zf/3&&Kc(t)>zf)throw new Error(e+"contains a string greater than "+zf+" utf8 bytes "+Gh(n)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let a=!1,i=!1;if(ah(t,(t,s)=>{if(".value"===t)a=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!Vf(t)))throw new Error(e+" contains an invalid key ("+t+") "+Gh(n)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var o,r;r=t,(o=n).parts_.length>0&&(o.byteLength_+=1),o.parts_.push(r),o.byteLength_+=Kc(r),Hh(o),Hf(e,s,n),function(e){const t=e.parts_.pop();e.byteLength_-=Kc(t),e.parts_.length>0&&(e.byteLength_-=1)}(n)}),a&&i)throw new Error(e+' contains ".value" child '+Gh(n)+" in addition to actual children.")}},Gf=function(e,t,a,n){if(!Wf(a))throw new Error(Yc(e,t)+'was an invalid path = "'+a+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Yf=function(e,t){const a=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Vf(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==a.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Wf(e)}(a))throw new Error(Yc(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Kf{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Qf(e,t){let a=null;for(let n=0;n<t.length;n++){const i=t[n],s=i.getPath();null===a||zh(s,a.path)||(e.eventLists_.push(a),a=null),null===a&&(a={events:[],path:s}),a.events.push(i)}a&&e.eventLists_.push(a)}function Jf(e,t,a){Qf(e,a),Xf(e,e=>zh(e,t))}function Zf(e,t,a){Qf(e,a),Xf(e,e=>Vh(e,t)||Vh(t,e))}function Xf(e,t){e.recursionDepth_++;let a=!0;for(let n=0;n<e.eventLists_.length;n++){const i=e.eventLists_[n];if(i){t(i.path)?(eg(e.eventLists_[n]),e.eventLists_[n]=null):a=!1}}a&&(e.eventLists_=[]),e.recursionDepth_--}function eg(e){for(let t=0;t<e.events.length;t++){const a=e.events[t];if(null!==a){e.events[t]=null;const n=a.getEventRunner();ju&&zu("event: "+a.toString()),oh(n)}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tg{constructor(e,t,a,n){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=a,this.appCheckProvider_=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Kf,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Bp(),this.transactionQueueTree_=new Rf,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function ag(e,t,a){if(e.stats_=yh(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Fp(e.repoInfo_,(t,a,n,i)=>{sg(e,t,a,n,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>og(e,!0),0);else{if(null!=a){if("object"!=typeof a)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Bc(a)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}e.persistentConnection_=new Qh(e.repoInfo_,t,(t,a,n,i)=>{sg(e,t,a,n,i)},t=>{og(e,t)},t=>{!function(e,t){ah(t,(t,a)=>{rg(e,t,a)})}(e,t)},e.authTokenProvider_,e.appCheckProvider_,a),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){const a=e.toString();return wh[a]||(wh[a]=t()),wh[a]}(e.repoInfo_,()=>new zp(e.stats_,e.server_)),e.infoData_=new Up,e.infoSyncTree_=new lf({startListening:(t,a,n,i)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=uf(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),rg(e,"connected",!1),e.serverSyncTree_=new lf({startListening:(t,a,n,i)=>(e.server_.listen(t,n,a,(a,n)=>{const s=i(a,n);Zf(e.eventQueue_,t._path,s)}),[]),stopListening:(t,a)=>{e.server_.unlisten(t,a)}})}function ng(e){const t=e.infoData_.getNode(new Rh(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function ig(e){return(t=(t={timestamp:ng(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function sg(e,t,a,n,i){e.dataUpdateCount++;const s=new Rh(t);a=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,a):a;let o=[];if(i)if(n){const t=Vc(a,e=>Ep(e));o=function(e,t,a,n){const i=_f(e,n);if(i){const n=Cf(i),s=n.path,o=n.queryId,r=$h(s,t),l=om.fromObject(a);return kf(e,s,new Qp(Hp(o),r,l))}return[]}(e.serverSyncTree_,s,t,i)}else{const t=Ep(a);o=function(e,t,a,n){const i=_f(e,n);if(null!=i){const n=Cf(i),s=n.path,o=n.queryId,r=$h(s,t);return kf(e,s,new Kp(Hp(o),r,a))}return[]}(e.serverSyncTree_,s,t,i)}else if(n){const t=Vc(a,e=>Ep(e));o=function(e,t,a){const n=om.fromObject(a);return ff(e,new Qp({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}(e.serverSyncTree_,s,t)}else{const t=Ep(a);o=uf(e.serverSyncTree_,s,t)}let r=s;o.length>0&&(r=pg(e,s)),Zf(e.eventQueue_,r,o)}function og(e,t){rg(e,"connected",t),!1===t&&function(e){dg(e,"onDisconnectEvents");const t=ig(e),a=Bp();jp(e.onDisconnect_,Dh(),(n,i)=>{const s=function(e,t,a,n){return Pf(t,new Tf(a,e),n)}(n,i,e.serverSyncTree_,t);qp(a,n,s)});let n=[];jp(a,Dh(),(t,a)=>{n=n.concat(uf(e.serverSyncTree_,t,a));const i=function(e,t){const a=Bf(mg(e,t)),n=Df(e.transactionQueueTree_,t);return function(e,t){let a=e.parent;for(;null!==a;){if(t(a))return!0;a=a.parent}}(n,t=>{bg(e,t)}),bg(e,n),Uf(n,t=>{bg(e,t)}),a}(e,t);pg(e,i)}),e.onDisconnect_=Bp(),Zf(e.eventQueue_,Dh(),n)}(e)}function rg(e,t,a){const n=new Rh("/.info/"+t),i=Ep(a);e.infoData_.updateSnapshot(n,i);const s=uf(e.infoSyncTree_,n,i);Zf(e.eventQueue_,n,s)}function lg(e){return e.nextWriteId_++}function cg(e,t,a){let n;n=".info"===Mh(t._path)?hf(e.infoSyncTree_,t,a):hf(e.serverSyncTree_,t,a),Jf(e.eventQueue_,t._path,n)}function dg(e,...t){let a="";e.persistentConnection_&&(a=e.persistentConnection_.id+":"),zu(a,...t)}function ug(e,t,a){return mf(e.serverSyncTree_,t,a)||Cp.EMPTY_NODE}function hg(e,t=e.transactionQueueTree_){if(t||vg(e,t),Mf(t)){const a=fg(e,t);cc(a.length>0,"Sending zero length transaction queue");a.every(e=>0===e.status)&&function(e,t,a){const n=a.map(e=>e.currentWriteId),i=ug(e,t,n);let s=i;const o=i.hash();for(let c=0;c<a.length;c++){const e=a[c];cc(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const n=$h(t,e.path);s=s.updateChild(n,e.currentOutputSnapshotRaw)}const r=s.val(!0),l=t;e.server_.put(l.toString(),r,n=>{dg(e,"transaction put response",{path:l.toString(),status:n});let i=[];if("ok"===n){const n=[];for(let t=0;t<a.length;t++)a[t].status=2,i=i.concat(df(e.serverSyncTree_,a[t].currentWriteId)),a[t].onComplete&&n.push(()=>a[t].onComplete(null,!0,a[t].currentOutputSnapshotResolved)),a[t].unwatcher();vg(e,Df(e.transactionQueueTree_,t)),hg(e,e.transactionQueueTree_),Zf(e.eventQueue_,t,i);for(let e=0;e<n.length;e++)oh(n[e])}else{if("datastale"===n)for(let e=0;e<a.length;e++)3===a[e].status?a[e].status=4:a[e].status=0;else{Gu("transaction at "+l.toString()+" failed: "+n);for(let e=0;e<a.length;e++)a[e].status=4,a[e].abortReason=n}pg(e,t)}},o)}(e,Bf(t),a)}else Of(t)&&Ff(t,t=>{hg(e,t)})}function pg(e,t){const a=mg(e,t),n=Bf(a);return function(e,t,a){if(0===t.length)return;const n=[];let i=[];const s=t.filter(e=>0===e.status),o=s.map(e=>e.currentWriteId);for(let r=0;r<t.length;r++){const s=t[r],l=$h(a,s.path);let c,d=!1;if(cc(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===s.status)d=!0,c=s.abortReason,i=i.concat(df(e.serverSyncTree_,s.currentWriteId,!0));else if(0===s.status)if(s.retryCount>=25)d=!0,c="maxretry",i=i.concat(df(e.serverSyncTree_,s.currentWriteId,!0));else{const a=ug(e,s.path,o);s.currentInputSnapshot=a;const n=t[r].update(a.val());if(void 0!==n){Hf("transaction failed: Data returned ",n,s.path);let t=Ep(n);"object"==typeof n&&null!=n&&jc(n,".priority")||(t=t.updatePriority(a.getPriority()));const r=s.currentWriteId,l=ig(e),c=Af(t,a,l);s.currentOutputSnapshotRaw=t,s.currentOutputSnapshotResolved=c,s.currentWriteId=lg(e),o.splice(o.indexOf(r),1),i=i.concat(cf(e.serverSyncTree_,s.path,c,s.currentWriteId,s.applyLocally)),i=i.concat(df(e.serverSyncTree_,r,!0))}else d=!0,c="nodata",i=i.concat(df(e.serverSyncTree_,s.currentWriteId,!0))}Zf(e.eventQueue_,a,i),i=[],d&&(t[r].status=2,function(e){setTimeout(e,Math.floor(0))}(t[r].unwatcher),t[r].onComplete&&("nodata"===c?n.push(()=>t[r].onComplete(null,!1,t[r].currentInputSnapshot)):n.push(()=>t[r].onComplete(new Error(c),!1,null))))}vg(e,e.transactionQueueTree_);for(let r=0;r<n.length;r++)oh(n[r]);hg(e,e.transactionQueueTree_)}(e,fg(e,a),n),n}function mg(e,t){let a,n=e.transactionQueueTree_;for(a=Mh(t);null!==a&&void 0===Mf(n);)n=Df(n,a),a=Mh(t=Oh(t));return n}function fg(e,t){const a=[];return gg(e,t,a),a.sort((e,t)=>e.order-t.order),a}function gg(e,t,a){const n=Mf(t);if(n)for(let i=0;i<n.length;i++)a.push(n[i]);Ff(t,t=>{gg(e,t,a)})}function vg(e,t){const a=Mf(t);if(a){let e=0;for(let t=0;t<a.length;t++)2!==a[t].status&&(a[e]=a[t],e++);a.length=e,Lf(t,a.length>0?a:void 0)}Ff(t,t=>{vg(e,t)})}function bg(e,t){const a=Mf(t);if(a){const n=[];let i=[],s=-1;for(let t=0;t<a.length;t++)3===a[t].status||(1===a[t].status?(cc(s===t-1,"All SENT items should be at beginning of queue."),s=t,a[t].status=3,a[t].abortReason="set"):(cc(0===a[t].status,"Unexpected transaction status in abort"),a[t].unwatcher(),i=i.concat(df(e.serverSyncTree_,a[t].currentWriteId,!0)),a[t].onComplete&&n.push(a[t].onComplete.bind(null,new Error("set"),!1,null))));-1===s?Lf(t,void 0):a.length=s+1,Zf(e.eventQueue_,Bf(t),i);for(let e=0;e<n.length;e++)oh(n[e])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wg=function(e,t){const a=yg(e),n=a.namespace;"firebase.com"===a.domain&&Hu(a.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===a.domain||Hu("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),a.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Gu("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const i="ws"===a.scheme||"wss"===a.scheme;return{repoInfo:new fh(a.host,a.secure,n,i,t,"",n!==a.subdomain),path:new Rh(a.pathString)}},yg=function(e){let t="",a="",n="",i="",s="",o=!0,r="https",l=443;if("string"==typeof e){let c=e.indexOf("//");c>=0&&(r=e.substring(0,c-1),e=e.substring(c+2));let d=e.indexOf("/");-1===d&&(d=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(d,u)),d<u&&(i=function(e){let t="";const a=e.split("/");for(let i=0;i<a.length;i++)if(a[i].length>0){let e=a[i];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(n){}t+="/"+e}return t}(e.substring(d,u)));const h=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const a of e.split("&")){if(0===a.length)continue;const n=a.split("=");2===n.length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Gu(`Invalid query segment '${a}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));c=t.indexOf(":"),c>=0?(o="https"===r||"wss"===r,l=parseInt(t.substring(c+1),10)):c=t.length;const p=t.slice(0,c);if("localhost"===p.toLowerCase())a="localhost";else if(p.split(".").length<=2)a=p;else{const e=t.indexOf(".");n=t.substring(0,e).toLowerCase(),a=t.substring(e+1),s=n}"ns"in h&&(s=h.ns)}return{host:t,port:l,domain:a,subdomain:n,secure:o,scheme:r,pathString:i,namespace:s}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class _g{constructor(e,t,a,n){this.eventType=e,this.eventRegistration=t,this.snapshot=a,this.prevName=n}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Bc(this.snapshot.exportVal())}}class Cg{constructor(e,t,a){this.eventRegistration=e,this.error=t,this.path=a}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kg{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return cc(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg{constructor(e,t,a,n){this._repo=e,this._path=t,this._queryParams=a,this._orderByCalled=n}get key(){return jh(this._path)?null:Fh(this._path)}get ref(){return new Sg(this._repo,this._path)}get _queryIdentifier(){const e=Op(this._queryParams),t=eh(e);return"{}"===t?"default":t}get _queryObject(){return Op(this._queryParams)}isEqual(e){if(!((e=Qc(e))instanceof Eg))return!1;const t=this._repo===e._repo,a=zh(this._path,e._path),n=this._queryIdentifier===e._queryIdentifier;return t&&a&&n}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let a=e.pieceNum_;a<e.pieces_.length;a++)""!==e.pieces_[a]&&(t+="/"+encodeURIComponent(String(e.pieces_[a])));return t||"/"}(this._path)}}class Sg extends Eg{constructor(e,t){super(e,t,new Mp,!1)}get parent(){const e=Bh(this._path);return null===e?null:new Sg(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Tg{constructor(e,t,a){this._node=e,this.ref=t,this._index=a}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Rh(e),a=Ng(this.ref,e);return new Tg(this._node.getChild(t),a,mp)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,(t,a)=>e(new Tg(a,Ng(this.ref,t),mp)))}hasChild(e){const t=new Rh(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Ig(e,t){return(e=Qc(e))._checkNotDeleted("ref"),void 0!==t?Ng(e._root,t):e._root}function Ng(e,t){var a,n,i;return null===Mh((e=Qc(e))._path)?(a="child",n="path",(i=t)&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),Gf(a,n,i)):Gf("child","path",t),new Sg(e._repo,qh(e._path,t))}class xg{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const a=t._queryParams.getIndex();return new _g("value",this,new Tg(e.snapshotNode,new Sg(t._repo,t._path),a))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Cg(this,e,t):null}matches(e){return e instanceof xg&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}function Ag(e,t,a,n,i){let s;if("object"==typeof n&&(s=void 0,i=n),"function"==typeof n&&(s=n),i&&i.onlyOnce){const t=a,n=(a,n)=>{cg(e._repo,e,r),t(a,n)};n.userCallback=a.userCallback,n.context=a.context,a=n}const o=new kg(a,s||void 0),r=new xg(o);return function(e,t,a){let n;n=".info"===Mh(t._path)?pf(e.infoSyncTree_,t,a):pf(e.serverSyncTree_,t,a),Jf(e.eventQueue_,t._path,n)}(e._repo,e,r),()=>cg(e._repo,e,r)}function Pg(e,t,a,n){return Ag(e,0,t,a,n)}!function(e){cc(!Ym,"__referenceConstructor has already been defined"),Ym=e}(Sg),function(e){cc(!Km,"__referenceConstructor has already been defined"),Km=e}(Sg);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Rg={};let Dg=!1;function Mg(e,t,a,n,i){let s=n||e.options.databaseURL;void 0===s&&(e.options.projectId||Hu("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),zu("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,r=wg(s,i),l=r.repoInfo;"undefined"!=typeof process&&Iu&&(o=Iu.FIREBASE_DATABASE_EMULATOR_HOST),o?(s=`http://${o}?ns=${l.namespace}`,r=wg(s,i),l=r.repoInfo):r.repoInfo.secure;const c=new ch(e.name,e.options,t);Yf("Invalid Firebase Database URL",r),jh(r.path)||Hu("Database URL must point to the root of a Firebase Database (not including a child path).");const d=function(e,t,a,n){let i=Rg[t.name];i||(i={},Rg[t.name]=i);let s=i[e.toURLString()];s&&Hu("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new tg(e,Dg,a,n),i[e.toURLString()]=s,s}(l,e,c,new lh(e,a));return new Lg(d,e)}class Lg{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(ag(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Sg(this._repo,Dh())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const a=Rg[t];a&&a[e.key]===e||Hu(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete a[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Hu("Cannot call "+e+" on a deleted database.")}}function Og(e,t,a,n={}){(e=Qc(e))._checkNotDeleted("useEmulator");const i=`${t}:${a}`,s=e._repoInternal;if(e._instanceStarted){if(i===e._repoInternal.repoInfo_.host&&Wc(n,s.repoInfo_.emulatorOptions))return;Hu("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)n.mockUserToken&&Hu('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new dh(dh.OWNER);else if(n.mockUserToken){const t="string"==typeof n.mockUserToken?n.mockUserToken:Ic(n.mockUserToken,e.app.options.projectId);o=new dh(t)}Sc(t)&&(Tc(t),Ac("Database",!0)),function(e,t,a,n){const i=t.lastIndexOf(":"),s=Sc(t.substring(0,i));e.repoInfo_=new fh(t,s,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,a),n&&(e.authTokenProvider_=n)}(s,i,n,o)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Qh.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Qh.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},function(e){Pu(pu),lu(new Jc("database",(e,{instanceIdentifier:t})=>Mg(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),gu(Nu,xu,e),gu(Nu,xu,"esm2020")}();const Fg=Object.freeze(Object.defineProperty({__proto__:null,DataSnapshot:Tg,Database:Lg,_QueryImpl:Eg,_QueryParams:Mp,_ReferenceImpl:Sg,_repoManagerDatabaseFromApp:Mg,_setSDKVersion:Pu,_validatePathString:Gf,child:Ng,connectDatabaseEmulator:Og,getDatabase:function(e=fu(),t){const a=cu(e,"database").getImmediate({identifier:t});if(!a._instanceStarted){const e=Cc("database");e&&Og(a,...e)}return a},onValue:Pg,ref:Ig},Symbol.toStringTag,{value:"Module"}));let Ug,Bg;async function qg(){if(Bg)return Bg;const{getDatabase:e}=await W(async()=>{const{getDatabase:e}=await Promise.resolve().then(()=>Fg);return{getDatabase:e}},void 0),t=Ug||await(Ug||Ha.initializeFirebaseApp().then(e=>(Ug=null==e?void 0:e.app,Ug)));if(!t)throw new Error("Firebase app no inicializada");return Bg=e(t),Bg}class jg{constructor(e){this.waiterId=e,this.listeners=new Map,this.activeCalls=new Map,this.db=null,this.initializing=!1,this._expectedInitialCallIds=new Set,this._initialSetProcessed=!1}async startListening(){if(!this.db)try{this.db=await qg()}catch(t){return void console.error("❌ No se pudo obtener instancia Realtime DB:",t)}const e=Pg(Ig(this.db,`waiters/${this.waiterId}/active_calls`),e=>{const t=e.val()||[];console.log("📋 UNIFIED: Llamadas activas del mozo:",t),console.log("📋 UNIFIED: waiterId:",this.waiterId),console.log("📋 UNIFIED: Firebase path:",`waiters/${this.waiterId}/active_calls`),this.initializing&&!this._initialSetProcessed&&(this._expectedInitialCallIds=new Set(t.map(e=>String(e))),0===this._expectedInitialCallIds.size&&(this.initializing=!1,this._initialSetProcessed=!0)),this.updateActiveCallsListeners(t)},e=>{console.error("🚨 Error en UNIFIED listener:",e),this.handleError(e)});this.initializing=!0,this.listeners.set("waiter",e),console.log(`⚡ UNIFIED WebSocket conectado para mozo ${this.waiterId}`)}updateActiveCallsListeners(e){Array.from(this.activeCalls.keys()).forEach(t=>{e.includes(t)||(this.removeCallListener(t),this.onCallRemoved(t))}),e.forEach(e=>{this.activeCalls.has(e)||this.addCallListener(e)})}addCallListener(e){if(!this.db)return;const t=Pg(Ig(this.db,`active_calls/${e}`),t=>{const a=t.val();if(a){const t=!this.activeCalls.has(e);this.activeCalls.set(e,a);const n=this.normalizeCallData(a);t?this.onNewCall(n):this.onCallUpdated(n),"acknowledged"!==a.status&&"completed"!==a.status||setTimeout(()=>{this.onCallMovedToHistory(e,n)},400),this.initializing&&!this._initialSetProcessed&&(this._expectedInitialCallIds.has(String(e))&&this._expectedInitialCallIds.delete(String(e)),0===this._expectedInitialCallIds.size&&(this.initializing=!1,this._initialSetProcessed=!0))}});this.listeners.set(`call_${e}`,t)}removeCallListener(e){const t=`call_${e}`;if(this.listeners.has(t)){this.listeners.get(t)(),this.listeners.delete(t)}this.activeCalls.delete(e)}onNewCall(e){console.debug("⚡ UNIFIED: Nueva llamada:",e.id,e);"pending"===e.status?(window.dispatchEvent(new CustomEvent("newWaiterCall",{detail:e})),window.dispatchEvent(new CustomEvent("ultraFastAddCall",{detail:e})),this.initializing||(this.playUltraFastSound(),this.vibrateUltraFast(),this.scheduleNativeNotification(e),this.showBrowserNotification(e)),this.logStatus(e,"pending")):this.onCallMovedToHistory(e.id,e)}onCallUpdated(e){"acknowledged"===e.status&&(this.showStatusUpdate(`Mesa ${e.table_number} - Atendiendo`),this.logStatus(e,"acknowledged")),window.dispatchEvent(new CustomEvent("updateCallStatus",{detail:e}))}onCallRemoved(e){this.showStatusUpdate("Servicio completado"),window.dispatchEvent(new CustomEvent("removeCall",{detail:{callId:e}}))}onCallMovedToHistory(e,t){let a="";switch(t.status){case"acknowledged":a=`Mesa ${t.table_number} - Atendiendo`;break;case"completed":a=`Mesa ${t.table_number} - Completado`;break;default:a=`Mesa ${t.table_number} - Actualizado`}this.showStatusUpdate(a),window.dispatchEvent(new CustomEvent("removeCall",{detail:{callId:e}})),window.dispatchEvent(new CustomEvent("callMovedToHistory",{detail:{callId:e,callData:t,status:t.status}})),"acknowledged"===t.status?this.logStatus(t,"acknowledged"):"completed"===t.status&&this.logStatus(t,"completed")}logStatus(e,t){try{if(!e||!e.id)return;switch(t){case"pending":console.info("[UNIFIED][PENDING]",`id=${e.id}`,`mesa=${e.table_number}`,`t=${e.called_at}`);break;case"acknowledged":console.info("[UNIFIED][ACKNOWLEDGED]",`id=${e.id}`,`mesa=${e.table_number}`,`ack=${e.acknowledged_at}`);break;case"completed":console.info("[UNIFIED][COMPLETED]",`id=${e.id}`,`mesa=${e.table_number}`,`comp=${e.completed_at}`)}}catch(a){}}normalizeCallData(e){var t,a;return{id:e.id,table_number:(null==(t=e.table)?void 0:t.number)||e.table_number,message:e.message||"Cliente solicita atención",urgency:e.urgency||"normal",status:e.status,called_at:e.called_at,acknowledged_at:e.acknowledged_at,completed_at:e.completed_at,timestamp:e.called_at,waiter_id:(null==(a=e.waiter)?void 0:a.id)||this.waiterId,table:e.table,waiter:e.waiter}}scheduleNativeNotification(e){try{J&&J.isPluginAvailable&&J.isPluginAvailable("LocalNotifications")&&W(async()=>{const{LocalNotifications:e}=await import("./index-B_qQR_LU.js");return{LocalNotifications:e}},__vite__mapDeps([7,1,2])).then(({LocalNotifications:t})=>{t.schedule({notifications:[{title:`Mesa ${e.table_number} · ${e.urgency?e.urgency.toUpperCase():""}`,body:e.message||"Solicita atención",id:Number(Date.now()%1e5),extra:{callId:e.id,source:"unified-realtime"},schedule:null,smallIcon:void 0}]}).then(()=>{}).catch(e=>console.warn("⚠️ Error scheduling local notification:",e))}).catch(e=>{console.warn("⚠️ Error importing LocalNotifications:",e)})}catch(t){console.warn("⚠️ Exception scheduling native notification:",t)}}showBrowserNotification(e){try{if("undefined"==typeof Notification)return;if("granted"!==Notification.permission)return;const t=new Notification(`⚡ Mesa ${e.table_number}`,{body:`${e.message||"Solicita atención"} (UNIFIED)`,icon:"/favicon.ico",tag:`unified-call-${e.id}`,requireInteraction:!0});t.onclick=()=>{window.focus(),t.close()}}catch(t){}}playUltraFastSound(){try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),a=e.createGain();t.connect(a),a.connect(e.destination),t.frequency.setValueAtTime(800,e.currentTime),t.frequency.setValueAtTime(400,e.currentTime+.1),a.gain.setValueAtTime(.3,e.currentTime),a.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),t.start(e.currentTime),t.stop(e.currentTime+.3)}catch(e){const t=new Audio;t.src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+nfvnUjBjd+zO/eizEIDGKw5+mqWRMJRZzp4b5+JgU2jdXzzX4tBSF1xe/ejzQIElyx6OyrYRYJSKXi67RiHAY8k9nyyXkpBSR+zO/ijDEIDWOz6OyrXRQIR6Hn4L55KAU5jNTx0IAvBh1qtOnnqlkSCUig5OqyYhsGPJHY8sp7KgUle8vt3o4yBxFYr+ftrWIaBjeL0/LNfjAGIn3M7+CNMA==",t.volume=.7,t.play().catch(e=>{})}}vibrateUltraFast(){navigator.vibrate&&navigator.vibrate([100,50,100,50,200])}showStatusUpdate(e){const t=document.createElement("div");t.className="status-update",t.textContent=`⚡ ${e}`,document.body.appendChild(t),setTimeout(()=>t.classList.add("show"),10),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>t.remove(),200)},2e3)}async acknowledgeCall(e){try{const a=localStorage.getItem("token");let n=null;try{const t=await W(()=>Promise.resolve().then(()=>oc),void 0),a=t&&(t.default||t);if(a&&"function"==typeof a.acknowledgCall)n=await a.acknowledgCall(e);else{if(!a||"function"!=typeof a.acknowledgeCall)throw new Error("No acknowledge helper found");n=await a.acknowledgeCall(e)}}catch(t){n=await fetch(`https://mozoqr.com/api/waiter/calls/${e}/acknowledge`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}})}let i=!1;if(n&&"boolean"==typeof n.ok?i=n.ok:n&&"boolean"==typeof n.success?i=!1!==n.success:n&&(i=!0),!i){const e=n&&(n.status||n.code||"unknown");throw new Error(`Acknowledge failed: ${e}`)}window.dispatchEvent(new CustomEvent("callAcknowledged",{detail:{callId:e}}))}catch(a){console.error("UNIFIED: Error reconociendo llamada:",a),this.showError("Error al reconocer la llamada")}}async completeCall(e){try{const a=localStorage.getItem("token");let n=null;try{const t=await W(()=>Promise.resolve().then(()=>oc),void 0),a=t&&(t.default||t);if(a&&"function"==typeof a.completeCall)n=await a.completeCall(e);else{if(!a||"function"!=typeof a.complete)throw new Error("No complete helper found");n=await a.complete(e)}}catch(t){n=await fetch(`https://mozoqr.com/api/waiter/calls/${e}/complete`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}})}let i=!1;if(n&&"boolean"==typeof n.ok?i=n.ok:n&&"boolean"==typeof n.success?i=!1!==n.success:n&&(i=!0),!i){const e=n&&(n.status||n.code||"unknown");throw new Error(`Complete failed: ${e}`)}console.log("⚡ UNIFIED: Llamada completada"),window.dispatchEvent(new CustomEvent("removeCall",{detail:{callId:e}}));try{const{useNotificationsStore:t}=await W(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>rr);return{useNotificationsStore:e}},void 0);t().removeNotification(e)}catch(t){console.warn("⚠️ Unable to remove notification from store:",t)}}catch(a){console.error("UNIFIED: Error completando llamada:",a),this.showError("Error al completar la llamada")}}stopListening(){this.listeners.forEach(e=>{e()}),this.listeners.clear(),this.activeCalls.clear(),console.log("🛑 UNIFIED listener detenido")}async createTestCall(){console.log("🧪 UNIFIED: Creando llamada de prueba...");try{(await fetch("https://mozoqr.com/api/tables/1/call-waiter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Llamada de prueba UNIFIED",urgency:"high"})})).ok&&console.log("✅ UNIFIED: Llamada de prueba creada")}catch(e){console.error("❌ UNIFIED: Error creando llamada de prueba:",e)}}handleError(e){console.error("🚨 UNIFIED: Error en listener:",e),this.showError("Error de conexión en tiempo real")}showError(e){const t=document.createElement("div");t.className="ultra-fast-error",t.innerHTML=`\n            <p>❌ ${e}</p>\n            <p>Reintentando automáticamente...</p>\n            <button onclick="this.remove()">Cerrar</button>\n        `,document.body.appendChild(t),setTimeout(()=>{t.parentElement&&t.remove()},5e3),setTimeout(()=>{this.startListening()},2e3)}}window.addEventListener("beforeunload",()=>{window.unifiedNotifications&&window.unifiedNotifications.stopListening()});const $g={class:"modal-header"},zg={class:"modal-body"},Vg={key:0,class:"loading-state"},Wg={key:1},Hg={key:0,class:"selection-summary"},Gg={class:"tables-grid"},Yg=["onClick"],Kg={class:"table-checkbox"},Qg=["checked","onChange"],Jg={class:"table-info"},Zg={class:"table-number"},Xg={key:0,class:"table-name"},ev={class:"table-details"},tv={key:0},av={key:1},nv={key:0,class:"empty-state"},iv={key:1,class:"quick-actions"},sv={class:"modal-footer"},ov=["disabled"],rv={__name:"TableSelector",props:{availableTables:{type:Array,default:()=>[]},assignedTables:{type:Array,default:()=>[]}},emits:["close","tables-selected"],setup(e,{emit:t}){const a=e,n=t,o=i([]),l=i(!1),b=s(()=>a.availableTables||[]),w=e=>{const t=o.value.indexOf(e);-1===t?o.value.push(e):o.value.splice(t,1)},_=()=>{o.value=b.value.map(e=>e.id)},C=()=>{o.value=[]},k=()=>{console.log("🎯 TableSelector: Confirmando selección de mesas:",o.value),n("tables-selected",o.value)};return r(()=>{console.log("🏠 TableSelector mounted"),console.log("📋 Mesas disponibles recibidas:",a.availableTables),console.log("📋 Mesas asignadas recibidas:",a.assignedTables),console.log("Available tables:",b.value),console.log("Assigned tables:",a.assignedTables)}),(e,t)=>(d(),c("div",{class:"modal-overlay",onClick:t[4]||(t[4]=t=>e.$emit("close"))},[u("div",{class:"modal-content",onClick:t[3]||(t[3]=f(()=>{},["stop"]))},[u("div",$g,[t[6]||(t[6]=u("h3",null,[u("i",{class:"fas fa-table"}),y(" Seleccionar Mesas para Activar ")],-1)),u("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},t[5]||(t[5]=[u("i",{class:"fas fa-times"},null,-1)]))]),u("div",zg,[l.value?(d(),c("div",Vg,t[7]||(t[7]=[u("div",{class:"spinner"},null,-1),u("p",null,"Cargando mesas disponibles...",-1)]))):(d(),c("div",Wg,[o.value.length>0?(d(),c("div",Hg,[u("strong",null,p(o.value.length)+" mesa(s) seleccionada(s)",1)])):h("",!0),u("div",Gg,[(d(!0),c(g,null,v(b.value,e=>(d(),c("div",{key:e.id,class:m(["table-card",{selected:o.value.includes(e.id)}]),onClick:t=>w(e.id)},[u("div",Kg,[u("input",{type:"checkbox",checked:o.value.includes(e.id),onClick:t[1]||(t[1]=f(()=>{},["stop"])),onChange:t=>w(e.id)},null,40,Qg)]),u("div",Jg,[u("div",Zg,"Mesa "+p(e.number),1),e.name&&e.name!==`Mesa ${e.number}`?(d(),c("div",Xg,p(e.name),1)):h("",!0),u("div",ev,[e.capacity?(d(),c("span",tv,[t[8]||(t[8]=u("i",{class:"fas fa-users"},null,-1)),y(" "+p(e.capacity)+" personas ",1)])):h("",!0),e.location?(d(),c("span",av,[t[9]||(t[9]=u("i",{class:"fas fa-map-marker-alt"},null,-1)),y(" "+p(e.location),1)])):h("",!0)])])],10,Yg))),128)),0===b.value.length?(d(),c("div",nv,t[10]||(t[10]=[u("i",{class:"fas fa-table"},null,-1),u("p",null,"No hay mesas disponibles para activar",-1),u("small",null,"Todas las mesas ya están asignadas a otros mozos",-1)]))):h("",!0)]),b.value.length>0?(d(),c("div",iv,[u("button",{onClick:_,class:"quick-btn"},[t[11]||(t[11]=u("i",{class:"fas fa-check-double"},null,-1)),y(" Seleccionar Todas ("+p(b.value.length)+") ",1)]),o.value.length>0?(d(),c("button",{key:0,onClick:C,class:"quick-btn"},t[12]||(t[12]=[u("i",{class:"fas fa-times"},null,-1),y(" Deseleccionar Todas ")]))):h("",!0)])):h("",!0)]))]),u("div",sv,[u("button",{onClick:t[2]||(t[2]=t=>e.$emit("close")),class:"btn btn-secondary"}," Cancelar "),u("button",{onClick:k,class:"btn btn-primary",disabled:0===o.value.length||l.value},[t[13]||(t[13]=u("i",{class:"fas fa-check"},null,-1)),y(" Activar "+p(o.value.length)+" Mesa(s) ",1)],8,ov)])])]))}},lv=lr(rv,[["__scopeId","data-v-f6fe2c8a"]]),cv={class:"business-selector"},dv={key:0,class:"business-dropdown"},uv={class:"business-details"},hv={class:"business-name"},pv={class:"business-subtitle"},mv={class:"dropdown-arrow"},fv={key:0,class:"dropdown-menu"},gv={class:"dropdown-header"},vv={class:"businesses-list"},bv=["onClick"],wv={class:"business-info"},yv={class:"business-name"},_v={class:"business-address"},Cv={key:0,class:"current-indicator"},kv={class:"dropdown-footer"},Ev={key:1,class:"no-business-state"},Sv={class:"no-business-content"},Tv={class:"modal-content"},Iv={class:"modal-body"},Nv={class:"form-group"},xv=["disabled"],Av={class:"modal-footer"},Pv=["disabled"],Rv=["disabled"],Dv={key:0,class:"fas fa-spinner fa-spin"},Mv={key:1},Lv={__name:"BusinessSelector",emits:["business-changed","businesses-loaded"],setup(e,{expose:t,emit:a}){const n=a,s=i([]),o=i(null),b=i(!1),w=i(!1),_=i(""),C=i(!1),k=i(!1),E=async()=>{k.value=!0;try{const e=await sc.getWaiterBusinesses();e.success?(s.value=e.businesses||[],e.active_business_id&&s.value.length>0?o.value=s.value.find(t=>t.id===e.active_business_id)||null:o.value=e.active_business||null,n("businesses-loaded",{businesses:s.value,activeBusiness:o.value,needsBusiness:e.needs_business||0===s.value.length})):(console.error("❌ Error en respuesta de negocios:",e.message),ir(e.message||"Error cargando negocios"))}catch(e){console.error("💥 Error loading businesses:",e),ir("Error cargando negocios")}finally{k.value=!1}},S=async()=>{if(_.value.trim()){C.value=!0;try{const e=await sc.joinBusinessWithCode(_.value.trim());e.success?(nr(e.message||"Te has unido al negocio exitosamente"),_.value="",T(),await E()):ir(e.message||"Error uniéndose al negocio")}catch(e){console.error("Error joining business:",e),ir("Error uniéndose al negocio")}finally{C.value=!1}}},T=()=>{w.value=!1,_.value="",C.value=!1},x=e=>{e.target.closest(".business-dropdown")||(b.value=!1)};return r(async()=>{await E(),document.addEventListener("click",x)}),l(()=>{document.removeEventListener("click",x)}),t({loadBusinesses:E,getCurrentBusiness:()=>o.value}),(e,t)=>{var a;return d(),c("div",cv,[s.value.length>0?(d(),c("div",dv,[u("div",{class:"current-business",onClick:t[0]||(t[0]=e=>b.value=!b.value)},[t[5]||(t[5]=u("div",{class:"business-icon"},[u("i",{class:"fas fa-building"})],-1)),u("div",uv,[u("div",hv,p((null==(a=o.value)?void 0:a.name)||"Seleccionar Negocio"),1),u("div",pv,p(s.value.length)+" negocio"+p(1!==s.value.length?"s":""),1)]),u("div",mv,[u("i",{class:m(["fas fa-chevron-down",{rotated:b.value}])},null,2)])]),b.value?(d(),c("div",fv,[u("div",gv,[t[7]||(t[7]=u("h4",null,"Mis Negocios",-1)),u("button",{onClick:t[1]||(t[1]=e=>b.value=!1),class:"close-btn"},t[6]||(t[6]=[u("i",{class:"fas fa-times"},null,-1)]))]),u("div",vv,[(d(!0),c(g,null,v(s.value,e=>{var a,i;return d(),c("button",{key:e.id,onClick:t=>(async e=>{try{const t=await sc.setActiveWaiterBusiness(e.id);t.success?(o.value=e,b.value=!1,nr(`Negocio "${e.name}" seleccionado`),n("business-changed",e)):ir(t.message||"Error seleccionando negocio")}catch(t){console.error("Error selecting business:",t),ir("Error seleccionando negocio")}})(e),class:m(["business-item",{active:(null==(a=o.value)?void 0:a.id)===e.id}])},[u("div",wv,[u("div",yv,p(e.name),1),u("div",_v,p(e.address||"Sin dirección"),1)]),(null==(i=o.value)?void 0:i.id)===e.id?(d(),c("div",Cv,t[8]||(t[8]=[u("i",{class:"fas fa-check"},null,-1)]))):h("",!0)],10,bv)}),128))]),u("div",kv,[u("button",{onClick:t[2]||(t[2]=e=>{w.value=!0,b.value=!1}),class:"join-btn"},t[9]||(t[9]=[u("i",{class:"fas fa-plus"},null,-1),y(" Unirse a nuevo negocio ")]))])])):h("",!0)])):(d(),c("div",Ev,[u("div",Sv,[t[11]||(t[11]=u("i",{class:"fas fa-building"},null,-1)),t[12]||(t[12]=u("h3",null,"Sin negocios asignados",-1)),t[13]||(t[13]=u("p",null,"Necesitas unirte a un negocio para empezar a trabajar",-1)),u("button",{onClick:t[3]||(t[3]=e=>w.value=!0),class:"join-btn primary"},t[10]||(t[10]=[u("i",{class:"fas fa-plus"},null,-1),y(" Unirse a negocio ")]))])])),w.value?(d(),c("div",{key:2,class:"modal-overlay",onClick:f(T,["self"])},[u("div",Tv,[u("div",{class:"modal-header"},[t[15]||(t[15]=u("h3",null,"Unirse a negocio",-1)),u("button",{onClick:T,class:"close-btn"},t[14]||(t[14]=[u("i",{class:"fas fa-times"},null,-1)]))]),u("div",Iv,[t[17]||(t[17]=u("p",null,"Ingresa el código del negocio al que deseas unirte:",-1)),u("form",{onSubmit:f(S,["prevent"])},[u("div",Nv,[t[16]||(t[16]=u("label",{for:"businessCode"},"Código del negocio:",-1)),I(u("input",{id:"businessCode","onUpdate:modelValue":t[4]||(t[4]=e=>_.value=e),type:"text",class:"form-input",placeholder:"Ej: ABC123",disabled:C.value,required:""},null,8,xv),[[N,_.value]])])],32)]),u("div",Av,[u("button",{onClick:T,class:"btn btn-secondary",disabled:C.value}," Cancelar ",8,Pv),u("button",{onClick:S,class:"btn btn-primary",disabled:C.value||!_.value.trim()},[C.value?(d(),c("i",Dv)):(d(),c("span",Mv,"Unirse"))],8,Rv)])])])):h("",!0)])}}},Ov=lr(Lv,[["__scopeId","data-v-5b8ddc75"]]),Fv={class:"business-tables-manager"},Uv={class:"manager-header"},Bv={class:"manager-stats"},qv={class:"stat-item"},jv={class:"stat-number"},$v={class:"stat-item success"},zv={class:"stat-number"},Vv={class:"stat-item warning"},Wv={class:"stat-number"},Hv={class:"stat-item danger"},Gv={class:"stat-number"},Yv={class:"tables-container"},Kv={key:0,class:"loading-state"},Qv={key:1,class:"tables-grid"},Jv={class:"table-header"},Zv={class:"table-number"},Xv={class:"table-status"},eb={key:0,class:"fas fa-exclamation-triangle status-icon urgent",title:"Tiene llamadas pendientes"},tb={key:1,class:"fas fa-volume-mute status-icon silenced",title:"Silenciada"},ab={key:2,class:"fas fa-check status-icon active",title:"Activa y asignada"},nb={key:3,class:"fas fa-ban status-icon silenced",title:"Mesa silenciada"},ib={key:4,class:"fas fa-circle status-icon available",title:"Disponible"},sb={class:"table-info"},ob={key:0,class:"table-name"},rb={class:"table-details"},lb={key:0},cb={key:1},db={key:1,class:"assigned-waiter"},ub={class:"table-actions"},hb=["onClick"],pb=["onClick"],mb=["onClick"],fb=["onClick"],gb={key:2,class:"no-actions"},vb={key:0},bb={key:1},wb={key:0,class:"empty-state"},yb={class:"quick-actions"},_b=["disabled"],Cb=lr({__name:"BusinessTablesManager",props:{businessId:{type:[String,Number],required:!0},businessName:{type:String,default:"Negocio"}},emits:["tables-updated"],setup(e,{expose:t,emit:a}){const n=e,o=a,l=i([]),f=i(!1),b=s(()=>l.value.length),w=s(()=>l.value.filter(e=>e.assigned_to_me).length),_=s(()=>l.value.filter(e=>!e.assigned_to_me&&!e.is_silenced).length),C=s(()=>l.value.filter(e=>e.is_silenced).length),k=s(()=>l.value.filter(e=>e.assigned_to_me)),E=s(()=>l.value.filter(e=>!e.assigned_to_me&&!e.is_silenced)),S=async()=>{f.value=!0,console.log("🏢 Cargando mesas del negocio:",n.businessId);try{const e=await sc.getWaiterBusinessTables(n.businessId);console.log("📋 Respuesta de mesas del negocio:",e),e.success?(l.value=e.tables||[],console.log("✅ Mesas cargadas:",l.value.length,l.value),l.value.forEach((e,t)=>{t<3&&console.log(`🔍 Mesa ${e.number}:`,{id:e.id,assigned_to_me:e.assigned_to_me,is_silenced:e.is_silenced,assigned_waiter:e.assigned_waiter})}),console.log("📊 Estadísticas calculadas:"),console.log("  - Total mesas:",l.value.length),console.log("  - Asignadas a mí:",l.value.filter(e=>e.assigned_to_me).length),console.log("  - Disponibles:",l.value.filter(e=>!e.assigned_to_me&&!e.is_silenced).length),console.log("  - Silenciadas:",l.value.filter(e=>e.is_silenced).length),o("tables-updated",l.value)):(console.error("❌ Error en respuesta:",e.message),ir(e.message||"Error cargando mesas del negocio"))}catch(e){console.error("💥 Error loading business tables:",e),ir("Error cargando mesas del negocio")}finally{f.value=!1}},T=async()=>{await S()},I=async()=>{var e;const t=E.value;if(0!==t.length)try{if(await sr("¿Tomar todas las mesas disponibles?",`Se asignarán ${t.length} mesas a tu cuenta.`,"Tomar todas","Cancelar","info")){const a=t.map(e=>e.id),n=await sc.activateMultipleTables(a);n.success?(nr(`${(null==(e=n.summary)?void 0:e.successful)||t.length} mesas asignadas`),await S()):ir(n.message||"Error asignando mesas")}}catch(a){console.error("Error activating multiple tables:",a),ir("Error asignando mesas múltiples")}},N=async()=>{var e;const t=k.value;if(0!==t.length)try{if(await sr("¿Desasignarte de todas las mesas?",`Se desasignarán ${t.length} mesas de tu cuenta.`,"Desasignar todas","Cancelar","warning")){const a=t.map(e=>e.id),n=await sc.deactivateMultipleTables(a);n.success?(nr(`${(null==(e=n.summary)?void 0:e.successful)||t.length} mesas desasignadas`),await S()):ir(n.message||"Error desasignando mesas")}}catch(a){console.error("Error deactivating multiple tables:",a),ir("Error desasignando mesas múltiples")}};return r(()=>{console.log("🏢 BusinessTablesManager mounted with businessId:",n.businessId),S()}),t({loadBusinessTables:S,refreshTables:T}),(t,a)=>(d(),c("div",Fv,[u("div",Uv,[u("h3",null,[a[0]||(a[0]=u("i",{class:"fas fa-table"},null,-1)),y(" Mesas de "+p(e.businessName),1)]),u("div",Bv,[u("div",qv,[u("div",jv,p(b.value),1),a[1]||(a[1]=u("div",{class:"stat-label"},"Total mesas",-1))]),u("div",$v,[u("div",zv,p(w.value),1),a[2]||(a[2]=u("div",{class:"stat-label"},"Asignadas a mí",-1))]),u("div",Vv,[u("div",Wv,p(_.value),1),a[3]||(a[3]=u("div",{class:"stat-label"},"Disponibles",-1))]),u("div",Hv,[u("div",Gv,p(C.value),1),a[4]||(a[4]=u("div",{class:"stat-label"},"Silenciadas",-1))])])]),u("div",Yv,[f.value?(d(),c("div",Kv,a[5]||(a[5]=[u("div",{class:"spinner"},null,-1),u("p",null,"Cargando mesas del negocio...",-1)]))):(d(),c("div",Qv,[(d(!0),c(g,null,v(l.value,e=>(d(),c("div",{key:e.id,class:m(["table-card",{assigned:e.assigned_to_me,available:!e.assigned_to_me&&!e.is_silenced,silenced:e.is_silenced,"has-calls":e.pending_calls_count>0}])},[u("div",Jv,[u("div",Zv,"Mesa "+p(e.number),1),u("div",Xv,[e.assigned_to_me&&e.pending_calls_count>0?(d(),c("i",eb)):e.assigned_to_me&&e.is_silenced?(d(),c("i",tb)):e.assigned_to_me?(d(),c("i",ab)):e.is_silenced?(d(),c("i",nb)):(d(),c("i",ib))])]),u("div",sb,[e.name&&e.name!==`Mesa ${e.number}`?(d(),c("div",ob,p(e.name),1)):h("",!0),u("div",rb,[e.capacity?(d(),c("span",lb,[a[6]||(a[6]=u("i",{class:"fas fa-users"},null,-1)),y(" "+p(e.capacity)+" personas ",1)])):h("",!0),e.pending_calls_count>0?(d(),c("span",cb,[a[7]||(a[7]=u("i",{class:"fas fa-bell"},null,-1)),y(" "+p(e.pending_calls_count)+" llamada(s) ",1)])):h("",!0)]),e.assigned_waiter&&!e.assigned_to_me?(d(),c("div",db,[a[8]||(a[8]=u("i",{class:"fas fa-user"},null,-1)),y(" Asignada a: "+p(e.assigned_waiter.name),1)])):h("",!0)]),u("div",ub,[e.assigned_to_me?(d(),c(g,{key:0},[e.is_silenced?(d(),c("button",{key:0,onClick:t=>(async e=>{try{const t=await sc.unsilenceTable(e);t.success?(nr(t.message||"Mesa activada"),await S()):ir(t.message||"Error activando mesa")}catch(t){console.error("Error unsilencing table:",t),ir("Error activando mesa")}})(e.id),class:"action-btn unsilence",title:"Activar mesa"},a[9]||(a[9]=[u("i",{class:"fas fa-volume-up"},null,-1)]),8,hb)):(d(),c("button",{key:1,onClick:t=>(async e=>{try{if(await sr("¿Silenciar mesa?","La mesa no podrá realizar llamadas durante 30 minutos.","Silenciar","Cancelar","warning")){const t=await sc.silenceTable(e,30);t.success?(nr(t.message||"Mesa silenciada"),await S()):ir(t.message||"Error silenciando mesa")}}catch(t){console.error("Error silencing table:",t),ir("Error silenciando mesa")}})(e.id),class:"action-btn silence",title:"Silenciar mesa"},a[10]||(a[10]=[u("i",{class:"fas fa-volume-mute"},null,-1)]),8,pb)),u("button",{onClick:t=>(async e=>{try{if(await sr("¿Desasignarte de esta mesa?","Ya no recibirás llamadas de esta mesa.","Desasignar","Cancelar","warning")){const t=await sc.deactivateTable(e);t.success?(nr(t.message||"Mesa desasignada"),await S()):ir(t.message||"Error desasignando mesa")}}catch(t){console.error("Error deactivating table:",t),ir("Error desasignando mesa")}})(e.id),class:"action-btn deactivate",title:"Desasignarme de esta mesa"},a[11]||(a[11]=[u("i",{class:"fas fa-times"},null,-1)]),8,mb)],64)):e.is_silenced?(d(),c("div",gb,[e.is_silenced?(d(),c("span",vb,"Mesa silenciada")):(d(),c("span",bb,"No disponible"))])):(d(),c("button",{key:1,onClick:t=>(async e=>{console.log("🚀 BusinessTablesManager: Iniciando activación de mesa:",e);try{const t=await sc.activateTable(e);console.log("📊 BusinessTablesManager: Respuesta de activación:",t),t.success?(console.log("✅ BusinessTablesManager: Mesa activada exitosamente"),nr(t.message||"Mesa activada"),console.log("🔄 BusinessTablesManager: Recargando mesas del negocio..."),await S()):(console.error("❌ BusinessTablesManager: Error en respuesta:",t.message),ir(t.message||"Error activando mesa"))}catch(t){console.error("💥 BusinessTablesManager: Error completo activando mesa:",t),ir("Error activando mesa")}})(e.id),class:"action-btn activate",title:"Asignarme esta mesa"},a[12]||(a[12]=[u("i",{class:"fas fa-plus"},null,-1),y(" Tomar ")]),8,fb))])],2))),128)),0===l.value.length?(d(),c("div",wb,a[13]||(a[13]=[u("i",{class:"fas fa-table"},null,-1),u("h4",null,"Sin mesas registradas",-1),u("p",null,"Este negocio no tiene mesas registradas aún.",-1)]))):h("",!0)]))]),u("div",yb,[u("button",{onClick:T,class:"action-btn primary",disabled:f.value},[u("i",{class:m(["fas fa-sync-alt",{"fa-spin":f.value}])},null,2),a[14]||(a[14]=y(" Actualizar "))],8,_b),k.value.length>0?(d(),c("button",{key:0,onClick:N,class:"action-btn danger"},[a[15]||(a[15]=u("i",{class:"fas fa-sign-out-alt"},null,-1)),y(" Desasignarme de todas ("+p(k.value.length)+") ",1)])):h("",!0),E.value.length>0?(d(),c("button",{key:1,onClick:I,class:"action-btn success"},[a[16]||(a[16]=u("i",{class:"fas fa-check-double"},null,-1)),y(" Tomar todas disponibles ("+p(E.value.length)+") ",1)])):h("",!0)])]))}},[["__scopeId","data-v-0cdb7b2a"]]),kb={class:"table-profiles-manager"},Eb={class:"profiles-header"},Sb={key:0,class:"profiles-list"},Tb={class:"profile-header"},Ib={class:"profile-info"},Nb={class:"profile-name"},xb={key:0,class:"active-badge"},Ab={class:"profile-meta"},Pb={class:"table-count"},Rb={class:"created-date"},Db={class:"profile-actions"},Mb=["onClick","disabled"],Lb=["onClick","disabled"],Ob=["onClick"],Fb=["onClick"],Ub={class:"profile-tables"},Bb={class:"tables-list"},qb={key:0,class:"fas fa-exclamation-triangle",title:"En conflicto con otro mozo"},jb={key:0,class:"conflict-info"},$b={key:1,class:"activation-summary"},zb={key:0,class:"summary-item success"},Vb={key:1,class:"summary-item info"},Wb={key:2,class:"summary-item warning"},Hb={key:0,class:"empty-state"},Gb={key:1,class:"loading-state"},Yb={class:"modal-content"},Kb={class:"modal-header"},Qb={class:"modal-body"},Jb={class:"form-group"},Zb={class:"form-group"},Xb={class:"tables-grid"},ew=["value","disabled"],tw={class:"table-info"},aw={class:"table-number"},nw={key:0,class:"table-name"},iw={key:1,class:"status-badge mine"},sw={key:2,class:"status-badge conflict"},ow={key:3,class:"status-badge available"},rw={class:"form-help"},lw={class:"form-actions"},cw=["disabled"],dw={key:0,class:"fas fa-spinner fa-spin"},uw={key:1,class:"fas fa-save"},hw=lr({__name:"TableProfilesManager",props:{businessId:{type:Number,required:!0},availableTables:{type:Array,default:()=>[]},assignedTables:{type:Array,default:()=>[]}},emits:["profiles-updated"],setup(e,{emit:t}){const a=e,n=t,i=A({profiles:[],loading:!1,processing:null,saving:!1,showCreateModal:!1,editingProfile:null,formData:{name:"",table_ids:[]}}),o=s(()=>i.profiles),l=s(()=>i.loading),b=s(()=>i.processing),w=s(()=>i.saving),_=s({get:()=>i.showCreateModal,set:e=>i.showCreateModal=e}),C=s(()=>i.editingProfile),k=s(()=>i.formData),E=s(()=>[...a.availableTables,...a.assignedTables].map(e=>({...e,is_assigned_to_me:a.assignedTables.some(t=>t.id===e.id),is_assigned_to_other:e.assigned_waiter&&"Tú"!==e.assigned_waiter,assigned_waiter:e.assigned_waiter||"Disponible"}))),S=async()=>{i.loading=!0;try{const e=await Aa.getWaiterTableProfiles();e.data.success?(i.profiles=e.data.profiles||[],console.log("✅ Perfiles cargados:",i.profiles.length)):ir(e.data.message||"Error cargando perfiles")}catch(e){console.error("Error loading profiles:",e),ir("Error cargando perfiles")}finally{i.loading=!1}},T=async()=>{if(i.formData.name.trim()&&0!==i.formData.table_ids.length){i.saving=!0;try{const e={name:i.formData.name.trim(),table_ids:i.formData.table_ids};let t;t=i.editingProfile?await Aa.updateWaiterTableProfile(i.editingProfile.id,e):await Aa.createWaiterTableProfile(e),t.data.success?(nr(t.data.message||`Perfil ${i.editingProfile?"actualizado":"creado"} correctamente`),P(),await S(),n("profiles-updated")):ir(t.data.message||`Error ${i.editingProfile?"actualizando":"creando"} perfil`)}catch(e){console.error("Error saving profile:",e),ir(`Error ${i.editingProfile?"actualizando":"creando"} perfil`)}finally{i.saving=!1}}else ir("Completa todos los campos requeridos")},P=()=>{i.showCreateModal=!1,i.editingProfile=null,i.formData={name:"",table_ids:[]}},R=e=>a.assignedTables.some(t=>t.number===e),D=e=>{if(!e)return"";return new Date(e).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})};return r(async()=>{console.log("🏠 TableProfilesManager mounted"),await S()}),(e,t)=>(d(),c("div",kb,[u("div",Eb,[t[5]||(t[5]=u("div",{class:"header-info"},[u("h3",null,[u("i",{class:"fas fa-bookmark"}),y(" Mis Perfiles de Mesa ")]),u("p",{class:"header-description"}," Crea perfiles con conjuntos de mesas para activar rápidamente ")],-1)),u("button",{onClick:t[0]||(t[0]=e=>_.value=!0),class:"btn btn-primary"},t[4]||(t[4]=[u("i",{class:"fas fa-plus"},null,-1),y(" Crear Perfil ")]))]),l.value?h("",!0):(d(),c("div",Sb,[(d(!0),c(g,null,v(o.value,e=>{var a,s,o;return d(),c("div",{key:e.id,class:m(["profile-card",{active:e.is_active,"has-conflicts":(null==(a=e.conflict_tables)?void 0:a.length)>0}])},[u("div",Tb,[u("div",Ib,[u("h4",Nb,[y(p(e.name)+" ",1),e.is_active?(d(),c("span",xb,"ACTIVO")):h("",!0)]),u("div",Ab,[u("span",Pb,[t[6]||(t[6]=u("i",{class:"fas fa-table"},null,-1)),y(" "+p((null==(s=e.table_numbers)?void 0:s.length)||0)+" mesas ",1)]),u("span",Rb," Creado "+p(D(e.created_at)),1)])]),u("div",Db,[e.is_active?h("",!0):(d(),c("button",{key:0,onClick:t=>(async e=>{i.processing=e;try{const t=await Aa.activateWaiterTableProfile(e);t.data.success?(nr(t.data.message||"Perfil activado"),await S(),n("profiles-updated")):ir(t.data.message||"Error activando perfil")}catch(t){console.error("Error activating profile:",t),ir("Error activando perfil")}finally{i.processing=null}})(e.id),class:"action-btn activate",disabled:b.value===e.id,title:"Activar perfil"},t[7]||(t[7]=[u("i",{class:"fas fa-play"},null,-1)]),8,Mb)),e.is_active?(d(),c("button",{key:1,onClick:t=>(async e=>{if(await sr("¿Desactivar perfil?","Se desasignarán todas las mesas de este perfil.","Desactivar","Cancelar","warning")){i.processing=e;try{const t=await Aa.deactivateWaiterTableProfile(e);t.data.success?(nr(t.data.message||"Perfil desactivado"),await S(),n("profiles-updated")):ir(t.data.message||"Error desactivando perfil")}catch(t){console.error("Error deactivating profile:",t),ir("Error desactivando perfil")}finally{i.processing=null}}})(e.id),class:"action-btn deactivate",disabled:b.value===e.id,title:"Desactivar perfil"},t[8]||(t[8]=[u("i",{class:"fas fa-pause"},null,-1)]),8,Lb)):h("",!0),u("button",{onClick:t=>(e=>{i.editingProfile=e,i.formData={name:e.name,table_ids:[...e.table_ids||[]]},i.showCreateModal=!1})(e),class:"action-btn edit",title:"Editar perfil"},t[9]||(t[9]=[u("i",{class:"fas fa-edit"},null,-1)]),8,Ob),u("button",{onClick:t=>(async(e,t)=>{if(await sr(`¿Eliminar perfil "${t}"?`,"Esta acción no se puede deshacer.","Eliminar","Cancelar","danger"))try{const t=await Aa.deleteWaiterTableProfile(e);t.data.success?(nr(t.data.message||"Perfil eliminado"),await S(),n("profiles-updated")):ir(t.data.message||"Error eliminando perfil")}catch(a){console.error("Error deleting profile:",a),ir("Error eliminando perfil")}})(e.id,e.name),class:"action-btn delete",title:"Eliminar perfil"},t[10]||(t[10]=[u("i",{class:"fas fa-trash"},null,-1)]),8,Fb)])]),u("div",Ub,[u("div",Bb,[(d(!0),c(g,null,v(e.table_numbers,t=>{var a,n;return d(),c("span",{key:t,class:m(["table-tag",{conflict:null==(a=e.conflict_tables)?void 0:a.includes(t),assigned:R(t)}])},[y(" Mesa "+p(t)+" ",1),(null==(n=e.conflict_tables)?void 0:n.includes(t))?(d(),c("i",qb)):h("",!0)],2)}),128))])]),(null==(o=e.conflict_tables)?void 0:o.length)>0?(d(),c("div",jb,[t[11]||(t[11]=u("i",{class:"fas fa-exclamation-triangle"},null,-1)),u("span",null,p(e.conflict_tables.length)+" mesa(s) en conflicto con otros mozos",1)])):h("",!0),e.is_active&&e.activation_summary?(d(),c("div",$b,[e.activation_summary.activated>0?(d(),c("div",zb,[t[12]||(t[12]=u("i",{class:"fas fa-check"},null,-1)),y(" "+p(e.activation_summary.activated)+" activadas ",1)])):h("",!0),e.activation_summary.already_yours>0?(d(),c("div",Vb,[t[13]||(t[13]=u("i",{class:"fas fa-user-check"},null,-1)),y(" "+p(e.activation_summary.already_yours)+" ya eran tuyas ",1)])):h("",!0),e.activation_summary.conflicts>0?(d(),c("div",Wb,[t[14]||(t[14]=u("i",{class:"fas fa-exclamation-triangle"},null,-1)),y(" "+p(e.activation_summary.conflicts)+" en conflicto ",1)])):h("",!0)])):h("",!0)],2)}),128)),0===o.value.length?(d(),c("div",Hb,[t[16]||(t[16]=u("i",{class:"fas fa-bookmark"},null,-1)),t[17]||(t[17]=u("h4",null,"No tienes perfiles creados",-1)),t[18]||(t[18]=u("p",null,"Crea tu primer perfil para agrupar mesas que usas frecuentemente",-1)),u("button",{onClick:t[1]||(t[1]=e=>_.value=!0),class:"btn btn-primary"},t[15]||(t[15]=[u("i",{class:"fas fa-plus"},null,-1),y(" Crear Primer Perfil ")]))])):h("",!0)])),l.value?(d(),c("div",Gb,t[19]||(t[19]=[u("i",{class:"fas fa-spinner fa-spin"},null,-1),u("p",null,"Cargando perfiles...",-1)]))):h("",!0),_.value||C.value?(d(),c("div",{key:2,class:"modal-overlay",onClick:f(P,["self"])},[u("div",Yb,[u("div",Kb,[u("h3",null,[t[20]||(t[20]=u("i",{class:"fas fa-bookmark"},null,-1)),y(" "+p(C.value?"Editar Perfil":"Crear Nuevo Perfil"),1)]),u("button",{onClick:P,class:"close-btn"},t[21]||(t[21]=[u("i",{class:"fas fa-times"},null,-1)]))]),u("div",Qb,[u("form",{onSubmit:f(T,["prevent"])},[u("div",Jb,[t[22]||(t[22]=u("label",{for:"profileName"},"Nombre del perfil",-1)),I(u("input",{id:"profileName","onUpdate:modelValue":t[2]||(t[2]=e=>k.value.name=e),type:"text",class:"form-input",placeholder:"Ej: Zona A, Terraza, Mesas VIP...",maxlength:"50",required:""},null,512),[[N,k.value.name]]),t[23]||(t[23]=u("small",{class:"form-help"}," Máximo 50 caracteres. Debe ser único. ",-1))]),u("div",Zb,[t[24]||(t[24]=u("label",null,"Selecciona las mesas (máximo 20)",-1)),u("div",Xb,[(d(!0),c(g,null,v(E.value,e=>(d(),c("label",{key:e.id,class:m(["table-checkbox",{selected:k.value.table_ids.includes(e.id),assigned:e.is_assigned_to_me,conflict:e.is_assigned_to_other}])},[I(u("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":t[3]||(t[3]=e=>k.value.table_ids=e),disabled:k.value.table_ids.length>=20&&!k.value.table_ids.includes(e.id)},null,8,ew),[[x,k.value.table_ids]]),u("span",tw,[u("span",aw,"Mesa "+p(e.number),1),e.name&&e.name!==`Mesa ${e.number}`?(d(),c("span",nw,p(e.name),1)):h("",!0),e.is_assigned_to_me?(d(),c("span",iw,"Tuya")):e.is_assigned_to_other?(d(),c("span",sw,p(e.assigned_waiter),1)):(d(),c("span",ow,"Disponible"))])],2))),128))]),u("small",rw," Seleccionadas: "+p(k.value.table_ids.length)+"/20 ",1)]),u("div",lw,[u("button",{type:"button",onClick:P,class:"btn btn-secondary"}," Cancelar "),u("button",{type:"submit",class:"btn btn-primary",disabled:!k.value.name.trim()||0===k.value.table_ids.length||w.value},[w.value?(d(),c("i",dw)):(d(),c("i",uw)),y(" "+p(C.value?"Actualizar":"Crear")+" Perfil ",1)],8,cw)])],32)])])])):h("",!0)]))}},[["__scopeId","data-v-ad74d18c"]]),pw={class:"waiter-dashboard"},mw={class:"dashboard-header"},fw={class:"waiter-info"},gw={class:"waiter-details"},vw={class:"business-selector-container"},bw={class:"dashboard-stats"},ww={class:"stat-item"},yw={class:"stat-number"},_w={class:"stat-item urgent"},Cw={class:"stat-number"},kw={class:"stat-item"},Ew={class:"stat-number"},Sw={class:"dashboard-content"},Tw={class:"left-column"},Iw={class:"section-card"},Nw={class:"section-header"},xw={class:"section-actions"},Aw=["disabled"],Pw={class:"tables-list"},Rw={class:"table-info"},Dw={class:"table-name"},Mw={key:0,class:"urgency-icon"},Lw={key:1,class:"silence-icon"},Ow={key:2,class:"ok-icon"},Fw={key:0,class:"table-subtitle"},Uw={class:"table-actions"},Bw=["onClick"],qw=["onClick"],jw=["onClick"],$w=["onClick"],zw={key:0,class:"empty-state"},Vw={key:0},Ww={key:1},Hw={class:"right-column"},Gw={class:"section-card"},Yw={class:"notifications-list",id:"calls-container"},Kw={class:"notification-info"},Qw={class:"notification-title"},Jw={class:"notification-message"},Zw={class:"notification-time"},Xw={key:0,class:"urgent-badge"},ey={class:"notification-actions"},ty=["onClick","disabled"],ay=["onClick","disabled"],ny=["onClick"],iy={key:0,class:"empty-notifications"},sy={key:0},oy={key:1},ry={class:"section-card"},ly={class:"acknowledged-list"},cy={class:"notification-info"},dy={class:"notification-title"},uy={class:"notification-message"},hy={class:"notification-time"},py={class:"notification-actions"},my=["onClick","disabled"],fy={key:0,class:"empty-notifications"},gy={class:"modal-content large"},vy={class:"modal-header"},by={class:"modal-body"},wy={class:"modal-content large"},yy={class:"modal-header"},_y={class:"modal-body"},Cy=lr({__name:"Dashboard",setup(e){const t=w(),a=Xa(),n=A({assignedTables:[],availableTables:[],pendingCalls:[],callHistory:[],silencedTables:[],businesses:[],currentBusiness:null,needsBusiness:!1,loading:!1,processingCall:null,showTableSelector:!1,showTablesManager:!1,showProfilesManager:!1}),_=s(()=>n.availableTables),k=s(()=>n.silencedTables),E=s(()=>n.loading),S=s(()=>n.processingCall),T=s({get:()=>n.showTableSelector,set:e=>n.showTableSelector=e}),I=s({get:()=>n.showTablesManager,set:e=>n.showTablesManager=e}),N=s({get:()=>n.showProfilesManager,set:e=>n.showProfilesManager=e}),x=i(null);s(()=>n.businesses);const P=s(()=>n.currentBusiness),R=s(()=>n.needsBusiness);s(()=>{var e;return(null==(e=n.currentBusiness)?void 0:e.name)||"Seleccionar Negocio"});const D=s(()=>{try{if(window&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls){const e=new Set(Array.from(window.ultraFastNotifications.activeCalls.keys()).map(e=>String(e)));return n.pendingCalls.filter(t=>!e.has(String(t.id)))}}catch(e){}return n.pendingCalls}),M=s(()=>{try{const e=new Set(window&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls?Array.from(window.ultraFastNotifications.activeCalls.keys()).map(e=>String(e)):[]);return n.callHistory.filter(t=>!e.has(String(t.id)))}catch(e){return n.callHistory}});s(()=>{try{if(window&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls){const e=new Set(Array.from(window.ultraFastNotifications.activeCalls.keys()).map(e=>String(e)));return n.pendingCalls.filter(t=>!e.has(String(t.id)))}}catch(e){}return n.pendingCalls});const L=s(()=>n.assignedTables);function O(e){const t=String(e.id);n.callHistory=n.callHistory.filter(e=>String(e.id)!==t);const a=n.pendingCalls.findIndex(e=>String(e.id)===t),i=Date.now(),s=e.called_at||e.timestamp||i,o=Math.max(0,Math.floor((i-s)/6e4)),r={...e,minutes_ago:o};-1===a?n.pendingCalls.unshift(r):n.pendingCalls[a]={...n.pendingCalls[a],...r}}function F(e){try{const a=null==e?void 0:e.detail;if(!a||!a.id)return;O(a);try{"function"==typeof H&&H()}catch(t){}}catch(t){console.warn("Error handling ultraFastAddCall:",t)}}function U(e){try{const t=null==e?void 0:e.detail;if(!t||!t.id)return;O(t)}catch(t){console.warn("Error handling updateCallStatus:",t)}}function B(e){var t;try{const a=null==(t=null==e?void 0:e.detail)?void 0:t.callId;if(!a)return;const i=String(a);n.pendingCalls=n.pendingCalls.filter(e=>String(e.id)!==i)}catch(a){console.warn("Error handling removeCall:",a)}}function q(){n.pendingCalls=[]}function j(e){var t;try{const a=null==(t=null==e?void 0:e.detail)?void 0:t.callId;if(!a)return;const i=n.pendingCalls.findIndex(e=>String(e.id)===String(a));if(-1!==i){const e={...n.pendingCalls[i],status:"acknowledged"};n.pendingCalls.splice(i,1),n.callHistory.unshift(e)}}catch(a){console.warn("Error handling callAcknowledged:",a)}}function $(e){try{const t=(null==e?void 0:e.detail)||{},a=t.callId||t.callData&&t.callData.id,i=t.callData||null;if(!a)return;if(i&&"pending"===i.status)return;n.pendingCalls=n.pendingCalls.filter(e=>String(e.id)!==String(a));const s=n.callHistory.find(e=>String(e.id)===String(a));s?Object.assign(s,i||{}):i&&n.callHistory.unshift(i)}catch(t){console.warn("Error manejando callMovedToHistory en Dashboard:",t)}}let z=null;const V=async()=>{if(!n.needsBusiness&&n.currentBusiness){n.loading=!0;try{await Promise.all([H(),G(),Y(),K()])}catch(e){console.error("Error loading dashboard data:",e),ir("Error cargando datos del dashboard")}finally{n.loading=!1}}};r(async()=>{await V(),window.__waiterDashboardListenersRegistered||(window.addEventListener("ultraFastAddCall",F),window.addEventListener("newWaiterCall",F),window.addEventListener("updateCallStatus",U),window.addEventListener("removeCall",B),window.addEventListener("clearAllCalls",q),window.addEventListener("callAcknowledged",j),window.addEventListener("callMovedToHistory",$),window.__waiterDashboardListenersRegistered=!0);try{window.debugUltra=()=>({pendingCalls:n.pendingCalls.slice(),activeCalls:window.ultraFastNotifications?Array.from(window.ultraFastNotifications.activeCalls.keys()):[]})}catch(e){}}),l(()=>{try{window.__waiterDashboardListenersRegistered&&(window.removeEventListener("ultraFastAddCall",F),window.removeEventListener("newWaiterCall",F),window.removeEventListener("updateCallStatus",U),window.removeEventListener("removeCall",B),window.removeEventListener("clearAllCalls",q),window.removeEventListener("callAcknowledged",j),window.removeEventListener("callMovedToHistory",$),window.__waiterDashboardListenersRegistered=!1)}catch(e){console.warn("Error removing ultraFast event listeners:",e)}try{z&&z.stopListening&&z.stopListening()}catch(e){console.warn("Error stopping ultraFastNotifications on unmount:",e)}});const H=async()=>{var e;if(n.currentBusiness)try{const t=await sc.getWaiterBusinessTables(n.currentBusiness.id);if(t.success){const a=(null==(e=t.tables)?void 0:e.filter(e=>{var t;return"assigned_to_me"===(null==(t=e.status)?void 0:t.assignment)}))||[];n.assignedTables=a}}catch(t){console.error("❌ Error cargando mesas asignadas:",t),ir("Error al cargar las mesas asignadas")}},G=async()=>{},Y=async()=>{try{const e=await sc.getAvailableTables();e.success&&(n.availableTables=e.available_tables||[])}catch(e){console.error("💥 Error loading available tables:",e)}},K=async()=>{try{const e=await sc.getSilencedTables();e.success&&(n.silencedTables=e.silenced_tables||[])}catch(e){console.error("Error loading silenced tables:",e)}},Q=async e=>{try{if(await sr("¿Silenciar mesa?","La mesa no podrá realizar llamadas durante 30 minutos.","Silenciar","Cancelar","warning")){const t=await sc.silenceTable(e,30);t.success?(nr(t.message||"Mesa silenciada"),await H(),await K()):ir(t.message||"Error silenciando mesa")}}catch(t){console.error("Error silencing table:",t),ir("Error silenciando mesa")}},Z=async()=>{await V()},X=async()=>{try{if(await sr("¿Finalizar turno?","Te desasignarás de todas las mesas y saldrás de la aplicación.","Finalizar Turno","Cancelar","danger")){if(n.assignedTables.length>0){const e=n.assignedTables.map(e=>e.id);await sc.deactivateMultipleTables(e)}oe(),await a.logout(),nr("Turno finalizado correctamente"),await t.push("/login")}}catch(e){console.error("Error ending shift:",e),ir("Error finalizando turno")}},ee=e=>{n.businesses=e.businesses||[],n.currentBusiness=e.activeBusiness||null,n.needsBusiness=e.needsBusiness||!1,n.currentBusiness&&!n.needsBusiness&&(V(),se())},te=e=>{n.currentBusiness=e,n.assignedTables=[],n.availableTables=[],n.pendingCalls=[],n.silencedTables=[],V(),se()},ae=async e=>{var t;if(n.showTableSelector=!1,0!==e.length)try{const a=await sc.activateMultipleTables(e);a.success?(console.log("✅ Dashboard: Mesas activadas exitosamente"),nr(a.message||`${(null==(t=a.summary)?void 0:t.successful)||e.length} mesas activadas`),await H(),await Y(),se()):ir(a.message||"Error activando mesas")}catch(a){console.error("💥 Dashboard: Error completo activando mesas múltiples:",a),ir("Error activando mesas")}},ne=async e=>{await V()},ie=async()=>{await V()},se=async()=>{if(a.user&&!n.needsBusiness)try{z=function(e){"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission();try{J&&J.isPluginAvailable&&J.isPluginAvailable("LocalNotifications")&&W(async()=>{const{LocalNotifications:e}=await import("./index-B_qQR_LU.js");return{LocalNotifications:e}},__vite__mapDeps([7,1,2])).then(({LocalNotifications:e})=>{e.requestPermissions().then(e=>{console.log("UNIFIED: LocalNotifications permissions:",e)}).catch(e=>{console.warn("Error pidiendo permisos LocalNotifications:",e)}),e.createChannel&&e.createChannel({id:"mozo_waiter",name:"Mozo - Llamadas",importance:5,visibility:1,description:"Notificaciones de llamadas y eventos importantes para mozos"}).then(()=>{console.log("✅ UNIFIED: Canal mozo_waiter creado")}).catch(e=>{console.warn("⚠️ Error creando canal mozo_waiter:",e)})}).catch(e=>console.warn("⚠️ No se pudo importar LocalNotifications:",e))}catch(a){console.warn("⚠️ Excepción al preparar LocalNotifications:",a)}const t=new jg(e);return t.startListening(),console.log("⚡ UNIFIED notifications inicializadas"),t}(a.user.id.toString())}catch(e){console.error("❌ Error configurando Ultra Fast Firebase:",e),ir("Error configurando notificaciones ultra rápidas")}},oe=async()=>{try{z&&(z.stopListening(),z=null)}catch(e){console.error("❌ Error desconectando Ultra Fast Firebase:",e)}};r(async()=>{window.addEventListener("newWaiterCall",re),window.addEventListener("updateCallStatus",le),window.addEventListener("removeCall",ce),window.addEventListener("clearAllCalls",de)}),l(()=>{oe(),window.removeEventListener("newWaiterCall",re),window.removeEventListener("updateCallStatus",le),window.removeEventListener("removeCall",ce),window.removeEventListener("clearAllCalls",de)});const re=async e=>{console.log("🔔 Nueva llamada desde Firebase:",e.detail),n.pendingCalls.unshift(e.detail),await H()},le=async e=>{console.log("🔄 Llamada actualizada desde Firebase:",e.detail);const t=e.detail,a=n.pendingCalls.findIndex(e=>e.id===t.id);-1!==a&&(n.pendingCalls[a]=t)},ce=async e=>{const{callId:t}=e.detail;n.pendingCalls=n.pendingCalls.filter(e=>e.id!==t),await H()},de=async e=>{n.pendingCalls=[],await H()},ue=async()=>{if(z)try{const e=await z.createTestCall();nr(`🧪 Llamada de prueba creada: Mesa ${e.table_number}`)}catch(e){console.error("Error creando llamada de prueba:",e),ir("Error al crear la llamada de prueba")}else ir("Sistema de notificaciones ultra rápidas no disponible")};return(e,t)=>{var i;return d(),c("div",pw,[u("div",mw,[u("div",fw,[t[9]||(t[9]=u("div",{class:"waiter-avatar"},[u("i",{class:"fas fa-user-circle"})],-1)),u("div",gw,[u("h2",null,p((null==(i=o(a).user)?void 0:i.name)||"Mozo"),1),u("div",vw,[b(Ov,{onBusinessChanged:te,onBusinessesLoaded:ee,ref_key:"businessSelector",ref:x},null,512)])])]),u("div",bw,[u("div",ww,[u("div",yw,p(L.value.length),1),t[10]||(t[10]=u("div",{class:"stat-label"},"Mesas asignadas",-1))]),u("div",_w,[u("div",Cw,p(D.value.length),1),t[11]||(t[11]=u("div",{class:"stat-label"},"Llamadas pendientes",-1))]),u("div",kw,[u("div",Ew,p(k.value.length),1),t[12]||(t[12]=u("div",{class:"stat-label"},"Mesas silenciadas",-1))])])]),u("div",Sw,[u("div",Tw,[u("div",Iw,[u("div",Nw,[t[17]||(t[17]=u("h3",null,[u("i",{class:"fas fa-table"}),y(" Todas ")],-1)),u("div",xw,[R.value?h("",!0):(d(),c("button",{key:0,onClick:t[0]||(t[0]=e=>N.value=!0),class:"action-btn info"},t[13]||(t[13]=[u("i",{class:"fas fa-bookmark"},null,-1),y(" Perfiles ")]))),R.value?h("",!0):(d(),c("button",{key:1,onClick:t[1]||(t[1]=e=>I.value=!0),class:"action-btn secondary"},t[14]||(t[14]=[u("i",{class:"fas fa-cog"},null,-1),y(" Gestionar Mesas ")]))),R.value?h("",!0):(d(),c("button",{key:2,onClick:t[2]||(t[2]=e=>T.value=!0),class:"action-btn primary"},t[15]||(t[15]=[u("i",{class:"fas fa-plus"},null,-1),y(" Activar Mesas ")]))),u("button",{onClick:Z,class:"action-btn",disabled:E.value},[u("i",{class:m(["fas fa-sync-alt",{"fa-spin":E.value}])},null,2)],8,Aw),u("button",{onClick:ue,class:"action-btn warning"},t[16]||(t[16]=[u("i",{class:"fas fa-flask"},null,-1),y(" Test Call ")]))])]),u("div",Pw,[(d(!0),c(g,null,v(L.value,e=>(d(),c("div",{key:e.id,class:m(["table-item",{"has-calls":e.pending_calls_count>0,silenced:e.is_silenced}])},[u("div",Rw,[u("div",Dw,[y(" Mesa "+p(e.number)+" ",1),e.pending_calls_count>0?(d(),c("span",Mw,t[18]||(t[18]=[u("i",{class:"fas fa-exclamation-triangle"},null,-1)]))):e.is_silenced?(d(),c("span",Lw,t[19]||(t[19]=[u("i",{class:"fas fa-volume-mute"},null,-1)]))):(d(),c("span",Ow,t[20]||(t[20]=[u("i",{class:"fas fa-check"},null,-1)])))]),e.name&&e.name!==`Mesa ${e.number}`?(d(),c("div",Fw,p(e.name),1)):h("",!0)]),u("div",Uw,[e.notifications_enabled?h("",!0):(d(),c("button",{key:0,onClick:t=>(async e=>{try{const t=await sc.activateTable(e);t.success?(nr(t.message||"Mesa activada"),await H(),se()):ir(t.message||"Error activando mesa")}catch(t){console.error("💥 Dashboard: Error completo activando mesa:",t),ir("Error activando mesa")}})(e.id),class:"table-action-btn activate",title:"Activar llamadas"},t[21]||(t[21]=[u("i",{class:"fas fa-check"},null,-1)]),8,Bw)),!e.is_silenced&&e.notifications_enabled?(d(),c("button",{key:1,onClick:t=>Q(e.id),class:"table-action-btn silence",title:"Silenciar"},t[22]||(t[22]=[u("i",{class:"fas fa-volume-mute"},null,-1)]),8,qw)):h("",!0),e.is_silenced?(d(),c("button",{key:2,onClick:t=>(async e=>{try{const t=await sc.unsilenceTable(e);t.success?(nr(t.message||"Silencio removido"),await H(),await K()):ir(t.message||"Error removiendo silencio")}catch(t){console.error("Error unsilencing table:",t),ir("Error removiendo silencio")}})(e.id),class:"table-action-btn unsilence",title:"Activar"},t[23]||(t[23]=[u("i",{class:"fas fa-volume-up"},null,-1)]),8,jw)):h("",!0),u("button",{onClick:t=>(async e=>{try{if(await sr("¿Desactivar mesa?","Te desasignarás de esta mesa y no recibirás más llamadas.","Desactivar","Cancelar","warning")){const t=await sc.deactivateTable(e);t.success?(nr(t.message||"Mesa desactivada"),await H(),await Y(),await G(),se()):ir(t.message||"Error desactivando mesa")}}catch(t){console.error("Error deactivating table:",t),ir("Error desactivando mesa")}})(e.id),class:"table-action-btn deactivate",title:"Desactivar"},t[24]||(t[24]=[u("i",{class:"fas fa-times"},null,-1)]),8,$w)])],2))),128)),0===L.value.length?(d(),c("div",zw,[t[25]||(t[25]=u("i",{class:"fas fa-table"},null,-1)),R.value?(d(),c("p",Ww,"Selecciona un negocio para ver las mesas disponibles")):(d(),c("p",Vw,"No tienes mesas asignadas")),R.value?h("",!0):(d(),c("button",{key:2,onClick:t[3]||(t[3]=e=>T.value=!0),class:"btn btn-primary"}," Activar Mesas "))])):h("",!0)])])]),u("div",Hw,[u("div",Gw,[t[30]||(t[30]=u("div",{class:"section-header"},[u("h3",null,"Notificaciones:")],-1)),u("div",Yw,[(d(!0),c(g,null,v(D.value,e=>{var a;return d(),c("div",{key:e.id,class:m(["notification-item",{urgent:"high"===e.urgency,old:e.minutes_ago>5}])},[u("div",Kw,[u("div",Qw," Mesa "+p(e.table_number||(null==(a=e.table)?void 0:a.number))+": ",1),u("div",Jw,p(e.message||"Solicita mozo"),1),u("div",Zw,[y(" Hace "+p(e.minutes_ago)+"m ",1),"high"===e.urgency?(d(),c("span",Xw,"URGENTE")):h("",!0)])]),u("div",ey,[u("button",{onClick:t=>(async e=>{if(z)try{n.processingCall=e,await z.acknowledgeCall(e)}catch(t){console.error("Error reconociendo llamada:",t),ir("Error al reconocer la llamada")}finally{n.processingCall=null}else ir("Sistema de notificaciones ultra rápidas no disponible")})(e.id),class:"notification-action-btn ok",disabled:S.value===e.id,title:"OK - Confirmar llamada"},t[26]||(t[26]=[u("i",{class:"fas fa-check"},null,-1)]),8,ty),u("button",{onClick:t=>(async e=>{if(z)try{n.processingCall=e,await z.completeCall(e)}catch(t){console.error("Error completando llamada:",t),ir("Error al completar la llamada")}finally{n.processingCall=null}else ir("Sistema de notificaciones ultra rápidas no disponible")})(e.id),class:"notification-action-btn complete",disabled:S.value===e.id,title:"Completar atención"},t[27]||(t[27]=[u("i",{class:"fas fa-check-double"},null,-1)]),8,ay),u("button",{onClick:t=>(async e=>{await Q(e),await G()})(e.table.id),class:"notification-action-btn silence",title:"Silenciar mesa"},t[28]||(t[28]=[u("i",{class:"fas fa-volume-mute"},null,-1)]),8,ny)])],2)}),128)),0===D.value.length?(d(),c("div",iy,[t[29]||(t[29]=u("i",{class:"fas fa-bell-slash"},null,-1)),R.value?(d(),c("p",oy,"Selecciona un negocio para ver las llamadas")):(d(),c("p",sy,"No hay llamadas pendientes"))])):h("",!0)])]),u("div",ry,[t[33]||(t[33]=u("div",{class:"section-header"},[u("h3",null,"Historial")],-1)),u("div",ly,[(d(!0),c(g,null,v(M.value,e=>{var a;return d(),c("div",{key:`hist-${e.id}`,class:"notification-item acknowledged"},[u("div",cy,[u("div",dy,"Mesa "+p(e.table_number||(null==(a=e.table)?void 0:a.number))+":",1),u("div",uy,p(e.message||"Solicita mozo"),1),u("div",hy,p(e.acknowledged_at?"Atendida":""),1)]),u("div",py,[u("button",{onClick:t=>(async e=>{if(e){n.processingCall=e;try{z&&z.completeCall?await z.completeCall(e):await sc.completeCall(e),n.callHistory=n.callHistory.filter(t=>String(t.id)!==String(e)),nr("Llamada marcada como completada")}catch(t){console.error("Error completing call from history:",t),ir("Error completando la llamada")}finally{n.processingCall=null}}})(e.id),class:"notification-action-btn complete",disabled:S.value===e.id,title:"Completar desde historial"},t[31]||(t[31]=[u("i",{class:"fas fa-check-double"},null,-1)]),8,my)])])}),128)),0===M.value.length?(d(),c("div",fy,t[32]||(t[32]=[u("i",{class:"fas fa-history"},null,-1),u("p",null,"No hay historial disponible",-1)]))):h("",!0)])]),u("div",{class:"section-card"},[u("button",{onClick:X,class:"end-shift-btn"},t[34]||(t[34]=[u("i",{class:"fas fa-sign-out-alt"},null,-1),y(" Salir y desactivar notificaciones ")]))])])]),T.value&&!R.value?(d(),C(lv,{key:0,"available-tables":_.value,"assigned-tables":L.value,onClose:t[4]||(t[4]=e=>T.value=!1),onTablesSelected:ae},null,8,["available-tables","assigned-tables"])):h("",!0),I.value&&P.value?(d(),c("div",{key:1,class:"modal-overlay",onClick:t[6]||(t[6]=f(e=>I.value=!1,["self"]))},[u("div",gy,[u("div",vy,[u("h3",null,[t[35]||(t[35]=u("i",{class:"fas fa-building"},null,-1)),y(" "+p(P.value.name)+" - Gestión de Mesas ",1)]),u("button",{onClick:t[5]||(t[5]=e=>I.value=!1),class:"close-btn"},t[36]||(t[36]=[u("i",{class:"fas fa-times"},null,-1)]))]),u("div",by,[b(Cb,{"business-id":P.value.id,"business-name":P.value.name,onTablesUpdated:ne},null,8,["business-id","business-name"])])])])):h("",!0),N.value&&P.value?(d(),c("div",{key:2,class:"modal-overlay",onClick:t[8]||(t[8]=f(e=>N.value=!1,["self"]))},[u("div",wy,[u("div",yy,[t[38]||(t[38]=u("h3",null,[u("i",{class:"fas fa-bookmark"}),y(" Perfiles de Mesa ")],-1)),u("button",{onClick:t[7]||(t[7]=e=>N.value=!1),class:"close-btn"},t[37]||(t[37]=[u("i",{class:"fas fa-times"},null,-1)]))]),u("div",_y,[b(hw,{"business-id":P.value.id,"available-tables":_.value,"assigned-tables":L.value,onProfilesUpdated:ie},null,8,["business-id","available-tables","assigned-tables"])])])])):h("",!0)])}}},[["__scopeId","data-v-257fbbc7"]]),ky={class:"editable-field"},Ey={key:0,class:"field-label"},Sy={key:1,class:"edit-container"},Ty=["placeholder"],Iy=["placeholder","min","max"],Ny=["value"],xy=lr({__name:"EditableField",props:{value:{type:[String,Number],default:""},label:{type:String,default:""},type:{type:String,default:"text"},placeholder:{type:String,default:""},options:{type:Array,default:()=>[]},editable:{type:Boolean,default:!0},min:{type:[Number,String],default:null},max:{type:[Number,String],default:null},unit:{type:String,default:""},displayValue:{type:String,default:""}},emits:["update:value"],setup(e,{emit:t}){const a=e,n=t,o=i(a.value),r=i(!1),l=i(null);P(()=>a.value,e=>{r.value||(o.value=e)});const b=s(()=>{if(a.displayValue)return a.displayValue;if("select"===a.type&&a.options.length){const e=a.options.find(e=>e.value===o.value);return e?e.label:o.value}return o.value+(a.unit?" "+a.unit:"")}),w=()=>{a.editable&&(r.value=!0,setTimeout(()=>{l.value&&l.value.focus()},100))},_=()=>{r.value=!1,n("update:value",o.value)},C=e=>{"Enter"===e.key?_():"Escape"===e.key&&(r.value=!1,o.value=a.value)},k=()=>{r.value=!1,o.value=a.value};return(t,a)=>(d(),c("div",ky,[e.label?(d(),c("div",Ey,p(e.label),1)):h("",!0),u("div",{class:m(["field-content",{"is-editing":r.value}])},[r.value?(d(),c("div",Sy,["text"===e.type?I((d(),c("input",{key:0,ref_key:"inputRef",ref:l,type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e),placeholder:e.placeholder,class:"edit-input",onKeydown:C,onChange:_,onBlur:k},null,40,Ty)),[[N,o.value]]):"number"===e.type?I((d(),c("input",{key:1,ref_key:"inputRef",ref:l,type:"number","onUpdate:modelValue":a[1]||(a[1]=e=>o.value=e),placeholder:e.placeholder,min:e.min,max:e.max,class:"edit-input",onKeydown:C,onChange:_,onBlur:k},null,40,Iy)),[[N,o.value]]):"date"===e.type?I((d(),c("input",{key:2,ref_key:"inputRef",ref:l,type:"date","onUpdate:modelValue":a[2]||(a[2]=e=>o.value=e),class:"edit-input",onKeydown:C,onChange:_,onBlur:k},null,544)),[[N,o.value]]):"textarea"===e.type?I((d(),c("textarea",{key:3,ref_key:"inputRef",ref:l,"onUpdate:modelValue":a[3]||(a[3]=e=>o.value=e),rows:"3",class:"edit-input",onKeydown:C,onChange:_,onBlur:k},null,544)),[[N,o.value]]):"select"===e.type?I((d(),c("select",{key:4,ref_key:"inputRef",ref:l,"onUpdate:modelValue":a[4]||(a[4]=e=>o.value=e),class:"edit-select",onChange:_,onBlur:k},[(d(!0),c(g,null,v(e.options,e=>(d(),c("option",{key:e.value,value:e.value},p(e.label),9,Ny))),128))],544)),[[R,o.value]]):h("",!0),u("div",{class:"edit-actions"},[u("button",{type:"button",class:"action-button save-button",onClick:_},a[6]||(a[6]=[u("i",{class:"bi bi-check"},null,-1)])),u("button",{type:"button",class:"action-button cancel-button",onClick:k},a[7]||(a[7]=[u("i",{class:"bi bi-x"},null,-1)]))])])):(d(),c("div",{key:0,class:"display-value",onClick:w},[y(p(b.value)+" ",1),e.editable?(d(),c("button",{key:0,class:"edit-button",onClick:f(w,["stop"])},a[5]||(a[5]=[u("i",{class:"bi bi-pencil"},null,-1)]))):h("",!0)]))],2)]))}},[["__scopeId","data-v-c09b4c9d"]]),Ay={class:"profile-container"},Py={class:"container py-4"},Ry={class:"row justify-content-center"},Dy={class:"col-12 col-lg-8"},My={class:"card"},Ly={class:"card-body"},Oy={key:0,class:"alert alert-success"},Fy={key:1,class:"alert alert-danger"},Uy={key:2,class:"text-center my-5"},By={class:"mb-4 text-center"},qy={class:"avatar-container"},jy=["src"],$y={class:"avatar-overlay"},zy={class:"mb-3"},Vy=["disabled"],Wy={class:"mb-3"},Hy=["disabled"],Gy={class:"mb-3"},Yy=["disabled"],Ky={class:"mb-3"},Qy=["disabled"],Jy={class:"mb-3"},Zy=["disabled"],Xy={key:0,class:"form-text"},e_={class:"mb-4"},t_=["disabled"],a_={key:0,class:"form-text"},n_={class:"d-flex gap-2 mt-4"},i_=["disabled"],s_={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},o_=["disabled"],r_={class:"text-end"},l_=["disabled"],c_={class:"modal-dialog"},d_={class:"modal-content"},u_={class:"modal-header"},h_={class:"modal-body"},p_={class:"mb-3"},m_=["disabled"],f_={class:"modal-footer"},g_=["disabled"],v_=["disabled"],b_={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},w_={key:0,class:"modal-backdrop fade show"};const y_=lr({name:"WaiterProfileView",setup(){const e=w(),t=Xa(),a=i({name:"",email:"",phone:"",avatar:""}),n=i({current:"",new:"",confirm:""}),o=i(!0),l=i(!1),c=i(""),d=i(""),u=i(null),h=i(null),p=i(!1),m=i(""),f=i(!1),g=s(()=>!n.value.new||n.value.new.length>=8),v=s(()=>!n.value.new||!n.value.confirm||n.value.new===n.value.confirm),b=s(()=>!(!a.value.name||!a.value.email)&&(!(n.value.current||n.value.new||n.value.confirm)||n.value.current&&g.value&&v.value));r(()=>{(async()=>{o.value=!0,c.value="";try{const e=$r.getUser()||{id:"1",name:"Juan Pérez",email:"juan@ejemplo.com",phone:"555-123-4567",avatar:"https://randomuser.me/api/portraits/men/32.jpg"};a.value={...e}}catch(e){console.error("Error al cargar datos del usuario:",e),c.value="No se pudieron cargar tus datos. Por favor, inténtalo de nuevo."}finally{o.value=!1}})()});const y=i(!1),_=i(["Atención al cliente","Trabajo en equipo","Resolución de problemas","Manejo de bandeja","Conocimiento de vinos"]);return{user:a,passwords:n,loading:o,updating:l,error:c,success:d,avatarPreview:u,showDeleteModal:p,deleteConfirmation:m,deleting:f,isPasswordValid:g,doPasswordsMatch:v,isFormValid:b,handleAvatarChange:e=>{const t=e.target.files[0];if(!t)return;if(t.size>5242880)return void(c.value="La imagen no puede ser mayor a 5MB");h.value=t;const a=new FileReader;a.onload=e=>{u.value=e.target.result},a.readAsDataURL(t)},updateProfile:async()=>{var e,t;if(b.value){l.value=!0,c.value="",d.value="";try{const e=new FormData;e.append("name",a.value.name),e.append("email",a.value.email),e.append("phone",a.value.phone||""),h.value&&e.append("avatar",h.value),n.value.current&&n.value.new&&(e.append("current_password",n.value.current),e.append("password",n.value.new),e.append("password_confirmation",n.value.confirm)),console.log("Perfil actualizado:",{name:a.value.name,email:a.value.email,phone:a.value.phone,passwordChanged:!!n.value.current,avatarChanged:!!h.value});const t=$r.getUser();t&&(t.name=a.value.name,t.email=a.value.email,t.phone=a.value.phone,u.value&&(t.avatar=u.value),$r.setUser(t)),n.value.current="",n.value.new="",n.value.confirm="",h.value=null,d.value="Perfil actualizado correctamente"}catch(i){console.error("Error al actualizar perfil:",i),c.value=(null==(t=null==(e=i.response)?void 0:e.data)?void 0:t.message)||"No se pudo actualizar el perfil. Por favor, inténtalo de nuevo."}finally{l.value=!1}}},deleteAccount:async()=>{var t,a;if("ELIMINAR"===m.value){f.value=!0;try{console.log("Cuenta eliminada"),await $r.logout(),e.push("/login")}catch(n){console.error("Error al eliminar cuenta:",n),c.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"No se pudo eliminar la cuenta. Por favor, inténtalo de nuevo.",p.value=!1,m.value="",f.value=!1}}},goBack:()=>{e.push("/waiter")},isEditing:y,skills:_,handleUpdate:async(e,a)=>{console.log(`Actualizando ${e} a ${a}`);const n=new FormData;n.append(e,a);try{await t.updateProfile(n)}catch(i){console.error("Fallo al actualizar, la tienda necesita ser corregida.",i)}}}}},[["render",function(e,t,a,n,i,s){return d(),c("div",Ay,[u("div",Py,[u("div",Ry,[u("div",Dy,[u("div",My,[u("div",Ly,[t[26]||(t[26]=u("h1",{class:"h3 mb-4"},"Mi perfil",-1)),n.success?(d(),c("div",Oy,p(n.success),1)):h("",!0),n.error?(d(),c("div",Fy,p(n.error),1)):h("",!0),n.loading&&!n.user.name?(d(),c("div",Uy,t[14]||(t[14]=[u("div",{class:"spinner-border text-primary",role:"status"},[u("span",{class:"visually-hidden"},"Cargando...")],-1)]))):(d(),c("form",{key:3,onSubmit:t[9]||(t[9]=f((...e)=>n.updateProfile&&n.updateProfile(...e),["prevent"]))},[u("div",By,[u("div",qy,[u("img",{src:n.user.avatar||"/placeholder-avatar.png",alt:"Avatar",class:"avatar-img"},null,8,jy),u("div",$y,[t[15]||(t[15]=u("label",{for:"avatar-upload",class:"avatar-edit-btn"},[u("i",{class:"bi bi-camera"})],-1)),u("input",{type:"file",id:"avatar-upload",accept:"image/*",class:"visually-hidden",onChange:t[0]||(t[0]=(...e)=>n.handleAvatarChange&&n.handleAvatarChange(...e))},null,32)])])]),u("div",zy,[t[16]||(t[16]=u("label",{for:"name",class:"form-label"},"Nombre completo",-1)),I(u("input",{type:"text",class:"form-control",id:"name","onUpdate:modelValue":t[1]||(t[1]=e=>n.user.name=e),required:"",disabled:n.updating},null,8,Vy),[[N,n.user.name]])]),u("div",Wy,[t[17]||(t[17]=u("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),I(u("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[2]||(t[2]=e=>n.user.email=e),required:"",disabled:n.updating},null,8,Hy),[[N,n.user.email]])]),u("div",Gy,[t[18]||(t[18]=u("label",{for:"phone",class:"form-label"},"Teléfono",-1)),I(u("input",{type:"tel",class:"form-control",id:"phone","onUpdate:modelValue":t[3]||(t[3]=e=>n.user.phone=e),disabled:n.updating},null,8,Yy),[[N,n.user.phone]])]),t[23]||(t[23]=u("hr",{class:"my-4"},null,-1)),t[24]||(t[24]=u("h4",{class:"h5 mb-3"},"Cambiar contraseña",-1)),u("div",Ky,[t[19]||(t[19]=u("label",{for:"current-password",class:"form-label"},"Contraseña actual",-1)),I(u("input",{type:"password",class:"form-control",id:"current-password","onUpdate:modelValue":t[4]||(t[4]=e=>n.passwords.current=e),disabled:n.updating},null,8,Qy),[[N,n.passwords.current]])]),u("div",Jy,[t[20]||(t[20]=u("label",{for:"new-password",class:"form-label"},"Nueva contraseña",-1)),I(u("input",{type:"password",class:"form-control",id:"new-password","onUpdate:modelValue":t[5]||(t[5]=e=>n.passwords.new=e),disabled:n.updating},null,8,Zy),[[N,n.passwords.new]]),n.passwords.new&&!n.isPasswordValid?(d(),c("div",Xy," La contraseña debe tener al menos 8 caracteres ")):h("",!0)]),u("div",e_,[t[21]||(t[21]=u("label",{for:"confirm-password",class:"form-label"},"Confirmar nueva contraseña",-1)),I(u("input",{type:"password",class:"form-control",id:"confirm-password","onUpdate:modelValue":t[6]||(t[6]=e=>n.passwords.confirm=e),disabled:n.updating},null,8,t_),[[N,n.passwords.confirm]]),n.passwords.confirm&&!n.doPasswordsMatch?(d(),c("div",a_," Las contraseñas no coinciden ")):h("",!0)]),u("div",n_,[u("button",{type:"submit",class:"btn btn-primary",disabled:n.updating||!n.isFormValid},[n.updating?(d(),c("span",s_)):h("",!0),t[22]||(t[22]=y(" Guardar cambios "))],8,i_),u("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[7]||(t[7]=(...e)=>n.goBack&&n.goBack(...e)),disabled:n.updating}," Cancelar ",8,o_)]),t[25]||(t[25]=u("hr",{class:"my-4"},null,-1)),u("div",r_,[u("button",{type:"button",class:"btn btn-outline-danger",onClick:t[8]||(t[8]=e=>n.showDeleteModal=!0),disabled:n.updating}," Eliminar cuenta ",8,l_)])],32))])])])])]),u("div",{class:m(["modal",{"show d-block":n.showDeleteModal}]),tabindex:"-1"},[u("div",c_,[u("div",d_,[u("div",u_,[t[27]||(t[27]=u("h5",{class:"modal-title"},"Eliminar cuenta",-1)),u("button",{type:"button",class:"btn-close",onClick:t[10]||(t[10]=e=>n.showDeleteModal=!1)})]),u("div",h_,[t[29]||(t[29]=u("p",{class:"mb-3"},"¿Estás seguro de que deseas eliminar tu cuenta? Esta acción no se puede deshacer.",-1)),t[30]||(t[30]=u("div",{class:"alert alert-danger"},[u("i",{class:"bi bi-exclamation-triangle-fill me-2"}),y(" Al eliminar tu cuenta perderás todo el acceso a tus datos y negocios asociados. ")],-1)),u("div",p_,[t[28]||(t[28]=u("label",{for:"confirm-delete",class:"form-label"},'Escribe "ELIMINAR" para confirmar',-1)),I(u("input",{type:"text",class:"form-control",id:"confirm-delete","onUpdate:modelValue":t[11]||(t[11]=e=>n.deleteConfirmation=e),disabled:n.deleting},null,8,m_),[[N,n.deleteConfirmation]])])]),u("div",f_,[u("button",{type:"button",class:"btn btn-secondary",onClick:t[12]||(t[12]=e=>n.showDeleteModal=!1),disabled:n.deleting}," Cancelar ",8,g_),u("button",{type:"button",class:"btn btn-danger",onClick:t[13]||(t[13]=(...e)=>n.deleteAccount&&n.deleteAccount(...e)),disabled:"ELIMINAR"!==n.deleteConfirmation||n.deleting},[n.deleting?(d(),c("span",b_)):h("",!0),t[31]||(t[31]=y(" Eliminar mi cuenta "))],8,v_)])])])],2),n.showDeleteModal?(d(),c("div",w_)):h("",!0)])}],["__scopeId","data-v-bc0a0118"]]),__=n("waiter",()=>{const e=i(localStorage.getItem("waiterBusinessId")||null),t=i(null),a=i([]),n=i([]),o=i([]),r=i(!1),l=i(null),c=s(()=>!!e.value),d=s(()=>o.value.filter(e=>"pending"===e.status).sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp))),u=e=>({...e,name:String(e.number),notifications_on:e.notifications_enabled??!0,is_muted:!(e.notifications_enabled??1),color:e.color??null,alert:!1});return{businessId:e,businessData:t,tables:a,profiles:n,notifications:o,isLoading:r,error:l,isAssociated:c,activeNotifications:d,associateBusiness:async a=>{var n,i;r.value=!0,l.value=null;try{const n=await Aa.waiterOnboard(a),{business:i}=n.data;return e.value=i.id,t.value=i,localStorage.setItem("waiterBusinessId",i.id),!0}catch(s){throw l.value=(null==(i=null==(n=s.response)?void 0:n.data)?void 0:i.message)||"Error al asociar el negocio.",s}finally{r.value=!1}},fetchInitialData:async()=>{var e,t,i;if(c.value){r.value=!0,l.value=null;try{const[t,i,s]=await Promise.all([Aa.getWaiterTables(),Aa.listWaiterProfiles(),Aa.getWaiterNotifications()]),r=(null==(e=t.data)?void 0:e.tables)??t.data;a.value=Array.isArray(r)?r.map(u):[],n.value=i.data,o.value=s.data}catch(s){l.value=(null==(i=null==(t=s.response)?void 0:t.data)?void 0:i.message)||"Error al cargar los datos iniciales.",console.error(s)}finally{r.value=!1}}},toggleTableNotifications:async e=>{var t,a;const n=e.notifications_on;e.notifications_on=!n,e.is_muted=!e.notifications_on;try{await Aa.toggleTableNotifications(e.id,{value:e.notifications_on})}catch(i){e.notifications_on=n,e.is_muted=!n,l.value=(null==(a=null==(t=i.response)?void 0:t.data)?void 0:a.message)||"Error al actualizar la mesa.",console.error(i)}},fetchNotifications:async()=>{try{const e=await Aa.getWaiterNotifications();o.value=e.data}catch(e){console.error("Error fetching notifications:",e)}},handleNotification:async(e,t)=>{var a,n;try{await Aa.handleWaiterNotification(e,{action:t}),o.value=o.value.filter(t=>t.id!==e)}catch(i){l.value=(null==(n=null==(a=i.response)?void 0:a.data)?void 0:n.message)||"Error al procesar la notificación.",console.error(i)}},createProfile:async e=>{var t,a;try{const t=await Aa.createWaiterProfile({name:e});n.value.push(t.data)}catch(i){l.value=(null==(a=null==(t=i.response)?void 0:t.data)?void 0:a.message)||"Error al crear el perfil.",console.error(i)}},deleteProfile:async e=>{var t,a;try{await Aa.deleteWaiterProfile(e),n.value=n.value.filter(t=>t.id!==e)}catch(i){l.value=(null==(a=null==(t=i.response)?void 0:t.data)?void 0:a.message)||"Error al eliminar el perfil.",console.error(i)}},clearWaiterData:()=>{e.value=null,t.value=null,a.value=[],n.value=[],o.value=[],localStorage.removeItem("waiterBusinessId")}}}),C_={class:"onboarding-container"},k_={class:"content-wrapper"},E_=["src"],S_={class:"form-container"},T_=["disabled"],I_={key:0,class:"spinner"},N_={key:1},x_=["onInput","onKeydown"],A_={key:0,class:"error-feedback"},P_=lr({__name:"Onboarding",setup(e){const t=w(),a=__(),n=Xa(),s=i(["","","",""]),r=i(!1),l=i(""),m=i([]),b=e=>{e.preventDefault();const t=e.clipboardData.getData("text").trim().slice(0,4);/^\d{4}$/.test(t)&&(t.split("").forEach((e,t)=>{s.value[t]=e,m.value[t].value=e}),m.value[3].focus(),y())},y=async()=>{const e=s.value.join("");if(4===e.length){r.value=!0,l.value="";try{await a.associateBusiness(e),await n.fetchUser(),t.push({name:"waiter-dashboard"})}catch(i){l.value=i.message||"El código es incorrecto o ha expirado.","vibrate"in navigator&&navigator.vibrate(100)}finally{r.value=!1}}else l.value="El código debe tener 4 dígitos."},_=()=>{t.push("/profile")};return(e,t)=>{var a;return d(),c("div",C_,[u("div",k_,[u("div",{class:"user-header",onClick:_,title:"Editar perfil"},[u("img",{src:(null==(a=o(n).user)?void 0:a.avatar)||"/src/assets/default-avatar.png",alt:"Avatar",class:"user-avatar"},null,8,E_),t[0]||(t[0]=u("div",{class:"business-selector-wrapper",title:"Vincúlate introduciendo un código"},[u("span",null,"Negocio:"),u("select",{disabled:""},[u("option",null,"Ninguno")])],-1))]),u("div",S_,[u("form",{onSubmit:f(y,["prevent"])},[u("button",{type:"submit",class:"btn-primary",disabled:r.value},[r.value?(d(),c("span",I_)):(d(),c("span",N_,"AGREGAR NEGOCIO"))],8,T_),t[1]||(t[1]=u("h2",{class:"code-prompt"},"Código",-1)),u("div",{class:"otp-inputs",onPaste:b},[(d(),c(g,null,v(4,e=>u("input",{key:e,type:"text",inputmode:"numeric",maxlength:"1",class:"otp-box",ref_for:!0,ref:t=>m.value[e-1]=t,onInput:t=>((e,t)=>{const a=e.target;let n=a.value;/^\d*$/.test(n)?(s.value[t-1]=n,n&&a.nextElementSibling&&a.nextElementSibling.focus()):a.value=""})(t,e),onKeydown:e=>{var t;"Backspace"===(t=e).key&&!t.target.value&&t.target.previousElementSibling&&t.target.previousElementSibling.focus()}},null,40,x_)),64))],32)],32),l.value?(d(),c("p",A_,p(l.value),1)):h("",!0)])])])}}},[["__scopeId","data-v-f5df5087"]]),R_={class:"dashboard"},D_={class:"container py-3"},M_={class:"role-section"},L_={class:"role-dropdown me-2"},O_={class:"dropdown-menu","aria-labelledby":"roleMenu"},F_={class:"user-id-container d-flex align-items-center"},U_={class:"user-id me-2"},B_={class:"row mb-3"},q_={class:"col-12"},j_={class:"card"},$_={class:"card-body"},z_={class:"d-flex gap-2"},V_=["disabled"],W_=["disabled"],H_={class:"row g-3 card-grid"},G_={class:"col-6"},Y_={class:"col-6"},K_={class:"col-6"},Q_={class:"col-6"},J_={class:"position-fixed bottom-0 end-0 p-3",style:{"z-index":"11"}},Z_={key:0,class:"toast show",role:"alert","aria-live":"assertive","aria-atomic":"true"},X_={class:"toast-header"},eC={class:"toast-body"};const tC=lr({name:"AdminDashboardView",setup(){const e=w(),t=i("FGT-464"),a=i("admin"),n=i(!1),s=i(""),o=i(!1);return r(()=>{(async()=>{try{t.value="FGT-464"}catch(e){console.error("Error al cargar datos del negocio:",e)}})()}),{businessCode:t,selectedRole:a,showToast:n,toastMessage:s,isSendingNotification:o,copyBusinessCode:()=>{navigator.clipboard.writeText(t.value).then(()=>{n.value=!0,s.value="Código copiado al portapapeles",setTimeout(()=>{n.value=!1},3e3)}).catch(e=>{console.error("Error al copiar al portapapeles:",e)})},sendTestNotification:async()=>{o.value=!0;try{await xa.post("/admin/notifications/test",{waiter_id:"all"});n.value=!0,s.value="Notificación de prueba enviada exitosamente",window.debugPanel&&window.debugPanel.addLog("info","Notificación de prueba enviada a todos los mozos","Admin Dashboard")}catch(e){console.error("Error al enviar notificación de prueba:",e),n.value=!0,s.value="Error al enviar notificación de prueba",window.debugPanel&&window.debugPanel.addLog("error",`Error al enviar notificación: ${e.message}`,"Admin Dashboard",e)}finally{o.value=!1,setTimeout(()=>{n.value=!1},3e3)}},sendTestNotificationToSpecificWaiter:async()=>{const e=prompt("Ingresa el ID del mozo para enviar la notificación de prueba:");if(e){o.value=!0;try{await xa.post("/admin/notifications/test",{waiter_id:e});n.value=!0,s.value=`Notificación de prueba enviada al mozo ${e}`,window.debugPanel&&window.debugPanel.addLog("info",`Notificación de prueba enviada al mozo ${e}`,"Admin Dashboard")}catch(t){console.error("Error al enviar notificación de prueba:",t),n.value=!0,s.value="Error al enviar notificación de prueba",window.debugPanel&&window.debugPanel.addLog("error",`Error al enviar notificación: ${t.message}`,"Admin Dashboard",t)}finally{o.value=!1,setTimeout(()=>{n.value=!1},3e3)}}},handleRoleChange:()=>{"admin"===a.value?a.value="waiter":a.value="admin","waiter"===a.value&&e.push("/waiter")}}}},[["render",function(e,t,a,n,i,s){const o=E("router-link");return d(),c("div",R_,[u("div",D_,[u("div",M_,[u("div",L_,[t[6]||(t[6]=u("button",{class:"btn btn-outline-secondary dropdown-toggle",id:"roleMenu","data-bs-toggle":"dropdown"}," Rol Admin ",-1)),u("ul",O_,[u("li",null,[u("a",{class:"dropdown-item",href:"#",onClick:t[0]||(t[0]=e=>n.selectedRole="admin")},"Admin")]),u("li",null,[u("a",{class:"dropdown-item",href:"#",onClick:t[1]||(t[1]=(...e)=>n.handleRoleChange&&n.handleRoleChange(...e))},"Mozo")])])]),u("div",F_,[u("span",U_,"ID:"+p(n.businessCode),1),u("button",{class:"btn btn-sm btn-outline-secondary",onClick:t[2]||(t[2]=(...e)=>n.copyBusinessCode&&n.copyBusinessCode(...e)),title:"Copiar al portapapeles"},t[7]||(t[7]=[u("i",{class:"bi bi-clipboard"},null,-1)]))])]),u("div",B_,[u("div",q_,[u("div",j_,[u("div",$_,[t[10]||(t[10]=u("h5",{class:"card-title"},[u("i",{class:"bi bi-bell-fill text-primary me-2"}),y(" Prueba de Notificaciones ")],-1)),t[11]||(t[11]=u("p",{class:"card-text text-muted"}," Envía una notificación de prueba a todos los mozos activos para verificar el sistema. ",-1)),u("div",z_,[u("button",{class:"btn btn-primary",onClick:t[3]||(t[3]=(...e)=>n.sendTestNotification&&n.sendTestNotification(...e)),disabled:n.isSendingNotification},[t[8]||(t[8]=u("i",{class:"bi bi-send me-2"},null,-1)),y(" "+p(n.isSendingNotification?"Enviando...":"Enviar Notificación de Prueba"),1)],8,V_),u("button",{class:"btn btn-outline-secondary",onClick:t[4]||(t[4]=(...e)=>n.sendTestNotificationToSpecificWaiter&&n.sendTestNotificationToSpecificWaiter(...e)),disabled:n.isSendingNotification},t[9]||(t[9]=[u("i",{class:"bi bi-person-plus me-2"},null,-1),y(" Enviar a Mozo Específico ")]),8,W_)])])])])]),u("div",H_,[u("div",G_,[b(o,{to:"/admin/qr",class:"card dashboard-card text-center text-decoration-none"},{default:k(()=>t[12]||(t[12]=[u("div",{class:"card-body"},[u("i",{class:"bi bi-qr-code"})],-1),u("div",{class:"card-footer"},"QR",-1)])),_:1,__:[12]})]),u("div",Y_,[b(o,{to:"/admin/stats",class:"card dashboard-card text-center text-decoration-none"},{default:k(()=>t[13]||(t[13]=[u("div",{class:"card-body"},[u("i",{class:"bi bi-graph-up"})],-1),u("div",{class:"card-footer"},"ESTADÍSTICAS",-1)])),_:1,__:[13]})]),u("div",K_,[b(o,{to:"/admin/staff",class:"card dashboard-card text-center text-decoration-none"},{default:k(()=>t[14]||(t[14]=[u("div",{class:"card-body"},[u("i",{class:"bi bi-person-fill"})],-1),u("div",{class:"card-footer"},"PERSONAL",-1)])),_:1,__:[14]})]),u("div",Q_,[b(o,{to:"/admin/settings",class:"card dashboard-card text-center text-decoration-none"},{default:k(()=>t[15]||(t[15]=[u("div",{class:"card-body"},[u("i",{class:"bi bi-gear-fill"})],-1),u("div",{class:"card-footer"},"CONFIGURACIÓN",-1)])),_:1,__:[15]})])])]),u("div",J_,[n.showToast?(d(),c("div",Z_,[u("div",X_,[t[16]||(t[16]=u("strong",{class:"me-auto"},"Notificación",-1)),u("button",{type:"button",class:"btn-close",onClick:t[5]||(t[5]=e=>n.showToast=!1)})]),u("div",eC,p(n.toastMessage),1)])):h("",!0)])])}]]),aC=n("admin",()=>{const e=i(localStorage.getItem("businessId")||null),t=i(null),a=i([]),n=i([]),o=i([]),r=i([]),l=i([]),c=i(null),d=i(!1),u=i(null),h=i({next:null,prev:null}),p=i({current_page:1,last_page:1}),m=s(()=>a.value.length>0),f=s(()=>n.value.length>0),g=s(()=>o.value.filter(e=>"pending"===e.status)),v=async()=>{var e;d.value=!0,u.value=null;try{const t=await Aa.getMenus(),n=(null==(e=t.data)?void 0:e.menus)??t.data,i=Array.isArray(n)?n:[];return a.value=i.map(e=>({id:e.id,name:e.name,url:e.view_url||e.file_path,thumbnailUrl:e.preview_url||e.thumbnail_url||"/src/assets/pdf-thumb.png",isDefault:e.is_default})),a.value}catch(t){throw u.value=t.message||"Error al cargar menús",t}finally{d.value=!1}},b=async()=>{d.value=!0,u.value=null;try{const e=await Aa.getTables();return n.value=e.data.tables||[],!0}catch(e){return u.value=e.message||"Error al obtener mesas",!1}finally{d.value=!1}},w=async()=>{var e;d.value=!0,u.value=null;try{const t=await Aa.getStaffRequests(),a=(null==(e=t.data)?void 0:e.requests)??t.data,n=Array.isArray(a)?a:[];return o.value=n,o.value}catch(t){throw u.value=t.message||"Error al cargar solicitudes de personal",t}finally{d.value=!1}},y=async()=>{var e,t;d.value=!0,u.value=null;try{const a=await Aa.getArchivedStaffRequests(),n=(null==(e=a.data)?void 0:e.archived_requests)??(null==(t=a.data)?void 0:t.requests)??a.data,i=Array.isArray(n)?n:[];return r.value=i,r.value}catch(a){throw u.value=a.message||"Error al cargar solicitudes archivadas",a}finally{d.value=!1}},_=async(e=1)=>{var t,a,n,i,s,o,r,c,m,f;d.value=!0,u.value=null;try{const d="string"==typeof e?await xa.get(e.replace(xa.defaults.baseURL+"/","")):await Aa.getStaff(e),u=(null==(t=d.data)?void 0:t.staff)??(null==(a=d.data)?void 0:a.data)??d.data;return l.value=Array.isArray(u)?u:[],h.value={next:(null==(i=null==(n=d.data)?void 0:n.links)?void 0:i.next)??null,prev:(null==(o=null==(s=d.data)?void 0:s.links)?void 0:o.prev)??null},p.value={current_page:(null==(c=null==(r=d.data)?void 0:r.meta)?void 0:c.current_page)??1,last_page:(null==(f=null==(m=d.data)?void 0:m.meta)?void 0:f.last_page)??1},l.value}catch(g){throw u.value=g.message||"Error al cargar el personal",g}finally{d.value=!1}};return{businessId:e,businessData:t,menus:a,tables:n,staffRequests:o,archivedRequests:r,staff:l,statistics:c,isLoading:d,error:u,staffLinks:h,staffMeta:p,hasMenus:m,hasTables:f,pendingRequests:g,fetchBusinessData:async()=>{d.value=!0,u.value=null;try{return t.value={id:"rest-1",name:"Mi Restaurante",address:"Calle Principal 123",phone:"+34 678 123 456",email:"contacto@mirestaurante.com",logo:"/src/assets/mozo-logo.svg",description:"El mejor restaurante de la ciudad",openingHours:{monday:{open:"12:00",close:"23:00"},tuesday:{open:"12:00",close:"23:00"},wednesday:{open:"12:00",close:"23:00"},thursday:{open:"12:00",close:"23:00"},friday:{open:"12:00",close:"00:00"},saturday:{open:"12:00",close:"00:00"},sunday:{open:"12:00",close:"23:00"}},tables:20,capacity:80,averageRating:4.5},e.value||(e.value=t.value.id,localStorage.setItem("businessId",t.value.id)),t.value}catch(a){throw u.value=a.message||"Error al cargar datos del negocio",a}finally{d.value=!1}},fetchMenus:v,setDefaultMenu:async e=>{d.value=!0,u.value=null;try{return await Aa.setDefaultMenu({menu_id:e}),await v(),!0}catch(t){throw u.value=t.message||"Error al establecer menú predeterminado",t}finally{d.value=!1}},uploadMenu:async e=>{d.value=!0,u.value=null;try{const t=await Aa.uploadMenu(e);return await v(),t.data}catch(t){throw u.value=t.message||"Error al subir menú",t}finally{d.value=!1}},fetchTables:b,createTable:async e=>{d.value=!0,u.value=null;try{await Aa.createTable(e);return await b(),!0}catch(t){return u.value=t.message||"Error al crear mesa",!1}finally{d.value=!1}},updateTable:async(e,t)=>{d.value=!0,u.value=null;try{const a=await Aa.updateTable(e,t),i=n.value.findIndex(t=>t.id===e);return-1!==i&&(n.value[i]=a.data),a.data}catch(a){throw u.value=a.message||"Error al actualizar mesa",a}finally{d.value=!1}},deleteTable:async e=>{d.value=!0,u.value=null;try{return await Aa.deleteTable(e),n.value=n.value.filter(t=>t.id!==e),!0}catch(t){throw u.value=t.message||"Error al eliminar mesa",t}finally{d.value=!1}},fetchStaffRequests:w,fetchArchivedRequests:y,handleStaffRequest:async(e,t)=>{d.value=!0,u.value=null;try{return await Aa.handleStaffRequest(e,{action:t}),await w(),await y(),"confirm"===t&&await _(),!0}catch(a){throw u.value=a.message||"Error al procesar solicitud",a}finally{d.value=!1}},fetchStaff:_,inviteStaff:async e=>{d.value=!0,u.value=null;try{const t=await Aa.inviteStaff(e);return await w(),t.data}catch(t){throw u.value=t.message||"Error al enviar invitación",t}finally{d.value=!1}},fetchDashboardStats:async()=>{var e;d.value=!0,u.value=null;try{const t=await Aa.getAdminStatistics();return(null==(e=t.data)?void 0:e.statistics)??t.data}catch(t){throw u.value=t.message||"Error al cargar estadísticas",t}finally{d.value=!1}},fetchStaffMember:async e=>{var t;d.value=!0,u.value=null;try{const a=await Aa.getStaffMember(e);return(null==(t=a.data)?void 0:t.staff)??a.data}catch(a){throw u.value=a.message||"Error al cargar datos del miembro del personal",a}finally{d.value=!1}},updateStaffMember:async(e,t)=>{d.value=!0,u.value=null;try{const a=await Aa.updateStaffMember(e,t),n=l.value.findIndex(t=>t.id===e);return-1!==n&&(l.value[n]={...l.value[n],...a.data}),a.data}catch(a){throw u.value=a.message||"Error al actualizar miembro del personal",a}finally{d.value=!1}},removeStaff:async e=>{d.value=!0,u.value=null;try{return await Aa.removeStaff(e),l.value=l.value.filter(t=>t.id!==e),!0}catch(t){throw u.value=t.message||"Error al eliminar miembro del personal",t}finally{d.value=!1}},addReview:async(e,t)=>{d.value=!0,u.value=null;try{return(await Aa.addReview(e,t)).data}catch(a){throw u.value=a.message||"Error al añadir reseña",a}finally{d.value=!1}},deleteReview:async(e,t)=>{d.value=!0,u.value=null;try{return await Aa.deleteReview(e,t),!0}catch(a){throw u.value=a.message||"Error al eliminar reseña",a}finally{d.value=!1}},renameMenu:async(e,t)=>{d.value=!0,u.value=null;try{return await Aa.renameMenu(e,{name:t}),await v(),!0}catch(a){return u.value=a.message||"Error al renombrar menú",!1}finally{d.value=!1}},deleteMenu:async e=>{d.value=!0,u.value=null;try{return await Aa.deleteMenu(e),await v(),!0}catch(t){throw u.value=t.message||"Error al eliminar menú",t}finally{d.value=!1}},reorderMenus:async e=>{try{await Aa.reorderMenus(e),a.value.sort((t,a)=>e.indexOf(t.id)-e.indexOf(a.id))}catch(t){console.error("Error reordenando menús",t)}},previewMenu:async e=>{try{const t=await Aa.previewMenu(e);return URL.createObjectURL(t.data)}catch(t){return console.error("Error obteniendo preview",t),null}},cloneTable:async(e,t)=>{d.value=!0;try{const a=await Aa.cloneTable(e,t);n.value.push(a.data)}catch(a){console.error("Error clonando mesa",a)}finally{d.value=!1}},generateQrCode:async e=>{d.value=!0,u.value=null;try{await Aa.generateQRCode(e),await b()}catch(t){throw u.value=t.message||"Error al generar código QR",t}finally{d.value=!1}}}}),nC={class:"dashboard"},iC={class:"container py-3"},sC={class:"role-section"},oC={class:"user-id"},rC={key:0,class:"text-center py-5"},lC={key:1,class:"alert alert-danger"},cC={key:2,class:"row g-3 card-grid"},dC={class:"col-6"},uC={class:"col-6"},hC={class:"col-6"},pC={class:"col-6"},mC={__name:"Home",setup(e){const t=w(),a=aC();Xa();const n=i(!1),s=i(""),l=i({activeRequests:0,pendingRequests:0,totalOrders:0,totalSales:0,salesThisMonth:0});r(async()=>{n.value=!0,s.value="";try{await a.fetchBusinessData(),await a.fetchStaffRequests();const e=await a.fetchDashboardStats();l.value=e}catch(e){s.value=e.message||"Error al cargar datos del negocio"}finally{n.value=!1}});const h=e=>{t.push({name:e})};return(e,t)=>(d(),c("div",nC,[u("div",iC,[u("div",sC,[t[5]||(t[5]=D('<div class="role-dropdown me-2"><button class="btn btn-outline-secondary dropdown-toggle" id="roleMenu" data-bs-toggle="dropdown"> Rol Admin </button><ul class="dropdown-menu" aria-labelledby="roleMenu"><li><a class="dropdown-item" href="#">Admin</a></li><li><a class="dropdown-item" href="#">Mozo</a></li></ul></div>',1)),u("span",oC,"ID:"+p(o(a).businessId),1)]),n.value?(d(),c("div",rC,t[6]||(t[6]=[u("div",{class:"spinner-border text-primary",role:"status"},[u("span",{class:"visually-hidden"},"Cargando...")],-1),u("p",{class:"mt-2"},"Cargando...",-1)]))):s.value?(d(),c("div",lC,[u("p",null,p(s.value),1),u("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=t=>e.$router.go(0))}," Reintentar ")])):(d(),c("div",cC,[u("div",dC,[u("a",{href:"#",onClick:t[1]||(t[1]=f(e=>h("admin-qr"),["prevent"])),class:"card dashboard-card text-center text-decoration-none"},t[7]||(t[7]=[u("div",{class:"card-body"},[u("i",{class:"bi bi-qr-code"})],-1),u("div",{class:"card-footer"},"QR",-1)]))]),u("div",uC,[u("a",{href:"#",onClick:t[2]||(t[2]=f(e=>h("admin-stats"),["prevent"])),class:"card dashboard-card text-center text-decoration-none"},t[8]||(t[8]=[u("div",{class:"card-body"},[u("i",{class:"bi bi-graph-up"})],-1),u("div",{class:"card-footer"},"ESTADÍSTICAS",-1)]))]),u("div",hC,[u("a",{href:"#",onClick:t[3]||(t[3]=f(e=>h("admin-staff"),["prevent"])),class:"card dashboard-card text-center text-decoration-none"},t[9]||(t[9]=[u("div",{class:"card-body"},[u("i",{class:"bi bi-person-fill"})],-1),u("div",{class:"card-footer"},"PERSONAL",-1)]))]),u("div",pC,[u("a",{href:"#",onClick:t[4]||(t[4]=f(e=>h("admin-settings"),["prevent"])),class:"card dashboard-card text-center text-decoration-none"},t[10]||(t[10]=[u("div",{class:"card-body"},[u("i",{class:"bi bi-gear-fill"})],-1),u("div",{class:"card-footer"},"CONFIGURACIÓN",-1)]))])]))])]))}},fC={class:"modal-content rounded-4"},gC={class:"modal-header"},vC={class:"modal-title"},bC={class:"modal-body"},wC={key:0,class:"modal-footer"},yC=lr({__name:"BaseModal",props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:""},size:{type:String,default:"",validator:e=>["","sm","lg","xl"].includes(e)},centered:{type:Boolean,default:!0},scrollable:{type:Boolean,default:!1},staticBackdrop:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,n=t,o=i(null);let l=null;r(()=>{o.value&&(l=new z(o.value,{backdrop:!a.staticBackdrop||"static",keyboard:!a.staticBackdrop}),o.value.addEventListener("hidden.bs.modal",()=>{n("update:modelValue",!1)}),a.modelValue&&l.show())}),M(()=>{l&&l.dispose()}),P(()=>a.modelValue,e=>{!l&&o.value&&(l=new z(o.value,{backdrop:!a.staticBackdrop||"static",keyboard:!a.staticBackdrop})),e&&l?l.show():!e&&l&&l.hide()});const f=s(()=>{const e=["modal-dialog"];return a.centered&&e.push("modal-dialog-centered"),a.scrollable&&e.push("modal-dialog-scrollable"),a.size&&e.push(`modal-${a.size}`),e.join(" ")});return(t,a)=>(d(),c("div",{ref_key:"modalElement",ref:o,class:"modal fade",tabindex:"-1","aria-hidden":"true"},[u("div",{class:m(f.value)},[u("div",fC,[u("div",gC,[u("h5",vC,p(e.title),1),u("button",{type:"button",class:"btn-close",onClick:a[0]||(a[0]=e=>n("update:modelValue",!1)),"aria-label":"Close"})]),u("div",bC,[L(t.$slots,"default",{},void 0)]),t.$slots.footer?(d(),c("div",wC,[L(t.$slots,"footer",{},void 0)])):h("",!0)])],2)],512))}},[["__scopeId","data-v-aefedeba"]]),_C={class:"mb-3"},CC={class:"form-label"},kC=["type","placeholder"],EC=["disabled"],SC={__name:"InputModal",props:{modelValue:Boolean,title:{type:String,default:"Ingresar dato"},label:{type:String,default:""},placeholder:{type:String,default:""},defaultValue:{type:[String,Number],default:""},inputType:{type:String,default:"text"}},emits:["update:modelValue","confirm"],setup(e,{emit:t}){const a=e,n=t,s=i(a.defaultValue);P(()=>a.modelValue,e=>{e&&(s.value=a.defaultValue)});const o=()=>{const e="number"===a.inputType?s.value:s.value.trim();n("confirm",e),n("update:modelValue",!1)};return(t,a)=>(d(),C(yC,{"model-value":e.modelValue,"onUpdate:modelValue":a[2]||(a[2]=e=>t.$emit("update:modelValue",e)),title:e.title,size:"sm"},{footer:k(()=>[u("button",{class:"btn btn-secondary",onClick:a[1]||(a[1]=e=>t.$emit("update:modelValue",!1))},"Cancelar"),u("button",{class:"btn btn-primary",disabled:!s.value.toString().trim(),onClick:o},"Aceptar",8,EC)]),default:k(()=>[u("div",_C,[u("label",CC,p(e.label),1),I(u("input",{type:e.inputType,class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),placeholder:e.placeholder},null,8,kC),[[O,s.value]])])]),_:1},8,["model-value","title"]))}},TC=lr({__name:"SkeletonLoader",props:{width:{type:String,default:"100%"},height:{type:String,default:"1rem"},borderRadius:{type:String,default:"4px"}},setup:e=>(t,a)=>(d(),c("div",{class:"skeleton",style:F({width:e.width,height:e.height,borderRadius:e.borderRadius})},null,4))},[["__scopeId","data-v-7bfd6ab9"]]),IC={class:"menu-card-skeleton"},NC={class:"skeleton-info"},xC=lr({__name:"MenuCardSkeleton",setup:e=>(e,t)=>(d(),c("div",IC,[b(TC,{height:"150px",borderRadius:"12px 12px 0 0"}),u("div",NC,[b(TC,{width:"70%",height:"1.25rem",borderRadius:"4px"}),b(TC,{width:"40%",height:"1rem",borderRadius:"4px",style:{"margin-top":"8px"}})])]))},[["__scopeId","data-v-01f8ef4d"]]),AC={class:"table-item-skeleton"},PC=lr({__name:"TableListItemSkeleton",setup:e=>(e,t)=>(d(),c("div",AC,[b(TC,{width:"80%",height:"24px",borderRadius:"6px"})]))},[["__scopeId","data-v-41c50015"]]),RC={class:"qr-container"},DC={class:"tabs-container"},MC={class:"tabs-header d-flex justify-content-center align-items-center"},LC={key:0,class:"loading-container"},OC={key:1,class:"alert alert-danger"},FC={class:"qr-content"},UC={key:0,class:"qr-layout"},BC={class:"tables-panel"},qC={class:"select-all-container"},jC=["checked"],$C={key:0,class:"tables-list"},zC={key:1,class:"tables-list"},VC=["onClick"],WC=["checked","onChange"],HC={class:"qr-panel"},GC={key:0,class:"qr-display-multiple"},YC={class:"share-buttons"},KC={key:1,class:"qr-display"},QC={class:"qr-table-name"},JC={key:0,class:"qr-code-item"},ZC={key:0,class:"qr-image-loader"},XC=["src"],ek={key:2,class:"qr-image-error"},tk={class:"share-buttons"},ak={key:1,class:"no-qr-codes"},nk={key:2,class:"qr-placeholder"},ik={key:1,class:"menu-layout"},sk={key:0,class:"menu-grid"},ok={key:1,class:"menu-grid"},rk=["onClick"],lk={class:"card-content"},ck={class:"menu-info"},dk={class:"menu-name"},uk={key:0,class:"menu-badge"},hk=["onClick"],pk=["onClick"],mk=["onClick"],fk=["onClick"],gk=["onClick"],vk={key:0,class:"processing-overlay"},bk={class:"download-modal-content"},wk={class:"form-group"},yk={class:"email-modal-content"},_k={class:"form-group"},Ck={class:"form-group"},kk={class:"form-group"},Ek={class:"form-group"},Sk=lr({__name:"QR",setup(e){w();const t=aC(),a=s(()=>t.isLoading),n=s(()=>t.error),o=s(()=>t.tables),l=s(()=>t.menus),_=i(null);i("");const C=i(localStorage.getItem("adminQRTab")||"tables"),E=i(!1),S=i(""),T=i(null),x=i(null),A=i([]),D=i(!1),M=i("pdf");let L=[];const O=i(""),F=i(!1),U=i(!1),B=i("pdf"),q=i(""),j=i("Mesas QR"),$=i("Te comparto los códigos.");let z=[];const V=e=>A.value.some(t=>t.id===e.id),W=e=>{e.target.checked?A.value=[...o.value]:A.value=[]},H=e=>{C.value=e,localStorage.setItem("adminQRTab",e)},G=()=>{S.value="",E.value=!0},Y=async e=>{const a=parseInt(e,10);if(isNaN(a)||a<=0)ir("Por favor, ingresa un número de mesa válido y mayor a cero.");else try{await t.createTable({number:a}),nr("Mesa creada correctamente")}catch(n){ir(n.message||"Error al crear la mesa")}},K=async()=>{if(_.value)try{await t.generateQrCode(_.value.id),nr("Se ha procesado el QR para la mesa.")}catch(e){ir(e.message||"Error al generar código QR")}},Q=async()=>{const{value:e}=await tr.fire({title:"Selecciona un PDF",input:"file",inputAttributes:{accept:"application/pdf"},confirmButtonText:"Subir",showCancelButton:!0,cancelButtonText:"Cancelar"});if(!e)return;if(e.size>10485760)return void ir("El archivo supera los 10 MB");const{value:a}=await tr.fire({title:"Nombre del menú",input:"text",inputValue:e.name.replace(/\.pdf$/i,""),showCancelButton:!0,confirmButtonText:"Guardar"});if(!a)return;const n=new FormData;n.append("file",e),n.append("name",a),await t.uploadMenu(n),nr("Menú subido")},J=e=>{L=e,D.value=!0},Z=async()=>{D.value=!1;const e=L.filter(e=>e.qr_code&&e.qr_code.id).map(e=>e.qr_code.id);if(0===e.length)return void ir("Ninguna de las mesas seleccionadas tiene un QR para exportar.");const t=M.value;try{const a=await xa.post("/admin/qr/export",{qr_ids:e,format:t},{responseType:"blob"}),n=window.URL.createObjectURL(a.data),i=document.createElement("a");i.href=n;const s=a.headers["content-disposition"];let o;if(s){const e=s.match(/filename="(.+)"/);e&&2===e.length&&(o=e[1])}if(!o){const a=t;if(1===e.length){o=`QR_Mesa_${L.find(t=>t.qr_code&&t.qr_code.id===e[0]).number}.${a}`}else o=`QRs_Export.${a}`}i.download=o,document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(n)}catch(a){ir("Error al exportar los códigos QR.")}},X=e=>{z=e,U.value=!0},ee=async()=>{U.value=!1;const e=q.value.split(",").map(e=>e.trim()).filter(e=>e);if(0===e.length)return void ir("Ingresa al menos un destinatario.");const t=z.filter(e=>e.qr_code&&e.qr_code.id).map(e=>e.qr_code.id);if(0===t.length)return void ir("Ninguna de las mesas seleccionadas tiene un QR para enviar.");const a={qr_ids:t,format:B.value,recipients:e,subject:j.value,body:$.value};try{await xa.post("/admin/qr/email",a),nr("Correo enviado correctamente.")}catch(n){ir(n.message||"Error al enviar el correo.")}};return r(()=>{t.fetchTables(),t.fetchMenus()}),P(_,async e=>{if(O.value&&(URL.revokeObjectURL(O.value),O.value=""),e&&e.qr_code){F.value=!0;try{const t=await xa.get(`/admin/qr/preview/${e.id}`,{responseType:"blob"});O.value=URL.createObjectURL(t.data)}catch(t){console.error("Error fetching QR code image:",t),ir("No se pudo cargar la imagen del QR.")}finally{F.value=!1}}}),(e,i)=>(d(),c("div",RC,[u("div",DC,[u("div",MC,[u("button",{class:m(["tab-button",{active:"tables"===C.value}]),onClick:i[0]||(i[0]=e=>H("tables"))}," MESAS ",2),u("button",{class:m(["tab-button",{active:"menus"===C.value}]),onClick:i[1]||(i[1]=e=>H("menus"))}," MENÚ ",2)])]),a.value&&!o.value.length?(d(),c("div",LC,i[19]||(i[19]=[u("div",{class:"loading-spinner"},null,-1),u("p",null,"Cargando datos...",-1)]))):h("",!0),n.value&&!a.value?(d(),c("div",OC,p(n.value),1)):h("",!0),u("div",FC,["tables"===C.value?(d(),c("div",UC,[u("div",BC,[i[21]||(i[21]=u("h2",{class:"panel-title"},"Selecciona una mesa",-1)),u("div",qC,[u("input",{type:"checkbox",onChange:W,checked:o.value.length>0&&A.value.length===o.value.length,class:"form-check-input"},null,40,jC),i[20]||(i[20]=u("label",null,"Seleccionar todo",-1))]),a.value?(d(),c("div",$C,[(d(),c(g,null,v(8,e=>b(PC,{key:e})),64))])):(d(),c("div",zC,[(d(!0),c(g,null,v(o.value,e=>(d(),c("div",{key:e.id,class:m(["table-item",{active:_.value&&_.value.id===e.id}]),onClick:t=>(e=>{_.value=e})(e)},[u("input",{type:"checkbox",checked:V(e),onChange:t=>(e=>{const t=A.value.findIndex(t=>t.id===e.id);-1===t?A.value.push(e):A.value.splice(t,1)})(e),onClick:i[2]||(i[2]=f(()=>{},["stop"])),class:"form-check-input"},null,40,WC),u("span",null,p((e.name||`MESA ${e.number}`).toUpperCase()),1)],10,VC))),128))])),u("button",{class:"add-table-btn",onClick:G},"MESA ＋")]),u("div",HC,[A.value.length>0?(d(),c("div",GC,[u("h3",null,p(A.value.length)+" mesa(s) seleccionada(s)",1),i[24]||(i[24]=u("p",null,"Selecciona una acción para aplicar a todas las mesas seleccionadas.",-1)),u("div",YC,[u("button",{onClick:i[3]||(i[3]=e=>J(A.value)),class:"share-btn download"},i[22]||(i[22]=[u("i",{class:"bi bi-download"},null,-1),y(" Descargar QRs ")])),u("button",{onClick:i[4]||(i[4]=e=>X(A.value)),class:"share-btn email"},i[23]||(i[23]=[u("i",{class:"bi bi-envelope-fill"},null,-1),y(" Enviar por correo ")]))])])):_.value?(d(),c("div",KC,[u("h3",QC,"Mesa "+p(_.value.number),1),_.value.qr_code?(d(),c("div",JC,[F.value?(d(),c("div",ZC,i[25]||(i[25]=[u("div",{class:"loading-spinner-small"},null,-1)]))):O.value?(d(),c("img",{key:1,src:O.value,alt:"Código QR",class:"qr-image"},null,8,XC)):(d(),c("div",ek,i[26]||(i[26]=[u("i",{class:"bi bi-exclamation-triangle-fill"},null,-1),u("span",null,"Error al cargar QR",-1)]))),u("div",tk,[u("button",{onClick:i[5]||(i[5]=e=>J([_.value])),class:"share-btn download"},i[27]||(i[27]=[u("i",{class:"bi bi-download"},null,-1),y(" Descargar ")])),u("button",{onClick:i[6]||(i[6]=e=>(async e=>{if(e&&e.qr_code)try{const t=await xa.post("/admin/qr/export",{qr_ids:[e.qr_code.id],format:"png"},{responseType:"blob"}),a=new File([t.data],`QR_Mesa_${e.number}.png`,{type:"image/png"});if(navigator.canShare&&navigator.canShare({files:[a]}))await navigator.share({files:[a],title:`Código QR para Mesa ${e.number}`,text:`Aquí está el código QR para la mesa ${e.number}.`});else{const e=window.URL.createObjectURL(a),t=document.createElement("a");t.href=e,t.download=a.name,document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(e),nr("Archivo descargado (el navegador no admite compartir).")}}catch(t){"AbortError"!==t.name&&ir("Error al intentar compartir el código QR.")}else ir("La mesa no tiene un QR para compartir.")})(_.value)),class:"share-btn share"},i[28]||(i[28]=[u("i",{class:"bi bi-share-fill"},null,-1),y(" Compartir ")])),u("button",{onClick:i[7]||(i[7]=e=>X([_.value])),class:"share-btn email"},i[29]||(i[29]=[u("i",{class:"bi bi-envelope-fill"},null,-1),y(" Enviar ")]))]),u("button",{class:"btn btn-secondary mt-3",onClick:K},"Regenerar QR")])):(d(),c("div",ak,[i[30]||(i[30]=u("p",null,"Esta mesa aún no tiene un código QR.",-1)),u("button",{class:"btn btn-primary mt-3",onClick:K},"Generar QR")]))])):(d(),c("div",nk,i[31]||(i[31]=[u("p",null,"Selecciona una mesa para ver su código QR",-1)])))])])):(d(),c("div",ik,[i[39]||(i[39]=u("div",{class:"row mb-3"},[u("div",{class:"col-12 d-flex flex-column align-items-start justify-content-start"},[u("h2",null,"Menús"),u("p",{class:"text-left"},"Administra tus menús para que tus clientes puedan escanearlos y verlos en su mesa.")])],-1)),a.value?(d(),c("div",sk,[(d(),c(g,null,v(6,e=>b(xC,{key:e})),64))])):(d(),c("div",ok,[(d(!0),c(g,null,v(l.value,e=>(d(),c("div",{key:e.id,class:m(["menu-card",{default:e.isDefault,processing:x.value===e.id}]),onClick:t=>{return a=e.id,void(T.value=T.value===a?null:a);var a}},[u("div",lk,[i[32]||(i[32]=u("div",{class:"menu-cover"},null,-1)),u("div",ck,[u("span",dk,p(e.name),1),e.isDefault?(d(),c("span",uk,"PREDETERMINADO")):h("",!0)])]),u("div",{class:m(["menu-actions",{show:T.value===e.id}]),onClick:i[8]||(i[8]=f(()=>{},["stop"]))},[e.isPredefined?h("",!0):(d(),c("button",{key:0,onClick:a=>(async e=>{x.value=e.id;try{await t.setDefaultMenu(e.id),nr("Menú predeterminado actualizado"),T.value=null}catch(a){ir(a.message||"Error al establecer menú predeterminado")}finally{x.value=null}})(e),class:"action-item"},i[33]||(i[33]=[u("span",{class:"action-icon select"},[u("i",{class:"bi bi-check-lg"})],-1),u("span",{class:"action-label"},"Seleccionar",-1)]),8,hk)),u("button",{onClick:a=>(async e=>{const a=await t.previewMenu(e.id);a&&window.open(a,"_blank")})(e),class:"action-item"},i[34]||(i[34]=[u("span",{class:"action-icon view"},[u("i",{class:"bi bi-eye-fill"})],-1),u("span",{class:"action-label"},"Ver",-1)]),8,pk),u("button",{onClick:a=>(async e=>{const{value:a}=await tr.fire({title:"Nuevo nombre",input:"text",inputValue:e.name,showCancelButton:!0});if(a&&a!==e.name){x.value=e.id;try{await t.renameMenu(e.id,a),nr("Nombre cambiado"),T.value=null}catch(n){ir(n.message||"Error al renombrar menú")}finally{x.value=null}}})(e),class:"action-item"},i[35]||(i[35]=[u("span",{class:"action-icon rename"},[u("i",{class:"bi bi-pencil-fill"})],-1),u("span",{class:"action-label"},"Renombrar",-1)]),8,mk),u("button",{onClick:t=>(async e=>{x.value=e.id;try{const t=await xa.get(`/menus/${e.id}/download`,{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=a;const i=t.headers["content-disposition"];let s=`${e.name}.pdf`;if(i){const e=i.match(/filename="(.+)"/);e&&2===e.length&&(s=e[1])}n.setAttribute("download",s),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(a),T.value=null}catch(t){ir(t.message||"Error al descargar el archivo.")}finally{x.value=null}})(e),class:"action-item"},i[36]||(i[36]=[u("span",{class:"action-icon download"},[u("i",{class:"bi bi-download"})],-1),u("span",{class:"action-label"},"Descargar",-1)]),8,fk),e.isPredefined?h("",!0):(d(),c("button",{key:1,onClick:a=>(async e=>{if(e.isPredefined)return void ir("No puedes eliminar el menú predeterminado.");if((await tr.fire({title:`¿Eliminar "${e.name}"?`,text:"Esta acción es irreversible",icon:"warning",showCancelButton:!0})).isConfirmed){x.value=e.id;try{await t.deleteMenu(e.id),nr("Menú eliminado"),T.value=null}catch(a){ir(a.message||"Error al eliminar el menú")}finally{x.value=null}}})(e),class:"action-item"},i[37]||(i[37]=[u("span",{class:"action-icon delete"},[u("i",{class:"bi bi-trash-fill"})],-1),u("span",{class:"action-label"},"Eliminar",-1)]),8,gk))],2),x.value===e.id?(d(),c("div",vk,i[38]||(i[38]=[u("div",{class:"loading-spinner-small"},null,-1)]))):h("",!0)],10,rk))),128)),u("div",{class:"add-menu-card w-100",onClick:Q}," ＋ Agregar menú (PDF) ")]))]))]),b(SC,{modelValue:E.value,"onUpdate:modelValue":i[9]||(i[9]=e=>E.value=e),title:"Nueva mesa",label:"Número de la mesa",placeholder:"Ej: 5","input-type":"number",onConfirm:Y},null,8,["modelValue"]),b(yC,{modelValue:D.value,"onUpdate:modelValue":i[12]||(i[12]=e=>D.value=e),title:"Exportar Códigos QR"},{footer:k(()=>[u("button",{class:"btn btn-secondary",onClick:i[11]||(i[11]=e=>D.value=!1)},"Cancelar"),u("button",{class:"btn btn-primary",onClick:Z},"Descargar")]),default:k(()=>[u("div",bk,[i[42]||(i[42]=u("p",null,"Selecciona el formato en el que deseas descargar los códigos QR.",-1)),u("div",wk,[i[41]||(i[41]=u("label",{for:"format-select"},"Formato:",-1)),I(u("select",{id:"format-select","onUpdate:modelValue":i[10]||(i[10]=e=>M.value=e),class:"form-control"},i[40]||(i[40]=[u("option",{value:"pdf"},"PDF",-1),u("option",{value:"png"},"PNG",-1),u("option",{value:"svg"},"SVG",-1),u("option",{value:"zip"},"ZIP (PNGs comprimidos)",-1)]),512),[[R,M.value]])])])]),_:1},8,["modelValue"]),b(yC,{modelValue:U.value,"onUpdate:modelValue":i[18]||(i[18]=e=>U.value=e),title:"Enviar Códigos QR por Email"},{footer:k(()=>[u("button",{class:"btn btn-secondary",onClick:i[17]||(i[17]=e=>U.value=!1)},"Cancelar"),u("button",{class:"btn btn-primary",onClick:ee},"Enviar")]),default:k(()=>[u("div",yk,[u("div",_k,[i[43]||(i[43]=u("label",{for:"recipients-input"},"Destinatarios (separa correos con coma):",-1)),I(u("input",{id:"recipients-input","onUpdate:modelValue":i[13]||(i[13]=e=>q.value=e),type:"text",class:"form-control",placeholder:"ej: correo@dominio.com, otro@dominio.com"},null,512),[[N,q.value]])]),u("div",Ck,[i[44]||(i[44]=u("label",{for:"subject-input"},"Asunto:",-1)),I(u("input",{id:"subject-input","onUpdate:modelValue":i[14]||(i[14]=e=>j.value=e),type:"text",class:"form-control"},null,512),[[N,j.value]])]),u("div",kk,[i[45]||(i[45]=u("label",{for:"body-input"},"Mensaje:",-1)),I(u("textarea",{id:"body-input","onUpdate:modelValue":i[15]||(i[15]=e=>$.value=e),class:"form-control",rows:"3"},null,512),[[N,$.value]])]),u("div",Ek,[i[47]||(i[47]=u("label",{for:"email-format-select"},"Formato:",-1)),I(u("select",{id:"email-format-select","onUpdate:modelValue":i[16]||(i[16]=e=>B.value=e),class:"form-control"},i[46]||(i[46]=[u("option",{value:"pdf"},"PDF",-1),u("option",{value:"png"},"PNG",-1)]),512),[[R,B.value]])])])]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-f41c6eb0"]]),Tk={class:"stats-container"};const Ik=lr({},[["render",function(e,t){return d(),c("div",Tk,t[0]||(t[0]=[u("div",{class:"coming-soon-container"},[u("i",{class:"bi bi-bar-chart-line-fill icon"}),u("h1",null,"Estadísticas"),u("p",null,"Esta sección estará disponible próximamente."),u("p",null,"Estamos trabajando para ofrecerte los mejores análisis para tu negocio.")],-1)]))}],["__scopeId","data-v-29de642f"]]),Nk=["type","disabled"],xk={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Ak={__name:"BaseButton",props:{variant:{type:String,default:"primary",validator:e=>["primary","secondary","outline-primary","outline-secondary","success","danger","warning","info","light","dark","link"].includes(e)},size:{type:String,default:"",validator:e=>["","sm","lg"].includes(e)},block:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},type:{type:String,default:"button"}},emits:["click"],setup(e,{emit:t}){const a=e,n=t,i=s(()=>{const e=["btn"];return e.push(`btn-${a.variant}`),a.size&&e.push(`btn-${a.size}`),a.block&&e.push("w-100"),a.loading&&e.push("position-relative"),e.join(" ")}),o=e=>{a.disabled||a.loading||n("click",e)};return(t,a)=>(d(),c("button",{type:e.type,class:m(i.value),disabled:e.disabled||e.loading,onClick:o},[e.loading?(d(),c("div",xk)):h("",!0),u("span",{class:m({"opacity-0":e.loading})},[L(t.$slots,"default",{},void 0)],2)],10,Nk))}},Pk=lr(Ak,[["__scopeId","data-v-9b101dda"]]),Rk={class:"request-card"},Dk={class:"requester-info"},Mk=["src","alt"],Lk={class:"text-info"},Ok={class:"name"},Fk={class:"position"},Uk={class:"actions"},Bk={__name:"RequestCard",props:{request:{type:Object,required:!0},isArchived:{type:Boolean,default:!1}},emits:["confirm","archive","reject","unarchive"],setup:(e,{emit:t})=>(t,a)=>(d(),c("div",Rk,[e.isArchived?h("",!0):(d(),c("button",{key:0,class:"close-button",onClick:a[0]||(a[0]=f(a=>t.$emit("reject",e.request),["stop"]))},a[5]||(a[5]=[u("i",{class:"bi bi-x"},null,-1)]))),u("div",Dk,[u("img",{src:e.request.avatar,alt:`Avatar de ${e.request.name}`,class:"avatar"},null,8,Mk),u("div",Lk,[u("h4",Ok,p(e.request.name),1),u("p",Fk,p(e.request.position),1)])]),u("div",Uk,[e.isArchived?(d(),c("button",{key:1,class:"btn btn-primary",onClick:a[4]||(a[4]=f(a=>t.$emit("unarchive",e.request),["stop"]))},a[9]||(a[9]=[u("i",{class:"bi bi-arrow-counterclockwise"},null,-1),y(" Desarchivar ")]))):(d(),c(g,{key:0},[u("button",{class:"btn btn-primary",onClick:a[1]||(a[1]=f(a=>t.$emit("confirm",e.request),["stop"]))},a[6]||(a[6]=[u("i",{class:"bi bi-check-lg"},null,-1),y(" Confirmar ")])),u("button",{class:"btn btn-secondary",onClick:a[2]||(a[2]=f(a=>t.$emit("archive",e.request),["stop"]))},a[7]||(a[7]=[u("i",{class:"bi bi-archive"},null,-1),y(" Archivar ")])),u("button",{class:"btn btn-danger",onClick:a[3]||(a[3]=f(a=>t.$emit("reject",e.request),["stop"]))},a[8]||(a[8]=[u("i",{class:"bi bi-x-lg"},null,-1),y(" Rechazar ")]))],64))])]))},qk=lr(Bk,[["__scopeId","data-v-ecca35ff"]]),jk={class:"staff-avatar"},$k=["src","alt"],zk={class:"employee-name"},Vk={class:"staff-info"},Wk={class:"rating-container"},Hk={class:"stars"},Gk={class:"comments-count"},Yk={__name:"StaffCard",props:{employee:{type:Object,required:!0}},emits:["view","remove"],setup(e,{emit:t}){const a=e,n=t,i=()=>{n("view",a.employee)},s=e=>{e.stopPropagation(),n("remove",a.employee)};return(t,a)=>(d(),c("div",{class:"staff-card",onClick:i},[u("button",{class:"remove-button",onClick:s},a[0]||(a[0]=[u("i",{class:"bi bi-x"},null,-1)])),u("div",jk,[u("img",{src:e.employee.avatar||"https://randomuser.me/api/portraits/men/32.jpg",alt:e.employee.name,class:"avatar-image"},null,8,$k)]),u("h3",zk,p(e.employee.name),1),u("div",Vk,[u("div",Wk,[u("div",Hk,[(d(),c(g,null,v(5,t=>u("i",{key:t,class:m(["bi",t<=Math.round(e.employee.rating||0)?"bi-star-fill":"bi-star"])},null,2)),64))]),u("div",Gk,[a[1]||(a[1]=u("i",{class:"bi bi-chat-left-text"},null,-1)),u("span",null,p(e.employee.reviewsCount||0)+" comentarios",1)])])])]))}},Kk=lr(Yk,[["__scopeId","data-v-b19334dd"]]),Qk={class:"staff-card-skeleton"},Jk={class:"avatar-skeleton"},Zk={class:"info-skeleton"},Xk={__name:"StaffCardSkeleton",setup:e=>(e,t)=>(d(),c("div",Qk,[u("div",Jk,[b(TC,{width:"64px",height:"64px",borderRadius:"50%"})]),u("div",Zk,[b(TC,{width:"60%",height:"1.2rem",borderRadius:"4px"}),b(TC,{width:"40%",height:"1rem",borderRadius:"4px",style:{"margin-top":"8px"}})])]))},eE=lr(Xk,[["__scopeId","data-v-77a45dbe"]]),tE={class:"request-card-skeleton"},aE={class:"info-skeleton"},nE={class:"actions-skeleton"},iE={__name:"RequestCardSkeleton",setup:e=>(e,t)=>(d(),c("div",tE,[u("div",aE,[b(TC,{width:"50%",height:"1.1rem",borderRadius:"4px"}),b(TC,{width:"30%",height:"0.9rem",borderRadius:"4px",style:{"margin-top":"8px"}})]),u("div",nE,[b(TC,{width:"40px",height:"40px",borderRadius:"50%"}),b(TC,{width:"40px",height:"40px",borderRadius:"50%"})])]))},sE=lr(iE,[["__scopeId","data-v-8e0a7703"]]),oE={class:"staff-page"},rE={class:"page-header"},lE={key:0,class:"header-stats"},cE={class:"stat-item"},dE={class:"stat-value"},uE={class:"stat-item"},hE={class:"stat-value"},pE={key:0,class:"loading-container"},mE={key:1,class:"error-container"},fE={class:"error-message"},gE={key:2,class:"staff-content"},vE={class:"staff-section"},bE={class:"section-header"},wE={class:"section-title"},yE={key:0,class:"badge bg-primary rounded-pill"},_E={key:0,class:"section-actions"},CE={key:0,class:"requests-list"},kE={key:1},EE={key:0,class:"text-center p-4 text-muted"},SE={key:1,class:"requests-list"},TE={class:"staff-section"},IE={class:"section-header"},NE={key:0,class:"staff-grid"},xE={key:1,class:"staff-grid"},AE={key:0},PE={key:2,class:"pagination-container"},RE=["disabled"],DE=["disabled"],ME={class:"invite-form"},LE={class:"form-group"},OE={class:"form-group"},FE=["disabled"],UE={key:0},BE={key:1},qE=["disabled"],jE={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},$E={__name:"Staff",setup(e){const t=w(),a=aC(),n=i(!1),o=i(""),l=s(()=>a.staff),m=s(()=>a.staffRequests),f=s(()=>a.archivedRequests),_=i(!1),E=i(!1);i(!1),i(!1);const S=i(null);i(null);const T=i(""),x=i(""),A=i("waiter"),P=i(!1),D=s(()=>a.staffLinks),M=s(()=>a.staffMeta),L=s(()=>{if(!l.value.length)return[];let e=[...l.value];if(T.value){const t=T.value.toLowerCase();e=e.filter(e=>{var a,n,i;return(null==(a=e.name)?void 0:a.toLowerCase().includes(t))||(null==(n=e.email)?void 0:n.toLowerCase().includes(t))||(null==(i=e.position)?void 0:i.toLowerCase().includes(t))})}return e}),O=s(()=>P.value?f.value:m.value),F=s(()=>{if(!l.value.length)return{total:0,avgRating:0};const e=l.value.length;return{total:e,avgRating:(l.value.reduce((e,t)=>e+(t.rating||0),0)/e).toFixed(1)}});r(async()=>{n.value=!0,o.value="";try{await Promise.all([a.fetchStaff(),a.fetchStaffRequests(),a.fetchArchivedRequests()])}catch(e){o.value=e.message||"Error al cargar datos de personal"}finally{n.value=!1}});const U=async()=>{if(x.value&&A.value){n.value=!0,o.value="";try{await a.inviteStaff({email:x.value,role:A.value}),x.value="",A.value="waiter",_.value=!1}catch(e){o.value=e.message||"Error al enviar invitación"}finally{n.value=!1}}else o.value="Por favor, completa todos los campos"},B=async e=>{n.value=!0,o.value="";try{await a.handleStaffRequest(e.id,"confirm")}catch(t){o.value=t.message||"Error al confirmar solicitud"}finally{n.value=!1}},q=async e=>{n.value=!0,o.value="";try{await a.handleStaffRequest(e.id,"archive")}catch(t){o.value=t.message||"Error al archivar solicitud"}finally{n.value=!1}},j=async e=>{n.value=!0,o.value="";try{await a.handleStaffRequest(e.id,"unarchive")}catch(t){o.value=t.message||"Error al desarchivar solicitud"}finally{n.value=!1}},$=async e=>{n.value=!0,o.value="";try{await a.handleStaffRequest(e.id,"reject")}catch(t){o.value=t.message||"Error al rechazar solicitud"}finally{n.value=!1}},z=async()=>{if(m.value.length){n.value=!0,o.value="";try{for(const e of m.value)await a.handleStaffRequest(e.id,"confirm")}catch(e){o.value=e.message||"Error al confirmar todas las solicitudes"}finally{n.value=!1}}},V=async()=>{if(m.value.length){n.value=!0,o.value="";try{for(const e of m.value)await a.handleStaffRequest(e.id,"archive")}catch(e){o.value=e.message||"Error al archivar todas las solicitudes"}finally{n.value=!1}}},W=e=>{S.value=e,E.value=!0},H=async()=>{if(S.value){n.value=!0,o.value="";try{await a.removeStaff(S.value.id),E.value=!1,S.value=null}catch(e){o.value=e.message||"Error al eliminar miembro del personal"}finally{n.value=!1}}},G=()=>{P.value=!P.value},Y=e=>{t.push("/admin/staff/"+e.id)},K=()=>{_.value=!0},Q=async()=>{D.value.next&&(n.value=!0,await a.fetchStaff(D.value.next),n.value=!1)},J=async()=>{D.value.prev&&(n.value=!0,await a.fetchStaff(D.value.prev),n.value=!1)};return(e,t)=>(d(),c("div",oE,[u("div",rE,[t[11]||(t[11]=u("h1",{class:"page-title"},"Gestión de Personal",-1)),!n.value&&l.value.length>0?(d(),c("div",lE,[u("div",cE,[u("span",dE,p(F.value.total),1),t[8]||(t[8]=u("span",{class:"stat-label"},"Total",-1))]),u("div",uE,[u("span",hE,p(F.value.avgRating),1),t[9]||(t[9]=u("span",{class:"stat-label"},"Rating promedio",-1))])])):h("",!0),b(Pk,{onClick:K,variant:"primary",icon:"fas fa-plus"},{default:k(()=>t[10]||(t[10]=[y(" Invitar Personal ")])),_:1,__:[10]})]),n.value?(d(),c("div",pE,t[12]||(t[12]=[u("div",{class:"spinner"},null,-1),u("p",null,"Cargando personal...",-1)]))):o.value?(d(),c("div",mE,[u("p",fE,p(o.value),1),b(Pk,{onClick:t[0]||(t[0]=t=>e.$router.go(0)),variant:"primary"},{default:k(()=>t[13]||(t[13]=[y(" Reintentar ")])),_:1,__:[13]})])):(d(),c("div",gE,[u("section",vE,[u("div",bE,[u("div",null,[u("h2",wE,[y(p(P.value?"Solicitudes Archivadas":"Solicitudes Pendientes")+" ",1),!P.value&&m.value.length?(d(),c("span",yE,p(m.value.length),1)):h("",!0)])]),P.value?h("",!0):(d(),c("div",_E,[b(Pk,{onClick:V,size:"sm",disabled:!m.value.length},{default:k(()=>t[14]||(t[14]=[y("Archivar Todo")])),_:1,__:[14]},8,["disabled"]),b(Pk,{onClick:z,size:"sm",variant:"success",disabled:!m.value.length},{default:k(()=>t[15]||(t[15]=[y("Confirmar Todo")])),_:1,__:[15]},8,["disabled"])]))]),n.value?(d(),c("div",CE,[(d(),c(g,null,v(3,e=>b(sE,{key:e})),64))])):(d(),c("div",kE,[O.value.length?(d(),c("div",SE,[(d(!0),c(g,null,v(O.value,e=>(d(),C(qk,{key:e.id,request:e,"is-archived":P.value,onConfirm:B,onArchive:q,onUnarchive:j,onReject:$},null,8,["request","is-archived"]))),128))])):(d(),c("div",EE,t[16]||(t[16]=[u("p",null,"No hay solicitudes para mostrar.",-1)])))])),b(Pk,{onClick:G,size:"sm",class:"mt-3"},{default:k(()=>[y(p(P.value?"Ver Pendientes":"Ver Archivadas"),1)]),_:1})]),u("section",TE,[u("div",IE,[t[17]||(t[17]=u("h2",{class:"section-title"},"Tu Personal",-1)),I(u("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>T.value=e),class:"search-input",placeholder:"Buscar personal..."},null,512),[[N,T.value]])]),n.value?(d(),c("div",NE,[(d(),c(g,null,v(4,e=>b(eE,{key:e})),64))])):(d(),c("div",xE,[L.value.length?h("",!0):(d(),c("p",AE,"No se encontró personal.")),(d(!0),c(g,null,v(L.value,e=>(d(),C(Kk,{key:e.id,employee:e,onRemove:W,onView:Y},null,8,["employee"]))),128))])),M.value.last_page>1?(d(),c("div",PE,[u("button",{class:"pagination-button",disabled:!D.value.prev,onClick:J},"Anterior",8,RE),u("span",null,p(M.value.current_page)+" / "+p(M.value.last_page),1),u("button",{class:"pagination-button",disabled:!D.value.next,onClick:Q},"Siguiente",8,DE)])):h("",!0)])])),b(yC,{modelValue:_.value,"onUpdate:modelValue":t[5]||(t[5]=e=>_.value=e),title:"Invitar Personal",size:"md"},{footer:k(()=>[u("button",{class:"btn btn-secondary",onClick:t[4]||(t[4]=e=>_.value=!1)}," Cancelar "),u("button",{class:"btn btn-primary",onClick:U,disabled:!x.value||n.value},[n.value?(d(),c("span",UE,"Enviando...")):(d(),c("span",BE,"Enviar invitación"))],8,FE)]),default:k(()=>[u("div",ME,[u("div",LE,[t[18]||(t[18]=u("label",{for:"invite-email"},"Correo electrónico",-1)),I(u("input",{id:"invite-email",type:"email","onUpdate:modelValue":t[2]||(t[2]=e=>x.value=e),placeholder:"Ingresa el correo electrónico",class:"form-control"},null,512),[[N,x.value]])]),u("div",OE,[t[20]||(t[20]=u("label",{for:"invite-role"},"Cargo",-1)),I(u("select",{id:"invite-role","onUpdate:modelValue":t[3]||(t[3]=e=>A.value=e),class:"form-control"},t[19]||(t[19]=[u("option",{value:"waiter"},"Mozo",-1),u("option",{value:"kitchen"},"Cocinero",-1),u("option",{value:"cashier"},"Cajero",-1),u("option",{value:"manager"},"Gerente",-1),u("option",{value:"cleaning"},"Limpieza",-1)]),512),[[R,A.value]])])])]),_:1},8,["modelValue"]),b(yC,{modelValue:E.value,"onUpdate:modelValue":t[7]||(t[7]=e=>E.value=e),title:"Desvincular empleado",size:"sm"},{footer:k(()=>[u("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=e=>E.value=!1)}," Cancelar "),u("button",{class:"btn btn-danger",onClick:H,disabled:n.value},[n.value?(d(),c("span",jE)):h("",!0),t[21]||(t[21]=y(" Desvincular "))],8,qE)]),default:k(()=>{var e;return[u("p",null,"¿Estás seguro de que deseas desvincular a "+p(null==(e=S.value)?void 0:e.name)+"?",1),t[22]||(t[22]=u("p",{class:"warning-text"},"Esta acción no se puede deshacer.",-1))]}),_:1,__:[22]},8,["modelValue"])]))}},zE=lr($E,[["__scopeId","data-v-490bad46"]]),VE=["src","alt"],WE={key:0,class:"avatar-overlay"},HE={key:1,class:"avatar-loading"},GE={__name:"ProfileAvatar",props:{src:{type:String,default:""},alt:{type:String,default:"Foto de perfil"},editable:{type:Boolean,default:!1}},emits:["update:src","file-selected"],setup(e,{emit:t}){const a=e,n=t,s=i(a.src),o=i(!1),r=i(null);P(()=>a.src,e=>{s.value=e});const l=()=>{a.editable&&r.value&&r.value.click()},p=e=>{const t=e.target.files[0];if(!t)return;o.value=!0;const a=new FileReader;a.onload=e=>{s.value=e.target.result,n("update:src",s.value),n("file-selected",t),o.value=!1},a.readAsDataURL(t)};return(t,a)=>(d(),c("div",{class:m(["profile-avatar",{editable:e.editable}]),onClick:l},[u("img",{src:s.value,alt:e.alt,class:"avatar-image"},null,8,VE),e.editable?(d(),c("div",WE,a[0]||(a[0]=[u("i",{class:"bi bi-camera"},null,-1)]))):h("",!0),o.value?(d(),c("div",HE,a[1]||(a[1]=[u("div",{class:"spinner"},null,-1)]))):h("",!0),e.editable?(d(),c("input",{key:2,ref_key:"fileInput",ref:r,type:"file",accept:"image/*",class:"file-input",onChange:p},null,544)):h("",!0)],2))}},YE=lr(GE,[["__scopeId","data-v-b3232b9c"]]),KE={class:"review-card"},QE={class:"review-header"},JE={class:"reviewer-info"},ZE=["src","alt"],XE={class:"reviewer-name"},eS={class:"review-rating"},tS={class:"stars-container"},aS={class:"rating-value"},nS={class:"review-text"},iS={class:"review-footer"},sS={key:0,class:"review-date"},oS={__name:"ReviewCard",props:{review:{type:Object,required:!0},canDelete:{type:Boolean,default:!1}},emits:["delete"],setup(e,{emit:t}){const a=e,n=t,s=i(!1),o=()=>{s.value=!0},r=()=>{n("delete",a.review.id),s.value=!1},l=e=>{if(!e)return"";return new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})};return(t,a)=>{var n,i,f;return d(),c("div",KE,[u("div",QE,[u("div",JE,[u("img",{src:null==(n=e.review.reviewer)?void 0:n.avatar,alt:null==(i=e.review.reviewer)?void 0:i.name,class:"reviewer-avatar"},null,8,ZE),u("h3",XE,p(null==(f=e.review.reviewer)?void 0:f.name),1)]),u("div",eS,[u("div",tS,[(d(),c(g,null,v(5,t=>u("i",{key:t,class:m(["bi",t<=e.review.rating?"bi-star-fill":"bi-star"])},null,2)),64))]),u("span",aS,p(e.review.rating),1)]),e.canDelete?(d(),c("button",{key:0,class:"delete-button",onClick:o,"aria-label":"Eliminar reseña"},a[2]||(a[2]=[u("i",{class:"bi bi-trash"},null,-1)]))):h("",!0)]),u("p",nS,p(e.review.comment),1),u("div",iS,[e.review.date?(d(),c("span",sS,p(l(e.review.date)),1)):h("",!0)]),s.value?(d(),C(yC,{key:0,modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value=e),title:"Eliminar reseña",size:"sm"},{footer:k(()=>[u("button",{class:"btn btn-secondary",onClick:a[0]||(a[0]=e=>s.value=!1)}," Cancelar "),u("button",{class:"btn btn-danger",onClick:r}," Eliminar ")]),default:k(()=>[a[3]||(a[3]=u("p",null,"¿Estás seguro de que deseas eliminar esta reseña?",-1)),a[4]||(a[4]=u("p",{class:"warning-text"},"Esta acción no se puede deshacer.",-1))]),_:1,__:[3,4]},8,["modelValue"])):h("",!0)])}}},rS=lr(oS,[["__scopeId","data-v-99cedcd8"]]),lS={class:"base-input-wrapper"},cS={key:0,class:"base-input-label"},dS={key:0,class:"required-indicator"},uS=["type","value","placeholder","disabled","required","autocomplete","name"],hS={key:1,class:"base-input-error-message"},pS={__name:"BaseInput",props:{modelValue:{type:[String,Number],default:""},label:{type:String,default:""},placeholder:{type:String,default:""},type:{type:String,default:"text"},error:{type:String,default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},autocomplete:{type:String,default:"off"},name:{type:String,default:""}},emits:["update:modelValue","focus","blur"],setup(e,{emit:t}){const a=e,n=t,o=i(a.modelValue),r=i(!1);P(()=>a.modelValue,e=>{o.value=e});const l=e=>{const t=e.target.value;o.value=t,n("update:modelValue",t)},f=e=>{r.value=!0,n("focus",e)},g=e=>{r.value=!1,n("blur",e)},v=s(()=>["base-input",{"base-input-disabled":a.disabled},{"base-input-error":a.error},{"base-input-focused":r.value}]);return(t,a)=>(d(),c("div",lS,[e.label?(d(),c("label",cS,[y(p(e.label)+" ",1),e.required?(d(),c("span",dS,"*")):h("",!0)])):h("",!0),u("input",{type:e.type,value:o.value,placeholder:e.placeholder,disabled:e.disabled,required:e.required,autocomplete:e.autocomplete,name:e.name,class:m(v.value),onInput:l,onFocus:f,onBlur:g},null,42,uS),e.error?(d(),c("p",hS,p(e.error),1)):h("",!0)]))}},mS=lr(pS,[["__scopeId","data-v-da9b847d"]]),fS={class:"form-group"},gS={class:"form-group"},vS={__name:"SendNotificationModal",props:{modelValue:Boolean,loading:Boolean},emits:["update:modelValue","submit"],setup(e,{emit:t}){const a=t,n=i({title:"",body:""}),o=s(()=>""!==n.value.title.trim()&&""!==n.value.body.trim()),r=()=>{o.value&&a("submit",{...n.value})};return(t,a)=>(d(),C(yC,{"model-value":e.modelValue,title:"Enviar Notificación","onUpdate:modelValue":a[3]||(a[3]=e=>t.$emit("update:modelValue",e))},{body:k(()=>[u("form",{onSubmit:f(r,["prevent"]),class:"send-notification-form"},[u("div",fS,[a[4]||(a[4]=u("label",{for:"title"},"Título",-1)),b(mS,{id:"title",modelValue:n.value.title,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value.title=e),placeholder:"Ej: Recordatorio de reunión",required:""},null,8,["modelValue"])]),u("div",gS,[a[5]||(a[5]=u("label",{for:"body"},"Mensaje",-1)),I(u("textarea",{id:"body","onUpdate:modelValue":a[1]||(a[1]=e=>n.value.body=e),rows:"4",placeholder:"Escribe aquí el mensaje de la notificación...",required:"",class:"textarea-input"},null,512),[[N,n.value.body]])])],32)]),footer:k(()=>[b(Pk,{onClick:a[2]||(a[2]=e=>t.$emit("update:modelValue",!1)),variant:"secondary"},{default:k(()=>a[6]||(a[6]=[y(" Cancelar ")])),_:1,__:[6]}),b(Pk,{onClick:r,loading:e.loading,disabled:!o.value},{default:k(()=>a[7]||(a[7]=[y(" Enviar ")])),_:1,__:[7]},8,["loading","disabled"])]),_:1},8,["model-value"]))}},bS=lr(vS,[["__scopeId","data-v-a3aa051f"]]),wS={class:"staff-detail-container"},yS={key:0,class:"loading-container"},_S={key:1,class:"error-container"},CS={key:2,class:"staff-detail-content"},kS={class:"profile-card"},ES={class:"profile-header"},SS={class:"profile-name-container"},TS={class:"profile-data"},IS={class:"data-row"},NS={key:0,class:"text-muted",style:{"font-size":"0.875rem"}},xS={class:"data-row"},AS={class:"data-row"},PS={class:"data-row"},RS={class:"data-row"},DS={class:"data-row"},MS={class:"data-row"},LS={class:"data-row"},OS={class:"data-row"},FS={class:"data-row"},US={class:"data-row"},BS={class:"data-row"},qS={class:"data-row"},jS={class:"data-row"},$S={class:"data-row"},zS={class:"profile-actions"},VS={class:"reviews-section d-none"},WS={class:"reviews-header"},HS={class:"average-rating"},GS={class:"stars-container"},YS={class:"rating-text"},KS={class:"add-review-buttons"},QS={key:0,class:"empty-reviews"},JS={key:1,class:"reviews-list"},ZS={class:"confirm-content"},XS={class:"confirm-input"},eT=["disabled"],tT={class:"add-review-form"},aT={class:"rating-input"},nT={class:"star-rating"},iT=["onClick"],sT={class:"comment-input"},oT=["disabled"],rT={key:0},lT={key:1},cT=lr({__name:"StaffDetail",setup(e){const t=_(),a=w(),n=aC(),l=t.params.id,f=i(!1),E=i(""),S=i(null),T=i(!1),x=i(!1),A=i(""),P=i({rating:5,comment:""}),R=i(!1),D=i(!1),M=i(!1),L={experience:"experience_years",seniority:"seniority_years",schedule:"employment_type",currentSchedule:"current_schedule"};r(async()=>{f.value=!0,E.value="";try{const e=await n.fetchStaffMember(l);S.value=e}catch(e){E.value=e.message||"Error al cargar datos del empleado"}finally{f.value=!1}});const O=async()=>{if("ELIMINAR"===A.value){f.value=!0,E.value="";try{await n.removeStaff(l),a.push("/admin/staff")}catch(e){E.value=e.message||"Error al eliminar al miembro del personal"}finally{f.value=!1,T.value=!1}}},F=async(e,t)=>{if(!S.value)return;if("birth_date"===e){const e=new Date(t),a=new Date;let n=a.getFullYear()-e.getFullYear();const i=a.getMonth()-e.getMonth();if((i<0||0===i&&a.getDate()<e.getDate())&&n--,n<16)return void(E.value="El empleado debe ser mayor de 16 años")}R.value=!0;const a=L[e]||e;try{if(await n.updateStaffMember(l,{[a]:t}),S.value[a]=t,S.value[e]=t,"birth_date"===e){const e=new Date(t).toLocaleDateString("es-ES");S.value.birthdate_formatted=e}}catch(i){E.value=i.message||`Error al actualizar ${e}`}finally{R.value=!1}},U=async e=>{if(e)try{R.value=!0;const t=new FormData;t.append("avatar",e),await n.updateStaffMember(l,t,!0);const a=new FileReader;a.onload=e=>{S.value&&(S.value.avatar_url=e.target.result)},a.readAsDataURL(e)}catch(t){E.value=t.message||"Error al subir avatar"}finally{R.value=!1}},B=async e=>{if(S.value)try{R.value=!0,await n.deleteReview(l,e),S.value.reviews=S.value.reviews.filter(t=>t.id!==e)}catch(t){E.value=t.message||"Error al eliminar reseña"}finally{R.value=!1}},q=async()=>{if(S.value&&P.value.comment)try{R.value=!0;const e=await n.addReview(l,P.value);S.value.reviews.push(e),P.value={rating:5,comment:""},x.value=!1}catch(e){E.value=e.message||"Error al agregar reseña"}finally{R.value=!1}},j=()=>{if(S.value&&S.value.phone){const e=encodeURIComponent("Hola, te contacto desde la app MOZO.");window.open(`https://wa.me/${S.value.phone}?text=${e}`,"_blank")}else alert("Este empleado no tiene un número de teléfono registrado.")},$=()=>{a.push("/admin/staff")},z=[{value:"Masculino",label:"Masculino"},{value:"Femenino",label:"Femenino"},{value:"No binario",label:"No binario"},{value:"Prefiero no especificar",label:"Prefiero no especificar"}],V=[{value:"Gerente",label:"Gerente"},{value:"Mozo",label:"Mozo"},{value:"Cajero",label:"Cajero"},{value:"Cocinero",label:"Cocinero"},{value:"Limpieza",label:"Limpieza"}],W=[{value:"Tiempo completo",label:"Tiempo completo"},{value:"Medio tiempo",label:"Medio tiempo"},{value:"Por horas",label:"Por horas"},{value:"Fines de semana",label:"Fines de semana"}],H=()=>{x.value=!0},G=s(()=>{if(!S.value||!S.value.reviews.length)return 0;return(S.value.reviews.reduce((e,t)=>e+t.rating,0)/S.value.reviews.length).toFixed(1)}),Y=s(()=>S.value&&S.value.reviews.length?[...S.value.reviews].sort((e,t)=>new Date(t.date)-new Date(e.date)):[]),K=s(()=>{if(!S.value||!S.value.birth_date)return null;const e=new Date(S.value.birth_date),t=new Date;let a=t.getFullYear()-e.getFullYear();const n=t.getMonth()-e.getMonth();return(n<0||0===n&&t.getDate()<e.getDate())&&a--,a}),Q=async e=>{var t,a;M.value=!0;try{const t={user_id:S.value.user.id,title:e.title,body:e.body},a=await Aa.sendPushToUser(t);nr(a.message||"Notificación enviada con éxito"),D.value=!1}catch(n){ir((null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al enviar la notificación")}finally{M.value=!1}},J=()=>{T.value=!0};return(e,t)=>(d(),c("div",wS,[u("div",{class:"staff-header"},[u("button",{class:"back-button",onClick:$},t[26]||(t[26]=[u("i",{class:"bi bi-arrow-left"},null,-1),y(" Volver ")]))]),f.value?(d(),c("div",yS,t[27]||(t[27]=[u("div",{class:"loading-spinner"},null,-1),u("p",null,"Cargando datos del empleado...",-1)]))):E.value?(d(),c("div",_S,[u("p",null,p(E.value),1),b(Pk,{onClick:t[0]||(t[0]=t=>e.$router.go(0)),variant:"primary"},{default:k(()=>t[28]||(t[28]=[y(" Reintentar ")])),_:1,__:[28]})])):S.value?(d(),c("div",CS,[u("div",kS,[u("div",ES,[b(YE,{src:S.value.avatar_url,alt:`Foto de ${S.value.name}`,editable:!0,onFileSelected:U},null,8,["src","alt"]),u("div",SS,[b(xy,{value:S.value.name,"onUpdate:value":t[1]||(t[1]=e=>F("name",e)),type:"text",placeholder:"Nombre completo",editable:!0,class:"profile-name"},null,8,["value"])])]),u("div",TS,[u("div",IS,[b(xy,{value:S.value.birth_date,"display-value":S.value.birthdate_formatted,label:"Fecha de nacimiento","onUpdate:value":t[2]||(t[2]=e=>F("birth_date",e)),type:"date",editable:!0},null,8,["value","display-value"]),K.value?(d(),c("div",NS,"Edad: "+p(K.value)+" años",1)):h("",!0)]),u("div",xS,[b(xy,{value:S.value.height,label:"Estatura","onUpdate:value":t[3]||(t[3]=e=>F("height",e)),type:"number",min:1,max:2.5,step:.01,unit:"mt",editable:!0},null,8,["value"])]),u("div",AS,[b(xy,{value:S.value.weight,label:"Peso","onUpdate:value":t[4]||(t[4]=e=>F("weight",e)),type:"number",min:30,max:200,unit:"kg",editable:!0},null,8,["value"])]),u("div",PS,[b(xy,{value:S.value.gender,label:"Sexo","onUpdate:value":t[5]||(t[5]=e=>F("gender",e)),type:"select",options:z,editable:!0},null,8,["value"])]),u("div",RS,[b(xy,{value:S.value.experience_years,label:"Años de experiencia","onUpdate:value":t[6]||(t[6]=e=>F("experience",e)),type:"number",min:0,max:50,unit:"años",editable:!0},null,8,["value"])]),u("div",DS,[b(xy,{value:S.value.seniority_years,label:"Antigüedad","onUpdate:value":t[7]||(t[7]=e=>F("seniority",e)),type:"number",min:0,max:50,unit:"años de antigüedad",editable:!0},null,8,["value"])]),u("div",MS,[b(xy,{value:S.value.email,label:"Email","onUpdate:value":t[8]||(t[8]=e=>F("email",e)),type:"text",editable:!0},null,8,["value"])]),u("div",LS,[b(xy,{value:S.value.phone,label:"Teléfono","onUpdate:value":t[9]||(t[9]=e=>F("phone",e)),type:"text",editable:!0},null,8,["value"])]),u("div",OS,[b(xy,{value:S.value.hire_date,label:"Fecha de contratación","onUpdate:value":t[10]||(t[10]=e=>F("hire_date",e)),type:"date",editable:!0},null,8,["value"])]),u("div",FS,[b(xy,{value:S.value.position,label:"Cargo","onUpdate:value":t[11]||(t[11]=e=>F("position",e)),type:"select",options:V,editable:!0},null,8,["value"])]),u("div",US,[b(xy,{value:S.value.salary,label:"Salario","onUpdate:value":t[12]||(t[12]=e=>F("salary",e)),type:"number",min:0,step:.01,unit:"$",editable:!0},null,8,["value"])]),u("div",BS,[b(xy,{value:S.value.notes,label:"Notas","onUpdate:value":t[13]||(t[13]=e=>F("notes",e)),type:"textarea",editable:!0},null,8,["value"])]),u("div",qS,[b(xy,{value:S.value.education,label:"Condición","onUpdate:value":t[14]||(t[14]=e=>F("education",e)),type:"text",editable:!0},null,8,["value"])]),u("div",jS,[b(xy,{value:S.value.employment_type,label:"Modalidad","onUpdate:value":t[15]||(t[15]=e=>F("schedule",e)),type:"select",options:W,editable:!0},null,8,["value"])]),u("div",$S,[b(xy,{value:S.value.current_schedule,label:"Horario actual","onUpdate:value":t[16]||(t[16]=e=>F("currentSchedule",e)),type:"text",editable:!0},null,8,["value"])])]),u("div",zS,[b(Pk,{variant:"primary",onClick:t[17]||(t[17]=t=>e.$router.push(`/admin/staff/${o(l)}/history`)),class:"action-button d-none"},{default:k(()=>t[29]||(t[29]=[y(" Ver historial ")])),_:1,__:[29]}),b(Pk,{variant:"secondary",onClick:e.sendMessage,class:"action-button"},{default:k(()=>t[30]||(t[30]=[y(" Mandar mensaje ")])),_:1,__:[30]},8,["onClick"]),b(Pk,{variant:"info",onClick:t[18]||(t[18]=e=>D.value=!0),class:"action-button"},{default:k(()=>t[31]||(t[31]=[u("i",{class:"bi bi-paper-plane"},null,-1),y(" Enviar Notificación ")])),_:1,__:[31]}),b(Pk,{variant:"danger",onClick:J,class:"action-button"},{default:k(()=>t[32]||(t[32]=[u("i",{class:"bi bi-trash"},null,-1),y(" Eliminar Empleado ")])),_:1,__:[32]})])]),u("div",VS,[u("div",WS,[t[35]||(t[35]=u("h2",{class:"section-title"},"Reseñas",-1)),u("div",HS,[u("div",GS,[(d(),c(g,null,v(5,e=>u("i",{key:e,class:m(["bi",e<=Math.round(S.value.rating)?"bi-star-fill":"bi-star"])},null,2)),64))]),u("span",YS,p(G.value),1)]),u("div",KS,[b(Pk,{onClick:H,variant:"primary",class:"add-review-button"},{default:k(()=>t[33]||(t[33]=[u("i",{class:"bi bi-plus-lg"},null,-1),y(" Añadir reseña ")])),_:1,__:[33]}),b(Pk,{onClick:j,variant:"secondary"},{default:k(()=>t[34]||(t[34]=[u("i",{class:"bi bi-whatsapp"},null,-1),y(" Contactar ")])),_:1,__:[34]})])]),Y.value.length?(d(),c("div",JS,[(d(!0),c(g,null,v(Y.value,e=>(d(),C(rS,{key:e.id,review:e,"can-delete":!0,onDelete:B},null,8,["review"]))),128))])):(d(),c("div",QS,t[36]||(t[36]=[u("p",null,"No hay reseñas todavía.",-1)])))])])):h("",!0),b(yC,{modelValue:T.value,"onUpdate:modelValue":t[21]||(t[21]=e=>T.value=e),title:"Eliminar empleado",size:"md"},{footer:k(()=>[u("button",{class:"btn btn-secondary",onClick:t[20]||(t[20]=e=>T.value=!1)}," Cancelar "),u("button",{class:"btn btn-danger",onClick:O,disabled:"ELIMINAR"!==A.value}," Eliminar ",8,eT)]),default:k(()=>{var e;return[u("div",ZS,[u("p",null,"¿Estás seguro de que deseas eliminar a "+p(null==(e=S.value)?void 0:e.name)+" del personal?",1),t[38]||(t[38]=u("p",{class:"confirm-warning"},"Esta acción no se puede deshacer.",-1)),u("div",XS,[t[37]||(t[37]=u("label",{for:"confirm-text"},'Escribe "ELIMINAR" para confirmar',-1)),I(u("input",{type:"text",id:"confirm-text","onUpdate:modelValue":t[19]||(t[19]=e=>A.value=e),class:"form-control"},null,512),[[N,A.value]])])])]}),_:1},8,["modelValue"]),b(yC,{modelValue:x.value,"onUpdate:modelValue":t[24]||(t[24]=e=>x.value=e),title:"Añadir nueva reseña",size:"md"},{footer:k(()=>[u("button",{class:"btn btn-secondary",onClick:t[23]||(t[23]=e=>x.value=!1)}," Cancelar "),u("button",{class:"btn btn-primary",onClick:q,disabled:!P.value.comment||R.value},[R.value?(d(),c("span",rT,"Guardando...")):(d(),c("span",lT,"Guardar reseña"))],8,oT)]),default:k(()=>[u("div",tT,[u("div",aT,[t[39]||(t[39]=u("label",null,"Calificación",-1)),u("div",nT,[(d(),c(g,null,v(5,e=>u("button",{key:e,type:"button",class:m(["star-button",{active:e<=P.value.rating}]),onClick:t=>P.value.rating=e},[u("i",{class:m(["bi",e<=P.value.rating?"bi-star-fill":"bi-star"])},null,2)],10,iT)),64))])]),u("div",sT,[t[40]||(t[40]=u("label",{for:"review-comment"},"Comentario",-1)),I(u("textarea",{id:"review-comment","onUpdate:modelValue":t[22]||(t[22]=e=>P.value.comment=e),rows:"4",placeholder:"Escribe tu comentario aquí...",class:"form-control"},null,512),[[N,P.value.comment]])])])]),_:1},8,["modelValue"]),b(bS,{modelValue:D.value,"onUpdate:modelValue":t[25]||(t[25]=e=>D.value=e),loading:M.value,onSubmit:Q},null,8,["modelValue","loading"])]))}},[["__scopeId","data-v-1a682f9c"]]),dT={class:"profile-container"},uT={key:0,class:"loading-container"},hT={key:1,class:"alert alert-danger"},pT={key:2,class:"alert alert-success"},mT={key:3,class:"profile-content"},fT={class:"profile-card"},gT={class:"profile-main"},vT={class:"profile-image-container"},bT=["src"],wT={class:"profile-info"},yT={class:"form-group"},_T=["disabled"],CT={class:"form-group"},kT=["disabled"],ET={class:"form-group"},ST=["disabled"],TT={class:"form-group"},IT=["disabled"],NT={class:"form-group"},xT={class:"form-group"},AT=["disabled"],PT={class:"form-group"},RT=["disabled"],DT={key:0,class:"form-text"},MT={class:"form-group"},LT=["disabled"],OT={key:0,class:"form-text"},FT={class:"profile-actions"},UT=["disabled"],BT={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},qT=["disabled"],jT={class:"confirm-content"},$T={class:"confirm-input"},zT=["disabled"],VT=["disabled"],WT=["disabled"],HT={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},GT=lr({__name:"Profile",setup(e){const t=w(),a=Xa(),n=i({name:"",email:"",phone:"",avatar:"",role:"admin",business:{name:"",code:""}}),o=i({current:"",new:"",confirm:""}),l=i(!0),m=i(!1),g=i(""),v=i(""),_=i(null),C=i(null),E=i(!1),S=i(""),T=i(!1),x=s(()=>!o.value.new||o.value.new.length>=8),A=s(()=>!o.value.new||!o.value.confirm||o.value.new===o.value.confirm),P=s(()=>!(!n.value.name||!n.value.email)&&(!(o.value.current||o.value.new||o.value.confirm)||o.value.current&&x.value&&A.value)),R=e=>{const t=e.target.files[0];if(!t)return;if(t.size>5242880)return void(g.value="La imagen no puede ser mayor a 5MB");C.value=t;const a=new FileReader;a.onload=e=>{_.value=e.target.result},a.readAsDataURL(t)},D=async()=>{var e,t;if(P.value){m.value=!0,g.value="",v.value="";try{const e=new FormData;e.append("name",n.value.name),e.append("email",n.value.email),e.append("phone",n.value.phone||""),C.value&&e.append("avatar",C.value),o.value.current&&o.value.new&&(e.append("current_password",o.value.current),e.append("password",o.value.new),e.append("password_confirmation",o.value.confirm)),console.log("Perfil actualizado:",{name:n.value.name,email:n.value.email,phone:n.value.phone,passwordChanged:!!o.value.current,avatarChanged:!!C.value});const t=a.getUser();t&&(t.name=n.value.name,t.email=n.value.email,t.phone=n.value.phone,_.value&&(t.avatar=_.value),a.setUser(t)),o.value.current="",o.value.new="",o.value.confirm="",C.value=null,v.value="Perfil actualizado correctamente"}catch(i){console.error("Error al actualizar perfil:",i),g.value=(null==(t=null==(e=i.response)?void 0:e.data)?void 0:t.message)||"No se pudo actualizar el perfil. Por favor, inténtalo de nuevo."}finally{m.value=!1}}},M=async()=>{var e,n;if("ELIMINAR"===S.value){T.value=!0;try{console.log("Cuenta eliminada"),await a.logout(),t.push("/login")}catch(i){console.error("Error al eliminar cuenta:",i),g.value=(null==(n=null==(e=i.response)?void 0:e.data)?void 0:n.message)||"No se pudo eliminar la cuenta. Por favor, inténtalo de nuevo.",E.value=!1,S.value="",T.value=!1}}},L=()=>{t.push("/admin")};return r(()=>{(async()=>{l.value=!0,g.value="";try{const e=a.getUser()||{id:"1",name:"Administrador",email:"admin@ejemplo.com",phone:"555-987-6543",avatar:"https://randomuser.me/api/portraits/men/42.jpg",role:"admin",business:{name:"Mi Restaurante",code:"FGT-464"}};n.value={...e}}catch(e){console.error("Error al cargar datos del usuario:",e),g.value="No se pudieron cargar tus datos. Por favor, inténtalo de nuevo."}finally{l.value=!1}})()}),(e,t)=>(d(),c("div",dT,[u("div",{class:"profile-header"},[u("button",{class:"back-button",onClick:L}," ← Volver ")]),l.value&&!n.value.name?(d(),c("div",uT,t[12]||(t[12]=[u("div",{class:"loading-spinner"},null,-1),u("p",null,"Cargando datos del perfil...",-1)]))):h("",!0),g.value?(d(),c("div",hT,p(g.value),1)):h("",!0),v.value?(d(),c("div",pT,p(v.value),1)):h("",!0),!l.value||n.value.name?(d(),c("div",mT,[u("div",fT,[u("div",gT,[u("div",vT,[u("img",{src:_.value||n.value.avatar||"/placeholder-avatar.png",alt:"Foto de perfil",class:"profile-image"},null,8,bT),t[13]||(t[13]=u("label",{for:"avatar-upload",class:"avatar-edit-btn"},[u("i",{class:"bi bi-camera"})],-1)),u("input",{type:"file",id:"avatar-upload",accept:"image/*",class:"visually-hidden",onChange:R},null,32)]),u("div",wT,[u("form",{onSubmit:f(D,["prevent"])},[u("div",yT,[t[14]||(t[14]=u("label",{for:"name"},"Nombre completo",-1)),I(u("input",{type:"text",id:"name","onUpdate:modelValue":t[0]||(t[0]=e=>n.value.name=e),class:"form-control",required:"",disabled:m.value},null,8,_T),[[N,n.value.name]])]),u("div",CT,[t[15]||(t[15]=u("label",{for:"email"},"Correo electrónico",-1)),I(u("input",{type:"email",id:"email","onUpdate:modelValue":t[1]||(t[1]=e=>n.value.email=e),class:"form-control",required:"",disabled:m.value},null,8,kT),[[N,n.value.email]])]),u("div",ET,[t[16]||(t[16]=u("label",{for:"phone"},"Teléfono",-1)),I(u("input",{type:"tel",id:"phone","onUpdate:modelValue":t[2]||(t[2]=e=>n.value.phone=e),class:"form-control",disabled:m.value},null,8,ST),[[N,n.value.phone]])]),u("div",TT,[t[17]||(t[17]=u("label",{for:"business-name"},"Nombre del negocio",-1)),I(u("input",{type:"text",id:"business-name","onUpdate:modelValue":t[3]||(t[3]=e=>n.value.business.name=e),class:"form-control",disabled:m.value},null,8,IT),[[N,n.value.business.name]])]),u("div",NT,[t[18]||(t[18]=u("label",{for:"business-code"},"Código del negocio",-1)),I(u("input",{type:"text",id:"business-code","onUpdate:modelValue":t[4]||(t[4]=e=>n.value.business.code=e),class:"form-control",disabled:""},null,512),[[N,n.value.business.code]])]),t[23]||(t[23]=u("div",{class:"profile-divider"},[u("h3",null,"Cambiar contraseña")],-1)),u("div",xT,[t[19]||(t[19]=u("label",{for:"current-password"},"Contraseña actual",-1)),I(u("input",{type:"password",id:"current-password","onUpdate:modelValue":t[5]||(t[5]=e=>o.value.current=e),class:"form-control",disabled:m.value},null,8,AT),[[N,o.value.current]])]),u("div",PT,[t[20]||(t[20]=u("label",{for:"new-password"},"Nueva contraseña",-1)),I(u("input",{type:"password",id:"new-password","onUpdate:modelValue":t[6]||(t[6]=e=>o.value.new=e),class:"form-control",disabled:m.value},null,8,RT),[[N,o.value.new]]),o.value.new&&!x.value?(d(),c("div",DT," La contraseña debe tener al menos 8 caracteres ")):h("",!0)]),u("div",MT,[t[21]||(t[21]=u("label",{for:"confirm-password"},"Confirmar nueva contraseña",-1)),I(u("input",{type:"password",id:"confirm-password","onUpdate:modelValue":t[7]||(t[7]=e=>o.value.confirm=e),class:"form-control",disabled:m.value},null,8,LT),[[N,o.value.confirm]]),o.value.confirm&&!A.value?(d(),c("div",OT," Las contraseñas no coinciden ")):h("",!0)]),u("div",FT,[u("button",{type:"submit",class:"btn btn-primary",disabled:m.value||!P.value},[m.value?(d(),c("span",BT)):h("",!0),t[22]||(t[22]=y(" Guardar cambios "))],8,UT),u("button",{type:"button",class:"btn btn-danger",onClick:t[8]||(t[8]=e=>E.value=!0),disabled:m.value}," Eliminar cuenta ",8,qT)])],32)])])])])):h("",!0),b(yC,{modelValue:E.value,"onUpdate:modelValue":t[11]||(t[11]=e=>E.value=e),title:"Eliminar cuenta",size:"md"},{footer:k(()=>[u("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=e=>E.value=!1),disabled:T.value}," Cancelar ",8,VT),u("button",{type:"button",class:"btn btn-danger",onClick:M,disabled:"ELIMINAR"!==S.value||T.value},[T.value?(d(),c("span",HT)):h("",!0),t[27]||(t[27]=y(" Eliminar mi cuenta "))],8,WT)]),default:k(()=>[u("div",jT,[t[25]||(t[25]=u("p",null,"¿Estás seguro de que deseas eliminar tu cuenta? Esta acción no se puede deshacer.",-1)),t[26]||(t[26]=u("div",{class:"alert alert-danger"},[u("i",{class:"bi bi-exclamation-triangle-fill me-2"}),y(" Al eliminar tu cuenta perderás todo el acceso a tus datos y negocios asociados. ")],-1)),u("div",$T,[t[24]||(t[24]=u("label",{for:"confirm-delete"},'Escribe "ELIMINAR" para confirmar',-1)),I(u("input",{type:"text",class:"form-control",id:"confirm-delete","onUpdate:modelValue":t[9]||(t[9]=e=>S.value=e),disabled:T.value},null,8,zT),[[N,S.value]])])])]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-7f2d5965"]]),YT={class:"settings-container"},KT={key:0,class:"loading-container"},QT={key:1,class:"error-container"},JT={key:2,class:"settings-content"},ZT={key:0,class:"success-message"},XT={class:"settings-section"},eI={class:"form-group"},tI={class:"form-group"},aI={class:"form-row"},nI={class:"form-group"},iI={class:"form-group"},sI={class:"form-group"},oI={class:"form-actions"},rI={class:"settings-section"},lI={class:"section-header"},cI={key:0,class:"empty-tables"},dI={key:1,class:"tables-list"},uI={class:"table-info"},hI={class:"table-number"},pI={class:"table-details"},mI={class:"table-name"},fI={class:"table-capacity"},gI={class:"table-actions"},vI=["onClick"],bI=["onClick"],wI={class:"settings-section danger-zone"},yI={class:"form-row"},_I={class:"form-group"},CI={class:"form-group"},kI={class:"form-group"},EI={class:"form-row"},SI={class:"form-group"},TI={class:"form-group"},II={class:"form-group"},NI={class:"confirm-content"},xI=lr({__name:"Settings",setup(e){const t=w(),a=aC(),n=Xa(),s=i(!1),o=i(""),l=i(""),m=i(null),_=i([]),E=i(!1),S=i(!1),T=i(!1),x=i(null),P=A({number:"",name:"",capacity:4});r(async()=>{s.value=!0,o.value="";try{const[e,t]=await Promise.all([a.fetchBusinessData(),a.fetchTables()]);m.value=e||{},_.value=t||[]}catch(e){o.value=e.message||"Error al cargar datos"}finally{s.value=!1}});const R=async()=>{if(m.value){s.value=!0,o.value="",l.value="";try{await a.updateBusinessData(m.value),l.value="Configuración guardada con éxito"}catch(e){o.value=e.message||"Error al guardar configuración"}finally{s.value=!1}}},D=async()=>{if(P.number&&P.capacity){s.value=!0,o.value="";try{const e=await a.createTable(P);e&&(_.value.push(e),P.number="",P.name="",P.capacity=4,E.value=!1)}catch(e){o.value=e.message||"Error al crear mesa"}finally{s.value=!1}}else o.value="Por favor, completa todos los campos requeridos"},M=async()=>{if(x.value){s.value=!0,o.value="";try{await a.updateTable(x.value),_.value=_.value.map(e=>e.id===x.value.id?x.value:e),S.value=!1,x.value=null}catch(e){o.value=e.message||"Error al actualizar mesa"}finally{s.value=!1}}},L=async()=>{if(x.value){s.value=!0,o.value="";try{await a.deleteTable(x.value.id),_.value=_.value.filter(e=>e.id!==x.value.id),T.value=!1,x.value=null}catch(e){o.value=e.message||"Error al eliminar mesa"}finally{s.value=!1}}},O=()=>{t.push({name:"admin-home"})},F=async()=>{await n.logout(),t.push("/login")};return(e,t)=>(d(),c("div",YT,[u("div",{class:"settings-header"},[u("button",{class:"back-button",onClick:O}," ← Volver "),t[19]||(t[19]=u("h1",null,"Configuración",-1))]),s.value?(d(),c("div",KT,t[20]||(t[20]=[u("div",{class:"loading-spinner"},null,-1),u("p",null,"Cargando configuración...",-1)]))):o.value?(d(),c("div",QT,[u("p",null,p(o.value),1),b(Pk,{onClick:t[0]||(t[0]=t=>e.$router.go(0)),variant:"primary"},{default:k(()=>t[21]||(t[21]=[y(" Reintentar ")])),_:1,__:[21]})])):m.value?(d(),c("div",JT,[l.value?(d(),c("div",ZT,p(l.value),1)):h("",!0),u("div",XT,[t[28]||(t[28]=u("h2",null,"Información del negocio",-1)),u("form",{onSubmit:f(R,["prevent"]),class:"business-form"},[u("div",eI,[t[22]||(t[22]=u("label",{for:"business-name"},"Nombre del restaurante",-1)),I(u("input",{id:"business-name",type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>m.value.name=e),required:""},null,512),[[N,m.value.name]])]),u("div",tI,[t[23]||(t[23]=u("label",{for:"business-address"},"Dirección",-1)),I(u("input",{id:"business-address",type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>m.value.address=e)},null,512),[[N,m.value.address]])]),u("div",aI,[u("div",nI,[t[24]||(t[24]=u("label",{for:"business-phone"},"Teléfono",-1)),I(u("input",{id:"business-phone",type:"tel","onUpdate:modelValue":t[3]||(t[3]=e=>m.value.phone=e)},null,512),[[N,m.value.phone]])]),u("div",iI,[t[25]||(t[25]=u("label",{for:"business-email"},"Email",-1)),I(u("input",{id:"business-email",type:"email","onUpdate:modelValue":t[4]||(t[4]=e=>m.value.email=e)},null,512),[[N,m.value.email]])])]),u("div",sI,[t[26]||(t[26]=u("label",{for:"business-description"},"Descripción",-1)),I(u("textarea",{id:"business-description","onUpdate:modelValue":t[5]||(t[5]=e=>m.value.description=e),rows:"3"},null,512),[[N,m.value.description]])]),u("div",oI,[b(Pk,{type:"submit",variant:"primary",loading:s.value},{default:k(()=>t[27]||(t[27]=[y(" Guardar cambios ")])),_:1,__:[27]},8,["loading"])])],32)]),u("div",rI,[u("div",lI,[t[30]||(t[30]=u("h2",null,"Mesas",-1)),b(Pk,{onClick:t[6]||(t[6]=e=>E.value=!0),variant:"primary"},{default:k(()=>t[29]||(t[29]=[y(" Añadir mesa ")])),_:1,__:[29]})]),0===_.value.length?(d(),c("div",cI,t[31]||(t[31]=[u("p",null,"No hay mesas configuradas",-1),u("p",null,"Añade mesas para que los clientes puedan hacer pedidos",-1)]))):(d(),c("div",dI,[(d(!0),c(g,null,v(_.value,e=>(d(),c("div",{key:e.id,class:"table-card"},[u("div",uI,[u("div",hI,p(e.number),1),u("div",pI,[u("span",mI,p(e.name||`Mesa ${e.number}`),1),u("span",fI,p(e.capacity)+" personas",1)])]),u("div",gI,[u("button",{onClick:t=>(e=>{x.value={...e},S.value=!0})(e),class:"edit-button"}," Editar ",8,vI),u("button",{onClick:t=>(e=>{x.value=e,T.value=!0})(e),class:"delete-button"}," Eliminar ",8,bI)])]))),128))]))]),u("div",wI,[t[33]||(t[33]=u("h2",null,"Cerrar Sesión",-1)),t[34]||(t[34]=u("p",null,"Finaliza tu sesión actual de forma segura.",-1)),b(Pk,{onClick:F,variant:"danger-outline"},{default:k(()=>t[32]||(t[32]=[y(" Cerrar sesión ")])),_:1,__:[32]})])])):h("",!0),b(yC,{modelValue:E.value,"onUpdate:modelValue":t[11]||(t[11]=e=>E.value=e),title:"Añadir nueva mesa",size:"md"},{footer:k(()=>[b(Pk,{onClick:t[10]||(t[10]=e=>E.value=!1),variant:"outline"},{default:k(()=>t[38]||(t[38]=[y(" Cancelar ")])),_:1,__:[38]}),b(Pk,{onClick:D,variant:"primary",loading:s.value},{default:k(()=>t[39]||(t[39]=[y(" Añadir ")])),_:1,__:[39]},8,["loading"])]),default:k(()=>[u("form",{onSubmit:f(D,["prevent"]),class:"table-form"},[u("div",yI,[u("div",_I,[t[35]||(t[35]=u("label",{for:"table-number"},"Número*",-1)),I(u("input",{id:"table-number",type:"number","onUpdate:modelValue":t[7]||(t[7]=e=>P.number=e),min:"1",required:""},null,512),[[N,P.number]])]),u("div",CI,[t[36]||(t[36]=u("label",{for:"table-capacity"},"Capacidad*",-1)),I(u("input",{id:"table-capacity",type:"number","onUpdate:modelValue":t[8]||(t[8]=e=>P.capacity=e),min:"1",required:""},null,512),[[N,P.capacity]])])]),u("div",kI,[t[37]||(t[37]=u("label",{for:"table-name"},"Nombre (opcional)",-1)),I(u("input",{id:"table-name",type:"text","onUpdate:modelValue":t[9]||(t[9]=e=>P.name=e),placeholder:"Ej: Terraza 1"},null,512),[[N,P.name]])])],32)]),_:1},8,["modelValue"]),x.value?(d(),C(yC,{key:3,modelValue:S.value,"onUpdate:modelValue":t[16]||(t[16]=e=>S.value=e),title:"Editar mesa",size:"md"},{footer:k(()=>[b(Pk,{onClick:t[15]||(t[15]=e=>S.value=!1),variant:"outline"},{default:k(()=>t[43]||(t[43]=[y(" Cancelar ")])),_:1,__:[43]}),b(Pk,{onClick:M,variant:"primary",loading:s.value},{default:k(()=>t[44]||(t[44]=[y(" Guardar ")])),_:1,__:[44]},8,["loading"])]),default:k(()=>[u("form",{onSubmit:f(M,["prevent"]),class:"table-form"},[u("div",EI,[u("div",SI,[t[40]||(t[40]=u("label",{for:"edit-table-number"},"Número*",-1)),I(u("input",{id:"edit-table-number",type:"number","onUpdate:modelValue":t[12]||(t[12]=e=>x.value.number=e),min:"1",required:""},null,512),[[N,x.value.number]])]),u("div",TI,[t[41]||(t[41]=u("label",{for:"edit-table-capacity"},"Capacidad*",-1)),I(u("input",{id:"edit-table-capacity",type:"number","onUpdate:modelValue":t[13]||(t[13]=e=>x.value.capacity=e),min:"1",required:""},null,512),[[N,x.value.capacity]])])]),u("div",II,[t[42]||(t[42]=u("label",{for:"edit-table-name"},"Nombre (opcional)",-1)),I(u("input",{id:"edit-table-name",type:"text","onUpdate:modelValue":t[14]||(t[14]=e=>x.value.name=e),placeholder:"Ej: Terraza 1"},null,512),[[N,x.value.name]])])],32)]),_:1},8,["modelValue"])):h("",!0),x.value?(d(),C(yC,{key:4,modelValue:T.value,"onUpdate:modelValue":t[18]||(t[18]=e=>T.value=e),title:"Eliminar mesa",size:"sm"},{footer:k(()=>[b(Pk,{onClick:t[17]||(t[17]=e=>T.value=!1),variant:"outline"},{default:k(()=>t[46]||(t[46]=[y(" Cancelar ")])),_:1,__:[46]}),b(Pk,{onClick:L,variant:"danger",loading:s.value},{default:k(()=>t[47]||(t[47]=[y(" Eliminar ")])),_:1,__:[47]},8,["loading"])]),default:k(()=>[u("div",NI,[u("p",null,"¿Estás seguro de que deseas eliminar la mesa "+p(x.value.number)+"?",1),t[45]||(t[45]=u("p",{class:"confirm-warning"},"Esta acción no se puede deshacer.",-1))])]),_:1},8,["modelValue"])):h("",!0)]))}},[["__scopeId","data-v-6566ffad"]]),AI={class:"debug-panel"},PI={class:"debug-section"},RI={class:"status-grid"},DI={class:"status-icon"},MI={class:"status-icon"},LI={class:"status-icon"},OI={class:"status-item"},FI={class:"debug-section"},UI={class:"button-grid"},BI=["disabled"],qI=["disabled"],jI=["disabled"],$I=["disabled"],zI={class:"debug-section"},VI={class:"test-form"},WI={class:"form-row"},HI={class:"form-row"},GI={class:"form-row"},YI=["disabled"],KI={class:"debug-section"},QI={class:"token-actions"},JI=["disabled"],ZI={key:0,class:"debug-section"},XI={class:"debug-logs"},eN={class:"log-time"},tN={class:"log-message"},aN={class:"debug-section"},nN={class:"tech-info"},iN={class:"info-item"},sN={class:"info-item"},oN={class:"info-item"},rN={class:"info-item"},lN={__name:"NotificationDebugPanel",setup(e){const t=Xa(),a=or(),n=i(!1),l=i([]),f=i(null),b=i({title:"🧪 Notificación de Prueba",body:"Esta es una notificación de prueba desde el panel de debug",type:"all"}),w=s(()=>t.isAuthenticated),_=i(!1),C=s(()=>!!f.value),k=A({browser:"",pushSupport:!1,serviceWorkerSupport:!1,firebaseProject:""});function E(e,t="info"){l.value.push({id:Date.now()+Math.random(),timestamp:new Date,message:e,type:t}),console.log(`[NotificationDebug] ${e}`)}function S(){l.value=[],E("🧹 Log limpiado","info")}function T(){const e=l.value.map(e=>`[${e.timestamp.toLocaleString()}] ${e.type.toUpperCase()}: ${e.message}`).join("\n"),t=new Blob([e],{type:"text/plain"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=`notification-debug-${(new Date).toISOString().slice(0,10)}.log`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a),E("💾 Log descargado","success")}async function x(){if(!n.value){n.value=!0,E("🔔 Solicitando permisos de notificación...","info");try{if(!("Notification"in window))throw new Error("Este navegador no soporta notificaciones push");const e=await Notification.requestPermission();E(`📋 Resultado de permisos: ${e}`,"info"),"granted"===e?(systemStatus.permissions=!0,E("✅ Permisos concedidos","success"),nr("Permisos de notificación concedidos"),await P()):(systemStatus.permissions=!1,E("❌ Permisos denegados","error"),ir("Permisos de notificación denegados"))}catch(e){E(`❌ Error pidiendo permisos: ${e.message}`,"error"),ir(`Error: ${e.message}`)}finally{n.value=!1}}}async function P(){if(!n.value){n.value=!0,E("🚀 Inicializando Firebase Cloud Messaging...","info");try{if(!t.isAuthenticated)throw new Error("Usuario no autenticado");await Ua();const e=await Ba();if(!e)throw new Error("No se pudo obtener el token FCM");f.value=e,E(`🔑 Token FCM obtenido: ${e.substring(0,20)}...`,"success"),E("🔥 Listener de mensajes en primer plano configurado","success"),await D()}catch(e){E(`❌ Error inicializando FCM: ${e.message}`,"error"),ir(`Error inicializando FCM: ${e.message}`)}finally{n.value=!1}}}async function D(){if(n.value)return;const e=f.value||localStorage.getItem("fcm_token");if(e){n.value=!0,E("📤 Enviando token al servidor...","info");try{await Pa.storeDeviceToken(e,"web",t.user.id);E("✅ Token enviado al servidor exitosamente","success"),nr("Token FCM registrado en el servidor")}catch(a){E(`❌ Error enviando token: ${a.message}`,"error"),ir(`Error enviando token: ${a.message}`)}finally{n.value=!1}}else E("❌ No hay token FCM para enviar","error")}async function M(){if(!n.value){n.value=!0,E("📥 Cargando notificaciones...","info");try{await a.loadNotifications(),E(`📬 ${a.totalUnreadCount} notificaciones no leídas cargadas`,"success"),nr("Notificaciones cargadas")}catch(e){E(`❌ Error cargando notificaciones: ${e.message}`,"error"),ir(`Error cargando notificaciones: ${e.message}`)}finally{n.value=!1}}}async function L(){if(n.value)return;if(!b.value.title.trim()||!b.value.body.trim())return void ir("Título y mensaje son requeridos");n.value=!0;const{title:e,body:a,type:i}=b.value;E(`📨 Enviando notificación tipo: ${i}`,"info");try{let n;switch(i){case"all":n=await Pa.sendNotificationToAll(e,a),E("✅ Notificación enviada a todos los usuarios","success");break;case"user":n=await Pa.sendNotificationToUser(t.user.id,e,a),E("✅ Notificación enviada solo para ti","success");break;case"device":const i=f.value||localStorage.getItem("fcm_token");if(!i)throw new Error("No hay token FCM disponible");n=await Pa.sendNotificationToDevice(i,e,a),E("✅ Notificación enviada a tu dispositivo","success");break;default:throw new Error("Tipo de notificación no válido")}nr("Notificación enviada exitosamente"),E(`📝 Respuesta: ${JSON.stringify(n)}`,"info")}catch(s){E(`❌ Error enviando notificación: ${s.message}`,"error"),ir(`Error enviando notificación: ${s.message}`)}finally{n.value=!1}}function O(){const e=f.value||localStorage.getItem("fcm_token");e?(E("🔑 Token FCM actual:","info"),E(e,"info"),nr("Token mostrado en el log")):(E("❌ No hay token FCM disponible","error"),ir("No hay token FCM disponible"))}async function F(){const e=f.value||localStorage.getItem("fcm_token");if(e)try{await navigator.clipboard.writeText(e),E("📋 Token copiado al portapapeles","success"),nr("Token copiado al portapapeles")}catch(t){E("❌ Error copiando token","error"),ir("Error copiando token")}else ir("No hay token para copiar")}async function U(){if(n.value)return;if(f.value||localStorage.getItem("fcm_token")){n.value=!0,E("🗑️ Eliminando token...","info");try{f.value=null,localStorage.removeItem("fcm_token"),E("✅ Token eliminado","success"),nr("Token eliminado")}catch(e){E(`❌ Error eliminando token: ${e.message}`,"error"),ir(`Error eliminando token: ${e.message}`)}finally{n.value=!1}}else ir("No hay token para eliminar")}return r(()=>{E("🔧 Panel de debug cargado","info"),k.browser=navigator.userAgent.split("(")[0].trim(),k.pushSupport="Notification"in window,k.serviceWorkerSupport="serviceWorker"in navigator,k.firebaseProject="mozoqr-7d32c","Notification"in window&&(_.value="granted"===Notification.permission,E(`📋 Permisos actuales: ${Notification.permission}`,"info"));const e=localStorage.getItem("fcm_token");e&&(f.value=e,E(`🔑 Token FCM encontrado: ${e.substring(0,20)}...`,"info")),E("👤 Usuario autenticado: "+(t.isAuthenticated?"Sí":"No"),"info"),t.user&&E(`👤 ID: ${t.user.id} | Email: ${t.user.email}`,"info")}),(e,t)=>(d(),c("div",AI,[t[21]||(t[21]=u("div",{class:"debug-header"},[u("h3",null,"🧪 Debug de Notificaciones FCM"),u("p",{class:"debug-subtitle"},"Panel para probar y debuggear notificaciones push")],-1)),u("div",PI,[t[7]||(t[7]=u("h4",null,"📊 Estado del Sistema",-1)),u("div",RI,[u("div",{class:m(["status-item",{active:w.value}])},[u("span",DI,p(w.value?"✅":"❌"),1),t[3]||(t[3]=u("span",null,"Usuario Autenticado",-1))],2),u("div",{class:m(["status-item",{active:_.value}])},[u("span",MI,p(_.value?"✅":"❌"),1),t[4]||(t[4]=u("span",null,"Permisos Push",-1))],2),u("div",{class:m(["status-item",{active:C.value}])},[u("span",LI,p(C.value?"✅":"❌"),1),t[5]||(t[5]=u("span",null,"Token FCM",-1))],2),u("div",OI,[t[6]||(t[6]=u("span",{class:"status-icon"},"🔔",-1)),u("span",null,p(o(a).totalUnreadCount)+" no leídas",1)])])]),u("div",FI,[t[8]||(t[8]=u("h4",null,"⚡ Acciones Rápidas",-1)),u("div",UI,[u("button",{onClick:x,disabled:n.value,class:"debug-btn primary"},p(n.value?"Procesando...":"🔔 Pedir Permisos"),9,BI),u("button",{onClick:P,disabled:n.value,class:"debug-btn secondary"}," 🚀 Inicializar FCM ",8,qI),u("button",{onClick:D,disabled:n.value,class:"debug-btn secondary"}," 📤 Enviar Token al Servidor ",8,jI),u("button",{onClick:M,disabled:n.value,class:"debug-btn info"}," 📥 Cargar Notificaciones ",8,$I)])]),u("div",zI,[t[13]||(t[13]=u("h4",null,"📤 Enviar Notificaciones de Prueba",-1)),u("div",VI,[u("div",WI,[t[9]||(t[9]=u("label",null,"Título:",-1)),I(u("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>b.value.title=e),placeholder:"Título de la notificación"},null,512),[[N,b.value.title]])]),u("div",HI,[t[10]||(t[10]=u("label",null,"Mensaje:",-1)),I(u("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>b.value.body=e),placeholder:"Cuerpo del mensaje",rows:"2"},null,512),[[N,b.value.body]])]),u("div",GI,[t[12]||(t[12]=u("label",null,"Tipo:",-1)),I(u("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>b.value.type=e)},t[11]||(t[11]=[u("option",{value:"all"},"🌐 Enviar a Todos",-1),u("option",{value:"user"},"👤 Enviar Solo a Mí",-1),u("option",{value:"device"},"📱 Enviar a Mi Device",-1)]),512),[[R,b.value.type]])]),u("button",{onClick:L,disabled:n.value,class:"debug-btn primary full-width"},p(n.value?"Enviando...":"📨 Enviar Notificación"),9,YI)])]),u("div",KI,[t[14]||(t[14]=u("h4",null,"🔑 Gestión de Device Tokens",-1)),u("div",QI,[u("button",{onClick:O,class:"debug-btn secondary"}," 👀 Ver Token Actual "),u("button",{onClick:F,class:"debug-btn secondary"}," 📋 Copiar Token "),u("button",{onClick:U,disabled:n.value,class:"debug-btn danger"}," 🗑️ Eliminar Token ",8,JI)])]),l.value.length>0?(d(),c("div",ZI,[t[15]||(t[15]=u("h4",null,"📝 Log de Eventos",-1)),u("div",XI,[(d(!0),c(g,null,v(l.value.slice(-10),e=>{return d(),c("div",{key:e.id,class:m(["log-item",e.type])},[u("span",eN,p((t=e.timestamp,t.toLocaleTimeString())),1),u("span",tN,p(e.message),1)],2);var t}),128))]),u("div",{class:"log-actions"},[u("button",{onClick:S,class:"debug-btn small"},"Limpiar Log"),u("button",{onClick:T,class:"debug-btn small"},"💾 Descargar Log")])])):h("",!0),u("div",aN,[t[20]||(t[20]=u("h4",null,"🔧 Información Técnica",-1)),u("div",nN,[u("div",iN,[t[16]||(t[16]=u("strong",null,"Navegador:",-1)),y(" "+p(k.browser),1)]),u("div",sN,[t[17]||(t[17]=u("strong",null,"Soporte Push:",-1)),y(" "+p(k.pushSupport?"Sí":"No"),1)]),u("div",oN,[t[18]||(t[18]=u("strong",null,"Service Worker:",-1)),y(" "+p(k.serviceWorkerSupport?"Sí":"No"),1)]),u("div",rN,[t[19]||(t[19]=u("strong",null,"Firebase Project:",-1)),y(" "+p(k.firebaseProject),1)])])])]))}},cN=lr(lN,[["__scopeId","data-v-03f702b6"]]),dN={class:"notification-debug"},uN={key:0,class:"current-notifications"},hN={class:"notifications-list"},pN={class:"notification-header"},mN={class:"notification-time"},fN={class:"notification-body"},gN={class:"notification-meta"},vN={class:"notification-type"},bN={class:"notification-status"},wN=lr({__name:"NotificationDebug",setup(e){const t=or(),a=s(()=>[...t.unreadNotifications,...t.readNotifications]);async function n(){try{await(async()=>{try{console.log("🧪 Enviando notificación de prueba para app cerrada...");const e=await Aa.post("/notifications/test-background",{title:"🔔 Prueba App Cerrada",message:"Esta notificación debe aparecer cuando la app está cerrada",data:{type:"background_test",timestamp:(new Date).toISOString(),test_mode:!0}});return console.log("✅ Notificación de prueba enviada:",e.data),e.data}catch(e){throw console.error("❌ Error enviando notificación de prueba:",e),e}})(),alert("✅ Notificación de prueba enviada. Cierra la app y verifica que llegue la notificación.")}catch(e){alert("❌ Error enviando notificación: "+e.message)}}async function i(){try{await(async(e=10)=>{try{console.log(`🕐 Programando notificación de prueba en ${e} segundos...`);const t=await Aa.post("/notifications/schedule-test",{delay:e,title:"⏰ Notificación Programada",message:`Esta notificación fue programada hace ${e} segundos`,data:{type:"scheduled_test",scheduled_at:(new Date).toISOString(),delay_seconds:e}});return console.log("✅ Notificación programada:",t.data),t.data}catch(t){throw console.error("❌ Error programando notificación:",t),t}})(15),alert("✅ Notificación programada para 15 segundos. Cierra la app y espera.")}catch(e){alert("❌ Error programando notificación: "+e.message)}}function o(){const e={steps:["1. Asegúrate de estar autenticado en la app","2. Ejecuta sendTestBackgroundNotification() o scheduleTestNotification()","3. Cierra completamente la aplicación (no solo minimizar)","4. Espera unos segundos","5. Deberías ver la notificación en la barra de notificaciones","6. Al tocar la notificación, la app debe abrirse"],note:"Para Android, asegúrate de que los permisos de notificaciones estén activados y que la app no esté en modo ahorro de batería."},t=`\nInstrucciones para probar notificaciones:\n\n${e.steps.join("\n")}\n\nNota: ${e.note}\n  `;alert(t)}return(e,t)=>(d(),c("div",dN,[t[2]||(t[2]=u("div",{class:"page-header"},[u("h1",null,"Panel de Debug - Notificaciones"),u("p",{class:"subtitle"},"Prueba y monitorea el sistema de notificaciones FCM")],-1)),b(cN),u("div",{class:"background-tests"},[t[0]||(t[0]=u("h2",null,"📴 Pruebas App Cerrada",-1)),t[1]||(t[1]=u("p",{class:"test-description"}," Estas pruebas envían notificaciones que deben llegar cuando la aplicación está completamente cerrada. ",-1)),u("div",{class:"test-buttons"},[u("button",{onClick:n,class:"test-btn primary"}," 🧪 Probar App Cerrada "),u("button",{onClick:i,class:"test-btn secondary"}," ⏰ Notificación en 15s "),u("button",{onClick:o,class:"test-btn info"}," 📋 Ver Instrucciones ")])]),a.value.length>0?(d(),c("div",uN,[u("h2",null,"📬 Notificaciones Actuales ("+p(a.value.length)+")",1),u("div",hN,[(d(!0),c(g,null,v(a.value.slice(0,10),e=>{var t,a,n;return d(),c("div",{key:e.id,class:m(["notification-preview",{unread:!e.read_at}])},[u("div",pN,[u("strong",null,p((null==(t=e.data)?void 0:t.title)||e.title||"Sin título"),1),u("span",mN,p((n=e.created_at||e.timestamp,new Date(n).toLocaleString())),1)]),u("p",fN,p((null==(a=e.data)?void 0:a.message)||e.body||"Sin mensaje"),1),u("div",gN,[u("span",vN,p(e.type||"notification"),1),u("span",bN,p(e.read_at?"Leída":"No leída"),1)])],2)}),128))])])):h("",!0),t[3]||(t[3]=D('<div class="instructions" data-v-da0dde4d><h2 data-v-da0dde4d>📋 Instrucciones de Uso</h2><div class="instruction-steps" data-v-da0dde4d><div class="step" data-v-da0dde4d><span class="step-number" data-v-da0dde4d>1</span><div class="step-content" data-v-da0dde4d><strong data-v-da0dde4d>Inicializar Sistema:</strong><p data-v-da0dde4d>Haz clic en &quot;Inicializar Sistema&quot; para configurar FCM y obtener permisos.</p></div></div><div class="step" data-v-da0dde4d><span class="step-number" data-v-da0dde4d>2</span><div class="step-content" data-v-da0dde4d><strong data-v-da0dde4d>Probar Notificaciones:</strong><p data-v-da0dde4d>Usa &quot;Test Local&quot; para notificaciones inmediatas o &quot;Servidor&quot; para probar el backend.</p></div></div><div class="step" data-v-da0dde4d><span class="step-number" data-v-da0dde4d>3</span><div class="step-content" data-v-da0dde4d><strong data-v-da0dde4d>Verificar en el Bell:</strong><p data-v-da0dde4d>Las notificaciones aparecerán en el icono de campana en la barra superior.</p></div></div></div></div>',1))]))}},[["__scopeId","data-v-da0dde4d"]]),yN={class:"call-waiter-container"},_N={key:0,class:"call-idle-state"},CN=["disabled"],kN={key:0},EN={key:1},SN={key:1,class:"call-calling-state"},TN={key:2,class:"call-waiting-state"},IN={class:"call-status-card"},NN={class:"wait-time"},xN={key:3,class:"call-acknowledged-state"},AN={key:4,class:"call-error-state"},PN={class:"call-status-card error"},RN={class:"urgency-options"},DN=lr({__name:"CallWaiterButton",props:{tableId:{type:[String,Number],required:!0},businessId:{type:[String,Number],required:!0},tableNumber:{type:[String,Number],default:null}},emits:["call-status-change"],setup(e,{emit:t}){const a=e,n=t,i=A({callState:"idle",loading:!1,showUrgencyOptions:!1,waitTimeSeconds:0,errorMessage:{},currentCallId:null,waitTimer:null}),o=s(()=>i.callState),g=s(()=>i.loading),v=s({get:()=>i.showUrgencyOptions,set:e=>i.showUrgencyOptions=e}),b=s(()=>i.waitTimeSeconds),w=s(()=>i.errorMessage),_=s(()=>{const e=i.waitTimeSeconds;if(e<60)return`${e}s`;return`${Math.floor(e/60)}m ${e%60}s`}),C=()=>{i.showUrgencyOptions=!0},k=()=>{E("urgent")},E=async(e="normal")=>{i.showUrgencyOptions=!1,i.callState="calling",i.loading=!0,n("call-status-change","calling");try{console.log("📞 Calling waiter...",{tableId:a.tableId,urgency:e,tableNumber:a.tableNumber});const t=await sc.callWaiter(a.tableId,{message:"urgent"===e?"Solicitud urgente":"Solicita mozo",urgency:"urgent"===e?"high":"normal",client_info:{timestamp:(new Date).toISOString(),table_number:a.tableNumber}});t.success?(console.log("✅ Waiter called successfully:",t),i.currentCallId=t.call_id,i.callState="waiting",i.waitTimeSeconds=0,I(),x(),n("call-status-change","waiting")):S(t)}catch(t){console.error("❌ Error calling waiter:",t),S(t)}finally{i.loading=!1}},S=e=>{var t,a;i.callState="error",(null==(t=e.message)?void 0:t.includes("no_waiter_assigned"))?i.errorMessage={title:"Mozo no disponible",description:"No hay un mozo asignado a esta mesa actualmente. Por favor, solicite ayuda al personal del establecimiento."}:(null==(a=e.message)?void 0:a.includes("table_silenced"))?i.errorMessage={title:"Mesa temporalmente silenciada",description:"Su mesa está temporalmente silenciada. Inténtelo de nuevo en unos minutos."}:i.errorMessage={title:"Error en la conexión",description:"No pudimos procesar su solicitud. Verifique su conexión a internet e inténtelo nuevamente."},n("call-status-change","error")},T=()=>{N(),P(),i.callState="idle",i.currentCallId=null,i.waitTimeSeconds=0,i.errorMessage={},n("call-status-change","idle")},I=()=>{N(),i.waitTimer=setInterval(()=>{i.waitTimeSeconds+=1},1e3)},N=()=>{i.waitTimer&&(clearInterval(i.waitTimer),i.waitTimer=null)},x=()=>{window.addEventListener("waiter-call-acknowledged",R),window.addEventListener("waiter-call-completed",D)},P=()=>{window.removeEventListener("waiter-call-acknowledged",R),window.removeEventListener("waiter-call-completed",D)},R=e=>{console.log("✅ Waiter acknowledged call:",e.detail),e.detail.call_id===i.currentCallId&&(N(),i.callState="acknowledged",n("call-status-change","acknowledged"))},D=e=>{console.log("✅ Waiter completed call:",e.detail),e.detail.call_id===i.currentCallId&&T()};return r(()=>{console.log("🔔 CallWaiterButton mounted",{tableId:a.tableId,businessId:a.businessId,tableNumber:a.tableNumber})}),l(()=>{N(),P()}),(e,t)=>(d(),c("div",yN,["idle"===o.value?(d(),c("div",_N,[t[5]||(t[5]=u("div",{class:"call-info"},[u("h3",null,[u("i",{class:"fas fa-concierge-bell"}),y(" ¿Necesitas ayuda? ")]),u("p",null,"Presiona el botón para llamar a tu mozo")],-1)),u("button",{onClick:C,class:"call-button primary",disabled:g.value},[u("i",{class:m(["fas fa-bell",{"fa-spin":g.value}])},null,2),g.value?(d(),c("span",EN,"Conectando...")):(d(),c("span",kN,"Llamar Mozo"))],8,CN)])):"calling"===o.value?(d(),c("div",SN,t[6]||(t[6]=[u("div",{class:"call-status-card"},[u("div",{class:"status-icon calling"},[u("i",{class:"fas fa-paper-plane"})]),u("h3",null,"Llamando mozo..."),u("p",null,"Estamos notificando a tu mozo"),u("div",{class:"loading-dots"},[u("span"),u("span"),u("span")])],-1)]))):"waiting"===o.value?(d(),c("div",TN,[u("div",IN,[t[9]||(t[9]=u("div",{class:"status-icon waiting"},[u("i",{class:"fas fa-clock"})],-1)),t[10]||(t[10]=u("h3",null,"¡Mozo notificado!",-1)),t[11]||(t[11]=u("p",null,"Aguarde por favor, su mozo fue notificado y lo atenderá en breve",-1)),u("div",NN,[t[7]||(t[7]=u("i",{class:"fas fa-hourglass-half"},null,-1)),u("span",null,"Tiempo de espera: "+p(_.value),1)]),b.value>120?(d(),c("button",{key:0,onClick:k,class:"call-button urgent"},t[8]||(t[8]=[u("i",{class:"fas fa-exclamation-triangle"},null,-1),y(" Llamar urgente ")]))):h("",!0)])])):"acknowledged"===o.value?(d(),c("div",xN,[u("div",{class:"call-status-card success"},[t[13]||(t[13]=u("div",{class:"status-icon acknowledged"},[u("i",{class:"fas fa-check"})],-1)),t[14]||(t[14]=u("h3",null,"¡Mozo en camino!",-1)),t[15]||(t[15]=u("p",null,"Su mozo confirmó la llamada y se dirige a su mesa",-1)),u("button",{onClick:T,class:"call-button secondary"},t[12]||(t[12]=[u("i",{class:"fas fa-redo"},null,-1),y(" Nueva solicitud ")]))])])):"error"===o.value?(d(),c("div",AN,[u("div",PN,[t[17]||(t[17]=u("div",{class:"status-icon error"},[u("i",{class:"fas fa-exclamation-triangle"})],-1)),u("h3",null,p(w.value.title||"Error en la llamada"),1),u("p",null,p(w.value.description||"No pudimos contactar con su mozo. Intente nuevamente."),1),u("button",{onClick:T,class:"call-button primary"},t[16]||(t[16]=[u("i",{class:"fas fa-redo"},null,-1),y(" Intentar nuevamente ")]))])])):h("",!0),v.value?(d(),c("div",{key:5,class:"urgency-modal-overlay",onClick:t[4]||(t[4]=e=>v.value=!1)},[u("div",{class:"urgency-modal",onClick:t[3]||(t[3]=f(()=>{},["stop"]))},[t[20]||(t[20]=u("h4",null,"Tipo de solicitud",-1)),u("div",RN,[u("button",{onClick:t[0]||(t[0]=e=>E("normal")),class:"urgency-option normal"},t[18]||(t[18]=[u("i",{class:"fas fa-bell"},null,-1),u("span",null,"Normal",-1),u("small",null,"Solicitud general",-1)])),u("button",{onClick:t[1]||(t[1]=e=>E("urgent")),class:"urgency-option urgent"},t[19]||(t[19]=[u("i",{class:"fas fa-exclamation-triangle"},null,-1),u("span",null,"Urgente",-1),u("small",null,"Necesito atención inmediata",-1)]))]),u("button",{onClick:t[2]||(t[2]=e=>v.value=!1),class:"cancel-btn"}," Cancelar ")])])):h("",!0)]))}},[["__scopeId","data-v-28254294"]]),MN={class:"menu-table-page"},LN={class:"business-header"},ON={class:"business-info"},FN={key:0,class:"business-logo"},UN=["src","alt"],BN={class:"business-details"},qN={class:"table-info"},jN={key:0,class:"business-address"},$N={class:"main-content"},zN={class:"menu-section"},VN={key:0,class:"loading-state"},WN={key:1,class:"error-state"},HN={key:2,class:"pdf-container"},GN=["src"],YN={class:"pdf-actions"},KN=["href"],QN={key:3,class:"no-menu-state"},JN={class:"waiter-call-section"},ZN={class:"page-footer"},XN={class:"app-branding"},ex={class:"version"},tx=lr({__name:"MenuTable",setup(e){const t=_(),a=s(()=>t.params.tableId),n=s(()=>t.query.business_id),i=s(()=>t.query.table_number||a.value),l=A({businessData:{},menuPdfUrl:null,loadingMenu:!0,loadingBusiness:!0,menuError:!1,businessError:!1,callStatus:"idle"}),m=s(()=>l.businessData),f=s(()=>l.menuPdfUrl),g=s(()=>l.loadingMenu),v=s(()=>l.menuError),w=async()=>{if(n.value)try{l.loadingBusiness=!0,l.businessError=!1;const e=await Aa.get(`/public/business/${n.value}`);if(!e.data.success)throw new Error(e.data.message||"Error loading business info");l.businessData=e.data.business,console.log("✅ Business info loaded:",l.businessData)}catch(e){console.error("❌ Error loading business info:",e),l.businessError=!0,l.businessData={name:"Restaurante",address:null,logo:null}}finally{l.loadingBusiness=!1}else console.error("Business ID not provided")},C=async()=>{if(!n.value)return console.error("Business ID not provided for menu"),void(l.loadingMenu=!1);try{l.loadingMenu=!0,l.menuError=!1;const e=await Aa.get(`/public/business/${n.value}/menu`);e.data.success&&e.data.menu_pdf_url?(l.menuPdfUrl=e.data.menu_pdf_url,console.log("✅ Menu PDF loaded:",l.menuPdfUrl)):(console.warn("⚠️ No menu available for this business"),l.menuPdfUrl=null)}catch(e){console.error("❌ Error loading menu:",e),l.menuError=!0}finally{l.loadingMenu=!1}},k=e=>{l.callStatus=e,console.log("📱 Call status changed:",e)};return r(async()=>{console.log("🏠 MenuTable mounted",{tableId:a.value,businessId:n.value,tableNumber:i.value}),a.value&&n.value?await Promise.all([w(),C()]):console.error("❌ Missing required parameters")}),(e,t)=>(d(),c("div",MN,[u("div",LN,[u("div",ON,[m.value.logo?(d(),c("div",FN,[u("img",{src:m.value.logo,alt:m.value.name},null,8,UN)])):h("",!0),u("div",BN,[u("h1",null,p(m.value.name||"Bienvenido"),1),u("div",qN,[t[0]||(t[0]=u("i",{class:"fas fa-table"},null,-1)),u("span",null,"Mesa "+p(i.value),1)]),m.value.address?(d(),c("div",jN,[t[1]||(t[1]=u("i",{class:"fas fa-map-marker-alt"},null,-1)),u("span",null,p(m.value.address),1)])):h("",!0)])])]),u("div",$N,[u("div",zN,[t[8]||(t[8]=u("div",{class:"section-header"},[u("h2",null,[u("i",{class:"fas fa-utensils"}),y(" Nuestro Menú ")])],-1)),g.value?(d(),c("div",VN,t[2]||(t[2]=[u("div",{class:"spinner"},null,-1),u("p",null,"Cargando menú...",-1)]))):v.value?(d(),c("div",WN,[t[4]||(t[4]=u("i",{class:"fas fa-exclamation-triangle"},null,-1)),t[5]||(t[5]=u("p",null,"No pudimos cargar el menú",-1)),u("button",{onClick:C,class:"retry-btn"},t[3]||(t[3]=[u("i",{class:"fas fa-refresh"},null,-1),y(" Reintentar ")]))])):f.value?(d(),c("div",HN,[u("iframe",{src:f.value,class:"pdf-viewer",title:"Menú del restaurante",frameborder:"0"},null,8,GN),u("div",YN,[u("a",{href:f.value,target:"_blank",class:"pdf-action-btn"},t[6]||(t[6]=[u("i",{class:"fas fa-external-link-alt"},null,-1),y(" Ver menú completo ")]),8,KN)])])):(d(),c("div",QN,t[7]||(t[7]=[u("i",{class:"fas fa-file-pdf"},null,-1),u("p",null,"Menú no disponible temporalmente",-1),u("small",null,"Consulte con el personal del establecimiento",-1)])))]),u("div",JN,[b(DN,{"table-id":a.value,"business-id":n.value,"table-number":i.value,onCallStatusChange:k},null,8,["table-id","business-id","table-number"])])]),u("div",ZN,[u("div",XN,[t[9]||(t[9]=u("span",null,"Powered by",-1)),t[10]||(t[10]=u("strong",null,"MozoApp",-1)),u("span",ex,p(o(Or)()),1)])])]))}},[["__scopeId","data-v-eae715a0"]]),ax=U({history:B("/"),routes:[{path:"/",name:"root",beforeEnter:(e,t,a)=>{const n=Xa(),{isAuthenticated:i,currentRole:s}=q(n);if(i.value){return a({name:"waiter"===(s.value||"admin")?"waiter-dashboard":"admin"})}return a({name:"login"})}},{path:"/login",name:"login",component:al,meta:{requiresGuest:!0}},{path:"/register",name:"register",component:yl,meta:{requiresGuest:!0}},{path:"/forgot-password",name:"forgot-password",component:Pl,meta:{requiresGuest:!0}},{path:"/reset-password",name:"reset-password",component:Kl,meta:{requiresGuest:!0}},{path:"/role-selection",name:"role-selection",component:ic,meta:{requiresAuth:!0}},{path:"/waiter/dashboard",name:"waiter-dashboard",component:Cy,meta:{requiresAuth:!0,role:"waiter"}},{path:"/waiter/onboard",name:"waiter-onboard",component:P_,meta:{requiresAuth:!0,role:"waiter"}},{path:"/profile",name:"profile",component:y_,meta:{requiresAuth:!0}},{path:"/admin",name:"admin",component:tC,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/home",name:"admin-home",component:mC,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/qr",name:"admin-qr",component:Sk,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/stats",name:"admin-stats",component:Ik,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/staff",name:"admin-staff",component:zE,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/staff/:id",name:"admin-staff-detail",component:cT,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/profile",name:"admin-profile",component:GT,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/settings",name:"admin-settings",component:xI,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/notification-debug",name:"admin-notification-debug",component:wN,meta:{requiresAuth:!0,role:"admin"}},{path:"/menu/mesa/:tableId",name:"menu-table",component:tx,meta:{isPublic:!0}},{path:"/:pathMatch(.*)*",redirect:"/"}]});ax.beforeEach(async(e,t,a)=>{const n=Xa(),{isAuthenticated:i}=q(n);if(e.meta.isPublic)return a();i.value&&!n.user&&await n.fetchUser(),a()});const nx=Z("PushNotifications",{}),ix=Object.freeze(Object.defineProperty({__proto__:null,PushNotifications:nx},Symbol.toStringTag,{value:"Module"})),sx={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_DEBUG_MODE:"true",VITE_FIREBASE_ANDROID_APP_ID:"1:175482362472:android:f2589ca9ec71fd0cb6b9dd",VITE_FIREBASE_API_KEY:"AIzaSyBlupKSIy7qtTsXukqROyVjMNx03X8CCzU",VITE_FIREBASE_APP_ID:"1:175482362472:web:308070c885bacc71b6b9dd",VITE_FIREBASE_AUTH_DOMAIN:"mozoqr-7d32c.firebaseapp.com",VITE_FIREBASE_DATABASE_URL:"https://mozoqr-7d32c-default-rtdb.firebaseio.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"175482362472",VITE_FIREBASE_PROJECT_ID:"mozoqr-7d32c",VITE_FIREBASE_STORAGE_BUCKET:"mozoqr-7d32c.firebasestorage.app",VITE_FIREBASE_VAPID_KEY:"BNJgpNkgB0a0y7gHT-SNBFLMGIZw-Xx8NTBDCn_4dVqekzgmnGmKMIn10t-6gWl3Qj_msyCcfbsVycnAp8USs6M",VITE_MEASUREMENT_ID:"G-6N7J4X94DH",VITE_PUSHER_APP_CLUSTER:"us2",VITE_PUSHER_APP_KEY:"bd06ab967cc733531514",VITE_QR_BASE_URL:"https://mozoqr.com",VITE_URL_API:"https://mozoqr.com/api/"},ox=i({configured:!1,tokenExists:!1}),rx=async()=>{if(!J.isPluginAvailable("PushNotifications"))return{available:!1,reason:"Plugin no disponible"};try{const e=await nx.checkPermissions(),t=localStorage.getItem("fcm_token");return{available:!0,permissions:e.receive,hasToken:!!t,token:t?`${t.substring(0,20)}...`:null,platform:J.getPlatform()}}catch(e){return{available:!1,reason:e.message}}},lx=()=>{const e=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_PROJECT_ID"].filter(e=>!sx[e]);return{configured:0===e.length,missing:e,config:{apiKey:"Configurada",projectId:"Configurada"}}};(async()=>{try{if(J.isPluginAvailable&&J.isPluginAvailable("LocalNotifications")){const t=(await W(()=>import("./index-B_qQR_LU.js"),__vite__mapDeps([7,1,2]))).LocalNotifications;try{t&&t.createChannel&&(await t.createChannel({id:"mozo_waiter",name:"Mozo - Llamadas",importance:5,visibility:1,description:"Notificaciones de llamadas y eventos importantes para mozos"}),console.log("✅ Canal mozo_waiter creado al importar pushNotifications"))}catch(e){console.warn("⚠️ Error creando canal mozo_waiter al importar:",e)}}}catch(e){console.warn("⚠️ No se pudo crear canal mozo_waiter al importar pushNotifications:",e)}})();const cx=e=>{try{const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      top: 50px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: rgba(0,0,0,0.9);\n      color: white;\n      padding: 12px 20px;\n      border-radius: 8px;\n      z-index: 10000;\n      font-size: 14px;\n      font-weight: bold;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.5);\n      max-width: 90%;\n      text-align: center;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.parentElement&&t.remove()},3e3)}catch(t){console.warn("Toast debug failed:",t)}},dx=e=>{try{if(!e.data)return!1;const t="string"==typeof e.data?JSON.parse(e.data):e.data;return"acknowledged"===t.status||"completed"===t.status?(console.log("🚫 Filtrando actualización de estado:",t.status),!0):e.android&&"normal"===e.android.priority?(console.log("🚫 Filtrando notificación de prioridad normal (posible confirmación)"),!0):"normal"===t.priority&&"new_call"!==t.type&&(console.log("🚫 Filtrando notificación normal que no es llamada nueva"),!0)}catch(t){return console.warn("⚠️ Error filtering notification:",t),!1}},ux=e=>{console.log("🔄 Procesando notificación del backend...");let t={title:e.title||"Nueva notificación",body:e.body||"Tienes una nueva notificación",data:e.data||{}};if(e.data){const a="string"==typeof e.data?JSON.parse(e.data):e.data;switch(console.log("🔄 Datos de notificación:",a),a.type){case"TestNotification":t={title:"Notificación de Prueba",body:"Esta es una notificación de prueba enviada a todos los usuarios del negocio",data:{...a,icon:"🧪",priority:"normal",channels:["Database","Broadcast","FCM"]}};break;case"UserSpecificNotification":t={title:a.title||"Notificación Personalizada",body:a.message||"Tienes una nueva notificación personalizada",data:{...a,icon:"👤",priority:"high",channels:["Database","Broadcast","FCM"]}};break;case"WebSocketTestNotification":t={title:"⚡ Prueba WebSocket + FCM",body:"Esta notificación llega por WebSocket (tiempo real) y FCM (push)",data:{...a,icon:"⚡",priority:"high",test_mode:"websocket_fcm"}};break;case"WebSocketOnlyNotification":t={title:"🔌 Prueba Solo WebSocket",body:"Esta notificación SOLO llega por WebSocket en tiempo real",data:{...a,icon:"🔌",priority:"normal",test_mode:"websocket_only"}};break;default:e.title&&e.body&&(t={title:e.title,body:e.body,data:{...a,icon:"📱",priority:"normal"}})}}return console.log("✅ Notificación procesada:",t),t},hx=Object.freeze(Object.defineProperty({__proto__:null,checkFirebaseConfig:lx,fcmStatus:ox,getNotificationStatus:rx,initializePushNotifications:async()=>{console.log("🔔 Inicializando sistema de notificaciones push...");const e=J.getPlatform();console.log("🔔 Plataforma detectada:",e),await(async()=>{if(console.log("🔔 Setting up push notification listeners..."),"web"===J.getPlatform())try{return console.log("🔔 Setting up Firebase listeners for web..."),await Ha.setupForegroundMessageListener(e=>{console.log("🚨 FCM NOTIFICATION RECEIVED IN REAL-TIME:",e),console.log("⏰ Received at:",(new Date).toLocaleTimeString()),W(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>rr);return{useNotificationsStore:e}},void 0).then(({useNotificationsStore:t})=>{var a,n,i,s;const o=t(),r=(null==(a=e.data)?void 0:a.call_id)||(null==(n=e.data)?void 0:n.callId)||(null==(i=e.data)?void 0:i.callID)||null,l={id:r||`fcm-${Date.now()}`,type:(null==(s=e.data)?void 0:s.type)||(r?"waiter_call":"FCMNotification"),data:{title:e.title,message:e.body,...e.data},created_at:(new Date).toISOString(),read_at:null,source:"fcm-realtime"};try{if(r&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls&&window.ultraFastNotifications.activeCalls.has(r))return void console.log("🔍 Skipping FCM store add for call already in UltraFast activeCalls:",r)}catch(c){console.warn("⚠️ Error checking ultraFastNotifications activeCalls for dedupe:",c)}console.log("📨 Adding notification to store:",l),r&&(o.waiterUnreadNotifications.find(e=>e.id===r)||o.unreadNotifications.find(e=>e.id===r))?console.log("🔁 Duplicate notification skipped (canonicalCallId):",r):(o.addNewNotification(l),console.log("✅ Notification added to reactive store!"))}).catch(e=>{console.error("❌ Error importing notifications store:",e)})}),void console.log("✅ Firebase listeners configured for web")}catch(e){return void console.error("❌ Error setting up Firebase listeners:",e)}if(J.isPluginAvailable("PushNotifications"))try{nx.addListener("registration",async t=>{var a,n,i,s;console.log("✅ Push registration success, token:",t.value),localStorage.setItem("fcm_token",t.value);let o=0;const r=e=>new Promise(t=>setTimeout(t,e));for(;o<5;)try{const e=Xa();if(console.log("🔔 Intento de envío de token - intento",o+1,"authState:",{isAuthenticated:e.isAuthenticated,userId:null==(a=e.user)?void 0:a.id}),e.isAuthenticated&&(null==(n=e.user)?void 0:n.id)){const a=J.getPlatform();console.log("🔔 Enviando token al backend (móvil):",{token:t.value.substring(0,20)+"...",platform:a,userId:null==(i=e.user)?void 0:i.id});const n=await Pa.storeDeviceToken(t.value,a,null==(s=e.user)?void 0:s.id);console.log("✅ Device token stored successfully (móvil):",n);break}o++,console.log("⚠️ Usuario no autenticado aún, reintentando en 500ms..."),await r(500);continue}catch(e){console.error("❌ Error intentando enviar token (móvil):",e),o++,await r(500)}5===o&&console.warn("⚠️ No se pudo enviar token al backend después de varios intentos. Se dejó guardado localmente.")}),nx.addListener("registrationError",e=>{console.error("❌ Error on registration:",JSON.stringify(e))}),nx.addListener("pushNotificationReceived",e=>{var t,a,n;const i=(null==(t=e.android)?void 0:t.priority)||(null==(a=e.data)?void 0:a.priority)||"unknown",s=(null==(n=e.data)?void 0:n.status)||"unknown";if(console.log(`🔔 Push received - Priority: ${i}, Status: ${s}`),console.log("🔔 Full notification:",JSON.stringify(e,null,2)),cx(`📨 Push: ${i}/${s}`),dx(e))return console.log(`🚫 Notificación filtrada - Priority: ${i}, Status: ${s}`),void cx(`🚫 FILTRADA: ${i}/${s}`);console.log(`✅ Notificación permitida - Priority: ${i}, Status: ${s}`),cx(`✅ PERMITIDA: ${i}/${s}`);const o=ux(e);J.isPluginAvailable("LocalNotifications")?W(async()=>{const{LocalNotifications:e}=await import("./index-B_qQR_LU.js");return{LocalNotifications:e}},__vite__mapDeps([7,1,2])).then(({LocalNotifications:e})=>{e.schedule({notifications:[{title:o.title,body:o.body,id:(new Date).getTime(),sound:null,actionTypeId:"OPEN_APP",extra:{...o.data,receivedAt:(new Date).toISOString(),source:"push-foreground"}}]}).catch(e=>{console.error("❌ Error programando notificación local:",e)})}).catch(e=>{console.error("❌ Error importando LocalNotifications:",e)}):"Notification"in window&&"granted"===Notification.permission&&new Notification(o.title,{body:o.body,icon:"/favicon.ico",tag:"push-notification",data:o.data})}),nx.addListener("pushNotificationActionPerformed",e=>{console.log("🔔 Push action performed:",JSON.stringify(e,null,2));const t=e.notification.data;t&&t.route&&console.log("🔔 Navegando a:",t.route)}),console.log("✅ Listeners de notificaciones configurados correctamente")}catch(e){console.error("❌ Error configurando listeners:",e)}else console.log("⚠️ Plugin PushNotifications no disponible para listeners")})();const t=await(async()=>{var e;console.log("🔔 Starting push notification registration...");const t=J.getPlatform(),a=J.isNativePlatform();if(console.log("🔔 DETECTED - Platform:",t,"Native:",a),"web"===t&&!a)try{if(console.log("🔔 Web platform detected, using Firebase FCM..."),!(await Ha.initializeFirebase()))return{success:!1,error:"Firebase initialization failed"};const t=await Ha.getFCMToken();console.log("🔔 FCM token obtained for web:",t.substring(0,20)+"..."),localStorage.setItem("fcm_token",t);const a=Xa();if(a.isAuthenticated)try{const n=await Pa.storeDeviceToken(t,"web",null==(e=a.user)?void 0:e.id);console.log("✅ Device token stored:",n),ox.value={configured:!0,tokenExists:!0}}catch(n){console.error("❌ Error storing device token:",n)}else console.warn("⚠️ User not authenticated - token not sent to server");return{success:!0,token:t}}catch(n){return console.error("❌ FCM registration error:",n),{success:!1,error:n.message}}try{if(console.log("🔔 MOBILE: Starting Capacitor push notification registration..."),console.log("🔔 MOBILE: Platform:",J.getPlatform()),console.log("🔔 MOBILE: Native platform:",J.isNativePlatform()),!J.isPluginAvailable("PushNotifications"))return console.warn("⚠️ Plugin PushNotifications no disponible para registro (móvil)"),{success:!1,error:"PushNotifications plugin not available"};console.log("✅ MOBILE: PushNotifications plugin available");try{console.log("🔔 MOBILE: Requesting push permissions...");const e=await nx.requestPermissions();if(console.log("🔔 MOBILE: Push permission result:",e),e&&"denied"===e.receive)return console.error("❌ MOBILE: Push permissions DENIED"),{success:!1,error:"Push permissions denied"};console.log("✅ MOBILE: Push permissions OK")}catch(i){console.warn("⚠️ MOBILE: Error requesting push permissions:",i)}return console.log("🔔 MOBILE: Calling PushNotifications.register()..."),await nx.register(),console.log("✅ MOBILE: PushNotifications.register() completed"),{success:!0,token:null}}catch(n){return console.error("❌ Mobile push registration error:",n),{success:!1,error:n.message}}})();J.isPluginAvailable&&J.isPluginAvailable("LocalNotifications")&&W(async()=>{const{LocalNotifications:e}=await import("./index-B_qQR_LU.js");return{LocalNotifications:e}},__vite__mapDeps([7,1,2])).then(({LocalNotifications:e})=>{try{e&&e.createChannel&&e.createChannel({id:"mozo_waiter",name:"Mozo - Llamadas",importance:5,visibility:1,description:"Notificaciones de llamadas y eventos importantes para mozos"}).then(()=>{console.log("✅ Canal de notificaciones Android creado: mozo_waiter")}).catch(e=>{console.warn("⚠️ Error creando canal LocalNotifications:",e)})}catch(t){console.warn("⚠️ Excepción creando canal LocalNotifications:",t)}}).catch(e=>{console.warn("⚠️ No se pudo importar LocalNotifications para crear canal:",e)});const a=await rx(),n=lx(),i=Ha.getFirebaseStatus();return console.log("🔔 Estado final de notificaciones:",{platform:e,registration:t,status:a,firebase:n,firebaseStatus:i}),{platform:e,registration:t,status:a,firebase:n,firebaseStatus:i}}},Symbol.toStringTag,{value:"Module"}));const px=j(jr),mx=$();px.use(mx),px.use(ax),px.mount("#app"),"undefined"!=typeof window&&navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",e=>{if(!e.data||"fcm_event"!==e.data.type)return;const t=e.data.payload.data||{},a=H(),n=t.call_id||t.callId;var i;n&&(a.has(n)||a.upsert({id:n,table_id:t.table_id,table_number:t.table_number,status:t.status||(i=t.type,"new_call"===i?"pending":"acknowledged"===i?"acknowledged":"completed"===i?"completed":"pending"),urgency:t.urgency,called_at:t.timestamp||Date.now(),last_updated:Date.now(),event_type:t.type||"event"}))});const fx=(()=>{try{if(console.log("🔍 DEBUG: window.Capacitor:",!!window.Capacitor),!window.Capacitor)return!1;if("function"==typeof window.Capacitor.isNativePlatform){const e=window.Capacitor.isNativePlatform();return console.log("🔍 DEBUG: isNativePlatform():",e),e}if("function"==typeof window.Capacitor.getPlatform){const e=window.Capacitor.getPlatform();return console.log("🔍 DEBUG: getPlatform():",e),"android"===e||"ios"===e}return!1}catch(e){return console.log("🔍 DEBUG: Error detectando plataforma:",e),!1}})();console.log("🔍 DEBUG: isNative =",fx),console.log("🔍 DEBUG: window.Capacitor?.getPlatform() =",null==(e=window.Capacitor)?void 0:e.getPlatform()),console.log("🔍 DEBUG: Condición completa:",fx&&"android"===(null==(t=window.Capacitor)?void 0:t.getPlatform())),fx&&"android"===(null==(a=window.Capacitor)?void 0:a.getPlatform())?(console.log("🔔 ANDROID: Inicializando FCM específico para Android..."),console.log("🔍 DEBUG: Configurando setTimeout para Android FCM en 3 segundos..."),setTimeout(async()=>{console.log("🔍 DEBUG: setTimeout ejecutado - iniciando importación de androidFCM");try{console.log("🔍 DEBUG: Importando ./services/androidFCM.js...");const e=await W(()=>import("./androidFCM-DakZu76G.js"),__vite__mapDeps([8,1,2]));console.log("🔍 DEBUG: Módulo importado:",!!e),console.log("🔍 DEBUG: initializeAndroidFCM existe:",!!(null==e?void 0:e.initializeAndroidFCM)),(null==e?void 0:e.initializeAndroidFCM)?(console.log("🔍 DEBUG: Llamando a initializeAndroidFCM..."),await e.initializeAndroidFCM(),console.log("🔍 DEBUG: initializeAndroidFCM completado")):console.log("❌ DEBUG: initializeAndroidFCM no encontrado en el módulo")}catch(e){console.error("❌ Error inicializando Android FCM:",e),console.error("❌ Stack trace:",e.stack)}},3e3)):console.log("🔍 DEBUG: NO ejecutando Android FCM - condición no cumplida"),!fx&&"serviceWorker"in navigator&&navigator.serviceWorker.register("/firebase-messaging-sw.js").then(e=>console.log("Service Worker registrado:",e.scope)).catch(e=>console.warn("No se pudo registrar el Service Worker:",e)),fx?console.log("Saltando runNotificationDiagnostics en entorno nativo"):async function(){console.group("[NotificationDiagnostics] Iniciando diagnóstico de notificaciones");try{if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.getRegistration("/firebase-messaging-sw.js");e?(console.log("[NotificationDiagnostics] Service Worker registrado. Scope:",e.scope),console.log("[NotificationDiagnostics] Service Worker active state:",e.active?e.active.state:"no active")):console.warn("[NotificationDiagnostics] Service Worker /firebase-messaging-sw.js NO registrado")}catch(e){console.warn("[NotificationDiagnostics] Error comprobando Service Worker:",e)}else console.warn("[NotificationDiagnostics] Service Workers no soportados en este navegador");const n="undefined"!=typeof Notification?Notification.permission:"unsupported";console.log("[NotificationDiagnostics] Permission:",n);const i=localStorage.getItem("fcm_token");if(console.log("[NotificationDiagnostics] fcm_token en localStorage:",i?`${i.substring(0,20)}...`:"no encontrado"),"denied"===n)console.warn("[NotificationDiagnostics] Permisos DENEGADOS - no se intentará obtener token");else try{if("default"===n){console.log("[NotificationDiagnostics] Solicitando permiso de notificaciones...");const e=await Notification.requestPermission();if(console.log("[NotificationDiagnostics] Resultado requestPermission():",e),"granted"!==e)return console.warn("[NotificationDiagnostics] Permiso no concedido; abortando obtención de token"),void console.groupEnd()}if(console.log("[NotificationDiagnostics] Inicializando Firebase y solicitando token..."),await Ha.initializeFirebase())try{const e=await Ha.getFCMToken();if(console.log("[NotificationDiagnostics] FCM token obtenido:",e?`${e.substring(0,20)}...`:"no token"),e&&localStorage.setItem("fcm_token",e),localStorage.getItem("token"))try{console.log("[NotificationDiagnostics] Intentando enviar token al backend (prueba) con platform=web..."),await Pa.storeDeviceToken(e,"web"),console.log("[NotificationDiagnostics] Intento de registro en backend: OK (verificar en DB)")}catch(t){console.warn("[NotificationDiagnostics] Error enviando token al backend:",(null==t?void 0:t.message)||t)}else console.log("[NotificationDiagnostics] No hay auth token en localStorage; no se enviará token al backend")}catch(a){console.warn("[NotificationDiagnostics] Error obteniendo FCM token:",(null==a?void 0:a.message)||a)}else console.warn("[NotificationDiagnostics] No se pudo inicializar Firebase (revisar variables env y SW)")}catch(e){console.warn("[NotificationDiagnostics] Error durante diagnóstico FCM:",e)}}finally{console.groupEnd()}}().catch(e=>console.warn("Error ejecutando diagnósticos de notificación:",e));export{Ra as A,en as B,J as C,au as D,Oc as E,Lc as F,ix as G,rd as L,pu as S,X as W,W as _,ru as a,iu as b,ou as c,cu as d,du as e,lu as f,su as g,fu as h,mu as i,Z as j,Jc as k,Qc as l,Rc as m,Mc as n,yd as o,_d as p,Cc as q,gu as r,Sc as s,Tc as t,Ac as u,Dc as v,Wc as w,Ic as x,td as y,$r as z};
