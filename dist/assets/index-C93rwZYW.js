const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-DS02TGiW.js","assets/vendor-C8q6etev.js","assets/bootstrap--QliLv9A.js","assets/echo-DkeVFlXc.js","assets/index.esm-DW8KlCX8.js","assets/index.esm-D0huLPmv.js","assets/index-NWj49HSU.js"])))=>i.map(i=>d[i]);
import{d as e,r as t,c as a,u as n,o as s,a as i,b as o,e as r,f as l,g as c,t as d,n as u,w as h,F as p,h as m,i as f,j as g,k as v,l as b,m as w,p as y,q as _,T as k,s as C,v as E,x as S,y as T,z as N,A as x,B as I,C as A,D as P,E as R,G as D,H as L,I as M,J as O,K as F,L as U,M as B}from"./vendor-C8q6etev.js";import{M as q}from"./bootstrap--QliLv9A.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const $={},j=function(e,t,a){let n=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=(null==a?void 0:a.nonce)||(null==a?void 0:a.getAttribute("nonce"));n=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in $)return;$[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,s&&n.setAttribute("nonce",s),document.head.appendChild(n),t?new Promise((t,a)=>{n.addEventListener("load",t),n.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})};
/*! Capacitor: https://capacitorjs.com/ - MIT License */
var z,V;(V=z||(z={})).Unimplemented="UNIMPLEMENTED",V.Unavailable="UNAVAILABLE";class W extends Error{constructor(e,t,a){super(e),this.message=e,this.code=t,this.data=a}}const H=e=>{const t=e.CapacitorCustomPlatform||null,a=e.Capacitor||{},n=a.Plugins=a.Plugins||{},s=()=>null!==t?t.name:(e=>{var t,a;return(null==e?void 0:e.androidBridge)?"android":(null===(a=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===a?void 0:a.bridge)?"ios":"web"})(e),i=e=>{var t;return null===(t=a.PluginHeaders)||void 0===t?void 0:t.find(t=>t.name===e)},o=new Map;return a.convertFileSrc||(a.convertFileSrc=e=>e),a.getPlatform=s,a.handleError=t=>e.console.error(t),a.isNativePlatform=()=>"web"!==s(),a.isPluginAvailable=e=>{const t=o.get(e);return!!(null==t?void 0:t.platforms.has(s()))||!!i(e)},a.registerPlugin=(e,r={})=>{const l=o.get(e);if(l)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),l.proxy;const c=s(),d=i(e);let u;const h=n=>{let s;const i=(...i)=>{const o=(async()=>(!u&&c in r?u=u="function"==typeof r[c]?await r[c]():r[c]:null!==t&&!u&&"web"in r&&(u=u="function"==typeof r.web?await r.web():r.web),u))().then(t=>{const o=((t,n)=>{var s,i;if(!d){if(t)return null===(i=t[n])||void 0===i?void 0:i.bind(t);throw new W(`"${e}" plugin is not implemented on ${c}`,z.Unimplemented)}{const i=null==d?void 0:d.methods.find(e=>n===e.name);if(i)return"promise"===i.rtype?t=>a.nativePromise(e,n.toString(),t):(t,s)=>a.nativeCallback(e,n.toString(),t,s);if(t)return null===(s=t[n])||void 0===s?void 0:s.bind(t)}})(t,n);if(o){const e=o(...i);return s=null==e?void 0:e.remove,e}throw new W(`"${e}.${n}()" is not implemented on ${c}`,z.Unimplemented)});return"addListener"===n&&(o.remove=async()=>s()),o};return i.toString=()=>`${n.toString()}() { [capacitor code] }`,Object.defineProperty(i,"name",{value:n,writable:!1,configurable:!1}),i},p=h("addListener"),m=h("removeListener"),f=(e,t)=>{const a=p({eventName:e},t),n=async()=>{const n=await a;m({eventName:e,callbackId:n},t)},s=new Promise(e=>a.then(()=>e({remove:n})));return s.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await n()},s},g=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return d?f:p;case"removeListener":return m;default:return h(t)}}});return n[e]=g,o.set(e,{name:e,proxy:g,platforms:new Set([...Object.keys(r),...d?[c]:[]])}),g},a.Exception=W,a.DEBUG=!!a.DEBUG,a.isLoggingEnabled=!!a.isLoggingEnabled,a},G=(e=>e.Capacitor=H(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),Y=G.registerPlugin;class K{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let a=!1;this.listeners[e]||(this.listeners[e]=[],a=!0),this.listeners[e].push(t);const n=this.windowListeners[e];n&&!n.registered&&this.addWindowListener(n),a&&this.sendRetainedArgumentsForEvent(e);return Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,a){const n=this.listeners[e];if(n)n.forEach(e=>e(t));else if(a){let a=this.retainedEventArguments[e];a||(a=[]),a.push(t),this.retainedEventArguments[e]=a}}hasListeners(e){var t;return!!(null===(t=this.listeners[e])||void 0===t?void 0:t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new G.Exception(e,z.Unimplemented)}unavailable(e="not available"){return new G.Exception(e,z.Unavailable)}async removeListener(e,t){const a=this.listeners[e];if(!a)return;const n=a.indexOf(t);this.listeners[e].splice(n,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(t=>{this.notifyListeners(e,t)}))}}const Q=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),J=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Z extends K{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[a,n]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");a=J(a).trim(),n=J(n).trim(),t[a]=n}),t}async setCookie(e){try{const t=Q(e.key),a=Q(e.value),n=`; expires=${(e.expires||"").replace("expires=","")}`,s=(e.path||"/").replace("path=",""),i=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${a||""}${n}; path=${s}; ${i};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}Y("CapacitorCookies",{web:()=>new Z});const X=(e,t={})=>{const a=Object.assign({method:e.method||"GET",headers:e.headers},t),n=((e={})=>{const t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((a,n,s)=>(a[n]=e[t[s]],a),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)a.body=e.data;else if(n.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[a,n]of Object.entries(e.data||{}))t.set(a,n);a.body=t.toString()}else if(n.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,a)=>{t.append(a,e)});else for(const a of Object.keys(e.data))t.append(a,e.data[a]);a.body=t;const n=new Headers(a.headers);n.delete("content-type"),a.headers=n}else(n.includes("application/json")||"object"==typeof e.data)&&(a.body=JSON.stringify(e.data));return a};class ee extends K{async request(e){const t=X(e,e.webFetchExtra),a=((e,t=!0)=>e?Object.entries(e).reduce((e,a)=>{const[n,s]=a;let i,o;return Array.isArray(s)?(o="",s.forEach(e=>{i=t?encodeURIComponent(e):e,o+=`${n}=${i}&`}),o.slice(0,-1)):(i=t?encodeURIComponent(s):s,o=`${n}=${i}`),`${e}&${o}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),n=a?`${e.url}?${a}`:e.url,s=await fetch(n,t),i=s.headers.get("content-type")||"";let o,r,{responseType:l="text"}=s.ok?e:{};switch(i.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":r=await s.blob(),o=await(async e=>new Promise((t,a)=>{const n=new FileReader;n.onload=()=>{const e=n.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},n.onerror=e=>a(e),n.readAsDataURL(e)}))(r);break;case"json":o=await s.json();break;default:o=await s.text()}const c={};return s.headers.forEach((e,t)=>{c[t]=e}),{data:o,headers:c,status:s.status,url:s.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}Y("CapacitorHttp",{web:()=>new ee});const te=Object.freeze(Object.defineProperty({__proto__:null,Capacitor:G,CapacitorException:W,get ExceptionCode(){return z},WebPlugin:K,buildRequestInit:X,registerPlugin:Y},Symbol.toStringTag,{value:"Module"})),ae=Y("App",{web:()=>j(()=>import("./web-DS02TGiW.js"),__vite__mapDeps([0,1,2])).then(e=>new e.AppWeb)}),ne=e("ui",()=>{const e=t(!1);return{isOffCanvasOpen:e,toggleOffCanvas:function(){e.value=!e.value},closeOffCanvas:function(){e.value=!1}}});function se(e,t){return function(){return e.apply(t,arguments)}}const{toString:ie}=Object.prototype,{getPrototypeOf:oe}=Object,{iterator:re,toStringTag:le}=Symbol,ce=(e=>t=>{const a=ie.call(t);return e[a]||(e[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),de=e=>(e=e.toLowerCase(),t=>ce(t)===e),ue=e=>t=>typeof t===e,{isArray:he}=Array,pe=ue("undefined");const me=de("ArrayBuffer");const fe=ue("string"),ge=ue("function"),ve=ue("number"),be=e=>null!==e&&"object"==typeof e,we=e=>{if("object"!==ce(e))return!1;const t=oe(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||le in e||re in e)},ye=de("Date"),_e=de("File"),ke=de("Blob"),Ce=de("FileList"),Ee=de("URLSearchParams"),[Se,Te,Ne,xe]=["ReadableStream","Request","Response","Headers"].map(de);function Ie(e,t,{allOwnKeys:a=!1}={}){if(null==e)return;let n,s;if("object"!=typeof e&&(e=[e]),he(e))for(n=0,s=e.length;n<s;n++)t.call(null,e[n],n,e);else{const s=a?Object.getOwnPropertyNames(e):Object.keys(e),i=s.length;let o;for(n=0;n<i;n++)o=s[n],t.call(null,e[o],o,e)}}function Ae(e,t){t=t.toLowerCase();const a=Object.keys(e);let n,s=a.length;for(;s-- >0;)if(n=a[s],t===n.toLowerCase())return n;return null}const Pe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Re=e=>!pe(e)&&e!==Pe;const De=(e=>t=>e&&t instanceof e)("undefined"!=typeof Uint8Array&&oe(Uint8Array)),Le=de("HTMLFormElement"),Me=(({hasOwnProperty:e})=>(t,a)=>e.call(t,a))(Object.prototype),Oe=de("RegExp"),Fe=(e,t)=>{const a=Object.getOwnPropertyDescriptors(e),n={};Ie(a,(a,s)=>{let i;!1!==(i=t(a,s,e))&&(n[s]=i||a)}),Object.defineProperties(e,n)};const Ue=de("AsyncFunction"),Be=(qe="function"==typeof setImmediate,$e=ge(Pe.postMessage),qe?setImmediate:$e?(je=`axios@${Math.random()}`,ze=[],Pe.addEventListener("message",({source:e,data:t})=>{e===Pe&&t===je&&ze.length&&ze.shift()()},!1),e=>{ze.push(e),Pe.postMessage(je,"*")}):e=>setTimeout(e));var qe,$e,je,ze;const Ve="undefined"!=typeof queueMicrotask?queueMicrotask.bind(Pe):"undefined"!=typeof process&&process.nextTick||Be,We={isArray:he,isArrayBuffer:me,isBuffer:function(e){return null!==e&&!pe(e)&&null!==e.constructor&&!pe(e.constructor)&&ge(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||ge(e.append)&&("formdata"===(t=ce(e))||"object"===t&&ge(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&me(e.buffer),t},isString:fe,isNumber:ve,isBoolean:e=>!0===e||!1===e,isObject:be,isPlainObject:we,isReadableStream:Se,isRequest:Te,isResponse:Ne,isHeaders:xe,isUndefined:pe,isDate:ye,isFile:_e,isBlob:ke,isRegExp:Oe,isFunction:ge,isStream:e=>be(e)&&ge(e.pipe),isURLSearchParams:Ee,isTypedArray:De,isFileList:Ce,forEach:Ie,merge:function e(){const{caseless:t}=Re(this)&&this||{},a={},n=(n,s)=>{const i=t&&Ae(a,s)||s;we(a[i])&&we(n)?a[i]=e(a[i],n):we(n)?a[i]=e({},n):he(n)?a[i]=n.slice():a[i]=n};for(let s=0,i=arguments.length;s<i;s++)arguments[s]&&Ie(arguments[s],n);return a},extend:(e,t,a,{allOwnKeys:n}={})=>(Ie(t,(t,n)=>{a&&ge(t)?e[n]=se(t,a):e[n]=t},{allOwnKeys:n}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,a,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),a&&Object.assign(e.prototype,a)},toFlatObject:(e,t,a,n)=>{let s,i,o;const r={};if(t=t||{},null==e)return t;do{for(s=Object.getOwnPropertyNames(e),i=s.length;i-- >0;)o=s[i],n&&!n(o,e,t)||r[o]||(t[o]=e[o],r[o]=!0);e=!1!==a&&oe(e)}while(e&&(!a||a(e,t))&&e!==Object.prototype);return t},kindOf:ce,kindOfTest:de,endsWith:(e,t,a)=>{e=String(e),(void 0===a||a>e.length)&&(a=e.length),a-=t.length;const n=e.indexOf(t,a);return-1!==n&&n===a},toArray:e=>{if(!e)return null;if(he(e))return e;let t=e.length;if(!ve(t))return null;const a=new Array(t);for(;t-- >0;)a[t]=e[t];return a},forEachEntry:(e,t)=>{const a=(e&&e[re]).call(e);let n;for(;(n=a.next())&&!n.done;){const a=n.value;t.call(e,a[0],a[1])}},matchAll:(e,t)=>{let a;const n=[];for(;null!==(a=e.exec(t));)n.push(a);return n},isHTMLForm:Le,hasOwnProperty:Me,hasOwnProp:Me,reduceDescriptors:Fe,freezeMethods:e=>{Fe(e,(t,a)=>{if(ge(e)&&-1!==["arguments","caller","callee"].indexOf(a))return!1;const n=e[a];ge(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")}))})},toObjectSet:(e,t)=>{const a={},n=e=>{e.forEach(e=>{a[e]=!0})};return he(e)?n(e):n(String(e).split(t)),a},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,a){return t.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Ae,global:Pe,isContextDefined:Re,isSpecCompliantForm:function(e){return!!(e&&ge(e.append)&&"FormData"===e[le]&&e[re])},toJSONObject:e=>{const t=new Array(10),a=(e,n)=>{if(be(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const s=he(e)?[]:{};return Ie(e,(e,t)=>{const i=a(e,n+1);!pe(i)&&(s[t]=i)}),t[n]=void 0,s}}return e};return a(e,0)},isAsyncFn:Ue,isThenable:e=>e&&(be(e)||ge(e))&&ge(e.then)&&ge(e.catch),setImmediate:Be,asap:Ve,isIterable:e=>null!=e&&ge(e[re])};function He(e,t,a,n,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),a&&(this.config=a),n&&(this.request=n),s&&(this.response=s,this.status=s.status?s.status:null)}We.inherits(He,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:We.toJSONObject(this.config),code:this.code,status:this.status}}});const Ge=He.prototype,Ye={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Ye[e]={value:e}}),Object.defineProperties(He,Ye),Object.defineProperty(Ge,"isAxiosError",{value:!0}),He.from=(e,t,a,n,s,i)=>{const o=Object.create(Ge);return We.toFlatObject(e,o,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),He.call(o,e.message,t,a,n,s),o.cause=e,o.name=e.name,i&&Object.assign(o,i),o};function Ke(e){return We.isPlainObject(e)||We.isArray(e)}function Qe(e){return We.endsWith(e,"[]")?e.slice(0,-2):e}function Je(e,t,a){return e?e.concat(t).map(function(e,t){return e=Qe(e),!a&&t?"["+e+"]":e}).join(a?".":""):t}const Ze=We.toFlatObject(We,{},null,function(e){return/^is[A-Z]/.test(e)});function Xe(e,t,a){if(!We.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(a=We.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!We.isUndefined(t[e])})).metaTokens,s=a.visitor||c,i=a.dots,o=a.indexes,r=(a.Blob||"undefined"!=typeof Blob&&Blob)&&We.isSpecCompliantForm(t);if(!We.isFunction(s))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(We.isDate(e))return e.toISOString();if(!r&&We.isBlob(e))throw new He("Blob is not supported. Use a Buffer instead.");return We.isArrayBuffer(e)||We.isTypedArray(e)?r&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,a,s){let r=e;if(e&&!s&&"object"==typeof e)if(We.endsWith(a,"{}"))a=n?a:a.slice(0,-2),e=JSON.stringify(e);else if(We.isArray(e)&&function(e){return We.isArray(e)&&!e.some(Ke)}(e)||(We.isFileList(e)||We.endsWith(a,"[]"))&&(r=We.toArray(e)))return a=Qe(a),r.forEach(function(e,n){!We.isUndefined(e)&&null!==e&&t.append(!0===o?Je([a],n,i):null===o?a:a+"[]",l(e))}),!1;return!!Ke(e)||(t.append(Je(s,a,i),l(e)),!1)}const d=[],u=Object.assign(Ze,{defaultVisitor:c,convertValue:l,isVisitable:Ke});if(!We.isObject(e))throw new TypeError("data must be an object");return function e(a,n){if(!We.isUndefined(a)){if(-1!==d.indexOf(a))throw Error("Circular reference detected in "+n.join("."));d.push(a),We.forEach(a,function(a,i){!0===(!(We.isUndefined(a)||null===a)&&s.call(t,a,We.isString(i)?i.trim():i,n,u))&&e(a,n?n.concat(i):[i])}),d.pop()}}(e),t}function et(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function tt(e,t){this._pairs=[],e&&Xe(e,this,t)}const at=tt.prototype;function nt(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function st(e,t,a){if(!t)return e;const n=a&&a.encode||nt;We.isFunction(a)&&(a={serialize:a});const s=a&&a.serialize;let i;if(i=s?s(t,a):We.isURLSearchParams(t)?t.toString():new tt(t,a).toString(n),i){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}at.append=function(e,t){this._pairs.push([e,t])},at.toString=function(e){const t=e?function(t){return e.call(this,t,et)}:et;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};class it{constructor(){this.handlers=[]}use(e,t,a){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!a&&a.synchronous,runWhen:a?a.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){We.forEach(this.handlers,function(t){null!==t&&e(t)})}}const ot={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},rt={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:tt,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},lt="undefined"!=typeof window&&"undefined"!=typeof document,ct="object"==typeof navigator&&navigator||void 0,dt=lt&&(!ct||["ReactNative","NativeScript","NS"].indexOf(ct.product)<0),ut="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,ht=lt&&window.location.href||"http://localhost",pt={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:lt,hasStandardBrowserEnv:dt,hasStandardBrowserWebWorkerEnv:ut,navigator:ct,origin:ht},Symbol.toStringTag,{value:"Module"})),...rt};function mt(e){function t(e,a,n,s){let i=e[s++];if("__proto__"===i)return!0;const o=Number.isFinite(+i),r=s>=e.length;if(i=!i&&We.isArray(n)?n.length:i,r)return We.hasOwnProp(n,i)?n[i]=[n[i],a]:n[i]=a,!o;n[i]&&We.isObject(n[i])||(n[i]=[]);return t(e,a,n[i],s)&&We.isArray(n[i])&&(n[i]=function(e){const t={},a=Object.keys(e);let n;const s=a.length;let i;for(n=0;n<s;n++)i=a[n],t[i]=e[i];return t}(n[i])),!o}if(We.isFormData(e)&&We.isFunction(e.entries)){const a={};return We.forEachEntry(e,(e,n)=>{t(function(e){return We.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),n,a,0)}),a}return null}const ft={transitional:ot,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const a=t.getContentType()||"",n=a.indexOf("application/json")>-1,s=We.isObject(e);s&&We.isHTMLForm(e)&&(e=new FormData(e));if(We.isFormData(e))return n?JSON.stringify(mt(e)):e;if(We.isArrayBuffer(e)||We.isBuffer(e)||We.isStream(e)||We.isFile(e)||We.isBlob(e)||We.isReadableStream(e))return e;if(We.isArrayBufferView(e))return e.buffer;if(We.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(s){if(a.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Xe(e,new pt.classes.URLSearchParams,Object.assign({visitor:function(e,t,a,n){return pt.isNode&&We.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((i=We.isFileList(e))||a.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Xe(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return s||n?(t.setContentType("application/json",!1),function(e,t,a){if(We.isString(e))try{return(t||JSON.parse)(e),We.trim(e)}catch(n){if("SyntaxError"!==n.name)throw n}return(a||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||ft.transitional,a=t&&t.forcedJSONParsing,n="json"===this.responseType;if(We.isResponse(e)||We.isReadableStream(e))return e;if(e&&We.isString(e)&&(a&&!this.responseType||n)){const a=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(s){if(a){if("SyntaxError"===s.name)throw He.from(s,He.ERR_BAD_RESPONSE,this,null,this.response);throw s}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:pt.classes.FormData,Blob:pt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};We.forEach(["delete","get","head","post","put","patch"],e=>{ft.headers[e]={}});const gt=We.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),vt=Symbol("internals");function bt(e){return e&&String(e).trim().toLowerCase()}function wt(e){return!1===e||null==e?e:We.isArray(e)?e.map(wt):String(e)}function yt(e,t,a,n,s){return We.isFunction(n)?n.call(this,t,a):(s&&(t=a),We.isString(t)?We.isString(n)?-1!==t.indexOf(n):We.isRegExp(n)?n.test(t):void 0:void 0)}let _t=class{constructor(e){e&&this.set(e)}set(e,t,a){const n=this;function s(e,t,a){const s=bt(t);if(!s)throw new Error("header name must be a non-empty string");const i=We.findKey(n,s);(!i||void 0===n[i]||!0===a||void 0===a&&!1!==n[i])&&(n[i||t]=wt(e))}const i=(e,t)=>We.forEach(e,(e,a)=>s(e,a,t));if(We.isPlainObject(e)||e instanceof this.constructor)i(e,t);else if(We.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))i((e=>{const t={};let a,n,s;return e&&e.split("\n").forEach(function(e){s=e.indexOf(":"),a=e.substring(0,s).trim().toLowerCase(),n=e.substring(s+1).trim(),!a||t[a]&&gt[a]||("set-cookie"===a?t[a]?t[a].push(n):t[a]=[n]:t[a]=t[a]?t[a]+", "+n:n)}),t})(e),t);else if(We.isObject(e)&&We.isIterable(e)){let a,n,s={};for(const t of e){if(!We.isArray(t))throw TypeError("Object iterator must return a key-value pair");s[n=t[0]]=(a=s[n])?We.isArray(a)?[...a,t[1]]:[a,t[1]]:t[1]}i(s,t)}else null!=e&&s(t,e,a);return this}get(e,t){if(e=bt(e)){const a=We.findKey(this,e);if(a){const e=this[a];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=a.exec(e);)t[n[1]]=n[2];return t}(e);if(We.isFunction(t))return t.call(this,e,a);if(We.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=bt(e)){const a=We.findKey(this,e);return!(!a||void 0===this[a]||t&&!yt(0,this[a],a,t))}return!1}delete(e,t){const a=this;let n=!1;function s(e){if(e=bt(e)){const s=We.findKey(a,e);!s||t&&!yt(0,a[s],s,t)||(delete a[s],n=!0)}}return We.isArray(e)?e.forEach(s):s(e),n}clear(e){const t=Object.keys(this);let a=t.length,n=!1;for(;a--;){const s=t[a];e&&!yt(0,this[s],s,e,!0)||(delete this[s],n=!0)}return n}normalize(e){const t=this,a={};return We.forEach(this,(n,s)=>{const i=We.findKey(a,s);if(i)return t[i]=wt(n),void delete t[s];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,a)=>t.toUpperCase()+a)}(s):String(s).trim();o!==s&&delete t[s],t[o]=wt(n),a[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return We.forEach(this,(a,n)=>{null!=a&&!1!==a&&(t[n]=e&&We.isArray(a)?a.join(", "):a)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const a=new this(e);return t.forEach(e=>a.set(e)),a}static accessor(e){const t=(this[vt]=this[vt]={accessors:{}}).accessors,a=this.prototype;function n(e){const n=bt(e);t[n]||(!function(e,t){const a=We.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+a,{value:function(e,a,s){return this[n].call(this,t,e,a,s)},configurable:!0})})}(a,e),t[n]=!0)}return We.isArray(e)?e.forEach(n):n(e),this}};function kt(e,t){const a=this||ft,n=t||a,s=_t.from(n.headers);let i=n.data;return We.forEach(e,function(e){i=e.call(a,i,s.normalize(),t?t.status:void 0)}),s.normalize(),i}function Ct(e){return!(!e||!e.__CANCEL__)}function Et(e,t,a){He.call(this,null==e?"canceled":e,He.ERR_CANCELED,t,a),this.name="CanceledError"}function St(e,t,a){const n=a.config.validateStatus;a.status&&n&&!n(a.status)?t(new He("Request failed with status code "+a.status,[He.ERR_BAD_REQUEST,He.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a)):e(a)}_t.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),We.reduceDescriptors(_t.prototype,({value:e},t)=>{let a=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[a]=e}}}),We.freezeMethods(_t),We.inherits(Et,He,{__CANCEL__:!0});const Tt=(e,t,a=3)=>{let n=0;const s=function(e,t){e=e||10;const a=new Array(e),n=new Array(e);let s,i=0,o=0;return t=void 0!==t?t:1e3,function(r){const l=Date.now(),c=n[o];s||(s=l),a[i]=r,n[i]=l;let d=o,u=0;for(;d!==i;)u+=a[d++],d%=e;if(i=(i+1)%e,i===o&&(o=(o+1)%e),l-s<t)return;const h=c&&l-c;return h?Math.round(1e3*u/h):void 0}}(50,250);return function(e,t){let a,n,s=0,i=1e3/t;const o=(t,i=Date.now())=>{s=i,a=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[(...e)=>{const t=Date.now(),r=t-s;r>=i?o(e,t):(a=e,n||(n=setTimeout(()=>{n=null,o(a)},i-r)))},()=>a&&o(a)]}(a=>{const i=a.loaded,o=a.lengthComputable?a.total:void 0,r=i-n,l=s(r);n=i;e({loaded:i,total:o,progress:o?i/o:void 0,bytes:r,rate:l||void 0,estimated:l&&o&&i<=o?(o-i)/l:void 0,event:a,lengthComputable:null!=o,[t?"download":"upload"]:!0})},a)},Nt=(e,t)=>{const a=null!=e;return[n=>t[0]({lengthComputable:a,total:e,loaded:n}),t[1]]},xt=e=>(...t)=>We.asap(()=>e(...t)),It=pt.hasStandardBrowserEnv?((e,t)=>a=>(a=new URL(a,pt.origin),e.protocol===a.protocol&&e.host===a.host&&(t||e.port===a.port)))(new URL(pt.origin),pt.navigator&&/(msie|trident)/i.test(pt.navigator.userAgent)):()=>!0,At=pt.hasStandardBrowserEnv?{write(e,t,a,n,s,i){const o=[e+"="+encodeURIComponent(t)];We.isNumber(a)&&o.push("expires="+new Date(a).toGMTString()),We.isString(n)&&o.push("path="+n),We.isString(s)&&o.push("domain="+s),!0===i&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Pt(e,t,a){let n=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(n||0==a)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Rt=e=>e instanceof _t?{...e}:e;function Dt(e,t){t=t||{};const a={};function n(e,t,a,n){return We.isPlainObject(e)&&We.isPlainObject(t)?We.merge.call({caseless:n},e,t):We.isPlainObject(t)?We.merge({},t):We.isArray(t)?t.slice():t}function s(e,t,a,s){return We.isUndefined(t)?We.isUndefined(e)?void 0:n(void 0,e,0,s):n(e,t,0,s)}function i(e,t){if(!We.isUndefined(t))return n(void 0,t)}function o(e,t){return We.isUndefined(t)?We.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function r(a,s,i){return i in t?n(a,s):i in e?n(void 0,a):void 0}const l={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:r,headers:(e,t,a)=>s(Rt(e),Rt(t),0,!0)};return We.forEach(Object.keys(Object.assign({},e,t)),function(n){const i=l[n]||s,o=i(e[n],t[n],n);We.isUndefined(o)&&i!==r||(a[n]=o)}),a}const Lt=e=>{const t=Dt({},e);let a,{data:n,withXSRFToken:s,xsrfHeaderName:i,xsrfCookieName:o,headers:r,auth:l}=t;if(t.headers=r=_t.from(r),t.url=st(Pt(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&r.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),We.isFormData(n))if(pt.hasStandardBrowserEnv||pt.hasStandardBrowserWebWorkerEnv)r.setContentType(void 0);else if(!1!==(a=r.getContentType())){const[e,...t]=a?a.split(";").map(e=>e.trim()).filter(Boolean):[];r.setContentType([e||"multipart/form-data",...t].join("; "))}if(pt.hasStandardBrowserEnv&&(s&&We.isFunction(s)&&(s=s(t)),s||!1!==s&&It(t.url))){const e=i&&o&&At.read(o);e&&r.set(i,e)}return t},Mt="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,a){const n=Lt(e);let s=n.data;const i=_t.from(n.headers).normalize();let o,r,l,c,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=n;function m(){c&&c(),d&&d(),n.cancelToken&&n.cancelToken.unsubscribe(o),n.signal&&n.signal.removeEventListener("abort",o)}let f=new XMLHttpRequest;function g(){if(!f)return;const n=_t.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());St(function(e){t(e),m()},function(e){a(e),m()},{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:n,config:e,request:f}),f=null}f.open(n.method.toUpperCase(),n.url,!0),f.timeout=n.timeout,"onloadend"in f?f.onloadend=g:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(g)},f.onabort=function(){f&&(a(new He("Request aborted",He.ECONNABORTED,e,f)),f=null)},f.onerror=function(){a(new He("Network Error",He.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const s=n.transitional||ot;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),a(new He(t,s.clarifyTimeoutError?He.ETIMEDOUT:He.ECONNABORTED,e,f)),f=null},void 0===s&&i.setContentType(null),"setRequestHeader"in f&&We.forEach(i.toJSON(),function(e,t){f.setRequestHeader(t,e)}),We.isUndefined(n.withCredentials)||(f.withCredentials=!!n.withCredentials),u&&"json"!==u&&(f.responseType=n.responseType),p&&([l,d]=Tt(p,!0),f.addEventListener("progress",l)),h&&f.upload&&([r,c]=Tt(h),f.upload.addEventListener("progress",r),f.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(o=t=>{f&&(a(!t||t.type?new Et(null,e,f):t),f.abort(),f=null)},n.cancelToken&&n.cancelToken.subscribe(o),n.signal&&(n.signal.aborted?o():n.signal.addEventListener("abort",o)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);v&&-1===pt.protocols.indexOf(v)?a(new He("Unsupported protocol "+v+":",He.ERR_BAD_REQUEST,e)):f.send(s||null)})},Ot=(e,t)=>{const{length:a}=e=e?e.filter(Boolean):[];if(t||a){let a,n=new AbortController;const s=function(e){if(!a){a=!0,o();const t=e instanceof Error?e:this.reason;n.abort(t instanceof He?t:new Et(t instanceof Error?t.message:t))}};let i=t&&setTimeout(()=>{i=null,s(new He(`timeout ${t} of ms exceeded`,He.ETIMEDOUT))},t);const o=()=>{e&&(i&&clearTimeout(i),i=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(s):e.removeEventListener("abort",s)}),e=null)};e.forEach(e=>e.addEventListener("abort",s));const{signal:r}=n;return r.unsubscribe=()=>We.asap(o),r}},Ft=function*(e,t){let a=e.byteLength;if(a<t)return void(yield e);let n,s=0;for(;s<a;)n=s+t,yield e.slice(s,n),s=n},Ut=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:a}=await t.read();if(e)break;yield a}}finally{await t.cancel()}},Bt=(e,t,a,n)=>{const s=async function*(e,t){for await(const a of Ut(e))yield*Ft(a,t)}(e,t);let i,o=0,r=e=>{i||(i=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await s.next();if(t)return r(),void e.close();let i=n.byteLength;if(a){let e=o+=i;a(e)}e.enqueue(new Uint8Array(n))}catch(t){throw r(t),t}},cancel:e=>(r(e),s.return())},{highWaterMark:2})},qt="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,$t=qt&&"function"==typeof ReadableStream,jt=qt&&("function"==typeof TextEncoder?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),zt=(e,...t)=>{try{return!!e(...t)}catch(a){return!1}},Vt=$t&&zt(()=>{let e=!1;const t=new Request(pt.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),Wt=$t&&zt(()=>We.isReadableStream(new Response("").body)),Ht={stream:Wt&&(e=>e.body)};var Gt;qt&&(Gt=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Ht[e]&&(Ht[e]=We.isFunction(Gt[e])?t=>t[e]():(t,a)=>{throw new He(`Response type '${e}' is not supported`,He.ERR_NOT_SUPPORT,a)})}));const Yt=async(e,t)=>{const a=We.toFiniteNumber(e.getContentLength());return null==a?(async e=>{if(null==e)return 0;if(We.isBlob(e))return e.size;if(We.isSpecCompliantForm(e)){const t=new Request(pt.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return We.isArrayBufferView(e)||We.isArrayBuffer(e)?e.byteLength:(We.isURLSearchParams(e)&&(e+=""),We.isString(e)?(await jt(e)).byteLength:void 0)})(t):a},Kt={http:null,xhr:Mt,fetch:qt&&(async e=>{let{url:t,method:a,data:n,signal:s,cancelToken:i,timeout:o,onDownloadProgress:r,onUploadProgress:l,responseType:c,headers:d,withCredentials:u="same-origin",fetchOptions:h}=Lt(e);c=c?(c+"").toLowerCase():"text";let p,m=Ot([s,i&&i.toAbortSignal()],o);const f=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let g;try{if(l&&Vt&&"get"!==a&&"head"!==a&&0!==(g=await Yt(d,n))){let e,a=new Request(t,{method:"POST",body:n,duplex:"half"});if(We.isFormData(n)&&(e=a.headers.get("content-type"))&&d.setContentType(e),a.body){const[e,t]=Nt(g,Tt(xt(l)));n=Bt(a.body,65536,e,t)}}We.isString(u)||(u=u?"include":"omit");const s="credentials"in Request.prototype;p=new Request(t,{...h,signal:m,method:a.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:s?u:void 0});let i=await fetch(p);const o=Wt&&("stream"===c||"response"===c);if(Wt&&(r||o&&f)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=i[t]});const t=We.toFiniteNumber(i.headers.get("content-length")),[a,n]=r&&Nt(t,Tt(xt(r),!0))||[];i=new Response(Bt(i.body,65536,a,()=>{n&&n(),f&&f()}),e)}c=c||"text";let v=await Ht[We.findKey(Ht,c)||"text"](i,e);return!o&&f&&f(),await new Promise((t,a)=>{St(t,a,{data:v,headers:_t.from(i.headers),status:i.status,statusText:i.statusText,config:e,request:p})})}catch(v){if(f&&f(),v&&"TypeError"===v.name&&/Load failed|fetch/i.test(v.message))throw Object.assign(new He("Network Error",He.ERR_NETWORK,e,p),{cause:v.cause||v});throw He.from(v,v&&v.code,e,p)}})};We.forEach(Kt,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(a){}Object.defineProperty(e,"adapterName",{value:t})}});const Qt=e=>`- ${e}`,Jt=e=>We.isFunction(e)||null===e||!1===e,Zt=e=>{e=We.isArray(e)?e:[e];const{length:t}=e;let a,n;const s={};for(let i=0;i<t;i++){let t;if(a=e[i],n=a,!Jt(a)&&(n=Kt[(t=String(a)).toLowerCase()],void 0===n))throw new He(`Unknown adapter '${t}'`);if(n)break;s[t||"#"+i]=n}if(!n){const e=Object.entries(s).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new He("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(Qt).join("\n"):" "+Qt(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n};function Xt(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Et(null,e)}function ea(e){Xt(e),e.headers=_t.from(e.headers),e.data=kt.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Zt(e.adapter||ft.adapter)(e).then(function(t){return Xt(e),t.data=kt.call(e,e.transformResponse,t),t.headers=_t.from(t.headers),t},function(t){return Ct(t)||(Xt(e),t&&t.response&&(t.response.data=kt.call(e,e.transformResponse,t.response),t.response.headers=_t.from(t.response.headers))),Promise.reject(t)})}const ta="1.9.0",aa={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{aa[e]=function(a){return typeof a===e||"a"+(t<1?"n ":" ")+e}});const na={};aa.transitional=function(e,t,a){function n(e,t){return"[Axios v1.9.0] Transitional option '"+e+"'"+t+(a?". "+a:"")}return(a,s,i)=>{if(!1===e)throw new He(n(s," has been removed"+(t?" in "+t:"")),He.ERR_DEPRECATED);return t&&!na[s]&&(na[s]=!0,console.warn(n(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(a,s,i)}},aa.spelling=function(e){return(t,a)=>(console.warn(`${a} is likely a misspelling of ${e}`),!0)};const sa={assertOptions:function(e,t,a){if("object"!=typeof e)throw new He("options must be an object",He.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let s=n.length;for(;s-- >0;){const i=n[s],o=t[i];if(o){const t=e[i],a=void 0===t||o(t,i,e);if(!0!==a)throw new He("option "+i+" must be "+a,He.ERR_BAD_OPTION_VALUE);continue}if(!0!==a)throw new He("Unknown option "+i,He.ERR_BAD_OPTION)}},validators:aa},ia=sa.validators;let oa=class{constructor(e){this.defaults=e||{},this.interceptors={request:new it,response:new it}}async request(e,t){try{return await this._request(e,t)}catch(a){if(a instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{a.stack?t&&!String(a.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(a.stack+="\n"+t):a.stack=t}catch(n){}}throw a}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Dt(this.defaults,t);const{transitional:a,paramsSerializer:n,headers:s}=t;void 0!==a&&sa.assertOptions(a,{silentJSONParsing:ia.transitional(ia.boolean),forcedJSONParsing:ia.transitional(ia.boolean),clarifyTimeoutError:ia.transitional(ia.boolean)},!1),null!=n&&(We.isFunction(n)?t.paramsSerializer={serialize:n}:sa.assertOptions(n,{encode:ia.function,serialize:ia.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),sa.assertOptions(t,{baseUrl:ia.spelling("baseURL"),withXsrfToken:ia.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=s&&We.merge(s.common,s[t.method]);s&&We.forEach(["delete","get","head","post","put","patch","common"],e=>{delete s[e]}),t.headers=_t.concat(i,s);const o=[];let r=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(r=r&&e.synchronous,o.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let d,u=0;if(!r){const e=[ea.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,l),d=e.length,c=Promise.resolve(t);u<d;)c=c.then(e[u++],e[u++]);return c}d=o.length;let h=t;for(u=0;u<d;){const e=o[u++],t=o[u++];try{h=e(h)}catch(p){t.call(this,p);break}}try{c=ea.call(this,h)}catch(p){return Promise.reject(p)}for(u=0,d=l.length;u<d;)c=c.then(l[u++],l[u++]);return c}getUri(e){return st(Pt((e=Dt(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};We.forEach(["delete","get","head","options"],function(e){oa.prototype[e]=function(t,a){return this.request(Dt(a||{},{method:e,url:t,data:(a||{}).data}))}}),We.forEach(["post","put","patch"],function(e){function t(t){return function(a,n,s){return this.request(Dt(s||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:a,data:n}))}}oa.prototype[e]=t(),oa.prototype[e+"Form"]=t(!0)});const ra={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ra).forEach(([e,t])=>{ra[t]=e});const la=function e(t){const a=new oa(t),n=se(oa.prototype.request,a);return We.extend(n,oa.prototype,a,{allOwnKeys:!0}),We.extend(n,a,null,{allOwnKeys:!0}),n.create=function(a){return e(Dt(t,a))},n}(ft);la.Axios=oa,la.CanceledError=Et,la.CancelToken=class e{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const a=this;this.promise.then(e=>{if(!a._listeners)return;let t=a._listeners.length;for(;t-- >0;)a._listeners[t](e);a._listeners=null}),this.promise.then=e=>{let t;const n=new Promise(e=>{a.subscribe(e),t=e}).then(e);return n.cancel=function(){a.unsubscribe(t)},n},e(function(e,n,s){a.reason||(a.reason=new Et(e,n,s),t(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;return{token:new e(function(e){t=e}),cancel:t}}},la.isCancel=Ct,la.VERSION=ta,la.toFormData=Xe,la.AxiosError=He,la.Cancel=la.CanceledError,la.all=function(e){return Promise.all(e)},la.spread=function(e){return function(t){return e.apply(null,t)}},la.isAxiosError=function(e){return We.isObject(e)&&!0===e.isAxiosError},la.mergeConfig=Dt,la.AxiosHeaders=_t,la.formToJSON=e=>mt(We.isHTMLForm(e)?new FormData(e):e),la.getAdapter=Zt,la.HttpStatusCode=ra,la.default=la;const{Axios:ca,AxiosError:da,CanceledError:ua,isCancel:ha,CancelToken:pa,VERSION:ma,all:fa,Cancel:ga,isAxiosError:va,spread:ba,toFormData:wa,AxiosHeaders:ya,HttpStatusCode:_a,formToJSON:ka,getAdapter:Ca,mergeConfig:Ea}=la,Sa=la.create({baseURL:"https://mozoqr.com/api",headers:{"Content-Type":"application/json",Accept:"application/json"}});Sa.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),Sa.interceptors.response.use(e=>{try{const t=e.data;if(t){const e=t.token||t.access_token||t.plainTextToken||t.user&&t.user.token||t.user&&t.user.access_token;e&&localStorage.setItem("token",e)}}catch(t){}return e},e=>(e.response&&401===e.response.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),e.message=(e=>{if(e.response){const t=e.response.data;if(t){if("string"==typeof t)return t;if(t.message)return t.message;if(t.error)return t.error}return`Error ${e.response.status}: ${e.response.statusText||"Error en la respuesta del servidor"}`}return e.request?"No se recibió respuesta del servidor. Verifique su conexión.":e.message||"Ocurrió un error desconocido."})(e),Promise.reject(e)));const Ta={login:e=>Sa.post("login",e),loginWithGoogle:e=>Sa.post("login/google",{token:e}),forgotPassword:e=>Sa.post("forgot-password",e),resetPassword:e=>Sa.post("reset-password",e),callWaiter:e=>Sa.post(`tables/${e}/call-waiter`),register:e=>Sa.post("register",e),getCurrentUser:()=>Sa.get("user"),logout:()=>Sa.post("logout"),selectRole:e=>Sa.post("role/select",{role:e}),updateProfile:e=>Sa.post("profile/update",e,{headers:{"Content-Type":"multipart/form-data"}}),sendWhatsAppMessage:e=>Sa.post("profile/whatsapp/send",e),getNotifications:()=>Sa.get("notifications"),handleNotification:(e,t)=>Sa.post(`notifications/handle/${e}`,t),globalNotifications:e=>Sa.post("notifications/global",e),storeDeviceToken:e=>Sa.post("device-token",e),deleteDeviceToken:e=>Sa.delete("device-token",{data:e}),toggleTableNotifications:e=>Sa.post(`tables/toggle-notifications/${e}`),waiterOnboard:e=>Sa.post("waiter/onboard",{code:e}),getWaiterTables:()=>Sa.get("waiter/tables"),listWaiterProfiles:()=>Sa.get("waiter/profiles"),createWaiterProfile:e=>Sa.post("waiter/profiles",e),deleteWaiterProfile:e=>Sa.delete(`waiter/profiles/${e}`),getWaiterNotifications:()=>Sa.get("waiter/notifications"),handleWaiterNotification:(e,t)=>Sa.post(`waiter/notifications/handle/${e}`,t),waiterGlobalNotifications:e=>Sa.post("waiter/notifications/global",e),waiterToggleTableNotifications:e=>Sa.post(`waiter/tables/toggle-notifications/${e}`),getBusinessInfo:()=>Sa.get("admin/business"),switchView:e=>Sa.post("admin/switch-view",e),removeStaff:e=>Sa.delete(`admin/staff/${e}`),handleStaffRequest:(e,t)=>Sa.post(`admin/staff/request/${e}`,t),getStaffRequests:()=>Sa.get("admin/staff/requests"),getArchivedStaffRequests:()=>Sa.get("admin/staff/requests/archived"),getTables:()=>Sa.get("tables"),createTable:e=>Sa.post("tables",e),updateTable:(e,t)=>Sa.put(`tables/${e}`,t),deleteTable:e=>Sa.delete(`tables/${e}`),getMenus:()=>Sa.get("menus"),uploadMenu:e=>Sa.post("menus",e,{headers:{"Content-Type":"multipart/form-data"}}),setDefaultMenu:e=>Sa.post("menus/default",e),generateQRCode:e=>{const t="https://mozoqr.com";return console.log("🔍 Generating QR with base URL:",t),console.log("📋 Environment vars:",{VITE_QR_BASE_URL:"https://mozoqr.com",VITE_URL_API:"https://mozoqr.com/api/",window_origin:window.location.origin}),Sa.post(`admin/qr/generate/${e}`,{base_url:t})},exportQR:e=>Sa.post("admin/qr/export",e),getSettings:()=>Sa.get("admin/settings"),updateSettings:e=>Sa.post("admin/settings",e),deleteMenu:e=>Sa.delete(`menus/${e}`),renameMenu:(e,t)=>Sa.put(`menus/${e}`,t),reorderMenus:e=>Sa.post("menus/reorder",{menu_order:e}),previewMenu:e=>Sa.get(`menus/${e}/preview`,{responseType:"blob"}),cloneTable:(e,t)=>Sa.post(`tables/clone/${e}`,t),getStaff:(e=1)=>Sa.get(`admin/staff?page=${e}`),getStaffMember:e=>Sa.get(`admin/staff/${e}`),updateStaffMember:(e,t)=>t instanceof FormData?Sa.post(`admin/staff/${e}?_method=PUT`,t,{headers:{"Content-Type":"multipart/form-data"}}):Sa.put(`admin/staff/${e}`,t),inviteStaff:e=>Sa.post("admin/staff/invite",e),addReview:(e,t)=>Sa.post(`admin/staff/${e}/reviews`,t),deleteReview:(e,t)=>Sa.delete(`admin/staff/${e}/reviews/${t}`),changePassword:e=>Sa.post("change-password",e),deleteAccount:e=>Sa.delete("delete-account",{data:e}),getAdminStatistics:()=>Sa.get("admin/statistics"),sendQrEmail:e=>Sa.post("admin/qr/email",e),getAdminNotifications:()=>Sa.get("admin/notifications"),listWorkHistory:()=>Sa.get("profile/work-history"),addWorkHistory:e=>Sa.post("profile/work-history",e),updateWorkHistory:(e,t)=>Sa.put(`profile/work-history/${e}`,t),deleteWorkHistory:e=>Sa.delete(`profile/work-history/${e}`),getAdminTables:()=>Sa.get("admin/tables"),getAdminTableDetails:e=>Sa.get(`admin/tables/${e}`),updateAdminTable:(e,t)=>Sa.put(`admin/tables/${e}`,t),deleteAdminTable:e=>Sa.delete(`admin/tables/${e}`),getAdminStaff:()=>Sa.get("admin/staff"),getAdminStaffDetails:e=>Sa.get(`admin/staff/${e}`),createAdminStaff:e=>Sa.post("admin/staff",e),updateAdminStaff:(e,t)=>Sa.post(`admin/staff/${e}`,t),deleteAdminStaff:e=>Sa.delete(`admin/staff/${e}`),getAdminMenus:()=>Sa.get("admin/menus"),getAdminMenuDetails:e=>Sa.get(`admin/menus/${e}`),createAdminMenu:e=>Sa.post("admin/menus",e),updateAdminMenu:(e,t)=>Sa.post(`admin/menus/update/${e}`,t),deleteAdminMenu:e=>Sa.delete(`admin/menus/${e}`),getAdminRequests:()=>Sa.get("admin/requests"),sendNotificationToAll:e=>Sa.post("admin/notifications/send-to-all",e),sendNotificationToUser:e=>Sa.post("admin/notifications/send-to-user",e),sendNotificationToDevice:e=>Sa.post("admin/notifications/send-to-device",e),sendNotificationToTopic:e=>Sa.post("admin/notifications/send-to-topic",e),subscribeToTopic:e=>Sa.post("admin/notifications/subscribe-to-topic",e),unsubscribeFromTopic:e=>Sa.post("admin/notifications/unsubscribe-from-topic",e),storeDeviceToken:e=>Sa.post("device-token",e),getDeviceTokens:e=>Sa.get(`device-tokens/${e}`),deleteDeviceToken:e=>Sa.delete(`device-token/${e}`),sendPushToUser:e=>Sa.post("admin/notifications/send-to-user",e),healthCheck:()=>Sa.get("health-check"),getPendingCalls:()=>Sa.get("waiter/calls/pending"),acknowledgeCall:e=>Sa.post(`waiter/calls/${e}/acknowledge`),completeCall:e=>Sa.post(`waiter/calls/${e}/complete`),getWaiterCallHistory:(e={})=>Sa.get("waiter/calls/history",{params:e}),getAdminCallHistory:(e={})=>Sa.get("admin/calls/history",{params:e}),activateTable:e=>(console.log("🌐 API: POST waiter/tables/"+e+"/activate"),Sa.post(`waiter/tables/${e}/activate`)),deactivateTable:e=>(console.log("🌐 API: DELETE waiter/tables/"+e+"/activate"),Sa.delete(`waiter/tables/${e}/activate`)),activateMultipleTables:e=>(console.log("🌐 API: POST waiter/tables/activate/multiple",e),Sa.post("waiter/tables/activate/multiple",e)),deactivateMultipleTables:e=>(console.log("🌐 API: POST waiter/tables/deactivate/multiple",e),Sa.post("waiter/tables/deactivate/multiple",e)),silenceTable:(e,t)=>(console.log("🌐 API: POST waiter/tables/"+e+"/silence",t),Sa.post(`waiter/tables/${e}/silence`,t)),unsilenceTable:e=>(console.log("🌐 API: DELETE waiter/tables/"+e+"/silence"),Sa.delete(`waiter/tables/${e}/silence`)),silenceMultipleTables:e=>Sa.post("waiter/tables/silence/multiple",e),unsilenceMultipleTables:e=>Sa.post("waiter/tables/unsilence/multiple",e),getSilencedTables:()=>Sa.get("waiter/tables/silenced"),getAssignedTables:()=>Sa.get("waiter/tables/assigned"),getAvailableTables:()=>Sa.get("waiter/tables/available"),getAdminSilencedTables:()=>Sa.get("admin/tables/silenced"),adminUnsilenceTable:e=>Sa.delete(`admin/tables/${e}/silence`),getWaiterTableProfiles:()=>Sa.get("waiter/table-profiles"),getWaiterTableProfile:e=>Sa.get(`waiter/table-profiles/${e}`),createWaiterTableProfile:e=>Sa.post("waiter/table-profiles",e),updateWaiterTableProfile:(e,t)=>Sa.put(`waiter/table-profiles/${e}`,t),deleteWaiterTableProfile:e=>Sa.delete(`waiter/table-profiles/${e}`),activateWaiterTableProfile:e=>Sa.post(`waiter/table-profiles/${e}/activate`),deactivateWaiterTableProfile:e=>Sa.post(`waiter/table-profiles/${e}/deactivate`),getWaiterTableProfileNotifications:()=>Sa.get("waiter/table-profiles/notifications"),getWaiterDashboard:()=>Sa.get("waiter/dashboard"),getWaiterTableStatus:()=>Sa.get("waiter/tables/status"),getWaiterBusinesses:()=>Sa.get("waiter/businesses"),setActiveWaiterBusiness:e=>Sa.post("waiter/set-active-business",{business_id:e}),getActiveWaiterBusiness:()=>Sa.get("waiter/businesses/active"),getWaiterBusinessTables:e=>(console.log("🌐 API: GET waiter/businesses/"+e+"/tables"),Sa.get(`waiter/businesses/${e}/tables`)),joinBusinessWithCode:e=>Sa.post("waiter/join-business",{business_code:e}),leaveWaiterBusiness:e=>Sa.delete(`waiter/businesses/${e}/leave`)},Na={async getNotifications(){try{return(await Ta.getNotifications()).data}catch(e){throw console.error("Error obteniendo notificaciones:",e),e}},async handleNotification(e,t){try{return(await Ta.handleNotification(e,{action:t})).data}catch(a){throw console.error("Error manejando notificación:",a),a}},async globalNotifications(e){try{return(await Ta.globalNotifications({enabled:e})).data}catch(t){throw console.error("Error configurando notificaciones globales:",t),t}},async getWaiterNotifications(){try{return(await Ta.getWaiterNotifications()).data}catch(e){throw console.error("Error obteniendo notificaciones de mozo:",e),e}},async handleWaiterNotification(e,t){try{return(await Ta.handleWaiterNotification(e,{action:t})).data}catch(a){throw console.error("Error manejando notificación de mozo:",a),a}},async waiterGlobalNotifications(e){try{return(await Ta.waiterGlobalNotifications({enabled:e})).data}catch(t){throw console.error("Error configurando notificaciones globales de mozo:",t),t}},async waiterToggleTableNotifications(e){try{return(await Ta.waiterToggleTableNotifications(e)).data}catch(t){throw console.error("Error alternando notificaciones de mesa para mozo:",t),t}},async getAdminNotifications(){try{return(await Ta.getAdminNotifications()).data}catch(e){throw console.error("Error obteniendo notificaciones de administrador:",e),e}},async storeDeviceToken(e,t="web",a=null){try{const n={token:e,platform:t};a&&(n.user_id=a);return(await Ta.storeDeviceToken(n)).data}catch(n){throw console.error("Error guardando token de dispositivo:",n),n}},async deleteDeviceToken(e){try{return(await Ta.deleteDeviceToken(e)).data}catch(t){throw console.error("Error eliminando token de dispositivo:",t),t}},async getDeviceTokens(e){try{return(await Ta.getDeviceTokens(e)).data}catch(t){throw console.error("Error obteniendo tokens de dispositivo:",t),t}},async sendNotificationToAll(e,t,a=null){try{const n={title:e,body:t};a&&(n.data=a);return(await Ta.sendNotificationToAll(n)).data}catch(n){throw console.error("Error enviando notificación a todos:",n),n}},async sendNotificationToUser(e,t,a,n=null){try{const s={user_id:e,title:t,body:a};n&&(s.data=n);return(await Ta.sendNotificationToUser(s)).data}catch(s){throw console.error("Error enviando notificación a usuario:",s),s}},async sendNotificationToDevice(e,t,a,n=null){try{const s={token:e,title:t,body:a};n&&(s.data=n);return(await Ta.sendNotificationToDevice(s)).data}catch(s){throw console.error("Error enviando notificación a dispositivo:",s),s}},async sendNotificationToTopic(e,t,a,n=null){try{const s={topic:e,title:t,body:a};n&&(s.data=n);return(await Ta.sendNotificationToTopic(s)).data}catch(s){throw console.error("Error enviando notificación a topic:",s),s}},async subscribeToTopic(e,t){try{const a={tokens:Array.isArray(e)?e:[e],topic:t};return(await Ta.subscribeToTopic(a)).data}catch(a){throw console.error("Error suscribiendo a topic:",a),a}},async unsubscribeFromTopic(e,t){try{const a={tokens:Array.isArray(e)?e:[e],topic:t};return(await Ta.unsubscribeFromTopic(a)).data}catch(a){throw console.error("Error desuscribiendo de topic:",a),a}},async toggleTableNotifications(e){try{return(await Ta.toggleTableNotifications(e)).data}catch(t){throw console.error("Error alternando notificaciones de mesa:",t),t}},async callWaiter(e){try{return(await Ta.callWaiter(e)).data}catch(t){throw console.error("Error llamando al camarero:",t),t}},async markAllAsRead(e){try{const t=e.map(e=>this.handleNotification(e.id,"mark_as_read"));return await Promise.all(t)}catch(t){throw console.error("Error marcando todas como leídas:",t),t}},async deleteAllRead(e){try{const t=e.map(e=>this.handleNotification(e.id,"delete"));return await Promise.all(t)}catch(t){throw console.error("Error eliminando todas las leídas:",t),t}},async getNotificationsByRole(e){try{switch(e){case"waiter":return await this.getWaiterNotifications();case"admin":return await this.getAdminNotifications();default:return await this.getNotifications()}}catch(t){throw console.error("Error obteniendo notificaciones por rol:",t),t}},async healthCheck(){try{return await Ta.healthCheck()}catch(e){throw console.error("Error en el health check de la API:",e),e}},async testWebSocketConnection(){try{console.log("🔍 Probando conexión WebSocket...");const e="bd06ab967cc733531514",t="us2";console.log("🔍 Variables de entorno:",{pusherKey:e?"Definida":"No definida",pusherCluster:t?"Definida":"No definida",pusherKeyValue:e?`${e.substring(0,8)}...`:"undefined",pusherClusterValue:t||"undefined"});const a=localStorage.getItem("token");if(!a)throw new Error("No hay token de autenticación");console.log("🔍 Token de autenticación:",a?"Presente":"Ausente"),console.log("🔍 Token value:",a?`${a.substring(0,20)}...`:"undefined");const n=localStorage.getItem("user"),s=n?JSON.parse(n):null;console.log("🔍 Usuario:",s?`ID: ${s.id}, Nombre: ${s.name}`:"No encontrado"),console.log("🔍 Importando módulo echo...");const{initializeEcho:i}=await j(async()=>{const{initializeEcho:e}=await import("./echo-DkeVFlXc.js");return{initializeEcho:e}},__vite__mapDeps([3,1,2]));console.log("🔍 Módulo echo importado correctamente"),console.log("🔍 Inicializando Echo...");const o=i();if(console.log("🔍 Echo inicializado:",!!o),!o)throw new Error("No se pudo inicializar Echo");if(!o.connector||!o.connector.pusher)throw new Error("Pusher no está disponible en Echo");return console.log("🔍 Pusher disponible en Echo"),console.log("🔍 Esperando conexión WebSocket..."),await new Promise((e,t)=>{const a=setTimeout(()=>{console.log("🔍 Timeout en la conexión WebSocket"),t(new Error("Timeout en la conexión WebSocket (5 segundos)"))},5e3);o.connector.pusher.connection.bind("connected",()=>{clearTimeout(a),console.log("🔍 WebSocket conectado exitosamente"),e()}),o.connector.pusher.connection.bind("error",e=>{clearTimeout(a),console.error("🔍 Error en WebSocket:",e),t(new Error(`Error de conexión: ${e.message||"Error desconocido"}`))}),o.connector.pusher.connection.bind("disconnected",()=>{console.log("🔍 WebSocket desconectado")}),o.connector.pusher.connection.bind("connecting",()=>{console.log("🔍 WebSocket conectando...")})}),console.log("🔍 Conexión WebSocket exitosa"),{success:!0,message:"Conexión WebSocket exitosa"}}catch(e){throw console.error("🔍 Error en testWebSocketConnection:",e),console.error("🔍 Stack trace:",e.stack),e}}},xa={apiKey:"AIzaSyCecfSTfyxk3D2X4XsLaSGkckvf-OvhFZA",authDomain:"mozoqr-7d32c.firebaseapp.com",projectId:"mozoqr-7d32c",storageBucket:"mozoqr-7d32c.appspot.com",messagingSenderId:"175482362472",appId:"1:175482362472:android:f2589ca9ec71fd0cb6b9dd"};let Ia=null,Aa=null,Pa=null;const Ra=async()=>{try{if("undefined"==typeof window)return console.log("🔥 Firebase: Not supported in non-browser environment"),null;const t=Object.entries(xa).filter(([e,t])=>!t).map(([e,t])=>e);if(t.length>0)return console.error("🔥 Firebase: Incomplete configuration. Missing keys:",t),null;if(console.log("🔥 Initializing Firebase..."),"serviceWorker"in navigator)try{await navigator.serviceWorker.register("/firebase-messaging-sw.js");console.log("🔥 Service Worker registered successfully")}catch(e){console.error("🔥 Service Worker registration failed:",e)}const{initializeApp:a}=await j(async()=>{const{initializeApp:e}=await Promise.resolve().then(()=>yu);return{initializeApp:e}},void 0),{getMessaging:n,isSupported:s}=await j(async()=>{const{getMessaging:e,isSupported:t}=await import("./index.esm-DW8KlCX8.js");return{getMessaging:e,isSupported:t}},__vite__mapDeps([4,1,2])),{getFirestore:i}=await j(async()=>{const{getFirestore:e}=await import("./index.esm-D0huLPmv.js");return{getFirestore:e}},__vite__mapDeps([5,1,2]));return await s()?(Ia=a(xa),console.log("🔥 Firebase App initialized"),Aa=n(Ia),console.log("🔥 Firebase Messaging initialized"),Pa=i(Ia),console.log("🔥 Firestore initialized"),{app:Ia,messaging:Aa,db:Pa}):(console.log("🔥 Firebase Messaging not supported in this browser"),null)}catch(e){return console.error("🔥 Firebase initialization error:",e),null}},Da=async()=>{try{if(!Aa){if(!(await Ra()))throw new Error("Firebase initialization failed")}const{getToken:e}=await j(async()=>{const{getToken:e}=await import("./index.esm-DW8KlCX8.js");return{getToken:e}},__vite__mapDeps([4,1,2]));let t=Notification.permission;if(console.log("🔥 Current notification permission:",t),"default"===t&&(console.log("🔥 Requesting notification permissions..."),t=await Notification.requestPermission(),console.log("🔥 Permission after request:",t)),"denied"===t)throw console.error("🔥 Notification permissions DENIED by user"),console.error('🔥 SOLUTION: Click the 🔒 in the address bar and change Notifications to "Allow"'),new Error('Notification permissions denied. Click the 🔒 in the address bar and change Notifications to "Allow", then reload the page.');if("granted"!==t)throw new Error("Notification permissions not granted");console.log("✅ Notification permissions granted"),console.log("🔥 Getting FCM token...");const a="BNJgpNkgB0a0y7gHT-SNBFLMGIZw-Xx8NTBDCn_4dVqekzgmnGmKMIn10t-6gWl3Qj_msyCcfbsVycnAp8USs6M",n={};a&&(console.log("🔥 Using VAPID key:",a.substring(0,10)+"..."),n.vapidKey=a);const s=await e(Aa,n);if(!s)throw new Error("Failed to obtain FCM token");return console.log("🔥 FCM token obtained:",s.substring(0,20)+"..."),localStorage.setItem("fcm_token",s),s}catch(e){throw console.error("🔥 FCM token error:",e),e}},La=async e=>{try{if(!Aa){if(!(await Ra()))return}const{onMessage:t}=await j(async()=>{const{onMessage:e}=await import("./index.esm-DW8KlCX8.js");return{onMessage:e}},__vite__mapDeps([4,1,2]));console.log("🔥 Setting up foreground message listener..."),t(Aa,t=>{console.log("🔥🚨 FCM MESSAGE RECEIVED (Firebase onMessage):",t),console.log("🔥📱 Detailed payload:",{notification:t.notification,data:t.data,from:t.from,messageId:t.messageId}),console.log("🔥⏰ Timestamp:",(new Date).toLocaleTimeString());const a=Ma(t);if(e&&"function"==typeof e)try{e(a)}catch(n){console.error("🔥❌ Error in onMessage callback:",n)}try{j(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>er);return{useNotificationsStore:e}},void 0).then(({useNotificationsStore:e})=>{var t;const n=e(),s={id:`fcm-${Date.now()}`,type:(null==(t=a.data)?void 0:t.type)||"FCMNotification",data:{title:a.title,message:a.body,...a.data},created_at:(new Date).toISOString(),read_at:null,source:"firebase-foreground"};console.log("🔥📨 Adding FCM notification to store:",s),n.addNewNotification(s)})}catch(n){console.error("🔥❌ Error adding FCM notification to store:",n)}"granted"===Notification.permission&&Oa(a)}),console.log("🔥 Foreground message listener configured")}catch(t){console.error("🔥 Error setting up message listener:",t)}},Ma=e=>{var t,a,n;console.log("🔄 Processing notification payload...");let s={title:(null==(t=e.notification)?void 0:t.title)||"Nueva notificación",body:(null==(a=e.notification)?void 0:a.body)||"Tienes una nueva notificación",data:e.data||{}};if(null==(n=e.data)?void 0:n.type){const t=e.data.type;switch(console.log("🔄 Notification type:",t),t){case"TestNotification":s={title:"🧪 Test Notification",body:"This is a test notification sent to all business users",data:{...e.data,icon:"🧪",priority:"normal",channels:["Database","Broadcast","FCM"]}};break;case"UserSpecificNotification":s={title:e.data.title||"👤 Personalized Notification",body:e.data.message||"You have a new personalized notification",data:{...e.data,icon:"👤",priority:"high",channels:["Database","Broadcast","FCM"]}};break;case"WebSocketTestNotification":s={title:"⚡ WebSocket + FCM Test",body:"This notification arrives via WebSocket (real-time) and FCM (push)",data:{...e.data,icon:"⚡",priority:"high",test_mode:"websocket_fcm"}};break;case"WebSocketOnlyNotification":s={title:"🔌 WebSocket Only Test",body:"This notification ONLY arrives via WebSocket in real-time",data:{...e.data,icon:"🔌",priority:"normal",test_mode:"websocket_only"}};break;default:e.notification&&(s={title:e.notification.title,body:e.notification.body,data:{...e.data,icon:"📱",priority:"normal"}})}}return console.log("✅ Notification processed:",s),s},Oa=e=>{try{const{title:t,body:a,data:n}=e;if(t||a){const e=new Notification(t||"Nueva notificación",{body:a||"Tienes una nueva notificación",icon:"/favicon.ico",tag:`fcm-notification-${Date.now()}`,data:n,requireInteraction:!0});console.log("🔥🔔 Browser notification displayed:",e)}}catch(t){console.error("🔥❌ Error showing browser notification:",t)}},Fa=async()=>{try{if(!Aa)return void console.log("🔥 Firebase Messaging not initialized");const{deleteToken:e}=await j(async()=>{const{deleteToken:e}=await import("./index.esm-DW8KlCX8.js");return{deleteToken:e}},__vite__mapDeps([4,1,2]));await e(Aa),localStorage.removeItem("fcm_token"),console.log("🔥 FCM token deleted successfully")}catch(e){throw console.error("🔥 FCM token deletion error:",e),e}},Ua=()=>Pa||(console.error("🔥 Firestore not initialized. Call initializeFirebase() first."),null),Ba=()=>{const e={configured:!1,initialized:!1,messagingAvailable:!1,firestoreAvailable:!1,tokenExists:!1,notificationPermission:"default"};try{const t=Object.entries(xa).filter(([e,t])=>!t).map(([e,t])=>e);return e.configured=0===t.length,e.initialized=!!Ia&&!!Aa&&!!Pa,e.messagingAvailable=!!Aa,e.firestoreAvailable=!!Pa,e.tokenExists=!!localStorage.getItem("fcm_token"),"Notification"in window&&(e.notificationPermission=Notification.permission),e}catch(t){return console.error("🔥 Error getting Firebase status:",t),e}},qa={initializeFirebase:Ra,getFCMToken:Da,setupForegroundMessageListener:La,deleteFCMToken:Fa,getFirestore:Ua,getFirebaseStatus:Ba,config:xa},$a=Object.freeze(Object.defineProperty({__proto__:null,default:qa,deleteFCMToken:Fa,getFCMToken:Da,getFirebaseStatus:Ba,getFirestore:Ua,initializeFirebase:Ra,setupForegroundMessageListener:La},Symbol.toStringTag,{value:"Module"})),ja=()=>{try{const e=G.getPlatform();return"android"===e?"android":"ios"===e?"ios":"web"}catch(e){return"web"}};async function za(){try{if(!(await qa.initializeFirebase()))return null;return await qa.getFCMToken()}catch(e){return console.warn("notificationClient: no se pudo obtener FCM token:",(null==e?void 0:e.message)||e),null}}async function Va(e={},t={}){const a=t.platformOverride||ja();let n=null;try{n=await za()}catch(o){}const s={...e};n&&(s.fcm_token=n,s.platform=a);const i=await Ta.login(s);if(!n)try{const e=await za();e&&await async function(e,t=null){try{const a=t||ja();return await Na.storeDeviceToken(e,a),localStorage.setItem("fcm_token",e),!0}catch(a){return console.warn("notificationClient: error registrando token despues de login:",(null==a?void 0:a.message)||a),!1}}(e,a)}catch(o){}return i}const Wa=e=>{try{return"object"==typeof e&&null!==e&&"value"in e?n(e):e}catch(t){return console.warn("Error accessing reactive value:",t),null}},Ha=e=>{try{const t=Wa(e);return t?String(t):""}catch(t){return console.warn("Error converting token to string:",t),""}},Ga=e("auth",()=>{const e=t(null),n=t(localStorage.getItem("token")||null),s=t(!1);console.log("AuthStore - Inicialización - Token cargado de localStorage:",Ha(n)?"Sí (presente)":"No");const i=t(!!Ha(n)),o=t(!1),r=t(null),l=t(null),c=localStorage.getItem("user");if(c)try{const t=JSON.parse(c);console.log("AuthStore - Usuario cargado de localStorage:",t),t.selectedRole&&(l.value=t.selectedRole,t.role=t.selectedRole,console.log("AuthStore - Rol seleccionado del usuario:",t.role)),e.value=t}catch(h){console.error("AuthStore - Error al parsear usuario de localStorage:",h)}const d=a(()=>{var t;return l.value||(null==(t=e.value)?void 0:t.role)||null}),u=async()=>{console.log("AuthStore - Cerrando sesión");try{await async function(){try{const t=localStorage.getItem("fcm_token");if(t){try{await Na.deleteDeviceToken({token:t})}catch(h){try{await Ta.delete("device-token",{data:{token:t}})}catch(e){console.warn("notificationClient: fallback delete failed",e)}}localStorage.removeItem("fcm_token")}try{await Ta.logout()}catch(e){}return localStorage.removeItem("token"),localStorage.removeItem("user"),!0}catch(r){return console.warn("notificationClient: error en logoutAndUnregister",r),!1}}(),console.log("AuthStore - logoutAndUnregister ejecutado")}catch(t){console.warn("AuthStore - Error en logoutAndUnregister:",t)}e.value=null,n.value=null,i.value=!1,l.value=null,localStorage.removeItem("token"),localStorage.removeItem("userRole"),localStorage.removeItem("user"),localStorage.removeItem("fcm_token");try{const{deleteFCMToken:e}=await j(async()=>{const{deleteFCMToken:e}=await Promise.resolve().then(()=>$a);return{deleteFCMToken:e}},void 0);await e(),console.log("AuthStore - Token FCM eliminado")}catch(t){console.warn("Error eliminando token FCM:",t)}try{const{useNotificationsStore:e}=await j(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>er);return{useNotificationsStore:e}},void 0);e().disconnectRealTimeNotifications()}catch(t){console.warn("Error desconectando Firestore listeners:",t)}return console.log("AuthStore - Sesión cerrada, token eliminado de localStorage"),!0};return{user:e,token:n,isAuthenticated:i,initialized:s,isLoading:o,error:r,selectedRole:l,currentRole:d,login:async t=>{var a;console.log("AuthStore - Iniciando login"),o.value=!0,r.value=null;try{const o=(await Va(t)).data||{};console.log("AuthStore - Respuesta login:",o);const r=o.token||o.access_token||o.plainTextToken;console.log("AuthStore - Token recibido:",r?"Sí (valor no mostrado)":"No"),e.value=o.user,n.value=r||null,i.value=!0,l.value=(null==(a=o.user)?void 0:a.selectedRole)||null;const d=Ha(n);d&&(console.log("AuthStore - Guardando token en localStorage"),localStorage.setItem("token",d),console.log("AuthStore - Token después de guardar:",localStorage.getItem("token")?"Existe":"No existe")),localStorage.setItem("user",JSON.stringify(o.user)),s.value=!0;try{console.log("AuthStore - Inicializando sistema de notificaciones después del login...");const{initializePushNotifications:e}=await j(async()=>{const{initializePushNotifications:e}=await Promise.resolve().then(()=>dI);return{initializePushNotifications:e}},void 0),t=((await j(async()=>{const{Capacitor:e}=await Promise.resolve().then(()=>te);return{Capacitor:e}},void 0)).Capacitor.getPlatform(),await e());console.log("AuthStore - initializePushNotifications result:",t);const{useNotificationsStore:a}=await j(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>er);return{useNotificationsStore:e}},void 0);a().initializeRealTimeNotifications(),console.log("AuthStore - Listeners de Firestore inicializados")}catch(c){console.warn("AuthStore - Error inicializando notificaciones:",c)}return o.user}catch(h){throw console.error("AuthStore - Error en login:",h),r.value=h.message||"Error al iniciar sesión",h}finally{o.value=!1}},register:async t=>{o.value=!0,r.value=null;try{const a=(await Ta.register(t)).data||{};e.value=a.user,n.value=a.token||null,i.value=!0,l.value=null;const s=Ha(n);return s&&localStorage.setItem("token",s),localStorage.setItem("user",JSON.stringify(a.user)),a.user}catch(h){throw r.value=h.message||"Error al registrarse",h}finally{o.value=!1}},logout:u,fetchUser:async()=>{if(console.log("AuthStore - fetchUser iniciado"),e.value)return void console.log("AuthStore - Usuario ya existe en el estado:",e.value);const t=localStorage.getItem("user");if(t)try{e.value=JSON.parse(t),console.log("AuthStore - Usuario cargado de localStorage en fetchUser:",e.value)}catch(h){console.error("AuthStore - Error al parsear usuario en fetchUser:",h)}else i.value&&(console.log("AuthStore - Autenticado pero sin usuario en localStorage. Cerrando sesión."),u())},updateProfile:async t=>{try{console.log("Actualizando perfil con:",Object.fromEntries(t.entries()));const a=Object.fromEntries(t.entries());return e.value={...e.value,...a},localStorage.setItem("user",JSON.stringify(e.value)),{data:{user:e.value}}}catch(a){throw console.error("Error actualizando el perfil:",a),a}},forgotPassword:async e=>{o.value=!0,r.value=null;try{return!0}catch(h){throw r.value=h.message||"Error al enviar email de recuperación",h}finally{o.value=!1}},resetPassword:async(e,t)=>{o.value=!0,r.value=null;try{return!0}catch(h){throw r.value=h.message||"Error al restablecer contraseña",h}finally{o.value=!1}},setSelectedRole:t=>{console.log("AuthStore - setSelectedRole:",t),console.log("AuthStore - Estado previo:",{selectedRole:Wa(l),tokenInState:!!Ha(n),tokenInStorage:!!localStorage.getItem("token")}),l.value=t,e.value&&(e.value={...e.value,role:t});const a=localStorage.getItem("user");if(a)try{const e=JSON.parse(a);e.selectedRole=t,e.role=t,localStorage.setItem("user",JSON.stringify(e)),console.log("AuthStore - Usuario actualizado en localStorage con rol:",t)}catch(h){console.error("AuthStore - Error actualizando usuario en localStorage:",h)}try{const e=localStorage.getItem("token");e&&(n.value=e,i.value=!0,console.log("AuthStore - Token sincronizado desde localStorage tras setSelectedRole"))}catch(h){console.warn("AuthStore - Error sincronizando token desde localStorage:",h)}console.log("AuthStore - Estado después de setSelectedRole:",{selectedRole:Wa(l),tokenInState:!!Ha(n),tokenInStorage:!!localStorage.getItem("token")})},getSelectedRole:()=>Wa(l),tryToLogin:async()=>{console.log("AuthStore - tryToLogin iniciado");const t=localStorage.getItem("token"),a=localStorage.getItem("user");if(!t)return console.log("AuthStore - No hay token almacenado"),!1;try{if(n.value=t,a){const t=JSON.parse(a);e.value=t,l.value=t.selectedRole||t.role,console.log("AuthStore - Usuario restaurado desde localStorage:",t)}return await Ta.getCurrentUser()?(i.value=!0,console.log("AuthStore - Autenticación exitosa con token existente."),s.value=!0,!0):(console.warn("AuthStore - Token inválido, cerrando sesión."),u(),!1)}catch(h){return console.error("AuthStore - Error en tryToLogin:",h),await u(),s.value=!0,!1}}}});
/*!
* sweetalert2 v11.22.0
* Released under the MIT License.
*/
function Ya(e,t,a){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:a;throw new TypeError("Private element is not present on this object")}function Ka(e,t){return e.get(Ya(e,t))}function Qa(e,t,a){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,a)}const Ja={},Za=e=>new Promise(t=>{if(!e)return t();const a=window.scrollX,n=window.scrollY;Ja.restoreFocusTimeout=setTimeout(()=>{Ja.previousActiveElement instanceof HTMLElement?(Ja.previousActiveElement.focus(),Ja.previousActiveElement=null):document.body&&document.body.focus(),t()},100),window.scrollTo(a,n)}),Xa="swal2-",en=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error","draggable","dragging"].reduce((e,t)=>(e[t]=Xa+t,e),{}),tn=["success","warning","info","question","error"].reduce((e,t)=>(e[t]=Xa+t,e),{}),an="SweetAlert2:",nn=e=>e.charAt(0).toUpperCase()+e.slice(1),sn=e=>{console.warn(`${an} ${"object"==typeof e?e.join(" "):e}`)},on=e=>{console.error(`${an} ${e}`)},rn=[],ln=(e,t=null)=>{var a;a=`"${e}" is deprecated and will be removed in the next major release.${t?` Use "${t}" instead.`:""}`,rn.includes(a)||(rn.push(a),sn(a))},cn=e=>"function"==typeof e?e():e,dn=e=>e&&"function"==typeof e.toPromise,un=e=>dn(e)?e.toPromise():Promise.resolve(e),hn=e=>e&&Promise.resolve(e)===e,pn=()=>document.body.querySelector(`.${en.container}`),mn=e=>{const t=pn();return t?t.querySelector(e):null},fn=e=>mn(`.${e}`),gn=()=>fn(en.popup),vn=()=>fn(en.icon),bn=()=>fn(en.title),wn=()=>fn(en["html-container"]),yn=()=>fn(en.image),_n=()=>fn(en["progress-steps"]),kn=()=>fn(en["validation-message"]),Cn=()=>mn(`.${en.actions} .${en.confirm}`),En=()=>mn(`.${en.actions} .${en.cancel}`),Sn=()=>mn(`.${en.actions} .${en.deny}`),Tn=()=>mn(`.${en.loader}`),Nn=()=>fn(en.actions),xn=()=>fn(en.footer),In=()=>fn(en["timer-progress-bar"]),An=()=>fn(en.close),Pn=()=>{const e=gn();if(!e)return[];const t=e.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),a=Array.from(t).sort((e,t)=>{const a=parseInt(e.getAttribute("tabindex")||"0"),n=parseInt(t.getAttribute("tabindex")||"0");return a>n?1:a<n?-1:0}),n=e.querySelectorAll('\n  a[href],\n  area[href],\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled]),\n  button:not([disabled]),\n  iframe,\n  object,\n  embed,\n  [tabindex="0"],\n  [contenteditable],\n  audio[controls],\n  video[controls],\n  summary\n'),s=Array.from(n).filter(e=>"-1"!==e.getAttribute("tabindex"));return[...new Set(a.concat(s))].filter(e=>Kn(e))},Rn=()=>Mn(document.body,en.shown)&&!Mn(document.body,en["toast-shown"])&&!Mn(document.body,en["no-backdrop"]),Dn=()=>{const e=gn();return!!e&&Mn(e,en.toast)},Ln=(e,t)=>{if(e.textContent="",t){const a=(new DOMParser).parseFromString(t,"text/html"),n=a.querySelector("head");n&&Array.from(n.childNodes).forEach(t=>{e.appendChild(t)});const s=a.querySelector("body");s&&Array.from(s.childNodes).forEach(t=>{t instanceof HTMLVideoElement||t instanceof HTMLAudioElement?e.appendChild(t.cloneNode(!0)):e.appendChild(t)})}},Mn=(e,t)=>{if(!t)return!1;const a=t.split(/\s+/);for(let n=0;n<a.length;n++)if(!e.classList.contains(a[n]))return!1;return!0},On=(e,t,a)=>{if(((e,t)=>{Array.from(e.classList).forEach(a=>{Object.values(en).includes(a)||Object.values(tn).includes(a)||Object.values(t.showClass||{}).includes(a)||e.classList.remove(a)})})(e,t),!t.customClass)return;const n=t.customClass[a];n&&("string"==typeof n||n.forEach?qn(e,n):sn(`Invalid type of customClass.${a}! Expected string or iterable object, got "${typeof n}"`))},Fn=(e,t)=>{if(!t)return null;switch(t){case"select":case"textarea":case"file":return e.querySelector(`.${en.popup} > .${en[t]}`);case"checkbox":return e.querySelector(`.${en.popup} > .${en.checkbox} input`);case"radio":return e.querySelector(`.${en.popup} > .${en.radio} input:checked`)||e.querySelector(`.${en.popup} > .${en.radio} input:first-child`);case"range":return e.querySelector(`.${en.popup} > .${en.range} input`);default:return e.querySelector(`.${en.popup} > .${en.input}`)}},Un=e=>{if(e.focus(),"file"!==e.type){const t=e.value;e.value="",e.value=t}},Bn=(e,t,a)=>{e&&t&&("string"==typeof t&&(t=t.split(/\s+/).filter(Boolean)),t.forEach(t=>{Array.isArray(e)?e.forEach(e=>{a?e.classList.add(t):e.classList.remove(t)}):a?e.classList.add(t):e.classList.remove(t)}))},qn=(e,t)=>{Bn(e,t,!0)},$n=(e,t)=>{Bn(e,t,!1)},jn=(e,t)=>{const a=Array.from(e.children);for(let n=0;n<a.length;n++){const e=a[n];if(e instanceof HTMLElement&&Mn(e,t))return e}},zn=(e,t,a)=>{a===`${parseInt(a)}`&&(a=parseInt(a)),a||0===parseInt(a)?e.style.setProperty(t,"number"==typeof a?`${a}px`:a):e.style.removeProperty(t)},Vn=(e,t="flex")=>{e&&(e.style.display=t)},Wn=e=>{e&&(e.style.display="none")},Hn=(e,t="block")=>{e&&new MutationObserver(()=>{Yn(e,e.innerHTML,t)}).observe(e,{childList:!0,subtree:!0})},Gn=(e,t,a,n)=>{const s=e.querySelector(t);s&&s.style.setProperty(a,n)},Yn=(e,t,a="flex")=>{t?Vn(e,a):Wn(e)},Kn=e=>!(!e||!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)),Qn=e=>!!(e.scrollHeight>e.clientHeight),Jn=e=>{const t=window.getComputedStyle(e),a=parseFloat(t.getPropertyValue("animation-duration")||"0"),n=parseFloat(t.getPropertyValue("transition-duration")||"0");return a>0||n>0},Zn=(e,t=!1)=>{const a=In();a&&Kn(a)&&(t&&(a.style.transition="none",a.style.width="100%"),setTimeout(()=>{a.style.transition=`width ${e/1e3}s linear`,a.style.width="0%"},10))},Xn=`\n <div aria-labelledby="${en.title}" aria-describedby="${en["html-container"]}" class="${en.popup}" tabindex="-1">\n   <button type="button" class="${en.close}"></button>\n   <ul class="${en["progress-steps"]}"></ul>\n   <div class="${en.icon}"></div>\n   <img class="${en.image}" />\n   <h2 class="${en.title}" id="${en.title}"></h2>\n   <div class="${en["html-container"]}" id="${en["html-container"]}"></div>\n   <input class="${en.input}" id="${en.input}" />\n   <input type="file" class="${en.file}" />\n   <div class="${en.range}">\n     <input type="range" />\n     <output></output>\n   </div>\n   <select class="${en.select}" id="${en.select}"></select>\n   <div class="${en.radio}"></div>\n   <label class="${en.checkbox}">\n     <input type="checkbox" id="${en.checkbox}" />\n     <span class="${en.label}"></span>\n   </label>\n   <textarea class="${en.textarea}" id="${en.textarea}"></textarea>\n   <div class="${en["validation-message"]}" id="${en["validation-message"]}"></div>\n   <div class="${en.actions}">\n     <div class="${en.loader}"></div>\n     <button type="button" class="${en.confirm}"></button>\n     <button type="button" class="${en.deny}"></button>\n     <button type="button" class="${en.cancel}"></button>\n   </div>\n   <div class="${en.footer}"></div>\n   <div class="${en["timer-progress-bar-container"]}">\n     <div class="${en["timer-progress-bar"]}"></div>\n   </div>\n </div>\n`.replace(/(^|\n)\s*/g,""),es=()=>{Ja.currentInstance.resetValidationMessage()},ts=e=>{const t=(()=>{const e=pn();return!!e&&(e.remove(),$n([document.documentElement,document.body],[en["no-backdrop"],en["toast-shown"],en["has-column"]]),!0)})();if("undefined"==typeof window||"undefined"==typeof document)return void on("SweetAlert2 requires document to initialize");const a=document.createElement("div");a.className=en.container,t&&qn(a,en["no-transition"]),Ln(a,Xn),a.dataset.swal2Theme=e.theme;const n="string"==typeof(s=e.target)?document.querySelector(s):s;var s;n.appendChild(a),e.topLayer&&(a.setAttribute("popover",""),a.showPopover()),(e=>{const t=gn();t.setAttribute("role",e.toast?"alert":"dialog"),t.setAttribute("aria-live",e.toast?"polite":"assertive"),e.toast||t.setAttribute("aria-modal","true")})(e),(e=>{"rtl"===window.getComputedStyle(e).direction&&qn(pn(),en.rtl)})(n),(()=>{const e=gn(),t=jn(e,en.input),a=jn(e,en.file),n=e.querySelector(`.${en.range} input`),s=e.querySelector(`.${en.range} output`),i=jn(e,en.select),o=e.querySelector(`.${en.checkbox} input`),r=jn(e,en.textarea);t.oninput=es,a.onchange=es,i.onchange=es,o.onchange=es,r.oninput=es,n.oninput=()=>{es(),s.value=n.value},n.onchange=()=>{es(),s.value=n.value}})()},as=(e,t)=>{e instanceof HTMLElement?t.appendChild(e):"object"==typeof e?ns(e,t):e&&Ln(t,e)},ns=(e,t)=>{e.jquery?ss(t,e):Ln(t,e.toString())},ss=(e,t)=>{if(e.textContent="",0 in t)for(let a=0;a in t;a++)e.appendChild(t[a].cloneNode(!0));else e.appendChild(t.cloneNode(!0))},is=(e,t)=>{const a=Nn(),n=Tn();a&&n&&(t.showConfirmButton||t.showDenyButton||t.showCancelButton?Vn(a):Wn(a),On(a,t,"actions"),function(e,t,a){const n=Cn(),s=Sn(),i=En();if(!n||!s||!i)return;rs(n,"confirm",a),rs(s,"deny",a),rs(i,"cancel",a),function(e,t,a,n){if(!n.buttonsStyling)return void $n([e,t,a],en.styled);qn([e,t,a],en.styled),n.confirmButtonColor&&e.style.setProperty("--swal2-confirm-button-background-color",n.confirmButtonColor);n.denyButtonColor&&t.style.setProperty("--swal2-deny-button-background-color",n.denyButtonColor);n.cancelButtonColor&&a.style.setProperty("--swal2-cancel-button-background-color",n.cancelButtonColor);os(e),os(t),os(a)}(n,s,i,a),a.reverseButtons&&(a.toast?(e.insertBefore(i,n),e.insertBefore(s,n)):(e.insertBefore(i,t),e.insertBefore(s,t),e.insertBefore(n,t)))}(a,n,t),Ln(n,t.loaderHtml||""),On(n,t,"loader"))};function os(e){const t=window.getComputedStyle(e);if(t.getPropertyValue("--swal2-action-button-focus-box-shadow"))return;const a=t.backgroundColor.replace(/rgba?\((\d+), (\d+), (\d+).*/,"rgba($1, $2, $3, 0.5)");e.style.setProperty("--swal2-action-button-focus-box-shadow",t.getPropertyValue("--swal2-outline").replace(/ rgba\(.*/,` ${a}`))}function rs(e,t,a){const n=nn(t);Yn(e,a[`show${n}Button`],"inline-block"),Ln(e,a[`${t}ButtonText`]||""),e.setAttribute("aria-label",a[`${t}ButtonAriaLabel`]||""),e.className=en[t],On(e,a,`${t}Button`)}const ls=(e,t)=>{const a=pn();a&&(!function(e,t){"string"==typeof t?e.style.background=t:t||qn([document.documentElement,document.body],en["no-backdrop"])}(a,t.backdrop),function(e,t){if(!t)return;t in en?qn(e,en[t]):(sn('The "position" parameter is not valid, defaulting to "center"'),qn(e,en.center))}(a,t.position),function(e,t){if(!t)return;qn(e,en[`grow-${t}`])}(a,t.grow),On(a,t,"container"))};var cs={innerParams:new WeakMap,domCache:new WeakMap};const ds=["input","file","range","select","radio","checkbox","textarea"],us=e=>{if(!e.input)return;if(!bs[e.input])return void on(`Unexpected type of input! Expected ${Object.keys(bs).join(" | ")}, got "${e.input}"`);const t=gs(e.input);if(!t)return;const a=bs[e.input](t,e);Vn(t),e.inputAutoFocus&&setTimeout(()=>{Un(a)})},hs=(e,t)=>{const a=gn();if(!a)return;const n=Fn(a,e);if(n){(e=>{for(let t=0;t<e.attributes.length;t++){const a=e.attributes[t].name;["id","type","value","style"].includes(a)||e.removeAttribute(a)}})(n);for(const e in t)n.setAttribute(e,t[e])}},ps=e=>{if(!e.input)return;const t=gs(e.input);t&&On(t,e,"input")},ms=(e,t)=>{!e.placeholder&&t.inputPlaceholder&&(e.placeholder=t.inputPlaceholder)},fs=(e,t,a)=>{if(a.inputLabel){const n=document.createElement("label"),s=en["input-label"];n.setAttribute("for",e.id),n.className=s,"object"==typeof a.customClass&&qn(n,a.customClass.inputLabel),n.innerText=a.inputLabel,t.insertAdjacentElement("beforebegin",n)}},gs=e=>{const t=gn();if(t)return jn(t,en[e]||en.input)},vs=(e,t)=>{["string","number"].includes(typeof t)?e.value=`${t}`:hn(t)||sn(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof t}"`)},bs={};bs.text=bs.email=bs.password=bs.number=bs.tel=bs.url=bs.search=bs.date=bs["datetime-local"]=bs.time=bs.week=bs.month=(e,t)=>(vs(e,t.inputValue),fs(e,e,t),ms(e,t),e.type=t.input,e),bs.file=(e,t)=>(fs(e,e,t),ms(e,t),e),bs.range=(e,t)=>{const a=e.querySelector("input"),n=e.querySelector("output");return vs(a,t.inputValue),a.type=t.input,vs(n,t.inputValue),fs(a,e,t),e},bs.select=(e,t)=>{if(e.textContent="",t.inputPlaceholder){const a=document.createElement("option");Ln(a,t.inputPlaceholder),a.value="",a.disabled=!0,a.selected=!0,e.appendChild(a)}return fs(e,e,t),e},bs.radio=e=>(e.textContent="",e),bs.checkbox=(e,t)=>{const a=Fn(gn(),"checkbox");a.value="1",a.checked=Boolean(t.inputValue);const n=e.querySelector("span");return Ln(n,t.inputPlaceholder||t.inputLabel),a},bs.textarea=(e,t)=>{vs(e,t.inputValue),ms(e,t),fs(e,e,t);return setTimeout(()=>{if("MutationObserver"in window){const a=parseInt(window.getComputedStyle(gn()).width);new MutationObserver(()=>{if(!document.body.contains(e))return;const n=e.offsetWidth+(s=e,parseInt(window.getComputedStyle(s).marginLeft)+parseInt(window.getComputedStyle(s).marginRight));var s;n>a?gn().style.width=`${n}px`:zn(gn(),"width",t.width)}).observe(e,{attributes:!0,attributeFilter:["style"]})}}),e};const ws=(e,t)=>{const a=wn();a&&(Hn(a),On(a,t,"htmlContainer"),t.html?(as(t.html,a),Vn(a,"block")):t.text?(a.textContent=t.text,Vn(a,"block")):Wn(a),((e,t)=>{const a=gn();if(!a)return;const n=cs.innerParams.get(e),s=!n||t.input!==n.input;ds.forEach(e=>{const n=jn(a,en[e]);n&&(hs(e,t.inputAttributes),n.className=en[e],s&&Wn(n))}),t.input&&(s&&us(t),ps(t))})(e,t))},ys=(e,t)=>{for(const[a,n]of Object.entries(tn))t.icon!==a&&$n(e,n);qn(e,t.icon&&tn[t.icon]),Cs(e,t),_s(),On(e,t,"icon")},_s=()=>{const e=gn();if(!e)return;const t=window.getComputedStyle(e).getPropertyValue("background-color"),a=e.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let n=0;n<a.length;n++)a[n].style.backgroundColor=t},ks=(e,t)=>{if(!t.icon&&!t.iconHtml)return;let a=e.innerHTML,n="";if(t.iconHtml)n=Es(t.iconHtml);else if("success"===t.icon)n='\n  <div class="swal2-success-circular-line-left"></div>\n  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>\n  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>\n  <div class="swal2-success-circular-line-right"></div>\n',a=a.replace(/ style=".*?"/g,"");else if("error"===t.icon)n='\n  <span class="swal2-x-mark">\n    <span class="swal2-x-mark-line-left"></span>\n    <span class="swal2-x-mark-line-right"></span>\n  </span>\n';else if(t.icon){n=Es({question:"?",warning:"!",info:"i"}[t.icon])}a.trim()!==n.trim()&&Ln(e,n)},Cs=(e,t)=>{if(t.iconColor){e.style.color=t.iconColor,e.style.borderColor=t.iconColor;for(const a of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])Gn(e,a,"background-color",t.iconColor);Gn(e,".swal2-success-ring","border-color",t.iconColor)}},Es=e=>`<div class="${en["icon-content"]}">${e}</div>`;let Ss=!1,Ts=0,Ns=0,xs=0,Is=0;const As=e=>{const t=gn();if(e.target===t||vn().contains(e.target)){Ss=!0;const a=Ds(e);Ts=a.clientX,Ns=a.clientY,xs=parseInt(t.style.insetInlineStart)||0,Is=parseInt(t.style.insetBlockStart)||0,qn(t,"swal2-dragging")}},Ps=e=>{const t=gn();if(Ss){let{clientX:a,clientY:n}=Ds(e);t.style.insetInlineStart=`${xs+(a-Ts)}px`,t.style.insetBlockStart=`${Is+(n-Ns)}px`}},Rs=()=>{const e=gn();Ss=!1,$n(e,"swal2-dragging")},Ds=e=>{let t=0,a=0;return e.type.startsWith("mouse")?(t=e.clientX,a=e.clientY):e.type.startsWith("touch")&&(t=e.touches[0].clientX,a=e.touches[0].clientY),{clientX:t,clientY:a}},Ls=(e,t)=>{const a=pn(),n=gn();if(a&&n){if(t.toast){zn(a,"width",t.width),n.style.width="100%";const e=Tn();e&&n.insertBefore(e,vn())}else zn(n,"width",t.width);zn(n,"padding",t.padding),t.color&&(n.style.color=t.color),t.background&&(n.style.background=t.background),Wn(kn()),Ms(n,t),t.draggable&&!t.toast?(qn(n,en.draggable),(e=>{e.addEventListener("mousedown",As),document.body.addEventListener("mousemove",Ps),e.addEventListener("mouseup",Rs),e.addEventListener("touchstart",As),document.body.addEventListener("touchmove",Ps),e.addEventListener("touchend",Rs)})(n)):($n(n,en.draggable),(e=>{e.removeEventListener("mousedown",As),document.body.removeEventListener("mousemove",Ps),e.removeEventListener("mouseup",Rs),e.removeEventListener("touchstart",As),document.body.removeEventListener("touchmove",Ps),e.removeEventListener("touchend",Rs)})(n))}},Ms=(e,t)=>{const a=t.showClass||{};e.className=`${en.popup} ${Kn(e)?a.popup:""}`,t.toast?(qn([document.documentElement,document.body],en["toast-shown"]),qn(e,en.toast)):qn(e,en.modal),On(e,t,"popup"),"string"==typeof t.customClass&&qn(e,t.customClass),t.icon&&qn(e,en[`icon-${t.icon}`])},Os=e=>{const t=document.createElement("li");return qn(t,en["progress-step"]),Ln(t,e),t},Fs=e=>{const t=document.createElement("li");return qn(t,en["progress-step-line"]),e.progressStepsDistance&&zn(t,"width",e.progressStepsDistance),t},Us=(e,t)=>{Ls(0,t),ls(0,t),((e,t)=>{const a=_n();if(!a)return;const{progressSteps:n,currentProgressStep:s}=t;n&&0!==n.length&&void 0!==s?(Vn(a),a.textContent="",s>=n.length&&sn("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),n.forEach((e,i)=>{const o=Os(e);if(a.appendChild(o),i===s&&qn(o,en["active-progress-step"]),i!==n.length-1){const e=Fs(t);a.appendChild(e)}})):Wn(a)})(0,t),((e,t)=>{const a=cs.innerParams.get(e),n=vn();if(!n)return;if(a&&t.icon===a.icon)return ks(n,t),void ys(n,t);if(!t.icon&&!t.iconHtml)return void Wn(n);if(t.icon&&-1===Object.keys(tn).indexOf(t.icon))return on(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${t.icon}"`),void Wn(n);Vn(n),ks(n,t),ys(n,t),qn(n,t.showClass&&t.showClass.icon),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",_s)})(e,t),((e,t)=>{const a=yn();a&&(t.imageUrl?(Vn(a,""),a.setAttribute("src",t.imageUrl),a.setAttribute("alt",t.imageAlt||""),zn(a,"width",t.imageWidth),zn(a,"height",t.imageHeight),a.className=en.image,On(a,t,"image")):Wn(a))})(0,t),((e,t)=>{const a=bn();a&&(Hn(a),Yn(a,t.title||t.titleText,"block"),t.title&&as(t.title,a),t.titleText&&(a.innerText=t.titleText),On(a,t,"title"))})(0,t),((e,t)=>{const a=An();a&&(Ln(a,t.closeButtonHtml||""),On(a,t,"closeButton"),Yn(a,t.showCloseButton),a.setAttribute("aria-label",t.closeButtonAriaLabel||""))})(0,t),ws(e,t),is(0,t),((e,t)=>{const a=xn();a&&(Hn(a),Yn(a,t.footer,"block"),t.footer&&as(t.footer,a),On(a,t,"footer"))})(0,t);const a=gn();"function"==typeof t.didRender&&a&&t.didRender(a),Ja.eventEmitter.emit("didRender",a)},Bs=()=>{var e;return null===(e=Cn())||void 0===e?void 0:e.click()},qs=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),$s=e=>{e.keydownTarget&&e.keydownHandlerAdded&&(e.keydownTarget.removeEventListener("keydown",e.keydownHandler,{capture:e.keydownListenerCapture}),e.keydownHandlerAdded=!1)},js=(e,t)=>{var a;const n=Pn();if(n.length)return-2===(e+=t)&&(e=n.length-1),e===n.length?e=0:-1===e&&(e=n.length-1),void n[e].focus();null===(a=gn())||void 0===a||a.focus()},zs=["ArrowRight","ArrowDown"],Vs=["ArrowLeft","ArrowUp"],Ws=(e,t,a)=>{e&&(t.isComposing||229===t.keyCode||(e.stopKeydownPropagation&&t.stopPropagation(),"Enter"===t.key?Hs(t,e):"Tab"===t.key?Gs(t):[...zs,...Vs].includes(t.key)?Ys(t.key):"Escape"===t.key&&Ks(t,e,a)))},Hs=(e,t)=>{if(!cn(t.allowEnterKey))return;const a=Fn(gn(),t.input);if(e.target&&a&&e.target instanceof HTMLElement&&e.target.outerHTML===a.outerHTML){if(["textarea","file"].includes(t.input))return;Bs(),e.preventDefault()}},Gs=e=>{const t=e.target,a=Pn();let n=-1;for(let s=0;s<a.length;s++)if(t===a[s]){n=s;break}e.shiftKey?js(n,-1):js(n,1),e.stopPropagation(),e.preventDefault()},Ys=e=>{const t=Nn(),a=Cn(),n=Sn(),s=En();if(!(t&&a&&n&&s))return;const i=[a,n,s];if(document.activeElement instanceof HTMLElement&&!i.includes(document.activeElement))return;const o=zs.includes(e)?"nextElementSibling":"previousElementSibling";let r=document.activeElement;if(r){for(let e=0;e<t.children.length;e++){if(r=r[o],!r)return;if(r instanceof HTMLButtonElement&&Kn(r))break}r instanceof HTMLButtonElement&&r.focus()}},Ks=(e,t,a)=>{cn(t.allowEscapeKey)&&(e.preventDefault(),a(qs.esc))};var Qs={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const Js=()=>{Array.from(document.body.children).forEach(e=>{e.hasAttribute("data-previous-aria-hidden")?(e.setAttribute("aria-hidden",e.getAttribute("data-previous-aria-hidden")||""),e.removeAttribute("data-previous-aria-hidden")):e.removeAttribute("aria-hidden")})},Zs="undefined"!=typeof window&&!!window.GestureEvent,Xs=()=>{const e=pn();if(!e)return;let t;e.ontouchstart=e=>{t=ei(e)},e.ontouchmove=e=>{t&&(e.preventDefault(),e.stopPropagation())}},ei=e=>{const t=e.target,a=pn(),n=wn();return!(!a||!n)&&(!ti(e)&&!ai(e)&&(t===a||!(Qn(a)||!(t instanceof HTMLElement)||((e,t)=>{let a=e;for(;a&&a!==t;){if(Qn(a))return!0;a=a.parentElement}return!1})(t,n)||"INPUT"===t.tagName||"TEXTAREA"===t.tagName||Qn(n)&&n.contains(t))))},ti=e=>e.touches&&e.touches.length&&"stylus"===e.touches[0].touchType,ai=e=>e.touches&&e.touches.length>1;let ni=null;const si=e=>{null===ni&&(document.body.scrollHeight>window.innerHeight||"scroll"===e)&&(ni=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${ni+(()=>{const e=document.createElement("div");e.className=en["scrollbar-measure"],document.body.appendChild(e);const t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t})()}px`)};function ii(e,t,a,n){Dn()?pi(e,n):(Za(a).then(()=>pi(e,n)),$s(Ja)),Zs?(t.setAttribute("style","display:none !important"),t.removeAttribute("class"),t.innerHTML=""):t.remove(),Rn()&&(null!==ni&&(document.body.style.paddingRight=`${ni}px`,ni=null),(()=>{if(Mn(document.body,en.iosfix)){const e=parseInt(document.body.style.top,10);$n(document.body,en.iosfix),document.body.style.top="",document.body.scrollTop=-1*e}})(),Js()),$n([document.documentElement,document.body],[en.shown,en["height-auto"],en["no-backdrop"],en["toast-shown"]])}function oi(e){e=di(e);const t=Qs.swalPromiseResolve.get(this),a=ri(this);this.isAwaitingPromise?e.isDismissed||(ci(this),t(e)):a&&t(e)}const ri=e=>{const t=gn();if(!t)return!1;const a=cs.innerParams.get(e);if(!a||Mn(t,a.hideClass.popup))return!1;$n(t,a.showClass.popup),qn(t,a.hideClass.popup);const n=pn();return $n(n,a.showClass.backdrop),qn(n,a.hideClass.backdrop),ui(e,t,a),!0};function li(e){const t=Qs.swalPromiseReject.get(this);ci(this),t&&t(e)}const ci=e=>{e.isAwaitingPromise&&(delete e.isAwaitingPromise,cs.innerParams.get(e)||e._destroy())},di=e=>void 0===e?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},e),ui=(e,t,a)=>{var n;const s=pn(),i=Jn(t);"function"==typeof a.willClose&&a.willClose(t),null===(n=Ja.eventEmitter)||void 0===n||n.emit("willClose",t),i?hi(e,t,s,a.returnFocus,a.didClose):ii(e,s,a.returnFocus,a.didClose)},hi=(e,t,a,n,s)=>{Ja.swalCloseEventFinishedCallback=ii.bind(null,e,a,n,s);const i=function(e){var a;e.target===t&&(null===(a=Ja.swalCloseEventFinishedCallback)||void 0===a||a.call(Ja),delete Ja.swalCloseEventFinishedCallback,t.removeEventListener("animationend",i),t.removeEventListener("transitionend",i))};t.addEventListener("animationend",i),t.addEventListener("transitionend",i)},pi=(e,t)=>{setTimeout(()=>{var a;"function"==typeof t&&t.bind(e.params)(),null===(a=Ja.eventEmitter)||void 0===a||a.emit("didClose"),e._destroy&&e._destroy()})},mi=e=>{let t=gn();if(t||new Yo,t=gn(),!t)return;const a=Tn();Dn()?Wn(vn()):fi(t,e),Vn(a),t.setAttribute("data-loading","true"),t.setAttribute("aria-busy","true"),t.focus()},fi=(e,t)=>{const a=Nn(),n=Tn();a&&n&&(!t&&Kn(Cn())&&(t=Cn()),Vn(a),t&&(Wn(t),n.setAttribute("data-button-to-replace",t.className),a.insertBefore(n,t)),qn([e,a],en.loading))},gi=e=>e.checked?1:0,vi=e=>e.checked?e.value:null,bi=e=>e.files&&e.files.length?null!==e.getAttribute("multiple")?e.files:e.files[0]:null,wi=(e,t)=>{const a=gn();if(!a)return;const n=e=>{"select"===t.input?function(e,t,a){const n=jn(e,en.select);if(!n)return;const s=(e,t,n)=>{const s=document.createElement("option");s.value=n,Ln(s,t),s.selected=ki(n,a.inputValue),e.appendChild(s)};t.forEach(e=>{const t=e[0],a=e[1];if(Array.isArray(a)){const e=document.createElement("optgroup");e.label=t,e.disabled=!1,n.appendChild(e),a.forEach(t=>s(e,t[1],t[0]))}else s(n,a,t)}),n.focus()}(a,_i(e),t):"radio"===t.input&&function(e,t,a){const n=jn(e,en.radio);if(!n)return;t.forEach(e=>{const t=e[0],s=e[1],i=document.createElement("input"),o=document.createElement("label");i.type="radio",i.name=en.radio,i.value=t,ki(t,a.inputValue)&&(i.checked=!0);const r=document.createElement("span");Ln(r,s),r.className=en.label,o.appendChild(i),o.appendChild(r),n.appendChild(o)});const s=n.querySelectorAll("input");s.length&&s[0].focus()}(a,_i(e),t)};dn(t.inputOptions)||hn(t.inputOptions)?(mi(Cn()),un(t.inputOptions).then(t=>{e.hideLoading(),n(t)})):"object"==typeof t.inputOptions?n(t.inputOptions):on("Unexpected type of inputOptions! Expected object, Map or Promise, got "+typeof t.inputOptions)},yi=(e,t)=>{const a=e.getInput();a&&(Wn(a),un(t.inputValue).then(n=>{a.value="number"===t.input?`${parseFloat(n)||0}`:`${n}`,Vn(a),a.focus(),e.hideLoading()}).catch(t=>{on(`Error in inputValue promise: ${t}`),a.value="",Vn(a),a.focus(),e.hideLoading()}))};const _i=e=>{const t=[];return e instanceof Map?e.forEach((e,a)=>{let n=e;"object"==typeof n&&(n=_i(n)),t.push([a,n])}):Object.keys(e).forEach(a=>{let n=e[a];"object"==typeof n&&(n=_i(n)),t.push([a,n])}),t},ki=(e,t)=>!!t&&t.toString()===e.toString(),Ci=(e,t)=>{const a=cs.innerParams.get(e);if(!a.input)return void on(`The "input" parameter is needed to be set when using returnInputValueOn${nn(t)}`);const n=e.getInput(),s=((e,t)=>{const a=e.getInput();if(!a)return null;switch(t.input){case"checkbox":return gi(a);case"radio":return vi(a);case"file":return bi(a);default:return t.inputAutoTrim?a.value.trim():a.value}})(e,a);a.inputValidator?Ei(e,s,t):n&&!n.checkValidity()?(e.enableButtons(),e.showValidationMessage(a.validationMessage||n.validationMessage)):"deny"===t?Si(e,s):xi(e,s)},Ei=(e,t,a)=>{const n=cs.innerParams.get(e);e.disableInput();Promise.resolve().then(()=>un(n.inputValidator(t,n.validationMessage))).then(n=>{e.enableButtons(),e.enableInput(),n?e.showValidationMessage(n):"deny"===a?Si(e,t):xi(e,t)})},Si=(e,t)=>{const a=cs.innerParams.get(e||void 0);if(a.showLoaderOnDeny&&mi(Sn()),a.preDeny){e.isAwaitingPromise=!0;Promise.resolve().then(()=>un(a.preDeny(t,a.validationMessage))).then(a=>{!1===a?(e.hideLoading(),ci(e)):e.close({isDenied:!0,value:void 0===a?t:a})}).catch(t=>Ni(e||void 0,t))}else e.close({isDenied:!0,value:t})},Ti=(e,t)=>{e.close({isConfirmed:!0,value:t})},Ni=(e,t)=>{e.rejectPromise(t)},xi=(e,t)=>{const a=cs.innerParams.get(e||void 0);if(a.showLoaderOnConfirm&&mi(),a.preConfirm){e.resetValidationMessage(),e.isAwaitingPromise=!0;Promise.resolve().then(()=>un(a.preConfirm(t,a.validationMessage))).then(a=>{Kn(kn())||!1===a?(e.hideLoading(),ci(e)):Ti(e,void 0===a?t:a)}).catch(t=>Ni(e||void 0,t))}else Ti(e,t)};function Ii(){const e=cs.innerParams.get(this);if(!e)return;const t=cs.domCache.get(this);Wn(t.loader),Dn()?e.icon&&Vn(vn()):Ai(t),$n([t.popup,t.actions],en.loading),t.popup.removeAttribute("aria-busy"),t.popup.removeAttribute("data-loading"),t.confirmButton.disabled=!1,t.denyButton.disabled=!1,t.cancelButton.disabled=!1}const Ai=e=>{const t=e.popup.getElementsByClassName(e.loader.getAttribute("data-button-to-replace"));t.length?Vn(t[0],"inline-block"):Kn(Cn())||Kn(Sn())||Kn(En())||Wn(e.actions)};function Pi(){const e=cs.innerParams.get(this),t=cs.domCache.get(this);return t?Fn(t.popup,e.input):null}function Ri(e,t,a){const n=cs.domCache.get(e);t.forEach(e=>{n[e].disabled=a})}function Di(e,t){const a=gn();if(a&&e)if("radio"===e.type){const e=a.querySelectorAll(`[name="${en.radio}"]`);for(let a=0;a<e.length;a++)e[a].disabled=t}else e.disabled=t}function Li(){Ri(this,["confirmButton","denyButton","cancelButton"],!1)}function Mi(){Ri(this,["confirmButton","denyButton","cancelButton"],!0)}function Oi(){Di(this.getInput(),!1)}function Fi(){Di(this.getInput(),!0)}function Ui(e){const t=cs.domCache.get(this),a=cs.innerParams.get(this);Ln(t.validationMessage,e),t.validationMessage.className=en["validation-message"],a.customClass&&a.customClass.validationMessage&&qn(t.validationMessage,a.customClass.validationMessage),Vn(t.validationMessage);const n=this.getInput();n&&(n.setAttribute("aria-invalid","true"),n.setAttribute("aria-describedby",en["validation-message"]),Un(n),qn(n,en.inputerror))}function Bi(){const e=cs.domCache.get(this);e.validationMessage&&Wn(e.validationMessage);const t=this.getInput();t&&(t.removeAttribute("aria-invalid"),t.removeAttribute("aria-describedby"),$n(t,en.inputerror))}const qi={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,draggable:!1,animation:!0,theme:"light",showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0,topLayer:!1},$i=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","draggable","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","theme","willClose"],ji={allowEnterKey:void 0},zi=["allowOutsideClick","allowEnterKey","backdrop","draggable","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],Vi=e=>Object.prototype.hasOwnProperty.call(qi,e),Wi=e=>-1!==$i.indexOf(e),Hi=e=>ji[e],Gi=e=>{Vi(e)||sn(`Unknown parameter "${e}"`)},Yi=e=>{zi.includes(e)&&sn(`The parameter "${e}" is incompatible with toasts`)},Ki=e=>{const t=Hi(e);t&&ln(e,t)},Qi=e=>{!1===e.backdrop&&e.allowOutsideClick&&sn('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`'),e.theme&&!["light","dark","auto","minimal","borderless","embed-iframe","bulma","bulma-light","bulma-dark"].includes(e.theme)&&sn(`Invalid theme "${e.theme}"`);for(const t in e)Gi(t),e.toast&&Yi(t),Ki(t)};function Ji(e){const t=pn(),a=gn(),n=cs.innerParams.get(this);if(!a||Mn(a,n.hideClass.popup))return void sn("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");const s=Zi(e),i=Object.assign({},n,s);Qi(i),t.dataset.swal2Theme=i.theme,Us(this,i),cs.innerParams.set(this,i),Object.defineProperties(this,{params:{value:Object.assign({},this.params,e),writable:!1,enumerable:!0}})}const Zi=e=>{const t={};return Object.keys(e).forEach(a=>{Wi(a)?t[a]=e[a]:sn(`Invalid parameter to update: ${a}`)}),t};function Xi(){const e=cs.domCache.get(this),t=cs.innerParams.get(this);t?(e.popup&&Ja.swalCloseEventFinishedCallback&&(Ja.swalCloseEventFinishedCallback(),delete Ja.swalCloseEventFinishedCallback),"function"==typeof t.didDestroy&&t.didDestroy(),Ja.eventEmitter.emit("didDestroy"),eo(this)):to(this)}const eo=e=>{to(e),delete e.params,delete Ja.keydownHandler,delete Ja.keydownTarget,delete Ja.currentInstance},to=e=>{e.isAwaitingPromise?(ao(cs,e),e.isAwaitingPromise=!0):(ao(Qs,e),ao(cs,e),delete e.isAwaitingPromise,delete e.disableButtons,delete e.enableButtons,delete e.getInput,delete e.disableInput,delete e.enableInput,delete e.hideLoading,delete e.disableLoading,delete e.showValidationMessage,delete e.resetValidationMessage,delete e.close,delete e.closePopup,delete e.closeModal,delete e.closeToast,delete e.rejectPromise,delete e.update,delete e._destroy)},ao=(e,t)=>{for(const a in e)e[a].delete(t)};var no=Object.freeze({__proto__:null,_destroy:Xi,close:oi,closeModal:oi,closePopup:oi,closeToast:oi,disableButtons:Mi,disableInput:Fi,disableLoading:Ii,enableButtons:Li,enableInput:Oi,getInput:Pi,handleAwaitingPromise:ci,hideLoading:Ii,rejectPromise:li,resetValidationMessage:Bi,showValidationMessage:Ui,update:Ji});const so=(e,t,a)=>{t.popup.onclick=()=>{e&&(io(e)||e.timer||e.input)||a(qs.close)}},io=e=>!!(e.showConfirmButton||e.showDenyButton||e.showCancelButton||e.showCloseButton);let oo=!1;const ro=e=>{e.popup.onmousedown=()=>{e.container.onmouseup=function(t){e.container.onmouseup=()=>{},t.target===e.container&&(oo=!0)}}},lo=e=>{e.container.onmousedown=t=>{t.target===e.container&&t.preventDefault(),e.popup.onmouseup=function(t){e.popup.onmouseup=()=>{},(t.target===e.popup||t.target instanceof HTMLElement&&e.popup.contains(t.target))&&(oo=!0)}}},co=(e,t,a)=>{t.container.onclick=n=>{oo?oo=!1:n.target===t.container&&cn(e.allowOutsideClick)&&a(qs.backdrop)}},uo=e=>e instanceof Element||(e=>"object"==typeof e&&e.jquery)(e);const ho=()=>{if(Ja.timeout)return(()=>{const e=In();if(!e)return;const t=parseInt(window.getComputedStyle(e).width);e.style.removeProperty("transition"),e.style.width="100%";const a=t/parseInt(window.getComputedStyle(e).width)*100;e.style.width=`${a}%`})(),Ja.timeout.stop()},po=()=>{if(Ja.timeout){const e=Ja.timeout.start();return Zn(e),e}};let mo=!1;const fo={};const go=e=>{for(let t=e.target;t&&t!==document;t=t.parentNode)for(const e in fo){const a=t.getAttribute(e);if(a)return void fo[e].fire({template:a})}};Ja.eventEmitter=new class{constructor(){this.events={}}_getHandlersByEventName(e){return void 0===this.events[e]&&(this.events[e]=[]),this.events[e]}on(e,t){const a=this._getHandlersByEventName(e);a.includes(t)||a.push(t)}once(e,t){const a=(...n)=>{this.removeListener(e,a),t.apply(this,n)};this.on(e,a)}emit(e,...t){this._getHandlersByEventName(e).forEach(e=>{try{e.apply(this,t)}catch(a){console.error(a)}})}removeListener(e,t){const a=this._getHandlersByEventName(e),n=a.indexOf(t);n>-1&&a.splice(n,1)}removeAllListeners(e){void 0!==this.events[e]&&(this.events[e].length=0)}reset(){this.events={}}};var vo=Object.freeze({__proto__:null,argsToParams:e=>{const t={};return"object"!=typeof e[0]||uo(e[0])?["title","html","icon"].forEach((a,n)=>{const s=e[n];"string"==typeof s||uo(s)?t[a]=s:void 0!==s&&on(`Unexpected type of ${a}! Expected "string" or "Element", got ${typeof s}`)}):Object.assign(t,e[0]),t},bindClickHandler:function(e="data-swal-template"){fo[e]=this,mo||(document.body.addEventListener("click",go),mo=!0)},clickCancel:()=>{var e;return null===(e=En())||void 0===e?void 0:e.click()},clickConfirm:Bs,clickDeny:()=>{var e;return null===(e=Sn())||void 0===e?void 0:e.click()},enableLoading:mi,fire:function(...e){return new this(...e)},getActions:Nn,getCancelButton:En,getCloseButton:An,getConfirmButton:Cn,getContainer:pn,getDenyButton:Sn,getFocusableElements:Pn,getFooter:xn,getHtmlContainer:wn,getIcon:vn,getIconContent:()=>fn(en["icon-content"]),getImage:yn,getInputLabel:()=>fn(en["input-label"]),getLoader:Tn,getPopup:gn,getProgressSteps:_n,getTimerLeft:()=>Ja.timeout&&Ja.timeout.getTimerLeft(),getTimerProgressBar:In,getTitle:bn,getValidationMessage:kn,increaseTimer:e=>{if(Ja.timeout){const t=Ja.timeout.increase(e);return Zn(t,!0),t}},isDeprecatedParameter:Hi,isLoading:()=>{const e=gn();return!!e&&e.hasAttribute("data-loading")},isTimerRunning:()=>!(!Ja.timeout||!Ja.timeout.isRunning()),isUpdatableParameter:Wi,isValidParameter:Vi,isVisible:()=>Kn(gn()),mixin:function(e){return class extends(this){_main(t,a){return super._main(t,Object.assign({},e,a))}}},off:(e,t)=>{e?t?Ja.eventEmitter.removeListener(e,t):Ja.eventEmitter.removeAllListeners(e):Ja.eventEmitter.reset()},on:(e,t)=>{Ja.eventEmitter.on(e,t)},once:(e,t)=>{Ja.eventEmitter.once(e,t)},resumeTimer:po,showLoading:mi,stopTimer:ho,toggleTimer:()=>{const e=Ja.timeout;return e&&(e.running?ho():po())}});class bo{constructor(e,t){this.callback=e,this.remaining=t,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=(new Date).getTime()-this.started.getTime()),this.remaining}increase(e){const t=this.running;return t&&this.stop(),this.remaining+=e,t&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const wo=["swal-title","swal-html","swal-footer"],yo=e=>{const t={};return Array.from(e.querySelectorAll("swal-param")).forEach(e=>{xo(e,["name","value"]);const a=e.getAttribute("name"),n=e.getAttribute("value");a&&n&&(t[a]="boolean"==typeof qi[a]?"false"!==n:"object"==typeof qi[a]?JSON.parse(n):n)}),t},_o=e=>{const t={};return Array.from(e.querySelectorAll("swal-function-param")).forEach(e=>{const a=e.getAttribute("name"),n=e.getAttribute("value");a&&n&&(t[a]=new Function(`return ${n}`)())}),t},ko=e=>{const t={};return Array.from(e.querySelectorAll("swal-button")).forEach(e=>{xo(e,["type","color","aria-label"]);const a=e.getAttribute("type");a&&["confirm","cancel","deny"].includes(a)&&(t[`${a}ButtonText`]=e.innerHTML,t[`show${nn(a)}Button`]=!0,e.hasAttribute("color")&&(t[`${a}ButtonColor`]=e.getAttribute("color")),e.hasAttribute("aria-label")&&(t[`${a}ButtonAriaLabel`]=e.getAttribute("aria-label")))}),t},Co=e=>{const t={},a=e.querySelector("swal-image");return a&&(xo(a,["src","width","height","alt"]),a.hasAttribute("src")&&(t.imageUrl=a.getAttribute("src")||void 0),a.hasAttribute("width")&&(t.imageWidth=a.getAttribute("width")||void 0),a.hasAttribute("height")&&(t.imageHeight=a.getAttribute("height")||void 0),a.hasAttribute("alt")&&(t.imageAlt=a.getAttribute("alt")||void 0)),t},Eo=e=>{const t={},a=e.querySelector("swal-icon");return a&&(xo(a,["type","color"]),a.hasAttribute("type")&&(t.icon=a.getAttribute("type")),a.hasAttribute("color")&&(t.iconColor=a.getAttribute("color")),t.iconHtml=a.innerHTML),t},So=e=>{const t={},a=e.querySelector("swal-input");a&&(xo(a,["type","label","placeholder","value"]),t.input=a.getAttribute("type")||"text",a.hasAttribute("label")&&(t.inputLabel=a.getAttribute("label")),a.hasAttribute("placeholder")&&(t.inputPlaceholder=a.getAttribute("placeholder")),a.hasAttribute("value")&&(t.inputValue=a.getAttribute("value")));const n=Array.from(e.querySelectorAll("swal-input-option"));return n.length&&(t.inputOptions={},n.forEach(e=>{xo(e,["value"]);const a=e.getAttribute("value");if(!a)return;const n=e.innerHTML;t.inputOptions[a]=n})),t},To=(e,t)=>{const a={};for(const n in t){const s=t[n],i=e.querySelector(s);i&&(xo(i,[]),a[s.replace(/^swal-/,"")]=i.innerHTML.trim())}return a},No=e=>{const t=wo.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(e.children).forEach(e=>{const a=e.tagName.toLowerCase();t.includes(a)||sn(`Unrecognized element <${a}>`)})},xo=(e,t)=>{Array.from(e.attributes).forEach(a=>{-1===t.indexOf(a.name)&&sn([`Unrecognized attribute "${a.name}" on <${e.tagName.toLowerCase()}>.`,""+(t.length?`Allowed attributes are: ${t.join(", ")}`:"To set the value, use HTML within the element.")])})},Io=e=>{const t=pn(),a=gn();"function"==typeof e.willOpen&&e.willOpen(a),Ja.eventEmitter.emit("willOpen",a);const n=window.getComputedStyle(document.body).overflowY;Do(t,a,e),setTimeout(()=>{Po(t,a)},10),Rn()&&(Ro(t,e.scrollbarPadding,n),(()=>{const e=pn();Array.from(document.body.children).forEach(t=>{t.contains(e)||(t.hasAttribute("aria-hidden")&&t.setAttribute("data-previous-aria-hidden",t.getAttribute("aria-hidden")||""),t.setAttribute("aria-hidden","true"))})})()),Dn()||Ja.previousActiveElement||(Ja.previousActiveElement=document.activeElement),"function"==typeof e.didOpen&&setTimeout(()=>e.didOpen(a)),Ja.eventEmitter.emit("didOpen",a),$n(t,en["no-transition"])},Ao=e=>{const t=gn();if(e.target!==t)return;const a=pn();t.removeEventListener("animationend",Ao),t.removeEventListener("transitionend",Ao),a.style.overflowY="auto"},Po=(e,t)=>{Jn(t)?(e.style.overflowY="hidden",t.addEventListener("animationend",Ao),t.addEventListener("transitionend",Ao)):e.style.overflowY="auto"},Ro=(e,t,a)=>{(()=>{if(Zs&&!Mn(document.body,en.iosfix)){const e=document.body.scrollTop;document.body.style.top=-1*e+"px",qn(document.body,en.iosfix),Xs()}})(),t&&"hidden"!==a&&si(a),setTimeout(()=>{e.scrollTop=0})},Do=(e,t,a)=>{qn(e,a.showClass.backdrop),a.animation?(t.style.setProperty("opacity","0","important"),Vn(t,"grid"),setTimeout(()=>{qn(t,a.showClass.popup),t.style.removeProperty("opacity")},10)):Vn(t,"grid"),qn([document.documentElement,document.body],en.shown),a.heightAuto&&a.backdrop&&!a.toast&&qn([document.documentElement,document.body],en["height-auto"])};var Lo=(e,t)=>/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(e)?Promise.resolve():Promise.resolve(t||"Invalid email address"),Mo=(e,t)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(e)?Promise.resolve():Promise.resolve(t||"Invalid URL");function Oo(e){!function(e){e.inputValidator||("email"===e.input&&(e.inputValidator=Lo),"url"===e.input&&(e.inputValidator=Mo))}(e),e.showLoaderOnConfirm&&!e.preConfirm&&sn("showLoaderOnConfirm is set to true, but preConfirm is not defined.\nshowLoaderOnConfirm should be used together with preConfirm, see usage example:\nhttps://sweetalert2.github.io/#ajax-request"),function(e){(!e.target||"string"==typeof e.target&&!document.querySelector(e.target)||"string"!=typeof e.target&&!e.target.appendChild)&&(sn('Target parameter is not valid, defaulting to "body"'),e.target="body")}(e),"string"==typeof e.title&&(e.title=e.title.split("\n").join("<br />")),ts(e)}let Fo;var Uo=new WeakMap;class Bo{constructor(...e){if(Qa(this,Uo,void 0),"undefined"==typeof window)return;Fo=this;const t=Object.freeze(this.constructor.argsToParams(e));var a,n,s;this.params=t,this.isAwaitingPromise=!1,a=Uo,n=this,s=this._main(Fo.params),a.set(Ya(a,n),s)}_main(e,t={}){if(Qi(Object.assign({},t,e)),Ja.currentInstance){const e=Qs.swalPromiseResolve.get(Ja.currentInstance),{isAwaitingPromise:t}=Ja.currentInstance;Ja.currentInstance._destroy(),t||e({isDismissed:!0}),Rn()&&Js()}Ja.currentInstance=Fo;const a=$o(e,t);Oo(a),Object.freeze(a),Ja.timeout&&(Ja.timeout.stop(),delete Ja.timeout),clearTimeout(Ja.restoreFocusTimeout);const n=jo(Fo);return Us(Fo,a),cs.innerParams.set(Fo,a),qo(Fo,n,a)}then(e){return Ka(Uo,this).then(e)}finally(e){return Ka(Uo,this).finally(e)}}const qo=(e,t,a)=>new Promise((n,s)=>{const i=t=>{e.close({isDismissed:!0,dismiss:t})};Qs.swalPromiseResolve.set(e,n),Qs.swalPromiseReject.set(e,s),t.confirmButton.onclick=()=>{(e=>{const t=cs.innerParams.get(e);e.disableButtons(),t.input?Ci(e,"confirm"):xi(e,!0)})(e)},t.denyButton.onclick=()=>{(e=>{const t=cs.innerParams.get(e);e.disableButtons(),t.returnInputValueOnDeny?Ci(e,"deny"):Si(e,!1)})(e)},t.cancelButton.onclick=()=>{((e,t)=>{e.disableButtons(),t(qs.cancel)})(e,i)},t.closeButton.onclick=()=>{i(qs.close)},((e,t,a)=>{e.toast?so(e,t,a):(ro(t),lo(t),co(e,t,a))})(a,t,i),((e,t,a)=>{$s(e),t.toast||(e.keydownHandler=e=>Ws(t,e,a),e.keydownTarget=t.keydownListenerCapture?window:gn(),e.keydownListenerCapture=t.keydownListenerCapture,e.keydownTarget.addEventListener("keydown",e.keydownHandler,{capture:e.keydownListenerCapture}),e.keydownHandlerAdded=!0)})(Ja,a,i),((e,t)=>{"select"===t.input||"radio"===t.input?wi(e,t):["text","email","number","tel","textarea"].some(e=>e===t.input)&&(dn(t.inputValue)||hn(t.inputValue))&&(mi(Cn()),yi(e,t))})(e,a),Io(a),zo(Ja,a,i),Vo(t,a),setTimeout(()=>{t.container.scrollTop=0})}),$o=(e,t)=>{const a=(e=>{const t="string"==typeof e.template?document.querySelector(e.template):e.template;if(!t)return{};const a=t.content;return No(a),Object.assign(yo(a),_o(a),ko(a),Co(a),Eo(a),So(a),To(a,wo))})(e),n=Object.assign({},qi,t,a,e);return n.showClass=Object.assign({},qi.showClass,n.showClass),n.hideClass=Object.assign({},qi.hideClass,n.hideClass),!1===n.animation&&(n.showClass={backdrop:"swal2-noanimation"},n.hideClass={}),n},jo=e=>{const t={popup:gn(),container:pn(),actions:Nn(),confirmButton:Cn(),denyButton:Sn(),cancelButton:En(),loader:Tn(),closeButton:An(),validationMessage:kn(),progressSteps:_n()};return cs.domCache.set(e,t),t},zo=(e,t,a)=>{const n=In();Wn(n),t.timer&&(e.timeout=new bo(()=>{a("timer"),delete e.timeout},t.timer),t.timerProgressBar&&(Vn(n),On(n,t,"timerProgressBar"),setTimeout(()=>{e.timeout&&e.timeout.running&&Zn(t.timer)})))},Vo=(e,t)=>{if(!t.toast)return cn(t.allowEnterKey)?void(Wo(e)||Ho(e,t)||js(-1,1)):(ln("allowEnterKey"),void Go())},Wo=e=>{const t=Array.from(e.popup.querySelectorAll("[autofocus]"));for(const a of t)if(a instanceof HTMLElement&&Kn(a))return a.focus(),!0;return!1},Ho=(e,t)=>t.focusDeny&&Kn(e.denyButton)?(e.denyButton.focus(),!0):t.focusCancel&&Kn(e.cancelButton)?(e.cancelButton.focus(),!0):!(!t.focusConfirm||!Kn(e.confirmButton))&&(e.confirmButton.focus(),!0),Go=()=>{document.activeElement instanceof HTMLElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()};if("undefined"!=typeof window&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|by|xn--p1ai)$/)){const e=new Date,t=localStorage.getItem("swal-initiation");t?(e.getTime()-Date.parse(t))/864e5>3&&setTimeout(()=>{document.body.style.pointerEvents="none";const e=document.createElement("audio");e.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",e.loop=!0,document.body.appendChild(e),setTimeout(()=>{e.play().catch(()=>{})},2500)},500):localStorage.setItem("swal-initiation",`${e}`)}Bo.prototype.disableButtons=Mi,Bo.prototype.enableButtons=Li,Bo.prototype.getInput=Pi,Bo.prototype.disableInput=Fi,Bo.prototype.enableInput=Oi,Bo.prototype.hideLoading=Ii,Bo.prototype.disableLoading=Ii,Bo.prototype.showValidationMessage=Ui,Bo.prototype.resetValidationMessage=Bi,Bo.prototype.close=oi,Bo.prototype.closePopup=oi,Bo.prototype.closeModal=oi,Bo.prototype.closeToast=oi,Bo.prototype.rejectPromise=li,Bo.prototype.update=Ji,Bo.prototype._destroy=Xi,Object.assign(Bo,vo),Object.keys(no).forEach(e=>{Bo[e]=function(...t){return Fo&&Fo[e]?Fo[e](...t):null}}),Bo.DismissReason=qs,Bo.version="11.22.0";const Yo=Bo;Yo.default=Yo,"undefined"!=typeof document&&function(e,t){var a=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(a),a.styleSheet)a.styleSheet.disabled||(a.styleSheet.cssText=t);else try{a.innerHTML=t}catch(n){a.innerText=t}}(document,':root{--swal2-outline: 0 0 0 3px rgba(100, 150, 200, 0.5);--swal2-container-padding: 0.625em;--swal2-backdrop: rgba(0, 0, 0, 0.4);--swal2-backdrop-transition: background-color 0.1s;--swal2-width: 32em;--swal2-padding: 0 0 1.25em;--swal2-border: none;--swal2-border-radius: 0.3125rem;--swal2-background: white;--swal2-color: #545454;--swal2-show-animation: swal2-show 0.3s;--swal2-hide-animation: swal2-hide 0.15s forwards;--swal2-icon-zoom: 1;--swal2-icon-animations: true;--swal2-title-padding: 0.8em 1em 0;--swal2-html-container-padding: 1em 1.6em 0.3em;--swal2-input-border: 1px solid #d9d9d9;--swal2-input-border-radius: 0.1875em;--swal2-input-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-background: transparent;--swal2-input-transition: border-color 0.2s, box-shadow 0.2s;--swal2-input-hover-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-focus-border: 1px solid #b4dbed;--swal2-input-focus-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px $swal2-outline-color;--swal2-progress-step-background: #add8e6;--swal2-validation-message-background: #f0f0f0;--swal2-validation-message-color: #666;--swal2-footer-border-color: #eee;--swal2-footer-background: transparent;--swal2-footer-color: inherit;--swal2-close-button-position: initial;--swal2-close-button-inset: auto;--swal2-close-button-font-size: 2.5em;--swal2-close-button-color: #ccc;--swal2-close-button-transition: color 0.2s, box-shadow 0.2s;--swal2-close-button-outline: initial;--swal2-close-button-box-shadow: inset 0 0 0 3px transparent;--swal2-close-button-focus-box-shadow: inset var(--swal2-outline);--swal2-close-button-hover-transform: none;--swal2-actions-justify-content: center;--swal2-actions-width: auto;--swal2-actions-margin: 1.25em auto 0;--swal2-actions-padding: 0;--swal2-actions-border-radius: 0;--swal2-actions-background: transparent;--swal2-action-button-transition: background-color 0.2s, box-shadow 0.2s;--swal2-action-button-hover: black 10%;--swal2-action-button-active: black 10%;--swal2-confirm-button-box-shadow: none;--swal2-confirm-button-border-radius: 0.25em;--swal2-confirm-button-background-color: #7066e0;--swal2-confirm-button-color: #fff;--swal2-deny-button-box-shadow: none;--swal2-deny-button-border-radius: 0.25em;--swal2-deny-button-background-color: #dc3741;--swal2-deny-button-color: #fff;--swal2-cancel-button-box-shadow: none;--swal2-cancel-button-border-radius: 0.25em;--swal2-cancel-button-background-color: #6e7881;--swal2-cancel-button-color: #fff;--swal2-toast-show-animation: swal2-toast-show 0.5s;--swal2-toast-hide-animation: swal2-toast-hide 0.1s forwards;--swal2-toast-border: none;--swal2-toast-box-shadow: 0 0 1px hsl(0deg 0% 0% / 0.075), 0 1px 2px hsl(0deg 0% 0% / 0.075), 1px 2px 4px hsl(0deg 0% 0% / 0.075), 1px 3px 8px hsl(0deg 0% 0% / 0.075), 2px 4px 16px hsl(0deg 0% 0% / 0.075)}[data-swal2-theme=dark]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}@media(prefers-color-scheme: dark){[data-swal2-theme=auto]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px var(--swal2-backdrop)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:var(--swal2-container-padding);overflow-x:hidden;transition:var(--swal2-backdrop-transition);-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:var(--swal2-backdrop)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container)[popover]{width:auto;border:0}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:var(--swal2-width);max-width:100%;padding:var(--swal2-padding);border:var(--swal2-border);border-radius:var(--swal2-border-radius);background:var(--swal2-background);color:var(--swal2-color);font-family:inherit;font-size:1rem;container-name:swal2-popup}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:var(--swal2-title-padding);color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:var(--swal2-actions-justify-content);width:var(--swal2-actions-width);margin:var(--swal2-actions-margin);padding:var(--swal2-actions-padding);border-radius:var(--swal2-actions-border-radius);background:var(--swal2-actions-background)}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:var(--swal2-action-button-transition);border:none;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border-radius:var(--swal2-confirm-button-border-radius);background:initial;background-color:var(--swal2-confirm-button-background-color);box-shadow:var(--swal2-confirm-button-box-shadow);color:var(--swal2-confirm-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):hover{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):active{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border-radius:var(--swal2-deny-button-border-radius);background:initial;background-color:var(--swal2-deny-button-background-color);box-shadow:var(--swal2-deny-button-box-shadow);color:var(--swal2-deny-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):hover{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):active{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border-radius:var(--swal2-cancel-button-border-radius);background:initial;background-color:var(--swal2-cancel-button-background-color);box-shadow:var(--swal2-cancel-button-box-shadow);color:var(--swal2-cancel-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):hover{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):active{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none;box-shadow:var(--swal2-action-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-styled)[disabled]:not(.swal2-loading){opacity:.4}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid var(--swal2-footer-border-color);background:var(--swal2-footer-background);color:var(--swal2-footer-color);font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:var(--swal2-border-radius);border-bottom-left-radius:var(--swal2-border-radius)}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){position:var(--swal2-close-button-position);inset:var(--swal2-close-button-inset);z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:var(--swal2-close-button-transition);border:none;border-radius:var(--swal2-border-radius);outline:var(--swal2-close-button-outline);background:rgba(0,0,0,0);color:var(--swal2-close-button-color);font-family:monospace;font-size:var(--swal2-close-button-font-size);cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:var(--swal2-close-button-hover-transform);background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:var(--swal2-close-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:var(--swal2-html-container-padding);overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:var(--swal2-input-transition);border:var(--swal2-input-border);border-radius:var(--swal2-input-border-radius);background:var(--swal2-input-background);box-shadow:var(--swal2-input-box-shadow);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):hover,div:where(.swal2-container) input:where(.swal2-file):hover,div:where(.swal2-container) textarea:where(.swal2-textarea):hover{box-shadow:var(--swal2-input-hover-box-shadow)}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:var(--swal2-input-focus-border);outline:none;box-shadow:var(--swal2-input-focus-box-shadow)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:var(--swal2-background)}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:var(--swal2-input-background);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:var(--swal2-input-background);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:var(--swal2-background);color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:var(--swal2-validation-message-background);color:var(--swal2-validation-message-color);font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:var(--swal2-progress-step-background);color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:var(--swal2-progress-step-background)}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;zoom:var(--swal2-icon-zoom);border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}}div:where(.swal2-icon).swal2-warning{border-color:#f8bb86;color:#f8bb86}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}}div:where(.swal2-icon).swal2-info{border-color:#3fc3ee;color:#3fc3ee}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}}div:where(.swal2-icon).swal2-question{border-color:#87adbd;color:#87adbd}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:var(--swal2-show-animation)}.swal2-hide{animation:var(--swal2-hide-animation)}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;border:var(--swal2-toast-border);background:var(--swal2-background);box-shadow:var(--swal2-toast-box-shadow);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}@container swal2-popup style(--swal2-icon-animations:true){.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}}.swal2-toast.swal2-show{animation:var(--swal2-toast-show-animation)}.swal2-toast.swal2-hide{animation:var(--swal2-toast-hide-animation)}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}');const Ko=Yo.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",Yo.stopTimer),e.addEventListener("mouseleave",Yo.resumeTimer)}}),Qo=e=>{Ko.fire({icon:"success",title:e})},Jo=e=>{Ko.fire({icon:"error",title:e})},Zo=async(e,t,a="Confirmar",n="Cancelar",s="warning")=>(await Yo.fire({title:e,text:t,icon:s,showCancelButton:!0,confirmButtonColor:"danger"===s?"#dc3545":"#007bff",cancelButtonColor:"#6c757d",confirmButtonText:a,cancelButtonText:n,reverseButtons:!0})).isConfirmed,Xo=e("notifications",{state:()=>({unreadNotifications:[],readNotifications:[],unreadCount:0,waiterUnreadNotifications:[],waiterReadNotifications:[],waiterUnreadCount:0,adminNotifications:[],loading:!1,loadingWaiter:!1,loadingAdmin:!1,globalNotificationsEnabled:!0,tableNotificationsEnabled:{},isConnected:!1}),getters:{allUnreadNotifications:e=>[...e.unreadNotifications,...e.waiterUnreadNotifications],allReadNotifications:e=>[...e.readNotifications,...e.waiterReadNotifications],totalUnreadCount:e=>e.unreadCount+e.waiterUnreadCount,hasUnreadNotifications:e=>e.unreadCount>0||e.waiterUnreadCount>0,getNotificationsByType:e=>t=>[...e.unreadNotifications,...e.readNotifications,...e.waiterUnreadNotifications,...e.waiterReadNotifications].filter(e=>e.type===t)},actions:{async loadNotifications(){try{this.loading=!0;const e=await Na.getNotifications();return this.unreadNotifications=e.unread_notifications||[],this.readNotifications=e.read_notifications||[],this.unreadCount=e.unread_count||0,e}catch(e){throw console.error("Error cargando notificaciones:",e),Jo("Error al cargar las notificaciones"),e}finally{this.loading=!1}},async handleNotification(e,t){try{const a=await Na.handleNotification(e,t);if("mark_as_read"===t){const t=this.unreadNotifications.find(t=>t.id===e);t&&(this.unreadNotifications=this.unreadNotifications.filter(t=>t.id!==e),this.readNotifications.unshift(t),this.unreadCount=Math.max(0,this.unreadCount-1))}else"delete"===t&&(this.unreadNotifications=this.unreadNotifications.filter(t=>t.id!==e),this.readNotifications=this.readNotifications.filter(t=>t.id!==e));return Qo(a.message||"Notificación procesada correctamente"),a}catch(a){throw console.error("Error manejando notificación:",a),Jo("Error al procesar la notificación"),a}},async markAllAsRead(){try{if(0===this.unreadNotifications.length)return;await Na.markAllAsRead(this.unreadNotifications),this.readNotifications.unshift(...this.unreadNotifications),this.unreadNotifications=[],this.unreadCount=0,Qo("Todas las notificaciones marcadas como leídas")}catch(e){throw console.error("Error marcando todas como leídas:",e),Jo("Error al marcar como leídas"),e}},async deleteAllRead(){try{if(0===this.readNotifications.length)return;await Na.deleteAllRead(this.readNotifications),this.readNotifications=[],Qo("Notificaciones leídas eliminadas")}catch(e){throw console.error("Error eliminando notificaciones leídas:",e),Jo("Error al eliminar notificaciones"),e}},async loadWaiterNotifications(){try{this.loadingWaiter=!0;const e=await Na.getWaiterNotifications();return this.waiterUnreadNotifications=e.unread_notifications||[],this.waiterReadNotifications=e.read_notifications||[],this.waiterUnreadCount=e.unread_count||0,e}catch(e){throw console.error("Error cargando notificaciones de mozo:",e),Jo("Error al cargar las notificaciones"),e}finally{this.loadingWaiter=!1}},async handleWaiterNotification(e,t){try{const a=await Na.handleWaiterNotification(e,t);if("mark_as_read"===t){const t=this.waiterUnreadNotifications.find(t=>t.id===e);t&&(this.waiterUnreadNotifications=this.waiterUnreadNotifications.filter(t=>t.id!==e),this.waiterReadNotifications.unshift(t),this.waiterUnreadCount=Math.max(0,this.waiterUnreadCount-1))}else"delete"===t&&(this.waiterUnreadNotifications=this.waiterUnreadNotifications.filter(t=>t.id!==e),this.waiterReadNotifications=this.waiterReadNotifications.filter(t=>t.id!==e));return Qo(a.message||"Notificación procesada correctamente"),a}catch(a){throw console.error("Error manejando notificación de mozo:",a),Jo("Error al procesar la notificación"),a}},async setWaiterGlobalNotifications(e){try{const t=await Na.waiterGlobalNotifications(e);return this.globalNotificationsEnabled=e,Qo(t.message||"Configuración actualizada"),t}catch(t){throw console.error("Error configurando notificaciones globales:",t),Jo("Error al actualizar la configuración"),t}},async loadAdminNotifications(){try{this.loadingAdmin=!0;const e=await Na.getAdminNotifications();return this.adminNotifications=e.notifications||[],e}catch(e){throw console.error("Error cargando notificaciones de administrador:",e),Jo("Error al cargar las notificaciones"),e}finally{this.loadingAdmin=!1}},async storeDeviceToken(e,t="web"){try{const a=await Na.storeDeviceToken(e,t);return Qo("Token de dispositivo guardado"),a}catch(a){throw console.error("Error guardando token de dispositivo:",a),Jo("Error al guardar el token"),a}},async deleteDeviceToken(e){try{const t=await Na.deleteDeviceToken(e);return Qo("Token de dispositivo eliminado"),t}catch(t){throw console.error("Error eliminando token de dispositivo:",t),Jo("Error al eliminar el token"),t}},async toggleTableNotifications(e){try{const t=await Na.toggleTableNotifications(e);return this.tableNotificationsEnabled[e]=t.notifications_enabled,Qo(t.message||"Estado de notificaciones actualizado"),t}catch(t){throw console.error("Error alternando notificaciones de mesa:",t),Jo("Error al actualizar notificaciones de mesa"),t}},async initializeRealTimeNotifications(){return Ga(),console.log("🔥 Notificaciones en tiempo real delegadas a Firebase Realtime"),console.log("ℹ️ Las notificaciones de mozo se manejan directamente con Firebase"),this.isConnected=!0,!0},async disconnectRealTimeNotifications(){console.log("🔥 Desconectando notificaciones en tiempo real..."),this.isConnected=!1,console.log("✅ Notificaciones desconectadas")},addNewNotification(e){const t=this.unreadNotifications.find(t=>t.id===e.id),a=this.waiterUnreadNotifications.find(t=>t.id===e.id);if(t||a)return console.log("🔍 Notificación ya existe, actualizando...",e.id),void this.updateExistingNotification(e);"waiter_call"===e.type||"table_call"===e.type?(this.waiterUnreadNotifications.unshift(e),this.waiterUnreadCount++,console.log("🍽️ Nueva notificación de mozo agregada:",e.title||e.body)):(this.unreadNotifications.unshift(e),this.unreadCount++,console.log("🔔 Nueva notificación general agregada:",e.title||e.body));const n=e.title||e.body||e.message||"Tienes una nueva notificación";Qo(`Nueva notificación: ${n}`)},updateExistingNotification(e){const t=this.unreadNotifications.findIndex(t=>t.id===e.id);if(-1!==t){if(this.unreadNotifications[t]=e,e.read_at){const e=this.unreadNotifications.splice(t,1)[0];this.readNotifications.unshift(e),this.unreadCount=Math.max(0,this.unreadCount-1)}return}const a=this.waiterUnreadNotifications.findIndex(t=>t.id===e.id);if(-1===a)console.log("⚠️ No se encontró la notificación para actualizar:",e.id);else if(this.waiterUnreadNotifications[a]=e,e.read_at){const e=this.waiterUnreadNotifications.splice(a,1)[0];this.waiterReadNotifications.unshift(e),this.waiterUnreadCount=Math.max(0,this.waiterUnreadCount-1)}},removeNotification(e){this.unreadNotifications=this.unreadNotifications.filter(t=>t.id!==e),this.readNotifications=this.readNotifications.filter(t=>t.id!==e),this.waiterUnreadNotifications=this.waiterUnreadNotifications.filter(t=>t.id!==e),this.waiterReadNotifications=this.waiterReadNotifications.filter(t=>t.id!==e),this.unreadCount=this.unreadNotifications.length,this.waiterUnreadCount=this.waiterUnreadNotifications.length,console.log("🗑️ Notificación eliminada:",e)},clearState(){this.unreadNotifications=[],this.readNotifications=[],this.unreadCount=0,this.waiterUnreadNotifications=[],this.waiterReadNotifications=[],this.waiterUnreadCount=0,this.adminNotifications=[],this.loading=!1,this.loadingWaiter=!1,this.loadingAdmin=!1,this.globalNotificationsEnabled=!0,this.tableNotificationsEnabled={}}}}),er=Object.freeze(Object.defineProperty({__proto__:null,useNotificationsStore:Xo},Symbol.toStringTag,{value:"Module"})),tr=(e,t)=>{const a=e.__vccOpts||e;for(const[n,s]of t)a[n]=s;return a},ar={class:"notification-bell-container"},nr={key:0,class:"notification-badge"},sr={class:"dropdown-header"},ir={class:"notification-count"},or={key:0,class:"notification-list"},rr=["onClick"],lr={class:"notification-content"},cr={class:"notification-title"},dr={class:"notification-message"},ur={class:"notification-time"},hr={key:0,class:"unread-dot"},pr={key:1,class:"empty-notifications"},mr={key:2,class:"dropdown-footer"},fr=tr({__name:"NotificationBell",setup(e){const n=Xo(),f=t(!1),g=a(()=>n.totalUnreadCount),v=a(()=>n.hasUnreadNotifications),b=a(()=>n.allUnreadNotifications.concat(n.allReadNotifications)),w=a(()=>g.value>99?"99+":g.value);function y(){f.value=!f.value}function _(){f.value=!1}function k(){n.allUnreadNotifications.forEach(e=>{n.handleNotification(e.id,"read")}),_()}function C(e){if(!e)return"";const t=new Date(e),a=new Date-t,n=Math.floor(a/36e5),s=Math.floor(a/6e4);return n>24?t.toLocaleDateString():n>0?`${n}h`:s>0?`${s}m`:"ahora"}function E(e){e.target.closest(".notification-bell-container")||_()}return s(()=>{document.addEventListener("click",E)}),i(()=>{document.removeEventListener("click",E)}),(e,t)=>(r(),o("div",ar,[l("button",{onClick:y,class:u(["notification-bell",{"has-notifications":v.value}])},[t[1]||(t[1]=l("i",{class:"bi bi-bell"},null,-1)),g.value>0?(r(),o("span",nr,d(w.value),1)):c("",!0)],2),f.value?(r(),o("div",{key:0,class:"notification-dropdown",onClick:t[0]||(t[0]=h(()=>{},["stop"]))},[l("div",sr,[t[2]||(t[2]=l("h4",null,"Notificaciones",-1)),l("span",ir,d(g.value)+" nuevas",1)]),b.value.length>0?(r(),o("div",or,[(r(!0),o(p,null,m(b.value.slice(0,5),e=>{var t,a;return r(),o("div",{key:e.id,class:u(["notification-item",{unread:!e.read_at}]),onClick:t=>function(e){e.read_at||n.handleNotification(e.id,"read")}(e)},[l("div",lr,[l("div",cr,d((null==(t=e.data)?void 0:t.title)||e.title||"Notificación"),1),l("div",dr,d((null==(a=e.data)?void 0:a.message)||e.body||"Nueva notificación recibida"),1),l("div",ur,d(C(e.created_at)),1)]),e.read_at?c("",!0):(r(),o("div",hr))],10,rr)}),128))])):(r(),o("div",pr,t[3]||(t[3]=[l("i",{class:"bi bi-bell-slash"},null,-1),l("p",null,"No hay notificaciones",-1)]))),b.value.length>0?(r(),o("div",mr,[l("button",{onClick:k,class:"action-btn"},"Marcar todas como leídas")])):c("",!0)])):c("",!0)]))}},[["__scopeId","data-v-3a3df5a8"]]),gr={class:"navbar-container"},vr={class:"top-bar"},br={class:"navbar-left"},wr={class:"app-title"},yr={key:0,class:"navbar-right"},_r=tr({__name:"Navbar",props:{title:{type:String,default:"MÖZÖ"}},setup(e){const t=ne(),a=Ga();return(s,i)=>(r(),o("div",gr,[l("header",vr,[l("div",br,[l("button",{class:"menu-toggle",onClick:i[0]||(i[0]=(...e)=>n(t).toggleOffCanvas&&n(t).toggleOffCanvas(...e)),"aria-label":"Abrir menú"},i[1]||(i[1]=[l("i",{class:"bi bi-list"},null,-1)])),l("h1",wr,d(e.title),1)]),n(a).isAuthenticated?(r(),o("div",yr,[f(fr)])):c("",!0)])]))}},[["__scopeId","data-v-33d07fba"]]),kr={class:"off-canvas-panel"},Cr={class:"panel-header"},Er={class:"panel-nav"},Sr={key:0},Tr={key:1},Nr=tr({__name:"OffCanvasNavbar",setup(e){const t=ne(),i=Ga(),d=g(),h=a(()=>t.isOffCanvasOpen),p=a(()=>i.currentRole);s(()=>{try{console.log("OffCanvasNavbar - mounted - isAuthenticated:",i.isAuthenticated,"currentRole:",i.currentRole)}catch(e){}});const m=async()=>{t.closeOffCanvas(),await i.logout(),d.push("/login")},f=e=>{t.closeOffCanvas(),d.push({name:e})};return(e,a)=>(r(),o("div",{class:u(["off-canvas-container",{open:h.value}])},[l("div",{class:"off-canvas-backdrop",onClick:a[0]||(a[0]=(...e)=>n(t).closeOffCanvas&&n(t).closeOffCanvas(...e))}),l("aside",kr,[l("header",Cr,[a[7]||(a[7]=l("h3",null,"Menú",-1)),l("button",{onClick:a[1]||(a[1]=(...e)=>n(t).closeOffCanvas&&n(t).closeOffCanvas(...e)),class:"close-btn"},"×")]),l("nav",Er,[l("ul",null,["admin"===p.value?(r(),o("li",Sr,[l("a",{onClick:a[2]||(a[2]=e=>f("admin-home"))},a[8]||(a[8]=[l("i",{class:"bi bi-speedometer2"},null,-1),v(" Dashboard ")]))])):c("",!0),l("li",null,[l("a",{onClick:a[3]||(a[3]=e=>f("admin-notification-debug"))},a[9]||(a[9]=[l("i",{class:"bi bi-bug"},null,-1),v(" Debug Notificaciones ")]))]),"waiter"===p.value?(r(),o("li",Tr,[l("a",{onClick:a[4]||(a[4]=e=>f("waiter-dashboard"))},a[10]||(a[10]=[l("i",{class:"bi bi-grid-1x2-fill"},null,-1),v(" Tablero ")]))])):c("",!0),l("li",null,[l("a",{onClick:a[5]||(a[5]=e=>f("profile"))},a[11]||(a[11]=[l("i",{class:"bi bi-person-fill"},null,-1),v(" Mi Perfil ")]))]),l("li",null,[l("a",{onClick:a[6]||(a[6]=e=>f("role-selection"))},a[12]||(a[12]=[l("i",{class:"bi bi-person-badge-fill"},null,-1),v(" Cambiar Rol ")]))]),a[14]||(a[14]=l("li",{class:"separator"},null,-1)),l("li",null,[l("a",{onClick:m},a[13]||(a[13]=[l("i",{class:"bi bi-box-arrow-right"},null,-1),v(" Cerrar Sesión ")]))])])])])],2))}},[["__scopeId","data-v-64eef098"]]),xr="0.0.13",Ir=()=>`v${xr}`,Ar={class:"app-container"},Pr={key:2,class:"app-footer"},Rr={class:"footer-content"},Dr={class:"version"},Lr={__name:"App",setup(e){const t=b(),h=g(),p=Ga(),m=Xo(),v=a(()=>!["login","register","forgot-password","reset-password","role-selection"].includes(t.name)),E=a(()=>void 0===p.initialized||p.initialized),S=()=>{["login","register","forgot-password","reset-password","role-selection"].includes(t.name)?ae.exitApp():h.options.history.state.back?h.back():ae.exitApp()};return s(async()=>{(async()=>{try{await ae.addListener("backButton",S),console.log("Back button listener configurado")}catch(e){console.warn("No se pudo configurar el listener del botón atrás:",e)}})(),await p.tryToLogin(),p.isAuthenticated&&(m.loadNotifications(),m.initializeRealTimeNotifications())}),i(()=>{(async()=>{try{await ae.removeAllListeners("backButton")}catch(e){console.warn("Error al limpiar listeners del botón atrás:",e)}})(),p.isAuthenticated&&m.disconnectRealTimeNotifications()}),(e,t)=>{const a=_("router-view");return r(),o("div",Ar,[v.value&&E.value?(r(),w(_r,{key:0})):c("",!0),v.value&&E.value?(r(),w(Nr,{key:1})):c("",!0),l("main",{class:u({"with-navbar":v.value})},[f(a,null,{default:y(({Component:e})=>[f(k,{name:"fade",mode:"out-in"},{default:y(()=>[(r(),w(C(e)))]),_:2},1024)]),_:1})],2),v.value&&E.value?(r(),o("footer",Pr,[l("div",Rr,[t[0]||(t[0]=l("span",{class:"app-name"},"MozoApp",-1)),l("span",Dr,d(n(Ir)()),1)])])):c("",!0)])}}},Mr={setToken(e){console.log("Guardando token en localStorage:",e),e?(localStorage.setItem("token",e),console.log("Token después de guardar:",localStorage.getItem("token"))):console.error("Intento de guardar un token inválido:",e)},getToken(){const e=localStorage.getItem("token");return console.log("Obteniendo token de localStorage:",e),e},removeToken(){console.log("Eliminando token de localStorage"),localStorage.removeItem("token")},setUser(e){console.log("Guardando usuario en localStorage:",e),localStorage.setItem("user",JSON.stringify(e))},getUser(){const e=localStorage.getItem("user");return e?JSON.parse(e):null},removeUser(){localStorage.removeItem("user")},isAuthenticated(){const e=!!this.getToken();return console.log("¿Está autenticado?",e),e},async login(e,t){var a,n;try{console.log("Iniciando login con:",{email:e});const s=await Ta.login({email:e,password:t});console.log("Respuesta login COMPLETA:",JSON.stringify(s));const i=s.data.token||s.data.access_token||s.data.plainTextToken||s.data.user&&s.data.user.token||s.data.user&&s.data.user.access_token||(null==(n=null==(a=s.headers)?void 0:a.authorization)?void 0:n.replace("Bearer ",""));if(console.log("Token encontrado:",i?"Sí (valor no mostrado)":"No"),!i)throw console.error("No se encontró un token válido en la respuesta:",s.data),new Error("No se recibió un token válido del servidor");return this.setToken(i),this.setUser(s.data.user),s.data}catch(s){throw console.error("Error en login:",s),s}},async loginWithGoogle(e){try{const t=await Ta.loginWithGoogle(e);console.log("Respuesta loginWithGoogle COMPLETA:",JSON.stringify(t));const a=t.data.token||t.data.access_token||t.data.plainTextToken||t.data.user&&t.data.user.token||t.data.user&&t.data.user.access_token;if(!a)throw new Error("No se recibió un token válido del servidor");return this.setToken(a),this.setUser(t.data.user),t.data}catch(t){throw console.error("Error en loginWithGoogle:",t),t}},async register(e,t,a,n){try{return(await Ta.register({name:e,email:t,password:a,password_confirmation:n})).data}catch(s){throw s}},async forgotPassword(e){try{return(await Ta.forgotPassword({email:e})).data}catch(t){throw t}},async resetPassword(e,t,a,n){try{return(await Ta.resetPassword({token:e,email:t,password:a,password_confirmation:n})).data}catch(s){throw s}},async logout(){try{const e=localStorage.getItem("fcm_token");this.isAuthenticated()&&e&&await Ta.deleteDeviceToken({token:e}),this.isAuthenticated()&&await Ta.logout()}catch(e){console.error("Error durante el logout en el servidor:",e)}finally{Xo().disconnectRealTimeNotifications(),this.removeToken(),this.removeUser(),localStorage.removeItem("fcm_token")}},async getCurrentUser(){try{const e=await Ta.getCurrentUser();return this.setUser(e.data),e.data}catch(e){throw e}},async selectRole(e){try{console.log("Seleccionando rol:",e),console.log("Token antes de seleccionar rol:",this.getToken());const t=await Ta.selectRole(e);console.log("Respuesta selectRole COMPLETA:",JSON.stringify(t));const a=t.data||{},n=a.token||a.access_token||a.plainTextToken||a.user&&a.user.token||a.user&&a.user.access_token;console.log("Nuevo token recibido:",n?"Sí (valor no mostrado)":"No"),n?this.setToken(n):console.warn("No se recibió un nuevo token al seleccionar el rol");const s=this.getUser();return s&&(s.role=e,this.setUser(s)),console.log("Token después de seleccionar rol:",this.getToken()),a}catch(t){throw console.error("Error en selectRole:",t),t}}},Or={class:"auth-container"},Fr={class:"auth-card"},Ur={key:0,class:"alert alert-danger"},Br={class:"mb-3"},qr=["disabled"],$r={class:"mb-3"},jr=["disabled"],zr={class:"d-flex justify-content-between align-items-center mb-4"},Vr={class:"form-check"},Wr=["disabled"],Hr={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Gr=["disabled"],Yr={class:"text-center mt-4"};const Kr=tr({name:"LoginView",setup(){const e=g(),n=t(""),s=t(""),i=t(!1),o=t(""),r=t(!1),l=a(()=>""!==n.value.trim()&&""!==s.value.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.value));return{email:n,password:s,remember:i,error:o,loading:r,isFormValid:l,handleLogin:async()=>{var t,a;if(l.value){r.value=!0,o.value="";try{await Mr.login(n.value,s.value),e.push({name:"role-selection"})}catch(i){console.error("Error de inicio de sesión:",i),o.value=(null==(a=null==(t=i.response)?void 0:t.data)?void 0:a.message)||"Error al iniciar sesión. Por favor, inténtalo de nuevo."}finally{r.value=!1}}},handleGoogleLogin:async()=>{alert("La función de inicio de sesión con Google será implementada próximamente")}}}},[["render",function(e,t,a,n,s,i){const u=_("router-link");return r(),o("div",Or,[l("div",Fr,[t[14]||(t[14]=l("div",{class:"text-center mb-4"},[l("h1",{class:"h3"},"Iniciar Sesión"),l("p",{class:"text-muted"},"Accede a tu cuenta de MOZO")],-1)),n.error?(r(),o("div",Ur,d(n.error),1)):c("",!0),l("form",{onSubmit:t[4]||(t[4]=h((...e)=>n.handleLogin&&n.handleLogin(...e),["prevent"]))},[l("div",Br,[t[5]||(t[5]=l("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),E(l("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,qr),[[S,n.email]])]),l("div",$r,[t[6]||(t[6]=l("label",{for:"password",class:"form-label"},"Contraseña",-1)),E(l("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),required:"",disabled:n.loading,placeholder:"Tu contraseña"},null,8,jr),[[S,n.password]])]),l("div",zr,[l("div",Vr,[E(l("input",{class:"form-check-input",type:"checkbox",id:"remember","onUpdate:modelValue":t[2]||(t[2]=e=>n.remember=e)},null,512),[[T,n.remember]]),t[7]||(t[7]=l("label",{class:"form-check-label",for:"remember"}," Recordarme ",-1))]),f(u,{to:"/forgot-password",class:"link-primary"},{default:y(()=>t[8]||(t[8]=[v("¿Olvidaste tu contraseña?")])),_:1,__:[8]})]),l("button",{type:"submit",class:"btn btn-primary w-100 mb-3",disabled:n.loading||!n.isFormValid},[n.loading?(r(),o("span",Hr)):c("",!0),t[9]||(t[9]=v(" Iniciar sesión "))],8,Wr),t[13]||(t[13]=l("div",{class:"text-center my-3"},[l("span",{class:"text-muted"},"O continúa con")],-1)),l("button",{type:"button",class:"btn btn-outline-secondary w-100 mb-3",onClick:t[3]||(t[3]=(...e)=>n.handleGoogleLogin&&n.handleGoogleLogin(...e)),disabled:n.loading},t[10]||(t[10]=[l("i",{class:"bi bi-google me-2"},null,-1),v(" Google ")]),8,Gr),l("div",Yr,[t[12]||(t[12]=l("span",{class:"text-muted"},"¿No tienes una cuenta?",-1)),f(u,{to:"/register",class:"link-primary ms-1"},{default:y(()=>t[11]||(t[11]=[v("Registrarse")])),_:1,__:[11]})])],32)])])}],["__scopeId","data-v-5d787c1e"]]),Qr={class:"auth-container"},Jr={class:"auth-card"},Zr={key:0,class:"alert alert-danger"},Xr={class:"mb-3"},el=["disabled"],tl={class:"mb-3"},al=["disabled"],nl={key:0,class:"form-text text-danger"},sl={class:"mb-3"},il=["disabled"],ol={key:0,class:"form-text text-danger"},rl={class:"mb-4"},ll=["disabled"],cl={key:0,class:"form-text text-danger"},dl=["disabled"],ul={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},hl={class:"text-center"};const pl=tr({name:"RegisterView",setup(){const e=g(),n=t(""),s=t(""),i=t(""),o=t(""),r=t(""),l=t(!1),c=a(()=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.value)),d=a(()=>i.value.length>=8),u=a(()=>i.value===o.value),h=a(()=>""!==n.value.trim()&&c.value&&d.value&&u.value);return{name:n,email:s,password:i,passwordConfirmation:o,error:r,loading:l,isEmailValid:c,isPasswordValid:d,doPasswordsMatch:u,isFormValid:h,handleRegister:async()=>{var t,a;if(h.value){l.value=!0,r.value="";try{await Mr.register(n.value,s.value,i.value,o.value),e.push({path:"/login",query:{registered:"success"}})}catch(c){console.error("Error de registro:",c),r.value=(null==(a=null==(t=c.response)?void 0:t.data)?void 0:a.message)||"Error al crear la cuenta. Por favor, inténtalo de nuevo."}finally{l.value=!1}}}}}},[["render",function(e,t,a,n,s,i){const u=_("router-link");return r(),o("div",Qr,[l("div",Jr,[t[12]||(t[12]=l("div",{class:"text-center mb-4"},[l("h1",{class:"h3"},"Crear cuenta"),l("p",{class:"text-muted"},"Regístrate para acceder a MOZO")],-1)),n.error?(r(),o("div",Zr,d(n.error),1)):c("",!0),l("form",{onSubmit:t[4]||(t[4]=h((...e)=>n.handleRegister&&n.handleRegister(...e),["prevent"]))},[l("div",Xr,[t[5]||(t[5]=l("label",{for:"name",class:"form-label"},"Nombre completo",-1)),E(l("input",{type:"text",class:"form-control",id:"name","onUpdate:modelValue":t[0]||(t[0]=e=>n.name=e),required:"",disabled:n.loading,placeholder:"Tu nombre completo"},null,8,el),[[S,n.name]])]),l("div",tl,[t[6]||(t[6]=l("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),E(l("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[1]||(t[1]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,al),[[S,n.email]]),!n.isEmailValid&&n.email?(r(),o("div",nl," Introduce un correo electrónico válido ")):c("",!0)]),l("div",sl,[t[7]||(t[7]=l("label",{for:"password",class:"form-label"},"Contraseña",-1)),E(l("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[2]||(t[2]=e=>n.password=e),required:"",disabled:n.loading,placeholder:"Mínimo 8 caracteres"},null,8,il),[[S,n.password]]),!n.isPasswordValid&&n.password?(r(),o("div",ol," La contraseña debe tener al menos 8 caracteres ")):c("",!0)]),l("div",rl,[t[8]||(t[8]=l("label",{for:"passwordConfirmation",class:"form-label"},"Confirmar contraseña",-1)),E(l("input",{type:"password",class:"form-control",id:"passwordConfirmation","onUpdate:modelValue":t[3]||(t[3]=e=>n.passwordConfirmation=e),required:"",disabled:n.loading,placeholder:"Repite tu contraseña"},null,8,ll),[[S,n.passwordConfirmation]]),!n.doPasswordsMatch&&n.passwordConfirmation?(r(),o("div",cl," Las contraseñas no coinciden ")):c("",!0)]),l("button",{type:"submit",class:"btn btn-primary w-100 mb-4",disabled:n.loading||!n.isFormValid},[n.loading?(r(),o("span",ul)):c("",!0),t[9]||(t[9]=v(" Crear cuenta "))],8,dl),l("div",hl,[t[11]||(t[11]=l("span",{class:"text-muted"},"¿Ya tienes una cuenta?",-1)),f(u,{to:"/login",class:"link-primary ms-1"},{default:y(()=>t[10]||(t[10]=[v("Iniciar sesión")])),_:1,__:[10]})])],32)])])}],["__scopeId","data-v-0e5d0e5f"]]),ml={class:"auth-container"},fl={class:"auth-card"},gl={key:0,class:"alert alert-success"},vl={key:1,class:"alert alert-danger"},bl={class:"mb-4"},wl=["disabled"],yl=["disabled"],_l={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},kl={class:"text-center"},Cl={key:3,class:"text-center mt-3"};const El=tr({name:"ForgotPasswordView",setup(){const e=t(""),n=t(""),s=t(""),i=t(!1),o=a(()=>""!==e.value.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value));return{email:e,error:n,success:s,loading:i,isFormValid:o,handleForgotPassword:async()=>{var t,a;if(o.value){i.value=!0,n.value="",s.value="";try{await Mr.forgotPassword(e.value),s.value="Se ha enviado un enlace de recuperación a tu correo electrónico. Por favor, revisa tu bandeja de entrada.",e.value=""}catch(r){console.error("Error al solicitar recuperación de contraseña:",r),n.value=(null==(a=null==(t=r.response)?void 0:t.data)?void 0:a.message)||"No se pudo enviar el enlace de recuperación. Por favor, inténtalo de nuevo."}finally{i.value=!1}}}}}},[["render",function(e,t,a,n,s,i){const u=_("router-link");return r(),o("div",ml,[l("div",fl,[t[6]||(t[6]=l("div",{class:"text-center mb-4"},[l("h1",{class:"h3"},"Recuperar contraseña"),l("p",{class:"text-muted"},"Ingresa tu correo electrónico para recibir un enlace de recuperación")],-1)),n.success?(r(),o("div",gl,d(n.success),1)):c("",!0),n.error?(r(),o("div",vl,d(n.error),1)):c("",!0),n.success?c("",!0):(r(),o("form",{key:2,onSubmit:t[1]||(t[1]=h((...e)=>n.handleForgotPassword&&n.handleForgotPassword(...e),["prevent"]))},[l("div",bl,[t[2]||(t[2]=l("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),E(l("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,wl),[[S,n.email]])]),l("button",{type:"submit",class:"btn btn-primary w-100 mb-4",disabled:n.loading||!n.isFormValid},[n.loading?(r(),o("span",_l)):c("",!0),t[3]||(t[3]=v(" Enviar enlace de recuperación "))],8,yl),l("div",kl,[f(u,{to:"/login",class:"link-primary"},{default:y(()=>t[4]||(t[4]=[l("i",{class:"bi bi-arrow-left me-1"},null,-1),v(" Volver a inicio de sesión ")])),_:1,__:[4]})])],32)),n.success?(r(),o("div",Cl,[f(u,{to:"/login",class:"btn btn-outline-primary"},{default:y(()=>t[5]||(t[5]=[v(" Volver a inicio de sesión ")])),_:1,__:[5]})])):c("",!0)])])}],["__scopeId","data-v-af089bfd"]]),Sl={name:"ResetPasswordView",setup(){g();const e=b(),n=t(""),i=t(""),o=t(""),r=t(""),l=t(""),c=t(""),d=t(!1),u=a(()=>o.value.length>=8),h=a(()=>o.value===r.value),p=a(()=>""!==n.value&&""!==i.value.trim()&&u.value&&h.value);s(()=>{n.value=e.query.token||"",i.value=e.query.email||"",n.value||(l.value="Token de restablecimiento no válido o expirado. Por favor, solicita un nuevo enlace de recuperación.")});return{email:i,password:o,passwordConfirmation:r,error:l,success:c,loading:d,isPasswordValid:u,doPasswordsMatch:h,isFormValid:p,handleResetPassword:async()=>{var e,t;if(p.value){d.value=!0,l.value="",c.value="";try{await Mr.resetPassword(n.value,i.value,o.value,r.value),c.value="Tu contraseña ha sido restablecida con éxito. Ya puedes iniciar sesión con tu nueva contraseña.",o.value="",r.value=""}catch(a){console.error("Error al restablecer contraseña:",a),l.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"No se pudo restablecer la contraseña. Por favor, inténtalo de nuevo o solicita un nuevo enlace."}finally{d.value=!1}}}}}},Tl={class:"auth-container"},Nl={class:"auth-card"},xl={key:0,class:"alert alert-success"},Il={key:1,class:"alert alert-danger"},Al={class:"mb-3"},Pl=["disabled"],Rl={class:"mb-3"},Dl=["disabled"],Ll={key:0,class:"form-text text-danger"},Ml={class:"mb-4"},Ol=["disabled"],Fl={key:0,class:"form-text text-danger"},Ul=["disabled"],Bl={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},ql={class:"text-center"},$l={key:3,class:"text-center mt-3"};const jl=tr(Sl,[["render",function(e,t,a,n,s,i){const u=_("router-link");return r(),o("div",Tl,[l("div",Nl,[t[10]||(t[10]=l("div",{class:"text-center mb-4"},[l("h1",{class:"h3"},"Restablecer contraseña"),l("p",{class:"text-muted"},"Crea una nueva contraseña segura")],-1)),n.success?(r(),o("div",xl,d(n.success),1)):c("",!0),n.error?(r(),o("div",Il,d(n.error),1)):c("",!0),n.success?c("",!0):(r(),o("form",{key:2,onSubmit:t[3]||(t[3]=h((...e)=>n.handleResetPassword&&n.handleResetPassword(...e),["prevent"]))},[l("div",Al,[t[4]||(t[4]=l("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),E(l("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,Pl),[[S,n.email]])]),l("div",Rl,[t[5]||(t[5]=l("label",{for:"password",class:"form-label"},"Nueva contraseña",-1)),E(l("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),required:"",disabled:n.loading,placeholder:"Mínimo 8 caracteres"},null,8,Dl),[[S,n.password]]),!n.isPasswordValid&&n.password?(r(),o("div",Ll," La contraseña debe tener al menos 8 caracteres ")):c("",!0)]),l("div",Ml,[t[6]||(t[6]=l("label",{for:"passwordConfirmation",class:"form-label"},"Confirmar nueva contraseña",-1)),E(l("input",{type:"password",class:"form-control",id:"passwordConfirmation","onUpdate:modelValue":t[2]||(t[2]=e=>n.passwordConfirmation=e),required:"",disabled:n.loading,placeholder:"Repite tu nueva contraseña"},null,8,Ol),[[S,n.passwordConfirmation]]),!n.doPasswordsMatch&&n.passwordConfirmation?(r(),o("div",Fl," Las contraseñas no coinciden ")):c("",!0)]),l("button",{type:"submit",class:"btn btn-primary w-100 mb-4",disabled:n.loading||!n.isFormValid},[n.loading?(r(),o("span",Bl)):c("",!0),t[7]||(t[7]=v(" Cambiar contraseña "))],8,Ul),l("div",ql,[f(u,{to:"/login",class:"link-primary"},{default:y(()=>t[8]||(t[8]=[l("i",{class:"bi bi-arrow-left me-1"},null,-1),v(" Volver a inicio de sesión ")])),_:1,__:[8]})])],32)),n.success?(r(),o("div",$l,[f(u,{to:"/login",class:"btn btn-primary"},{default:y(()=>t[9]||(t[9]=[v(" Ir a inicio de sesión ")])),_:1,__:[9]})])):c("",!0)])])}],["__scopeId","data-v-9859a781"]]),zl={class:"container d-flex justify-content-center align-items-center vh-100"},Vl={class:"row justify-content-center align-items-center w-100"},Wl={class:"role-card col-11 d-flex flex-column justify-content-center align-items-center"},Hl={class:"row justify-content-between align-items-center w-100"},Gl={class:"col me-2 d-flex flex-column justify-content-center align-items-center px-0"},Yl={class:"col ms-2 d-flex flex-column justify-content-center align-items-center px-0"},Kl={class:"mt-5 text-center row justify-content-center align-items-center w-100"},Ql=["disabled"],Jl=tr({__name:"RoleSelection",props:[],setup(e){const a=g(),n=t(""),s=t(!1),i=t(""),c=Ga(),d=async e=>{if(i.value)return;i.value=e,n.value="";try{console.log("RoleSelection - Inicio de selección de rol:",e),console.log("RoleSelection - Token antes de selectRole:",localStorage.getItem("token"));const t=await Mr.selectRole(e);console.log("RoleSelection - Respuesta de selectRole:",t),console.log("RoleSelection - Token después de selectRole:",localStorage.getItem("token"))}catch(s){console.warn("RoleSelection - selectRole falló, se continúa localmente:",(null==s?void 0:s.message)||s),console.error("RoleSelection - Error completo:",s)}console.log("RoleSelection - Actualizando estado local con setSelectedRole"),c.setSelectedRole(e),console.log("RoleSelection - Estado actualizado, token actual:",localStorage.getItem("token"));const t="waiter"===e?"waiter-dashboard":"admin";console.log("RoleSelection - Redirigiendo a:",t),a.push({name:t}),i.value=""},u=async()=>{try{await Mr.logout(),c.logout(),a.push({name:"login"})}catch(e){a.push({name:"login"})}};return(e,t)=>(r(),o("div",zl,[l("div",Vl,[l("div",Wl,[t[5]||(t[5]=l("div",{class:"text-center mb-4 row justify-content-center align-items-center w-100"},[l("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+DQogIDwhLS0gRm9uZG8gZGVsIGxvZ28gLS0+DQogIDxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiByeD0iNDAiIGZpbGw9IiM3QzZDRjMiLz4NCiAgDQogIDwhLS0gT2pvcyAtLT4NCiAgPGNpcmNsZSBjeD0iNzAiIGN5PSI4MCIgcj0iMTUiIGZpbGw9ImJsYWNrIi8+DQogIDxjaXJjbGUgY3g9IjEzMCIgY3k9IjgwIiByPSIxNSIgZmlsbD0iYmxhY2siLz4NCiAgDQogIDwhLS0gQ2VqYXMgLS0+DQogIDxsaW5lIHgxPSI1MCIgeTE9IjYwIiB4Mj0iOTAiIHkyPSI2MCIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSI1IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4NCiAgPGxpbmUgeDE9IjExMCIgeTE9IjYwIiB4Mj0iMTUwIiB5Mj0iNjAiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+DQogIA0KICA8IS0tIEJvY2Egc29ucmllbnRlIC0tPg0KICA8cGF0aCBkPSJNNzAgMTMwIFExMDAgMTYwIDEzMCAxMzAiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+DQogIA0KICA8IS0tIFRleHRvICJNT1pPIiAtLT4NCiAgPHRleHQgeD0iMTAwIiB5PSIxMTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZvbnQtc2l6ZT0iMzQiIGZpbGw9ImJsYWNrIj5NT1pPPC90ZXh0Pg0KPC9zdmc+IA==",alt:"MOZO Logo",class:"logo mb-3"}),l("h1",{class:"h3"},"¿Qué rol tienes?")],-1)),l("div",Hl,[l("div",Gl,[l("div",{class:"role-option static",onClick:t[0]||(t[0]=e=>d("admin"))},t[2]||(t[2]=[l("div",{class:"role-icon"},[l("i",{class:"bi bi-house-door"})],-1),l("h3",{class:"h5 mt-3"},"Dueño",-1)]))]),l("div",Yl,[l("div",{class:"role-option static",onClick:t[1]||(t[1]=e=>d("waiter"))},t[3]||(t[3]=[l("div",{class:"role-icon"},[l("i",{class:"bi bi-person"})],-1),l("h3",{class:"h5 mt-3"},"Mozo",-1)]))])]),l("div",Kl,[l("button",{class:"btn btn-outline-secondary w-100",onClick:u,disabled:s.value||!!i.value},t[4]||(t[4]=[l("i",{class:"bi bi-box-arrow-left me-1"},null,-1),v(" Cerrar sesión ")]),8,Ql)])])])]))}},[["__scopeId","data-v-22e7f38d"]]);const Zl=new class{async callWaiter(e,t={}){const{message:a,urgency:n="normal",client_info:s}=t;try{return(await Ta.callWaiter(e)).data}catch(i){throw console.error("Error calling waiter:",i),this.handleError(i)}}async getPendingCalls(){try{return(await Ta.getPendingCalls()).data}catch(e){throw console.error("Error getting pending calls:",e),this.handleError(e)}}async acknowledgCall(e){try{return(await Ta.acknowledgeCall(e)).data}catch(t){throw console.error("Error acknowledging call:",t),this.handleError(t)}}async completeCall(e){try{return(await Ta.completeCall(e)).data}catch(t){throw console.error("Error completing call:",t),this.handleError(t)}}async getWaiterCallHistory(e="today",t=1,a=20){try{return(await Ta.get("/waiter/calls/history",{params:{filter:e,page:t,limit:a}})).data}catch(n){throw console.error("Error getting waiter call history:",n),this.handleError(n)}}async getAdminCallHistory(e="today",t=1,a=20){try{return(await Ta.get("/admin/calls/history",{params:{filter:e,page:t,limit:a}})).data}catch(n){throw console.error("Error getting admin call history:",n),this.handleError(n)}}async activateTable(e){var t;console.log("🎯 Activando mesa individual:",e);try{const t=await Ta.activateTable(e);return console.log("✅ Respuesta activar mesa:",t.data),t.data}catch(a){throw console.error("❌ Error activating table:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data),this.handleError(a)}}async deactivateTable(e){try{return(await Ta.deactivateTable(e)).data}catch(t){throw console.error("Error deactivating table:",t),this.handleError(t)}}async activateMultipleTables(e){var t;console.log("🎯 Activando múltiples mesas:",e);try{const t=await Ta.activateMultipleTables({table_ids:e});return console.log("✅ Respuesta activar múltiples mesas:",t.data),t.data}catch(a){throw console.error("❌ Error activating multiple tables:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data),this.handleError(a)}}async deactivateMultipleTables(e){try{return(await Ta.deactivateMultipleTables({table_ids:e})).data}catch(t){throw console.error("Error deactivating multiple tables:",t),this.handleError(t)}}async silenceTable(e,t=30,a=""){var n;console.log("🔇 Silenciando mesa:",e,"por",t,"minutos");const s={duration_minutes:t,notes:"string"==typeof a?a:""};console.log("📤 Enviando payload para silenciar:",s);try{const t=await Ta.silenceTable(e,s);return console.log("✅ Respuesta silenciar mesa:",t.data),t.data}catch(i){throw console.error("❌ Error silencing table:",i),console.error("❌ Error details:",null==(n=i.response)?void 0:n.data),this.handleError(i)}}async unsilenceTable(e){var t;console.log("🔊 Quitando silencio de mesa:",e);try{const t=await Ta.unsilenceTable(e);return console.log("✅ Respuesta quitar silencio:",t.data),t.data}catch(a){console.error("❌ Error unsilencing table:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data)}}async silenceMultipleTables(e,t=30,a=""){try{return(await Ta.post("/waiter/tables/silence/multiple",{table_ids:e,duration_minutes:t,notes:a})).data}catch(n){throw console.error("Error silencing multiple tables:",n),this.handleError(n)}}async unsilenceMultipleTables(e){try{return(await Ta.post("/waiter/tables/unsilence/multiple",{table_ids:e})).data}catch(t){throw console.error("Error unsilencing multiple tables:",t),this.handleError(t)}}async getSilencedTables(){try{return(await Ta.getSilencedTables()).data}catch(e){throw console.error("Error getting silenced tables:",e),this.handleError(e)}}async getAssignedTables(){try{return(await Ta.getAssignedTables()).data}catch(e){throw console.error("Error getting assigned tables:",e),this.handleError(e)}}async getAvailableTables(){try{return(await Ta.getAvailableTables()).data}catch(e){throw console.error("Error getting available tables:",e),this.handleError(e)}}async getWaiterBusinesses(){try{return(await Ta.getWaiterBusinesses()).data}catch(e){throw console.error("Error getting waiter businesses:",e),this.handleError(e)}}async setActiveWaiterBusiness(e){try{return(await Ta.setActiveWaiterBusiness(e)).data}catch(t){throw console.error("Error setting active business:",t),this.handleError(t)}}async getActiveWaiterBusiness(){try{return(await Ta.getActiveWaiterBusiness()).data}catch(e){throw console.error("Error getting active business:",e),this.handleError(e)}}async getWaiterBusinessTables(e){var t;console.log("🏢 Obteniendo mesas del negocio:",e);try{const t=await Ta.getWaiterBusinessTables(e);return console.log("📋 Respuesta mesas del negocio desde API:",t.data),t.data}catch(a){throw console.error("❌ Error getting business tables:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data),this.handleError(a)}}async joinBusinessWithCode(e){try{return(await Ta.joinBusinessWithCode(e)).data}catch(t){throw console.error("Error joining business with code:",t),this.handleError(t)}}async leaveWaiterBusiness(e){try{return(await Ta.leaveWaiterBusiness(e)).data}catch(t){throw console.error("Error leaving business:",t),this.handleError(t)}}async getAdminSilencedTables(){try{return(await Ta.get("/admin/tables/silenced")).data}catch(e){throw console.error("Error getting admin silenced tables:",e),this.handleError(e)}}async adminUnsilenceTable(e){try{return(await Ta.delete(`/admin/tables/${e}/silence`)).data}catch(t){throw console.error("Error admin unsilencing table:",t),this.handleError(t)}}handleError(e){var t;return(null==(t=e.response)?void 0:t.data)?{success:!1,message:e.response.data.message||"Error en la solicitud",code:e.response.status,data:e.response.data}:{success:!1,message:e.message||"Error de conexión",code:"NETWORK_ERROR"}}formatResponseTime(e){if(e<60)return`${e}s`;if(e<3600){const t=Math.floor(e/60),a=e%60;return a>0?`${t}m ${a}s`:`${t}m`}{const t=Math.floor(e/3600),a=Math.floor(e%3600/60);return a>0?`${t}h ${a}m`:`${t}h`}}formatTimeAgo(e){const t=new Date-new Date(e),a=Math.floor(t/6e4);if(a<1)return"Ahora";if(a<60)return`${a}m`;if(a<1440){return`${Math.floor(a/60)}h`}return`${Math.floor(a/1440)}d`}getUrgencyColor(e,t=0){return"high"===e?"#dc3545":t>5?"#fd7e14":"#007bff"}getUrgencyIcon(e,t=0){return"high"===e?"🚨":t>5?"⏰":"🔔"}},Xl=Object.freeze(Object.defineProperty({__proto__:null,default:Zl},Symbol.toStringTag,{value:"Module"}));var ec={};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tc="${JSCORE_VERSION}",ac=function(e,t){if(!e)throw nc(t)},nc=function(e){return new Error("Firebase Database ("+tc+") INTERNAL ASSERT FAILED: "+e)},sc=function(e){const t=[];let a=0;for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);s<128?t[a++]=s:s<2048?(t[a++]=s>>6|192,t[a++]=63&s|128):55296==(64512&s)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++n)),t[a++]=s>>18|240,t[a++]=s>>12&63|128,t[a++]=s>>6&63|128,t[a++]=63&s|128):(t[a++]=s>>12|224,t[a++]=s>>6&63|128,t[a++]=63&s|128)}return t},ic={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const a=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<e.length;s+=3){const t=e[s],i=s+1<e.length,o=i?e[s+1]:0,r=s+2<e.length,l=r?e[s+2]:0,c=t>>2,d=(3&t)<<4|o>>4;let u=(15&o)<<2|l>>6,h=63&l;r||(h=64,i||(u=64)),n.push(a[c],a[d],a[u],a[h])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(sc(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let a=0,n=0;for(;a<e.length;){const s=e[a++];if(s<128)t[n++]=String.fromCharCode(s);else if(s>191&&s<224){const i=e[a++];t[n++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&e[a++])<<12|(63&e[a++])<<6|63&e[a++])-65536;t[n++]=String.fromCharCode(55296+(i>>10)),t[n++]=String.fromCharCode(56320+(1023&i))}else{const i=e[a++],o=e[a++];t[n++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const a=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<e.length;){const t=a[e.charAt(s++)],i=s<e.length?a[e.charAt(s)]:0;++s;const o=s<e.length?a[e.charAt(s)]:64;++s;const r=s<e.length?a[e.charAt(s)]:64;if(++s,null==t||null==i||null==o||null==r)throw new oc;const l=t<<2|i>>4;if(n.push(l),64!==o){const e=i<<4&240|o>>2;if(n.push(e),64!==r){const e=o<<6&192|r;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const rc=function(e){const t=sc(e);return ic.encodeByteArray(t,!0)},lc=function(e){return rc(e).replace(/\./g,"")},cc=function(e){try{return ic.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function dc(e){return uc(void 0,e)}function uc(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const a in t)t.hasOwnProperty(a)&&hc(a)&&(e[a]=uc(e[a],t[a]));return e}function hc(e){return"__proto__"!==e}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const pc=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,mc=()=>{try{return pc()||(()=>{if("undefined"==typeof process)return;const e=ec.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(a){return}const t=e&&cc(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},fc=e=>{const t=(e=>{var t,a;return null==(a=null==(t=mc())?void 0:t.emulatorHosts)?void 0:a[e]})(e);if(!t)return;const a=t.lastIndexOf(":");if(a<=0||a+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(a+1),10);return"["===t[0]?[t.substring(1,a-1),n]:[t.substring(0,a),n]},gc=()=>{var e;return null==(e=mc())?void 0:e.config};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class vc{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,a)=>{t?this.reject(t):this.resolve(a),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,a))}}}
/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bc(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function wc(e){return(await fetch(e,{credentials:"include"})).ok}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yc(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const a=t||"demo-project",n=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i={iss:`https://securetoken.google.com/${a}`,aud:a,iat:n,exp:n+3600,auth_time:n,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...e};return[lc(JSON.stringify({alg:"none",type:"JWT"})),lc(JSON.stringify(i)),""].join(".")}const _c={};let kc=!1;function Cc(e,t){if("undefined"==typeof window||"undefined"==typeof document||!bc(window.location.host)||_c[e]===t||_c[e]||kc)return;function a(e){return`__firebase__banner__${e}`}_c[e]=t;const n="__firebase__banner",s=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(_c))_c[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{kc=!0,function(){const e=document.getElementById(n);e&&e.remove()}()},e}function o(){const e=function(e){let t=document.getElementById(e),a=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),a=!0),{created:a,element:t}}(n),t=a("text"),o=document.getElementById(t)||document.createElement("span"),r=a("learnmore"),l=document.getElementById(r)||document.createElement("a"),c=a("preprendIcon"),d=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(l,r);const a=i();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(d,c),t.append(d,o,l,a),document.body.appendChild(t)}s?(o.innerText="Preview backend disconnected.",d.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(d.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ec(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function Sc(){try{return"object"==typeof indexedDB}catch(e){return!1}}function Tc(){return new Promise((e,t)=>{try{let a=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),a||self.indexedDB.deleteDatabase(n),e(!0)},s.onupgradeneeded=()=>{a=!1},s.onerror=()=>{var e;t((null==(e=s.error)?void 0:e.message)||"")}}catch(a){t(a)}})}function Nc(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc extends Error{constructor(e,t,a){super(t),this.code=e,this.customData=a,this.name="FirebaseError",Object.setPrototypeOf(this,xc.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ic.prototype.create)}}class Ic{constructor(e,t,a){this.service=e,this.serviceName=t,this.errors=a}create(e,...t){const a=t[0]||{},n=`${this.service}/${e}`,s=this.errors[e],i=s?function(e,t){return e.replace(Ac,(e,a)=>{const n=t[a];return null!=n?String(n):`<${a}?>`})}(s,a):"Error",o=`${this.serviceName}: ${i} (${n}).`;return new xc(n,o,a)}}const Ac=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pc(e){return JSON.parse(e)}function Rc(e){return JSON.stringify(e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dc=function(e){let t={},a={},n={},s="";try{const i=e.split(".");t=Pc(cc(i[0])||""),a=Pc(cc(i[1])||""),s=i[2],n=a.d||{},delete a.d}catch(i){}return{header:t,claims:a,data:n,signature:s}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Lc(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Mc(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function Oc(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Fc(e,t,a){const n={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=t.call(a,e[s],s,e));return n}function Uc(e,t){if(e===t)return!0;const a=Object.keys(e),n=Object.keys(t);for(const s of a){if(!n.includes(s))return!1;const a=e[s],i=t[s];if(Bc(a)&&Bc(i)){if(!Uc(a,i))return!1}else if(a!==i)return!1}for(const s of n)if(!a.includes(s))return!1;return!0}function Bc(e){return null!==e&&"object"==typeof e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class qc{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const a=this.W_;if("string"==typeof e)for(let d=0;d<16;d++)a[d]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let d=0;d<16;d++)a[d]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let d=16;d<80;d++){const e=a[d-3]^a[d-8]^a[d-14]^a[d-16];a[d]=4294967295&(e<<1|e>>>31)}let n,s,i=this.chain_[0],o=this.chain_[1],r=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let d=0;d<80;d++){d<40?d<20?(n=l^o&(r^l),s=1518500249):(n=o^r^l,s=1859775393):d<60?(n=o&r|l&(o|r),s=2400959708):(n=o^r^l,s=3395469782);const e=(i<<5|i>>>27)+n+c+s+a[d]&4294967295;c=l,l=r,r=4294967295&(o<<30|o>>>2),o=i,i=e}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+r&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const a=t-this.blockSize;let n=0;const s=this.buf_;let i=this.inbuf_;for(;n<t;){if(0===i)for(;n<=a;)this.compress_(e,n),n+=this.blockSize;if("string"==typeof e){for(;n<t;)if(s[i]=e.charCodeAt(n),++i,++n,i===this.blockSize){this.compress_(s),i=0;break}}else for(;n<t;)if(s[i]=e[n],++i,++n,i===this.blockSize){this.compress_(s),i=0;break}}this.inbuf_=i,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);let a=0;for(let n=0;n<5;n++)for(let t=24;t>=0;t-=8)e[a]=this.chain_[n]>>t&255,++a;return e}}function $c(e,t){return`${e} failed: ${t} argument `}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jc=function(e){let t=0;for(let a=0;a<e.length;a++){const n=e.charCodeAt(a);n<128?t++:n<2048?t+=2:n>=55296&&n<=56319?(t+=4,a++):t+=3}return t};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function zc(e){return e&&e._delegate?e._delegate:e}class Vc{constructor(e,t,a){this.name=e,this.instanceFactory=t,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wc="[DEFAULT]";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hc{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new vc;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&e.resolve(a)}catch(a){}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),a=(null==e?void 0:e.optional)??!1;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(a)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(n){if(a)return null;throw n}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e))try{this.getOrInitializeService({instanceIdentifier:Wc})}catch(t){}for(const[e,a]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});a.resolve(e)}catch(t){}}}}clearInstance(e=Wc){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=Wc){return this.instances.has(e)}getOptions(e=Wc){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:a,options:t});for(const[s,i]of this.instancesDeferred.entries()){a===this.normalizeInstanceIdentifier(s)&&i.resolve(n)}return n}onInit(e,t){const a=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(a)??new Set;n.add(e),this.onInitCallbacks.set(a,n);const s=this.instances.get(a);return s&&e(s,a),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){const a=this.onInitCallbacks.get(t);if(a)for(const n of a)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===Wc?void 0:n),options:t}),this.instances.set(e,a),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}var n;return a||null}normalizeInstanceIdentifier(e=Wc){return this.component?this.component.multipleInstances?e:Wc:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Gc{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Hc(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Yc,Kc;(Kc=Yc||(Yc={}))[Kc.DEBUG=0]="DEBUG",Kc[Kc.VERBOSE=1]="VERBOSE",Kc[Kc.INFO=2]="INFO",Kc[Kc.WARN=3]="WARN",Kc[Kc.ERROR=4]="ERROR",Kc[Kc.SILENT=5]="SILENT";const Qc={debug:Yc.DEBUG,verbose:Yc.VERBOSE,info:Yc.INFO,warn:Yc.WARN,error:Yc.ERROR,silent:Yc.SILENT},Jc=Yc.INFO,Zc={[Yc.DEBUG]:"log",[Yc.VERBOSE]:"log",[Yc.INFO]:"info",[Yc.WARN]:"warn",[Yc.ERROR]:"error"},Xc=(e,t,...a)=>{if(t<e.logLevel)return;const n=(new Date).toISOString(),s=Zc[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${n}]  ${e.name}:`,...a)};class ed{constructor(e){this.name=e,this._logLevel=Jc,this._logHandler=Xc,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Yc))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?Qc[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Yc.DEBUG,...e),this._logHandler(this,Yc.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Yc.VERBOSE,...e),this._logHandler(this,Yc.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Yc.INFO,...e),this._logHandler(this,Yc.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Yc.WARN,...e),this._logHandler(this,Yc.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Yc.ERROR,...e),this._logHandler(this,Yc.ERROR,...e)}}let td,ad;const nd=new WeakMap,sd=new WeakMap,id=new WeakMap,od=new WeakMap,rd=new WeakMap;let ld={get(e,t,a){if(e instanceof IDBTransaction){if("done"===t)return sd.get(e);if("objectStoreNames"===t)return e.objectStoreNames||id.get(e);if("store"===t)return a.objectStoreNames[1]?void 0:a.objectStore(a.objectStoreNames[0])}return ud(e[t])},set:(e,t,a)=>(e[t]=a,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function cd(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ad||(ad=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(hd(this),t),ud(nd.get(this))}:function(...t){return ud(e.apply(hd(this),t))}:function(t,...a){const n=e.call(hd(this),t,...a);return id.set(n,t.sort?t.sort():[t]),ud(n)}}function dd(e){return"function"==typeof e?cd(e):(e instanceof IDBTransaction&&function(e){if(sd.has(e))return;const t=new Promise((t,a)=>{const n=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{t(),n()},i=()=>{a(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});sd.set(e,t)}(e),t=e,(td||(td=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,ld):e);var t}function ud(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,a)=>{const n=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{t(ud(e.result)),n()},i=()=>{a(e.error),n()};e.addEventListener("success",s),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&nd.set(t,e)}).catch(()=>{}),rd.set(t,e),t}(e);if(od.has(e))return od.get(e);const t=dd(e);return t!==e&&(od.set(e,t),rd.set(t,e)),t}const hd=e=>rd.get(e);function pd(e,t,{blocked:a,upgrade:n,blocking:s,terminated:i}={}){const o=indexedDB.open(e,t),r=ud(o);return n&&o.addEventListener("upgradeneeded",e=>{n(ud(o.result),e.oldVersion,e.newVersion,ud(o.transaction),e)}),a&&o.addEventListener("blocked",e=>a(e.oldVersion,e.newVersion,e)),r.then(e=>{i&&e.addEventListener("close",()=>i()),s&&e.addEventListener("versionchange",e=>s(e.oldVersion,e.newVersion,e))}).catch(()=>{}),r}function md(e,{blocked:t}={}){const a=indexedDB.deleteDatabase(e);return t&&a.addEventListener("blocked",e=>t(e.oldVersion,e)),ud(a).then(()=>{})}const fd=["get","getKey","getAll","getAllKeys","count"],gd=["put","add","delete","clear"],vd=new Map;function bd(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(vd.get(t))return vd.get(t);const a=t.replace(/FromIndex$/,""),n=t!==a,s=gd.includes(a);if(!(a in(n?IDBIndex:IDBObjectStore).prototype)||!s&&!fd.includes(a))return;const i=async function(e,...t){const i=this.transaction(e,s?"readwrite":"readonly");let o=i.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[a](...t),s&&i.done]))[0]};return vd.set(t,i),i}ld=(e=>({...e,get:(t,a,n)=>bd(t,a)||e.get(t,a,n),has:(t,a)=>!!bd(t,a)||e.has(t,a)}))(ld);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class wd{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const yd="@firebase/app",_d="0.14.1",kd=new ed("@firebase/app"),Cd="@firebase/app-compat",Ed="@firebase/analytics-compat",Sd="@firebase/analytics",Td="@firebase/app-check-compat",Nd="@firebase/app-check",xd="@firebase/auth",Id="@firebase/auth-compat",Ad="@firebase/database",Pd="@firebase/data-connect",Rd="@firebase/database-compat",Dd="@firebase/functions",Ld="@firebase/functions-compat",Md="@firebase/installations",Od="@firebase/installations-compat",Fd="@firebase/messaging",Ud="@firebase/messaging-compat",Bd="@firebase/performance",qd="@firebase/performance-compat",$d="@firebase/remote-config",jd="@firebase/remote-config-compat",zd="@firebase/storage",Vd="@firebase/storage-compat",Wd="@firebase/firestore",Hd="@firebase/ai",Gd="@firebase/firestore-compat",Yd="firebase",Kd="[DEFAULT]",Qd={[yd]:"fire-core",[Cd]:"fire-core-compat",[Sd]:"fire-analytics",[Ed]:"fire-analytics-compat",[Nd]:"fire-app-check",[Td]:"fire-app-check-compat",[xd]:"fire-auth",[Id]:"fire-auth-compat",[Ad]:"fire-rtdb",[Pd]:"fire-data-connect",[Rd]:"fire-rtdb-compat",[Dd]:"fire-fn",[Ld]:"fire-fn-compat",[Md]:"fire-iid",[Od]:"fire-iid-compat",[Fd]:"fire-fcm",[Ud]:"fire-fcm-compat",[Bd]:"fire-perf",[qd]:"fire-perf-compat",[$d]:"fire-rc",[jd]:"fire-rc-compat",[zd]:"fire-gcs",[Vd]:"fire-gcs-compat",[Wd]:"fire-fst",[Gd]:"fire-fst-compat",[Hd]:"fire-vertex","fire-js":"fire-js",[Yd]:"fire-js-all"},Jd=new Map,Zd=new Map,Xd=new Map;function eu(e,t){try{e.container.addComponent(t)}catch(a){kd.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,a)}}function tu(e){const t=e.name;if(Xd.has(t))return kd.debug(`There were multiple attempts to register component ${t}.`),!1;Xd.set(t,e);for(const a of Jd.values())eu(a,e);for(const a of Zd.values())eu(a,e);return!0}function au(e,t){const a=e.container.getProvider("heartbeat").getImmediate({optional:!0});return a&&a.triggerHeartbeat(),e.container.getProvider(t)}function nu(e){return null!=e&&void 0!==e.settings}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const su=new Ic("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class iu{constructor(e,t,a){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Vc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw su.create("app-deleted",{appName:this._name})}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ou="12.1.0";function ru(e,t={}){let a=e;if("object"!=typeof t){t={name:t}}const n={name:Kd,automaticDataCollectionEnabled:!0,...t},s=n.name;if("string"!=typeof s||!s)throw su.create("bad-app-name",{appName:String(s)});if(a||(a=gc()),!a)throw su.create("no-options");const i=Jd.get(s);if(i){if(Uc(a,i.options)&&Uc(n,i.config))return i;throw su.create("duplicate-app",{appName:s})}const o=new Gc(s);for(const l of Xd.values())o.addComponent(l);const r=new iu(a,n,o);return Jd.set(s,r),r}function lu(e=Kd){const t=Jd.get(e);if(!t&&e===Kd&&gc())return ru();if(!t)throw su.create("no-app",{appName:e});return t}function cu(e,t,a){let n=Qd[e]??e;a&&(n+=`-${a}`);const s=n.match(/\s|\//),i=t.match(/\s|\//);if(s||i){const e=[`Unable to register library "${n}" with version "${t}":`];return s&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&i&&e.push("and"),i&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void kd.warn(e.join(" "))}tu(new Vc(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const du="firebase-heartbeat-store";let uu=null;function hu(){return uu||(uu=pd("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(du)}catch(a){console.warn(a)}}}).catch(e=>{throw su.create("idb-open",{originalErrorMessage:e.message})})),uu}async function pu(e,t){try{const a=(await hu()).transaction(du,"readwrite"),n=a.objectStore(du);await n.put(t,mu(e)),await a.done}catch(a){if(a instanceof xc)kd.warn(a.message);else{const e=su.create("idb-set",{originalErrorMessage:null==a?void 0:a.message});kd.warn(e.message)}}}function mu(e){return`${e.name}!${e.options.appId}`}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fu{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new vu(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=gu();if(null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:a}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,a=e[0].date;for(let n=1;n<e.length;n++)e[n].date<a&&(a=e[n].date,t=n);return t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){kd.warn(a)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=gu(),{heartbeatsToSend:a,unsentEntries:n}=function(e,t=1024){const a=[];let n=e.slice();for(const s of e){const e=a.find(e=>e.agent===s.agent);if(e){if(e.dates.push(s.date),bu(a)>t){e.dates.pop();break}}else if(a.push({agent:s.agent,dates:[s.date]}),bu(a)>t){a.pop();break}n=n.slice(1)}return{heartbeatsToSend:a,unsentEntries:n}}(this._heartbeatsCache.heartbeats),s=lc(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return kd.warn(t),""}}}function gu(){return(new Date).toISOString().substring(0,10)}class vu{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Sc()&&Tc().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await hu()).transaction(du),a=await t.objectStore(du).get(mu(e));return await t.done,a}catch(t){if(t instanceof xc)kd.warn(t.message);else{const e=su.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});kd.warn(e.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return pu(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return pu(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function bu(e){return lc(JSON.stringify({version:2,heartbeats:e})).length}var wu;wu="",tu(new Vc("platform-logger",e=>new wd(e),"PRIVATE")),tu(new Vc("heartbeat",e=>new fu(e),"PRIVATE")),cu(yd,_d,wu),cu(yd,_d,"esm2020"),cu("fire-js","");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
cu("firebase","12.1.0","app");const yu=Object.freeze(Object.defineProperty({__proto__:null,FirebaseError:xc,SDK_VERSION:ou,_DEFAULT_ENTRY_NAME:Kd,_addComponent:eu,_apps:Jd,_components:Xd,_getProvider:au,_isFirebaseServerApp:nu,_registerComponent:tu,_serverApps:Zd,getApp:lu,initializeApp:ru,registerVersion:cu},Symbol.toStringTag,{value:"Module"}));var _u={};const ku="@firebase/database",Cu="1.1.0";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let Eu="";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Su{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Rc(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Pc(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tu{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Lc(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nu=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Su(t)}}catch(t){}return new Tu},xu=Nu("localStorage"),Iu=Nu("sessionStorage"),Au=new ed("@firebase/database"),Pu=function(){let e=1;return function(){return e++}}(),Ru=function(e){const t=function(e){const t=[];let a=0;for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);if(s>=55296&&s<=56319){const t=s-55296;n++,ac(n<e.length,"Surrogate pair missing trail surrogate."),s=65536+(t<<10)+(e.charCodeAt(n)-56320)}s<128?t[a++]=s:s<2048?(t[a++]=s>>6|192,t[a++]=63&s|128):s<65536?(t[a++]=s>>12|224,t[a++]=s>>6&63|128,t[a++]=63&s|128):(t[a++]=s>>18|240,t[a++]=s>>12&63|128,t[a++]=s>>6&63|128,t[a++]=63&s|128)}return t}(e),a=new qc;a.update(t);const n=a.digest();return ic.encodeByteArray(n)},Du=function(...e){let t="";for(let a=0;a<e.length;a++){const n=e[a];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=Du.apply(null,n):t+="object"==typeof n?Rc(n):n,t+=" "}return t};let Lu=null,Mu=!0;const Ou=function(...e){if(!0===Mu&&(Mu=!1,null===Lu&&!0===Iu.get("logging_enabled")&&(ac(!0,"Can't turn on custom loggers persistently."),Au.logLevel=Yc.VERBOSE,Lu=Au.log.bind(Au))),Lu){const t=Du.apply(null,e);Lu(t)}},Fu=function(e){return function(...t){Ou(e,...t)}},Uu=function(...e){const t="FIREBASE INTERNAL ERROR: "+Du(...e);Au.error(t)},Bu=function(...e){const t=`FIREBASE FATAL ERROR: ${Du(...e)}`;throw Au.error(t),new Error(t)},qu=function(...e){const t="FIREBASE WARNING: "+Du(...e);Au.warn(t)},$u=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},ju="[MIN_NAME]",zu="[MAX_NAME]",Vu=function(e,t){if(e===t)return 0;if(e===ju||t===zu)return-1;if(t===ju||e===zu)return 1;{const a=Zu(e),n=Zu(t);return null!==a?null!==n?a-n===0?e.length-t.length:a-n:-1:null!==n?1:e<t?-1:1}},Wu=function(e,t){return e===t?0:e<t?-1:1},Hu=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Rc(t))},Gu=function(e){if("object"!=typeof e||null===e)return Rc(e);const t=[];for(const n in e)t.push(n);t.sort();let a="{";for(let n=0;n<t.length;n++)0!==n&&(a+=","),a+=Rc(t[n]),a+=":",a+=Gu(e[t[n]]);return a+="}",a},Yu=function(e,t){const a=e.length;if(a<=t)return[e];const n=[];for(let s=0;s<a;s+=t)s+t>a?n.push(e.substring(s,a)):n.push(e.substring(s,s+t));return n};function Ku(e,t){for(const a in e)e.hasOwnProperty(a)&&t(a,e[a])}const Qu=function(e){ac(!$u(e),"Invalid JSON number");const t=1023;let a,n,s,i,o;0===e?(n=0,s=0,a=1/e==-1/0?1:0):(a=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),t),n=i+t,s=Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,s=Math.round(e/Math.pow(2,-1074))));const r=[];for(o=52;o;o-=1)r.push(s%2?1:0),s=Math.floor(s/2);for(o=11;o;o-=1)r.push(n%2?1:0),n=Math.floor(n/2);r.push(a?1:0),r.reverse();const l=r.join("");let c="";for(o=0;o<64;o+=8){let e=parseInt(l.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()};const Ju=new RegExp("^-?(0*)\\d{1,10}$"),Zu=function(e){if(Ju.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Xu=function(e){try{e()}catch(t){setTimeout(()=>{const e=t.stack||"";throw qu("Exception was thrown by user callback.",e),t},Math.floor(0))}},eh=function(e,t){const a=setTimeout(e,t);return"number"==typeof a&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(a):"object"==typeof a&&a.unref&&a.unref(),a};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class th{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,nu(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,a)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,a):t(null)},0)})}addTokenChangeListener(e){var t;null==(t=this.appCheckProvider)||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){qu(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ah{constructor(e,t,a){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=a,this.auth_=null,this.auth_=a.getImmediate({optional:!0}),this.auth_||a.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(Ou("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,a)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,a):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',qu(e)}}class nh{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}nh.OWNER="owner";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const sh=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ih="ac",oh="websocket",rh="long_polling";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class lh{constructor(e,t,a,n,s=!1,i="",o=!1,r=!1,l=null){this.secure=t,this.namespace=a,this.webSocketOnly=n,this.nodeAdmin=s,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=r,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=xu.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&xu.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function ch(e,t,a){let n;if(ac("string"==typeof t,"typeof type must == string"),ac("object"==typeof a,"typeof params must == object"),t===oh)n=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==rh)throw new Error("Unknown connection type: "+t);n=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(a.ns=e.namespace);const s=[];return Ku(a,(e,t)=>{s.push(e+"="+t)}),n+s.join("&")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dh{constructor(){this.counters_={}}incrementCounter(e,t=1){Lc(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return dc(this.counters_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uh={},hh={};function ph(e){const t=e.toString();return uh[t]||(uh[t]=new dh),uh[t]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class mh{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Xu(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fh="start";class gh{constructor(e,t,a,n,s,i,o){this.connId=e,this.repoInfo=t,this.applicationId=a,this.appCheckToken=n,this.authToken=s,this.transportSessionId=i,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Fu(e),this.stats_=ph(t),this.urlFn=e=>(this.appCheckToken&&(e[ih]=this.appCheckToken),ch(t,rh,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new mh(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const a=function(){document.body?t||(t=!0,e()):setTimeout(a,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&a()}),window.attachEvent("onload",a))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new vh((...e)=>{const[t,a,n,s,i]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===fh)this.id=a,this.password=n;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{const[t,a]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,a)},()=>{this.onClosed_()},this.urlFn);const e={};e[fh]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[ih]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&sh.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){gh.forceAllow_=!0}static forceDisallow(){gh.forceDisallow_=!0}static isAvailable(){return!!gh.forceAllow_||!(gh.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Rc(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const a=rc(t),n=Yu(a,1840);for(let s=0;s<n.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const a={dframe:"t"};a.id=e,a.pw=t,this.myDisconnFrame.src=this.urlFn(a),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Rc(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class vh{constructor(e,t,a,n){this.onDisconnect=a,this.urlFn=n,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Pu(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=vh.createIFrame_();let a="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){a='<script>document.domain="'+document.domain+'";<\/script>'}const n="<html><body>"+a+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(n),this.myIFrame.doc.close()}catch(s){Ou("frame writing exception"),s.stack&&Ou(s.stack),Ou(s)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Ou("No IE domain setting required")}catch(t){const a=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+a+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),a="",n=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+a.length<=1870))break;{const e=this.pendingSegs.shift();a=a+"&seg"+n+"="+e.seg+"&ts"+n+"="+e.ts+"&d"+n+"="+e.d,n++}}return t+=a,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,a){this.pendingSegs.push({seg:e,ts:t,d:a}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const a=()=>{this.outstandingRequests.delete(t),this.newRequest_()},n=setTimeout(a,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(n),a()})}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const a=this.myIFrame.doc.createElement("script");a.type="text/javascript",a.async=!0,a.src=e,a.onload=a.onreadystatechange=function(){const e=a.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,a.parentNode&&a.parentNode.removeChild(a),t())},a.onerror=()=>{Ou("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(a)}catch(a){}},Math.floor(1))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bh=null;"undefined"!=typeof MozWebSocket?bh=MozWebSocket:"undefined"!=typeof WebSocket&&(bh=WebSocket);class wh{constructor(e,t,a,n,s,i,o){this.connId=e,this.applicationId=a,this.appCheckToken=n,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Fu(this.connId),this.stats_=ph(t),this.connURL=wh.connectionURL_(t,i,o,n,a),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,a,n,s){const i={v:"5"};return"undefined"!=typeof location&&location.hostname&&sh.test(location.hostname)&&(i.r="f"),t&&(i.s=t),a&&(i.ls=a),n&&(i[ih]=n),s&&(i.p=s),ch(e,oh,i)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,xu.set("previous_websocket_failure",!0);try{let e;this.mySock=new bh(this.connURL,[],e)}catch(a){this.log_("Error instantiating WebSocket.");const e=a.message||a.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){wh.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,a=navigator.userAgent.match(t);a&&a.length>1&&parseFloat(a[1])<4.4&&(e=!0)}return!e&&null!==bh&&!wh.forceDisallow_}static previouslyFailed(){return xu.isInMemoryStorage||!0===xu.get("previous_websocket_failure")}markConnectionHealthy(){xu.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=Pc(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(ac(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=Rc(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const a=Yu(t,16384);a.length>1&&this.sendString_(String(a.length));for(let n=0;n<a.length;n++)this.sendString_(a[n])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}wh.responsesRequiredToBeHealthy=2,wh.healthyTimeout=3e4;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class yh{static get ALL_TRANSPORTS(){return[gh,wh]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=wh&&wh.isAvailable();let a=t&&!wh.previouslyFailed();if(e.webSocketOnly&&(t||qu("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),a=!0),a)this.transports_=[wh];else{const e=this.transports_=[];for(const t of yh.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);yh.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}yh.globalTransportInitialized_=!1;class _h{constructor(e,t,a,n,s,i,o,r,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=a,this.appCheckToken_=n,this.authToken_=s,this.onMessage_=i,this.onReady_=o,this.onDisconnect_=r,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Fu("c:"+this.id+":"),this.transportManager_=new yh(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),a=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,a)},Math.floor(0));const n=e.healthyTimeout||0;n>0&&(this.healthyTimeout_=eh(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(n)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Hu("t",e),a=Hu("d",e);if("c"===t)this.onSecondaryControl_(a);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(a)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Hu("t",e),a=Hu("d",e);"c"===t?this.onControl_(a):"d"===t&&this.onDataMessage_(a)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Hu("t",e);if("d"in e){const a=e.d;if("h"===t){const e={...a};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(a):"r"===t?this.onReset_(a):"e"===t?Uu("Server Error: "+a):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Uu("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,a=e.v,n=e.h;this.sessionId=e.s,this.repoInfo_.host=n,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==a&&qu("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),a=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,a),eh(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):eh(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(xu.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kh{put(e,t,a,n){}merge(e,t,a,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,a){}onDisconnectMerge(e,t,a){}onDisconnectCancel(e,t){}reportStats(e){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ch{constructor(e){this.allowedEvents_=e,this.listeners_={},ac(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const a=[...this.listeners_[e]];for(let e=0;e<a.length;e++)a[e].callback.apply(a[e].context,t)}}on(e,t,a){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:a});const n=this.getInitialEvent(e);n&&t.apply(a,n)}off(e,t,a){this.validateEventType_(e);const n=this.listeners_[e]||[];for(let s=0;s<n.length;s++)if(n[s].callback===t&&(!a||a===n[s].context))return void n.splice(s,1)}validateEventType_(e){ac(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eh extends Ch{static getInstance(){return new Eh}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Ec()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return ac("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sh{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Th(){return new Sh("")}function Nh(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function xh(e){return e.pieces_.length-e.pieceNum_}function Ih(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Sh(e.pieces_,t)}function Ah(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Ph(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Rh(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let a=e.pieceNum_;a<e.pieces_.length-1;a++)t.push(e.pieces_[a]);return new Sh(t,0)}function Dh(e,t){const a=[];for(let n=e.pieceNum_;n<e.pieces_.length;n++)a.push(e.pieces_[n]);if(t instanceof Sh)for(let n=t.pieceNum_;n<t.pieces_.length;n++)a.push(t.pieces_[n]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&a.push(e[t])}return new Sh(a,0)}function Lh(e){return e.pieceNum_>=e.pieces_.length}function Mh(e,t){const a=Nh(e),n=Nh(t);if(null===a)return t;if(a===n)return Mh(Ih(e),Ih(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Oh(e,t){if(xh(e)!==xh(t))return!1;for(let a=e.pieceNum_,n=t.pieceNum_;a<=e.pieces_.length;a++,n++)if(e.pieces_[a]!==t.pieces_[n])return!1;return!0}function Fh(e,t){let a=e.pieceNum_,n=t.pieceNum_;if(xh(e)>xh(t))return!1;for(;a<e.pieces_.length;){if(e.pieces_[a]!==t.pieces_[n])return!1;++a,++n}return!0}class Uh{constructor(e,t){this.errorPrefix_=t,this.parts_=Ph(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let a=0;a<this.parts_.length;a++)this.byteLength_+=jc(this.parts_[a]);Bh(this)}}function Bh(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+qh(e))}function qh(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $h extends Ch{static getInstance(){return new $h}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return ac("visible"===e,"Unknown event type: "+e),[this.visible_]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jh=1e3;class zh extends kh{constructor(e,t,a,n,s,i,o,r){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=a,this.onConnectStatus_=n,this.onServerInfoUpdate_=s,this.authTokenProvider_=i,this.appCheckTokenProvider_=o,this.authOverride_=r,this.id=zh.nextPersistentConnectionId_++,this.log_=Fu("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=jh,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,r)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");$h.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Eh.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,a){const n=++this.requestNumber_,s={r:n,a:e,b:t};this.log_(Rc(s)),ac(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),a&&(this.requestCBHash_[n]=a)}get(e){this.initConnection_();const t=new vc,a={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const a=e.d;"ok"===e.s?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(a),this.outstandingGetCount_++;const n=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(n),t.promise}listen(e,t,a,n){this.initConnection_();const s=e._queryIdentifier,i=e._path.toString();this.log_("Listen called for "+i+" "+s),this.listens.has(i)||this.listens.set(i,new Map),ac(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ac(!this.listens.get(i).has(s),"listen() called twice for same path/queryId.");const o={onComplete:n,hashFn:t,query:e,tag:a};this.listens.get(i).set(s,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,a=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(a)})}sendListen_(e){const t=e.query,a=t._path.toString(),n=t._queryIdentifier;this.log_("Listen on "+a+" for "+n);const s={p:a};e.tag&&(s.q=t._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest("q",s,s=>{const i=s.d,o=s.s;zh.warnOnListenWarnings_(i,t);(this.listens.get(a)&&this.listens.get(a).get(n))===e&&(this.log_("listen response",s),"ok"!==o&&this.removeListen_(a,n),e.onComplete&&e.onComplete(o,i))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&Lc(e,"w")){const a=Mc(e,"w");if(Array.isArray(a)&&~a.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',a=t._path.toString();qu(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${a} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=Dc(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=Dc(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",a={cred:e};null===this.authOverride_?a.noauth=!0:"object"==typeof this.authOverride_&&(a.authvar=this.authOverride_),this.sendRequest(t,a,t=>{const a=t.s,n=t.d||"error";this.authToken_===e&&("ok"===a?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(a,n))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,a=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,a)})}unlisten(e,t){const a=e._path.toString(),n=e._queryIdentifier;this.log_("Unlisten called for "+a+" "+n),ac(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(a,n)&&this.connected_&&this.sendUnlisten_(a,n,e._queryObject,t)}sendUnlisten_(e,t,a,n){this.log_("Unlisten on "+e+" for "+t);const s={p:e};n&&(s.q=a,s.t=n),this.sendRequest("n",s)}onDisconnectPut(e,t,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,a):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:a})}onDisconnectMerge(e,t,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,a):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:a})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,a,n){const s={p:t,d:a};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,e=>{n&&setTimeout(()=>{n(e.s,e.d)},Math.floor(0))})}put(e,t,a,n){this.putInternal("p",e,t,a,n)}merge(e,t,a,n){this.putInternal("m",e,t,a,n)}putInternal(e,t,a,n,s){this.initConnection_();const i={p:t,d:a};void 0!==s&&(i.h=s),this.outstandingPuts_.push({action:e,request:i,onComplete:n}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,a=this.outstandingPuts_[e].request,n=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,a,a=>{this.log_(t+" response",a),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),n&&n(a.s,a.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Rc(e));const t=e.r,a=this.requestCBHash_[t];a&&(delete this.requestCBHash_[t],a(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Uu("Unrecognized action received from server: "+Rc(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){ac(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=jh,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=jh,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=jh),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),a=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+zh.nextConnectionId_++,i=this.lastSessionId;let o=!1,r=null;const l=function(){r?r.close():(o=!0,n())},c=function(e){ac(r,"sendRequest call when we're not connected not allowed."),r.sendRequest(e)};this.realtime_={close:l,sendRequest:c};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[e,l]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);o?Ou("getToken() completed but was canceled"):(Ou("getToken() completed. Creating connection."),this.authToken_=e&&e.accessToken,this.appCheckToken_=l&&l.token,r=new _h(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,a,n,e=>{qu(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},i))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&qu(e),l())}}}interrupt(e){Ou("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Ou("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Oc(this.interruptReasons_)&&(this.reconnectDelay_=jh,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let a;a=t?t.map(e=>Gu(e)).join("$"):"default";const n=this.removeListen_(e,a);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(e,t){const a=new Sh(e).toString();let n;if(this.listens.has(a)){const e=this.listens.get(a);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(a)}else n=void 0;return n}onAuthRevoked_(e,t){Ou("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Ou("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+Eu.replace(/\./g,"-")]=1,Ec()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Eh.getInstance().currentlyOnline();return Oc(this.interruptReasons_)&&e}}zh.nextPersistentConnectionId_=0,zh.nextConnectionId_=0;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Vh{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Vh(e,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wh{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const a=new Vh(ju,e),n=new Vh(ju,t);return 0!==this.compare(a,n)}minPost(){return Vh.MIN}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Hh;class Gh extends Wh{static get __EMPTY_NODE(){return Hh}static set __EMPTY_NODE(e){Hh=e}compare(e,t){return Vu(e.name,t.name)}isDefinedOn(e){throw nc("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Vh.MIN}maxPost(){return new Vh(zu,Hh)}makePost(e,t){return ac("string"==typeof e,"KeyIndex indexValue must always be a string."),new Vh(e,Hh)}toString(){return".key"}}const Yh=new Gh;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kh{constructor(e,t,a,n,s=null){this.isReverse_=n,this.resultGenerator_=s,this.nodeStack_=[];let i=1;for(;!e.isEmpty();)if(i=t?a(e.key,t):1,n&&(i*=-1),i<0)e=this.isReverse_?e.left:e.right;else{if(0===i){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Qh{constructor(e,t,a,n,s){this.key=e,this.value=t,this.color=null!=a?a:Qh.RED,this.left=null!=n?n:Jh.EMPTY_NODE,this.right=null!=s?s:Jh.EMPTY_NODE}copy(e,t,a,n,s){return new Qh(null!=e?e:this.key,null!=t?t:this.value,null!=a?a:this.color,null!=n?n:this.left,null!=s?s:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,a){let n=this;const s=a(e,n.key);return n=s<0?n.copy(null,null,null,n.left.insert(e,t,a),null):0===s?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,a)),n.fixUp_()}removeMin_(){if(this.left.isEmpty())return Jh.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let a,n;if(a=this,t(e,a.key)<0)a.left.isEmpty()||a.left.isRed_()||a.left.left.isRed_()||(a=a.moveRedLeft_()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed_()&&(a=a.rotateRight_()),a.right.isEmpty()||a.right.isRed_()||a.right.left.isRed_()||(a=a.moveRedRight_()),0===t(e,a.key)){if(a.right.isEmpty())return Jh.EMPTY_NODE;n=a.right.min_(),a=a.copy(n.key,n.value,null,null,a.right.removeMin_())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Qh.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Qh.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Qh.RED=!0,Qh.BLACK=!1;class Jh{constructor(e,t=Jh.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Jh(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Qh.BLACK,null,null))}remove(e){return new Jh(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Qh.BLACK,null,null))}get(e){let t,a=this.root_;for(;!a.isEmpty();){if(t=this.comparator_(e,a.key),0===t)return a.value;t<0?a=a.left:t>0&&(a=a.right)}return null}getPredecessorKey(e){let t,a=this.root_,n=null;for(;!a.isEmpty();){if(t=this.comparator_(e,a.key),0===t){if(a.left.isEmpty())return n?n.key:null;for(a=a.left;!a.right.isEmpty();)a=a.right;return a.key}t<0?a=a.left:t>0&&(n=a,a=a.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Kh(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Kh(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Kh(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Kh(this.root_,null,this.comparator_,!0,e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Zh(e,t){return Vu(e.name,t.name)}function Xh(e,t){return Vu(e,t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ep;Jh.EMPTY_NODE=new class{copy(e,t,a,n,s){return this}insert(e,t,a){return new Qh(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const tp=function(e){return"number"==typeof e?"number:"+Qu(e):"string:"+e},ap=function(e){if(e.isLeafNode()){const t=e.val();ac("string"==typeof t||"number"==typeof t||"object"==typeof t&&Lc(t,".sv"),"Priority must be a string or number.")}else ac(e===ep||e.isEmpty(),"priority of unexpected type.");ac(e===ep||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let np,sp,ip;class op{static set __childrenNodeConstructor(e){np=e}static get __childrenNodeConstructor(){return np}constructor(e,t=op.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,ac(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),ap(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new op(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:op.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Lh(e)?this:".priority"===Nh(e)?this.priorityNode_:op.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:op.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const a=Nh(e);return null===a?t:t.isEmpty()&&".priority"!==a?this:(ac(".priority"!==a||1===xh(e),".priority must be the last token in a path"),this.updateImmediateChild(a,op.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ih(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+tp(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?Qu(this.value_):this.value_,this.lazyHash_=Ru(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===op.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof op.__childrenNodeConstructor?-1:(ac(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,a=typeof this.value_,n=op.VALUE_TYPE_ORDER.indexOf(t),s=op.VALUE_TYPE_ORDER.indexOf(a);return ac(n>=0,"Unknown leaf type: "+t),ac(s>=0,"Unknown leaf type: "+a),n===s?"object"===a?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-n}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}op.VALUE_TYPE_ORDER=["object","boolean","number","string"];const rp=new class extends Wh{compare(e,t){const a=e.node.getPriority(),n=t.node.getPriority(),s=a.compareTo(n);return 0===s?Vu(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Vh.MIN}maxPost(){return new Vh(zu,new op("[PRIORITY-POST]",ip))}makePost(e,t){const a=sp(e);return new Vh(t,new op("[PRIORITY-POST]",a))}toString(){return".priority"}},lp=Math.log(2);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cp{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/lp,10)),this.current_=this.count-1;const a=(n=this.count,parseInt(Array(n+1).join("1"),2));var n;this.bits_=e+1&a}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const dp=function(e,t,a,n){e.sort(t);const s=function(t,n){const i=n-t;let o,r;if(0===i)return null;if(1===i)return o=e[t],r=a?a(o):o,new Qh(r,o.node,Qh.BLACK,null,null);{const l=parseInt(i/2,10)+t,c=s(t,l),d=s(l+1,n);return o=e[l],r=a?a(o):o,new Qh(r,o.node,Qh.BLACK,c,d)}},i=function(t){let n=null,i=null,o=e.length;const r=function(t,n){const i=o-t,r=o;o-=t;const c=s(i+1,r),d=e[i],u=a?a(d):d;l(new Qh(u,d.node,n,null,c))},l=function(e){n?(n.left=e,n=e):(i=e,n=e)};for(let e=0;e<t.count;++e){const a=t.nextBitIsOne(),n=Math.pow(2,t.count-(e+1));a?r(n,Qh.BLACK):(r(n,Qh.BLACK),r(n,Qh.RED))}return i}(new cp(e.length));return new Jh(n||t,i)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let up;const hp={};class pp{static get Default(){return ac(hp&&rp,"ChildrenNode.ts has not been loaded"),up=up||new pp({".priority":hp},{".priority":rp}),up}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Mc(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Jh?t:null}hasIndex(e){return Lc(this.indexSet_,e.toString())}addIndex(e,t){ac(e!==Yh,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const a=[];let n=!1;const s=t.getIterator(Vh.Wrap);let i,o=s.getNext();for(;o;)n=n||e.isDefinedOn(o.node),a.push(o),o=s.getNext();i=n?dp(a,e.getCompare()):hp;const r=e.toString(),l={...this.indexSet_};l[r]=e;const c={...this.indexes_};return c[r]=i,new pp(c,l)}addToIndexes(e,t){const a=Fc(this.indexes_,(a,n)=>{const s=Mc(this.indexSet_,n);if(ac(s,"Missing index implementation for "+n),a===hp){if(s.isDefinedOn(e.node)){const a=[],n=t.getIterator(Vh.Wrap);let i=n.getNext();for(;i;)i.name!==e.name&&a.push(i),i=n.getNext();return a.push(e),dp(a,s.getCompare())}return hp}{const n=t.get(e.name);let s=a;return n&&(s=s.remove(new Vh(e.name,n))),s.insert(e,e.node)}});return new pp(a,this.indexSet_)}removeFromIndexes(e,t){const a=Fc(this.indexes_,a=>{if(a===hp)return a;{const n=t.get(e.name);return n?a.remove(new Vh(e.name,n)):a}});return new pp(a,this.indexSet_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mp;class fp{static get EMPTY_NODE(){return mp||(mp=new fp(new Jh(Xh),null,pp.Default))}constructor(e,t,a){this.children_=e,this.priorityNode_=t,this.indexMap_=a,this.lazyHash_=null,this.priorityNode_&&ap(this.priorityNode_),this.children_.isEmpty()&&ac(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||mp}updatePriority(e){return this.children_.isEmpty()?this:new fp(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?mp:t}}getChild(e){const t=Nh(e);return null===t?this:this.getImmediateChild(t).getChild(Ih(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(ac(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const a=new Vh(e,t);let n,s;t.isEmpty()?(n=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(a,this.children_)):(n=this.children_.insert(e,t),s=this.indexMap_.addToIndexes(a,this.children_));const i=n.isEmpty()?mp:this.priorityNode_;return new fp(n,i,s)}}updateChild(e,t){const a=Nh(e);if(null===a)return t;{ac(".priority"!==Nh(e)||1===xh(e),".priority must be the last token in a path");const n=this.getImmediateChild(a).updateChild(Ih(e),t);return this.updateImmediateChild(a,n)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let a=0,n=0,s=!0;if(this.forEachChild(rp,(i,o)=>{t[i]=o.val(e),a++,s&&fp.INTEGER_REGEXP_.test(i)?n=Math.max(n,Number(i)):s=!1}),!e&&s&&n<2*a){const e=[];for(const a in t)e[a]=t[a];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+tp(this.getPriority().val())+":"),this.forEachChild(rp,(t,a)=>{const n=a.hash();""!==n&&(e+=":"+t+":"+n)}),this.lazyHash_=""===e?"":Ru(e)}return this.lazyHash_}getPredecessorChildName(e,t,a){const n=this.resolveIndex_(a);if(n){const a=n.getPredecessorKey(new Vh(e,t));return a?a.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Vh(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Vh(t,this.children_.get(t)):null}forEachChild(e,t){const a=this.resolveIndex_(e);return a?a.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const a=this.resolveIndex_(t);if(a)return a.getIteratorFrom(e,e=>e);{const a=this.children_.getIteratorFrom(e.name,Vh.Wrap);let n=a.peek();for(;null!=n&&t.compare(n,e)<0;)a.getNext(),n=a.peek();return a}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const a=this.resolveIndex_(t);if(a)return a.getReverseIteratorFrom(e,e=>e);{const a=this.children_.getReverseIteratorFrom(e.name,Vh.Wrap);let n=a.peek();for(;null!=n&&t.compare(n,e)>0;)a.getNext(),n=a.peek();return a}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===gp?-1:0}withIndex(e){if(e===Yh||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new fp(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Yh||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(rp),a=t.getIterator(rp);let n=e.getNext(),s=a.getNext();for(;n&&s;){if(n.name!==s.name||!n.node.equals(s.node))return!1;n=e.getNext(),s=a.getNext()}return null===n&&null===s}return!1}return!1}}resolveIndex_(e){return e===Yh?null:this.indexMap_.get(e.toString())}}fp.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const gp=new class extends fp{constructor(){super(new Jh(Xh),fp.EMPTY_NODE,pp.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return fp.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Vh,{MIN:{value:new Vh(ju,fp.EMPTY_NODE)},MAX:{value:new Vh(zu,gp)}}),Gh.__EMPTY_NODE=fp.EMPTY_NODE,op.__childrenNodeConstructor=fp,ep=gp,function(e){ip=e}(gp);function vp(e,t=null){if(null===e)return fp.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),ac(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){return new op(e,vp(t))}if(e instanceof Array){let a=fp.EMPTY_NODE;return Ku(e,(t,n)=>{if(Lc(e,t)&&"."!==t.substring(0,1)){const e=vp(n);!e.isLeafNode()&&e.isEmpty()||(a=a.updateImmediateChild(t,e))}}),a.updatePriority(vp(t))}{const a=[];let n=!1;if(Ku(e,(e,t)=>{if("."!==e.substring(0,1)){const s=vp(t);s.isEmpty()||(n=n||!s.getPriority().isEmpty(),a.push(new Vh(e,s)))}}),0===a.length)return fp.EMPTY_NODE;const s=dp(a,Zh,e=>e.name,Xh);if(n){const e=dp(a,rp.getCompare());return new fp(s,vp(t),new pp({".priority":e},{".priority":rp}))}return new fp(s,vp(t),pp.Default)}}!function(e){sp=e}(vp);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class bp extends Wh{constructor(e){super(),this.indexPath_=e,ac(!Lh(e)&&".priority"!==Nh(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const a=this.extractChild(e.node),n=this.extractChild(t.node),s=a.compareTo(n);return 0===s?Vu(e.name,t.name):s}makePost(e,t){const a=vp(e),n=fp.EMPTY_NODE.updateChild(this.indexPath_,a);return new Vh(t,n)}maxPost(){const e=fp.EMPTY_NODE.updateChild(this.indexPath_,gp);return new Vh(zu,e)}toString(){return Ph(this.indexPath_,0).join("/")}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wp=new class extends Wh{compare(e,t){const a=e.node.compareTo(t.node);return 0===a?Vu(e.name,t.name):a}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Vh.MIN}maxPost(){return Vh.MAX}makePost(e,t){const a=vp(e);return new Vh(t,a)}toString(){return".value"}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yp(e){return{type:"value",snapshotNode:e}}function _p(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function kp(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Cp(e,t,a){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:a}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ep{constructor(e){this.index_=e}updateChild(e,t,a,n,s,i){ac(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(n).equals(a.getChild(n))&&o.isEmpty()===a.isEmpty()?e:(null!=i&&(a.isEmpty()?e.hasChild(t)?i.trackChildChange(kp(t,o)):ac(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?i.trackChildChange(_p(t,a)):i.trackChildChange(Cp(t,a,o))),e.isLeafNode()&&a.isEmpty()?e:e.updateImmediateChild(t,a).withIndex(this.index_))}updateFullNode(e,t,a){return null!=a&&(e.isLeafNode()||e.forEachChild(rp,(e,n)=>{t.hasChild(e)||a.trackChildChange(kp(e,n))}),t.isLeafNode()||t.forEachChild(rp,(t,n)=>{if(e.hasChild(t)){const s=e.getImmediateChild(t);s.equals(n)||a.trackChildChange(Cp(t,n,s))}else a.trackChildChange(_p(t,n))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?fp.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sp{constructor(e){this.indexedFilter_=new Ep(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Sp.getStartPost_(e),this.endPost_=Sp.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,a=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&a}updateChild(e,t,a,n,s,i){return this.matches(new Vh(t,a))||(a=fp.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,a,n,s,i)}updateFullNode(e,t,a){t.isLeafNode()&&(t=fp.EMPTY_NODE);let n=t.withIndex(this.index_);n=n.updatePriority(fp.EMPTY_NODE);const s=this;return t.forEachChild(rp,(e,t)=>{s.matches(new Vh(e,t))||(n=n.updateImmediateChild(e,fp.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,n,a)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tp{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new Sp(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,a,n,s,i){return this.rangedFilter_.matches(new Vh(t,a))||(a=fp.EMPTY_NODE),e.getImmediateChild(t).equals(a)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,a,n,s,i):this.fullLimitUpdateChild_(e,t,a,s,i)}updateFullNode(e,t,a){let n;if(t.isLeafNode()||t.isEmpty())n=fp.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;n=fp.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let a=0;for(;e.hasNext()&&a<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;n=n.updateImmediateChild(t.name,t.node),a++}}}else{let e;n=t.withIndex(this.index_),n=n.updatePriority(fp.EMPTY_NODE),e=this.reverse_?n.getReverseIterator(this.index_):n.getIterator(this.index_);let a=0;for(;e.hasNext();){const t=e.getNext();a<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?a++:n=n.updateImmediateChild(t.name,fp.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,n,a)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,a,n,s){let i;if(this.reverse_){const e=this.index_.getCompare();i=(t,a)=>e(a,t)}else i=this.index_.getCompare();const o=e;ac(o.numChildren()===this.limit_,"");const r=new Vh(t,a),l=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),c=this.rangedFilter_.matches(r);if(o.hasChild(t)){const e=o.getImmediateChild(t);let d=n.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=d&&(d.name===t||o.hasChild(d.name));)d=n.getChildAfterChild(this.index_,d,this.reverse_);const u=null==d?1:i(d,r);if(c&&!a.isEmpty()&&u>=0)return null!=s&&s.trackChildChange(Cp(t,a,e)),o.updateImmediateChild(t,a);{null!=s&&s.trackChildChange(kp(t,e));const a=o.updateImmediateChild(t,fp.EMPTY_NODE);return null!=d&&this.rangedFilter_.matches(d)?(null!=s&&s.trackChildChange(_p(d.name,d.node)),a.updateImmediateChild(d.name,d.node)):a}}return a.isEmpty()?e:c&&i(l,r)>=0?(null!=s&&(s.trackChildChange(kp(l.name,l.node)),s.trackChildChange(_p(t,a))),o.updateImmediateChild(t,a).updateImmediateChild(l.name,fp.EMPTY_NODE)):e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Np{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=rp}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return ac(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return ac(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ju}hasEnd(){return this.endSet_}getIndexEndValue(){return ac(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return ac(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:zu}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return ac(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===rp}copy(){const e=new Np;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function xp(e){const t={};if(e.isDefault())return t;let a;if(e.index_===rp?a="$priority":e.index_===wp?a="$value":e.index_===Yh?a="$key":(ac(e.index_ instanceof bp,"Unrecognized index type!"),a=e.index_.toString()),t.orderBy=Rc(a),e.startSet_){const a=e.startAfterSet_?"startAfter":"startAt";t[a]=Rc(e.indexStartValue_),e.startNameSet_&&(t[a]+=","+Rc(e.indexStartName_))}if(e.endSet_){const a=e.endBeforeSet_?"endBefore":"endAt";t[a]=Rc(e.indexEndValue_),e.endNameSet_&&(t[a]+=","+Rc(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function Ip(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let a=e.viewFrom_;""===a&&(a=e.isViewFromLeft()?"l":"r"),t.vf=a}return e.index_!==rp&&(t.i=e.index_.toString()),t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ap extends kh{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(ac(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,a,n){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=a,this.appCheckTokenProvider_=n,this.log_=Fu("p:rest:"),this.listens_={}}listen(e,t,a,n){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const i=Ap.getListenId_(e,a),o={};this.listens_[i]=o;const r=xp(e._queryParams);this.restRequest_(s+".json",r,(e,t)=>{let r=t;if(404===e&&(r=null,e=null),null===e&&this.onDataUpdate_(s,r,!1,a),Mc(this.listens_,i)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",n(t,null)}})}unlisten(e,t){const a=Ap.getListenId_(e,t);delete this.listens_[a]}get(e){const t=xp(e._queryParams),a=e._path.toString(),n=new vc;return this.restRequest_(a+".json",t,(e,t)=>{let s=t;404===e&&(s=null,e=null),null===e?(this.onDataUpdate_(a,s,!1,null),n.resolve(s)):n.reject(new Error(s))}),n.promise}refreshAuthToken(e){}restRequest_(e,t={},a){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([n,s])=>{n&&n.accessToken&&(t.auth=n.accessToken),s&&s.token&&(t.ac=s.token);const i=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+function(e){const t=[];for(const[a,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(a)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(a)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}(t);this.log_("Sending REST request for "+i);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(a&&4===o.readyState){this.log_("REST Response for "+i+" received. status:",o.status,"response:",o.responseText);let t=null;if(o.status>=200&&o.status<300){try{t=Pc(o.responseText)}catch(e){qu("Failed to parse JSON response for "+i+": "+o.responseText)}a(null,t)}else 401!==o.status&&404!==o.status&&qu("Got unsuccessful REST response for "+i+" Status: "+o.status),a(o.status);a=null}},o.open("GET",i,!0),o.send()})}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pp{constructor(){this.rootNode_=fp.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rp(){return{value:null,children:new Map}}function Dp(e,t,a){if(Lh(t))e.value=a,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,a);else{const n=Nh(t);e.children.has(n)||e.children.set(n,Rp());Dp(e.children.get(n),t=Ih(t),a)}}function Lp(e,t,a){null!==e.value?a(t,e.value):function(e,t){e.children.forEach((e,a)=>{t(a,e)})}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,(e,n)=>{Lp(n,new Sh(t.toString()+"/"+e),a)})}class Mp{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&Ku(this.last_,(e,a)=>{t[e]=t[e]-a}),this.last_=e,t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Op{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Mp(e);const a=1e4+2e4*Math.random();eh(this.reportStats_.bind(this),Math.floor(a))}reportStats_(){const e=this.statsListener_.get(),t={};let a=!1;Ku(e,(e,n)=>{n>0&&Lc(this.statsToReport_,e)&&(t[e]=n,a=!0)}),a&&this.server_.reportStats(t),eh(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fp,Up;function Bp(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(Up=Fp||(Fp={}))[Up.OVERWRITE=0]="OVERWRITE",Up[Up.MERGE=1]="MERGE",Up[Up.ACK_USER_WRITE=2]="ACK_USER_WRITE",Up[Up.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class qp{constructor(e,t,a){this.path=e,this.affectedTree=t,this.revert=a,this.type=Fp.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Lh(this.path)){if(null!=this.affectedTree.value)return ac(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Sh(e));return new qp(Th(),t,this.revert)}}return ac(Nh(this.path)===e,"operationForChild called for unrelated child."),new qp(Ih(this.path),this.affectedTree,this.revert)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p{constructor(e,t){this.source=e,this.path=t,this.type=Fp.LISTEN_COMPLETE}operationForChild(e){return Lh(this.path)?new $p(this.source,Th()):new $p(this.source,Ih(this.path))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jp{constructor(e,t,a){this.source=e,this.path=t,this.snap=a,this.type=Fp.OVERWRITE}operationForChild(e){return Lh(this.path)?new jp(this.source,Th(),this.snap.getImmediateChild(e)):new jp(this.source,Ih(this.path),this.snap)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zp{constructor(e,t,a){this.source=e,this.path=t,this.children=a,this.type=Fp.MERGE}operationForChild(e){if(Lh(this.path)){const t=this.children.subtree(new Sh(e));return t.isEmpty()?null:t.value?new jp(this.source,Th(),t.value):new zp(this.source,Th(),t)}return ac(Nh(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new zp(this.source,Ih(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vp{constructor(e,t,a){this.node_=e,this.fullyInitialized_=t,this.filtered_=a}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Lh(e))return this.isFullyInitialized()&&!this.filtered_;const t=Nh(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wp{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Hp(e,t,a,n,s,i){const o=n.filter(e=>e.type===a);o.sort((t,a)=>function(e,t,a){if(null==t.childName||null==a.childName)throw nc("Should only compare child_ events.");const n=new Vh(t.childName,t.snapshotNode),s=new Vh(a.childName,a.snapshotNode);return e.index_.compare(n,s)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,a)),o.forEach(a=>{const n=function(e,t,a){return"value"===t.type||"child_removed"===t.type||(t.prevName=a.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,a,i);s.forEach(s=>{s.respondsTo(a.type)&&t.push(s.createEvent(n,e.query_))})})}function Gp(e,t){return{eventCache:e,serverCache:t}}function Yp(e,t,a,n){return Gp(new Vp(t,a,n),e.serverCache)}function Kp(e,t,a,n){return Gp(e.eventCache,new Vp(t,a,n))}function Qp(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Jp(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zp;class Xp{static fromObject(e){let t=new Xp(null);return Ku(e,(e,a)=>{t=t.set(new Sh(e),a)}),t}constructor(e,t=(()=>(Zp||(Zp=new Jh(Wu)),Zp))()){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Th(),value:this.value};if(Lh(e))return null;{const a=Nh(e),n=this.children.get(a);if(null!==n){const s=n.findRootMostMatchingPathAndValue(Ih(e),t);if(null!=s){return{path:Dh(new Sh(a),s.path),value:s.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Lh(e))return this;{const t=Nh(e),a=this.children.get(t);return null!==a?a.subtree(Ih(e)):new Xp(null)}}set(e,t){if(Lh(e))return new Xp(t,this.children);{const a=Nh(e),n=(this.children.get(a)||new Xp(null)).set(Ih(e),t),s=this.children.insert(a,n);return new Xp(this.value,s)}}remove(e){if(Lh(e))return this.children.isEmpty()?new Xp(null):new Xp(null,this.children);{const t=Nh(e),a=this.children.get(t);if(a){const n=a.remove(Ih(e));let s;return s=n.isEmpty()?this.children.remove(t):this.children.insert(t,n),null===this.value&&s.isEmpty()?new Xp(null):new Xp(this.value,s)}return this}}get(e){if(Lh(e))return this.value;{const t=Nh(e),a=this.children.get(t);return a?a.get(Ih(e)):null}}setTree(e,t){if(Lh(e))return t;{const a=Nh(e),n=(this.children.get(a)||new Xp(null)).setTree(Ih(e),t);let s;return s=n.isEmpty()?this.children.remove(a):this.children.insert(a,n),new Xp(this.value,s)}}fold(e){return this.fold_(Th(),e)}fold_(e,t){const a={};return this.children.inorderTraversal((n,s)=>{a[n]=s.fold_(Dh(e,n),t)}),t(e,this.value,a)}findOnPath(e,t){return this.findOnPath_(e,Th(),t)}findOnPath_(e,t,a){const n=!!this.value&&a(t,this.value);if(n)return n;if(Lh(e))return null;{const n=Nh(e),s=this.children.get(n);return s?s.findOnPath_(Ih(e),Dh(t,n),a):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Th(),t)}foreachOnPath_(e,t,a){if(Lh(e))return this;{this.value&&a(t,this.value);const n=Nh(e),s=this.children.get(n);return s?s.foreachOnPath_(Ih(e),Dh(t,n),a):new Xp(null)}}foreach(e){this.foreach_(Th(),e)}foreach_(e,t){this.children.inorderTraversal((a,n)=>{n.foreach_(Dh(e,a),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,a)=>{a.value&&e(t,a.value)})}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class em{constructor(e){this.writeTree_=e}static empty(){return new em(new Xp(null))}}function tm(e,t,a){if(Lh(t))return new em(new Xp(a));{const n=e.writeTree_.findRootMostValueAndPath(t);if(null!=n){const s=n.path;let i=n.value;const o=Mh(s,t);return i=i.updateChild(o,a),new em(e.writeTree_.set(s,i))}{const n=new Xp(a),s=e.writeTree_.setTree(t,n);return new em(s)}}}function am(e,t,a){let n=e;return Ku(a,(e,a)=>{n=tm(n,Dh(t,e),a)}),n}function nm(e,t){if(Lh(t))return em.empty();{const a=e.writeTree_.setTree(t,new Xp(null));return new em(a)}}function sm(e,t){return null!=im(e,t)}function im(e,t){const a=e.writeTree_.findRootMostValueAndPath(t);return null!=a?e.writeTree_.get(a.path).getChild(Mh(a.path,t)):null}function om(e){const t=[],a=e.writeTree_.value;return null!=a?a.isLeafNode()||a.forEachChild(rp,(e,a)=>{t.push(new Vh(e,a))}):e.writeTree_.children.inorderTraversal((e,a)=>{null!=a.value&&t.push(new Vh(e,a.value))}),t}function rm(e,t){if(Lh(t))return e;{const a=im(e,t);return new em(null!=a?new Xp(a):e.writeTree_.subtree(t))}}function lm(e){return e.writeTree_.isEmpty()}function cm(e,t){return dm(Th(),e.writeTree_,t)}function dm(e,t,a){if(null!=t.value)return a.updateChild(e,t.value);{let n=null;return t.children.inorderTraversal((t,s)=>{".priority"===t?(ac(null!==s.value,"Priority writes must always be leaf nodes"),n=s.value):a=dm(Dh(e,t),s,a)}),a.getChild(e).isEmpty()||null===n||(a=a.updateChild(Dh(e,".priority"),n)),a}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function um(e,t){return Em(t,e)}function hm(e,t){const a=e.allWrites.findIndex(e=>e.writeId===t);ac(a>=0,"removeWrite called with nonexistent writeId.");const n=e.allWrites[a];e.allWrites.splice(a,1);let s=n.visible,i=!1,o=e.allWrites.length-1;for(;s&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=a&&pm(t,n.path)?s=!1:Fh(n.path,t.path)&&(i=!0)),o--}if(s){if(i)return function(e){e.visibleWrites=fm(e.allWrites,mm,Th()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(n.snap)e.visibleWrites=nm(e.visibleWrites,n.path);else{Ku(n.children,t=>{e.visibleWrites=nm(e.visibleWrites,Dh(n.path,t))})}return!0}return!1}function pm(e,t){if(e.snap)return Fh(e.path,t);for(const a in e.children)if(e.children.hasOwnProperty(a)&&Fh(Dh(e.path,a),t))return!0;return!1}function mm(e){return e.visible}function fm(e,t,a){let n=em.empty();for(let s=0;s<e.length;++s){const i=e[s];if(t(i)){const e=i.path;let t;if(i.snap)Fh(a,e)?(t=Mh(a,e),n=tm(n,t,i.snap)):Fh(e,a)&&(t=Mh(e,a),n=tm(n,Th(),i.snap.getChild(t)));else{if(!i.children)throw nc("WriteRecord should have .snap or .children");if(Fh(a,e))t=Mh(a,e),n=am(n,t,i.children);else if(Fh(e,a))if(t=Mh(e,a),Lh(t))n=am(n,Th(),i.children);else{const e=Mc(i.children,Nh(t));if(e){const a=e.getChild(Ih(t));n=tm(n,Th(),a)}}}}}return n}function gm(e,t,a,n,s){if(n||s){const i=rm(e.visibleWrites,t);if(!s&&lm(i))return a;if(s||null!=a||sm(i,Th())){const i=function(e){return(e.visible||s)&&(!n||!~n.indexOf(e.writeId))&&(Fh(e.path,t)||Fh(t,e.path))};return cm(fm(e.allWrites,i,t),a||fp.EMPTY_NODE)}return null}{const n=im(e.visibleWrites,t);if(null!=n)return n;{const n=rm(e.visibleWrites,t);if(lm(n))return a;if(null!=a||sm(n,Th())){return cm(n,a||fp.EMPTY_NODE)}return null}}}function vm(e,t,a,n){return gm(e.writeTree,e.treePath,t,a,n)}function bm(e,t){return function(e,t,a){let n=fp.EMPTY_NODE;const s=im(e.visibleWrites,t);if(s)return s.isLeafNode()||s.forEachChild(rp,(e,t)=>{n=n.updateImmediateChild(e,t)}),n;if(a){const s=rm(e.visibleWrites,t);return a.forEachChild(rp,(e,t)=>{const a=cm(rm(s,new Sh(e)),t);n=n.updateImmediateChild(e,a)}),om(s).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}return om(rm(e.visibleWrites,t)).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}(e.writeTree,e.treePath,t)}function wm(e,t,a,n){return function(e,t,a,n,s){ac(n||s,"Either existingEventSnap or existingServerSnap must exist");const i=Dh(t,a);if(sm(e.visibleWrites,i))return null;{const t=rm(e.visibleWrites,i);return lm(t)?s.getChild(a):cm(t,s.getChild(a))}}(e.writeTree,e.treePath,t,a,n)}function ym(e,t){return function(e,t){return im(e.visibleWrites,t)}(e.writeTree,Dh(e.treePath,t))}function _m(e,t,a,n,s,i){return function(e,t,a,n,s,i,o){let r;const l=rm(e.visibleWrites,t),c=im(l,Th());if(null!=c)r=c;else{if(null==a)return[];r=cm(l,a)}if(r=r.withIndex(o),r.isEmpty()||r.isLeafNode())return[];{const e=[],t=o.getCompare(),a=i?r.getReverseIteratorFrom(n,o):r.getIteratorFrom(n,o);let l=a.getNext();for(;l&&e.length<s;)0!==t(l,n)&&e.push(l),l=a.getNext();return e}}(e.writeTree,e.treePath,t,a,n,s,i)}function km(e,t,a){return function(e,t,a,n){const s=Dh(t,a),i=im(e.visibleWrites,s);if(null!=i)return i;if(n.isCompleteForChild(a))return cm(rm(e.visibleWrites,s),n.getNode().getImmediateChild(a));return null}(e.writeTree,e.treePath,t,a)}function Cm(e,t){return Em(Dh(e.treePath,t),e.writeTree)}function Em(e,t){return{treePath:e,writeTree:t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,a=e.childName;ac("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),ac(".priority"!==a,"Only non-priority child changes can be tracked.");const n=this.changeMap.get(a);if(n){const s=n.type;if("child_added"===t&&"child_removed"===s)this.changeMap.set(a,Cp(a,e.snapshotNode,n.snapshotNode));else if("child_removed"===t&&"child_added"===s)this.changeMap.delete(a);else if("child_removed"===t&&"child_changed"===s)this.changeMap.set(a,kp(a,n.oldSnap));else if("child_changed"===t&&"child_added"===s)this.changeMap.set(a,_p(a,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==s)throw nc("Illegal combination of changes: "+e+" occurred after "+n);this.changeMap.set(a,Cp(a,e.snapshotNode,n.oldSnap))}}else this.changeMap.set(a,e)}getChanges(){return Array.from(this.changeMap.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tm=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,a){return null}};class Nm{constructor(e,t,a=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=a}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Vp(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return km(this.writes_,e,t)}}getChildAfterChild(e,t,a){const n=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Jp(this.viewCache_),s=_m(this.writes_,n,t,1,a,e);return 0===s.length?null:s[0]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xm(e,t,a,n,s){const i=new Sm;let o,r;if(a.type===Fp.OVERWRITE){const l=a;l.source.fromUser?o=Pm(e,t,l.path,l.snap,n,s,i):(ac(l.source.fromServer,"Unknown source."),r=l.source.tagged||t.serverCache.isFiltered()&&!Lh(l.path),o=Am(e,t,l.path,l.snap,n,s,r,i))}else if(a.type===Fp.MERGE){const l=a;l.source.fromUser?o=function(e,t,a,n,s,i,o){let r=t;return n.foreach((n,l)=>{const c=Dh(a,n);Rm(t,Nh(c))&&(r=Pm(e,r,c,l,s,i,o))}),n.foreach((n,l)=>{const c=Dh(a,n);Rm(t,Nh(c))||(r=Pm(e,r,c,l,s,i,o))}),r}(e,t,l.path,l.children,n,s,i):(ac(l.source.fromServer,"Unknown source."),r=l.source.tagged||t.serverCache.isFiltered(),o=Lm(e,t,l.path,l.children,n,s,r,i))}else if(a.type===Fp.ACK_USER_WRITE){const r=a;o=r.revert?function(e,t,a,n,s,i){let o;if(null!=ym(n,a))return t;{const r=new Nm(n,t,s),l=t.eventCache.getNode();let c;if(Lh(a)||".priority"===Nh(a)){let a;if(t.serverCache.isFullyInitialized())a=vm(n,Jp(t));else{const e=t.serverCache.getNode();ac(e instanceof fp,"serverChildren would be complete if leaf node"),a=bm(n,e)}c=e.filter.updateFullNode(l,a,i)}else{const s=Nh(a);let d=km(n,s,t.serverCache);null==d&&t.serverCache.isCompleteForChild(s)&&(d=l.getImmediateChild(s)),c=null!=d?e.filter.updateChild(l,s,d,Ih(a),r,i):t.eventCache.getNode().hasChild(s)?e.filter.updateChild(l,s,fp.EMPTY_NODE,Ih(a),r,i):l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=vm(n,Jp(t)),o.isLeafNode()&&(c=e.filter.updateFullNode(c,o,i)))}return o=t.serverCache.isFullyInitialized()||null!=ym(n,Th()),Yp(t,c,o,e.filter.filtersNodes())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,r.path,n,s,i):function(e,t,a,n,s,i,o){if(null!=ym(s,a))return t;const r=t.serverCache.isFiltered(),l=t.serverCache;if(null!=n.value){if(Lh(a)&&l.isFullyInitialized()||l.isCompleteForPath(a))return Am(e,t,a,l.getNode().getChild(a),s,i,r,o);if(Lh(a)){let n=new Xp(null);return l.getNode().forEachChild(Yh,(e,t)=>{n=n.set(new Sh(e),t)}),Lm(e,t,a,n,s,i,r,o)}return t}{let c=new Xp(null);return n.foreach((e,t)=>{const n=Dh(a,e);l.isCompleteForPath(n)&&(c=c.set(e,l.getNode().getChild(n)))}),Lm(e,t,a,c,s,i,r,o)}}(e,t,r.path,r.affectedTree,n,s,i)}else{if(a.type!==Fp.LISTEN_COMPLETE)throw nc("Unknown operation type: "+a.type);o=function(e,t,a,n,s){const i=t.serverCache,o=Kp(t,i.getNode(),i.isFullyInitialized()||Lh(a),i.isFiltered());return Im(e,o,a,n,Tm,s)}(e,t,a.path,n,i)}const l=i.getChanges();return function(e,t,a){const n=t.eventCache;if(n.isFullyInitialized()){const s=n.getNode().isLeafNode()||n.getNode().isEmpty(),i=Qp(e);(a.length>0||!e.eventCache.isFullyInitialized()||s&&!n.getNode().equals(i)||!n.getNode().getPriority().equals(i.getPriority()))&&a.push(yp(Qp(t)))}}(t,o,l),{viewCache:o,changes:l}}function Im(e,t,a,n,s,i){const o=t.eventCache;if(null!=ym(n,a))return t;{let r,l;if(Lh(a))if(ac(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const a=Jp(t),s=bm(n,a instanceof fp?a:fp.EMPTY_NODE);r=e.filter.updateFullNode(t.eventCache.getNode(),s,i)}else{const a=vm(n,Jp(t));r=e.filter.updateFullNode(t.eventCache.getNode(),a,i)}else{const c=Nh(a);if(".priority"===c){ac(1===xh(a),"Can't have a priority with additional path components");const s=o.getNode();l=t.serverCache.getNode();const i=wm(n,a,s,l);r=null!=i?e.filter.updatePriority(s,i):o.getNode()}else{const d=Ih(a);let u;if(o.isCompleteForChild(c)){l=t.serverCache.getNode();const e=wm(n,a,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(c).updateChild(d,e):o.getNode().getImmediateChild(c)}else u=km(n,c,t.serverCache);r=null!=u?e.filter.updateChild(o.getNode(),c,u,d,s,i):o.getNode()}}return Yp(t,r,o.isFullyInitialized()||Lh(a),e.filter.filtersNodes())}}function Am(e,t,a,n,s,i,o,r){const l=t.serverCache;let c;const d=o?e.filter:e.filter.getIndexedFilter();if(Lh(a))c=d.updateFullNode(l.getNode(),n,null);else if(d.filtersNodes()&&!l.isFiltered()){const e=l.getNode().updateChild(a,n);c=d.updateFullNode(l.getNode(),e,null)}else{const e=Nh(a);if(!l.isCompleteForPath(a)&&xh(a)>1)return t;const s=Ih(a),i=l.getNode().getImmediateChild(e).updateChild(s,n);c=".priority"===e?d.updatePriority(l.getNode(),i):d.updateChild(l.getNode(),e,i,s,Tm,null)}const u=Kp(t,c,l.isFullyInitialized()||Lh(a),d.filtersNodes());return Im(e,u,a,s,new Nm(s,u,i),r)}function Pm(e,t,a,n,s,i,o){const r=t.eventCache;let l,c;const d=new Nm(s,t,i);if(Lh(a))c=e.filter.updateFullNode(t.eventCache.getNode(),n,o),l=Yp(t,c,!0,e.filter.filtersNodes());else{const s=Nh(a);if(".priority"===s)c=e.filter.updatePriority(t.eventCache.getNode(),n),l=Yp(t,c,r.isFullyInitialized(),r.isFiltered());else{const i=Ih(a),c=r.getNode().getImmediateChild(s);let u;if(Lh(i))u=n;else{const e=d.getCompleteChild(s);u=null!=e?".priority"===Ah(i)&&e.getChild(Rh(i)).isEmpty()?e:e.updateChild(i,n):fp.EMPTY_NODE}if(c.equals(u))l=t;else{l=Yp(t,e.filter.updateChild(r.getNode(),s,u,i,d,o),r.isFullyInitialized(),e.filter.filtersNodes())}}}return l}function Rm(e,t){return e.eventCache.isCompleteForChild(t)}function Dm(e,t,a){return a.foreach((e,a)=>{t=t.updateChild(e,a)}),t}function Lm(e,t,a,n,s,i,o,r){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l,c=t;l=Lh(a)?n:new Xp(null).setTree(a,n);const d=t.serverCache.getNode();return l.children.inorderTraversal((a,n)=>{if(d.hasChild(a)){const l=Dm(0,t.serverCache.getNode().getImmediateChild(a),n);c=Am(e,c,new Sh(a),l,s,i,o,r)}}),l.children.inorderTraversal((a,n)=>{const l=!t.serverCache.isCompleteForChild(a)&&null===n.value;if(!d.hasChild(a)&&!l){const l=Dm(0,t.serverCache.getNode().getImmediateChild(a),n);c=Am(e,c,new Sh(a),l,s,i,o,r)}}),c}class Mm{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const a=this.query_._queryParams,n=new Ep(a.getIndex()),s=(i=a).loadsAllData()?new Ep(i.getIndex()):i.hasLimit()?new Tp(i):new Sp(i);var i;this.processor_=function(e){return{filter:e}}(s);const o=t.serverCache,r=t.eventCache,l=n.updateFullNode(fp.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(fp.EMPTY_NODE,r.getNode(),null),d=new Vp(l,o.isFullyInitialized(),n.filtersNodes()),u=new Vp(c,r.isFullyInitialized(),s.filtersNodes());this.viewCache_=Gp(u,d),this.eventGenerator_=new Wp(this.query_)}get query(){return this.query_}}function Om(e,t){const a=Jp(e.viewCache_);return a&&(e.query._queryParams.loadsAllData()||!Lh(t)&&!a.getImmediateChild(Nh(t)).isEmpty())?a.getChild(t):null}function Fm(e){return 0===e.eventRegistrations_.length}function Um(e,t,a){const n=[];if(a){ac(null==t,"A cancel should cancel all event registrations.");const s=e.query._path;e.eventRegistrations_.forEach(e=>{const t=e.createCancelEvent(a,s);t&&n.push(t)})}if(t){let a=[];for(let n=0;n<e.eventRegistrations_.length;++n){const s=e.eventRegistrations_[n];if(s.matches(t)){if(t.hasAnyCallback()){a=a.concat(e.eventRegistrations_.slice(n+1));break}}else a.push(s)}e.eventRegistrations_=a}else e.eventRegistrations_=[];return n}function Bm(e,t,a,n){t.type===Fp.MERGE&&null!==t.source.queryId&&(ac(Jp(e.viewCache_),"We should always have a full cache before handling merges"),ac(Qp(e.viewCache_),"Missing event cache, even though we have a server cache"));const s=e.viewCache_,i=xm(e.processor_,s,t,a,n);var o,r;return o=e.processor_,r=i.viewCache,ac(r.eventCache.getNode().isIndexed(o.filter.getIndex()),"Event snap not indexed"),ac(r.serverCache.getNode().isIndexed(o.filter.getIndex()),"Server snap not indexed"),ac(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=i.viewCache,qm(e,i.changes,i.viewCache.eventCache.getNode(),null)}function qm(e,t,a,n){const s=n?[n]:e.eventRegistrations_;return function(e,t,a,n){const s=[],i=[];return t.forEach(t=>{var a;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&i.push((a=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:a}))}),Hp(e,s,"child_removed",t,n,a),Hp(e,s,"child_added",t,n,a),Hp(e,s,"child_moved",i,n,a),Hp(e,s,"child_changed",t,n,a),Hp(e,s,"value",t,n,a),s}(e.eventGenerator_,t,a,s)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $m,jm;class zm{constructor(){this.views=new Map}}function Vm(e,t,a,n){const s=t.source.queryId;if(null!==s){const i=e.views.get(s);return ac(null!=i,"SyncTree gave us an op for an invalid query."),Bm(i,t,a,n)}{let s=[];for(const i of e.views.values())s=s.concat(Bm(i,t,a,n));return s}}function Wm(e,t,a,n,s,i){const o=function(e,t,a,n,s){const i=t._queryIdentifier,o=e.views.get(i);if(!o){let e=vm(a,s?n:null),i=!1;e?i=!0:n instanceof fp?(e=bm(a,n),i=!1):(e=fp.EMPTY_NODE,i=!1);const o=Gp(new Vp(e,i,!1),new Vp(n,s,!1));return new Mm(t,o)}return o}(e,t,n,s,i);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,a),function(e,t){const a=e.viewCache_.eventCache,n=[];a.getNode().isLeafNode()||a.getNode().forEachChild(rp,(e,t)=>{n.push(_p(e,t))});return a.isFullyInitialized()&&n.push(yp(a.getNode())),qm(e,n,a.getNode(),t)}(o,a)}function Hm(e,t,a,n){const s=t._queryIdentifier,i=[];let o=[];const r=Jm(e);if("default"===s)for(const[l,c]of e.views.entries())o=o.concat(Um(c,a,n)),Fm(c)&&(e.views.delete(l),c.query._queryParams.loadsAllData()||i.push(c.query));else{const t=e.views.get(s);t&&(o=o.concat(Um(t,a,n)),Fm(t)&&(e.views.delete(s),t.query._queryParams.loadsAllData()||i.push(t.query)))}return r&&!Jm(e)&&i.push(new(ac($m,"Reference.ts has not been loaded"),$m)(t._repo,t._path)),{removed:i,events:o}}function Gm(e){const t=[];for(const a of e.views.values())a.query._queryParams.loadsAllData()||t.push(a);return t}function Ym(e,t){let a=null;for(const n of e.views.values())a=a||Om(n,t);return a}function Km(e,t){if(t._queryParams.loadsAllData())return Zm(e);{const a=t._queryIdentifier;return e.views.get(a)}}function Qm(e,t){return null!=Km(e,t)}function Jm(e){return null!=Zm(e)}function Zm(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xm=1;class ef{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Xp(null),this.pendingWriteTree_={visibleWrites:em.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function tf(e,t,a,n,s){return function(e,t,a,n,s){ac(n>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),e.allWrites.push({path:t,snap:a,writeId:n,visible:s}),s&&(e.visibleWrites=tm(e.visibleWrites,t,a)),e.lastWriteId=n}(e.pendingWriteTree_,t,a,n,s),s?lf(e,new jp({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,a)):[]}function af(e,t,a=!1){const n=function(e,t){for(let a=0;a<e.allWrites.length;a++){const n=e.allWrites[a];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(hm(e.pendingWriteTree_,t)){let t=new Xp(null);return null!=n.snap?t=t.set(Th(),!0):Ku(n.children,e=>{t=t.set(new Sh(e),!0)}),lf(e,new qp(n.path,t,a))}return[]}function nf(e,t,a){return lf(e,new jp({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,a))}function sf(e,t,a,n,s=!1){const i=t._path,o=e.syncPointTree_.get(i);let r=[];if(o&&("default"===t._queryIdentifier||Qm(o,t))){const l=Hm(o,t,a,n);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(i));const c=l.removed;if(r=l.events,!s){const a=-1!==c.findIndex(e=>e._queryParams.loadsAllData()),s=e.syncPointTree_.findOnPath(i,(e,t)=>Jm(t));if(a&&!s){const t=e.syncPointTree_.subtree(i);if(!t.isEmpty()){const a=function(e){return e.fold((e,t,a)=>{if(t&&Jm(t)){return[Zm(t)]}{let e=[];return t&&(e=Gm(t)),Ku(a,(t,a)=>{e=e.concat(a)}),e}})}(t);for(let t=0;t<a.length;++t){const n=a[t],s=n.query,i=uf(e,n);e.listenProvider_.startListening(vf(s),hf(e,s),i.hashFn,i.onComplete)}}}if(!s&&c.length>0&&!n)if(a){const a=null;e.listenProvider_.stopListening(vf(t),a)}else c.forEach(t=>{const a=e.queryToTagMap.get(pf(t));e.listenProvider_.stopListening(vf(t),a)})}!function(e,t){for(let a=0;a<t.length;++a){const n=t[a];if(!n._queryParams.loadsAllData()){const t=pf(n),a=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(a)}}}(e,c)}return r}function of(e,t,a,n=!1){const s=t._path;let i=null,o=!1;e.syncPointTree_.foreachOnPath(s,(e,t)=>{const a=Mh(e,s);i=i||Ym(t,a),o=o||Jm(t)});let r,l=e.syncPointTree_.get(s);if(l?(o=o||Jm(l),i=i||Ym(l,Th())):(l=new zm,e.syncPointTree_=e.syncPointTree_.set(s,l)),null!=i)r=!0;else{r=!1,i=fp.EMPTY_NODE;e.syncPointTree_.subtree(s).foreachChild((e,t)=>{const a=Ym(t,Th());a&&(i=i.updateImmediateChild(e,a))})}const c=Qm(l,t);if(!c&&!t._queryParams.loadsAllData()){const a=pf(t);ac(!e.queryToTagMap.has(a),"View does not exist, but we have a tag");const n=Xm++;e.queryToTagMap.set(a,n),e.tagToQueryMap.set(n,a)}let d=Wm(l,t,a,um(e.pendingWriteTree_,s),i,r);if(!c&&!o&&!n){const a=Km(l,t);d=d.concat(function(e,t,a){const n=t._path,s=hf(e,t),i=uf(e,a),o=e.listenProvider_.startListening(vf(t),s,i.hashFn,i.onComplete),r=e.syncPointTree_.subtree(n);if(s)ac(!Jm(r.value),"If we're adding a query, it shouldn't be shadowed");else{const t=r.fold((e,t,a)=>{if(!Lh(e)&&t&&Jm(t))return[Zm(t).query];{let e=[];return t&&(e=e.concat(Gm(t).map(e=>e.query))),Ku(a,(t,a)=>{e=e.concat(a)}),e}});for(let a=0;a<t.length;++a){const n=t[a];e.listenProvider_.stopListening(vf(n),hf(e,n))}}return o}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,a))}return d}function rf(e,t,a){const n=e.pendingWriteTree_,s=e.syncPointTree_.findOnPath(t,(e,a)=>{const n=Ym(a,Mh(e,t));if(n)return n});return gm(n,t,s,a,!0)}function lf(e,t){return cf(t,e.syncPointTree_,null,um(e.pendingWriteTree_,Th()))}function cf(e,t,a,n){if(Lh(e.path))return df(e,t,a,n);{const s=t.get(Th());null==a&&null!=s&&(a=Ym(s,Th()));let i=[];const o=Nh(e.path),r=e.operationForChild(o),l=t.children.get(o);if(l&&r){const e=a?a.getImmediateChild(o):null,t=Cm(n,o);i=i.concat(cf(r,l,e,t))}return s&&(i=i.concat(Vm(s,e,n,a))),i}}function df(e,t,a,n){const s=t.get(Th());null==a&&null!=s&&(a=Ym(s,Th()));let i=[];return t.children.inorderTraversal((t,s)=>{const o=a?a.getImmediateChild(t):null,r=Cm(n,t),l=e.operationForChild(t);l&&(i=i.concat(df(l,s,o,r)))}),s&&(i=i.concat(Vm(s,e,n,a))),i}function uf(e,t){const a=t.query,n=hf(e,a);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||fp.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return n?function(e,t,a){const n=mf(e,a);if(n){const a=ff(n),s=a.path,i=a.queryId,o=Mh(s,t);return gf(e,s,new $p(Bp(i),o))}return[]}(e,a._path,n):function(e,t){return lf(e,new $p({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,a._path);{const n=function(e,t){let a="Unknown Error";"too_big"===e?a="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?a="Client doesn't have permission to access the desired data.":"unavailable"===e&&(a="The service is unavailable");const n=new Error(e+" at "+t._path.toString()+": "+a);return n.code=e.toUpperCase(),n}(t,a);return sf(e,a,null,n)}}}}function hf(e,t){const a=pf(t);return e.queryToTagMap.get(a)}function pf(e){return e._path.toString()+"$"+e._queryIdentifier}function mf(e,t){return e.tagToQueryMap.get(t)}function ff(e){const t=e.indexOf("$");return ac(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Sh(e.substr(0,t))}}function gf(e,t,a){const n=e.syncPointTree_.get(t);ac(n,"Missing sync point for query tag that we're tracking");return Vm(n,a,um(e.pendingWriteTree_,t),null)}function vf(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(ac(jm,"Reference.ts has not been loaded"),jm)(e._repo,e._path):e}class bf{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new bf(t)}node(){return this.node_}}class wf{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Dh(this.path_,e);return new wf(this.syncTree_,t)}node(){return rf(this.syncTree_,this.path_)}}const yf=function(e,t,a){return e&&"object"==typeof e?(ac(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?_f(e[".sv"],t,a):"object"==typeof e[".sv"]?kf(e[".sv"],t):void ac(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},_f=function(e,t,a){if("timestamp"===e)return a.timestamp;ac(!1,"Unexpected server value: "+e)},kf=function(e,t,a){e.hasOwnProperty("increment")||ac(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const n=e.increment;"number"!=typeof n&&ac(!1,"Unexpected increment value: "+n);const s=t.node();if(ac(null!=s,"Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return n;const i=s.getValue();return"number"!=typeof i?n:i+n},Cf=function(e,t,a){return Ef(e,new bf(t),a)};function Ef(e,t,a){const n=e.getPriority().val(),s=yf(n,t.getImmediateChild(".priority"),a);let i;if(e.isLeafNode()){const n=e,i=yf(n.getValue(),t,a);return i!==n.getValue()||s!==n.getPriority().val()?new op(i,vp(s)):e}{const n=e;return i=n,s!==n.getPriority().val()&&(i=i.updatePriority(new op(s))),n.forEachChild(rp,(e,n)=>{const s=Ef(n,t.getImmediateChild(e),a);s!==n&&(i=i.updateImmediateChild(e,s))}),i}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf{constructor(e="",t=null,a={children:{},childCount:0}){this.name=e,this.parent=t,this.node=a}}function Tf(e,t){let a=t instanceof Sh?t:new Sh(t),n=e,s=Nh(a);for(;null!==s;){const e=Mc(n.node.children,s)||{children:{},childCount:0};n=new Sf(s,n,e),a=Ih(a),s=Nh(a)}return n}function Nf(e){return e.node.value}function xf(e,t){e.node.value=t,Df(e)}function If(e){return e.node.childCount>0}function Af(e,t){Ku(e.node.children,(a,n)=>{t(new Sf(a,e,n))})}function Pf(e,t,a,n){a&&t(e),Af(e,e=>{Pf(e,t,!0)})}function Rf(e){return new Sh(null===e.parent?e.name:Rf(e.parent)+"/"+e.name)}function Df(e){null!==e.parent&&function(e,t,a){const n=function(e){return void 0===Nf(e)&&!If(e)}(a),s=Lc(e.node.children,t);n&&s?(delete e.node.children[t],e.node.childCount--,Df(e)):n||s||(e.node.children[t]=a.node,e.node.childCount++,Df(e))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e.parent,e.name,e)}const Lf=/[\[\].#$\/\u0000-\u001F\u007F]/,Mf=/[\[\].#$\u0000-\u001F\u007F]/,Of=10485760,Ff=function(e){return"string"==typeof e&&0!==e.length&&!Lf.test(e)},Uf=function(e){return"string"==typeof e&&0!==e.length&&!Mf.test(e)},Bf=function(e,t,a,n){n&&void 0===t||qf($c(e,"value"),t,a)},qf=function(e,t,a){const n=a instanceof Sh?new Uh(a,e):a;if(void 0===t)throw new Error(e+"contains undefined "+qh(n));if("function"==typeof t)throw new Error(e+"contains a function "+qh(n)+" with contents = "+t.toString());if($u(t))throw new Error(e+"contains "+t.toString()+" "+qh(n));if("string"==typeof t&&t.length>Of/3&&jc(t)>Of)throw new Error(e+"contains a string greater than "+Of+" utf8 bytes "+qh(n)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let a=!1,s=!1;if(Ku(t,(t,i)=>{if(".value"===t)a=!0;else if(".priority"!==t&&".sv"!==t&&(s=!0,!Ff(t)))throw new Error(e+" contains an invalid key ("+t+") "+qh(n)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var o,r;r=t,(o=n).parts_.length>0&&(o.byteLength_+=1),o.parts_.push(r),o.byteLength_+=jc(r),Bh(o),qf(e,i,n),function(e){const t=e.parts_.pop();e.byteLength_-=jc(t),e.parts_.length>0&&(e.byteLength_-=1)}(n)}),a&&s)throw new Error(e+' contains ".value" child '+qh(n)+" in addition to actual children.")}},$f=function(e,t,a,n){if(!Uf(a))throw new Error($c(e,t)+'was an invalid path = "'+a+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},jf=function(e,t){if(".info"===Nh(t))throw new Error(e+" failed = Can't modify data under /.info/")},zf=function(e,t){const a=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Ff(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==a.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Uf(e)}(a))throw new Error($c(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Vf{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Wf(e,t){let a=null;for(let n=0;n<t.length;n++){const s=t[n],i=s.getPath();null===a||Oh(i,a.path)||(e.eventLists_.push(a),a=null),null===a&&(a={events:[],path:i}),a.events.push(s)}a&&e.eventLists_.push(a)}function Hf(e,t,a){Wf(e,a),Yf(e,e=>Oh(e,t))}function Gf(e,t,a){Wf(e,a),Yf(e,e=>Fh(e,t)||Fh(t,e))}function Yf(e,t){e.recursionDepth_++;let a=!0;for(let n=0;n<e.eventLists_.length;n++){const s=e.eventLists_[n];if(s){t(s.path)?(Kf(e.eventLists_[n]),e.eventLists_[n]=null):a=!1}}a&&(e.eventLists_=[]),e.recursionDepth_--}function Kf(e){for(let t=0;t<e.events.length;t++){const a=e.events[t];if(null!==a){e.events[t]=null;const n=a.getEventRunner();Lu&&Ou("event: "+a.toString()),Xu(n)}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf{constructor(e,t,a,n){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=a,this.appCheckProvider_=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Vf,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Rp(),this.transactionQueueTree_=new Sf,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Jf(e,t,a){if(e.stats_=ph(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Ap(e.repoInfo_,(t,a,n,s)=>{eg(e,t,a,n,s)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>tg(e,!0),0);else{if(null!=a){if("object"!=typeof a)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Rc(a)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}e.persistentConnection_=new zh(e.repoInfo_,t,(t,a,n,s)=>{eg(e,t,a,n,s)},t=>{tg(e,t)},t=>{!function(e,t){Ku(t,(t,a)=>{ag(e,t,a)})}(e,t)},e.authTokenProvider_,e.appCheckProvider_,a),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){const a=e.toString();return hh[a]||(hh[a]=t()),hh[a]}(e.repoInfo_,()=>new Op(e.stats_,e.server_)),e.infoData_=new Pp,e.infoSyncTree_=new ef({startListening:(t,a,n,s)=>{let i=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(i=nf(e.infoSyncTree_,t._path,o),setTimeout(()=>{s("ok")},0)),i},stopListening:()=>{}}),ag(e,"connected",!1),e.serverSyncTree_=new ef({startListening:(t,a,n,s)=>(e.server_.listen(t,n,a,(a,n)=>{const i=s(a,n);Gf(e.eventQueue_,t._path,i)}),[]),stopListening:(t,a)=>{e.server_.unlisten(t,a)}})}function Zf(e){const t=e.infoData_.getNode(new Sh(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Xf(e){return(t=(t={timestamp:Zf(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function eg(e,t,a,n,s){e.dataUpdateCount++;const i=new Sh(t);a=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,a):a;let o=[];if(s)if(n){const t=Fc(a,e=>vp(e));o=function(e,t,a,n){const s=mf(e,n);if(s){const n=ff(s),i=n.path,o=n.queryId,r=Mh(i,t),l=Xp.fromObject(a);return gf(e,i,new zp(Bp(o),r,l))}return[]}(e.serverSyncTree_,i,t,s)}else{const t=vp(a);o=function(e,t,a,n){const s=mf(e,n);if(null!=s){const n=ff(s),i=n.path,o=n.queryId,r=Mh(i,t);return gf(e,i,new jp(Bp(o),r,a))}return[]}(e.serverSyncTree_,i,t,s)}else if(n){const t=Fc(a,e=>vp(e));o=function(e,t,a){const n=Xp.fromObject(a);return lf(e,new zp({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}(e.serverSyncTree_,i,t)}else{const t=vp(a);o=nf(e.serverSyncTree_,i,t)}let r=i;o.length>0&&(r=cg(e,i)),Gf(e.eventQueue_,r,o)}function tg(e,t){ag(e,"connected",t),!1===t&&function(e){og(e,"onDisconnectEvents");const t=Xf(e),a=Rp();Lp(e.onDisconnect_,Th(),(n,s)=>{const i=function(e,t,a,n){return Ef(t,new wf(a,e),n)}(n,s,e.serverSyncTree_,t);Dp(a,n,i)});let n=[];Lp(a,Th(),(t,a)=>{n=n.concat(nf(e.serverSyncTree_,t,a));const s=mg(e,t);cg(e,s)}),e.onDisconnect_=Rp(),Gf(e.eventQueue_,Th(),n)}(e)}function ag(e,t,a){const n=new Sh("/.info/"+t),s=vp(a);e.infoData_.updateSnapshot(n,s);const i=nf(e.infoSyncTree_,n,s);Gf(e.eventQueue_,n,i)}function ng(e){return e.nextWriteId_++}function sg(e,t,a,n,s){og(e,"set",{path:t.toString(),value:a,priority:n});const i=Xf(e),o=vp(a,n),r=rf(e.serverSyncTree_,t),l=Cf(o,r,i),c=ng(e),d=tf(e.serverSyncTree_,t,l,c,!0);Wf(e.eventQueue_,d),e.server_.put(t.toString(),o.val(!0),(a,n)=>{const i="ok"===a;i||qu("set at "+t+" failed: "+a);const o=af(e.serverSyncTree_,c,!i);Gf(e.eventQueue_,t,o),function(e,t,a,n){t&&Xu(()=>{if("ok"===a)t(null);else{const e=(a||"error").toUpperCase();let s=e;n&&(s+=": "+n);const i=new Error(s);i.code=e,t(i)}})}(0,s,a,n)});const u=mg(e,t);cg(e,u),Gf(e.eventQueue_,u,[])}function ig(e,t,a){let n;n=".info"===Nh(t._path)?sf(e.infoSyncTree_,t,a):sf(e.serverSyncTree_,t,a),Hf(e.eventQueue_,t._path,n)}function og(e,...t){let a="";e.persistentConnection_&&(a=e.persistentConnection_.id+":"),Ou(a,...t)}function rg(e,t,a){return rf(e.serverSyncTree_,t,a)||fp.EMPTY_NODE}function lg(e,t=e.transactionQueueTree_){if(t||pg(e,t),Nf(t)){const a=ug(e,t);ac(a.length>0,"Sending zero length transaction queue");a.every(e=>0===e.status)&&function(e,t,a){const n=a.map(e=>e.currentWriteId),s=rg(e,t,n);let i=s;const o=s.hash();for(let c=0;c<a.length;c++){const e=a[c];ac(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const n=Mh(t,e.path);i=i.updateChild(n,e.currentOutputSnapshotRaw)}const r=i.val(!0),l=t;e.server_.put(l.toString(),r,n=>{og(e,"transaction put response",{path:l.toString(),status:n});let s=[];if("ok"===n){const n=[];for(let t=0;t<a.length;t++)a[t].status=2,s=s.concat(af(e.serverSyncTree_,a[t].currentWriteId)),a[t].onComplete&&n.push(()=>a[t].onComplete(null,!0,a[t].currentOutputSnapshotResolved)),a[t].unwatcher();pg(e,Tf(e.transactionQueueTree_,t)),lg(e,e.transactionQueueTree_),Gf(e.eventQueue_,t,s);for(let e=0;e<n.length;e++)Xu(n[e])}else{if("datastale"===n)for(let e=0;e<a.length;e++)3===a[e].status?a[e].status=4:a[e].status=0;else{qu("transaction at "+l.toString()+" failed: "+n);for(let e=0;e<a.length;e++)a[e].status=4,a[e].abortReason=n}cg(e,t)}},o)}(e,Rf(t),a)}else If(t)&&Af(t,t=>{lg(e,t)})}function cg(e,t){const a=dg(e,t),n=Rf(a);return function(e,t,a){if(0===t.length)return;const n=[];let s=[];const i=t.filter(e=>0===e.status),o=i.map(e=>e.currentWriteId);for(let r=0;r<t.length;r++){const i=t[r],l=Mh(a,i.path);let c,d=!1;if(ac(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===i.status)d=!0,c=i.abortReason,s=s.concat(af(e.serverSyncTree_,i.currentWriteId,!0));else if(0===i.status)if(i.retryCount>=25)d=!0,c="maxretry",s=s.concat(af(e.serverSyncTree_,i.currentWriteId,!0));else{const a=rg(e,i.path,o);i.currentInputSnapshot=a;const n=t[r].update(a.val());if(void 0!==n){qf("transaction failed: Data returned ",n,i.path);let t=vp(n);"object"==typeof n&&null!=n&&Lc(n,".priority")||(t=t.updatePriority(a.getPriority()));const r=i.currentWriteId,l=Xf(e),c=Cf(t,a,l);i.currentOutputSnapshotRaw=t,i.currentOutputSnapshotResolved=c,i.currentWriteId=ng(e),o.splice(o.indexOf(r),1),s=s.concat(tf(e.serverSyncTree_,i.path,c,i.currentWriteId,i.applyLocally)),s=s.concat(af(e.serverSyncTree_,r,!0))}else d=!0,c="nodata",s=s.concat(af(e.serverSyncTree_,i.currentWriteId,!0))}Gf(e.eventQueue_,a,s),s=[],d&&(t[r].status=2,function(e){setTimeout(e,Math.floor(0))}(t[r].unwatcher),t[r].onComplete&&("nodata"===c?n.push(()=>t[r].onComplete(null,!1,t[r].currentInputSnapshot)):n.push(()=>t[r].onComplete(new Error(c),!1,null))))}pg(e,e.transactionQueueTree_);for(let r=0;r<n.length;r++)Xu(n[r]);lg(e,e.transactionQueueTree_)}(e,ug(e,a),n),n}function dg(e,t){let a,n=e.transactionQueueTree_;for(a=Nh(t);null!==a&&void 0===Nf(n);)n=Tf(n,a),a=Nh(t=Ih(t));return n}function ug(e,t){const a=[];return hg(e,t,a),a.sort((e,t)=>e.order-t.order),a}function hg(e,t,a){const n=Nf(t);if(n)for(let s=0;s<n.length;s++)a.push(n[s]);Af(t,t=>{hg(e,t,a)})}function pg(e,t){const a=Nf(t);if(a){let e=0;for(let t=0;t<a.length;t++)2!==a[t].status&&(a[e]=a[t],e++);a.length=e,xf(t,a.length>0?a:void 0)}Af(t,t=>{pg(e,t)})}function mg(e,t){const a=Rf(dg(e,t)),n=Tf(e.transactionQueueTree_,t);return function(e,t){let a=e.parent;for(;null!==a;){if(t(a))return!0;a=a.parent}}(n,t=>{fg(e,t)}),fg(e,n),Pf(n,t=>{fg(e,t)}),a}function fg(e,t){const a=Nf(t);if(a){const n=[];let s=[],i=-1;for(let t=0;t<a.length;t++)3===a[t].status||(1===a[t].status?(ac(i===t-1,"All SENT items should be at beginning of queue."),i=t,a[t].status=3,a[t].abortReason="set"):(ac(0===a[t].status,"Unexpected transaction status in abort"),a[t].unwatcher(),s=s.concat(af(e.serverSyncTree_,a[t].currentWriteId,!0)),a[t].onComplete&&n.push(a[t].onComplete.bind(null,new Error("set"),!1,null))));-1===i?xf(t,void 0):a.length=i+1,Gf(e.eventQueue_,Rf(t),s);for(let e=0;e<n.length;e++)Xu(n[e])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gg=function(e,t){const a=vg(e),n=a.namespace;"firebase.com"===a.domain&&Bu(a.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===a.domain||Bu("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),a.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&qu("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const s="ws"===a.scheme||"wss"===a.scheme;return{repoInfo:new lh(a.host,a.secure,n,s,t,"",n!==a.subdomain),path:new Sh(a.pathString)}},vg=function(e){let t="",a="",n="",s="",i="",o=!0,r="https",l=443;if("string"==typeof e){let c=e.indexOf("//");c>=0&&(r=e.substring(0,c-1),e=e.substring(c+2));let d=e.indexOf("/");-1===d&&(d=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(d,u)),d<u&&(s=function(e){let t="";const a=e.split("/");for(let s=0;s<a.length;s++)if(a[s].length>0){let e=a[s];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(n){}t+="/"+e}return t}(e.substring(d,u)));const h=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const a of e.split("&")){if(0===a.length)continue;const n=a.split("=");2===n.length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):qu(`Invalid query segment '${a}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));c=t.indexOf(":"),c>=0?(o="https"===r||"wss"===r,l=parseInt(t.substring(c+1),10)):c=t.length;const p=t.slice(0,c);if("localhost"===p.toLowerCase())a="localhost";else if(p.split(".").length<=2)a=p;else{const e=t.indexOf(".");n=t.substring(0,e).toLowerCase(),a=t.substring(e+1),i=n}"ns"in h&&(i=h.ns)}return{host:t,port:l,domain:a,subdomain:n,secure:o,scheme:r,pathString:s,namespace:i}},bg="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",wg=function(){let e=0;const t=[];return function(a){const n=a===e;let s;e=a;const i=new Array(8);for(s=7;s>=0;s--)i[s]=bg.charAt(a%64),a=Math.floor(a/64);ac(0===a,"Cannot push at time == 0");let o=i.join("");if(n){for(s=11;s>=0&&63===t[s];s--)t[s]=0;t[s]++}else for(s=0;s<12;s++)t[s]=Math.floor(64*Math.random());for(s=0;s<12;s++)o+=bg.charAt(t[s]);return ac(20===o.length,"nextPushId: Length should be 20."),o}}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class yg{constructor(e,t,a,n){this.eventType=e,this.eventRegistration=t,this.snapshot=a,this.prevName=n}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Rc(this.snapshot.exportVal())}}class _g{constructor(e,t,a){this.eventRegistration=e,this.error=t,this.path=a}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kg{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return ac(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cg{constructor(e,t,a,n){this._repo=e,this._path=t,this._queryParams=a,this._orderByCalled=n}get key(){return Lh(this._path)?null:Ah(this._path)}get ref(){return new Eg(this._repo,this._path)}get _queryIdentifier(){const e=Ip(this._queryParams),t=Gu(e);return"{}"===t?"default":t}get _queryObject(){return Ip(this._queryParams)}isEqual(e){if(!((e=zc(e))instanceof Cg))return!1;const t=this._repo===e._repo,a=Oh(this._path,e._path),n=this._queryIdentifier===e._queryIdentifier;return t&&a&&n}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let a=e.pieceNum_;a<e.pieces_.length;a++)""!==e.pieces_[a]&&(t+="/"+encodeURIComponent(String(e.pieces_[a])));return t||"/"}(this._path)}}class Eg extends Cg{constructor(e,t){super(e,t,new Np,!1)}get parent(){const e=Rh(this._path);return null===e?null:new Eg(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Sg{constructor(e,t,a){this._node=e,this.ref=t,this._index=a}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Sh(e),a=Ng(this.ref,e);return new Sg(this._node.getChild(t),a,rp)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,(t,a)=>e(new Sg(a,Ng(this.ref,t),rp)))}hasChild(e){const t=new Sh(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Tg(e,t){return(e=zc(e))._checkNotDeleted("ref"),void 0!==t?Ng(e._root,t):e._root}function Ng(e,t){var a,n,s;return null===Nh((e=zc(e))._path)?(a="child",n="path",(s=t)&&(s=s.replace(/^\/*\.info(\/|$)/,"/")),$f(a,n,s)):$f("child","path",t),new Eg(e._repo,Dh(e._path,t))}class xg{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const a=t._queryParams.getIndex();return new yg("value",this,new Sg(e.snapshotNode,new Eg(t._repo,t._path),a))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new _g(this,e,t):null}matches(e){return e instanceof xg&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}function Ig(e,t,a,n,s){let i;if("object"==typeof n&&(i=void 0,s=n),"function"==typeof n&&(i=n),s&&s.onlyOnce){const t=a,n=(a,n)=>{ig(e._repo,e,r),t(a,n)};n.userCallback=a.userCallback,n.context=a.context,a=n}const o=new kg(a,i||void 0),r=new xg(o);return function(e,t,a){let n;n=".info"===Nh(t._path)?of(e.infoSyncTree_,t,a):of(e.serverSyncTree_,t,a),Hf(e.eventQueue_,t._path,n)}(e._repo,e,r),()=>ig(e._repo,e,r)}!function(e){ac(!$m,"__referenceConstructor has already been defined"),$m=e}(Eg),function(e){ac(!jm,"__referenceConstructor has already been defined"),jm=e}(Eg);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Ag={};let Pg=!1;function Rg(e,t,a,n,s){let i=n||e.options.databaseURL;void 0===i&&(e.options.projectId||Bu("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ou("Using default host for project ",e.options.projectId),i=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,r=gg(i,s),l=r.repoInfo;"undefined"!=typeof process&&_u&&(o=_u.FIREBASE_DATABASE_EMULATOR_HOST),o?(i=`http://${o}?ns=${l.namespace}`,r=gg(i,s),l=r.repoInfo):r.repoInfo.secure;const c=new ah(e.name,e.options,t);zf("Invalid Firebase Database URL",r),Lh(r.path)||Bu("Database URL must point to the root of a Firebase Database (not including a child path).");const d=function(e,t,a,n){let s=Ag[t.name];s||(s={},Ag[t.name]=s);let i=s[e.toURLString()];i&&Bu("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return i=new Qf(e,Pg,a,n),s[e.toURLString()]=i,i}(l,e,c,new th(e,a));return new Dg(d,e)}class Dg{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Jf(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Eg(this._repo,Th())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const a=Ag[t];a&&a[e.key]===e||Bu(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete a[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Bu("Cannot call "+e+" on a deleted database.")}}zh.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},zh.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e){Eu=ou,tu(new Vc("database",(e,{instanceIdentifier:t})=>Rg(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),cu(ku,Cu,e),cu(ku,Cu,"esm2020")}();const Lg=function(e=lu(),t){const a=au(e,"database").getImmediate({identifier:t});if(!a._instanceStarted){const e=fc("database");e&&function(e,t,a,n={}){e=zc(e),e._checkNotDeleted("useEmulator");const s=`${t}:${a}`,i=e._repoInternal;if(e._instanceStarted){if(s===e._repoInternal.repoInfo_.host&&Uc(n,i.repoInfo_.emulatorOptions))return;Bu("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)n.mockUserToken&&Bu('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new nh(nh.OWNER);else if(n.mockUserToken){const t="string"==typeof n.mockUserToken?n.mockUserToken:yc(n.mockUserToken,e.app.options.projectId);o=new nh(t)}bc(t)&&(wc(t),Cc("Database",!0));!function(e,t,a,n){const s=t.lastIndexOf(":"),i=bc(t.substring(0,s));e.repoInfo_=new lh(t,i,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,a),n&&(e.authTokenProvider_=n)}(i,s,n,o)}(a,...e)}return a}(ru({projectId:"mozoqr-7d32c",apiKey:"AIzaSyCecfSTfyxk3D2X4XsLaSGkckvf-OvhFZA",authDomain:"mozoqr-7d32c.firebaseapp.com",databaseURL:"https://mozoqr-7d32c-default-rtdb.firebaseio.com",storageBucket:"mozoqr-7d32c.appspot.com",messagingSenderId:"175482362472",appId:"1:175482362472:android:f2589ca9ec71fd0cb6b9dd"}));class Mg{constructor(e){this.waiterId=e,this.listeners=new Map,this.activeCalls=new Map}startListening(){console.log(`⚡ Iniciando ULTRA FAST listener para mozo ${this.waiterId}`);const e=function(e,t,a,n){return Ig(e,0,t,a,n)}(Tg(Lg,`waiters/${this.waiterId}/calls`),e=>{this.handleSnapshot(e)},e=>{console.error("🚨 Error en listener:",e),this.handleError(e)});this.listeners.set("main",e),console.log("⚡ ULTRA FAST WebSocket conectado")}handleSnapshot(e){const t=e.val();if(!t)return void this.clearAllCalls();const a=new Set;Object.entries(t).forEach(([e,t])=>{if(a.add(e),this.activeCalls.has(e)){const a=this.activeCalls.get(e);a.status!==t.status&&(console.log(`🔄 Firebase: Llamada actualizada Mesa ${t.table_number}: ${a.status} → ${t.status}`),this.onCallUpdated({id:e,...t}))}else this.onNewCall({id:e,...t});this.activeCalls.set(e,t)}),this.activeCalls.forEach((e,t)=>{a.has(t)||(this.onCallRemoved(t),this.activeCalls.delete(t))})}onNewCall(e){console.debug("⚡ NUEVA LLAMADA ULTRA RÁPIDA (onNewCall):",e&&e.id,e),"pending"===e.status?(console.log("🔔 Enviando notificaciones push para llamada nueva (pending)"),this.playUltraFastSound(),this.vibrateUltraFast(),this.scheduleNativeNotification(e),this.showBrowserNotification(e)):console.log("🚫 NO enviando notificaciones push para status:",e.status),this.addCallToUI(e),window.dispatchEvent(new CustomEvent("newWaiterCall",{detail:e}))}scheduleNativeNotification(e){try{G&&G.isPluginAvailable&&G.isPluginAvailable("LocalNotifications")&&j(async()=>{const{LocalNotifications:e}=await import("./index-NWj49HSU.js");return{LocalNotifications:e}},__vite__mapDeps([6,1,2])).then(({LocalNotifications:t})=>{t.schedule({notifications:[{title:`Mesa ${e.table_number} · ${e.urgency?e.urgency.toUpperCase():""}`,body:e.message||"Solicita atención",id:Number(Date.now()%1e5),extra:{callId:e.id,source:"ultra-fast-realtime"},schedule:null,smallIcon:void 0}]}).then(()=>{console.log("✅ Local notification scheduled for native platform (ultra-fast call)")}).catch(e=>console.warn("⚠️ Error scheduling local notification:",e))}).catch(e=>{console.warn("⚠️ Error importing LocalNotifications in scheduleNativeNotification:",e)})}catch(t){console.warn("⚠️ Exception scheduling native notification:",t)}}onCallUpdated(e){console.log("⚡ Llamada actualizada ULTRA RÁPIDA:",e),this.updateCallInUI(e),"acknowledged"===e.status&&this.showStatusUpdate(`Mesa ${e.table_number} - Atendiendo`),window.dispatchEvent(new CustomEvent("updateCallStatus",{detail:e}))}onCallRemoved(e){console.log("⚡ Llamada completada ULTRA RÁPIDA:",e),this.removeCallFromUI(e),this.showStatusUpdate("Servicio completado"),window.dispatchEvent(new CustomEvent("removeCall",{detail:{callId:e}}))}playUltraFastSound(){try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),a=e.createGain();t.connect(a),a.connect(e.destination),t.frequency.setValueAtTime(800,e.currentTime),t.frequency.setValueAtTime(400,e.currentTime+.1),a.gain.setValueAtTime(.3,e.currentTime),a.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),t.start(e.currentTime),t.stop(e.currentTime+.3)}catch(e){const t=new Audio;t.src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+nfvnUjBjd+zO/eizEIDGKw5+mqWRMJRZzp4b5+JgU2jdXzzX4tBSF1xe/ejzQIElyx6OyrYRYJSKXi67RiHAY8k9nyyXkpBSR+zO/ijDEIDWOz6OyrXRQIR6Hn4L55KAU5jNTx0IAvBh1qtOnnqlkSCUig5OqyYhsGPJHY8sp7KgUle8vt3o4yBxFYr+ftrWIaBjeL0/LNfjAGIn3M7+CNMA==",t.volume=.7,t.play().catch(e=>console.log("Audio bloqueado por navegador"))}}vibrateUltraFast(){navigator.vibrate&&navigator.vibrate([100,50,100,50,200])}showUltraFastNotification(e){const t=document.createElement("div");t.className="ultra-fast-notification",t.innerHTML=`\n            <div class="notification-header">\n                <h3>⚡ Mesa ${e.table_number}</h3>\n                <span class="urgency-${e.urgency||"normal"}">${e.urgency||"normal"}</span>\n                <span class="ultra-fast-badge">ULTRA FAST</span>\n            </div>\n            <div class="notification-body">\n                <p>${e.message||"Solicita atención"}</p>\n                <small>⚡ ${new Date(e.called_at||e.timestamp).toLocaleTimeString()}</small>\n            </div>\n            <div class="notification-actions">\n                <button onclick="window.ultraFastNotifications.acknowledgeCall('${e.id}')" \n                        class="btn-acknowledge-fast">⚡ Atender</button>\n                <button onclick="this.parentElement.parentElement.remove()" \n                        class="btn-dismiss">✕</button>\n            </div>\n        `,document.body.appendChild(t),requestAnimationFrame(()=>{t.classList.add("show")}),setTimeout(()=>{t.parentElement&&(t.classList.add("hiding"),setTimeout(()=>t.remove(),200))},8e3);try{G&&G.isPluginAvailable&&G.isPluginAvailable("LocalNotifications")&&j(async()=>{const{LocalNotifications:e}=await import("./index-NWj49HSU.js");return{LocalNotifications:e}},__vite__mapDeps([6,1,2])).then(({LocalNotifications:t})=>{t.schedule({notifications:[{title:`Mesa ${e.table_number} · ${e.urgency?e.urgency.toUpperCase():""}`,body:e.message||"Solicita atención",id:Number(Date.now()%1e5),extra:{callId:e.id,source:"ultra-fast-realtime"},schedule:null,smallIcon:void 0}]}).then(()=>{console.log("✅ Local notification scheduled for native platform (ultra-fast call)")}).catch(e=>console.warn("⚠️ Error scheduling local notification:",e))}).catch(e=>{console.warn("⚠️ Error importing LocalNotifications in showUltraFastNotification:",e)})}catch(a){console.warn("⚠️ Exception scheduling native notification:",a)}}showBrowserNotification(e){if("granted"===Notification.permission){const t=new Notification(`⚡ Mesa ${e.table_number}`,{body:`${e.message||"Solicita atención"} (ULTRA FAST)`,icon:"/favicon.ico",tag:`ultra-fast-call-${e.id}`,requireInteraction:!0});t.onclick=()=>{window.focus(),t.close();const a=document.getElementById(`call-${e.id}`);a&&(a.scrollIntoView({behavior:"smooth"}),a.classList.add("highlight"))}}}addCallToUI(e){try{console.debug("dispatch ultraFastAddCall",e&&e.id,e),window.dispatchEvent(new CustomEvent("ultraFastAddCall",{detail:e}))}catch(t){console.warn("⚠️ ultraFastAddCall dispatch failed:",t)}}updateCallInUI(e){const t=document.getElementById(`call-${e.id}`);if(t){t.className=`ultra-fast-call-item urgency-${e.urgency||"normal"} status-${e.status}`;let a=t.querySelector(".status-indicator");a||(a=document.createElement("div"),a.className="status-indicator",t.querySelector(".call-header").appendChild(a)),a.textContent=e.status}}removeCallFromUI(e){const t=document.getElementById(`call-${e}`);t&&(t.classList.add("removing"),setTimeout(()=>t.remove(),150))}clearAllCalls(){const e=document.getElementById("calls-container");if(e){e.querySelectorAll(".ultra-fast-call-item").forEach(e=>e.remove())}this.activeCalls.clear(),window.dispatchEvent(new CustomEvent("clearAllCalls"))}async acknowledgeCall(e){try{const n=localStorage.getItem("token");let s=null;try{const t=await j(()=>Promise.resolve().then(()=>Xl),void 0),a=t&&(t.default||t);if(a&&"function"==typeof a.acknowledgCall)s=await a.acknowledgCall(e),console.log("🔁 Acknowledge call (via service) response:",s);else{if(!a||"function"!=typeof a.acknowledgeCall)throw new Error("No acknowledge helper found in waiterCallsService");s=await a.acknowledgeCall(e),console.log("🔁 Acknowledge call (via service.named) response:",s)}}catch(t){try{s=await fetch(`https://mozoqr.com/api/waiter/calls/${e}/acknowledge`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}),console.log("🔁 Acknowledge call (via fetch) response status:",s.status)}catch(a){throw a}}let i=!1;if(s&&"boolean"==typeof s.ok?i=s.ok:s&&"boolean"==typeof s.success?i=!1!==s.success:s&&(i=!0),!i){const e=s&&(s.status||s.code||"unknown");throw new Error(`Acknowledge failed: ${e}`)}console.log("⚡ Llamada reconocida ULTRA RÁPIDO");try{window.dispatchEvent(new CustomEvent("callAcknowledged",{detail:{callId:e}}))}catch(t){}}catch(n){console.error("Error reconociendo llamada:",n),this.showError("Error al reconocer la llamada")}}async completeCall(e){try{const n=localStorage.getItem("token");let s=null;try{const t=await j(()=>Promise.resolve().then(()=>Xl),void 0),a=t&&(t.default||t);if(a&&"function"==typeof a.completeCall)s=await a.completeCall(e),console.log("🔁 Complete call (via service) response:",s);else{if(!a||"function"!=typeof a.complete)throw new Error("No complete helper found in waiterCallsService");s=await a.complete(e),console.log("🔁 Complete call (via service.named) response:",s)}}catch(t){try{s=await fetch(`https://mozoqr.com/api/waiter/calls/${e}/complete`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}),console.log("🔁 Complete call (via fetch) response status:",s.status)}catch(a){throw a}}let i=!1;if(s&&"boolean"==typeof s.ok?i=s.ok:s&&"boolean"==typeof s.success?i=!1!==s.success:s&&(i=!0),!i){const e=s&&(s.status||s.code||"unknown");throw new Error(`Complete failed: ${e}`)}console.log("⚡ Llamada completada ULTRA RÁPIDO");try{window.dispatchEvent(new CustomEvent("removeCall",{detail:{callId:e}}))}catch(t){}try{const{useNotificationsStore:t}=await j(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>er);return{useNotificationsStore:e}},void 0);t().removeNotification(e)}catch(t){console.warn("⚠️ Unable to remove notification from store after complete:",t)}}catch(n){console.error("Error completando llamada:",n),this.showError("Error al completar la llamada")}}stopListening(){this.listeners.forEach((e,t)=>{const a=Tg(Lg,`waiters/${this.waiterId}/calls`);var n;ig((n=a)._repo,n,null)}),this.listeners.clear(),console.log("🛑 ULTRA FAST listener detenido")}async createTestCall(){console.log("🧪 Creando llamada de prueba...");try{const e=function(e,t){e=zc(e),jf("push",e._path),Bf("push",t,e._path,!0);const a=Zf(e._repo),n=wg(a),s=Ng(e,n),i=Ng(e,n);let o;return o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}(Tg(Lg,`waiters/${this.waiterId}/calls`)),t={id:e.key,table_number:Math.floor(20*Math.random())+1,message:"Llamada de prueba - Solicita la cuenta",timestamp:Date.now(),status:"pending",urgency:"high",called_at:Date.now()};return await function(e,t){e=zc(e),jf("set",e._path),Bf("set",t,e._path,!1);const a=new vc;return sg(e._repo,e._path,t,null,a.wrapCallback(()=>{})),a.promise}(e,t),console.log("✅ Llamada de prueba creada:",t),t}catch(e){throw console.error("❌ Error creando llamada de prueba:",e),e}}handleError(e){console.error("🚨 Error en ULTRA FAST listener:",e),this.showError("Error de conexión en tiempo real")}showError(e){const t=document.createElement("div");t.className="ultra-fast-error",t.innerHTML=`\n            <p>❌ ${e}</p>\n            <p>Reintentando automáticamente...</p>\n            <button onclick="this.remove()">Cerrar</button>\n        `,document.body.appendChild(t),setTimeout(()=>{t.parentElement&&t.remove()},5e3),setTimeout(()=>{this.startListening()},2e3)}}let Og=null;function Fg(e){"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission();try{G&&G.isPluginAvailable&&G.isPluginAvailable("LocalNotifications")&&j(async()=>{const{LocalNotifications:e}=await import("./index-NWj49HSU.js");return{LocalNotifications:e}},__vite__mapDeps([6,1,2])).then(({LocalNotifications:e})=>{e.requestPermissions().then(e=>{console.log("LocalNotifications permissions:",e)}).catch(e=>{console.warn("Error pidiendo permisos LocalNotifications:",e)}),e.createChannel&&e.createChannel({id:"mozo_waiter",name:"Mozo - Llamadas",importance:5,visibility:1,description:"Notificaciones de llamadas y eventos importantes para mozos"}).then(()=>{console.log("✅ Canal mozo_waiter creado desde UltraFastWaiterNotifications")}).catch(e=>{console.warn("⚠️ Error creando canal mozo_waiter:",e)})}).catch(e=>console.warn("⚠️ No se pudo importar LocalNotifications:",e))}catch(t){console.warn("⚠️ Excepción al preparar LocalNotifications:",t)}return Og&&Og.stopListening(),Og=new Mg(e),Og.startListening(),window.ultraFastNotifications=Og,console.log("⚡ ULTRA FAST notifications inicializadas"),Og}window.addEventListener("beforeunload",()=>{Og&&Og.stopListening()});const Ug=document.createElement("style");Ug.textContent="\n.ultra-fast-notification {\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    background: linear-gradient(135deg, #ff6b6b, #ee5a24);\n    color: white;\n    border-radius: 12px;\n    padding: 16px;\n    box-shadow: 0 8px 25px rgba(238, 90, 36, 0.3);\n    z-index: 10000;\n    max-width: 350px;\n    transform: translateX(400px);\n    opacity: 0;\n    transition: all 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);\n}\n\n.ultra-fast-notification.show {\n    transform: translateX(0);\n    opacity: 1;\n}\n\n.ultra-fast-notification.hiding {\n    transform: translateX(400px);\n    opacity: 0;\n}\n\n.ultra-fast-call-item {\n    border: 2px solid #ff6b6b;\n    border-radius: 12px;\n    padding: 16px;\n    margin: 8px 0;\n    background: linear-gradient(135deg, #fff, #f8f9fa);\n    opacity: 0;\n    transform: translateY(30px) scale(0.95);\n    transition: all 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);\n    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.1);\n}\n\n.ultra-fast-call-item.show {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n}\n\n.ultra-fast-call-item.removing {\n    opacity: 0;\n    transform: translateX(-100%) scale(0.8);\n}\n\n.ultra-fast-call-item.urgency-high {\n    border-color: #e74c3c;\n    background: linear-gradient(135deg, #fff5f5, #fdedec);\n    animation: pulse-ultra 1s infinite;\n}\n\n.ultra-fast-badge {\n    background: linear-gradient(45deg, #00d2ff, #3a7bd5);\n    color: white;\n    padding: 2px 8px;\n    border-radius: 10px;\n    font-size: 10px;\n    font-weight: bold;\n    text-transform: uppercase;\n}\n\n.btn-acknowledge-ultra, .btn-acknowledge-fast {\n    background: linear-gradient(135deg, #00d2ff, #3a7bd5);\n    color: white;\n    border: none;\n    padding: 10px 20px;\n    border-radius: 25px;\n    cursor: pointer;\n    margin-right: 10px;\n    font-weight: bold;\n    transition: all 0.2s ease;\n}\n\n.btn-acknowledge-ultra:hover, .btn-acknowledge-fast:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 5px 15px rgba(0, 210, 255, 0.3);\n}\n\n.btn-complete-ultra {\n    background: linear-gradient(135deg, #55a3ff, #3a7bd5);\n    color: white;\n    border: none;\n    padding: 10px 20px;\n    border-radius: 25px;\n    cursor: pointer;\n    font-weight: bold;\n    transition: all 0.2s ease;\n}\n\n.btn-complete-ultra:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 5px 15px rgba(85, 163, 255, 0.3);\n}\n\n.ultra-fast-error {\n    position: fixed;\n    top: 20px;\n    left: 20px;\n    background: linear-gradient(135deg, #e74c3c, #c0392b);\n    color: white;\n    padding: 16px;\n    border-radius: 12px;\n    z-index: 10000;\n    box-shadow: 0 8px 25px rgba(231, 76, 60, 0.3);\n}\n\n.status-update {\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    background: linear-gradient(135deg, #2ecc71, #27ae60);\n    color: white;\n    padding: 12px 24px;\n    border-radius: 25px;\n    z-index: 9999;\n    transform: translateY(100px);\n    opacity: 0;\n    transition: all 0.3s ease;\n}\n\n.status-update.show {\n    transform: translateY(0);\n    opacity: 1;\n}\n\n.status-indicator {\n    background: #3a7bd5;\n    color: white;\n    padding: 2px 8px;\n    border-radius: 10px;\n    font-size: 12px;\n    text-transform: uppercase;\n}\n\n.no-calls {\n    text-align: center;\n    color: #7f8c8d;\n    font-style: italic;\n    padding: 40px;\n}\n\n.highlight {\n    animation: highlight-flash 2s ease;\n}\n\n@keyframes pulse-ultra {\n    0%, 100% { \n        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.1);\n    }\n    50% { \n        box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);\n        transform: scale(1.02);\n    }\n}\n\n@keyframes highlight-flash {\n    0%, 100% { background-color: transparent; }\n    50% { background-color: rgba(255, 235, 59, 0.3); }\n}\n\n/* Integración con estilos del Dashboard existente */\n.notification-item.ultra-fast {\n    border: 2px solid #ff6b6b;\n    background: linear-gradient(135deg, #fff, #f8f9fa);\n    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.1);\n}\n\n.notification-item.ultra-fast.urgent {\n    border-color: #e74c3c;\n    animation: pulse-ultra 1s infinite;\n}\n",document.head.appendChild(Ug);const Bg={class:"modal-header"},qg={class:"modal-body"},$g={key:0,class:"loading-state"},jg={key:1},zg={key:0,class:"selection-summary"},Vg={class:"tables-grid"},Wg=["onClick"],Hg={class:"table-checkbox"},Gg=["checked","onChange"],Yg={class:"table-info"},Kg={class:"table-number"},Qg={key:0,class:"table-name"},Jg={class:"table-details"},Zg={key:0},Xg={key:1},ev={key:0,class:"empty-state"},tv={key:1,class:"quick-actions"},av={class:"modal-footer"},nv=["disabled"],sv={__name:"TableSelector",props:{availableTables:{type:Array,default:()=>[]},assignedTables:{type:Array,default:()=>[]}},emits:["close","tables-selected"],setup(e,{emit:n}){const i=e,f=n,g=t([]),b=t(!1),w=a(()=>i.availableTables||[]),y=e=>{const t=g.value.indexOf(e);-1===t?g.value.push(e):g.value.splice(t,1)},_=()=>{g.value=w.value.map(e=>e.id)},k=()=>{g.value=[]},C=()=>{console.log("🎯 TableSelector: Confirmando selección de mesas:",g.value),f("tables-selected",g.value)};return s(()=>{console.log("🏠 TableSelector mounted"),console.log("📋 Mesas disponibles recibidas:",i.availableTables),console.log("📋 Mesas asignadas recibidas:",i.assignedTables),console.log("Available tables:",w.value),console.log("Assigned tables:",i.assignedTables)}),(e,t)=>(r(),o("div",{class:"modal-overlay",onClick:t[4]||(t[4]=t=>e.$emit("close"))},[l("div",{class:"modal-content",onClick:t[3]||(t[3]=h(()=>{},["stop"]))},[l("div",Bg,[t[6]||(t[6]=l("h3",null,[l("i",{class:"fas fa-table"}),v(" Seleccionar Mesas para Activar ")],-1)),l("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},t[5]||(t[5]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",qg,[b.value?(r(),o("div",$g,t[7]||(t[7]=[l("div",{class:"spinner"},null,-1),l("p",null,"Cargando mesas disponibles...",-1)]))):(r(),o("div",jg,[g.value.length>0?(r(),o("div",zg,[l("strong",null,d(g.value.length)+" mesa(s) seleccionada(s)",1)])):c("",!0),l("div",Vg,[(r(!0),o(p,null,m(w.value,e=>(r(),o("div",{key:e.id,class:u(["table-card",{selected:g.value.includes(e.id)}]),onClick:t=>y(e.id)},[l("div",Hg,[l("input",{type:"checkbox",checked:g.value.includes(e.id),onClick:t[1]||(t[1]=h(()=>{},["stop"])),onChange:t=>y(e.id)},null,40,Gg)]),l("div",Yg,[l("div",Kg,"Mesa "+d(e.number),1),e.name&&e.name!==`Mesa ${e.number}`?(r(),o("div",Qg,d(e.name),1)):c("",!0),l("div",Jg,[e.capacity?(r(),o("span",Zg,[t[8]||(t[8]=l("i",{class:"fas fa-users"},null,-1)),v(" "+d(e.capacity)+" personas ",1)])):c("",!0),e.location?(r(),o("span",Xg,[t[9]||(t[9]=l("i",{class:"fas fa-map-marker-alt"},null,-1)),v(" "+d(e.location),1)])):c("",!0)])])],10,Wg))),128)),0===w.value.length?(r(),o("div",ev,t[10]||(t[10]=[l("i",{class:"fas fa-table"},null,-1),l("p",null,"No hay mesas disponibles para activar",-1),l("small",null,"Todas las mesas ya están asignadas a otros mozos",-1)]))):c("",!0)]),w.value.length>0?(r(),o("div",tv,[l("button",{onClick:_,class:"quick-btn"},[t[11]||(t[11]=l("i",{class:"fas fa-check-double"},null,-1)),v(" Seleccionar Todas ("+d(w.value.length)+") ",1)]),g.value.length>0?(r(),o("button",{key:0,onClick:k,class:"quick-btn"},t[12]||(t[12]=[l("i",{class:"fas fa-times"},null,-1),v(" Deseleccionar Todas ")]))):c("",!0)])):c("",!0)]))]),l("div",av,[l("button",{onClick:t[2]||(t[2]=t=>e.$emit("close")),class:"btn btn-secondary"}," Cancelar "),l("button",{onClick:C,class:"btn btn-primary",disabled:0===g.value.length||b.value},[t[13]||(t[13]=l("i",{class:"fas fa-check"},null,-1)),v(" Activar "+d(g.value.length)+" Mesa(s) ",1)],8,nv)])])]))}},iv=tr(sv,[["__scopeId","data-v-f6fe2c8a"]]),ov={class:"business-selector"},rv={key:0,class:"business-dropdown"},lv={class:"business-details"},cv={class:"business-name"},dv={class:"business-subtitle"},uv={class:"dropdown-arrow"},hv={key:0,class:"dropdown-menu"},pv={class:"dropdown-header"},mv={class:"businesses-list"},fv=["onClick"],gv={class:"business-info"},vv={class:"business-name"},bv={class:"business-address"},wv={key:0,class:"current-indicator"},yv={class:"dropdown-footer"},_v={key:1,class:"no-business-state"},kv={class:"no-business-content"},Cv={class:"modal-content"},Ev={class:"modal-body"},Sv={class:"form-group"},Tv=["disabled"],Nv={class:"modal-footer"},xv=["disabled"],Iv=["disabled"],Av={key:0,class:"fas fa-spinner fa-spin"},Pv={key:1},Rv={__name:"BusinessSelector",emits:["business-changed","businesses-loaded"],setup(e,{expose:a,emit:n}){const f=n,g=t([]),b=t(null),w=t(!1),y=t(!1),_=t(""),k=t(!1),C=t(!1),T=async()=>{C.value=!0,console.log("🏢 Cargando negocios del mozo...");try{const e=await Zl.getWaiterBusinesses();console.log("📋 Respuesta de negocios:",e),e.success?(g.value=e.businesses||[],e.active_business_id&&g.value.length>0?b.value=g.value.find(t=>t.id===e.active_business_id)||null:b.value=e.active_business||null,console.log("✅ Negocios cargados:",g.value.length,g.value),console.log("🔍 active_business_id desde API:",e.active_business_id),console.log("🎯 Negocio activo encontrado:",b.value),f("businesses-loaded",{businesses:g.value,activeBusiness:b.value,needsBusiness:e.needs_business||0===g.value.length})):(console.error("❌ Error en respuesta de negocios:",e.message),Jo(e.message||"Error cargando negocios"))}catch(e){console.error("💥 Error loading businesses:",e),Jo("Error cargando negocios")}finally{C.value=!1}},N=async()=>{if(_.value.trim()){k.value=!0;try{const e=await Zl.joinBusinessWithCode(_.value.trim());e.success?(Qo(e.message||"Te has unido al negocio exitosamente"),_.value="",x(),await T()):Jo(e.message||"Error uniéndose al negocio")}catch(e){console.error("Error joining business:",e),Jo("Error uniéndose al negocio")}finally{k.value=!1}}},x=()=>{y.value=!1,_.value="",k.value=!1},I=e=>{e.target.closest(".business-dropdown")||(w.value=!1)};return s(async()=>{await T(),document.addEventListener("click",I)}),i(()=>{document.removeEventListener("click",I)}),a({loadBusinesses:T,getCurrentBusiness:()=>b.value}),(e,t)=>{var a;return r(),o("div",ov,[g.value.length>0?(r(),o("div",rv,[l("div",{class:"current-business",onClick:t[0]||(t[0]=e=>w.value=!w.value)},[t[5]||(t[5]=l("div",{class:"business-icon"},[l("i",{class:"fas fa-building"})],-1)),l("div",lv,[l("div",cv,d((null==(a=b.value)?void 0:a.name)||"Seleccionar Negocio"),1),l("div",dv,d(g.value.length)+" negocio"+d(1!==g.value.length?"s":""),1)]),l("div",uv,[l("i",{class:u(["fas fa-chevron-down",{rotated:w.value}])},null,2)])]),w.value?(r(),o("div",hv,[l("div",pv,[t[7]||(t[7]=l("h4",null,"Mis Negocios",-1)),l("button",{onClick:t[1]||(t[1]=e=>w.value=!1),class:"close-btn"},t[6]||(t[6]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",mv,[(r(!0),o(p,null,m(g.value,e=>{var a,n;return r(),o("button",{key:e.id,onClick:t=>(async e=>{try{const t=await Zl.setActiveWaiterBusiness(e.id);t.success?(b.value=e,w.value=!1,Qo(`Negocio "${e.name}" seleccionado`),f("business-changed",e)):Jo(t.message||"Error seleccionando negocio")}catch(t){console.error("Error selecting business:",t),Jo("Error seleccionando negocio")}})(e),class:u(["business-item",{active:(null==(a=b.value)?void 0:a.id)===e.id}])},[l("div",gv,[l("div",vv,d(e.name),1),l("div",bv,d(e.address||"Sin dirección"),1)]),(null==(n=b.value)?void 0:n.id)===e.id?(r(),o("div",wv,t[8]||(t[8]=[l("i",{class:"fas fa-check"},null,-1)]))):c("",!0)],10,fv)}),128))]),l("div",yv,[l("button",{onClick:t[2]||(t[2]=e=>{y.value=!0,w.value=!1}),class:"join-btn"},t[9]||(t[9]=[l("i",{class:"fas fa-plus"},null,-1),v(" Unirse a nuevo negocio ")]))])])):c("",!0)])):(r(),o("div",_v,[l("div",kv,[t[11]||(t[11]=l("i",{class:"fas fa-building"},null,-1)),t[12]||(t[12]=l("h3",null,"Sin negocios asignados",-1)),t[13]||(t[13]=l("p",null,"Necesitas unirte a un negocio para empezar a trabajar",-1)),l("button",{onClick:t[3]||(t[3]=e=>y.value=!0),class:"join-btn primary"},t[10]||(t[10]=[l("i",{class:"fas fa-plus"},null,-1),v(" Unirse a negocio ")]))])])),y.value?(r(),o("div",{key:2,class:"modal-overlay",onClick:h(x,["self"])},[l("div",Cv,[l("div",{class:"modal-header"},[t[15]||(t[15]=l("h3",null,"Unirse a negocio",-1)),l("button",{onClick:x,class:"close-btn"},t[14]||(t[14]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",Ev,[t[17]||(t[17]=l("p",null,"Ingresa el código del negocio al que deseas unirte:",-1)),l("form",{onSubmit:h(N,["prevent"])},[l("div",Sv,[t[16]||(t[16]=l("label",{for:"businessCode"},"Código del negocio:",-1)),E(l("input",{id:"businessCode","onUpdate:modelValue":t[4]||(t[4]=e=>_.value=e),type:"text",class:"form-input",placeholder:"Ej: ABC123",disabled:k.value,required:""},null,8,Tv),[[S,_.value]])])],32)]),l("div",Nv,[l("button",{onClick:x,class:"btn btn-secondary",disabled:k.value}," Cancelar ",8,xv),l("button",{onClick:N,class:"btn btn-primary",disabled:k.value||!_.value.trim()},[k.value?(r(),o("i",Av)):(r(),o("span",Pv,"Unirse"))],8,Iv)])])])):c("",!0)])}}},Dv=tr(Rv,[["__scopeId","data-v-24e5cdd8"]]),Lv={class:"business-tables-manager"},Mv={class:"manager-header"},Ov={class:"manager-stats"},Fv={class:"stat-item"},Uv={class:"stat-number"},Bv={class:"stat-item success"},qv={class:"stat-number"},$v={class:"stat-item warning"},jv={class:"stat-number"},zv={class:"stat-item danger"},Vv={class:"stat-number"},Wv={class:"tables-container"},Hv={key:0,class:"loading-state"},Gv={key:1,class:"tables-grid"},Yv={class:"table-header"},Kv={class:"table-number"},Qv={class:"table-status"},Jv={key:0,class:"fas fa-exclamation-triangle status-icon urgent",title:"Tiene llamadas pendientes"},Zv={key:1,class:"fas fa-volume-mute status-icon silenced",title:"Silenciada"},Xv={key:2,class:"fas fa-check status-icon active",title:"Activa y asignada"},eb={key:3,class:"fas fa-ban status-icon silenced",title:"Mesa silenciada"},tb={key:4,class:"fas fa-circle status-icon available",title:"Disponible"},ab={class:"table-info"},nb={key:0,class:"table-name"},sb={class:"table-details"},ib={key:0},ob={key:1},rb={key:1,class:"assigned-waiter"},lb={class:"table-actions"},cb=["onClick"],db=["onClick"],ub=["onClick"],hb=["onClick"],pb={key:2,class:"no-actions"},mb={key:0},fb={key:1},gb={key:0,class:"empty-state"},vb={class:"quick-actions"},bb=["disabled"],wb=tr({__name:"BusinessTablesManager",props:{businessId:{type:[String,Number],required:!0},businessName:{type:String,default:"Negocio"}},emits:["tables-updated"],setup(e,{expose:n,emit:i}){const h=e,f=i,g=t([]),b=t(!1),w=a(()=>g.value.length),y=a(()=>g.value.filter(e=>e.assigned_to_me).length),_=a(()=>g.value.filter(e=>!e.assigned_to_me&&!e.is_silenced).length),k=a(()=>g.value.filter(e=>e.is_silenced).length),C=a(()=>g.value.filter(e=>e.assigned_to_me)),E=a(()=>g.value.filter(e=>!e.assigned_to_me&&!e.is_silenced)),S=async()=>{b.value=!0,console.log("🏢 Cargando mesas del negocio:",h.businessId);try{const e=await Zl.getWaiterBusinessTables(h.businessId);console.log("📋 Respuesta de mesas del negocio:",e),e.success?(g.value=e.tables||[],console.log("✅ Mesas cargadas:",g.value.length,g.value),g.value.forEach((e,t)=>{t<3&&console.log(`🔍 Mesa ${e.number}:`,{id:e.id,assigned_to_me:e.assigned_to_me,is_silenced:e.is_silenced,assigned_waiter:e.assigned_waiter})}),console.log("📊 Estadísticas calculadas:"),console.log("  - Total mesas:",g.value.length),console.log("  - Asignadas a mí:",g.value.filter(e=>e.assigned_to_me).length),console.log("  - Disponibles:",g.value.filter(e=>!e.assigned_to_me&&!e.is_silenced).length),console.log("  - Silenciadas:",g.value.filter(e=>e.is_silenced).length),f("tables-updated",g.value)):(console.error("❌ Error en respuesta:",e.message),Jo(e.message||"Error cargando mesas del negocio"))}catch(e){console.error("💥 Error loading business tables:",e),Jo("Error cargando mesas del negocio")}finally{b.value=!1}},T=async()=>{await S()},N=async()=>{var e;const t=E.value;if(0!==t.length)try{if(await Zo("¿Tomar todas las mesas disponibles?",`Se asignarán ${t.length} mesas a tu cuenta.`,"Tomar todas","Cancelar","info")){const a=t.map(e=>e.id),n=await Zl.activateMultipleTables(a);n.success?(Qo(`${(null==(e=n.summary)?void 0:e.successful)||t.length} mesas asignadas`),await S()):Jo(n.message||"Error asignando mesas")}}catch(a){console.error("Error activating multiple tables:",a),Jo("Error asignando mesas múltiples")}},x=async()=>{var e;const t=C.value;if(0!==t.length)try{if(await Zo("¿Desasignarte de todas las mesas?",`Se desasignarán ${t.length} mesas de tu cuenta.`,"Desasignar todas","Cancelar","warning")){const a=t.map(e=>e.id),n=await Zl.deactivateMultipleTables(a);n.success?(Qo(`${(null==(e=n.summary)?void 0:e.successful)||t.length} mesas desasignadas`),await S()):Jo(n.message||"Error desasignando mesas")}}catch(a){console.error("Error deactivating multiple tables:",a),Jo("Error desasignando mesas múltiples")}};return s(()=>{console.log("🏢 BusinessTablesManager mounted with businessId:",h.businessId),S()}),n({loadBusinessTables:S,refreshTables:T}),(t,a)=>(r(),o("div",Lv,[l("div",Mv,[l("h3",null,[a[0]||(a[0]=l("i",{class:"fas fa-table"},null,-1)),v(" Mesas de "+d(e.businessName),1)]),l("div",Ov,[l("div",Fv,[l("div",Uv,d(w.value),1),a[1]||(a[1]=l("div",{class:"stat-label"},"Total mesas",-1))]),l("div",Bv,[l("div",qv,d(y.value),1),a[2]||(a[2]=l("div",{class:"stat-label"},"Asignadas a mí",-1))]),l("div",$v,[l("div",jv,d(_.value),1),a[3]||(a[3]=l("div",{class:"stat-label"},"Disponibles",-1))]),l("div",zv,[l("div",Vv,d(k.value),1),a[4]||(a[4]=l("div",{class:"stat-label"},"Silenciadas",-1))])])]),l("div",Wv,[b.value?(r(),o("div",Hv,a[5]||(a[5]=[l("div",{class:"spinner"},null,-1),l("p",null,"Cargando mesas del negocio...",-1)]))):(r(),o("div",Gv,[(r(!0),o(p,null,m(g.value,e=>(r(),o("div",{key:e.id,class:u(["table-card",{assigned:e.assigned_to_me,available:!e.assigned_to_me&&!e.is_silenced,silenced:e.is_silenced,"has-calls":e.pending_calls_count>0}])},[l("div",Yv,[l("div",Kv,"Mesa "+d(e.number),1),l("div",Qv,[e.assigned_to_me&&e.pending_calls_count>0?(r(),o("i",Jv)):e.assigned_to_me&&e.is_silenced?(r(),o("i",Zv)):e.assigned_to_me?(r(),o("i",Xv)):e.is_silenced?(r(),o("i",eb)):(r(),o("i",tb))])]),l("div",ab,[e.name&&e.name!==`Mesa ${e.number}`?(r(),o("div",nb,d(e.name),1)):c("",!0),l("div",sb,[e.capacity?(r(),o("span",ib,[a[6]||(a[6]=l("i",{class:"fas fa-users"},null,-1)),v(" "+d(e.capacity)+" personas ",1)])):c("",!0),e.pending_calls_count>0?(r(),o("span",ob,[a[7]||(a[7]=l("i",{class:"fas fa-bell"},null,-1)),v(" "+d(e.pending_calls_count)+" llamada(s) ",1)])):c("",!0)]),e.assigned_waiter&&!e.assigned_to_me?(r(),o("div",rb,[a[8]||(a[8]=l("i",{class:"fas fa-user"},null,-1)),v(" Asignada a: "+d(e.assigned_waiter.name),1)])):c("",!0)]),l("div",lb,[e.assigned_to_me?(r(),o(p,{key:0},[e.is_silenced?(r(),o("button",{key:0,onClick:t=>(async e=>{try{const t=await Zl.unsilenceTable(e);t.success?(Qo(t.message||"Mesa activada"),await S()):Jo(t.message||"Error activando mesa")}catch(t){console.error("Error unsilencing table:",t),Jo("Error activando mesa")}})(e.id),class:"action-btn unsilence",title:"Activar mesa"},a[9]||(a[9]=[l("i",{class:"fas fa-volume-up"},null,-1)]),8,cb)):(r(),o("button",{key:1,onClick:t=>(async e=>{try{if(await Zo("¿Silenciar mesa?","La mesa no podrá realizar llamadas durante 30 minutos.","Silenciar","Cancelar","warning")){const t=await Zl.silenceTable(e,30);t.success?(Qo(t.message||"Mesa silenciada"),await S()):Jo(t.message||"Error silenciando mesa")}}catch(t){console.error("Error silencing table:",t),Jo("Error silenciando mesa")}})(e.id),class:"action-btn silence",title:"Silenciar mesa"},a[10]||(a[10]=[l("i",{class:"fas fa-volume-mute"},null,-1)]),8,db)),l("button",{onClick:t=>(async e=>{try{if(await Zo("¿Desasignarte de esta mesa?","Ya no recibirás llamadas de esta mesa.","Desasignar","Cancelar","warning")){const t=await Zl.deactivateTable(e);t.success?(Qo(t.message||"Mesa desasignada"),await S()):Jo(t.message||"Error desasignando mesa")}}catch(t){console.error("Error deactivating table:",t),Jo("Error desasignando mesa")}})(e.id),class:"action-btn deactivate",title:"Desasignarme de esta mesa"},a[11]||(a[11]=[l("i",{class:"fas fa-times"},null,-1)]),8,ub)],64)):e.is_silenced?(r(),o("div",pb,[e.is_silenced?(r(),o("span",mb,"Mesa silenciada")):(r(),o("span",fb,"No disponible"))])):(r(),o("button",{key:1,onClick:t=>(async e=>{console.log("🚀 BusinessTablesManager: Iniciando activación de mesa:",e);try{const t=await Zl.activateTable(e);console.log("📊 BusinessTablesManager: Respuesta de activación:",t),t.success?(console.log("✅ BusinessTablesManager: Mesa activada exitosamente"),Qo(t.message||"Mesa activada"),console.log("🔄 BusinessTablesManager: Recargando mesas del negocio..."),await S()):(console.error("❌ BusinessTablesManager: Error en respuesta:",t.message),Jo(t.message||"Error activando mesa"))}catch(t){console.error("💥 BusinessTablesManager: Error completo activando mesa:",t),Jo("Error activando mesa")}})(e.id),class:"action-btn activate",title:"Asignarme esta mesa"},a[12]||(a[12]=[l("i",{class:"fas fa-plus"},null,-1),v(" Tomar ")]),8,hb))])],2))),128)),0===g.value.length?(r(),o("div",gb,a[13]||(a[13]=[l("i",{class:"fas fa-table"},null,-1),l("h4",null,"Sin mesas registradas",-1),l("p",null,"Este negocio no tiene mesas registradas aún.",-1)]))):c("",!0)]))]),l("div",vb,[l("button",{onClick:T,class:"action-btn primary",disabled:b.value},[l("i",{class:u(["fas fa-sync-alt",{"fa-spin":b.value}])},null,2),a[14]||(a[14]=v(" Actualizar "))],8,bb),C.value.length>0?(r(),o("button",{key:0,onClick:x,class:"action-btn danger"},[a[15]||(a[15]=l("i",{class:"fas fa-sign-out-alt"},null,-1)),v(" Desasignarme de todas ("+d(C.value.length)+") ",1)])):c("",!0),E.value.length>0?(r(),o("button",{key:1,onClick:N,class:"action-btn success"},[a[16]||(a[16]=l("i",{class:"fas fa-check-double"},null,-1)),v(" Tomar todas disponibles ("+d(E.value.length)+") ",1)])):c("",!0)])]))}},[["__scopeId","data-v-0cdb7b2a"]]),yb={class:"table-profiles-manager"},_b={class:"profiles-header"},kb={key:0,class:"profiles-list"},Cb={class:"profile-header"},Eb={class:"profile-info"},Sb={class:"profile-name"},Tb={key:0,class:"active-badge"},Nb={class:"profile-meta"},xb={class:"table-count"},Ib={class:"created-date"},Ab={class:"profile-actions"},Pb=["onClick","disabled"],Rb=["onClick","disabled"],Db=["onClick"],Lb=["onClick"],Mb={class:"profile-tables"},Ob={class:"tables-list"},Fb={key:0,class:"fas fa-exclamation-triangle",title:"En conflicto con otro mozo"},Ub={key:0,class:"conflict-info"},Bb={key:1,class:"activation-summary"},qb={key:0,class:"summary-item success"},$b={key:1,class:"summary-item info"},jb={key:2,class:"summary-item warning"},zb={key:0,class:"empty-state"},Vb={key:1,class:"loading-state"},Wb={class:"modal-content"},Hb={class:"modal-header"},Gb={class:"modal-body"},Yb={class:"form-group"},Kb={class:"form-group"},Qb={class:"tables-grid"},Jb=["value","disabled"],Zb={class:"table-info"},Xb={class:"table-number"},ew={key:0,class:"table-name"},tw={key:1,class:"status-badge mine"},aw={key:2,class:"status-badge conflict"},nw={key:3,class:"status-badge available"},sw={class:"form-help"},iw={class:"form-actions"},ow=["disabled"],rw={key:0,class:"fas fa-spinner fa-spin"},lw={key:1,class:"fas fa-save"},cw=tr({__name:"TableProfilesManager",props:{businessId:{type:Number,required:!0},availableTables:{type:Array,default:()=>[]},assignedTables:{type:Array,default:()=>[]}},emits:["profiles-updated"],setup(e,{emit:t}){const n=e,i=t,f=N({profiles:[],loading:!1,processing:null,saving:!1,showCreateModal:!1,editingProfile:null,formData:{name:"",table_ids:[]}}),g=a(()=>f.profiles),b=a(()=>f.loading),w=a(()=>f.processing),y=a(()=>f.saving),_=a({get:()=>f.showCreateModal,set:e=>f.showCreateModal=e}),k=a(()=>f.editingProfile),C=a(()=>f.formData),x=a(()=>[...n.availableTables,...n.assignedTables].map(e=>({...e,is_assigned_to_me:n.assignedTables.some(t=>t.id===e.id),is_assigned_to_other:e.assigned_waiter&&"Tú"!==e.assigned_waiter,assigned_waiter:e.assigned_waiter||"Disponible"}))),I=async()=>{f.loading=!0;try{const e=await Ta.getWaiterTableProfiles();e.data.success?(f.profiles=e.data.profiles||[],console.log("✅ Perfiles cargados:",f.profiles.length)):Jo(e.data.message||"Error cargando perfiles")}catch(e){console.error("Error loading profiles:",e),Jo("Error cargando perfiles")}finally{f.loading=!1}},A=async()=>{if(f.formData.name.trim()&&0!==f.formData.table_ids.length){f.saving=!0;try{const e={name:f.formData.name.trim(),table_ids:f.formData.table_ids};let t;t=f.editingProfile?await Ta.updateWaiterTableProfile(f.editingProfile.id,e):await Ta.createWaiterTableProfile(e),t.data.success?(Qo(t.data.message||`Perfil ${f.editingProfile?"actualizado":"creado"} correctamente`),P(),await I(),i("profiles-updated")):Jo(t.data.message||`Error ${f.editingProfile?"actualizando":"creando"} perfil`)}catch(e){console.error("Error saving profile:",e),Jo(`Error ${f.editingProfile?"actualizando":"creando"} perfil`)}finally{f.saving=!1}}else Jo("Completa todos los campos requeridos")},P=()=>{f.showCreateModal=!1,f.editingProfile=null,f.formData={name:"",table_ids:[]}},R=e=>n.assignedTables.some(t=>t.number===e),D=e=>{if(!e)return"";return new Date(e).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})};return s(async()=>{console.log("🏠 TableProfilesManager mounted"),await I()}),(e,t)=>(r(),o("div",yb,[l("div",_b,[t[5]||(t[5]=l("div",{class:"header-info"},[l("h3",null,[l("i",{class:"fas fa-bookmark"}),v(" Mis Perfiles de Mesa ")]),l("p",{class:"header-description"}," Crea perfiles con conjuntos de mesas para activar rápidamente ")],-1)),l("button",{onClick:t[0]||(t[0]=e=>_.value=!0),class:"btn btn-primary"},t[4]||(t[4]=[l("i",{class:"fas fa-plus"},null,-1),v(" Crear Perfil ")]))]),b.value?c("",!0):(r(),o("div",kb,[(r(!0),o(p,null,m(g.value,e=>{var a,n,s;return r(),o("div",{key:e.id,class:u(["profile-card",{active:e.is_active,"has-conflicts":(null==(a=e.conflict_tables)?void 0:a.length)>0}])},[l("div",Cb,[l("div",Eb,[l("h4",Sb,[v(d(e.name)+" ",1),e.is_active?(r(),o("span",Tb,"ACTIVO")):c("",!0)]),l("div",Nb,[l("span",xb,[t[6]||(t[6]=l("i",{class:"fas fa-table"},null,-1)),v(" "+d((null==(n=e.table_numbers)?void 0:n.length)||0)+" mesas ",1)]),l("span",Ib," Creado "+d(D(e.created_at)),1)])]),l("div",Ab,[e.is_active?c("",!0):(r(),o("button",{key:0,onClick:t=>(async e=>{f.processing=e;try{const t=await Ta.activateWaiterTableProfile(e);t.data.success?(Qo(t.data.message||"Perfil activado"),await I(),i("profiles-updated")):Jo(t.data.message||"Error activando perfil")}catch(t){console.error("Error activating profile:",t),Jo("Error activando perfil")}finally{f.processing=null}})(e.id),class:"action-btn activate",disabled:w.value===e.id,title:"Activar perfil"},t[7]||(t[7]=[l("i",{class:"fas fa-play"},null,-1)]),8,Pb)),e.is_active?(r(),o("button",{key:1,onClick:t=>(async e=>{if(await Zo("¿Desactivar perfil?","Se desasignarán todas las mesas de este perfil.","Desactivar","Cancelar","warning")){f.processing=e;try{const t=await Ta.deactivateWaiterTableProfile(e);t.data.success?(Qo(t.data.message||"Perfil desactivado"),await I(),i("profiles-updated")):Jo(t.data.message||"Error desactivando perfil")}catch(t){console.error("Error deactivating profile:",t),Jo("Error desactivando perfil")}finally{f.processing=null}}})(e.id),class:"action-btn deactivate",disabled:w.value===e.id,title:"Desactivar perfil"},t[8]||(t[8]=[l("i",{class:"fas fa-pause"},null,-1)]),8,Rb)):c("",!0),l("button",{onClick:t=>(e=>{f.editingProfile=e,f.formData={name:e.name,table_ids:[...e.table_ids||[]]},f.showCreateModal=!1})(e),class:"action-btn edit",title:"Editar perfil"},t[9]||(t[9]=[l("i",{class:"fas fa-edit"},null,-1)]),8,Db),l("button",{onClick:t=>(async(e,t)=>{if(await Zo(`¿Eliminar perfil "${t}"?`,"Esta acción no se puede deshacer.","Eliminar","Cancelar","danger"))try{const t=await Ta.deleteWaiterTableProfile(e);t.data.success?(Qo(t.data.message||"Perfil eliminado"),await I(),i("profiles-updated")):Jo(t.data.message||"Error eliminando perfil")}catch(a){console.error("Error deleting profile:",a),Jo("Error eliminando perfil")}})(e.id,e.name),class:"action-btn delete",title:"Eliminar perfil"},t[10]||(t[10]=[l("i",{class:"fas fa-trash"},null,-1)]),8,Lb)])]),l("div",Mb,[l("div",Ob,[(r(!0),o(p,null,m(e.table_numbers,t=>{var a,n;return r(),o("span",{key:t,class:u(["table-tag",{conflict:null==(a=e.conflict_tables)?void 0:a.includes(t),assigned:R(t)}])},[v(" Mesa "+d(t)+" ",1),(null==(n=e.conflict_tables)?void 0:n.includes(t))?(r(),o("i",Fb)):c("",!0)],2)}),128))])]),(null==(s=e.conflict_tables)?void 0:s.length)>0?(r(),o("div",Ub,[t[11]||(t[11]=l("i",{class:"fas fa-exclamation-triangle"},null,-1)),l("span",null,d(e.conflict_tables.length)+" mesa(s) en conflicto con otros mozos",1)])):c("",!0),e.is_active&&e.activation_summary?(r(),o("div",Bb,[e.activation_summary.activated>0?(r(),o("div",qb,[t[12]||(t[12]=l("i",{class:"fas fa-check"},null,-1)),v(" "+d(e.activation_summary.activated)+" activadas ",1)])):c("",!0),e.activation_summary.already_yours>0?(r(),o("div",$b,[t[13]||(t[13]=l("i",{class:"fas fa-user-check"},null,-1)),v(" "+d(e.activation_summary.already_yours)+" ya eran tuyas ",1)])):c("",!0),e.activation_summary.conflicts>0?(r(),o("div",jb,[t[14]||(t[14]=l("i",{class:"fas fa-exclamation-triangle"},null,-1)),v(" "+d(e.activation_summary.conflicts)+" en conflicto ",1)])):c("",!0)])):c("",!0)],2)}),128)),0===g.value.length?(r(),o("div",zb,[t[16]||(t[16]=l("i",{class:"fas fa-bookmark"},null,-1)),t[17]||(t[17]=l("h4",null,"No tienes perfiles creados",-1)),t[18]||(t[18]=l("p",null,"Crea tu primer perfil para agrupar mesas que usas frecuentemente",-1)),l("button",{onClick:t[1]||(t[1]=e=>_.value=!0),class:"btn btn-primary"},t[15]||(t[15]=[l("i",{class:"fas fa-plus"},null,-1),v(" Crear Primer Perfil ")]))])):c("",!0)])),b.value?(r(),o("div",Vb,t[19]||(t[19]=[l("i",{class:"fas fa-spinner fa-spin"},null,-1),l("p",null,"Cargando perfiles...",-1)]))):c("",!0),_.value||k.value?(r(),o("div",{key:2,class:"modal-overlay",onClick:h(P,["self"])},[l("div",Wb,[l("div",Hb,[l("h3",null,[t[20]||(t[20]=l("i",{class:"fas fa-bookmark"},null,-1)),v(" "+d(k.value?"Editar Perfil":"Crear Nuevo Perfil"),1)]),l("button",{onClick:P,class:"close-btn"},t[21]||(t[21]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",Gb,[l("form",{onSubmit:h(A,["prevent"])},[l("div",Yb,[t[22]||(t[22]=l("label",{for:"profileName"},"Nombre del perfil",-1)),E(l("input",{id:"profileName","onUpdate:modelValue":t[2]||(t[2]=e=>C.value.name=e),type:"text",class:"form-input",placeholder:"Ej: Zona A, Terraza, Mesas VIP...",maxlength:"50",required:""},null,512),[[S,C.value.name]]),t[23]||(t[23]=l("small",{class:"form-help"}," Máximo 50 caracteres. Debe ser único. ",-1))]),l("div",Kb,[t[24]||(t[24]=l("label",null,"Selecciona las mesas (máximo 20)",-1)),l("div",Qb,[(r(!0),o(p,null,m(x.value,e=>(r(),o("label",{key:e.id,class:u(["table-checkbox",{selected:C.value.table_ids.includes(e.id),assigned:e.is_assigned_to_me,conflict:e.is_assigned_to_other}])},[E(l("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":t[3]||(t[3]=e=>C.value.table_ids=e),disabled:C.value.table_ids.length>=20&&!C.value.table_ids.includes(e.id)},null,8,Jb),[[T,C.value.table_ids]]),l("span",Zb,[l("span",Xb,"Mesa "+d(e.number),1),e.name&&e.name!==`Mesa ${e.number}`?(r(),o("span",ew,d(e.name),1)):c("",!0),e.is_assigned_to_me?(r(),o("span",tw,"Tuya")):e.is_assigned_to_other?(r(),o("span",aw,d(e.assigned_waiter),1)):(r(),o("span",nw,"Disponible"))])],2))),128))]),l("small",sw," Seleccionadas: "+d(C.value.table_ids.length)+"/20 ",1)]),l("div",iw,[l("button",{type:"button",onClick:P,class:"btn btn-secondary"}," Cancelar "),l("button",{type:"submit",class:"btn btn-primary",disabled:!C.value.name.trim()||0===C.value.table_ids.length||y.value},[y.value?(r(),o("i",rw)):(r(),o("i",lw)),v(" "+d(k.value?"Actualizar":"Crear")+" Perfil ",1)],8,ow)])],32)])])])):c("",!0)]))}},[["__scopeId","data-v-ad74d18c"]]),dw={class:"waiter-dashboard"},uw={class:"dashboard-header"},hw={class:"waiter-info"},pw={class:"waiter-details"},mw={class:"business-selector-container"},fw={class:"dashboard-stats"},gw={class:"stat-item"},vw={class:"stat-number"},bw={class:"stat-item urgent"},ww={class:"stat-number"},yw={class:"stat-item"},_w={class:"stat-number"},kw={class:"dashboard-content"},Cw={class:"left-column"},Ew={class:"section-card"},Sw={class:"section-header"},Tw={class:"section-actions"},Nw=["disabled"],xw={class:"tables-list"},Iw={class:"table-info"},Aw={class:"table-name"},Pw={key:0,class:"urgency-icon"},Rw={key:1,class:"silence-icon"},Dw={key:2,class:"ok-icon"},Lw={key:0,class:"table-subtitle"},Mw={class:"table-actions"},Ow=["onClick"],Fw=["onClick"],Uw=["onClick"],Bw=["onClick"],qw={key:0,class:"empty-state"},$w={key:0},jw={key:1},zw={class:"right-column"},Vw={class:"section-card"},Ww={class:"section-header"},Hw={class:"notifications-list",id:"calls-container"},Gw={class:"notification-info"},Yw={class:"notification-title"},Kw={class:"notification-message"},Qw={class:"notification-time"},Jw={key:0,class:"urgent-badge"},Zw={class:"notification-actions"},Xw=["onClick","disabled"],ey=["onClick","disabled"],ty=["onClick"],ay={key:0,class:"empty-notifications"},ny={key:0},sy={key:1},iy={key:0,class:"section-card"},oy={class:"section-header"},ry={class:"notifications-list acknowledged-list"},ly={class:"notification-info"},cy={class:"notification-title"},dy={class:"notification-message"},uy={class:"notification-time"},hy={key:0,class:"urgent-badge"},py={class:"notification-actions"},my=["onClick","disabled"],fy={class:"modal-content large"},gy={class:"modal-header"},vy={class:"modal-body"},by={class:"modal-content large"},wy={class:"modal-header"},yy={class:"modal-body"},_y=tr({__name:"Dashboard",setup(e){const b=g(),y=Ga(),_=N({assignedTables:[],availableTables:[],pendingCalls:[],silencedTables:[],businesses:[],currentBusiness:null,needsBusiness:!1,loading:!1,processingCall:null,showTableSelector:!1,showTablesManager:!1,showProfilesManager:!1}),k=a(()=>_.availableTables),C=a(()=>_.silencedTables),E=a(()=>_.loading),S=a(()=>_.processingCall),T=a({get:()=>_.showTableSelector,set:e=>_.showTableSelector=e}),I=a({get:()=>_.showTablesManager,set:e=>_.showTablesManager=e}),A=a({get:()=>_.showProfilesManager,set:e=>_.showProfilesManager=e}),P=t(null);a(()=>_.businesses);const R=a(()=>_.currentBusiness),D=a(()=>_.needsBusiness);a(()=>{var e;return(null==(e=_.currentBusiness)?void 0:e.name)||"Seleccionar Negocio"}),a(()=>_.pendingCalls);const L=a(()=>_.pendingCalls.filter(e=>!e.status||"pending"===e.status)),M=a(()=>_.pendingCalls.filter(e=>"acknowledged"===e.status||"accepted"===e.status));a(()=>_.pendingCalls);const O=a(()=>L.value);a(()=>L.value);const F=a(()=>_.assignedTables);function U(e){const t=String(e.id),a=_.pendingCalls.findIndex(e=>String(e.id)===t),n=Date.now(),s=e.called_at||e.timestamp||n,i=Math.max(0,Math.floor((n-s)/6e4)),o={...e,minutes_ago:i};-1===a?(console.log("➕ Agregando nueva llamada al Dashboard:",t),_.pendingCalls.unshift(o)):(console.log("🔄 Actualizando llamada existente en Dashboard:",t),_.pendingCalls[a]={..._.pendingCalls[a],...o})}function B(e){try{const t=null==e?void 0:e.detail;if(!t||!t.id)return;console.log("🎯 Dashboard recibió nueva llamada:",t.id,t),U(t),console.log("📊 Total pendingCalls después de agregar:",_.pendingCalls.length)}catch(t){console.warn("Error handling ultraFastAddCall:",t)}}function q(e){try{const t=null==e?void 0:e.detail;if(!t||!t.id)return;U(t)}catch(t){console.warn("Error handling updateCallStatus:",t)}}function $(e){var t;try{const a=null==(t=null==e?void 0:e.detail)?void 0:t.callId;if(!a)return;const n=String(a);_.pendingCalls=_.pendingCalls.filter(e=>String(e.id)!==n)}catch(a){console.warn("Error handling removeCall:",a)}}function j(){_.pendingCalls=[]}function z(e){var t;try{const a=null==(t=null==e?void 0:e.detail)?void 0:t.callId;if(!a)return;const n=_.pendingCalls.findIndex(e=>String(e.id)===String(a));-1!==n&&(_.pendingCalls[n].status="acknowledged")}catch(a){console.warn("Error handling callAcknowledged:",a)}}let V=null;const W=async()=>{if(!_.needsBusiness&&_.currentBusiness){_.loading=!0;try{await Promise.all([H(),G(),Y(),K()])}catch(e){console.error("Error loading dashboard data:",e),Jo("Error cargando datos del dashboard")}finally{_.loading=!1}}};s(async()=>{await W();try{if(y.user&&y.user.id){V=Fg(y.user.id),window.ultraFastNotifications=V;try{if(V&&V.activeCalls)for(const[e,t]of V.activeCalls.entries())U({id:e,...t})}catch(e){console.warn("Error seeding pendingCalls from activeCalls:",e)}}else{const e=x(()=>y.user,t=>{if(t&&t.id)try{if(V=Fg(t.id),window.ultraFastNotifications=V,V&&V.activeCalls)for(const[e,t]of V.activeCalls.entries())U({id:e,...t})}catch(a){console.warn("Error inicializando ultraFast desde watcher:",a)}finally{e()}})}}catch(t){console.warn("Error inicializando ultraFastNotifications:",t)}window.addEventListener("ultraFastAddCall",B),window.addEventListener("newWaiterCall",B),window.addEventListener("updateCallStatus",q),window.addEventListener("removeCall",$),window.addEventListener("clearAllCalls",j),window.addEventListener("callAcknowledged",z);try{window.debugUltra=()=>({allNotifications:_.pendingCalls.slice(),pendingNotifications:L.value.slice(),acknowledgedNotifications:M.value.slice(),activeCalls:window.ultraFastNotifications?Array.from(window.ultraFastNotifications.activeCalls.keys()):[],totalAll:_.pendingCalls.length,totalPending:L.value.length,totalAcknowledged:M.value.length}),window.testNotification=()=>{console.log("🧪 Simulando nueva llamada pendiente...");U({id:"test-"+Date.now(),table_number:99,message:"Prueba de notificación pendiente",urgency:"high",status:"pending",timestamp:Date.now()})},window.testAcknowledged=()=>{console.log("🧪 Simulando llamada reconocida...");U({id:"ack-"+Date.now(),table_number:88,message:"Prueba de notificación reconocida",urgency:"normal",status:"acknowledged",timestamp:Date.now()-18e4})}}catch(t){}}),i(()=>{try{window.removeEventListener("ultraFastAddCall",B),window.removeEventListener("newWaiterCall",B),window.removeEventListener("updateCallStatus",q),window.removeEventListener("removeCall",$),window.removeEventListener("clearAllCalls",j),window.removeEventListener("callAcknowledged",z)}catch(e){console.warn("Error removing ultraFast event listeners:",e)}try{V&&V.stopListening&&V.stopListening()}catch(e){console.warn("Error stopping ultraFastNotifications on unmount:",e)}});const H=async()=>{var e;if(_.currentBusiness)try{console.log("📋 Cargando mesas asignadas para negocio:",_.currentBusiness.id);const t=await Zl.getWaiterBusinessTables(_.currentBusiness.id);if(console.log("📋 Respuesta completa:",t),t.success){const a=(null==(e=t.tables)?void 0:e.filter(e=>{var t;return"assigned_to_me"===(null==(t=e.status)?void 0:t.assignment)}))||[];_.assignedTables=a,console.log("✅ Mesas asignadas cargadas:",a.length,a)}else console.error("❌ Error en respuesta:",t)}catch(t){console.error("❌ Error cargando mesas asignadas:",t),Jo("Error al cargar las mesas asignadas")}else console.log("⚠️ No hay negocio activo, no se pueden cargar mesas")},G=async()=>{console.log("🔔 Llamadas pendientes manejadas por Firebase Realtime")},Y=async()=>{console.log("🔍 Cargando mesas disponibles...");try{const e=await Zl.getAvailableTables();console.log("📋 Respuesta mesas disponibles:",e),e.success?(_.availableTables=e.available_tables||[],console.log("✅ Mesas disponibles cargadas:",_.availableTables.length,_.availableTables)):console.error("❌ Error en respuesta mesas disponibles:",e.message)}catch(e){console.error("💥 Error loading available tables:",e)}},K=async()=>{try{const e=await Zl.getSilencedTables();e.success&&(_.silencedTables=e.silenced_tables||[])}catch(e){console.error("Error loading silenced tables:",e)}},Q=async e=>{try{if(await Zo("¿Silenciar mesa?","La mesa no podrá realizar llamadas durante 30 minutos.","Silenciar","Cancelar","warning")){const t=await Zl.silenceTable(e,30);t.success?(Qo(t.message||"Mesa silenciada"),await H(),await K()):Jo(t.message||"Error silenciando mesa")}}catch(t){console.error("Error silencing table:",t),Jo("Error silenciando mesa")}},J=async()=>{await W()},Z=async()=>{try{if(await Zo("¿Finalizar turno?","Te desasignarás de todas las mesas y saldrás de la aplicación.","Finalizar Turno","Cancelar","danger")){if(_.assignedTables.length>0){const e=_.assignedTables.map(e=>e.id);await Zl.deactivateMultipleTables(e)}ie(),await y.logout(),Qo("Turno finalizado correctamente"),await b.push("/login")}}catch(e){console.error("Error ending shift:",e),Jo("Error finalizando turno")}},X=e=>{var t;_.businesses=e.businesses||[],_.currentBusiness=e.activeBusiness||null,_.needsBusiness=e.needsBusiness||!1,console.log("🏢 Negocios cargados:",{total:_.businesses.length,current:null==(t=_.currentBusiness)?void 0:t.name,needsBusiness:_.needsBusiness}),_.currentBusiness&&!_.needsBusiness&&(W(),se())},ee=e=>{_.currentBusiness=e,console.log("🏢 Negocio cambiado a:",e.name),_.assignedTables=[],_.availableTables=[],_.pendingCalls=[],_.silencedTables=[],W(),se()},te=async e=>{var t;if(console.log("🚀 Dashboard: Mesas seleccionadas para activar:",e),_.showTableSelector=!1,0!==e.length)try{console.log("🔄 Dashboard: Iniciando activación múltiple...");const a=await Zl.activateMultipleTables(e);console.log("📊 Dashboard: Respuesta activación múltiple:",a),a.success?(console.log("✅ Dashboard: Mesas activadas exitosamente"),Qo(a.message||`${(null==(t=a.summary)?void 0:t.successful)||e.length} mesas activadas`),console.log("🔄 Dashboard: Recargando datos del dashboard..."),await H(),await Y(),se()):(console.error("❌ Dashboard: Error en respuesta múltiple:",a.message),Jo(a.message||"Error activando mesas"))}catch(a){console.error("💥 Dashboard: Error completo activando mesas múltiples:",a),Jo("Error activando mesas")}else console.log("⚠️ Dashboard: No se seleccionaron mesas")},ae=async e=>{console.log("📋 Mesas del negocio actualizadas:",e.length),await W()},ne=async()=>{console.log("📋 Perfiles actualizados"),await W()},se=async()=>{if(y.user&&!_.needsBusiness){console.log("⚡ Iniciando Ultra Fast Firebase Realtime Database para mozo:",y.user.id);try{V=Fg(y.user.id.toString()),console.log("✅ Ultra Fast Firebase Realtime Database activado")}catch(e){console.error("❌ Error configurando Ultra Fast Firebase:",e),Jo("Error configurando notificaciones ultra rápidas")}}},ie=async()=>{console.log("🛑 Deteniendo Ultra Fast Firebase Realtime Database");try{V&&(V.stopListening(),V=null),console.log("✅ Ultra Fast Firebase Realtime Database desconectado")}catch(e){console.error("❌ Error desconectando Ultra Fast Firebase:",e)}};s(async()=>{console.log("🏠 Waiter Dashboard mounted")}),i(()=>{ie()});const oe=async e=>{if(V)try{_.processingCall=e,await V.completeCall(e)}catch(t){console.error("Error completando llamada:",t),Jo("Error al completar la llamada")}finally{_.processingCall=null}else Jo("Sistema de notificaciones ultra rápidas no disponible")},re=async()=>{if(V)try{const e=await V.createTestCall();Qo(`🧪 Llamada de prueba creada: Mesa ${e.table_number}`)}catch(e){console.error("Error creando llamada de prueba:",e),Jo("Error al crear la llamada de prueba")}else Jo("Sistema de notificaciones ultra rápidas no disponible")};return(e,t)=>{var a;return r(),o("div",dw,[l("div",uw,[l("div",hw,[t[9]||(t[9]=l("div",{class:"waiter-avatar"},[l("i",{class:"fas fa-user-circle"})],-1)),l("div",pw,[l("h2",null,d((null==(a=n(y).user)?void 0:a.name)||"Mozo"),1),l("div",mw,[f(Dv,{onBusinessChanged:ee,onBusinessesLoaded:X,ref_key:"businessSelector",ref:P},null,512)])])]),l("div",fw,[l("div",gw,[l("div",vw,d(F.value.length),1),t[10]||(t[10]=l("div",{class:"stat-label"},"Mesas asignadas",-1))]),l("div",bw,[l("div",ww,d(O.value.length),1),t[11]||(t[11]=l("div",{class:"stat-label"},"Llamadas pendientes",-1))]),l("div",yw,[l("div",_w,d(C.value.length),1),t[12]||(t[12]=l("div",{class:"stat-label"},"Mesas silenciadas",-1))])])]),l("div",kw,[l("div",Cw,[l("div",Ew,[l("div",Sw,[t[17]||(t[17]=l("h3",null,[l("i",{class:"fas fa-table"}),v(" Todas ")],-1)),l("div",Tw,[D.value?c("",!0):(r(),o("button",{key:0,onClick:t[0]||(t[0]=e=>A.value=!0),class:"action-btn info"},t[13]||(t[13]=[l("i",{class:"fas fa-bookmark"},null,-1),v(" Perfiles ")]))),D.value?c("",!0):(r(),o("button",{key:1,onClick:t[1]||(t[1]=e=>I.value=!0),class:"action-btn secondary"},t[14]||(t[14]=[l("i",{class:"fas fa-cog"},null,-1),v(" Gestionar Mesas ")]))),D.value?c("",!0):(r(),o("button",{key:2,onClick:t[2]||(t[2]=e=>T.value=!0),class:"action-btn primary"},t[15]||(t[15]=[l("i",{class:"fas fa-plus"},null,-1),v(" Activar Mesas ")]))),l("button",{onClick:J,class:"action-btn",disabled:E.value},[l("i",{class:u(["fas fa-sync-alt",{"fa-spin":E.value}])},null,2)],8,Nw),l("button",{onClick:re,class:"action-btn warning"},t[16]||(t[16]=[l("i",{class:"fas fa-flask"},null,-1),v(" Test Call ")]))])]),l("div",xw,[(r(!0),o(p,null,m(F.value,e=>(r(),o("div",{key:e.id,class:u(["table-item",{"has-calls":e.pending_calls_count>0,silenced:e.is_silenced}])},[l("div",Iw,[l("div",Aw,[v(" Mesa "+d(e.number)+" ",1),e.pending_calls_count>0?(r(),o("span",Pw,t[18]||(t[18]=[l("i",{class:"fas fa-exclamation-triangle"},null,-1)]))):e.is_silenced?(r(),o("span",Rw,t[19]||(t[19]=[l("i",{class:"fas fa-volume-mute"},null,-1)]))):(r(),o("span",Dw,t[20]||(t[20]=[l("i",{class:"fas fa-check"},null,-1)])))]),e.name&&e.name!==`Mesa ${e.number}`?(r(),o("div",Lw,d(e.name),1)):c("",!0)]),l("div",Mw,[e.notifications_enabled?c("",!0):(r(),o("button",{key:0,onClick:t=>(async e=>{console.log("🚀 Dashboard: Iniciando activación de mesa:",e);try{const t=await Zl.activateTable(e);console.log("📊 Dashboard: Respuesta de activación:",t),t.success?(console.log("✅ Dashboard: Mesa activada exitosamente"),Qo(t.message||"Mesa activada"),console.log("🔄 Dashboard: Recargando mesas asignadas..."),await H(),se()):(console.error("❌ Dashboard: Error en respuesta:",t.message),Jo(t.message||"Error activando mesa"))}catch(t){console.error("💥 Dashboard: Error completo activando mesa:",t),Jo("Error activando mesa")}})(e.id),class:"table-action-btn activate",title:"Activar llamadas"},t[21]||(t[21]=[l("i",{class:"fas fa-check"},null,-1)]),8,Ow)),!e.is_silenced&&e.notifications_enabled?(r(),o("button",{key:1,onClick:t=>Q(e.id),class:"table-action-btn silence",title:"Silenciar"},t[22]||(t[22]=[l("i",{class:"fas fa-volume-mute"},null,-1)]),8,Fw)):c("",!0),e.is_silenced?(r(),o("button",{key:2,onClick:t=>(async e=>{try{const t=await Zl.unsilenceTable(e);t.success?(Qo(t.message||"Silencio removido"),await H(),await K()):Jo(t.message||"Error removiendo silencio")}catch(t){console.error("Error unsilencing table:",t),Jo("Error removiendo silencio")}})(e.id),class:"table-action-btn unsilence",title:"Activar"},t[23]||(t[23]=[l("i",{class:"fas fa-volume-up"},null,-1)]),8,Uw)):c("",!0),l("button",{onClick:t=>(async e=>{try{if(await Zo("¿Desactivar mesa?","Te desasignarás de esta mesa y no recibirás más llamadas.","Desactivar","Cancelar","warning")){const t=await Zl.deactivateTable(e);t.success?(Qo(t.message||"Mesa desactivada"),await H(),await Y(),await G(),se()):Jo(t.message||"Error desactivando mesa")}}catch(t){console.error("Error deactivating table:",t),Jo("Error desactivando mesa")}})(e.id),class:"table-action-btn deactivate",title:"Desactivar"},t[24]||(t[24]=[l("i",{class:"fas fa-times"},null,-1)]),8,Bw)])],2))),128)),0===F.value.length?(r(),o("div",qw,[t[25]||(t[25]=l("i",{class:"fas fa-table"},null,-1)),D.value?(r(),o("p",jw,"Selecciona un negocio para ver las mesas disponibles")):(r(),o("p",$w,"No tienes mesas asignadas")),D.value?c("",!0):(r(),o("button",{key:2,onClick:t[3]||(t[3]=e=>T.value=!0),class:"btn btn-primary"}," Activar Mesas "))])):c("",!0)])])]),l("div",zw,[l("div",Vw,[l("div",Ww,[l("h3",null,[t[26]||(t[26]=l("i",{class:"fas fa-bell text-danger"},null,-1)),v(" Llamadas Pendientes ("+d(L.value.length)+") ",1)])]),l("div",Hw,[(r(!0),o(p,null,m(L.value,e=>{var a;return r(),o("div",{key:e.id,class:u(["notification-item",{urgent:"high"===e.urgency,old:e.minutes_ago>5}])},[l("div",Gw,[l("div",Yw,[v(" Mesa "+d(e.table_number||(null==(a=e.table)?void 0:a.number))+": ",1),t[27]||(t[27]=l("span",{class:"status-badge pending"},"PENDIENTE",-1))]),l("div",Kw,d(e.message||"Solicita mozo"),1),l("div",Qw,[v(" Hace "+d(e.minutes_ago)+"m ",1),"high"===e.urgency?(r(),o("span",Jw,"URGENTE")):c("",!0)])]),l("div",Zw,[l("button",{onClick:t=>(async e=>{if(V)try{_.processingCall=e,await V.acknowledgeCall(e)}catch(t){console.error("Error reconociendo llamada:",t),Jo("Error al reconocer la llamada")}finally{_.processingCall=null}else Jo("Sistema de notificaciones ultra rápidas no disponible")})(e.id),class:"notification-action-btn ok",disabled:S.value===e.id,title:"OK - Confirmar llamada"},t[28]||(t[28]=[l("i",{class:"fas fa-check"},null,-1)]),8,Xw),l("button",{onClick:t=>oe(e.id),class:"notification-action-btn complete",disabled:S.value===e.id,title:"Completar atención"},t[29]||(t[29]=[l("i",{class:"fas fa-check-double"},null,-1)]),8,ey),l("button",{onClick:t=>(async e=>{await Q(e),await G()})(e.table.id),class:"notification-action-btn silence",title:"Silenciar mesa"},t[30]||(t[30]=[l("i",{class:"fas fa-volume-mute"},null,-1)]),8,ty)])],2)}),128)),0===L.value.length?(r(),o("div",ay,[t[31]||(t[31]=l("i",{class:"fas fa-bell-slash"},null,-1)),D.value?(r(),o("p",sy,"Selecciona un negocio para ver las llamadas")):(r(),o("p",ny,"No hay llamadas pendientes"))])):c("",!0)])]),M.value.length>0?(r(),o("div",iy,[l("div",oy,[l("h3",null,[t[32]||(t[32]=l("i",{class:"fas fa-history text-info"},null,-1)),v(" Historial Reconocidas ("+d(M.value.length)+") ",1)])]),l("div",ry,[(r(!0),o(p,null,m(M.value,e=>{var a;return r(),o("div",{key:"ack-"+e.id,class:u(["notification-item acknowledged",{urgent:"high"===e.urgency,old:e.minutes_ago>5}])},[l("div",ly,[l("div",cy,[v(" Mesa "+d(e.table_number||(null==(a=e.table)?void 0:a.number))+": ",1),t[33]||(t[33]=l("span",{class:"status-badge acknowledged"},"RECONOCIDA",-1))]),l("div",dy,d(e.message||"Solicita mozo"),1),l("div",uy,[v(" Hace "+d(e.minutes_ago)+"m ",1),"high"===e.urgency?(r(),o("span",hy,"URGENTE")):c("",!0)])]),l("div",py,[l("button",{onClick:t=>oe(e.id),class:"notification-action-btn complete",disabled:S.value===e.id,title:"Completar llamada"},t[34]||(t[34]=[l("i",{class:"fas fa-check-double"},null,-1),v(" Completar ")]),8,my)])],2)}),128))])])):c("",!0),l("div",{class:"section-card"},[l("button",{onClick:Z,class:"end-shift-btn"},t[35]||(t[35]=[l("i",{class:"fas fa-sign-out-alt"},null,-1),v(" Salir y desactivar notificaciones ")]))])])]),T.value&&!D.value?(r(),w(iv,{key:0,"available-tables":k.value,"assigned-tables":F.value,onClose:t[4]||(t[4]=e=>T.value=!1),onTablesSelected:te},null,8,["available-tables","assigned-tables"])):c("",!0),I.value&&R.value?(r(),o("div",{key:1,class:"modal-overlay",onClick:t[6]||(t[6]=h(e=>I.value=!1,["self"]))},[l("div",fy,[l("div",gy,[l("h3",null,[t[36]||(t[36]=l("i",{class:"fas fa-building"},null,-1)),v(" "+d(R.value.name)+" - Gestión de Mesas ",1)]),l("button",{onClick:t[5]||(t[5]=e=>I.value=!1),class:"close-btn"},t[37]||(t[37]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",vy,[f(wb,{"business-id":R.value.id,"business-name":R.value.name,onTablesUpdated:ae},null,8,["business-id","business-name"])])])])):c("",!0),A.value&&R.value?(r(),o("div",{key:2,class:"modal-overlay",onClick:t[8]||(t[8]=h(e=>A.value=!1,["self"]))},[l("div",by,[l("div",wy,[t[39]||(t[39]=l("h3",null,[l("i",{class:"fas fa-bookmark"}),v(" Perfiles de Mesa ")],-1)),l("button",{onClick:t[7]||(t[7]=e=>A.value=!1),class:"close-btn"},t[38]||(t[38]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",yy,[f(cw,{"business-id":R.value.id,"available-tables":k.value,"assigned-tables":F.value,onProfilesUpdated:ne},null,8,["business-id","available-tables","assigned-tables"])])])])):c("",!0)])}}},[["__scopeId","data-v-013e858a"]]),ky={class:"editable-field"},Cy={key:0,class:"field-label"},Ey={key:1,class:"edit-container"},Sy=["placeholder"],Ty=["placeholder","min","max"],Ny=["value"],xy=tr({__name:"EditableField",props:{value:{type:[String,Number],default:""},label:{type:String,default:""},type:{type:String,default:"text"},placeholder:{type:String,default:""},options:{type:Array,default:()=>[]},editable:{type:Boolean,default:!0},min:{type:[Number,String],default:null},max:{type:[Number,String],default:null},unit:{type:String,default:""},displayValue:{type:String,default:""}},emits:["update:value"],setup(e,{emit:n}){const s=e,i=n,f=t(s.value),g=t(!1),b=t(null);x(()=>s.value,e=>{g.value||(f.value=e)});const w=a(()=>{if(s.displayValue)return s.displayValue;if("select"===s.type&&s.options.length){const e=s.options.find(e=>e.value===f.value);return e?e.label:f.value}return f.value+(s.unit?" "+s.unit:"")}),y=()=>{s.editable&&(g.value=!0,setTimeout(()=>{b.value&&b.value.focus()},100))},_=()=>{g.value=!1,i("update:value",f.value)},k=e=>{"Enter"===e.key?_():"Escape"===e.key&&(g.value=!1,f.value=s.value)},C=()=>{g.value=!1,f.value=s.value};return(t,a)=>(r(),o("div",ky,[e.label?(r(),o("div",Cy,d(e.label),1)):c("",!0),l("div",{class:u(["field-content",{"is-editing":g.value}])},[g.value?(r(),o("div",Ey,["text"===e.type?E((r(),o("input",{key:0,ref_key:"inputRef",ref:b,type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e),placeholder:e.placeholder,class:"edit-input",onKeydown:k,onChange:_,onBlur:C},null,40,Sy)),[[S,f.value]]):"number"===e.type?E((r(),o("input",{key:1,ref_key:"inputRef",ref:b,type:"number","onUpdate:modelValue":a[1]||(a[1]=e=>f.value=e),placeholder:e.placeholder,min:e.min,max:e.max,class:"edit-input",onKeydown:k,onChange:_,onBlur:C},null,40,Ty)),[[S,f.value]]):"date"===e.type?E((r(),o("input",{key:2,ref_key:"inputRef",ref:b,type:"date","onUpdate:modelValue":a[2]||(a[2]=e=>f.value=e),class:"edit-input",onKeydown:k,onChange:_,onBlur:C},null,544)),[[S,f.value]]):"textarea"===e.type?E((r(),o("textarea",{key:3,ref_key:"inputRef",ref:b,"onUpdate:modelValue":a[3]||(a[3]=e=>f.value=e),rows:"3",class:"edit-input",onKeydown:k,onChange:_,onBlur:C},null,544)),[[S,f.value]]):"select"===e.type?E((r(),o("select",{key:4,ref_key:"inputRef",ref:b,"onUpdate:modelValue":a[4]||(a[4]=e=>f.value=e),class:"edit-select",onChange:_,onBlur:C},[(r(!0),o(p,null,m(e.options,e=>(r(),o("option",{key:e.value,value:e.value},d(e.label),9,Ny))),128))],544)),[[I,f.value]]):c("",!0),l("div",{class:"edit-actions"},[l("button",{type:"button",class:"action-button save-button",onClick:_},a[6]||(a[6]=[l("i",{class:"bi bi-check"},null,-1)])),l("button",{type:"button",class:"action-button cancel-button",onClick:C},a[7]||(a[7]=[l("i",{class:"bi bi-x"},null,-1)]))])])):(r(),o("div",{key:0,class:"display-value",onClick:y},[v(d(w.value)+" ",1),e.editable?(r(),o("button",{key:0,class:"edit-button",onClick:h(y,["stop"])},a[5]||(a[5]=[l("i",{class:"bi bi-pencil"},null,-1)]))):c("",!0)]))],2)]))}},[["__scopeId","data-v-c09b4c9d"]]),Iy={class:"profile-container"},Ay={class:"container py-4"},Py={class:"row justify-content-center"},Ry={class:"col-12 col-lg-8"},Dy={class:"card"},Ly={class:"card-body"},My={key:0,class:"alert alert-success"},Oy={key:1,class:"alert alert-danger"},Fy={key:2,class:"text-center my-5"},Uy={class:"mb-4 text-center"},By={class:"avatar-container"},qy=["src"],$y={class:"avatar-overlay"},jy={class:"mb-3"},zy=["disabled"],Vy={class:"mb-3"},Wy=["disabled"],Hy={class:"mb-3"},Gy=["disabled"],Yy={class:"mb-3"},Ky=["disabled"],Qy={class:"mb-3"},Jy=["disabled"],Zy={key:0,class:"form-text"},Xy={class:"mb-4"},e_=["disabled"],t_={key:0,class:"form-text"},a_={class:"d-flex gap-2 mt-4"},n_=["disabled"],s_={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},i_=["disabled"],o_={class:"text-end"},r_=["disabled"],l_={class:"modal-dialog"},c_={class:"modal-content"},d_={class:"modal-header"},u_={class:"modal-body"},h_={class:"mb-3"},p_=["disabled"],m_={class:"modal-footer"},f_=["disabled"],g_=["disabled"],v_={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},b_={key:0,class:"modal-backdrop fade show"};const w_=tr({name:"WaiterProfileView",setup(){const e=g(),n=Ga(),i=t({name:"",email:"",phone:"",avatar:""}),o=t({current:"",new:"",confirm:""}),r=t(!0),l=t(!1),c=t(""),d=t(""),u=t(null),h=t(null),p=t(!1),m=t(""),f=t(!1),v=a(()=>!o.value.new||o.value.new.length>=8),b=a(()=>!o.value.new||!o.value.confirm||o.value.new===o.value.confirm),w=a(()=>!(!i.value.name||!i.value.email)&&(!(o.value.current||o.value.new||o.value.confirm)||o.value.current&&v.value&&b.value));s(()=>{(async()=>{r.value=!0,c.value="";try{const e=Mr.getUser()||{id:"1",name:"Juan Pérez",email:"juan@ejemplo.com",phone:"555-123-4567",avatar:"https://randomuser.me/api/portraits/men/32.jpg"};i.value={...e}}catch(e){console.error("Error al cargar datos del usuario:",e),c.value="No se pudieron cargar tus datos. Por favor, inténtalo de nuevo."}finally{r.value=!1}})()});const y=t(!1),_=t(["Atención al cliente","Trabajo en equipo","Resolución de problemas","Manejo de bandeja","Conocimiento de vinos"]);return{user:i,passwords:o,loading:r,updating:l,error:c,success:d,avatarPreview:u,showDeleteModal:p,deleteConfirmation:m,deleting:f,isPasswordValid:v,doPasswordsMatch:b,isFormValid:w,handleAvatarChange:e=>{const t=e.target.files[0];if(!t)return;if(t.size>5242880)return void(c.value="La imagen no puede ser mayor a 5MB");h.value=t;const a=new FileReader;a.onload=e=>{u.value=e.target.result},a.readAsDataURL(t)},updateProfile:async()=>{var e,t;if(w.value){l.value=!0,c.value="",d.value="";try{const e=new FormData;e.append("name",i.value.name),e.append("email",i.value.email),e.append("phone",i.value.phone||""),h.value&&e.append("avatar",h.value),o.value.current&&o.value.new&&(e.append("current_password",o.value.current),e.append("password",o.value.new),e.append("password_confirmation",o.value.confirm)),console.log("Perfil actualizado:",{name:i.value.name,email:i.value.email,phone:i.value.phone,passwordChanged:!!o.value.current,avatarChanged:!!h.value});const t=Mr.getUser();t&&(t.name=i.value.name,t.email=i.value.email,t.phone=i.value.phone,u.value&&(t.avatar=u.value),Mr.setUser(t)),o.value.current="",o.value.new="",o.value.confirm="",h.value=null,d.value="Perfil actualizado correctamente"}catch(a){console.error("Error al actualizar perfil:",a),c.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"No se pudo actualizar el perfil. Por favor, inténtalo de nuevo."}finally{l.value=!1}}},deleteAccount:async()=>{var t,a;if("ELIMINAR"===m.value){f.value=!0;try{console.log("Cuenta eliminada"),await Mr.logout(),e.push("/login")}catch(n){console.error("Error al eliminar cuenta:",n),c.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"No se pudo eliminar la cuenta. Por favor, inténtalo de nuevo.",p.value=!1,m.value="",f.value=!1}}},goBack:()=>{e.push("/waiter")},isEditing:y,skills:_,handleUpdate:async(e,t)=>{console.log(`Actualizando ${e} a ${t}`);const a=new FormData;a.append(e,t);try{await n.updateProfile(a)}catch(s){console.error("Fallo al actualizar, la tienda necesita ser corregida.",s)}}}}},[["render",function(e,t,a,n,s,i){return r(),o("div",Iy,[l("div",Ay,[l("div",Py,[l("div",Ry,[l("div",Dy,[l("div",Ly,[t[26]||(t[26]=l("h1",{class:"h3 mb-4"},"Mi perfil",-1)),n.success?(r(),o("div",My,d(n.success),1)):c("",!0),n.error?(r(),o("div",Oy,d(n.error),1)):c("",!0),n.loading&&!n.user.name?(r(),o("div",Fy,t[14]||(t[14]=[l("div",{class:"spinner-border text-primary",role:"status"},[l("span",{class:"visually-hidden"},"Cargando...")],-1)]))):(r(),o("form",{key:3,onSubmit:t[9]||(t[9]=h((...e)=>n.updateProfile&&n.updateProfile(...e),["prevent"]))},[l("div",Uy,[l("div",By,[l("img",{src:n.user.avatar||"/placeholder-avatar.png",alt:"Avatar",class:"avatar-img"},null,8,qy),l("div",$y,[t[15]||(t[15]=l("label",{for:"avatar-upload",class:"avatar-edit-btn"},[l("i",{class:"bi bi-camera"})],-1)),l("input",{type:"file",id:"avatar-upload",accept:"image/*",class:"visually-hidden",onChange:t[0]||(t[0]=(...e)=>n.handleAvatarChange&&n.handleAvatarChange(...e))},null,32)])])]),l("div",jy,[t[16]||(t[16]=l("label",{for:"name",class:"form-label"},"Nombre completo",-1)),E(l("input",{type:"text",class:"form-control",id:"name","onUpdate:modelValue":t[1]||(t[1]=e=>n.user.name=e),required:"",disabled:n.updating},null,8,zy),[[S,n.user.name]])]),l("div",Vy,[t[17]||(t[17]=l("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),E(l("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[2]||(t[2]=e=>n.user.email=e),required:"",disabled:n.updating},null,8,Wy),[[S,n.user.email]])]),l("div",Hy,[t[18]||(t[18]=l("label",{for:"phone",class:"form-label"},"Teléfono",-1)),E(l("input",{type:"tel",class:"form-control",id:"phone","onUpdate:modelValue":t[3]||(t[3]=e=>n.user.phone=e),disabled:n.updating},null,8,Gy),[[S,n.user.phone]])]),t[23]||(t[23]=l("hr",{class:"my-4"},null,-1)),t[24]||(t[24]=l("h4",{class:"h5 mb-3"},"Cambiar contraseña",-1)),l("div",Yy,[t[19]||(t[19]=l("label",{for:"current-password",class:"form-label"},"Contraseña actual",-1)),E(l("input",{type:"password",class:"form-control",id:"current-password","onUpdate:modelValue":t[4]||(t[4]=e=>n.passwords.current=e),disabled:n.updating},null,8,Ky),[[S,n.passwords.current]])]),l("div",Qy,[t[20]||(t[20]=l("label",{for:"new-password",class:"form-label"},"Nueva contraseña",-1)),E(l("input",{type:"password",class:"form-control",id:"new-password","onUpdate:modelValue":t[5]||(t[5]=e=>n.passwords.new=e),disabled:n.updating},null,8,Jy),[[S,n.passwords.new]]),n.passwords.new&&!n.isPasswordValid?(r(),o("div",Zy," La contraseña debe tener al menos 8 caracteres ")):c("",!0)]),l("div",Xy,[t[21]||(t[21]=l("label",{for:"confirm-password",class:"form-label"},"Confirmar nueva contraseña",-1)),E(l("input",{type:"password",class:"form-control",id:"confirm-password","onUpdate:modelValue":t[6]||(t[6]=e=>n.passwords.confirm=e),disabled:n.updating},null,8,e_),[[S,n.passwords.confirm]]),n.passwords.confirm&&!n.doPasswordsMatch?(r(),o("div",t_," Las contraseñas no coinciden ")):c("",!0)]),l("div",a_,[l("button",{type:"submit",class:"btn btn-primary",disabled:n.updating||!n.isFormValid},[n.updating?(r(),o("span",s_)):c("",!0),t[22]||(t[22]=v(" Guardar cambios "))],8,n_),l("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[7]||(t[7]=(...e)=>n.goBack&&n.goBack(...e)),disabled:n.updating}," Cancelar ",8,i_)]),t[25]||(t[25]=l("hr",{class:"my-4"},null,-1)),l("div",o_,[l("button",{type:"button",class:"btn btn-outline-danger",onClick:t[8]||(t[8]=e=>n.showDeleteModal=!0),disabled:n.updating}," Eliminar cuenta ",8,r_)])],32))])])])])]),l("div",{class:u(["modal",{"show d-block":n.showDeleteModal}]),tabindex:"-1"},[l("div",l_,[l("div",c_,[l("div",d_,[t[27]||(t[27]=l("h5",{class:"modal-title"},"Eliminar cuenta",-1)),l("button",{type:"button",class:"btn-close",onClick:t[10]||(t[10]=e=>n.showDeleteModal=!1)})]),l("div",u_,[t[29]||(t[29]=l("p",{class:"mb-3"},"¿Estás seguro de que deseas eliminar tu cuenta? Esta acción no se puede deshacer.",-1)),t[30]||(t[30]=l("div",{class:"alert alert-danger"},[l("i",{class:"bi bi-exclamation-triangle-fill me-2"}),v(" Al eliminar tu cuenta perderás todo el acceso a tus datos y negocios asociados. ")],-1)),l("div",h_,[t[28]||(t[28]=l("label",{for:"confirm-delete",class:"form-label"},'Escribe "ELIMINAR" para confirmar',-1)),E(l("input",{type:"text",class:"form-control",id:"confirm-delete","onUpdate:modelValue":t[11]||(t[11]=e=>n.deleteConfirmation=e),disabled:n.deleting},null,8,p_),[[S,n.deleteConfirmation]])])]),l("div",m_,[l("button",{type:"button",class:"btn btn-secondary",onClick:t[12]||(t[12]=e=>n.showDeleteModal=!1),disabled:n.deleting}," Cancelar ",8,f_),l("button",{type:"button",class:"btn btn-danger",onClick:t[13]||(t[13]=(...e)=>n.deleteAccount&&n.deleteAccount(...e)),disabled:"ELIMINAR"!==n.deleteConfirmation||n.deleting},[n.deleting?(r(),o("span",v_)):c("",!0),t[31]||(t[31]=v(" Eliminar mi cuenta "))],8,g_)])])])],2),n.showDeleteModal?(r(),o("div",b_)):c("",!0)])}],["__scopeId","data-v-bc0a0118"]]),y_=e("waiter",()=>{const e=t(localStorage.getItem("waiterBusinessId")||null),n=t(null),s=t([]),i=t([]),o=t([]),r=t(!1),l=t(null),c=a(()=>!!e.value),d=a(()=>o.value.filter(e=>"pending"===e.status).sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp))),u=e=>({...e,name:String(e.number),notifications_on:e.notifications_enabled??!0,is_muted:!(e.notifications_enabled??1),color:e.color??null,alert:!1});return{businessId:e,businessData:n,tables:s,profiles:i,notifications:o,isLoading:r,error:l,isAssociated:c,activeNotifications:d,associateBusiness:async t=>{var a,s;r.value=!0,l.value=null;try{const a=await Ta.waiterOnboard(t),{business:s}=a.data;return e.value=s.id,n.value=s,localStorage.setItem("waiterBusinessId",s.id),!0}catch(i){throw l.value=(null==(s=null==(a=i.response)?void 0:a.data)?void 0:s.message)||"Error al asociar el negocio.",i}finally{r.value=!1}},fetchInitialData:async()=>{var e,t,a;if(c.value){r.value=!0,l.value=null;try{const[t,a,n]=await Promise.all([Ta.getWaiterTables(),Ta.listWaiterProfiles(),Ta.getWaiterNotifications()]),r=(null==(e=t.data)?void 0:e.tables)??t.data;s.value=Array.isArray(r)?r.map(u):[],i.value=a.data,o.value=n.data}catch(n){l.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al cargar los datos iniciales.",console.error(n)}finally{r.value=!1}}},toggleTableNotifications:async e=>{var t,a;const n=e.notifications_on;e.notifications_on=!n,e.is_muted=!e.notifications_on;try{await Ta.toggleTableNotifications(e.id,{value:e.notifications_on})}catch(s){e.notifications_on=n,e.is_muted=!n,l.value=(null==(a=null==(t=s.response)?void 0:t.data)?void 0:a.message)||"Error al actualizar la mesa.",console.error(s)}},fetchNotifications:async()=>{try{const e=await Ta.getWaiterNotifications();o.value=e.data}catch(e){console.error("Error fetching notifications:",e)}},handleNotification:async(e,t)=>{var a,n;try{await Ta.handleWaiterNotification(e,{action:t}),o.value=o.value.filter(t=>t.id!==e)}catch(s){l.value=(null==(n=null==(a=s.response)?void 0:a.data)?void 0:n.message)||"Error al procesar la notificación.",console.error(s)}},createProfile:async e=>{var t,a;try{const t=await Ta.createWaiterProfile({name:e});i.value.push(t.data)}catch(n){l.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al crear el perfil.",console.error(n)}},deleteProfile:async e=>{var t,a;try{await Ta.deleteWaiterProfile(e),i.value=i.value.filter(t=>t.id!==e)}catch(n){l.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al eliminar el perfil.",console.error(n)}},clearWaiterData:()=>{e.value=null,n.value=null,s.value=[],i.value=[],o.value=[],localStorage.removeItem("waiterBusinessId")}}}),__={class:"onboarding-container"},k_={class:"content-wrapper"},C_=["src"],E_={class:"form-container"},S_=["disabled"],T_={key:0,class:"spinner"},N_={key:1},x_=["onInput","onKeydown"],I_={key:0,class:"error-feedback"},A_=tr({__name:"Onboarding",setup(e){const a=g(),s=y_(),i=Ga(),u=t(["","","",""]),f=t(!1),v=t(""),b=t([]),w=e=>{e.preventDefault();const t=e.clipboardData.getData("text").trim().slice(0,4);/^\d{4}$/.test(t)&&(t.split("").forEach((e,t)=>{u.value[t]=e,b.value[t].value=e}),b.value[3].focus(),y())},y=async()=>{const e=u.value.join("");if(4===e.length){f.value=!0,v.value="";try{await s.associateBusiness(e),await i.fetchUser(),a.push({name:"waiter-dashboard"})}catch(t){v.value=t.message||"El código es incorrecto o ha expirado.","vibrate"in navigator&&navigator.vibrate(100)}finally{f.value=!1}}else v.value="El código debe tener 4 dígitos."},_=()=>{a.push("/profile")};return(e,t)=>{var a;return r(),o("div",__,[l("div",k_,[l("div",{class:"user-header",onClick:_,title:"Editar perfil"},[l("img",{src:(null==(a=n(i).user)?void 0:a.avatar)||"/src/assets/default-avatar.png",alt:"Avatar",class:"user-avatar"},null,8,C_),t[0]||(t[0]=l("div",{class:"business-selector-wrapper",title:"Vincúlate introduciendo un código"},[l("span",null,"Negocio:"),l("select",{disabled:""},[l("option",null,"Ninguno")])],-1))]),l("div",E_,[l("form",{onSubmit:h(y,["prevent"])},[l("button",{type:"submit",class:"btn-primary",disabled:f.value},[f.value?(r(),o("span",T_)):(r(),o("span",N_,"AGREGAR NEGOCIO"))],8,S_),t[1]||(t[1]=l("h2",{class:"code-prompt"},"Código",-1)),l("div",{class:"otp-inputs",onPaste:w},[(r(),o(p,null,m(4,e=>l("input",{key:e,type:"text",inputmode:"numeric",maxlength:"1",class:"otp-box",ref_for:!0,ref:t=>b.value[e-1]=t,onInput:t=>((e,t)=>{const a=e.target;let n=a.value;/^\d*$/.test(n)?(u.value[t-1]=n,n&&a.nextElementSibling&&a.nextElementSibling.focus()):a.value=""})(t,e),onKeydown:e=>{var t;"Backspace"===(t=e).key&&!t.target.value&&t.target.previousElementSibling&&t.target.previousElementSibling.focus()}},null,40,x_)),64))],32)],32),v.value?(r(),o("p",I_,d(v.value),1)):c("",!0)])])])}}},[["__scopeId","data-v-f5df5087"]]),P_={class:"dashboard"},R_={class:"container py-3"},D_={class:"role-section"},L_={class:"role-dropdown me-2"},M_={class:"dropdown-menu","aria-labelledby":"roleMenu"},O_={class:"user-id-container d-flex align-items-center"},F_={class:"user-id me-2"},U_={class:"row mb-3"},B_={class:"col-12"},q_={class:"card"},$_={class:"card-body"},j_={class:"d-flex gap-2"},z_=["disabled"],V_=["disabled"],W_={class:"row g-3 card-grid"},H_={class:"col-6"},G_={class:"col-6"},Y_={class:"col-6"},K_={class:"col-6"},Q_={class:"position-fixed bottom-0 end-0 p-3",style:{"z-index":"11"}},J_={key:0,class:"toast show",role:"alert","aria-live":"assertive","aria-atomic":"true"},Z_={class:"toast-header"},X_={class:"toast-body"};const ek=tr({name:"AdminDashboardView",setup(){const e=g(),a=t("FGT-464"),n=t("admin"),i=t(!1),o=t(""),r=t(!1);return s(()=>{(async()=>{try{a.value="FGT-464"}catch(e){console.error("Error al cargar datos del negocio:",e)}})()}),{businessCode:a,selectedRole:n,showToast:i,toastMessage:o,isSendingNotification:r,copyBusinessCode:()=>{navigator.clipboard.writeText(a.value).then(()=>{i.value=!0,o.value="Código copiado al portapapeles",setTimeout(()=>{i.value=!1},3e3)}).catch(e=>{console.error("Error al copiar al portapapeles:",e)})},sendTestNotification:async()=>{r.value=!0;try{await Sa.post("/admin/notifications/test",{waiter_id:"all"});i.value=!0,o.value="Notificación de prueba enviada exitosamente",window.debugPanel&&window.debugPanel.addLog("info","Notificación de prueba enviada a todos los mozos","Admin Dashboard")}catch(e){console.error("Error al enviar notificación de prueba:",e),i.value=!0,o.value="Error al enviar notificación de prueba",window.debugPanel&&window.debugPanel.addLog("error",`Error al enviar notificación: ${e.message}`,"Admin Dashboard",e)}finally{r.value=!1,setTimeout(()=>{i.value=!1},3e3)}},sendTestNotificationToSpecificWaiter:async()=>{const e=prompt("Ingresa el ID del mozo para enviar la notificación de prueba:");if(e){r.value=!0;try{await Sa.post("/admin/notifications/test",{waiter_id:e});i.value=!0,o.value=`Notificación de prueba enviada al mozo ${e}`,window.debugPanel&&window.debugPanel.addLog("info",`Notificación de prueba enviada al mozo ${e}`,"Admin Dashboard")}catch(t){console.error("Error al enviar notificación de prueba:",t),i.value=!0,o.value="Error al enviar notificación de prueba",window.debugPanel&&window.debugPanel.addLog("error",`Error al enviar notificación: ${t.message}`,"Admin Dashboard",t)}finally{r.value=!1,setTimeout(()=>{i.value=!1},3e3)}}},handleRoleChange:()=>{"admin"===n.value?n.value="waiter":n.value="admin","waiter"===n.value&&e.push("/waiter")}}}},[["render",function(e,t,a,n,s,i){const u=_("router-link");return r(),o("div",P_,[l("div",R_,[l("div",D_,[l("div",L_,[t[6]||(t[6]=l("button",{class:"btn btn-outline-secondary dropdown-toggle",id:"roleMenu","data-bs-toggle":"dropdown"}," Rol Admin ",-1)),l("ul",M_,[l("li",null,[l("a",{class:"dropdown-item",href:"#",onClick:t[0]||(t[0]=e=>n.selectedRole="admin")},"Admin")]),l("li",null,[l("a",{class:"dropdown-item",href:"#",onClick:t[1]||(t[1]=(...e)=>n.handleRoleChange&&n.handleRoleChange(...e))},"Mozo")])])]),l("div",O_,[l("span",F_,"ID:"+d(n.businessCode),1),l("button",{class:"btn btn-sm btn-outline-secondary",onClick:t[2]||(t[2]=(...e)=>n.copyBusinessCode&&n.copyBusinessCode(...e)),title:"Copiar al portapapeles"},t[7]||(t[7]=[l("i",{class:"bi bi-clipboard"},null,-1)]))])]),l("div",U_,[l("div",B_,[l("div",q_,[l("div",$_,[t[10]||(t[10]=l("h5",{class:"card-title"},[l("i",{class:"bi bi-bell-fill text-primary me-2"}),v(" Prueba de Notificaciones ")],-1)),t[11]||(t[11]=l("p",{class:"card-text text-muted"}," Envía una notificación de prueba a todos los mozos activos para verificar el sistema. ",-1)),l("div",j_,[l("button",{class:"btn btn-primary",onClick:t[3]||(t[3]=(...e)=>n.sendTestNotification&&n.sendTestNotification(...e)),disabled:n.isSendingNotification},[t[8]||(t[8]=l("i",{class:"bi bi-send me-2"},null,-1)),v(" "+d(n.isSendingNotification?"Enviando...":"Enviar Notificación de Prueba"),1)],8,z_),l("button",{class:"btn btn-outline-secondary",onClick:t[4]||(t[4]=(...e)=>n.sendTestNotificationToSpecificWaiter&&n.sendTestNotificationToSpecificWaiter(...e)),disabled:n.isSendingNotification},t[9]||(t[9]=[l("i",{class:"bi bi-person-plus me-2"},null,-1),v(" Enviar a Mozo Específico ")]),8,V_)])])])])]),l("div",W_,[l("div",H_,[f(u,{to:"/admin/qr",class:"card dashboard-card text-center text-decoration-none"},{default:y(()=>t[12]||(t[12]=[l("div",{class:"card-body"},[l("i",{class:"bi bi-qr-code"})],-1),l("div",{class:"card-footer"},"QR",-1)])),_:1,__:[12]})]),l("div",G_,[f(u,{to:"/admin/stats",class:"card dashboard-card text-center text-decoration-none"},{default:y(()=>t[13]||(t[13]=[l("div",{class:"card-body"},[l("i",{class:"bi bi-graph-up"})],-1),l("div",{class:"card-footer"},"ESTADÍSTICAS",-1)])),_:1,__:[13]})]),l("div",Y_,[f(u,{to:"/admin/staff",class:"card dashboard-card text-center text-decoration-none"},{default:y(()=>t[14]||(t[14]=[l("div",{class:"card-body"},[l("i",{class:"bi bi-person-fill"})],-1),l("div",{class:"card-footer"},"PERSONAL",-1)])),_:1,__:[14]})]),l("div",K_,[f(u,{to:"/admin/settings",class:"card dashboard-card text-center text-decoration-none"},{default:y(()=>t[15]||(t[15]=[l("div",{class:"card-body"},[l("i",{class:"bi bi-gear-fill"})],-1),l("div",{class:"card-footer"},"CONFIGURACIÓN",-1)])),_:1,__:[15]})])])]),l("div",Q_,[n.showToast?(r(),o("div",J_,[l("div",Z_,[t[16]||(t[16]=l("strong",{class:"me-auto"},"Notificación",-1)),l("button",{type:"button",class:"btn-close",onClick:t[5]||(t[5]=e=>n.showToast=!1)})]),l("div",X_,d(n.toastMessage),1)])):c("",!0)])])}]]),tk=e("admin",()=>{const e=t(localStorage.getItem("businessId")||null),n=t(null),s=t([]),i=t([]),o=t([]),r=t([]),l=t([]),c=t(null),d=t(!1),u=t(null),h=t({next:null,prev:null}),p=t({current_page:1,last_page:1}),m=a(()=>s.value.length>0),f=a(()=>i.value.length>0),g=a(()=>o.value.filter(e=>"pending"===e.status)),v=async()=>{var e;d.value=!0,u.value=null;try{const t=await Ta.getMenus(),a=(null==(e=t.data)?void 0:e.menus)??t.data,n=Array.isArray(a)?a:[];return s.value=n.map(e=>({id:e.id,name:e.name,url:e.view_url||e.file_path,thumbnailUrl:e.preview_url||e.thumbnail_url||"/src/assets/pdf-thumb.png",isDefault:e.is_default})),s.value}catch(t){throw u.value=t.message||"Error al cargar menús",t}finally{d.value=!1}},b=async()=>{d.value=!0,u.value=null;try{const e=await Ta.getTables();return i.value=e.data.tables||[],!0}catch(e){return u.value=e.message||"Error al obtener mesas",!1}finally{d.value=!1}},w=async()=>{var e;d.value=!0,u.value=null;try{const t=await Ta.getStaffRequests(),a=(null==(e=t.data)?void 0:e.requests)??t.data,n=Array.isArray(a)?a:[];return o.value=n,o.value}catch(t){throw u.value=t.message||"Error al cargar solicitudes de personal",t}finally{d.value=!1}},y=async()=>{var e,t;d.value=!0,u.value=null;try{const a=await Ta.getArchivedStaffRequests(),n=(null==(e=a.data)?void 0:e.archived_requests)??(null==(t=a.data)?void 0:t.requests)??a.data,s=Array.isArray(n)?n:[];return r.value=s,r.value}catch(a){throw u.value=a.message||"Error al cargar solicitudes archivadas",a}finally{d.value=!1}},_=async(e=1)=>{var t,a,n,s,i,o,r,c,m,f;d.value=!0,u.value=null;try{const d="string"==typeof e?await Sa.get(e.replace(Sa.defaults.baseURL+"/","")):await Ta.getStaff(e),u=(null==(t=d.data)?void 0:t.staff)??(null==(a=d.data)?void 0:a.data)??d.data;return l.value=Array.isArray(u)?u:[],h.value={next:(null==(s=null==(n=d.data)?void 0:n.links)?void 0:s.next)??null,prev:(null==(o=null==(i=d.data)?void 0:i.links)?void 0:o.prev)??null},p.value={current_page:(null==(c=null==(r=d.data)?void 0:r.meta)?void 0:c.current_page)??1,last_page:(null==(f=null==(m=d.data)?void 0:m.meta)?void 0:f.last_page)??1},l.value}catch(g){throw u.value=g.message||"Error al cargar el personal",g}finally{d.value=!1}};return{businessId:e,businessData:n,menus:s,tables:i,staffRequests:o,archivedRequests:r,staff:l,statistics:c,isLoading:d,error:u,staffLinks:h,staffMeta:p,hasMenus:m,hasTables:f,pendingRequests:g,fetchBusinessData:async()=>{d.value=!0,u.value=null;try{return n.value={id:"rest-1",name:"Mi Restaurante",address:"Calle Principal 123",phone:"+34 678 123 456",email:"contacto@mirestaurante.com",logo:"/src/assets/mozo-logo.svg",description:"El mejor restaurante de la ciudad",openingHours:{monday:{open:"12:00",close:"23:00"},tuesday:{open:"12:00",close:"23:00"},wednesday:{open:"12:00",close:"23:00"},thursday:{open:"12:00",close:"23:00"},friday:{open:"12:00",close:"00:00"},saturday:{open:"12:00",close:"00:00"},sunday:{open:"12:00",close:"23:00"}},tables:20,capacity:80,averageRating:4.5},e.value||(e.value=n.value.id,localStorage.setItem("businessId",n.value.id)),n.value}catch(t){throw u.value=t.message||"Error al cargar datos del negocio",t}finally{d.value=!1}},fetchMenus:v,setDefaultMenu:async e=>{d.value=!0,u.value=null;try{return await Ta.setDefaultMenu({menu_id:e}),await v(),!0}catch(t){throw u.value=t.message||"Error al establecer menú predeterminado",t}finally{d.value=!1}},uploadMenu:async e=>{d.value=!0,u.value=null;try{const t=await Ta.uploadMenu(e);return await v(),t.data}catch(t){throw u.value=t.message||"Error al subir menú",t}finally{d.value=!1}},fetchTables:b,createTable:async e=>{d.value=!0,u.value=null;try{await Ta.createTable(e);return await b(),!0}catch(t){return u.value=t.message||"Error al crear mesa",!1}finally{d.value=!1}},updateTable:async(e,t)=>{d.value=!0,u.value=null;try{const a=await Ta.updateTable(e,t),n=i.value.findIndex(t=>t.id===e);return-1!==n&&(i.value[n]=a.data),a.data}catch(a){throw u.value=a.message||"Error al actualizar mesa",a}finally{d.value=!1}},deleteTable:async e=>{d.value=!0,u.value=null;try{return await Ta.deleteTable(e),i.value=i.value.filter(t=>t.id!==e),!0}catch(t){throw u.value=t.message||"Error al eliminar mesa",t}finally{d.value=!1}},fetchStaffRequests:w,fetchArchivedRequests:y,handleStaffRequest:async(e,t)=>{d.value=!0,u.value=null;try{return await Ta.handleStaffRequest(e,{action:t}),await w(),await y(),"confirm"===t&&await _(),!0}catch(a){throw u.value=a.message||"Error al procesar solicitud",a}finally{d.value=!1}},fetchStaff:_,inviteStaff:async e=>{d.value=!0,u.value=null;try{const t=await Ta.inviteStaff(e);return await w(),t.data}catch(t){throw u.value=t.message||"Error al enviar invitación",t}finally{d.value=!1}},fetchDashboardStats:async()=>{var e;d.value=!0,u.value=null;try{const t=await Ta.getAdminStatistics();return(null==(e=t.data)?void 0:e.statistics)??t.data}catch(t){throw u.value=t.message||"Error al cargar estadísticas",t}finally{d.value=!1}},fetchStaffMember:async e=>{var t;d.value=!0,u.value=null;try{const a=await Ta.getStaffMember(e);return(null==(t=a.data)?void 0:t.staff)??a.data}catch(a){throw u.value=a.message||"Error al cargar datos del miembro del personal",a}finally{d.value=!1}},updateStaffMember:async(e,t)=>{d.value=!0,u.value=null;try{const a=await Ta.updateStaffMember(e,t),n=l.value.findIndex(t=>t.id===e);return-1!==n&&(l.value[n]={...l.value[n],...a.data}),a.data}catch(a){throw u.value=a.message||"Error al actualizar miembro del personal",a}finally{d.value=!1}},removeStaff:async e=>{d.value=!0,u.value=null;try{return await Ta.removeStaff(e),l.value=l.value.filter(t=>t.id!==e),!0}catch(t){throw u.value=t.message||"Error al eliminar miembro del personal",t}finally{d.value=!1}},addReview:async(e,t)=>{d.value=!0,u.value=null;try{return(await Ta.addReview(e,t)).data}catch(a){throw u.value=a.message||"Error al añadir reseña",a}finally{d.value=!1}},deleteReview:async(e,t)=>{d.value=!0,u.value=null;try{return await Ta.deleteReview(e,t),!0}catch(a){throw u.value=a.message||"Error al eliminar reseña",a}finally{d.value=!1}},renameMenu:async(e,t)=>{d.value=!0,u.value=null;try{return await Ta.renameMenu(e,{name:t}),await v(),!0}catch(a){return u.value=a.message||"Error al renombrar menú",!1}finally{d.value=!1}},deleteMenu:async e=>{d.value=!0,u.value=null;try{return await Ta.deleteMenu(e),await v(),!0}catch(t){throw u.value=t.message||"Error al eliminar menú",t}finally{d.value=!1}},reorderMenus:async e=>{try{await Ta.reorderMenus(e),s.value.sort((t,a)=>e.indexOf(t.id)-e.indexOf(a.id))}catch(t){console.error("Error reordenando menús",t)}},previewMenu:async e=>{try{const t=await Ta.previewMenu(e);return URL.createObjectURL(t.data)}catch(t){return console.error("Error obteniendo preview",t),null}},cloneTable:async(e,t)=>{d.value=!0;try{const a=await Ta.cloneTable(e,t);i.value.push(a.data)}catch(a){console.error("Error clonando mesa",a)}finally{d.value=!1}},generateQrCode:async e=>{d.value=!0,u.value=null;try{await Ta.generateQRCode(e),await b()}catch(t){throw u.value=t.message||"Error al generar código QR",t}finally{d.value=!1}}}}),ak={class:"dashboard"},nk={class:"container py-3"},sk={class:"role-section"},ik={class:"user-id"},ok={key:0,class:"text-center py-5"},rk={key:1,class:"alert alert-danger"},lk={key:2,class:"row g-3 card-grid"},ck={class:"col-6"},dk={class:"col-6"},uk={class:"col-6"},hk={class:"col-6"},pk={__name:"Home",setup(e){const a=g(),i=tk();Ga();const c=t(!1),u=t(""),p=t({activeRequests:0,pendingRequests:0,totalOrders:0,totalSales:0,salesThisMonth:0});s(async()=>{c.value=!0,u.value="";try{await i.fetchBusinessData(),await i.fetchStaffRequests();const e=await i.fetchDashboardStats();p.value=e}catch(e){u.value=e.message||"Error al cargar datos del negocio"}finally{c.value=!1}});const m=e=>{a.push({name:e})};return(e,t)=>(r(),o("div",ak,[l("div",nk,[l("div",sk,[t[5]||(t[5]=A('<div class="role-dropdown me-2"><button class="btn btn-outline-secondary dropdown-toggle" id="roleMenu" data-bs-toggle="dropdown"> Rol Admin </button><ul class="dropdown-menu" aria-labelledby="roleMenu"><li><a class="dropdown-item" href="#">Admin</a></li><li><a class="dropdown-item" href="#">Mozo</a></li></ul></div>',1)),l("span",ik,"ID:"+d(n(i).businessId),1)]),c.value?(r(),o("div",ok,t[6]||(t[6]=[l("div",{class:"spinner-border text-primary",role:"status"},[l("span",{class:"visually-hidden"},"Cargando...")],-1),l("p",{class:"mt-2"},"Cargando...",-1)]))):u.value?(r(),o("div",rk,[l("p",null,d(u.value),1),l("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=t=>e.$router.go(0))}," Reintentar ")])):(r(),o("div",lk,[l("div",ck,[l("a",{href:"#",onClick:t[1]||(t[1]=h(e=>m("admin-qr"),["prevent"])),class:"card dashboard-card text-center text-decoration-none"},t[7]||(t[7]=[l("div",{class:"card-body"},[l("i",{class:"bi bi-qr-code"})],-1),l("div",{class:"card-footer"},"QR",-1)]))]),l("div",dk,[l("a",{href:"#",onClick:t[2]||(t[2]=h(e=>m("admin-stats"),["prevent"])),class:"card dashboard-card text-center text-decoration-none"},t[8]||(t[8]=[l("div",{class:"card-body"},[l("i",{class:"bi bi-graph-up"})],-1),l("div",{class:"card-footer"},"ESTADÍSTICAS",-1)]))]),l("div",uk,[l("a",{href:"#",onClick:t[3]||(t[3]=h(e=>m("admin-staff"),["prevent"])),class:"card dashboard-card text-center text-decoration-none"},t[9]||(t[9]=[l("div",{class:"card-body"},[l("i",{class:"bi bi-person-fill"})],-1),l("div",{class:"card-footer"},"PERSONAL",-1)]))]),l("div",hk,[l("a",{href:"#",onClick:t[4]||(t[4]=h(e=>m("admin-settings"),["prevent"])),class:"card dashboard-card text-center text-decoration-none"},t[10]||(t[10]=[l("div",{class:"card-body"},[l("i",{class:"bi bi-gear-fill"})],-1),l("div",{class:"card-footer"},"CONFIGURACIÓN",-1)]))])]))])]))}},mk={class:"modal-content rounded-4"},fk={class:"modal-header"},gk={class:"modal-title"},vk={class:"modal-body"},bk={key:0,class:"modal-footer"},wk=tr({__name:"BaseModal",props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:""},size:{type:String,default:"",validator:e=>["","sm","lg","xl"].includes(e)},centered:{type:Boolean,default:!0},scrollable:{type:Boolean,default:!1},staticBackdrop:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:n}){const i=e,h=n,p=t(null);let m=null;s(()=>{p.value&&(m=new q(p.value,{backdrop:!i.staticBackdrop||"static",keyboard:!i.staticBackdrop}),p.value.addEventListener("hidden.bs.modal",()=>{h("update:modelValue",!1)}),i.modelValue&&m.show())}),P(()=>{m&&m.dispose()}),x(()=>i.modelValue,e=>{!m&&p.value&&(m=new q(p.value,{backdrop:!i.staticBackdrop||"static",keyboard:!i.staticBackdrop})),e&&m?m.show():!e&&m&&m.hide()});const f=a(()=>{const e=["modal-dialog"];return i.centered&&e.push("modal-dialog-centered"),i.scrollable&&e.push("modal-dialog-scrollable"),i.size&&e.push(`modal-${i.size}`),e.join(" ")});return(t,a)=>(r(),o("div",{ref_key:"modalElement",ref:p,class:"modal fade",tabindex:"-1","aria-hidden":"true"},[l("div",{class:u(f.value)},[l("div",mk,[l("div",fk,[l("h5",gk,d(e.title),1),l("button",{type:"button",class:"btn-close",onClick:a[0]||(a[0]=e=>h("update:modelValue",!1)),"aria-label":"Close"})]),l("div",vk,[R(t.$slots,"default",{},void 0)]),t.$slots.footer?(r(),o("div",bk,[R(t.$slots,"footer",{},void 0)])):c("",!0)])],2)],512))}},[["__scopeId","data-v-aefedeba"]]),yk={class:"mb-3"},_k={class:"form-label"},kk=["type","placeholder"],Ck=["disabled"],Ek={__name:"InputModal",props:{modelValue:Boolean,title:{type:String,default:"Ingresar dato"},label:{type:String,default:""},placeholder:{type:String,default:""},defaultValue:{type:[String,Number],default:""},inputType:{type:String,default:"text"}},emits:["update:modelValue","confirm"],setup(e,{emit:a}){const n=e,s=a,i=t(n.defaultValue);x(()=>n.modelValue,e=>{e&&(i.value=n.defaultValue)});const o=()=>{const e="number"===n.inputType?i.value:i.value.trim();s("confirm",e),s("update:modelValue",!1)};return(t,a)=>(r(),w(wk,{"model-value":e.modelValue,"onUpdate:modelValue":a[2]||(a[2]=e=>t.$emit("update:modelValue",e)),title:e.title,size:"sm"},{footer:y(()=>[l("button",{class:"btn btn-secondary",onClick:a[1]||(a[1]=e=>t.$emit("update:modelValue",!1))},"Cancelar"),l("button",{class:"btn btn-primary",disabled:!i.value.toString().trim(),onClick:o},"Aceptar",8,Ck)]),default:y(()=>[l("div",yk,[l("label",_k,d(e.label),1),E(l("input",{type:e.inputType,class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>i.value=e),placeholder:e.placeholder},null,8,kk),[[D,i.value]])])]),_:1},8,["model-value","title"]))}},Sk=tr({__name:"SkeletonLoader",props:{width:{type:String,default:"100%"},height:{type:String,default:"1rem"},borderRadius:{type:String,default:"4px"}},setup:e=>(t,a)=>(r(),o("div",{class:"skeleton",style:L({width:e.width,height:e.height,borderRadius:e.borderRadius})},null,4))},[["__scopeId","data-v-7bfd6ab9"]]),Tk={class:"menu-card-skeleton"},Nk={class:"skeleton-info"},xk=tr({__name:"MenuCardSkeleton",setup:e=>(e,t)=>(r(),o("div",Tk,[f(Sk,{height:"150px",borderRadius:"12px 12px 0 0"}),l("div",Nk,[f(Sk,{width:"70%",height:"1.25rem",borderRadius:"4px"}),f(Sk,{width:"40%",height:"1rem",borderRadius:"4px",style:{"margin-top":"8px"}})])]))},[["__scopeId","data-v-01f8ef4d"]]),Ik={class:"table-item-skeleton"},Ak=tr({__name:"TableListItemSkeleton",setup:e=>(e,t)=>(r(),o("div",Ik,[f(Sk,{width:"80%",height:"24px",borderRadius:"6px"})]))},[["__scopeId","data-v-41c50015"]]),Pk={class:"qr-container"},Rk={class:"tabs-container"},Dk={class:"tabs-header d-flex justify-content-center align-items-center"},Lk={key:0,class:"loading-container"},Mk={key:1,class:"alert alert-danger"},Ok={class:"qr-content"},Fk={key:0,class:"qr-layout"},Uk={class:"tables-panel"},Bk={class:"select-all-container"},qk=["checked"],$k={key:0,class:"tables-list"},jk={key:1,class:"tables-list"},zk=["onClick"],Vk=["checked","onChange"],Wk={class:"qr-panel"},Hk={key:0,class:"qr-display-multiple"},Gk={class:"share-buttons"},Yk={key:1,class:"qr-display"},Kk={class:"qr-table-name"},Qk={key:0,class:"qr-code-item"},Jk={key:0,class:"qr-image-loader"},Zk=["src"],Xk={key:2,class:"qr-image-error"},eC={class:"share-buttons"},tC={key:1,class:"no-qr-codes"},aC={key:2,class:"qr-placeholder"},nC={key:1,class:"menu-layout"},sC={key:0,class:"menu-grid"},iC={key:1,class:"menu-grid"},oC=["onClick"],rC={class:"card-content"},lC={class:"menu-info"},cC={class:"menu-name"},dC={key:0,class:"menu-badge"},uC=["onClick"],hC=["onClick"],pC=["onClick"],mC=["onClick"],fC=["onClick"],gC={key:0,class:"processing-overlay"},vC={class:"download-modal-content"},bC={class:"form-group"},wC={class:"email-modal-content"},yC={class:"form-group"},_C={class:"form-group"},kC={class:"form-group"},CC={class:"form-group"},EC=tr({__name:"QR",setup(e){g();const n=tk(),i=a(()=>n.isLoading),b=a(()=>n.error),w=a(()=>n.tables),_=a(()=>n.menus),k=t(null);t("");const C=t(localStorage.getItem("adminQRTab")||"tables"),T=t(!1),N=t(""),A=t(null),P=t(null),R=t([]),D=t(!1),L=t("pdf");let M=[];const O=t(""),F=t(!1),U=t(!1),B=t("pdf"),q=t(""),$=t("Mesas QR"),j=t("Te comparto los códigos.");let z=[];const V=e=>R.value.some(t=>t.id===e.id),W=e=>{e.target.checked?R.value=[...w.value]:R.value=[]},H=e=>{C.value=e,localStorage.setItem("adminQRTab",e)},G=()=>{N.value="",T.value=!0},Y=async e=>{const t=parseInt(e,10);if(isNaN(t)||t<=0)Jo("Por favor, ingresa un número de mesa válido y mayor a cero.");else try{await n.createTable({number:t}),Qo("Mesa creada correctamente")}catch(a){Jo(a.message||"Error al crear la mesa")}},K=async()=>{if(k.value)try{await n.generateQrCode(k.value.id),Qo("Se ha procesado el QR para la mesa.")}catch(e){Jo(e.message||"Error al generar código QR")}},Q=async()=>{const{value:e}=await Yo.fire({title:"Selecciona un PDF",input:"file",inputAttributes:{accept:"application/pdf"},confirmButtonText:"Subir",showCancelButton:!0,cancelButtonText:"Cancelar"});if(!e)return;if(e.size>10485760)return void Jo("El archivo supera los 10 MB");const{value:t}=await Yo.fire({title:"Nombre del menú",input:"text",inputValue:e.name.replace(/\.pdf$/i,""),showCancelButton:!0,confirmButtonText:"Guardar"});if(!t)return;const a=new FormData;a.append("file",e),a.append("name",t),await n.uploadMenu(a),Qo("Menú subido")},J=e=>{M=e,D.value=!0},Z=async()=>{D.value=!1;const e=M.filter(e=>e.qr_code&&e.qr_code.id).map(e=>e.qr_code.id);if(0===e.length)return void Jo("Ninguna de las mesas seleccionadas tiene un QR para exportar.");const t=L.value;try{const a=await Sa.post("/admin/qr/export",{qr_ids:e,format:t},{responseType:"blob"}),n=window.URL.createObjectURL(a.data),s=document.createElement("a");s.href=n;const i=a.headers["content-disposition"];let o;if(i){const e=i.match(/filename="(.+)"/);e&&2===e.length&&(o=e[1])}if(!o){const a=t;if(1===e.length){o=`QR_Mesa_${M.find(t=>t.qr_code&&t.qr_code.id===e[0]).number}.${a}`}else o=`QRs_Export.${a}`}s.download=o,document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(n)}catch(a){Jo("Error al exportar los códigos QR.")}},X=e=>{z=e,U.value=!0},ee=async()=>{U.value=!1;const e=q.value.split(",").map(e=>e.trim()).filter(e=>e);if(0===e.length)return void Jo("Ingresa al menos un destinatario.");const t=z.filter(e=>e.qr_code&&e.qr_code.id).map(e=>e.qr_code.id);if(0===t.length)return void Jo("Ninguna de las mesas seleccionadas tiene un QR para enviar.");const a={qr_ids:t,format:B.value,recipients:e,subject:$.value,body:j.value};try{await Sa.post("/admin/qr/email",a),Qo("Correo enviado correctamente.")}catch(n){Jo(n.message||"Error al enviar el correo.")}};return s(()=>{n.fetchTables(),n.fetchMenus()}),x(k,async e=>{if(O.value&&(URL.revokeObjectURL(O.value),O.value=""),e&&e.qr_code){F.value=!0;try{const t=await Sa.get(`/admin/qr/preview/${e.id}`,{responseType:"blob"});O.value=URL.createObjectURL(t.data)}catch(t){console.error("Error fetching QR code image:",t),Jo("No se pudo cargar la imagen del QR.")}finally{F.value=!1}}}),(e,t)=>(r(),o("div",Pk,[l("div",Rk,[l("div",Dk,[l("button",{class:u(["tab-button",{active:"tables"===C.value}]),onClick:t[0]||(t[0]=e=>H("tables"))}," MESAS ",2),l("button",{class:u(["tab-button",{active:"menus"===C.value}]),onClick:t[1]||(t[1]=e=>H("menus"))}," MENÚ ",2)])]),i.value&&!w.value.length?(r(),o("div",Lk,t[19]||(t[19]=[l("div",{class:"loading-spinner"},null,-1),l("p",null,"Cargando datos...",-1)]))):c("",!0),b.value&&!i.value?(r(),o("div",Mk,d(b.value),1)):c("",!0),l("div",Ok,["tables"===C.value?(r(),o("div",Fk,[l("div",Uk,[t[21]||(t[21]=l("h2",{class:"panel-title"},"Selecciona una mesa",-1)),l("div",Bk,[l("input",{type:"checkbox",onChange:W,checked:w.value.length>0&&R.value.length===w.value.length,class:"form-check-input"},null,40,qk),t[20]||(t[20]=l("label",null,"Seleccionar todo",-1))]),i.value?(r(),o("div",$k,[(r(),o(p,null,m(8,e=>f(Ak,{key:e})),64))])):(r(),o("div",jk,[(r(!0),o(p,null,m(w.value,e=>(r(),o("div",{key:e.id,class:u(["table-item",{active:k.value&&k.value.id===e.id}]),onClick:t=>(e=>{k.value=e})(e)},[l("input",{type:"checkbox",checked:V(e),onChange:t=>(e=>{const t=R.value.findIndex(t=>t.id===e.id);-1===t?R.value.push(e):R.value.splice(t,1)})(e),onClick:t[2]||(t[2]=h(()=>{},["stop"])),class:"form-check-input"},null,40,Vk),l("span",null,d((e.name||`MESA ${e.number}`).toUpperCase()),1)],10,zk))),128))])),l("button",{class:"add-table-btn",onClick:G},"MESA ＋")]),l("div",Wk,[R.value.length>0?(r(),o("div",Hk,[l("h3",null,d(R.value.length)+" mesa(s) seleccionada(s)",1),t[24]||(t[24]=l("p",null,"Selecciona una acción para aplicar a todas las mesas seleccionadas.",-1)),l("div",Gk,[l("button",{onClick:t[3]||(t[3]=e=>J(R.value)),class:"share-btn download"},t[22]||(t[22]=[l("i",{class:"bi bi-download"},null,-1),v(" Descargar QRs ")])),l("button",{onClick:t[4]||(t[4]=e=>X(R.value)),class:"share-btn email"},t[23]||(t[23]=[l("i",{class:"bi bi-envelope-fill"},null,-1),v(" Enviar por correo ")]))])])):k.value?(r(),o("div",Yk,[l("h3",Kk,"Mesa "+d(k.value.number),1),k.value.qr_code?(r(),o("div",Qk,[F.value?(r(),o("div",Jk,t[25]||(t[25]=[l("div",{class:"loading-spinner-small"},null,-1)]))):O.value?(r(),o("img",{key:1,src:O.value,alt:"Código QR",class:"qr-image"},null,8,Zk)):(r(),o("div",Xk,t[26]||(t[26]=[l("i",{class:"bi bi-exclamation-triangle-fill"},null,-1),l("span",null,"Error al cargar QR",-1)]))),l("div",eC,[l("button",{onClick:t[5]||(t[5]=e=>J([k.value])),class:"share-btn download"},t[27]||(t[27]=[l("i",{class:"bi bi-download"},null,-1),v(" Descargar ")])),l("button",{onClick:t[6]||(t[6]=e=>(async e=>{if(e&&e.qr_code)try{const t=await Sa.post("/admin/qr/export",{qr_ids:[e.qr_code.id],format:"png"},{responseType:"blob"}),a=new File([t.data],`QR_Mesa_${e.number}.png`,{type:"image/png"});if(navigator.canShare&&navigator.canShare({files:[a]}))await navigator.share({files:[a],title:`Código QR para Mesa ${e.number}`,text:`Aquí está el código QR para la mesa ${e.number}.`});else{const e=window.URL.createObjectURL(a),t=document.createElement("a");t.href=e,t.download=a.name,document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(e),Qo("Archivo descargado (el navegador no admite compartir).")}}catch(t){"AbortError"!==t.name&&Jo("Error al intentar compartir el código QR.")}else Jo("La mesa no tiene un QR para compartir.")})(k.value)),class:"share-btn share"},t[28]||(t[28]=[l("i",{class:"bi bi-share-fill"},null,-1),v(" Compartir ")])),l("button",{onClick:t[7]||(t[7]=e=>X([k.value])),class:"share-btn email"},t[29]||(t[29]=[l("i",{class:"bi bi-envelope-fill"},null,-1),v(" Enviar ")]))]),l("button",{class:"btn btn-secondary mt-3",onClick:K},"Regenerar QR")])):(r(),o("div",tC,[t[30]||(t[30]=l("p",null,"Esta mesa aún no tiene un código QR.",-1)),l("button",{class:"btn btn-primary mt-3",onClick:K},"Generar QR")]))])):(r(),o("div",aC,t[31]||(t[31]=[l("p",null,"Selecciona una mesa para ver su código QR",-1)])))])])):(r(),o("div",nC,[t[39]||(t[39]=l("div",{class:"row mb-3"},[l("div",{class:"col-12 d-flex flex-column align-items-start justify-content-start"},[l("h2",null,"Menús"),l("p",{class:"text-left"},"Administra tus menús para que tus clientes puedan escanearlos y verlos en su mesa.")])],-1)),i.value?(r(),o("div",sC,[(r(),o(p,null,m(6,e=>f(xk,{key:e})),64))])):(r(),o("div",iC,[(r(!0),o(p,null,m(_.value,e=>(r(),o("div",{key:e.id,class:u(["menu-card",{default:e.isDefault,processing:P.value===e.id}]),onClick:t=>{return a=e.id,void(A.value=A.value===a?null:a);var a}},[l("div",rC,[t[32]||(t[32]=l("div",{class:"menu-cover"},null,-1)),l("div",lC,[l("span",cC,d(e.name),1),e.isDefault?(r(),o("span",dC,"PREDETERMINADO")):c("",!0)])]),l("div",{class:u(["menu-actions",{show:A.value===e.id}]),onClick:t[8]||(t[8]=h(()=>{},["stop"]))},[e.isPredefined?c("",!0):(r(),o("button",{key:0,onClick:t=>(async e=>{P.value=e.id;try{await n.setDefaultMenu(e.id),Qo("Menú predeterminado actualizado"),A.value=null}catch(t){Jo(t.message||"Error al establecer menú predeterminado")}finally{P.value=null}})(e),class:"action-item"},t[33]||(t[33]=[l("span",{class:"action-icon select"},[l("i",{class:"bi bi-check-lg"})],-1),l("span",{class:"action-label"},"Seleccionar",-1)]),8,uC)),l("button",{onClick:t=>(async e=>{const t=await n.previewMenu(e.id);t&&window.open(t,"_blank")})(e),class:"action-item"},t[34]||(t[34]=[l("span",{class:"action-icon view"},[l("i",{class:"bi bi-eye-fill"})],-1),l("span",{class:"action-label"},"Ver",-1)]),8,hC),l("button",{onClick:t=>(async e=>{const{value:t}=await Yo.fire({title:"Nuevo nombre",input:"text",inputValue:e.name,showCancelButton:!0});if(t&&t!==e.name){P.value=e.id;try{await n.renameMenu(e.id,t),Qo("Nombre cambiado"),A.value=null}catch(a){Jo(a.message||"Error al renombrar menú")}finally{P.value=null}}})(e),class:"action-item"},t[35]||(t[35]=[l("span",{class:"action-icon rename"},[l("i",{class:"bi bi-pencil-fill"})],-1),l("span",{class:"action-label"},"Renombrar",-1)]),8,pC),l("button",{onClick:t=>(async e=>{P.value=e.id;try{const t=await Sa.get(`/menus/${e.id}/download`,{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=a;const s=t.headers["content-disposition"];let i=`${e.name}.pdf`;if(s){const e=s.match(/filename="(.+)"/);e&&2===e.length&&(i=e[1])}n.setAttribute("download",i),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(a),A.value=null}catch(t){Jo(t.message||"Error al descargar el archivo.")}finally{P.value=null}})(e),class:"action-item"},t[36]||(t[36]=[l("span",{class:"action-icon download"},[l("i",{class:"bi bi-download"})],-1),l("span",{class:"action-label"},"Descargar",-1)]),8,mC),e.isPredefined?c("",!0):(r(),o("button",{key:1,onClick:t=>(async e=>{if(e.isPredefined)return void Jo("No puedes eliminar el menú predeterminado.");if((await Yo.fire({title:`¿Eliminar "${e.name}"?`,text:"Esta acción es irreversible",icon:"warning",showCancelButton:!0})).isConfirmed){P.value=e.id;try{await n.deleteMenu(e.id),Qo("Menú eliminado"),A.value=null}catch(t){Jo(t.message||"Error al eliminar el menú")}finally{P.value=null}}})(e),class:"action-item"},t[37]||(t[37]=[l("span",{class:"action-icon delete"},[l("i",{class:"bi bi-trash-fill"})],-1),l("span",{class:"action-label"},"Eliminar",-1)]),8,fC))],2),P.value===e.id?(r(),o("div",gC,t[38]||(t[38]=[l("div",{class:"loading-spinner-small"},null,-1)]))):c("",!0)],10,oC))),128)),l("div",{class:"add-menu-card w-100",onClick:Q}," ＋ Agregar menú (PDF) ")]))]))]),f(Ek,{modelValue:T.value,"onUpdate:modelValue":t[9]||(t[9]=e=>T.value=e),title:"Nueva mesa",label:"Número de la mesa",placeholder:"Ej: 5","input-type":"number",onConfirm:Y},null,8,["modelValue"]),f(wk,{modelValue:D.value,"onUpdate:modelValue":t[12]||(t[12]=e=>D.value=e),title:"Exportar Códigos QR"},{footer:y(()=>[l("button",{class:"btn btn-secondary",onClick:t[11]||(t[11]=e=>D.value=!1)},"Cancelar"),l("button",{class:"btn btn-primary",onClick:Z},"Descargar")]),default:y(()=>[l("div",vC,[t[42]||(t[42]=l("p",null,"Selecciona el formato en el que deseas descargar los códigos QR.",-1)),l("div",bC,[t[41]||(t[41]=l("label",{for:"format-select"},"Formato:",-1)),E(l("select",{id:"format-select","onUpdate:modelValue":t[10]||(t[10]=e=>L.value=e),class:"form-control"},t[40]||(t[40]=[l("option",{value:"pdf"},"PDF",-1),l("option",{value:"png"},"PNG",-1),l("option",{value:"svg"},"SVG",-1),l("option",{value:"zip"},"ZIP (PNGs comprimidos)",-1)]),512),[[I,L.value]])])])]),_:1},8,["modelValue"]),f(wk,{modelValue:U.value,"onUpdate:modelValue":t[18]||(t[18]=e=>U.value=e),title:"Enviar Códigos QR por Email"},{footer:y(()=>[l("button",{class:"btn btn-secondary",onClick:t[17]||(t[17]=e=>U.value=!1)},"Cancelar"),l("button",{class:"btn btn-primary",onClick:ee},"Enviar")]),default:y(()=>[l("div",wC,[l("div",yC,[t[43]||(t[43]=l("label",{for:"recipients-input"},"Destinatarios (separa correos con coma):",-1)),E(l("input",{id:"recipients-input","onUpdate:modelValue":t[13]||(t[13]=e=>q.value=e),type:"text",class:"form-control",placeholder:"ej: correo@dominio.com, otro@dominio.com"},null,512),[[S,q.value]])]),l("div",_C,[t[44]||(t[44]=l("label",{for:"subject-input"},"Asunto:",-1)),E(l("input",{id:"subject-input","onUpdate:modelValue":t[14]||(t[14]=e=>$.value=e),type:"text",class:"form-control"},null,512),[[S,$.value]])]),l("div",kC,[t[45]||(t[45]=l("label",{for:"body-input"},"Mensaje:",-1)),E(l("textarea",{id:"body-input","onUpdate:modelValue":t[15]||(t[15]=e=>j.value=e),class:"form-control",rows:"3"},null,512),[[S,j.value]])]),l("div",CC,[t[47]||(t[47]=l("label",{for:"email-format-select"},"Formato:",-1)),E(l("select",{id:"email-format-select","onUpdate:modelValue":t[16]||(t[16]=e=>B.value=e),class:"form-control"},t[46]||(t[46]=[l("option",{value:"pdf"},"PDF",-1),l("option",{value:"png"},"PNG",-1)]),512),[[I,B.value]])])])]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-f41c6eb0"]]),SC={class:"stats-container"};const TC=tr({},[["render",function(e,t){return r(),o("div",SC,t[0]||(t[0]=[l("div",{class:"coming-soon-container"},[l("i",{class:"bi bi-bar-chart-line-fill icon"}),l("h1",null,"Estadísticas"),l("p",null,"Esta sección estará disponible próximamente."),l("p",null,"Estamos trabajando para ofrecerte los mejores análisis para tu negocio.")],-1)]))}],["__scopeId","data-v-29de642f"]]),NC=["type","disabled"],xC={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},IC={__name:"BaseButton",props:{variant:{type:String,default:"primary",validator:e=>["primary","secondary","outline-primary","outline-secondary","success","danger","warning","info","light","dark","link"].includes(e)},size:{type:String,default:"",validator:e=>["","sm","lg"].includes(e)},block:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},type:{type:String,default:"button"}},emits:["click"],setup(e,{emit:t}){const n=e,s=t,i=a(()=>{const e=["btn"];return e.push(`btn-${n.variant}`),n.size&&e.push(`btn-${n.size}`),n.block&&e.push("w-100"),n.loading&&e.push("position-relative"),e.join(" ")}),d=e=>{n.disabled||n.loading||s("click",e)};return(t,a)=>(r(),o("button",{type:e.type,class:u(i.value),disabled:e.disabled||e.loading,onClick:d},[e.loading?(r(),o("div",xC)):c("",!0),l("span",{class:u({"opacity-0":e.loading})},[R(t.$slots,"default",{},void 0)],2)],10,NC))}},AC=tr(IC,[["__scopeId","data-v-9b101dda"]]),PC={class:"request-card"},RC={class:"requester-info"},DC=["src","alt"],LC={class:"text-info"},MC={class:"name"},OC={class:"position"},FC={class:"actions"},UC={__name:"RequestCard",props:{request:{type:Object,required:!0},isArchived:{type:Boolean,default:!1}},emits:["confirm","archive","reject","unarchive"],setup:(e,{emit:t})=>(t,a)=>(r(),o("div",PC,[e.isArchived?c("",!0):(r(),o("button",{key:0,class:"close-button",onClick:a[0]||(a[0]=h(a=>t.$emit("reject",e.request),["stop"]))},a[5]||(a[5]=[l("i",{class:"bi bi-x"},null,-1)]))),l("div",RC,[l("img",{src:e.request.avatar,alt:`Avatar de ${e.request.name}`,class:"avatar"},null,8,DC),l("div",LC,[l("h4",MC,d(e.request.name),1),l("p",OC,d(e.request.position),1)])]),l("div",FC,[e.isArchived?(r(),o("button",{key:1,class:"btn btn-primary",onClick:a[4]||(a[4]=h(a=>t.$emit("unarchive",e.request),["stop"]))},a[9]||(a[9]=[l("i",{class:"bi bi-arrow-counterclockwise"},null,-1),v(" Desarchivar ")]))):(r(),o(p,{key:0},[l("button",{class:"btn btn-primary",onClick:a[1]||(a[1]=h(a=>t.$emit("confirm",e.request),["stop"]))},a[6]||(a[6]=[l("i",{class:"bi bi-check-lg"},null,-1),v(" Confirmar ")])),l("button",{class:"btn btn-secondary",onClick:a[2]||(a[2]=h(a=>t.$emit("archive",e.request),["stop"]))},a[7]||(a[7]=[l("i",{class:"bi bi-archive"},null,-1),v(" Archivar ")])),l("button",{class:"btn btn-danger",onClick:a[3]||(a[3]=h(a=>t.$emit("reject",e.request),["stop"]))},a[8]||(a[8]=[l("i",{class:"bi bi-x-lg"},null,-1),v(" Rechazar ")]))],64))])]))},BC=tr(UC,[["__scopeId","data-v-ecca35ff"]]),qC={class:"staff-avatar"},$C=["src","alt"],jC={class:"employee-name"},zC={class:"staff-info"},VC={class:"rating-container"},WC={class:"stars"},HC={class:"comments-count"},GC={__name:"StaffCard",props:{employee:{type:Object,required:!0}},emits:["view","remove"],setup(e,{emit:t}){const a=e,n=t,s=()=>{n("view",a.employee)},i=e=>{e.stopPropagation(),n("remove",a.employee)};return(t,a)=>(r(),o("div",{class:"staff-card",onClick:s},[l("button",{class:"remove-button",onClick:i},a[0]||(a[0]=[l("i",{class:"bi bi-x"},null,-1)])),l("div",qC,[l("img",{src:e.employee.avatar||"https://randomuser.me/api/portraits/men/32.jpg",alt:e.employee.name,class:"avatar-image"},null,8,$C)]),l("h3",jC,d(e.employee.name),1),l("div",zC,[l("div",VC,[l("div",WC,[(r(),o(p,null,m(5,t=>l("i",{key:t,class:u(["bi",t<=Math.round(e.employee.rating||0)?"bi-star-fill":"bi-star"])},null,2)),64))]),l("div",HC,[a[1]||(a[1]=l("i",{class:"bi bi-chat-left-text"},null,-1)),l("span",null,d(e.employee.reviewsCount||0)+" comentarios",1)])])])]))}},YC=tr(GC,[["__scopeId","data-v-b19334dd"]]),KC={class:"staff-card-skeleton"},QC={class:"avatar-skeleton"},JC={class:"info-skeleton"},ZC={__name:"StaffCardSkeleton",setup:e=>(e,t)=>(r(),o("div",KC,[l("div",QC,[f(Sk,{width:"64px",height:"64px",borderRadius:"50%"})]),l("div",JC,[f(Sk,{width:"60%",height:"1.2rem",borderRadius:"4px"}),f(Sk,{width:"40%",height:"1rem",borderRadius:"4px",style:{"margin-top":"8px"}})])]))},XC=tr(ZC,[["__scopeId","data-v-77a45dbe"]]),eE={class:"request-card-skeleton"},tE={class:"info-skeleton"},aE={class:"actions-skeleton"},nE={__name:"RequestCardSkeleton",setup:e=>(e,t)=>(r(),o("div",eE,[l("div",tE,[f(Sk,{width:"50%",height:"1.1rem",borderRadius:"4px"}),f(Sk,{width:"30%",height:"0.9rem",borderRadius:"4px",style:{"margin-top":"8px"}})]),l("div",aE,[f(Sk,{width:"40px",height:"40px",borderRadius:"50%"}),f(Sk,{width:"40px",height:"40px",borderRadius:"50%"})])]))},sE=tr(nE,[["__scopeId","data-v-8e0a7703"]]),iE={class:"staff-page"},oE={class:"page-header"},rE={key:0,class:"header-stats"},lE={class:"stat-item"},cE={class:"stat-value"},dE={class:"stat-item"},uE={class:"stat-value"},hE={key:0,class:"loading-container"},pE={key:1,class:"error-container"},mE={class:"error-message"},fE={key:2,class:"staff-content"},gE={class:"staff-section"},vE={class:"section-header"},bE={class:"section-title"},wE={key:0,class:"badge bg-primary rounded-pill"},yE={key:0,class:"section-actions"},_E={key:0,class:"requests-list"},kE={key:1},CE={key:0,class:"text-center p-4 text-muted"},EE={key:1,class:"requests-list"},SE={class:"staff-section"},TE={class:"section-header"},NE={key:0,class:"staff-grid"},xE={key:1,class:"staff-grid"},IE={key:0},AE={key:2,class:"pagination-container"},PE=["disabled"],RE=["disabled"],DE={class:"invite-form"},LE={class:"form-group"},ME={class:"form-group"},OE=["disabled"],FE={key:0},UE={key:1},BE=["disabled"],qE={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},$E={__name:"Staff",setup(e){const n=g(),i=tk(),u=t(!1),h=t(""),b=a(()=>i.staff),_=a(()=>i.staffRequests),k=a(()=>i.archivedRequests),C=t(!1),T=t(!1);t(!1),t(!1);const N=t(null);t(null);const x=t(""),A=t(""),P=t("waiter"),R=t(!1),D=a(()=>i.staffLinks),L=a(()=>i.staffMeta),M=a(()=>{if(!b.value.length)return[];let e=[...b.value];if(x.value){const t=x.value.toLowerCase();e=e.filter(e=>{var a,n,s;return(null==(a=e.name)?void 0:a.toLowerCase().includes(t))||(null==(n=e.email)?void 0:n.toLowerCase().includes(t))||(null==(s=e.position)?void 0:s.toLowerCase().includes(t))})}return e}),O=a(()=>R.value?k.value:_.value),F=a(()=>{if(!b.value.length)return{total:0,avgRating:0};const e=b.value.length;return{total:e,avgRating:(b.value.reduce((e,t)=>e+(t.rating||0),0)/e).toFixed(1)}});s(async()=>{u.value=!0,h.value="";try{await Promise.all([i.fetchStaff(),i.fetchStaffRequests(),i.fetchArchivedRequests()])}catch(e){h.value=e.message||"Error al cargar datos de personal"}finally{u.value=!1}});const U=async()=>{if(A.value&&P.value){u.value=!0,h.value="";try{await i.inviteStaff({email:A.value,role:P.value}),A.value="",P.value="waiter",C.value=!1}catch(e){h.value=e.message||"Error al enviar invitación"}finally{u.value=!1}}else h.value="Por favor, completa todos los campos"},B=async e=>{u.value=!0,h.value="";try{await i.handleStaffRequest(e.id,"confirm")}catch(t){h.value=t.message||"Error al confirmar solicitud"}finally{u.value=!1}},q=async e=>{u.value=!0,h.value="";try{await i.handleStaffRequest(e.id,"archive")}catch(t){h.value=t.message||"Error al archivar solicitud"}finally{u.value=!1}},$=async e=>{u.value=!0,h.value="";try{await i.handleStaffRequest(e.id,"unarchive")}catch(t){h.value=t.message||"Error al desarchivar solicitud"}finally{u.value=!1}},j=async e=>{u.value=!0,h.value="";try{await i.handleStaffRequest(e.id,"reject")}catch(t){h.value=t.message||"Error al rechazar solicitud"}finally{u.value=!1}},z=async()=>{if(_.value.length){u.value=!0,h.value="";try{for(const e of _.value)await i.handleStaffRequest(e.id,"confirm")}catch(e){h.value=e.message||"Error al confirmar todas las solicitudes"}finally{u.value=!1}}},V=async()=>{if(_.value.length){u.value=!0,h.value="";try{for(const e of _.value)await i.handleStaffRequest(e.id,"archive")}catch(e){h.value=e.message||"Error al archivar todas las solicitudes"}finally{u.value=!1}}},W=e=>{N.value=e,T.value=!0},H=async()=>{if(N.value){u.value=!0,h.value="";try{await i.removeStaff(N.value.id),T.value=!1,N.value=null}catch(e){h.value=e.message||"Error al eliminar miembro del personal"}finally{u.value=!1}}},G=()=>{R.value=!R.value},Y=e=>{n.push("/admin/staff/"+e.id)},K=()=>{C.value=!0},Q=async()=>{D.value.next&&(u.value=!0,await i.fetchStaff(D.value.next),u.value=!1)},J=async()=>{D.value.prev&&(u.value=!0,await i.fetchStaff(D.value.prev),u.value=!1)};return(e,t)=>(r(),o("div",iE,[l("div",oE,[t[11]||(t[11]=l("h1",{class:"page-title"},"Gestión de Personal",-1)),!u.value&&b.value.length>0?(r(),o("div",rE,[l("div",lE,[l("span",cE,d(F.value.total),1),t[8]||(t[8]=l("span",{class:"stat-label"},"Total",-1))]),l("div",dE,[l("span",uE,d(F.value.avgRating),1),t[9]||(t[9]=l("span",{class:"stat-label"},"Rating promedio",-1))])])):c("",!0),f(AC,{onClick:K,variant:"primary",icon:"fas fa-plus"},{default:y(()=>t[10]||(t[10]=[v(" Invitar Personal ")])),_:1,__:[10]})]),u.value?(r(),o("div",hE,t[12]||(t[12]=[l("div",{class:"spinner"},null,-1),l("p",null,"Cargando personal...",-1)]))):h.value?(r(),o("div",pE,[l("p",mE,d(h.value),1),f(AC,{onClick:t[0]||(t[0]=t=>e.$router.go(0)),variant:"primary"},{default:y(()=>t[13]||(t[13]=[v(" Reintentar ")])),_:1,__:[13]})])):(r(),o("div",fE,[l("section",gE,[l("div",vE,[l("div",null,[l("h2",bE,[v(d(R.value?"Solicitudes Archivadas":"Solicitudes Pendientes")+" ",1),!R.value&&_.value.length?(r(),o("span",wE,d(_.value.length),1)):c("",!0)])]),R.value?c("",!0):(r(),o("div",yE,[f(AC,{onClick:V,size:"sm",disabled:!_.value.length},{default:y(()=>t[14]||(t[14]=[v("Archivar Todo")])),_:1,__:[14]},8,["disabled"]),f(AC,{onClick:z,size:"sm",variant:"success",disabled:!_.value.length},{default:y(()=>t[15]||(t[15]=[v("Confirmar Todo")])),_:1,__:[15]},8,["disabled"])]))]),u.value?(r(),o("div",_E,[(r(),o(p,null,m(3,e=>f(sE,{key:e})),64))])):(r(),o("div",kE,[O.value.length?(r(),o("div",EE,[(r(!0),o(p,null,m(O.value,e=>(r(),w(BC,{key:e.id,request:e,"is-archived":R.value,onConfirm:B,onArchive:q,onUnarchive:$,onReject:j},null,8,["request","is-archived"]))),128))])):(r(),o("div",CE,t[16]||(t[16]=[l("p",null,"No hay solicitudes para mostrar.",-1)])))])),f(AC,{onClick:G,size:"sm",class:"mt-3"},{default:y(()=>[v(d(R.value?"Ver Pendientes":"Ver Archivadas"),1)]),_:1})]),l("section",SE,[l("div",TE,[t[17]||(t[17]=l("h2",{class:"section-title"},"Tu Personal",-1)),E(l("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>x.value=e),class:"search-input",placeholder:"Buscar personal..."},null,512),[[S,x.value]])]),u.value?(r(),o("div",NE,[(r(),o(p,null,m(4,e=>f(XC,{key:e})),64))])):(r(),o("div",xE,[M.value.length?c("",!0):(r(),o("p",IE,"No se encontró personal.")),(r(!0),o(p,null,m(M.value,e=>(r(),w(YC,{key:e.id,employee:e,onRemove:W,onView:Y},null,8,["employee"]))),128))])),L.value.last_page>1?(r(),o("div",AE,[l("button",{class:"pagination-button",disabled:!D.value.prev,onClick:J},"Anterior",8,PE),l("span",null,d(L.value.current_page)+" / "+d(L.value.last_page),1),l("button",{class:"pagination-button",disabled:!D.value.next,onClick:Q},"Siguiente",8,RE)])):c("",!0)])])),f(wk,{modelValue:C.value,"onUpdate:modelValue":t[5]||(t[5]=e=>C.value=e),title:"Invitar Personal",size:"md"},{footer:y(()=>[l("button",{class:"btn btn-secondary",onClick:t[4]||(t[4]=e=>C.value=!1)}," Cancelar "),l("button",{class:"btn btn-primary",onClick:U,disabled:!A.value||u.value},[u.value?(r(),o("span",FE,"Enviando...")):(r(),o("span",UE,"Enviar invitación"))],8,OE)]),default:y(()=>[l("div",DE,[l("div",LE,[t[18]||(t[18]=l("label",{for:"invite-email"},"Correo electrónico",-1)),E(l("input",{id:"invite-email",type:"email","onUpdate:modelValue":t[2]||(t[2]=e=>A.value=e),placeholder:"Ingresa el correo electrónico",class:"form-control"},null,512),[[S,A.value]])]),l("div",ME,[t[20]||(t[20]=l("label",{for:"invite-role"},"Cargo",-1)),E(l("select",{id:"invite-role","onUpdate:modelValue":t[3]||(t[3]=e=>P.value=e),class:"form-control"},t[19]||(t[19]=[l("option",{value:"waiter"},"Mozo",-1),l("option",{value:"kitchen"},"Cocinero",-1),l("option",{value:"cashier"},"Cajero",-1),l("option",{value:"manager"},"Gerente",-1),l("option",{value:"cleaning"},"Limpieza",-1)]),512),[[I,P.value]])])])]),_:1},8,["modelValue"]),f(wk,{modelValue:T.value,"onUpdate:modelValue":t[7]||(t[7]=e=>T.value=e),title:"Desvincular empleado",size:"sm"},{footer:y(()=>[l("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=e=>T.value=!1)}," Cancelar "),l("button",{class:"btn btn-danger",onClick:H,disabled:u.value},[u.value?(r(),o("span",qE)):c("",!0),t[21]||(t[21]=v(" Desvincular "))],8,BE)]),default:y(()=>{var e;return[l("p",null,"¿Estás seguro de que deseas desvincular a "+d(null==(e=N.value)?void 0:e.name)+"?",1),t[22]||(t[22]=l("p",{class:"warning-text"},"Esta acción no se puede deshacer.",-1))]}),_:1,__:[22]},8,["modelValue"])]))}},jE=tr($E,[["__scopeId","data-v-490bad46"]]),zE=["src","alt"],VE={key:0,class:"avatar-overlay"},WE={key:1,class:"avatar-loading"},HE={__name:"ProfileAvatar",props:{src:{type:String,default:""},alt:{type:String,default:"Foto de perfil"},editable:{type:Boolean,default:!1}},emits:["update:src","file-selected"],setup(e,{emit:a}){const n=e,s=a,i=t(n.src),d=t(!1),h=t(null);x(()=>n.src,e=>{i.value=e});const p=()=>{n.editable&&h.value&&h.value.click()},m=e=>{const t=e.target.files[0];if(!t)return;d.value=!0;const a=new FileReader;a.onload=e=>{i.value=e.target.result,s("update:src",i.value),s("file-selected",t),d.value=!1},a.readAsDataURL(t)};return(t,a)=>(r(),o("div",{class:u(["profile-avatar",{editable:e.editable}]),onClick:p},[l("img",{src:i.value,alt:e.alt,class:"avatar-image"},null,8,zE),e.editable?(r(),o("div",VE,a[0]||(a[0]=[l("i",{class:"bi bi-camera"},null,-1)]))):c("",!0),d.value?(r(),o("div",WE,a[1]||(a[1]=[l("div",{class:"spinner"},null,-1)]))):c("",!0),e.editable?(r(),o("input",{key:2,ref_key:"fileInput",ref:h,type:"file",accept:"image/*",class:"file-input",onChange:m},null,544)):c("",!0)],2))}},GE=tr(HE,[["__scopeId","data-v-b3232b9c"]]),YE={class:"review-card"},KE={class:"review-header"},QE={class:"reviewer-info"},JE=["src","alt"],ZE={class:"reviewer-name"},XE={class:"review-rating"},eS={class:"stars-container"},tS={class:"rating-value"},aS={class:"review-text"},nS={class:"review-footer"},sS={key:0,class:"review-date"},iS={__name:"ReviewCard",props:{review:{type:Object,required:!0},canDelete:{type:Boolean,default:!1}},emits:["delete"],setup(e,{emit:a}){const n=e,s=a,i=t(!1),h=()=>{i.value=!0},f=()=>{s("delete",n.review.id),i.value=!1},g=e=>{if(!e)return"";return new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})};return(t,a)=>{var n,s,v;return r(),o("div",YE,[l("div",KE,[l("div",QE,[l("img",{src:null==(n=e.review.reviewer)?void 0:n.avatar,alt:null==(s=e.review.reviewer)?void 0:s.name,class:"reviewer-avatar"},null,8,JE),l("h3",ZE,d(null==(v=e.review.reviewer)?void 0:v.name),1)]),l("div",XE,[l("div",eS,[(r(),o(p,null,m(5,t=>l("i",{key:t,class:u(["bi",t<=e.review.rating?"bi-star-fill":"bi-star"])},null,2)),64))]),l("span",tS,d(e.review.rating),1)]),e.canDelete?(r(),o("button",{key:0,class:"delete-button",onClick:h,"aria-label":"Eliminar reseña"},a[2]||(a[2]=[l("i",{class:"bi bi-trash"},null,-1)]))):c("",!0)]),l("p",aS,d(e.review.comment),1),l("div",nS,[e.review.date?(r(),o("span",sS,d(g(e.review.date)),1)):c("",!0)]),i.value?(r(),w(wk,{key:0,modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e),title:"Eliminar reseña",size:"sm"},{footer:y(()=>[l("button",{class:"btn btn-secondary",onClick:a[0]||(a[0]=e=>i.value=!1)}," Cancelar "),l("button",{class:"btn btn-danger",onClick:f}," Eliminar ")]),default:y(()=>[a[3]||(a[3]=l("p",null,"¿Estás seguro de que deseas eliminar esta reseña?",-1)),a[4]||(a[4]=l("p",{class:"warning-text"},"Esta acción no se puede deshacer.",-1))]),_:1,__:[3,4]},8,["modelValue"])):c("",!0)])}}},oS=tr(iS,[["__scopeId","data-v-99cedcd8"]]),rS={class:"base-input-wrapper"},lS={key:0,class:"base-input-label"},cS={key:0,class:"required-indicator"},dS=["type","value","placeholder","disabled","required","autocomplete","name"],uS={key:1,class:"base-input-error-message"},hS={__name:"BaseInput",props:{modelValue:{type:[String,Number],default:""},label:{type:String,default:""},placeholder:{type:String,default:""},type:{type:String,default:"text"},error:{type:String,default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},autocomplete:{type:String,default:"off"},name:{type:String,default:""}},emits:["update:modelValue","focus","blur"],setup(e,{emit:n}){const s=e,i=n,h=t(s.modelValue),p=t(!1);x(()=>s.modelValue,e=>{h.value=e});const m=e=>{const t=e.target.value;h.value=t,i("update:modelValue",t)},f=e=>{p.value=!0,i("focus",e)},g=e=>{p.value=!1,i("blur",e)},b=a(()=>["base-input",{"base-input-disabled":s.disabled},{"base-input-error":s.error},{"base-input-focused":p.value}]);return(t,a)=>(r(),o("div",rS,[e.label?(r(),o("label",lS,[v(d(e.label)+" ",1),e.required?(r(),o("span",cS,"*")):c("",!0)])):c("",!0),l("input",{type:e.type,value:h.value,placeholder:e.placeholder,disabled:e.disabled,required:e.required,autocomplete:e.autocomplete,name:e.name,class:u(b.value),onInput:m,onFocus:f,onBlur:g},null,42,dS),e.error?(r(),o("p",uS,d(e.error),1)):c("",!0)]))}},pS=tr(hS,[["__scopeId","data-v-da9b847d"]]),mS={class:"form-group"},fS={class:"form-group"},gS={__name:"SendNotificationModal",props:{modelValue:Boolean,loading:Boolean},emits:["update:modelValue","submit"],setup(e,{emit:n}){const s=n,i=t({title:"",body:""}),o=a(()=>""!==i.value.title.trim()&&""!==i.value.body.trim()),c=()=>{o.value&&s("submit",{...i.value})};return(t,a)=>(r(),w(wk,{"model-value":e.modelValue,title:"Enviar Notificación","onUpdate:modelValue":a[3]||(a[3]=e=>t.$emit("update:modelValue",e))},{body:y(()=>[l("form",{onSubmit:h(c,["prevent"]),class:"send-notification-form"},[l("div",mS,[a[4]||(a[4]=l("label",{for:"title"},"Título",-1)),f(pS,{id:"title",modelValue:i.value.title,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value.title=e),placeholder:"Ej: Recordatorio de reunión",required:""},null,8,["modelValue"])]),l("div",fS,[a[5]||(a[5]=l("label",{for:"body"},"Mensaje",-1)),E(l("textarea",{id:"body","onUpdate:modelValue":a[1]||(a[1]=e=>i.value.body=e),rows:"4",placeholder:"Escribe aquí el mensaje de la notificación...",required:"",class:"textarea-input"},null,512),[[S,i.value.body]])])],32)]),footer:y(()=>[f(AC,{onClick:a[2]||(a[2]=e=>t.$emit("update:modelValue",!1)),variant:"secondary"},{default:y(()=>a[6]||(a[6]=[v(" Cancelar ")])),_:1,__:[6]}),f(AC,{onClick:c,loading:e.loading,disabled:!o.value},{default:y(()=>a[7]||(a[7]=[v(" Enviar ")])),_:1,__:[7]},8,["loading","disabled"])]),_:1},8,["model-value"]))}},vS=tr(gS,[["__scopeId","data-v-a3aa051f"]]),bS={class:"staff-detail-container"},wS={key:0,class:"loading-container"},yS={key:1,class:"error-container"},_S={key:2,class:"staff-detail-content"},kS={class:"profile-card"},CS={class:"profile-header"},ES={class:"profile-name-container"},SS={class:"profile-data"},TS={class:"data-row"},NS={key:0,class:"text-muted",style:{"font-size":"0.875rem"}},xS={class:"data-row"},IS={class:"data-row"},AS={class:"data-row"},PS={class:"data-row"},RS={class:"data-row"},DS={class:"data-row"},LS={class:"data-row"},MS={class:"data-row"},OS={class:"data-row"},FS={class:"data-row"},US={class:"data-row"},BS={class:"data-row"},qS={class:"data-row"},$S={class:"data-row"},jS={class:"profile-actions"},zS={class:"reviews-section d-none"},VS={class:"reviews-header"},WS={class:"average-rating"},HS={class:"stars-container"},GS={class:"rating-text"},YS={class:"add-review-buttons"},KS={key:0,class:"empty-reviews"},QS={key:1,class:"reviews-list"},JS={class:"confirm-content"},ZS={class:"confirm-input"},XS=["disabled"],eT={class:"add-review-form"},tT={class:"rating-input"},aT={class:"star-rating"},nT=["onClick"],sT={class:"comment-input"},iT=["disabled"],oT={key:0},rT={key:1},lT=tr({__name:"StaffDetail",setup(e){const i=b(),h=g(),_=tk(),k=i.params.id,C=t(!1),T=t(""),N=t(null),x=t(!1),I=t(!1),A=t(""),P=t({rating:5,comment:""}),R=t(!1),D=t(!1),L=t(!1),M={experience:"experience_years",seniority:"seniority_years",schedule:"employment_type",currentSchedule:"current_schedule"};s(async()=>{C.value=!0,T.value="";try{const e=await _.fetchStaffMember(k);N.value=e}catch(e){T.value=e.message||"Error al cargar datos del empleado"}finally{C.value=!1}});const O=async()=>{if("ELIMINAR"===A.value){C.value=!0,T.value="";try{await _.removeStaff(k),h.push("/admin/staff")}catch(e){T.value=e.message||"Error al eliminar al miembro del personal"}finally{C.value=!1,x.value=!1}}},F=async(e,t)=>{if(!N.value)return;if("birth_date"===e){const e=new Date(t),a=new Date;let n=a.getFullYear()-e.getFullYear();const s=a.getMonth()-e.getMonth();if((s<0||0===s&&a.getDate()<e.getDate())&&n--,n<16)return void(T.value="El empleado debe ser mayor de 16 años")}R.value=!0;const a=M[e]||e;try{if(await _.updateStaffMember(k,{[a]:t}),N.value[a]=t,N.value[e]=t,"birth_date"===e){const e=new Date(t).toLocaleDateString("es-ES");N.value.birthdate_formatted=e}}catch(n){T.value=n.message||`Error al actualizar ${e}`}finally{R.value=!1}},U=async e=>{if(e)try{R.value=!0;const t=new FormData;t.append("avatar",e),await _.updateStaffMember(k,t,!0);const a=new FileReader;a.onload=e=>{N.value&&(N.value.avatar_url=e.target.result)},a.readAsDataURL(e)}catch(t){T.value=t.message||"Error al subir avatar"}finally{R.value=!1}},B=async e=>{if(N.value)try{R.value=!0,await _.deleteReview(k,e),N.value.reviews=N.value.reviews.filter(t=>t.id!==e)}catch(t){T.value=t.message||"Error al eliminar reseña"}finally{R.value=!1}},q=async()=>{if(N.value&&P.value.comment)try{R.value=!0;const e=await _.addReview(k,P.value);N.value.reviews.push(e),P.value={rating:5,comment:""},I.value=!1}catch(e){T.value=e.message||"Error al agregar reseña"}finally{R.value=!1}},$=()=>{if(N.value&&N.value.phone){const e=encodeURIComponent("Hola, te contacto desde la app MOZO.");window.open(`https://wa.me/${N.value.phone}?text=${e}`,"_blank")}else alert("Este empleado no tiene un número de teléfono registrado.")},j=()=>{h.push("/admin/staff")},z=[{value:"Masculino",label:"Masculino"},{value:"Femenino",label:"Femenino"},{value:"No binario",label:"No binario"},{value:"Prefiero no especificar",label:"Prefiero no especificar"}],V=[{value:"Gerente",label:"Gerente"},{value:"Mozo",label:"Mozo"},{value:"Cajero",label:"Cajero"},{value:"Cocinero",label:"Cocinero"},{value:"Limpieza",label:"Limpieza"}],W=[{value:"Tiempo completo",label:"Tiempo completo"},{value:"Medio tiempo",label:"Medio tiempo"},{value:"Por horas",label:"Por horas"},{value:"Fines de semana",label:"Fines de semana"}],H=()=>{I.value=!0},G=a(()=>{if(!N.value||!N.value.reviews.length)return 0;return(N.value.reviews.reduce((e,t)=>e+t.rating,0)/N.value.reviews.length).toFixed(1)}),Y=a(()=>N.value&&N.value.reviews.length?[...N.value.reviews].sort((e,t)=>new Date(t.date)-new Date(e.date)):[]),K=a(()=>{if(!N.value||!N.value.birth_date)return null;const e=new Date(N.value.birth_date),t=new Date;let a=t.getFullYear()-e.getFullYear();const n=t.getMonth()-e.getMonth();return(n<0||0===n&&t.getDate()<e.getDate())&&a--,a}),Q=async e=>{var t,a;L.value=!0;try{const t={user_id:N.value.user.id,title:e.title,body:e.body},a=await Ta.sendPushToUser(t);Qo(a.message||"Notificación enviada con éxito"),D.value=!1}catch(n){Jo((null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al enviar la notificación")}finally{L.value=!1}},J=()=>{x.value=!0};return(e,t)=>(r(),o("div",bS,[l("div",{class:"staff-header"},[l("button",{class:"back-button",onClick:j},t[26]||(t[26]=[l("i",{class:"bi bi-arrow-left"},null,-1),v(" Volver ")]))]),C.value?(r(),o("div",wS,t[27]||(t[27]=[l("div",{class:"loading-spinner"},null,-1),l("p",null,"Cargando datos del empleado...",-1)]))):T.value?(r(),o("div",yS,[l("p",null,d(T.value),1),f(AC,{onClick:t[0]||(t[0]=t=>e.$router.go(0)),variant:"primary"},{default:y(()=>t[28]||(t[28]=[v(" Reintentar ")])),_:1,__:[28]})])):N.value?(r(),o("div",_S,[l("div",kS,[l("div",CS,[f(GE,{src:N.value.avatar_url,alt:`Foto de ${N.value.name}`,editable:!0,onFileSelected:U},null,8,["src","alt"]),l("div",ES,[f(xy,{value:N.value.name,"onUpdate:value":t[1]||(t[1]=e=>F("name",e)),type:"text",placeholder:"Nombre completo",editable:!0,class:"profile-name"},null,8,["value"])])]),l("div",SS,[l("div",TS,[f(xy,{value:N.value.birth_date,"display-value":N.value.birthdate_formatted,label:"Fecha de nacimiento","onUpdate:value":t[2]||(t[2]=e=>F("birth_date",e)),type:"date",editable:!0},null,8,["value","display-value"]),K.value?(r(),o("div",NS,"Edad: "+d(K.value)+" años",1)):c("",!0)]),l("div",xS,[f(xy,{value:N.value.height,label:"Estatura","onUpdate:value":t[3]||(t[3]=e=>F("height",e)),type:"number",min:1,max:2.5,step:.01,unit:"mt",editable:!0},null,8,["value"])]),l("div",IS,[f(xy,{value:N.value.weight,label:"Peso","onUpdate:value":t[4]||(t[4]=e=>F("weight",e)),type:"number",min:30,max:200,unit:"kg",editable:!0},null,8,["value"])]),l("div",AS,[f(xy,{value:N.value.gender,label:"Sexo","onUpdate:value":t[5]||(t[5]=e=>F("gender",e)),type:"select",options:z,editable:!0},null,8,["value"])]),l("div",PS,[f(xy,{value:N.value.experience_years,label:"Años de experiencia","onUpdate:value":t[6]||(t[6]=e=>F("experience",e)),type:"number",min:0,max:50,unit:"años",editable:!0},null,8,["value"])]),l("div",RS,[f(xy,{value:N.value.seniority_years,label:"Antigüedad","onUpdate:value":t[7]||(t[7]=e=>F("seniority",e)),type:"number",min:0,max:50,unit:"años de antigüedad",editable:!0},null,8,["value"])]),l("div",DS,[f(xy,{value:N.value.email,label:"Email","onUpdate:value":t[8]||(t[8]=e=>F("email",e)),type:"text",editable:!0},null,8,["value"])]),l("div",LS,[f(xy,{value:N.value.phone,label:"Teléfono","onUpdate:value":t[9]||(t[9]=e=>F("phone",e)),type:"text",editable:!0},null,8,["value"])]),l("div",MS,[f(xy,{value:N.value.hire_date,label:"Fecha de contratación","onUpdate:value":t[10]||(t[10]=e=>F("hire_date",e)),type:"date",editable:!0},null,8,["value"])]),l("div",OS,[f(xy,{value:N.value.position,label:"Cargo","onUpdate:value":t[11]||(t[11]=e=>F("position",e)),type:"select",options:V,editable:!0},null,8,["value"])]),l("div",FS,[f(xy,{value:N.value.salary,label:"Salario","onUpdate:value":t[12]||(t[12]=e=>F("salary",e)),type:"number",min:0,step:.01,unit:"$",editable:!0},null,8,["value"])]),l("div",US,[f(xy,{value:N.value.notes,label:"Notas","onUpdate:value":t[13]||(t[13]=e=>F("notes",e)),type:"textarea",editable:!0},null,8,["value"])]),l("div",BS,[f(xy,{value:N.value.education,label:"Condición","onUpdate:value":t[14]||(t[14]=e=>F("education",e)),type:"text",editable:!0},null,8,["value"])]),l("div",qS,[f(xy,{value:N.value.employment_type,label:"Modalidad","onUpdate:value":t[15]||(t[15]=e=>F("schedule",e)),type:"select",options:W,editable:!0},null,8,["value"])]),l("div",$S,[f(xy,{value:N.value.current_schedule,label:"Horario actual","onUpdate:value":t[16]||(t[16]=e=>F("currentSchedule",e)),type:"text",editable:!0},null,8,["value"])])]),l("div",jS,[f(AC,{variant:"primary",onClick:t[17]||(t[17]=t=>e.$router.push(`/admin/staff/${n(k)}/history`)),class:"action-button d-none"},{default:y(()=>t[29]||(t[29]=[v(" Ver historial ")])),_:1,__:[29]}),f(AC,{variant:"secondary",onClick:e.sendMessage,class:"action-button"},{default:y(()=>t[30]||(t[30]=[v(" Mandar mensaje ")])),_:1,__:[30]},8,["onClick"]),f(AC,{variant:"info",onClick:t[18]||(t[18]=e=>D.value=!0),class:"action-button"},{default:y(()=>t[31]||(t[31]=[l("i",{class:"bi bi-paper-plane"},null,-1),v(" Enviar Notificación ")])),_:1,__:[31]}),f(AC,{variant:"danger",onClick:J,class:"action-button"},{default:y(()=>t[32]||(t[32]=[l("i",{class:"bi bi-trash"},null,-1),v(" Eliminar Empleado ")])),_:1,__:[32]})])]),l("div",zS,[l("div",VS,[t[35]||(t[35]=l("h2",{class:"section-title"},"Reseñas",-1)),l("div",WS,[l("div",HS,[(r(),o(p,null,m(5,e=>l("i",{key:e,class:u(["bi",e<=Math.round(N.value.rating)?"bi-star-fill":"bi-star"])},null,2)),64))]),l("span",GS,d(G.value),1)]),l("div",YS,[f(AC,{onClick:H,variant:"primary",class:"add-review-button"},{default:y(()=>t[33]||(t[33]=[l("i",{class:"bi bi-plus-lg"},null,-1),v(" Añadir reseña ")])),_:1,__:[33]}),f(AC,{onClick:$,variant:"secondary"},{default:y(()=>t[34]||(t[34]=[l("i",{class:"bi bi-whatsapp"},null,-1),v(" Contactar ")])),_:1,__:[34]})])]),Y.value.length?(r(),o("div",QS,[(r(!0),o(p,null,m(Y.value,e=>(r(),w(oS,{key:e.id,review:e,"can-delete":!0,onDelete:B},null,8,["review"]))),128))])):(r(),o("div",KS,t[36]||(t[36]=[l("p",null,"No hay reseñas todavía.",-1)])))])])):c("",!0),f(wk,{modelValue:x.value,"onUpdate:modelValue":t[21]||(t[21]=e=>x.value=e),title:"Eliminar empleado",size:"md"},{footer:y(()=>[l("button",{class:"btn btn-secondary",onClick:t[20]||(t[20]=e=>x.value=!1)}," Cancelar "),l("button",{class:"btn btn-danger",onClick:O,disabled:"ELIMINAR"!==A.value}," Eliminar ",8,XS)]),default:y(()=>{var e;return[l("div",JS,[l("p",null,"¿Estás seguro de que deseas eliminar a "+d(null==(e=N.value)?void 0:e.name)+" del personal?",1),t[38]||(t[38]=l("p",{class:"confirm-warning"},"Esta acción no se puede deshacer.",-1)),l("div",ZS,[t[37]||(t[37]=l("label",{for:"confirm-text"},'Escribe "ELIMINAR" para confirmar',-1)),E(l("input",{type:"text",id:"confirm-text","onUpdate:modelValue":t[19]||(t[19]=e=>A.value=e),class:"form-control"},null,512),[[S,A.value]])])])]}),_:1},8,["modelValue"]),f(wk,{modelValue:I.value,"onUpdate:modelValue":t[24]||(t[24]=e=>I.value=e),title:"Añadir nueva reseña",size:"md"},{footer:y(()=>[l("button",{class:"btn btn-secondary",onClick:t[23]||(t[23]=e=>I.value=!1)}," Cancelar "),l("button",{class:"btn btn-primary",onClick:q,disabled:!P.value.comment||R.value},[R.value?(r(),o("span",oT,"Guardando...")):(r(),o("span",rT,"Guardar reseña"))],8,iT)]),default:y(()=>[l("div",eT,[l("div",tT,[t[39]||(t[39]=l("label",null,"Calificación",-1)),l("div",aT,[(r(),o(p,null,m(5,e=>l("button",{key:e,type:"button",class:u(["star-button",{active:e<=P.value.rating}]),onClick:t=>P.value.rating=e},[l("i",{class:u(["bi",e<=P.value.rating?"bi-star-fill":"bi-star"])},null,2)],10,nT)),64))])]),l("div",sT,[t[40]||(t[40]=l("label",{for:"review-comment"},"Comentario",-1)),E(l("textarea",{id:"review-comment","onUpdate:modelValue":t[22]||(t[22]=e=>P.value.comment=e),rows:"4",placeholder:"Escribe tu comentario aquí...",class:"form-control"},null,512),[[S,P.value.comment]])])])]),_:1},8,["modelValue"]),f(vS,{modelValue:D.value,"onUpdate:modelValue":t[25]||(t[25]=e=>D.value=e),loading:L.value,onSubmit:Q},null,8,["modelValue","loading"])]))}},[["__scopeId","data-v-1a682f9c"]]),cT={class:"profile-container"},dT={key:0,class:"loading-container"},uT={key:1,class:"alert alert-danger"},hT={key:2,class:"alert alert-success"},pT={key:3,class:"profile-content"},mT={class:"profile-card"},fT={class:"profile-main"},gT={class:"profile-image-container"},vT=["src"],bT={class:"profile-info"},wT={class:"form-group"},yT=["disabled"],_T={class:"form-group"},kT=["disabled"],CT={class:"form-group"},ET=["disabled"],ST={class:"form-group"},TT=["disabled"],NT={class:"form-group"},xT={class:"form-group"},IT=["disabled"],AT={class:"form-group"},PT=["disabled"],RT={key:0,class:"form-text"},DT={class:"form-group"},LT=["disabled"],MT={key:0,class:"form-text"},OT={class:"profile-actions"},FT=["disabled"],UT={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},BT=["disabled"],qT={class:"confirm-content"},$T={class:"confirm-input"},jT=["disabled"],zT=["disabled"],VT=["disabled"],WT={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},HT=tr({__name:"Profile",setup(e){const n=g(),i=Ga(),u=t({name:"",email:"",phone:"",avatar:"",role:"admin",business:{name:"",code:""}}),p=t({current:"",new:"",confirm:""}),m=t(!0),b=t(!1),w=t(""),_=t(""),k=t(null),C=t(null),T=t(!1),N=t(""),x=t(!1),I=a(()=>!p.value.new||p.value.new.length>=8),A=a(()=>!p.value.new||!p.value.confirm||p.value.new===p.value.confirm),P=a(()=>!(!u.value.name||!u.value.email)&&(!(p.value.current||p.value.new||p.value.confirm)||p.value.current&&I.value&&A.value)),R=e=>{const t=e.target.files[0];if(!t)return;if(t.size>5242880)return void(w.value="La imagen no puede ser mayor a 5MB");C.value=t;const a=new FileReader;a.onload=e=>{k.value=e.target.result},a.readAsDataURL(t)},D=async()=>{var e,t;if(P.value){b.value=!0,w.value="",_.value="";try{const e=new FormData;e.append("name",u.value.name),e.append("email",u.value.email),e.append("phone",u.value.phone||""),C.value&&e.append("avatar",C.value),p.value.current&&p.value.new&&(e.append("current_password",p.value.current),e.append("password",p.value.new),e.append("password_confirmation",p.value.confirm)),console.log("Perfil actualizado:",{name:u.value.name,email:u.value.email,phone:u.value.phone,passwordChanged:!!p.value.current,avatarChanged:!!C.value});const t=i.getUser();t&&(t.name=u.value.name,t.email=u.value.email,t.phone=u.value.phone,k.value&&(t.avatar=k.value),i.setUser(t)),p.value.current="",p.value.new="",p.value.confirm="",C.value=null,_.value="Perfil actualizado correctamente"}catch(a){console.error("Error al actualizar perfil:",a),w.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"No se pudo actualizar el perfil. Por favor, inténtalo de nuevo."}finally{b.value=!1}}},L=async()=>{var e,t;if("ELIMINAR"===N.value){x.value=!0;try{console.log("Cuenta eliminada"),await i.logout(),n.push("/login")}catch(a){console.error("Error al eliminar cuenta:",a),w.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"No se pudo eliminar la cuenta. Por favor, inténtalo de nuevo.",T.value=!1,N.value="",x.value=!1}}},M=()=>{n.push("/admin")};return s(()=>{(async()=>{m.value=!0,w.value="";try{const e=i.getUser()||{id:"1",name:"Administrador",email:"admin@ejemplo.com",phone:"555-987-6543",avatar:"https://randomuser.me/api/portraits/men/42.jpg",role:"admin",business:{name:"Mi Restaurante",code:"FGT-464"}};u.value={...e}}catch(e){console.error("Error al cargar datos del usuario:",e),w.value="No se pudieron cargar tus datos. Por favor, inténtalo de nuevo."}finally{m.value=!1}})()}),(e,t)=>(r(),o("div",cT,[l("div",{class:"profile-header"},[l("button",{class:"back-button",onClick:M}," ← Volver ")]),m.value&&!u.value.name?(r(),o("div",dT,t[12]||(t[12]=[l("div",{class:"loading-spinner"},null,-1),l("p",null,"Cargando datos del perfil...",-1)]))):c("",!0),w.value?(r(),o("div",uT,d(w.value),1)):c("",!0),_.value?(r(),o("div",hT,d(_.value),1)):c("",!0),!m.value||u.value.name?(r(),o("div",pT,[l("div",mT,[l("div",fT,[l("div",gT,[l("img",{src:k.value||u.value.avatar||"/placeholder-avatar.png",alt:"Foto de perfil",class:"profile-image"},null,8,vT),t[13]||(t[13]=l("label",{for:"avatar-upload",class:"avatar-edit-btn"},[l("i",{class:"bi bi-camera"})],-1)),l("input",{type:"file",id:"avatar-upload",accept:"image/*",class:"visually-hidden",onChange:R},null,32)]),l("div",bT,[l("form",{onSubmit:h(D,["prevent"])},[l("div",wT,[t[14]||(t[14]=l("label",{for:"name"},"Nombre completo",-1)),E(l("input",{type:"text",id:"name","onUpdate:modelValue":t[0]||(t[0]=e=>u.value.name=e),class:"form-control",required:"",disabled:b.value},null,8,yT),[[S,u.value.name]])]),l("div",_T,[t[15]||(t[15]=l("label",{for:"email"},"Correo electrónico",-1)),E(l("input",{type:"email",id:"email","onUpdate:modelValue":t[1]||(t[1]=e=>u.value.email=e),class:"form-control",required:"",disabled:b.value},null,8,kT),[[S,u.value.email]])]),l("div",CT,[t[16]||(t[16]=l("label",{for:"phone"},"Teléfono",-1)),E(l("input",{type:"tel",id:"phone","onUpdate:modelValue":t[2]||(t[2]=e=>u.value.phone=e),class:"form-control",disabled:b.value},null,8,ET),[[S,u.value.phone]])]),l("div",ST,[t[17]||(t[17]=l("label",{for:"business-name"},"Nombre del negocio",-1)),E(l("input",{type:"text",id:"business-name","onUpdate:modelValue":t[3]||(t[3]=e=>u.value.business.name=e),class:"form-control",disabled:b.value},null,8,TT),[[S,u.value.business.name]])]),l("div",NT,[t[18]||(t[18]=l("label",{for:"business-code"},"Código del negocio",-1)),E(l("input",{type:"text",id:"business-code","onUpdate:modelValue":t[4]||(t[4]=e=>u.value.business.code=e),class:"form-control",disabled:""},null,512),[[S,u.value.business.code]])]),t[23]||(t[23]=l("div",{class:"profile-divider"},[l("h3",null,"Cambiar contraseña")],-1)),l("div",xT,[t[19]||(t[19]=l("label",{for:"current-password"},"Contraseña actual",-1)),E(l("input",{type:"password",id:"current-password","onUpdate:modelValue":t[5]||(t[5]=e=>p.value.current=e),class:"form-control",disabled:b.value},null,8,IT),[[S,p.value.current]])]),l("div",AT,[t[20]||(t[20]=l("label",{for:"new-password"},"Nueva contraseña",-1)),E(l("input",{type:"password",id:"new-password","onUpdate:modelValue":t[6]||(t[6]=e=>p.value.new=e),class:"form-control",disabled:b.value},null,8,PT),[[S,p.value.new]]),p.value.new&&!I.value?(r(),o("div",RT," La contraseña debe tener al menos 8 caracteres ")):c("",!0)]),l("div",DT,[t[21]||(t[21]=l("label",{for:"confirm-password"},"Confirmar nueva contraseña",-1)),E(l("input",{type:"password",id:"confirm-password","onUpdate:modelValue":t[7]||(t[7]=e=>p.value.confirm=e),class:"form-control",disabled:b.value},null,8,LT),[[S,p.value.confirm]]),p.value.confirm&&!A.value?(r(),o("div",MT," Las contraseñas no coinciden ")):c("",!0)]),l("div",OT,[l("button",{type:"submit",class:"btn btn-primary",disabled:b.value||!P.value},[b.value?(r(),o("span",UT)):c("",!0),t[22]||(t[22]=v(" Guardar cambios "))],8,FT),l("button",{type:"button",class:"btn btn-danger",onClick:t[8]||(t[8]=e=>T.value=!0),disabled:b.value}," Eliminar cuenta ",8,BT)])],32)])])])])):c("",!0),f(wk,{modelValue:T.value,"onUpdate:modelValue":t[11]||(t[11]=e=>T.value=e),title:"Eliminar cuenta",size:"md"},{footer:y(()=>[l("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=e=>T.value=!1),disabled:x.value}," Cancelar ",8,zT),l("button",{type:"button",class:"btn btn-danger",onClick:L,disabled:"ELIMINAR"!==N.value||x.value},[x.value?(r(),o("span",WT)):c("",!0),t[27]||(t[27]=v(" Eliminar mi cuenta "))],8,VT)]),default:y(()=>[l("div",qT,[t[25]||(t[25]=l("p",null,"¿Estás seguro de que deseas eliminar tu cuenta? Esta acción no se puede deshacer.",-1)),t[26]||(t[26]=l("div",{class:"alert alert-danger"},[l("i",{class:"bi bi-exclamation-triangle-fill me-2"}),v(" Al eliminar tu cuenta perderás todo el acceso a tus datos y negocios asociados. ")],-1)),l("div",$T,[t[24]||(t[24]=l("label",{for:"confirm-delete"},'Escribe "ELIMINAR" para confirmar',-1)),E(l("input",{type:"text",class:"form-control",id:"confirm-delete","onUpdate:modelValue":t[9]||(t[9]=e=>N.value=e),disabled:x.value},null,8,jT),[[S,N.value]])])])]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-7f2d5965"]]),GT={class:"settings-container"},YT={key:0,class:"loading-container"},KT={key:1,class:"error-container"},QT={key:2,class:"settings-content"},JT={key:0,class:"success-message"},ZT={class:"settings-section"},XT={class:"form-group"},eN={class:"form-group"},tN={class:"form-row"},aN={class:"form-group"},nN={class:"form-group"},sN={class:"form-group"},iN={class:"form-actions"},oN={class:"settings-section"},rN={class:"section-header"},lN={key:0,class:"empty-tables"},cN={key:1,class:"tables-list"},dN={class:"table-info"},uN={class:"table-number"},hN={class:"table-details"},pN={class:"table-name"},mN={class:"table-capacity"},fN={class:"table-actions"},gN=["onClick"],vN=["onClick"],bN={class:"settings-section danger-zone"},wN={class:"form-row"},yN={class:"form-group"},_N={class:"form-group"},kN={class:"form-group"},CN={class:"form-row"},EN={class:"form-group"},SN={class:"form-group"},TN={class:"form-group"},NN={class:"confirm-content"},xN=tr({__name:"Settings",setup(e){const a=g(),n=tk(),i=Ga(),u=t(!1),b=t(""),_=t(""),k=t(null),C=t([]),T=t(!1),x=t(!1),I=t(!1),A=t(null),P=N({number:"",name:"",capacity:4});s(async()=>{u.value=!0,b.value="";try{const[e,t]=await Promise.all([n.fetchBusinessData(),n.fetchTables()]);k.value=e||{},C.value=t||[]}catch(e){b.value=e.message||"Error al cargar datos"}finally{u.value=!1}});const R=async()=>{if(k.value){u.value=!0,b.value="",_.value="";try{await n.updateBusinessData(k.value),_.value="Configuración guardada con éxito"}catch(e){b.value=e.message||"Error al guardar configuración"}finally{u.value=!1}}},D=async()=>{if(P.number&&P.capacity){u.value=!0,b.value="";try{const e=await n.createTable(P);e&&(C.value.push(e),P.number="",P.name="",P.capacity=4,T.value=!1)}catch(e){b.value=e.message||"Error al crear mesa"}finally{u.value=!1}}else b.value="Por favor, completa todos los campos requeridos"},L=async()=>{if(A.value){u.value=!0,b.value="";try{await n.updateTable(A.value),C.value=C.value.map(e=>e.id===A.value.id?A.value:e),x.value=!1,A.value=null}catch(e){b.value=e.message||"Error al actualizar mesa"}finally{u.value=!1}}},M=async()=>{if(A.value){u.value=!0,b.value="";try{await n.deleteTable(A.value.id),C.value=C.value.filter(e=>e.id!==A.value.id),I.value=!1,A.value=null}catch(e){b.value=e.message||"Error al eliminar mesa"}finally{u.value=!1}}},O=()=>{a.push({name:"admin-home"})},F=async()=>{await i.logout(),a.push("/login")};return(e,t)=>(r(),o("div",GT,[l("div",{class:"settings-header"},[l("button",{class:"back-button",onClick:O}," ← Volver "),t[19]||(t[19]=l("h1",null,"Configuración",-1))]),u.value?(r(),o("div",YT,t[20]||(t[20]=[l("div",{class:"loading-spinner"},null,-1),l("p",null,"Cargando configuración...",-1)]))):b.value?(r(),o("div",KT,[l("p",null,d(b.value),1),f(AC,{onClick:t[0]||(t[0]=t=>e.$router.go(0)),variant:"primary"},{default:y(()=>t[21]||(t[21]=[v(" Reintentar ")])),_:1,__:[21]})])):k.value?(r(),o("div",QT,[_.value?(r(),o("div",JT,d(_.value),1)):c("",!0),l("div",ZT,[t[28]||(t[28]=l("h2",null,"Información del negocio",-1)),l("form",{onSubmit:h(R,["prevent"]),class:"business-form"},[l("div",XT,[t[22]||(t[22]=l("label",{for:"business-name"},"Nombre del restaurante",-1)),E(l("input",{id:"business-name",type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>k.value.name=e),required:""},null,512),[[S,k.value.name]])]),l("div",eN,[t[23]||(t[23]=l("label",{for:"business-address"},"Dirección",-1)),E(l("input",{id:"business-address",type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>k.value.address=e)},null,512),[[S,k.value.address]])]),l("div",tN,[l("div",aN,[t[24]||(t[24]=l("label",{for:"business-phone"},"Teléfono",-1)),E(l("input",{id:"business-phone",type:"tel","onUpdate:modelValue":t[3]||(t[3]=e=>k.value.phone=e)},null,512),[[S,k.value.phone]])]),l("div",nN,[t[25]||(t[25]=l("label",{for:"business-email"},"Email",-1)),E(l("input",{id:"business-email",type:"email","onUpdate:modelValue":t[4]||(t[4]=e=>k.value.email=e)},null,512),[[S,k.value.email]])])]),l("div",sN,[t[26]||(t[26]=l("label",{for:"business-description"},"Descripción",-1)),E(l("textarea",{id:"business-description","onUpdate:modelValue":t[5]||(t[5]=e=>k.value.description=e),rows:"3"},null,512),[[S,k.value.description]])]),l("div",iN,[f(AC,{type:"submit",variant:"primary",loading:u.value},{default:y(()=>t[27]||(t[27]=[v(" Guardar cambios ")])),_:1,__:[27]},8,["loading"])])],32)]),l("div",oN,[l("div",rN,[t[30]||(t[30]=l("h2",null,"Mesas",-1)),f(AC,{onClick:t[6]||(t[6]=e=>T.value=!0),variant:"primary"},{default:y(()=>t[29]||(t[29]=[v(" Añadir mesa ")])),_:1,__:[29]})]),0===C.value.length?(r(),o("div",lN,t[31]||(t[31]=[l("p",null,"No hay mesas configuradas",-1),l("p",null,"Añade mesas para que los clientes puedan hacer pedidos",-1)]))):(r(),o("div",cN,[(r(!0),o(p,null,m(C.value,e=>(r(),o("div",{key:e.id,class:"table-card"},[l("div",dN,[l("div",uN,d(e.number),1),l("div",hN,[l("span",pN,d(e.name||`Mesa ${e.number}`),1),l("span",mN,d(e.capacity)+" personas",1)])]),l("div",fN,[l("button",{onClick:t=>(e=>{A.value={...e},x.value=!0})(e),class:"edit-button"}," Editar ",8,gN),l("button",{onClick:t=>(e=>{A.value=e,I.value=!0})(e),class:"delete-button"}," Eliminar ",8,vN)])]))),128))]))]),l("div",bN,[t[33]||(t[33]=l("h2",null,"Cerrar Sesión",-1)),t[34]||(t[34]=l("p",null,"Finaliza tu sesión actual de forma segura.",-1)),f(AC,{onClick:F,variant:"danger-outline"},{default:y(()=>t[32]||(t[32]=[v(" Cerrar sesión ")])),_:1,__:[32]})])])):c("",!0),f(wk,{modelValue:T.value,"onUpdate:modelValue":t[11]||(t[11]=e=>T.value=e),title:"Añadir nueva mesa",size:"md"},{footer:y(()=>[f(AC,{onClick:t[10]||(t[10]=e=>T.value=!1),variant:"outline"},{default:y(()=>t[38]||(t[38]=[v(" Cancelar ")])),_:1,__:[38]}),f(AC,{onClick:D,variant:"primary",loading:u.value},{default:y(()=>t[39]||(t[39]=[v(" Añadir ")])),_:1,__:[39]},8,["loading"])]),default:y(()=>[l("form",{onSubmit:h(D,["prevent"]),class:"table-form"},[l("div",wN,[l("div",yN,[t[35]||(t[35]=l("label",{for:"table-number"},"Número*",-1)),E(l("input",{id:"table-number",type:"number","onUpdate:modelValue":t[7]||(t[7]=e=>P.number=e),min:"1",required:""},null,512),[[S,P.number]])]),l("div",_N,[t[36]||(t[36]=l("label",{for:"table-capacity"},"Capacidad*",-1)),E(l("input",{id:"table-capacity",type:"number","onUpdate:modelValue":t[8]||(t[8]=e=>P.capacity=e),min:"1",required:""},null,512),[[S,P.capacity]])])]),l("div",kN,[t[37]||(t[37]=l("label",{for:"table-name"},"Nombre (opcional)",-1)),E(l("input",{id:"table-name",type:"text","onUpdate:modelValue":t[9]||(t[9]=e=>P.name=e),placeholder:"Ej: Terraza 1"},null,512),[[S,P.name]])])],32)]),_:1},8,["modelValue"]),A.value?(r(),w(wk,{key:3,modelValue:x.value,"onUpdate:modelValue":t[16]||(t[16]=e=>x.value=e),title:"Editar mesa",size:"md"},{footer:y(()=>[f(AC,{onClick:t[15]||(t[15]=e=>x.value=!1),variant:"outline"},{default:y(()=>t[43]||(t[43]=[v(" Cancelar ")])),_:1,__:[43]}),f(AC,{onClick:L,variant:"primary",loading:u.value},{default:y(()=>t[44]||(t[44]=[v(" Guardar ")])),_:1,__:[44]},8,["loading"])]),default:y(()=>[l("form",{onSubmit:h(L,["prevent"]),class:"table-form"},[l("div",CN,[l("div",EN,[t[40]||(t[40]=l("label",{for:"edit-table-number"},"Número*",-1)),E(l("input",{id:"edit-table-number",type:"number","onUpdate:modelValue":t[12]||(t[12]=e=>A.value.number=e),min:"1",required:""},null,512),[[S,A.value.number]])]),l("div",SN,[t[41]||(t[41]=l("label",{for:"edit-table-capacity"},"Capacidad*",-1)),E(l("input",{id:"edit-table-capacity",type:"number","onUpdate:modelValue":t[13]||(t[13]=e=>A.value.capacity=e),min:"1",required:""},null,512),[[S,A.value.capacity]])])]),l("div",TN,[t[42]||(t[42]=l("label",{for:"edit-table-name"},"Nombre (opcional)",-1)),E(l("input",{id:"edit-table-name",type:"text","onUpdate:modelValue":t[14]||(t[14]=e=>A.value.name=e),placeholder:"Ej: Terraza 1"},null,512),[[S,A.value.name]])])],32)]),_:1},8,["modelValue"])):c("",!0),A.value?(r(),w(wk,{key:4,modelValue:I.value,"onUpdate:modelValue":t[18]||(t[18]=e=>I.value=e),title:"Eliminar mesa",size:"sm"},{footer:y(()=>[f(AC,{onClick:t[17]||(t[17]=e=>I.value=!1),variant:"outline"},{default:y(()=>t[46]||(t[46]=[v(" Cancelar ")])),_:1,__:[46]}),f(AC,{onClick:M,variant:"danger",loading:u.value},{default:y(()=>t[47]||(t[47]=[v(" Eliminar ")])),_:1,__:[47]},8,["loading"])]),default:y(()=>[l("div",NN,[l("p",null,"¿Estás seguro de que deseas eliminar la mesa "+d(A.value.number)+"?",1),t[45]||(t[45]=l("p",{class:"confirm-warning"},"Esta acción no se puede deshacer.",-1))])]),_:1},8,["modelValue"])):c("",!0)]))}},[["__scopeId","data-v-6566ffad"]]),IN={class:"debug-panel"},AN={class:"debug-section"},PN={class:"status-grid"},RN={class:"status-icon"},DN={class:"status-icon"},LN={class:"status-icon"},MN={class:"status-item"},ON={class:"debug-section"},FN={class:"button-grid"},UN=["disabled"],BN=["disabled"],qN=["disabled"],$N=["disabled"],jN={class:"debug-section"},zN={class:"test-form"},VN={class:"form-row"},WN={class:"form-row"},HN={class:"form-row"},GN=["disabled"],YN={class:"debug-section"},KN={class:"token-actions"},QN=["disabled"],JN={key:0,class:"debug-section"},ZN={class:"debug-logs"},XN={class:"log-time"},ex={class:"log-message"},tx={class:"debug-section"},ax={class:"tech-info"},nx={class:"info-item"},sx={class:"info-item"},ix={class:"info-item"},ox={class:"info-item"},rx={__name:"NotificationDebugPanel",setup(e){const i=Ga(),h=Xo(),f=t(!1),g=t([]),b=t(null),w=t({title:"🧪 Notificación de Prueba",body:"Esta es una notificación de prueba desde el panel de debug",type:"all"}),y=a(()=>i.isAuthenticated),_=t(!1),k=a(()=>!!b.value),C=N({browser:"",pushSupport:!1,serviceWorkerSupport:!1,firebaseProject:""});function T(e,t="info"){g.value.push({id:Date.now()+Math.random(),timestamp:new Date,message:e,type:t}),console.log(`[NotificationDebug] ${e}`)}function x(){g.value=[],T("🧹 Log limpiado","info")}function A(){const e=g.value.map(e=>`[${e.timestamp.toLocaleString()}] ${e.type.toUpperCase()}: ${e.message}`).join("\n"),t=new Blob([e],{type:"text/plain"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=`notification-debug-${(new Date).toISOString().slice(0,10)}.log`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a),T("💾 Log descargado","success")}async function P(){if(!f.value){f.value=!0,T("🔔 Solicitando permisos de notificación...","info");try{if(!("Notification"in window))throw new Error("Este navegador no soporta notificaciones push");const e=await Notification.requestPermission();T(`📋 Resultado de permisos: ${e}`,"info"),"granted"===e?(systemStatus.permissions=!0,T("✅ Permisos concedidos","success"),Qo("Permisos de notificación concedidos"),await R()):(systemStatus.permissions=!1,T("❌ Permisos denegados","error"),Jo("Permisos de notificación denegados"))}catch(e){T(`❌ Error pidiendo permisos: ${e.message}`,"error"),Jo(`Error: ${e.message}`)}finally{f.value=!1}}}async function R(){if(!f.value){f.value=!0,T("🚀 Inicializando Firebase Cloud Messaging...","info");try{if(!i.isAuthenticated)throw new Error("Usuario no autenticado");await Ra();const e=await Da();if(!e)throw new Error("No se pudo obtener el token FCM");b.value=e,T(`🔑 Token FCM obtenido: ${e.substring(0,20)}...`,"success"),T("🔥 Listener de mensajes en primer plano configurado","success"),await D()}catch(e){T(`❌ Error inicializando FCM: ${e.message}`,"error"),Jo(`Error inicializando FCM: ${e.message}`)}finally{f.value=!1}}}async function D(){if(f.value)return;const e=b.value||localStorage.getItem("fcm_token");if(e){f.value=!0,T("📤 Enviando token al servidor...","info");try{await Na.storeDeviceToken(e,"web",i.user.id);T("✅ Token enviado al servidor exitosamente","success"),Qo("Token FCM registrado en el servidor")}catch(t){T(`❌ Error enviando token: ${t.message}`,"error"),Jo(`Error enviando token: ${t.message}`)}finally{f.value=!1}}else T("❌ No hay token FCM para enviar","error")}async function L(){if(!f.value){f.value=!0,T("📥 Cargando notificaciones...","info");try{await h.loadNotifications(),T(`📬 ${h.totalUnreadCount} notificaciones no leídas cargadas`,"success"),Qo("Notificaciones cargadas")}catch(e){T(`❌ Error cargando notificaciones: ${e.message}`,"error"),Jo(`Error cargando notificaciones: ${e.message}`)}finally{f.value=!1}}}async function M(){if(f.value)return;if(!w.value.title.trim()||!w.value.body.trim())return void Jo("Título y mensaje son requeridos");f.value=!0;const{title:e,body:t,type:a}=w.value;T(`📨 Enviando notificación tipo: ${a}`,"info");try{let n;switch(a){case"all":n=await Na.sendNotificationToAll(e,t),T("✅ Notificación enviada a todos los usuarios","success");break;case"user":n=await Na.sendNotificationToUser(i.user.id,e,t),T("✅ Notificación enviada solo para ti","success");break;case"device":const a=b.value||localStorage.getItem("fcm_token");if(!a)throw new Error("No hay token FCM disponible");n=await Na.sendNotificationToDevice(a,e,t),T("✅ Notificación enviada a tu dispositivo","success");break;default:throw new Error("Tipo de notificación no válido")}Qo("Notificación enviada exitosamente"),T(`📝 Respuesta: ${JSON.stringify(n)}`,"info")}catch(n){T(`❌ Error enviando notificación: ${n.message}`,"error"),Jo(`Error enviando notificación: ${n.message}`)}finally{f.value=!1}}function O(){const e=b.value||localStorage.getItem("fcm_token");e?(T("🔑 Token FCM actual:","info"),T(e,"info"),Qo("Token mostrado en el log")):(T("❌ No hay token FCM disponible","error"),Jo("No hay token FCM disponible"))}async function F(){const e=b.value||localStorage.getItem("fcm_token");if(e)try{await navigator.clipboard.writeText(e),T("📋 Token copiado al portapapeles","success"),Qo("Token copiado al portapapeles")}catch(t){T("❌ Error copiando token","error"),Jo("Error copiando token")}else Jo("No hay token para copiar")}async function U(){if(f.value)return;if(b.value||localStorage.getItem("fcm_token")){f.value=!0,T("🗑️ Eliminando token...","info");try{b.value=null,localStorage.removeItem("fcm_token"),T("✅ Token eliminado","success"),Qo("Token eliminado")}catch(e){T(`❌ Error eliminando token: ${e.message}`,"error"),Jo(`Error eliminando token: ${e.message}`)}finally{f.value=!1}}else Jo("No hay token para eliminar")}return s(()=>{T("🔧 Panel de debug cargado","info"),C.browser=navigator.userAgent.split("(")[0].trim(),C.pushSupport="Notification"in window,C.serviceWorkerSupport="serviceWorker"in navigator,C.firebaseProject="mozoqr-7d32c","Notification"in window&&(_.value="granted"===Notification.permission,T(`📋 Permisos actuales: ${Notification.permission}`,"info"));const e=localStorage.getItem("fcm_token");e&&(b.value=e,T(`🔑 Token FCM encontrado: ${e.substring(0,20)}...`,"info")),T("👤 Usuario autenticado: "+(i.isAuthenticated?"Sí":"No"),"info"),i.user&&T(`👤 ID: ${i.user.id} | Email: ${i.user.email}`,"info")}),(e,t)=>(r(),o("div",IN,[t[21]||(t[21]=l("div",{class:"debug-header"},[l("h3",null,"🧪 Debug de Notificaciones FCM"),l("p",{class:"debug-subtitle"},"Panel para probar y debuggear notificaciones push")],-1)),l("div",AN,[t[7]||(t[7]=l("h4",null,"📊 Estado del Sistema",-1)),l("div",PN,[l("div",{class:u(["status-item",{active:y.value}])},[l("span",RN,d(y.value?"✅":"❌"),1),t[3]||(t[3]=l("span",null,"Usuario Autenticado",-1))],2),l("div",{class:u(["status-item",{active:_.value}])},[l("span",DN,d(_.value?"✅":"❌"),1),t[4]||(t[4]=l("span",null,"Permisos Push",-1))],2),l("div",{class:u(["status-item",{active:k.value}])},[l("span",LN,d(k.value?"✅":"❌"),1),t[5]||(t[5]=l("span",null,"Token FCM",-1))],2),l("div",MN,[t[6]||(t[6]=l("span",{class:"status-icon"},"🔔",-1)),l("span",null,d(n(h).totalUnreadCount)+" no leídas",1)])])]),l("div",ON,[t[8]||(t[8]=l("h4",null,"⚡ Acciones Rápidas",-1)),l("div",FN,[l("button",{onClick:P,disabled:f.value,class:"debug-btn primary"},d(f.value?"Procesando...":"🔔 Pedir Permisos"),9,UN),l("button",{onClick:R,disabled:f.value,class:"debug-btn secondary"}," 🚀 Inicializar FCM ",8,BN),l("button",{onClick:D,disabled:f.value,class:"debug-btn secondary"}," 📤 Enviar Token al Servidor ",8,qN),l("button",{onClick:L,disabled:f.value,class:"debug-btn info"}," 📥 Cargar Notificaciones ",8,$N)])]),l("div",jN,[t[13]||(t[13]=l("h4",null,"📤 Enviar Notificaciones de Prueba",-1)),l("div",zN,[l("div",VN,[t[9]||(t[9]=l("label",null,"Título:",-1)),E(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>w.value.title=e),placeholder:"Título de la notificación"},null,512),[[S,w.value.title]])]),l("div",WN,[t[10]||(t[10]=l("label",null,"Mensaje:",-1)),E(l("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>w.value.body=e),placeholder:"Cuerpo del mensaje",rows:"2"},null,512),[[S,w.value.body]])]),l("div",HN,[t[12]||(t[12]=l("label",null,"Tipo:",-1)),E(l("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>w.value.type=e)},t[11]||(t[11]=[l("option",{value:"all"},"🌐 Enviar a Todos",-1),l("option",{value:"user"},"👤 Enviar Solo a Mí",-1),l("option",{value:"device"},"📱 Enviar a Mi Device",-1)]),512),[[I,w.value.type]])]),l("button",{onClick:M,disabled:f.value,class:"debug-btn primary full-width"},d(f.value?"Enviando...":"📨 Enviar Notificación"),9,GN)])]),l("div",YN,[t[14]||(t[14]=l("h4",null,"🔑 Gestión de Device Tokens",-1)),l("div",KN,[l("button",{onClick:O,class:"debug-btn secondary"}," 👀 Ver Token Actual "),l("button",{onClick:F,class:"debug-btn secondary"}," 📋 Copiar Token "),l("button",{onClick:U,disabled:f.value,class:"debug-btn danger"}," 🗑️ Eliminar Token ",8,QN)])]),g.value.length>0?(r(),o("div",JN,[t[15]||(t[15]=l("h4",null,"📝 Log de Eventos",-1)),l("div",ZN,[(r(!0),o(p,null,m(g.value.slice(-10),e=>{return r(),o("div",{key:e.id,class:u(["log-item",e.type])},[l("span",XN,d((t=e.timestamp,t.toLocaleTimeString())),1),l("span",ex,d(e.message),1)],2);var t}),128))]),l("div",{class:"log-actions"},[l("button",{onClick:x,class:"debug-btn small"},"Limpiar Log"),l("button",{onClick:A,class:"debug-btn small"},"💾 Descargar Log")])])):c("",!0),l("div",tx,[t[20]||(t[20]=l("h4",null,"🔧 Información Técnica",-1)),l("div",ax,[l("div",nx,[t[16]||(t[16]=l("strong",null,"Navegador:",-1)),v(" "+d(C.browser),1)]),l("div",sx,[t[17]||(t[17]=l("strong",null,"Soporte Push:",-1)),v(" "+d(C.pushSupport?"Sí":"No"),1)]),l("div",ix,[t[18]||(t[18]=l("strong",null,"Service Worker:",-1)),v(" "+d(C.serviceWorkerSupport?"Sí":"No"),1)]),l("div",ox,[t[19]||(t[19]=l("strong",null,"Firebase Project:",-1)),v(" "+d(C.firebaseProject),1)])])])]))}},lx=tr(rx,[["__scopeId","data-v-03f702b6"]]),cx={class:"notification-debug"},dx={key:0,class:"current-notifications"},ux={class:"notifications-list"},hx={class:"notification-header"},px={class:"notification-time"},mx={class:"notification-body"},fx={class:"notification-meta"},gx={class:"notification-type"},vx={class:"notification-status"},bx=tr({__name:"NotificationDebug",setup(e){const t=Xo(),n=a(()=>[...t.unreadNotifications,...t.readNotifications]);async function s(){try{await(async()=>{try{console.log("🧪 Enviando notificación de prueba para app cerrada...");const e=await Ta.post("/notifications/test-background",{title:"🔔 Prueba App Cerrada",message:"Esta notificación debe aparecer cuando la app está cerrada",data:{type:"background_test",timestamp:(new Date).toISOString(),test_mode:!0}});return console.log("✅ Notificación de prueba enviada:",e.data),e.data}catch(e){throw console.error("❌ Error enviando notificación de prueba:",e),e}})(),alert("✅ Notificación de prueba enviada. Cierra la app y verifica que llegue la notificación.")}catch(e){alert("❌ Error enviando notificación: "+e.message)}}async function i(){try{await(async(e=10)=>{try{console.log(`🕐 Programando notificación de prueba en ${e} segundos...`);const t=await Ta.post("/notifications/schedule-test",{delay:e,title:"⏰ Notificación Programada",message:`Esta notificación fue programada hace ${e} segundos`,data:{type:"scheduled_test",scheduled_at:(new Date).toISOString(),delay_seconds:e}});return console.log("✅ Notificación programada:",t.data),t.data}catch(t){throw console.error("❌ Error programando notificación:",t),t}})(15),alert("✅ Notificación programada para 15 segundos. Cierra la app y espera.")}catch(e){alert("❌ Error programando notificación: "+e.message)}}function h(){const e={steps:["1. Asegúrate de estar autenticado en la app","2. Ejecuta sendTestBackgroundNotification() o scheduleTestNotification()","3. Cierra completamente la aplicación (no solo minimizar)","4. Espera unos segundos","5. Deberías ver la notificación en la barra de notificaciones","6. Al tocar la notificación, la app debe abrirse"],note:"Para Android, asegúrate de que los permisos de notificaciones estén activados y que la app no esté en modo ahorro de batería."},t=`\nInstrucciones para probar notificaciones:\n\n${e.steps.join("\n")}\n\nNota: ${e.note}\n  `;alert(t)}return(e,t)=>(r(),o("div",cx,[t[2]||(t[2]=l("div",{class:"page-header"},[l("h1",null,"Panel de Debug - Notificaciones"),l("p",{class:"subtitle"},"Prueba y monitorea el sistema de notificaciones FCM")],-1)),f(lx),l("div",{class:"background-tests"},[t[0]||(t[0]=l("h2",null,"📴 Pruebas App Cerrada",-1)),t[1]||(t[1]=l("p",{class:"test-description"}," Estas pruebas envían notificaciones que deben llegar cuando la aplicación está completamente cerrada. ",-1)),l("div",{class:"test-buttons"},[l("button",{onClick:s,class:"test-btn primary"}," 🧪 Probar App Cerrada "),l("button",{onClick:i,class:"test-btn secondary"}," ⏰ Notificación en 15s "),l("button",{onClick:h,class:"test-btn info"}," 📋 Ver Instrucciones ")])]),n.value.length>0?(r(),o("div",dx,[l("h2",null,"📬 Notificaciones Actuales ("+d(n.value.length)+")",1),l("div",ux,[(r(!0),o(p,null,m(n.value.slice(0,10),e=>{var t,a,n;return r(),o("div",{key:e.id,class:u(["notification-preview",{unread:!e.read_at}])},[l("div",hx,[l("strong",null,d((null==(t=e.data)?void 0:t.title)||e.title||"Sin título"),1),l("span",px,d((n=e.created_at||e.timestamp,new Date(n).toLocaleString())),1)]),l("p",mx,d((null==(a=e.data)?void 0:a.message)||e.body||"Sin mensaje"),1),l("div",fx,[l("span",gx,d(e.type||"notification"),1),l("span",vx,d(e.read_at?"Leída":"No leída"),1)])],2)}),128))])])):c("",!0),t[3]||(t[3]=A('<div class="instructions" data-v-da0dde4d><h2 data-v-da0dde4d>📋 Instrucciones de Uso</h2><div class="instruction-steps" data-v-da0dde4d><div class="step" data-v-da0dde4d><span class="step-number" data-v-da0dde4d>1</span><div class="step-content" data-v-da0dde4d><strong data-v-da0dde4d>Inicializar Sistema:</strong><p data-v-da0dde4d>Haz clic en &quot;Inicializar Sistema&quot; para configurar FCM y obtener permisos.</p></div></div><div class="step" data-v-da0dde4d><span class="step-number" data-v-da0dde4d>2</span><div class="step-content" data-v-da0dde4d><strong data-v-da0dde4d>Probar Notificaciones:</strong><p data-v-da0dde4d>Usa &quot;Test Local&quot; para notificaciones inmediatas o &quot;Servidor&quot; para probar el backend.</p></div></div><div class="step" data-v-da0dde4d><span class="step-number" data-v-da0dde4d>3</span><div class="step-content" data-v-da0dde4d><strong data-v-da0dde4d>Verificar en el Bell:</strong><p data-v-da0dde4d>Las notificaciones aparecerán en el icono de campana en la barra superior.</p></div></div></div></div>',1))]))}},[["__scopeId","data-v-da0dde4d"]]),wx={class:"call-waiter-container"},yx={key:0,class:"call-idle-state"},_x=["disabled"],kx={key:0},Cx={key:1},Ex={key:1,class:"call-calling-state"},Sx={key:2,class:"call-waiting-state"},Tx={class:"call-status-card"},Nx={class:"wait-time"},xx={key:3,class:"call-acknowledged-state"},Ix={key:4,class:"call-error-state"},Ax={class:"call-status-card error"},Px={class:"urgency-options"},Rx=tr({__name:"CallWaiterButton",props:{tableId:{type:[String,Number],required:!0},businessId:{type:[String,Number],required:!0},tableNumber:{type:[String,Number],default:null}},emits:["call-status-change"],setup(e,{emit:t}){const n=e,p=t,m=N({callState:"idle",loading:!1,showUrgencyOptions:!1,waitTimeSeconds:0,errorMessage:{},currentCallId:null,waitTimer:null}),f=a(()=>m.callState),g=a(()=>m.loading),b=a({get:()=>m.showUrgencyOptions,set:e=>m.showUrgencyOptions=e}),w=a(()=>m.waitTimeSeconds),y=a(()=>m.errorMessage),_=a(()=>{const e=m.waitTimeSeconds;if(e<60)return`${e}s`;return`${Math.floor(e/60)}m ${e%60}s`}),k=()=>{m.showUrgencyOptions=!0},C=()=>{E("urgent")},E=async(e="normal")=>{m.showUrgencyOptions=!1,m.callState="calling",m.loading=!0,p("call-status-change","calling");try{console.log("📞 Calling waiter...",{tableId:n.tableId,urgency:e,tableNumber:n.tableNumber});const t=await Zl.callWaiter(n.tableId,{message:"urgent"===e?"Solicitud urgente":"Solicita mozo",urgency:"urgent"===e?"high":"normal",client_info:{timestamp:(new Date).toISOString(),table_number:n.tableNumber}});t.success?(console.log("✅ Waiter called successfully:",t),m.currentCallId=t.call_id,m.callState="waiting",m.waitTimeSeconds=0,x(),A(),p("call-status-change","waiting")):S(t)}catch(t){console.error("❌ Error calling waiter:",t),S(t)}finally{m.loading=!1}},S=e=>{var t,a;m.callState="error",(null==(t=e.message)?void 0:t.includes("no_waiter_assigned"))?m.errorMessage={title:"Mozo no disponible",description:"No hay un mozo asignado a esta mesa actualmente. Por favor, solicite ayuda al personal del establecimiento."}:(null==(a=e.message)?void 0:a.includes("table_silenced"))?m.errorMessage={title:"Mesa temporalmente silenciada",description:"Su mesa está temporalmente silenciada. Inténtelo de nuevo en unos minutos."}:m.errorMessage={title:"Error en la conexión",description:"No pudimos procesar su solicitud. Verifique su conexión a internet e inténtelo nuevamente."},p("call-status-change","error")},T=()=>{I(),P(),m.callState="idle",m.currentCallId=null,m.waitTimeSeconds=0,m.errorMessage={},p("call-status-change","idle")},x=()=>{I(),m.waitTimer=setInterval(()=>{m.waitTimeSeconds+=1},1e3)},I=()=>{m.waitTimer&&(clearInterval(m.waitTimer),m.waitTimer=null)},A=()=>{window.addEventListener("waiter-call-acknowledged",R),window.addEventListener("waiter-call-completed",D)},P=()=>{window.removeEventListener("waiter-call-acknowledged",R),window.removeEventListener("waiter-call-completed",D)},R=e=>{console.log("✅ Waiter acknowledged call:",e.detail),e.detail.call_id===m.currentCallId&&(I(),m.callState="acknowledged",p("call-status-change","acknowledged"))},D=e=>{console.log("✅ Waiter completed call:",e.detail),e.detail.call_id===m.currentCallId&&T()};return s(()=>{console.log("🔔 CallWaiterButton mounted",{tableId:n.tableId,businessId:n.businessId,tableNumber:n.tableNumber})}),i(()=>{I(),P()}),(e,t)=>(r(),o("div",wx,["idle"===f.value?(r(),o("div",yx,[t[5]||(t[5]=l("div",{class:"call-info"},[l("h3",null,[l("i",{class:"fas fa-concierge-bell"}),v(" ¿Necesitas ayuda? ")]),l("p",null,"Presiona el botón para llamar a tu mozo")],-1)),l("button",{onClick:k,class:"call-button primary",disabled:g.value},[l("i",{class:u(["fas fa-bell",{"fa-spin":g.value}])},null,2),g.value?(r(),o("span",Cx,"Conectando...")):(r(),o("span",kx,"Llamar Mozo"))],8,_x)])):"calling"===f.value?(r(),o("div",Ex,t[6]||(t[6]=[l("div",{class:"call-status-card"},[l("div",{class:"status-icon calling"},[l("i",{class:"fas fa-paper-plane"})]),l("h3",null,"Llamando mozo..."),l("p",null,"Estamos notificando a tu mozo"),l("div",{class:"loading-dots"},[l("span"),l("span"),l("span")])],-1)]))):"waiting"===f.value?(r(),o("div",Sx,[l("div",Tx,[t[9]||(t[9]=l("div",{class:"status-icon waiting"},[l("i",{class:"fas fa-clock"})],-1)),t[10]||(t[10]=l("h3",null,"¡Mozo notificado!",-1)),t[11]||(t[11]=l("p",null,"Aguarde por favor, su mozo fue notificado y lo atenderá en breve",-1)),l("div",Nx,[t[7]||(t[7]=l("i",{class:"fas fa-hourglass-half"},null,-1)),l("span",null,"Tiempo de espera: "+d(_.value),1)]),w.value>120?(r(),o("button",{key:0,onClick:C,class:"call-button urgent"},t[8]||(t[8]=[l("i",{class:"fas fa-exclamation-triangle"},null,-1),v(" Llamar urgente ")]))):c("",!0)])])):"acknowledged"===f.value?(r(),o("div",xx,[l("div",{class:"call-status-card success"},[t[13]||(t[13]=l("div",{class:"status-icon acknowledged"},[l("i",{class:"fas fa-check"})],-1)),t[14]||(t[14]=l("h3",null,"¡Mozo en camino!",-1)),t[15]||(t[15]=l("p",null,"Su mozo confirmó la llamada y se dirige a su mesa",-1)),l("button",{onClick:T,class:"call-button secondary"},t[12]||(t[12]=[l("i",{class:"fas fa-redo"},null,-1),v(" Nueva solicitud ")]))])])):"error"===f.value?(r(),o("div",Ix,[l("div",Ax,[t[17]||(t[17]=l("div",{class:"status-icon error"},[l("i",{class:"fas fa-exclamation-triangle"})],-1)),l("h3",null,d(y.value.title||"Error en la llamada"),1),l("p",null,d(y.value.description||"No pudimos contactar con su mozo. Intente nuevamente."),1),l("button",{onClick:T,class:"call-button primary"},t[16]||(t[16]=[l("i",{class:"fas fa-redo"},null,-1),v(" Intentar nuevamente ")]))])])):c("",!0),b.value?(r(),o("div",{key:5,class:"urgency-modal-overlay",onClick:t[4]||(t[4]=e=>b.value=!1)},[l("div",{class:"urgency-modal",onClick:t[3]||(t[3]=h(()=>{},["stop"]))},[t[20]||(t[20]=l("h4",null,"Tipo de solicitud",-1)),l("div",Px,[l("button",{onClick:t[0]||(t[0]=e=>E("normal")),class:"urgency-option normal"},t[18]||(t[18]=[l("i",{class:"fas fa-bell"},null,-1),l("span",null,"Normal",-1),l("small",null,"Solicitud general",-1)])),l("button",{onClick:t[1]||(t[1]=e=>E("urgent")),class:"urgency-option urgent"},t[19]||(t[19]=[l("i",{class:"fas fa-exclamation-triangle"},null,-1),l("span",null,"Urgente",-1),l("small",null,"Necesito atención inmediata",-1)]))]),l("button",{onClick:t[2]||(t[2]=e=>b.value=!1),class:"cancel-btn"}," Cancelar ")])])):c("",!0)]))}},[["__scopeId","data-v-28254294"]]),Dx={class:"menu-table-page"},Lx={class:"business-header"},Mx={class:"business-info"},Ox={key:0,class:"business-logo"},Fx=["src","alt"],Ux={class:"business-details"},Bx={class:"table-info"},qx={key:0,class:"business-address"},$x={class:"main-content"},jx={class:"menu-section"},zx={key:0,class:"loading-state"},Vx={key:1,class:"error-state"},Wx={key:2,class:"pdf-container"},Hx=["src"],Gx={class:"pdf-actions"},Yx=["href"],Kx={key:3,class:"no-menu-state"},Qx={class:"waiter-call-section"},Jx={class:"page-footer"},Zx={class:"app-branding"},Xx={class:"version"},eI=tr({__name:"MenuTable",setup(e){const t=b(),i=a(()=>t.params.tableId),u=a(()=>t.query.business_id),h=a(()=>t.query.table_number||i.value),p=N({businessData:{},menuPdfUrl:null,loadingMenu:!0,loadingBusiness:!0,menuError:!1,businessError:!1,callStatus:"idle"}),m=a(()=>p.businessData),g=a(()=>p.menuPdfUrl),w=a(()=>p.loadingMenu),y=a(()=>p.menuError),_=async()=>{if(u.value)try{p.loadingBusiness=!0,p.businessError=!1;const e=await Ta.get(`/public/business/${u.value}`);if(!e.data.success)throw new Error(e.data.message||"Error loading business info");p.businessData=e.data.business,console.log("✅ Business info loaded:",p.businessData)}catch(e){console.error("❌ Error loading business info:",e),p.businessError=!0,p.businessData={name:"Restaurante",address:null,logo:null}}finally{p.loadingBusiness=!1}else console.error("Business ID not provided")},k=async()=>{if(!u.value)return console.error("Business ID not provided for menu"),void(p.loadingMenu=!1);try{p.loadingMenu=!0,p.menuError=!1;const e=await Ta.get(`/public/business/${u.value}/menu`);e.data.success&&e.data.menu_pdf_url?(p.menuPdfUrl=e.data.menu_pdf_url,console.log("✅ Menu PDF loaded:",p.menuPdfUrl)):(console.warn("⚠️ No menu available for this business"),p.menuPdfUrl=null)}catch(e){console.error("❌ Error loading menu:",e),p.menuError=!0}finally{p.loadingMenu=!1}},C=e=>{p.callStatus=e,console.log("📱 Call status changed:",e)};return s(async()=>{console.log("🏠 MenuTable mounted",{tableId:i.value,businessId:u.value,tableNumber:h.value}),i.value&&u.value?await Promise.all([_(),k()]):console.error("❌ Missing required parameters")}),(e,t)=>(r(),o("div",Dx,[l("div",Lx,[l("div",Mx,[m.value.logo?(r(),o("div",Ox,[l("img",{src:m.value.logo,alt:m.value.name},null,8,Fx)])):c("",!0),l("div",Ux,[l("h1",null,d(m.value.name||"Bienvenido"),1),l("div",Bx,[t[0]||(t[0]=l("i",{class:"fas fa-table"},null,-1)),l("span",null,"Mesa "+d(h.value),1)]),m.value.address?(r(),o("div",qx,[t[1]||(t[1]=l("i",{class:"fas fa-map-marker-alt"},null,-1)),l("span",null,d(m.value.address),1)])):c("",!0)])])]),l("div",$x,[l("div",jx,[t[8]||(t[8]=l("div",{class:"section-header"},[l("h2",null,[l("i",{class:"fas fa-utensils"}),v(" Nuestro Menú ")])],-1)),w.value?(r(),o("div",zx,t[2]||(t[2]=[l("div",{class:"spinner"},null,-1),l("p",null,"Cargando menú...",-1)]))):y.value?(r(),o("div",Vx,[t[4]||(t[4]=l("i",{class:"fas fa-exclamation-triangle"},null,-1)),t[5]||(t[5]=l("p",null,"No pudimos cargar el menú",-1)),l("button",{onClick:k,class:"retry-btn"},t[3]||(t[3]=[l("i",{class:"fas fa-refresh"},null,-1),v(" Reintentar ")]))])):g.value?(r(),o("div",Wx,[l("iframe",{src:g.value,class:"pdf-viewer",title:"Menú del restaurante",frameborder:"0"},null,8,Hx),l("div",Gx,[l("a",{href:g.value,target:"_blank",class:"pdf-action-btn"},t[6]||(t[6]=[l("i",{class:"fas fa-external-link-alt"},null,-1),v(" Ver menú completo ")]),8,Yx)])])):(r(),o("div",Kx,t[7]||(t[7]=[l("i",{class:"fas fa-file-pdf"},null,-1),l("p",null,"Menú no disponible temporalmente",-1),l("small",null,"Consulte con el personal del establecimiento",-1)])))]),l("div",Qx,[f(Rx,{"table-id":i.value,"business-id":u.value,"table-number":h.value,onCallStatusChange:C},null,8,["table-id","business-id","table-number"])])]),l("div",Jx,[l("div",Zx,[t[9]||(t[9]=l("span",null,"Powered by",-1)),t[10]||(t[10]=l("strong",null,"MozoApp",-1)),l("span",Xx,d(n(Ir)()),1)])])]))}},[["__scopeId","data-v-eae715a0"]]),tI=M({history:O("/"),routes:[{path:"/",name:"root",beforeEnter:(e,t,a)=>{const n=Ga(),{isAuthenticated:s,currentRole:i}=F(n);if(s.value){return a({name:"waiter"===(i.value||"admin")?"waiter-dashboard":"admin"})}return a({name:"login"})}},{path:"/login",name:"login",component:Kr,meta:{requiresGuest:!0}},{path:"/register",name:"register",component:pl,meta:{requiresGuest:!0}},{path:"/forgot-password",name:"forgot-password",component:El,meta:{requiresGuest:!0}},{path:"/reset-password",name:"reset-password",component:jl,meta:{requiresGuest:!0}},{path:"/role-selection",name:"role-selection",component:Jl,meta:{requiresAuth:!0}},{path:"/waiter/dashboard",name:"waiter-dashboard",component:_y,meta:{requiresAuth:!0,role:"waiter"}},{path:"/waiter/onboard",name:"waiter-onboard",component:A_,meta:{requiresAuth:!0,role:"waiter"}},{path:"/profile",name:"profile",component:w_,meta:{requiresAuth:!0}},{path:"/admin",name:"admin",component:ek,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/home",name:"admin-home",component:pk,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/qr",name:"admin-qr",component:EC,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/stats",name:"admin-stats",component:TC,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/staff",name:"admin-staff",component:jE,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/staff/:id",name:"admin-staff-detail",component:lT,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/profile",name:"admin-profile",component:HT,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/settings",name:"admin-settings",component:xN,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/notification-debug",name:"admin-notification-debug",component:bx,meta:{requiresAuth:!0,role:"admin"}},{path:"/menu/mesa/:tableId",name:"menu-table",component:eI,meta:{isPublic:!0}},{path:"/:pathMatch(.*)*",redirect:"/"}]});tI.beforeEach(async(e,t,a)=>{const n=Ga(),{isAuthenticated:s}=F(n);if(e.meta.isPublic)return a();s.value&&!n.user&&await n.fetchUser(),a()});const aI=Y("PushNotifications",{}),nI={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_DEBUG_MODE:"true",VITE_FIREBASE_API_KEY:"AIzaSyCecfSTfyxk3D2X4XsLaSGkckvf-OvhFZA",VITE_FIREBASE_APP_ID:"1:175482362472:android:f2589ca9ec71fd0cb6b9dd",VITE_FIREBASE_MESSAGING_SENDER_ID:"175482362472",VITE_FIREBASE_PROJECT_ID:"mozoqr-7d32c",VITE_FIREBASE_VAPID_KEY:"BNJgpNkgB0a0y7gHT-SNBFLMGIZw-Xx8NTBDCn_4dVqekzgmnGmKMIn10t-6gWl3Qj_msyCcfbsVycnAp8USs6M",VITE_PUSHER_APP_CLUSTER:"us2",VITE_PUSHER_APP_KEY:"bd06ab967cc733531514",VITE_QR_BASE_URL:"https://mozoqr.com",VITE_URL_API:"https://mozoqr.com/api/"},sI=t({configured:!1,tokenExists:!1}),iI=async()=>{if(!G.isPluginAvailable("PushNotifications"))return{available:!1,reason:"Plugin no disponible"};try{const e=await aI.checkPermissions(),t=localStorage.getItem("fcm_token");return{available:!0,permissions:e.receive,hasToken:!!t,token:t?`${t.substring(0,20)}...`:null,platform:G.getPlatform()}}catch(e){return{available:!1,reason:e.message}}},oI=()=>{const e=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_PROJECT_ID"].filter(e=>!nI[e]);return{configured:0===e.length,missing:e,config:{apiKey:"Configurada",projectId:"Configurada"}}},rI=e=>{try{const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      top: 50px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: rgba(0,0,0,0.9);\n      color: white;\n      padding: 12px 20px;\n      border-radius: 8px;\n      z-index: 10000;\n      font-size: 14px;\n      font-weight: bold;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.5);\n      max-width: 90%;\n      text-align: center;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.parentElement&&t.remove()},3e3)}catch(t){console.warn("Toast debug failed:",t)}},lI=e=>{try{if(!e.data)return!1;const t="string"==typeof e.data?JSON.parse(e.data):e.data;return"acknowledged"===t.status||"completed"===t.status?(console.log("🚫 Filtrando actualización de estado:",t.status),!0):e.android&&"normal"===e.android.priority?(console.log("🚫 Filtrando notificación de prioridad normal (posible confirmación)"),!0):"normal"===t.priority&&"new_call"!==t.type&&(console.log("🚫 Filtrando notificación normal que no es llamada nueva"),!0)}catch(t){return console.warn("⚠️ Error filtering notification:",t),!1}},cI=e=>{console.log("🔄 Procesando notificación del backend...");let t={title:e.title||"Nueva notificación",body:e.body||"Tienes una nueva notificación",data:e.data||{}};if(e.data){const a="string"==typeof e.data?JSON.parse(e.data):e.data;switch(console.log("🔄 Datos de notificación:",a),a.type){case"TestNotification":t={title:"Notificación de Prueba",body:"Esta es una notificación de prueba enviada a todos los usuarios del negocio",data:{...a,icon:"🧪",priority:"normal",channels:["Database","Broadcast","FCM"]}};break;case"UserSpecificNotification":t={title:a.title||"Notificación Personalizada",body:a.message||"Tienes una nueva notificación personalizada",data:{...a,icon:"👤",priority:"high",channels:["Database","Broadcast","FCM"]}};break;case"WebSocketTestNotification":t={title:"⚡ Prueba WebSocket + FCM",body:"Esta notificación llega por WebSocket (tiempo real) y FCM (push)",data:{...a,icon:"⚡",priority:"high",test_mode:"websocket_fcm"}};break;case"WebSocketOnlyNotification":t={title:"🔌 Prueba Solo WebSocket",body:"Esta notificación SOLO llega por WebSocket en tiempo real",data:{...a,icon:"🔌",priority:"normal",test_mode:"websocket_only"}};break;default:e.title&&e.body&&(t={title:e.title,body:e.body,data:{...a,icon:"📱",priority:"normal"}})}}return console.log("✅ Notificación procesada:",t),t},dI=Object.freeze(Object.defineProperty({__proto__:null,checkFirebaseConfig:oI,fcmStatus:sI,getNotificationStatus:iI,initializePushNotifications:async()=>{console.log("🔔 Inicializando sistema de notificaciones push...");const e=G.getPlatform();console.log("🔔 Plataforma detectada:",e),await(async()=>{if(console.log("🔔 Setting up push notification listeners..."),"web"===G.getPlatform())try{return console.log("🔔 Setting up Firebase listeners for web..."),await qa.setupForegroundMessageListener(e=>{console.log("🚨 FCM NOTIFICATION RECEIVED IN REAL-TIME:",e),console.log("⏰ Received at:",(new Date).toLocaleTimeString()),j(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>er);return{useNotificationsStore:e}},void 0).then(({useNotificationsStore:t})=>{var a,n,s;const i=t(),o=(null==(a=e.data)?void 0:a.callId)||(null==(n=e.data)?void 0:n.call_id)||null,r={id:o||`fcm-${Date.now()}`,type:(null==(s=e.data)?void 0:s.type)||(o?"waiter_call":"FCMNotification"),data:{title:e.title,message:e.body,...e.data},created_at:(new Date).toISOString(),read_at:null,source:"fcm-realtime"};try{if(o&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls&&window.ultraFastNotifications.activeCalls.has(o))return void console.log("🔍 Skipping FCM store add for call already in UltraFast activeCalls:",o)}catch(l){console.warn("⚠️ Error checking ultraFastNotifications activeCalls for dedupe:",l)}console.log("📨 Adding notification to store:",r),i.addNewNotification(r),console.log("✅ Notification added to reactive store!")}).catch(e=>{console.error("❌ Error importing notifications store:",e)})}),void console.log("✅ Firebase listeners configured for web")}catch(e){return void console.error("❌ Error setting up Firebase listeners:",e)}if(G.isPluginAvailable("PushNotifications"))try{aI.addListener("registration",async t=>{var a,n,s,i;console.log("✅ Push registration success, token:",t.value),localStorage.setItem("fcm_token",t.value);let o=0;const r=e=>new Promise(t=>setTimeout(t,e));for(;o<5;)try{const e=Ga();if(console.log("🔔 Intento de envío de token - intento",o+1,"authState:",{isAuthenticated:e.isAuthenticated,userId:null==(a=e.user)?void 0:a.id}),e.isAuthenticated&&(null==(n=e.user)?void 0:n.id)){const a=G.getPlatform();console.log("🔔 Enviando token al backend (móvil):",{token:t.value.substring(0,20)+"...",platform:a,userId:null==(s=e.user)?void 0:s.id});const n=await Na.storeDeviceToken(t.value,a,null==(i=e.user)?void 0:i.id);console.log("✅ Device token stored successfully (móvil):",n);break}o++,console.log("⚠️ Usuario no autenticado aún, reintentando en 500ms..."),await r(500);continue}catch(e){console.error("❌ Error intentando enviar token (móvil):",e),o++,await r(500)}5===o&&console.warn("⚠️ No se pudo enviar token al backend después de varios intentos. Se dejó guardado localmente.")}),aI.addListener("registrationError",e=>{console.error("❌ Error on registration:",JSON.stringify(e))}),aI.addListener("pushNotificationReceived",e=>{var t,a,n;const s=(null==(t=e.android)?void 0:t.priority)||(null==(a=e.data)?void 0:a.priority)||"unknown",i=(null==(n=e.data)?void 0:n.status)||"unknown";if(console.log(`🔔 Push received - Priority: ${s}, Status: ${i}`),console.log("🔔 Full notification:",JSON.stringify(e,null,2)),rI(`📨 Push: ${s}/${i}`),lI(e))return console.log(`🚫 Notificación filtrada - Priority: ${s}, Status: ${i}`),void rI(`🚫 FILTRADA: ${s}/${i}`);console.log(`✅ Notificación permitida - Priority: ${s}, Status: ${i}`),rI(`✅ PERMITIDA: ${s}/${i}`);const o=cI(e);G.isPluginAvailable("LocalNotifications")?j(async()=>{const{LocalNotifications:e}=await import("./index-NWj49HSU.js");return{LocalNotifications:e}},__vite__mapDeps([6,1,2])).then(({LocalNotifications:e})=>{e.schedule({notifications:[{title:o.title,body:o.body,id:(new Date).getTime(),sound:null,actionTypeId:"OPEN_APP",extra:{...o.data,receivedAt:(new Date).toISOString(),source:"push-foreground"}}]}).catch(e=>{console.error("❌ Error programando notificación local:",e)})}).catch(e=>{console.error("❌ Error importando LocalNotifications:",e)}):"Notification"in window&&"granted"===Notification.permission&&new Notification(o.title,{body:o.body,icon:"/favicon.ico",tag:"push-notification",data:o.data})}),aI.addListener("pushNotificationActionPerformed",e=>{console.log("🔔 Push action performed:",JSON.stringify(e,null,2));const t=e.notification.data;t&&t.route&&console.log("🔔 Navegando a:",t.route)}),console.log("✅ Listeners de notificaciones configurados correctamente")}catch(e){console.error("❌ Error configurando listeners:",e)}else console.log("⚠️ Plugin PushNotifications no disponible para listeners")})();const t=await(async()=>{var e;if(console.log("🔔 Starting push notification registration..."),"web"===G.getPlatform())try{if(console.log("🔔 Web platform detected, using Firebase FCM..."),!(await qa.initializeFirebase()))return{success:!1,error:"Firebase initialization failed"};const a=await qa.getFCMToken();console.log("🔔 FCM token obtained for web:",a.substring(0,20)+"..."),localStorage.setItem("fcm_token",a);const n=Ga();if(n.isAuthenticated)try{const t=await Na.storeDeviceToken(a,"web",null==(e=n.user)?void 0:e.id);console.log("✅ Device token stored:",t),sI.value={configured:!0,tokenExists:!0}}catch(t){console.error("❌ Error storing device token:",t)}else console.warn("⚠️ User not authenticated - token not sent to server");return{success:!0,token:a}}catch(t){return console.error("❌ FCM registration error:",t),{success:!1,error:t.message}}try{if(!G.isPluginAvailable("PushNotifications"))return console.warn("⚠️ Plugin PushNotifications no disponible para registro (móvil)"),{success:!1,error:"PushNotifications plugin not available"};try{const e=await aI.requestPermissions();if(console.log("🔔 Push permission result:",e),e&&"denied"===e.receive)return{success:!1,error:"Push permissions denied"}}catch(a){console.warn("⚠️ Error requesting push permissions:",a)}return await aI.register(),{success:!0,token:null}}catch(t){return console.error("❌ Mobile push registration error:",t),{success:!1,error:t.message}}})();G.isPluginAvailable&&G.isPluginAvailable("LocalNotifications")&&j(async()=>{const{LocalNotifications:e}=await import("./index-NWj49HSU.js");return{LocalNotifications:e}},__vite__mapDeps([6,1,2])).then(({LocalNotifications:e})=>{try{e&&e.createChannel&&e.createChannel({id:"mozo_waiter",name:"Mozo - Llamadas",importance:5,visibility:1,description:"Notificaciones de llamadas y eventos importantes para mozos"}).then(()=>{console.log("✅ Canal de notificaciones Android creado: mozo_waiter")}).catch(e=>{console.warn("⚠️ Error creando canal LocalNotifications:",e)})}catch(t){console.warn("⚠️ Excepción creando canal LocalNotifications:",t)}}).catch(e=>{console.warn("⚠️ No se pudo importar LocalNotifications para crear canal:",e)});const a=await iI(),n=oI(),s=qa.getFirebaseStatus();return console.log("🔔 Estado final de notificaciones:",{platform:e,registration:t,status:a,firebase:n,firebaseStatus:s}),{platform:e,registration:t,status:a,firebase:n,firebaseStatus:s}}},Symbol.toStringTag,{value:"Module"}));const uI=U(Lr),hI=B();uI.use(hI),uI.use(tI),uI.mount("#app"),"serviceWorker"in navigator&&navigator.serviceWorker.register("/firebase-messaging-sw.js").then(e=>console.log("Service Worker registrado:",e.scope)).catch(e=>console.warn("No se pudo registrar el Service Worker:",e)),async function(){console.group("[NotificationDiagnostics] Iniciando diagnóstico de notificaciones");try{if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.getRegistration("/firebase-messaging-sw.js");e?(console.log("[NotificationDiagnostics] Service Worker registrado. Scope:",e.scope),console.log("[NotificationDiagnostics] Service Worker active state:",e.active?e.active.state:"no active")):console.warn("[NotificationDiagnostics] Service Worker /firebase-messaging-sw.js NO registrado")}catch(e){console.warn("[NotificationDiagnostics] Error comprobando Service Worker:",e)}else console.warn("[NotificationDiagnostics] Service Workers no soportados en este navegador");const n="undefined"!=typeof Notification?Notification.permission:"unsupported";console.log("[NotificationDiagnostics] Permission:",n);const s=localStorage.getItem("fcm_token");if(console.log("[NotificationDiagnostics] fcm_token en localStorage:",s?`${s.substring(0,20)}...`:"no encontrado"),"denied"===n)console.warn("[NotificationDiagnostics] Permisos DENEGADOS - no se intentará obtener token");else try{if("default"===n){console.log("[NotificationDiagnostics] Solicitando permiso de notificaciones...");const e=await Notification.requestPermission();if(console.log("[NotificationDiagnostics] Resultado requestPermission():",e),"granted"!==e)return console.warn("[NotificationDiagnostics] Permiso no concedido; abortando obtención de token"),void console.groupEnd()}console.log("[NotificationDiagnostics] Inicializando Firebase y solicitando token...");if(await qa.initializeFirebase())try{const e=await qa.getFCMToken();console.log("[NotificationDiagnostics] FCM token obtenido:",e?`${e.substring(0,20)}...`:"no token"),e&&localStorage.setItem("fcm_token",e);if(localStorage.getItem("token"))try{console.log("[NotificationDiagnostics] Intentando enviar token al backend (prueba) con platform=web..."),await Na.storeDeviceToken(e,"web"),console.log("[NotificationDiagnostics] Intento de registro en backend: OK (verificar en DB)")}catch(t){console.warn("[NotificationDiagnostics] Error enviando token al backend:",(null==t?void 0:t.message)||t)}else console.log("[NotificationDiagnostics] No hay auth token en localStorage; no se enviará token al backend")}catch(a){console.warn("[NotificationDiagnostics] Error obteniendo FCM token:",(null==a?void 0:a.message)||a)}else console.warn("[NotificationDiagnostics] No se pudo inicializar Firebase (revisar variables env y SW)")}catch(e){console.warn("[NotificationDiagnostics] Error durante diagnóstico FCM:",e)}}finally{console.groupEnd()}}().catch(e=>console.warn("Error ejecutando diagnósticos de notificación:",e));export{Vc as C,Ic as E,xc as F,ed as L,ou as S,K as W,j as _,Mr as a,cu as b,tu as c,au as d,zc as e,Nc as f,lu as g,md as h,Sc as i,fc as j,bc as k,Uc as l,yc as m,Yc as n,pd as o,wc as p,nu as q,Y as r,Cc as u,Tc as v};
