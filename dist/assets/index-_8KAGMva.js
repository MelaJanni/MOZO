const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-CkC-AxDK.js","assets/vendor-C8q6etev.js","assets/bootstrap--QliLv9A.js","assets/echo-CW7OwuwS.js","assets/index.esm-DpHw5pYd.js","assets/index.esm-CGUsxFyW.js","assets/index.esm-Bh6acWP0.js","assets/index-BoVJG3f6.js"])))=>i.map(i=>d[i]);
import{d as e,r as t,c as a,u as n,o as i,a as s,b as o,e as r,f as l,g as c,t as d,n as u,w as h,F as p,h as m,i as f,j as g,k as v,l as b,m as w,p as y,q as _,T as C,s as k,v as E,x as S,y as T,z as I,A as N,B as x,C as A,D as P,E as R,G as D,H as M,I as L,J as O,K as F,L as U,M as B}from"./vendor-C8q6etev.js";import{M as q}from"./bootstrap--QliLv9A.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const j=e("calls",{state:()=>({calls:{},waiterActiveIds:[],businessActiveIds:[],stats:{pending_count:0,total_active_calls:0},initialized:!1,loading:!1,lastSync:null}),getters:{list:e=>Object.values(e.calls).sort((e,t)=>(t.called_at||0)-(e.called_at||0)),pending:e=>Object.values(e.calls).filter(e=>"pending"===e.status),acknowledged:e=>Object.values(e.calls).filter(e=>"acknowledged"===e.status),active:e=>Object.values(e.calls).filter(e=>"completed"!==e.status),has:e=>t=>!!e.calls[t]},actions:{upsert(e){if(!e||!e.id)return;const t=this.calls[e.id];if(t){const a={pending:1,acknowledged:2,completed:3};if(a[e.status]<a[t.status])return}this.calls[e.id]={...t||{},...e},this.lastSync=Date.now()},remove(e){this.calls[e]&&delete this.calls[e]},setWaiterActive(e){this.waiterActiveIds=e||[]},updateStats(e){this.stats={...this.stats,...e||{}}},markInitialized(){this.initialized=!0}}});const $={},z=function(e,t,a){let n=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=(null==a?void 0:a.nonce)||(null==a?void 0:a.getAttribute("nonce"));n=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in $)return;$[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,i&&n.setAttribute("nonce",i),document.head.appendChild(n),t?new Promise((t,a)=>{n.addEventListener("load",t),n.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)})};
/*! Capacitor: https://capacitorjs.com/ - MIT License */
var V,W;(W=V||(V={})).Unimplemented="UNIMPLEMENTED",W.Unavailable="UNAVAILABLE";class H extends Error{constructor(e,t,a){super(e),this.message=e,this.code=t,this.data=a}}const G=e=>{const t=e.CapacitorCustomPlatform||null,a=e.Capacitor||{},n=a.Plugins=a.Plugins||{},i=()=>null!==t?t.name:(e=>{var t,a;return(null==e?void 0:e.androidBridge)?"android":(null===(a=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===a?void 0:a.bridge)?"ios":"web"})(e),s=e=>{var t;return null===(t=a.PluginHeaders)||void 0===t?void 0:t.find(t=>t.name===e)},o=new Map;return a.convertFileSrc||(a.convertFileSrc=e=>e),a.getPlatform=i,a.handleError=t=>e.console.error(t),a.isNativePlatform=()=>"web"!==i(),a.isPluginAvailable=e=>{const t=o.get(e);return!!(null==t?void 0:t.platforms.has(i()))||!!s(e)},a.registerPlugin=(e,r={})=>{const l=o.get(e);if(l)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),l.proxy;const c=i(),d=s(e);let u;const h=n=>{let i;const s=(...s)=>{const o=(async()=>(!u&&c in r?u=u="function"==typeof r[c]?await r[c]():r[c]:null!==t&&!u&&"web"in r&&(u=u="function"==typeof r.web?await r.web():r.web),u))().then(t=>{const o=((t,n)=>{var i,s;if(!d){if(t)return null===(s=t[n])||void 0===s?void 0:s.bind(t);throw new H(`"${e}" plugin is not implemented on ${c}`,V.Unimplemented)}{const s=null==d?void 0:d.methods.find(e=>n===e.name);if(s)return"promise"===s.rtype?t=>a.nativePromise(e,n.toString(),t):(t,i)=>a.nativeCallback(e,n.toString(),t,i);if(t)return null===(i=t[n])||void 0===i?void 0:i.bind(t)}})(t,n);if(o){const e=o(...s);return i=null==e?void 0:e.remove,e}throw new H(`"${e}.${n}()" is not implemented on ${c}`,V.Unimplemented)});return"addListener"===n&&(o.remove=async()=>i()),o};return s.toString=()=>`${n.toString()}() { [capacitor code] }`,Object.defineProperty(s,"name",{value:n,writable:!1,configurable:!1}),s},p=h("addListener"),m=h("removeListener"),f=(e,t)=>{const a=p({eventName:e},t),n=async()=>{const n=await a;m({eventName:e,callbackId:n},t)},i=new Promise(e=>a.then(()=>e({remove:n})));return i.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await n()},i},g=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return d?f:p;case"removeListener":return m;default:return h(t)}}});return n[e]=g,o.set(e,{name:e,proxy:g,platforms:new Set([...Object.keys(r),...d?[c]:[]])}),g},a.Exception=H,a.DEBUG=!!a.DEBUG,a.isLoggingEnabled=!!a.isLoggingEnabled,a},Y=(e=>e.Capacitor=G(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),K=Y.registerPlugin;class Q{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let a=!1;this.listeners[e]||(this.listeners[e]=[],a=!0),this.listeners[e].push(t);const n=this.windowListeners[e];n&&!n.registered&&this.addWindowListener(n),a&&this.sendRetainedArgumentsForEvent(e);return Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,a){const n=this.listeners[e];if(n)n.forEach(e=>e(t));else if(a){let a=this.retainedEventArguments[e];a||(a=[]),a.push(t),this.retainedEventArguments[e]=a}}hasListeners(e){var t;return!!(null===(t=this.listeners[e])||void 0===t?void 0:t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new Y.Exception(e,V.Unimplemented)}unavailable(e="not available"){return new Y.Exception(e,V.Unavailable)}async removeListener(e,t){const a=this.listeners[e];if(!a)return;const n=a.indexOf(t);this.listeners[e].splice(n,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(t=>{this.notifyListeners(e,t)}))}}const J=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Z=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class X extends Q{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[a,n]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");a=Z(a).trim(),n=Z(n).trim(),t[a]=n}),t}async setCookie(e){try{const t=J(e.key),a=J(e.value),n=`; expires=${(e.expires||"").replace("expires=","")}`,i=(e.path||"/").replace("path=",""),s=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${a||""}${n}; path=${i}; ${s};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}K("CapacitorCookies",{web:()=>new X});const ee=(e,t={})=>{const a=Object.assign({method:e.method||"GET",headers:e.headers},t),n=((e={})=>{const t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((a,n,i)=>(a[n]=e[t[i]],a),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)a.body=e.data;else if(n.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[a,n]of Object.entries(e.data||{}))t.set(a,n);a.body=t.toString()}else if(n.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,a)=>{t.append(a,e)});else for(const a of Object.keys(e.data))t.append(a,e.data[a]);a.body=t;const n=new Headers(a.headers);n.delete("content-type"),a.headers=n}else(n.includes("application/json")||"object"==typeof e.data)&&(a.body=JSON.stringify(e.data));return a};class te extends Q{async request(e){const t=ee(e,e.webFetchExtra),a=((e,t=!0)=>e?Object.entries(e).reduce((e,a)=>{const[n,i]=a;let s,o;return Array.isArray(i)?(o="",i.forEach(e=>{s=t?encodeURIComponent(e):e,o+=`${n}=${s}&`}),o.slice(0,-1)):(s=t?encodeURIComponent(i):i,o=`${n}=${s}`),`${e}&${o}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),n=a?`${e.url}?${a}`:e.url,i=await fetch(n,t),s=i.headers.get("content-type")||"";let o,r,{responseType:l="text"}=i.ok?e:{};switch(s.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":r=await i.blob(),o=await(async e=>new Promise((t,a)=>{const n=new FileReader;n.onload=()=>{const e=n.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},n.onerror=e=>a(e),n.readAsDataURL(e)}))(r);break;case"json":o=await i.json();break;default:o=await i.text()}const c={};return i.headers.forEach((e,t)=>{c[t]=e}),{data:o,headers:c,status:i.status,url:i.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}K("CapacitorHttp",{web:()=>new te});const ae=Object.freeze(Object.defineProperty({__proto__:null,Capacitor:Y,CapacitorException:H,get ExceptionCode(){return V},WebPlugin:Q,buildRequestInit:ee,registerPlugin:K},Symbol.toStringTag,{value:"Module"})),ne=K("App",{web:()=>z(()=>import("./web-CkC-AxDK.js"),__vite__mapDeps([0,1,2])).then(e=>new e.AppWeb)}),ie=e("ui",()=>{const e=t(!1);return{isOffCanvasOpen:e,toggleOffCanvas:function(){e.value=!e.value},closeOffCanvas:function(){e.value=!1}}});function se(e,t){return function(){return e.apply(t,arguments)}}const{toString:oe}=Object.prototype,{getPrototypeOf:re}=Object,{iterator:le,toStringTag:ce}=Symbol,de=(e=>t=>{const a=oe.call(t);return e[a]||(e[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),ue=e=>(e=e.toLowerCase(),t=>de(t)===e),he=e=>t=>typeof t===e,{isArray:pe}=Array,me=he("undefined");const fe=ue("ArrayBuffer");const ge=he("string"),ve=he("function"),be=he("number"),we=e=>null!==e&&"object"==typeof e,ye=e=>{if("object"!==de(e))return!1;const t=re(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||ce in e||le in e)},_e=ue("Date"),Ce=ue("File"),ke=ue("Blob"),Ee=ue("FileList"),Se=ue("URLSearchParams"),[Te,Ie,Ne,xe]=["ReadableStream","Request","Response","Headers"].map(ue);function Ae(e,t,{allOwnKeys:a=!1}={}){if(null==e)return;let n,i;if("object"!=typeof e&&(e=[e]),pe(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const i=a?Object.getOwnPropertyNames(e):Object.keys(e),s=i.length;let o;for(n=0;n<s;n++)o=i[n],t.call(null,e[o],o,e)}}function Pe(e,t){t=t.toLowerCase();const a=Object.keys(e);let n,i=a.length;for(;i-- >0;)if(n=a[i],t===n.toLowerCase())return n;return null}const Re="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,De=e=>!me(e)&&e!==Re;const Me=(e=>t=>e&&t instanceof e)("undefined"!=typeof Uint8Array&&re(Uint8Array)),Le=ue("HTMLFormElement"),Oe=(({hasOwnProperty:e})=>(t,a)=>e.call(t,a))(Object.prototype),Fe=ue("RegExp"),Ue=(e,t)=>{const a=Object.getOwnPropertyDescriptors(e),n={};Ae(a,(a,i)=>{let s;!1!==(s=t(a,i,e))&&(n[i]=s||a)}),Object.defineProperties(e,n)};const Be=ue("AsyncFunction"),qe=(je="function"==typeof setImmediate,$e=ve(Re.postMessage),je?setImmediate:$e?(ze=`axios@${Math.random()}`,Ve=[],Re.addEventListener("message",({source:e,data:t})=>{e===Re&&t===ze&&Ve.length&&Ve.shift()()},!1),e=>{Ve.push(e),Re.postMessage(ze,"*")}):e=>setTimeout(e));var je,$e,ze,Ve;const We="undefined"!=typeof queueMicrotask?queueMicrotask.bind(Re):"undefined"!=typeof process&&process.nextTick||qe,He={isArray:pe,isArrayBuffer:fe,isBuffer:function(e){return null!==e&&!me(e)&&null!==e.constructor&&!me(e.constructor)&&ve(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||ve(e.append)&&("formdata"===(t=de(e))||"object"===t&&ve(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&fe(e.buffer),t},isString:ge,isNumber:be,isBoolean:e=>!0===e||!1===e,isObject:we,isPlainObject:ye,isReadableStream:Te,isRequest:Ie,isResponse:Ne,isHeaders:xe,isUndefined:me,isDate:_e,isFile:Ce,isBlob:ke,isRegExp:Fe,isFunction:ve,isStream:e=>we(e)&&ve(e.pipe),isURLSearchParams:Se,isTypedArray:Me,isFileList:Ee,forEach:Ae,merge:function e(){const{caseless:t}=De(this)&&this||{},a={},n=(n,i)=>{const s=t&&Pe(a,i)||i;ye(a[s])&&ye(n)?a[s]=e(a[s],n):ye(n)?a[s]=e({},n):pe(n)?a[s]=n.slice():a[s]=n};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&Ae(arguments[i],n);return a},extend:(e,t,a,{allOwnKeys:n}={})=>(Ae(t,(t,n)=>{a&&ve(t)?e[n]=se(t,a):e[n]=t},{allOwnKeys:n}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,a,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),a&&Object.assign(e.prototype,a)},toFlatObject:(e,t,a,n)=>{let i,s,o;const r={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)o=i[s],n&&!n(o,e,t)||r[o]||(t[o]=e[o],r[o]=!0);e=!1!==a&&re(e)}while(e&&(!a||a(e,t))&&e!==Object.prototype);return t},kindOf:de,kindOfTest:ue,endsWith:(e,t,a)=>{e=String(e),(void 0===a||a>e.length)&&(a=e.length),a-=t.length;const n=e.indexOf(t,a);return-1!==n&&n===a},toArray:e=>{if(!e)return null;if(pe(e))return e;let t=e.length;if(!be(t))return null;const a=new Array(t);for(;t-- >0;)a[t]=e[t];return a},forEachEntry:(e,t)=>{const a=(e&&e[le]).call(e);let n;for(;(n=a.next())&&!n.done;){const a=n.value;t.call(e,a[0],a[1])}},matchAll:(e,t)=>{let a;const n=[];for(;null!==(a=e.exec(t));)n.push(a);return n},isHTMLForm:Le,hasOwnProperty:Oe,hasOwnProp:Oe,reduceDescriptors:Ue,freezeMethods:e=>{Ue(e,(t,a)=>{if(ve(e)&&-1!==["arguments","caller","callee"].indexOf(a))return!1;const n=e[a];ve(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")}))})},toObjectSet:(e,t)=>{const a={},n=e=>{e.forEach(e=>{a[e]=!0})};return pe(e)?n(e):n(String(e).split(t)),a},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,a){return t.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Pe,global:Re,isContextDefined:De,isSpecCompliantForm:function(e){return!!(e&&ve(e.append)&&"FormData"===e[ce]&&e[le])},toJSONObject:e=>{const t=new Array(10),a=(e,n)=>{if(we(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const i=pe(e)?[]:{};return Ae(e,(e,t)=>{const s=a(e,n+1);!me(s)&&(i[t]=s)}),t[n]=void 0,i}}return e};return a(e,0)},isAsyncFn:Be,isThenable:e=>e&&(we(e)||ve(e))&&ve(e.then)&&ve(e.catch),setImmediate:qe,asap:We,isIterable:e=>null!=e&&ve(e[le])};function Ge(e,t,a,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),a&&(this.config=a),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}He.inherits(Ge,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:He.toJSONObject(this.config),code:this.code,status:this.status}}});const Ye=Ge.prototype,Ke={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Ke[e]={value:e}}),Object.defineProperties(Ge,Ke),Object.defineProperty(Ye,"isAxiosError",{value:!0}),Ge.from=(e,t,a,n,i,s)=>{const o=Object.create(Ye);return He.toFlatObject(e,o,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),Ge.call(o,e.message,t,a,n,i),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};function Qe(e){return He.isPlainObject(e)||He.isArray(e)}function Je(e){return He.endsWith(e,"[]")?e.slice(0,-2):e}function Ze(e,t,a){return e?e.concat(t).map(function(e,t){return e=Je(e),!a&&t?"["+e+"]":e}).join(a?".":""):t}const Xe=He.toFlatObject(He,{},null,function(e){return/^is[A-Z]/.test(e)});function et(e,t,a){if(!He.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(a=He.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!He.isUndefined(t[e])})).metaTokens,i=a.visitor||c,s=a.dots,o=a.indexes,r=(a.Blob||"undefined"!=typeof Blob&&Blob)&&He.isSpecCompliantForm(t);if(!He.isFunction(i))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(He.isDate(e))return e.toISOString();if(!r&&He.isBlob(e))throw new Ge("Blob is not supported. Use a Buffer instead.");return He.isArrayBuffer(e)||He.isTypedArray(e)?r&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,a,i){let r=e;if(e&&!i&&"object"==typeof e)if(He.endsWith(a,"{}"))a=n?a:a.slice(0,-2),e=JSON.stringify(e);else if(He.isArray(e)&&function(e){return He.isArray(e)&&!e.some(Qe)}(e)||(He.isFileList(e)||He.endsWith(a,"[]"))&&(r=He.toArray(e)))return a=Je(a),r.forEach(function(e,n){!He.isUndefined(e)&&null!==e&&t.append(!0===o?Ze([a],n,s):null===o?a:a+"[]",l(e))}),!1;return!!Qe(e)||(t.append(Ze(i,a,s),l(e)),!1)}const d=[],u=Object.assign(Xe,{defaultVisitor:c,convertValue:l,isVisitable:Qe});if(!He.isObject(e))throw new TypeError("data must be an object");return function e(a,n){if(!He.isUndefined(a)){if(-1!==d.indexOf(a))throw Error("Circular reference detected in "+n.join("."));d.push(a),He.forEach(a,function(a,s){!0===(!(He.isUndefined(a)||null===a)&&i.call(t,a,He.isString(s)?s.trim():s,n,u))&&e(a,n?n.concat(s):[s])}),d.pop()}}(e),t}function tt(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function at(e,t){this._pairs=[],e&&et(e,this,t)}const nt=at.prototype;function it(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function st(e,t,a){if(!t)return e;const n=a&&a.encode||it;He.isFunction(a)&&(a={serialize:a});const i=a&&a.serialize;let s;if(s=i?i(t,a):He.isURLSearchParams(t)?t.toString():new at(t,a).toString(n),s){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}nt.append=function(e,t){this._pairs.push([e,t])},nt.toString=function(e){const t=e?function(t){return e.call(this,t,tt)}:tt;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};class ot{constructor(){this.handlers=[]}use(e,t,a){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!a&&a.synchronous,runWhen:a?a.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){He.forEach(this.handlers,function(t){null!==t&&e(t)})}}const rt={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},lt={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:at,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},ct="undefined"!=typeof window&&"undefined"!=typeof document,dt="object"==typeof navigator&&navigator||void 0,ut=ct&&(!dt||["ReactNative","NativeScript","NS"].indexOf(dt.product)<0),ht="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,pt=ct&&window.location.href||"http://localhost",mt={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ct,hasStandardBrowserEnv:ut,hasStandardBrowserWebWorkerEnv:ht,navigator:dt,origin:pt},Symbol.toStringTag,{value:"Module"})),...lt};function ft(e){function t(e,a,n,i){let s=e[i++];if("__proto__"===s)return!0;const o=Number.isFinite(+s),r=i>=e.length;if(s=!s&&He.isArray(n)?n.length:s,r)return He.hasOwnProp(n,s)?n[s]=[n[s],a]:n[s]=a,!o;n[s]&&He.isObject(n[s])||(n[s]=[]);return t(e,a,n[s],i)&&He.isArray(n[s])&&(n[s]=function(e){const t={},a=Object.keys(e);let n;const i=a.length;let s;for(n=0;n<i;n++)s=a[n],t[s]=e[s];return t}(n[s])),!o}if(He.isFormData(e)&&He.isFunction(e.entries)){const a={};return He.forEachEntry(e,(e,n)=>{t(function(e){return He.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),n,a,0)}),a}return null}const gt={transitional:rt,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const a=t.getContentType()||"",n=a.indexOf("application/json")>-1,i=He.isObject(e);i&&He.isHTMLForm(e)&&(e=new FormData(e));if(He.isFormData(e))return n?JSON.stringify(ft(e)):e;if(He.isArrayBuffer(e)||He.isBuffer(e)||He.isStream(e)||He.isFile(e)||He.isBlob(e)||He.isReadableStream(e))return e;if(He.isArrayBufferView(e))return e.buffer;if(He.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(a.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return et(e,new mt.classes.URLSearchParams,Object.assign({visitor:function(e,t,a,n){return mt.isNode&&He.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((s=He.isFileList(e))||a.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return et(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),function(e,t,a){if(He.isString(e))try{return(t||JSON.parse)(e),He.trim(e)}catch(n){if("SyntaxError"!==n.name)throw n}return(a||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||gt.transitional,a=t&&t.forcedJSONParsing,n="json"===this.responseType;if(He.isResponse(e)||He.isReadableStream(e))return e;if(e&&He.isString(e)&&(a&&!this.responseType||n)){const a=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(i){if(a){if("SyntaxError"===i.name)throw Ge.from(i,Ge.ERR_BAD_RESPONSE,this,null,this.response);throw i}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:mt.classes.FormData,Blob:mt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};He.forEach(["delete","get","head","post","put","patch"],e=>{gt.headers[e]={}});const vt=He.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),bt=Symbol("internals");function wt(e){return e&&String(e).trim().toLowerCase()}function yt(e){return!1===e||null==e?e:He.isArray(e)?e.map(yt):String(e)}function _t(e,t,a,n,i){return He.isFunction(n)?n.call(this,t,a):(i&&(t=a),He.isString(t)?He.isString(n)?-1!==t.indexOf(n):He.isRegExp(n)?n.test(t):void 0:void 0)}let Ct=class{constructor(e){e&&this.set(e)}set(e,t,a){const n=this;function i(e,t,a){const i=wt(t);if(!i)throw new Error("header name must be a non-empty string");const s=He.findKey(n,i);(!s||void 0===n[s]||!0===a||void 0===a&&!1!==n[s])&&(n[s||t]=yt(e))}const s=(e,t)=>He.forEach(e,(e,a)=>i(e,a,t));if(He.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(He.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))s((e=>{const t={};let a,n,i;return e&&e.split("\n").forEach(function(e){i=e.indexOf(":"),a=e.substring(0,i).trim().toLowerCase(),n=e.substring(i+1).trim(),!a||t[a]&&vt[a]||("set-cookie"===a?t[a]?t[a].push(n):t[a]=[n]:t[a]=t[a]?t[a]+", "+n:n)}),t})(e),t);else if(He.isObject(e)&&He.isIterable(e)){let a,n,i={};for(const t of e){if(!He.isArray(t))throw TypeError("Object iterator must return a key-value pair");i[n=t[0]]=(a=i[n])?He.isArray(a)?[...a,t[1]]:[a,t[1]]:t[1]}s(i,t)}else null!=e&&i(t,e,a);return this}get(e,t){if(e=wt(e)){const a=He.findKey(this,e);if(a){const e=this[a];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=a.exec(e);)t[n[1]]=n[2];return t}(e);if(He.isFunction(t))return t.call(this,e,a);if(He.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=wt(e)){const a=He.findKey(this,e);return!(!a||void 0===this[a]||t&&!_t(0,this[a],a,t))}return!1}delete(e,t){const a=this;let n=!1;function i(e){if(e=wt(e)){const i=He.findKey(a,e);!i||t&&!_t(0,a[i],i,t)||(delete a[i],n=!0)}}return He.isArray(e)?e.forEach(i):i(e),n}clear(e){const t=Object.keys(this);let a=t.length,n=!1;for(;a--;){const i=t[a];e&&!_t(0,this[i],i,e,!0)||(delete this[i],n=!0)}return n}normalize(e){const t=this,a={};return He.forEach(this,(n,i)=>{const s=He.findKey(a,i);if(s)return t[s]=yt(n),void delete t[i];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,a)=>t.toUpperCase()+a)}(i):String(i).trim();o!==i&&delete t[i],t[o]=yt(n),a[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return He.forEach(this,(a,n)=>{null!=a&&!1!==a&&(t[n]=e&&He.isArray(a)?a.join(", "):a)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const a=new this(e);return t.forEach(e=>a.set(e)),a}static accessor(e){const t=(this[bt]=this[bt]={accessors:{}}).accessors,a=this.prototype;function n(e){const n=wt(e);t[n]||(!function(e,t){const a=He.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+a,{value:function(e,a,i){return this[n].call(this,t,e,a,i)},configurable:!0})})}(a,e),t[n]=!0)}return He.isArray(e)?e.forEach(n):n(e),this}};function kt(e,t){const a=this||gt,n=t||a,i=Ct.from(n.headers);let s=n.data;return He.forEach(e,function(e){s=e.call(a,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function Et(e){return!(!e||!e.__CANCEL__)}function St(e,t,a){Ge.call(this,null==e?"canceled":e,Ge.ERR_CANCELED,t,a),this.name="CanceledError"}function Tt(e,t,a){const n=a.config.validateStatus;a.status&&n&&!n(a.status)?t(new Ge("Request failed with status code "+a.status,[Ge.ERR_BAD_REQUEST,Ge.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a)):e(a)}Ct.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),He.reduceDescriptors(Ct.prototype,({value:e},t)=>{let a=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[a]=e}}}),He.freezeMethods(Ct),He.inherits(St,Ge,{__CANCEL__:!0});const It=(e,t,a=3)=>{let n=0;const i=function(e,t){e=e||10;const a=new Array(e),n=new Array(e);let i,s=0,o=0;return t=void 0!==t?t:1e3,function(r){const l=Date.now(),c=n[o];i||(i=l),a[s]=r,n[s]=l;let d=o,u=0;for(;d!==s;)u+=a[d++],d%=e;if(s=(s+1)%e,s===o&&(o=(o+1)%e),l-i<t)return;const h=c&&l-c;return h?Math.round(1e3*u/h):void 0}}(50,250);return function(e,t){let a,n,i=0,s=1e3/t;const o=(t,s=Date.now())=>{i=s,a=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[(...e)=>{const t=Date.now(),r=t-i;r>=s?o(e,t):(a=e,n||(n=setTimeout(()=>{n=null,o(a)},s-r)))},()=>a&&o(a)]}(a=>{const s=a.loaded,o=a.lengthComputable?a.total:void 0,r=s-n,l=i(r);n=s;e({loaded:s,total:o,progress:o?s/o:void 0,bytes:r,rate:l||void 0,estimated:l&&o&&s<=o?(o-s)/l:void 0,event:a,lengthComputable:null!=o,[t?"download":"upload"]:!0})},a)},Nt=(e,t)=>{const a=null!=e;return[n=>t[0]({lengthComputable:a,total:e,loaded:n}),t[1]]},xt=e=>(...t)=>He.asap(()=>e(...t)),At=mt.hasStandardBrowserEnv?((e,t)=>a=>(a=new URL(a,mt.origin),e.protocol===a.protocol&&e.host===a.host&&(t||e.port===a.port)))(new URL(mt.origin),mt.navigator&&/(msie|trident)/i.test(mt.navigator.userAgent)):()=>!0,Pt=mt.hasStandardBrowserEnv?{write(e,t,a,n,i,s){const o=[e+"="+encodeURIComponent(t)];He.isNumber(a)&&o.push("expires="+new Date(a).toGMTString()),He.isString(n)&&o.push("path="+n),He.isString(i)&&o.push("domain="+i),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Rt(e,t,a){let n=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(n||0==a)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Dt=e=>e instanceof Ct?{...e}:e;function Mt(e,t){t=t||{};const a={};function n(e,t,a,n){return He.isPlainObject(e)&&He.isPlainObject(t)?He.merge.call({caseless:n},e,t):He.isPlainObject(t)?He.merge({},t):He.isArray(t)?t.slice():t}function i(e,t,a,i){return He.isUndefined(t)?He.isUndefined(e)?void 0:n(void 0,e,0,i):n(e,t,0,i)}function s(e,t){if(!He.isUndefined(t))return n(void 0,t)}function o(e,t){return He.isUndefined(t)?He.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function r(a,i,s){return s in t?n(a,i):s in e?n(void 0,a):void 0}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:r,headers:(e,t,a)=>i(Dt(e),Dt(t),0,!0)};return He.forEach(Object.keys(Object.assign({},e,t)),function(n){const s=l[n]||i,o=s(e[n],t[n],n);He.isUndefined(o)&&s!==r||(a[n]=o)}),a}const Lt=e=>{const t=Mt({},e);let a,{data:n,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:o,headers:r,auth:l}=t;if(t.headers=r=Ct.from(r),t.url=st(Rt(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&r.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),He.isFormData(n))if(mt.hasStandardBrowserEnv||mt.hasStandardBrowserWebWorkerEnv)r.setContentType(void 0);else if(!1!==(a=r.getContentType())){const[e,...t]=a?a.split(";").map(e=>e.trim()).filter(Boolean):[];r.setContentType([e||"multipart/form-data",...t].join("; "))}if(mt.hasStandardBrowserEnv&&(i&&He.isFunction(i)&&(i=i(t)),i||!1!==i&&At(t.url))){const e=s&&o&&Pt.read(o);e&&r.set(s,e)}return t},Ot="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,a){const n=Lt(e);let i=n.data;const s=Ct.from(n.headers).normalize();let o,r,l,c,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=n;function m(){c&&c(),d&&d(),n.cancelToken&&n.cancelToken.unsubscribe(o),n.signal&&n.signal.removeEventListener("abort",o)}let f=new XMLHttpRequest;function g(){if(!f)return;const n=Ct.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());Tt(function(e){t(e),m()},function(e){a(e),m()},{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:n,config:e,request:f}),f=null}f.open(n.method.toUpperCase(),n.url,!0),f.timeout=n.timeout,"onloadend"in f?f.onloadend=g:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(g)},f.onabort=function(){f&&(a(new Ge("Request aborted",Ge.ECONNABORTED,e,f)),f=null)},f.onerror=function(){a(new Ge("Network Error",Ge.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const i=n.transitional||rt;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),a(new Ge(t,i.clarifyTimeoutError?Ge.ETIMEDOUT:Ge.ECONNABORTED,e,f)),f=null},void 0===i&&s.setContentType(null),"setRequestHeader"in f&&He.forEach(s.toJSON(),function(e,t){f.setRequestHeader(t,e)}),He.isUndefined(n.withCredentials)||(f.withCredentials=!!n.withCredentials),u&&"json"!==u&&(f.responseType=n.responseType),p&&([l,d]=It(p,!0),f.addEventListener("progress",l)),h&&f.upload&&([r,c]=It(h),f.upload.addEventListener("progress",r),f.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(o=t=>{f&&(a(!t||t.type?new St(null,e,f):t),f.abort(),f=null)},n.cancelToken&&n.cancelToken.subscribe(o),n.signal&&(n.signal.aborted?o():n.signal.addEventListener("abort",o)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);v&&-1===mt.protocols.indexOf(v)?a(new Ge("Unsupported protocol "+v+":",Ge.ERR_BAD_REQUEST,e)):f.send(i||null)})},Ft=(e,t)=>{const{length:a}=e=e?e.filter(Boolean):[];if(t||a){let a,n=new AbortController;const i=function(e){if(!a){a=!0,o();const t=e instanceof Error?e:this.reason;n.abort(t instanceof Ge?t:new St(t instanceof Error?t.message:t))}};let s=t&&setTimeout(()=>{s=null,i(new Ge(`timeout ${t} of ms exceeded`,Ge.ETIMEDOUT))},t);const o=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)}),e=null)};e.forEach(e=>e.addEventListener("abort",i));const{signal:r}=n;return r.unsubscribe=()=>He.asap(o),r}},Ut=function*(e,t){let a=e.byteLength;if(a<t)return void(yield e);let n,i=0;for(;i<a;)n=i+t,yield e.slice(i,n),i=n},Bt=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:a}=await t.read();if(e)break;yield a}}finally{await t.cancel()}},qt=(e,t,a,n)=>{const i=async function*(e,t){for await(const a of Bt(e))yield*Ut(a,t)}(e,t);let s,o=0,r=e=>{s||(s=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await i.next();if(t)return r(),void e.close();let s=n.byteLength;if(a){let e=o+=s;a(e)}e.enqueue(new Uint8Array(n))}catch(t){throw r(t),t}},cancel:e=>(r(e),i.return())},{highWaterMark:2})},jt="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,$t=jt&&"function"==typeof ReadableStream,zt=jt&&("function"==typeof TextEncoder?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),Vt=(e,...t)=>{try{return!!e(...t)}catch(a){return!1}},Wt=$t&&Vt(()=>{let e=!1;const t=new Request(mt.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),Ht=$t&&Vt(()=>He.isReadableStream(new Response("").body)),Gt={stream:Ht&&(e=>e.body)};var Yt;jt&&(Yt=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Gt[e]&&(Gt[e]=He.isFunction(Yt[e])?t=>t[e]():(t,a)=>{throw new Ge(`Response type '${e}' is not supported`,Ge.ERR_NOT_SUPPORT,a)})}));const Kt=async(e,t)=>{const a=He.toFiniteNumber(e.getContentLength());return null==a?(async e=>{if(null==e)return 0;if(He.isBlob(e))return e.size;if(He.isSpecCompliantForm(e)){const t=new Request(mt.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return He.isArrayBufferView(e)||He.isArrayBuffer(e)?e.byteLength:(He.isURLSearchParams(e)&&(e+=""),He.isString(e)?(await zt(e)).byteLength:void 0)})(t):a},Qt={http:null,xhr:Ot,fetch:jt&&(async e=>{let{url:t,method:a,data:n,signal:i,cancelToken:s,timeout:o,onDownloadProgress:r,onUploadProgress:l,responseType:c,headers:d,withCredentials:u="same-origin",fetchOptions:h}=Lt(e);c=c?(c+"").toLowerCase():"text";let p,m=Ft([i,s&&s.toAbortSignal()],o);const f=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let g;try{if(l&&Wt&&"get"!==a&&"head"!==a&&0!==(g=await Kt(d,n))){let e,a=new Request(t,{method:"POST",body:n,duplex:"half"});if(He.isFormData(n)&&(e=a.headers.get("content-type"))&&d.setContentType(e),a.body){const[e,t]=Nt(g,It(xt(l)));n=qt(a.body,65536,e,t)}}He.isString(u)||(u=u?"include":"omit");const i="credentials"in Request.prototype;p=new Request(t,{...h,signal:m,method:a.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:i?u:void 0});let s=await fetch(p);const o=Ht&&("stream"===c||"response"===c);if(Ht&&(r||o&&f)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=s[t]});const t=He.toFiniteNumber(s.headers.get("content-length")),[a,n]=r&&Nt(t,It(xt(r),!0))||[];s=new Response(qt(s.body,65536,a,()=>{n&&n(),f&&f()}),e)}c=c||"text";let v=await Gt[He.findKey(Gt,c)||"text"](s,e);return!o&&f&&f(),await new Promise((t,a)=>{Tt(t,a,{data:v,headers:Ct.from(s.headers),status:s.status,statusText:s.statusText,config:e,request:p})})}catch(v){if(f&&f(),v&&"TypeError"===v.name&&/Load failed|fetch/i.test(v.message))throw Object.assign(new Ge("Network Error",Ge.ERR_NETWORK,e,p),{cause:v.cause||v});throw Ge.from(v,v&&v.code,e,p)}})};He.forEach(Qt,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(a){}Object.defineProperty(e,"adapterName",{value:t})}});const Jt=e=>`- ${e}`,Zt=e=>He.isFunction(e)||null===e||!1===e,Xt=e=>{e=He.isArray(e)?e:[e];const{length:t}=e;let a,n;const i={};for(let s=0;s<t;s++){let t;if(a=e[s],n=a,!Zt(a)&&(n=Qt[(t=String(a)).toLowerCase()],void 0===n))throw new Ge(`Unknown adapter '${t}'`);if(n)break;i[t||"#"+s]=n}if(!n){const e=Object.entries(i).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new Ge("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(Jt).join("\n"):" "+Jt(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n};function ea(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new St(null,e)}function ta(e){ea(e),e.headers=Ct.from(e.headers),e.data=kt.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Xt(e.adapter||gt.adapter)(e).then(function(t){return ea(e),t.data=kt.call(e,e.transformResponse,t),t.headers=Ct.from(t.headers),t},function(t){return Et(t)||(ea(e),t&&t.response&&(t.response.data=kt.call(e,e.transformResponse,t.response),t.response.headers=Ct.from(t.response.headers))),Promise.reject(t)})}const aa="1.9.0",na={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{na[e]=function(a){return typeof a===e||"a"+(t<1?"n ":" ")+e}});const ia={};na.transitional=function(e,t,a){function n(e,t){return"[Axios v1.9.0] Transitional option '"+e+"'"+t+(a?". "+a:"")}return(a,i,s)=>{if(!1===e)throw new Ge(n(i," has been removed"+(t?" in "+t:"")),Ge.ERR_DEPRECATED);return t&&!ia[i]&&(ia[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(a,i,s)}},na.spelling=function(e){return(t,a)=>(console.warn(`${a} is likely a misspelling of ${e}`),!0)};const sa={assertOptions:function(e,t,a){if("object"!=typeof e)throw new Ge("options must be an object",Ge.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let i=n.length;for(;i-- >0;){const s=n[i],o=t[s];if(o){const t=e[s],a=void 0===t||o(t,s,e);if(!0!==a)throw new Ge("option "+s+" must be "+a,Ge.ERR_BAD_OPTION_VALUE);continue}if(!0!==a)throw new Ge("Unknown option "+s,Ge.ERR_BAD_OPTION)}},validators:na},oa=sa.validators;let ra=class{constructor(e){this.defaults=e||{},this.interceptors={request:new ot,response:new ot}}async request(e,t){try{return await this._request(e,t)}catch(a){if(a instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{a.stack?t&&!String(a.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(a.stack+="\n"+t):a.stack=t}catch(n){}}throw a}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Mt(this.defaults,t);const{transitional:a,paramsSerializer:n,headers:i}=t;void 0!==a&&sa.assertOptions(a,{silentJSONParsing:oa.transitional(oa.boolean),forcedJSONParsing:oa.transitional(oa.boolean),clarifyTimeoutError:oa.transitional(oa.boolean)},!1),null!=n&&(He.isFunction(n)?t.paramsSerializer={serialize:n}:sa.assertOptions(n,{encode:oa.function,serialize:oa.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),sa.assertOptions(t,{baseUrl:oa.spelling("baseURL"),withXsrfToken:oa.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&He.merge(i.common,i[t.method]);i&&He.forEach(["delete","get","head","post","put","patch","common"],e=>{delete i[e]}),t.headers=Ct.concat(s,i);const o=[];let r=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(r=r&&e.synchronous,o.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let d,u=0;if(!r){const e=[ta.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,l),d=e.length,c=Promise.resolve(t);u<d;)c=c.then(e[u++],e[u++]);return c}d=o.length;let h=t;for(u=0;u<d;){const e=o[u++],t=o[u++];try{h=e(h)}catch(p){t.call(this,p);break}}try{c=ta.call(this,h)}catch(p){return Promise.reject(p)}for(u=0,d=l.length;u<d;)c=c.then(l[u++],l[u++]);return c}getUri(e){return st(Rt((e=Mt(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};He.forEach(["delete","get","head","options"],function(e){ra.prototype[e]=function(t,a){return this.request(Mt(a||{},{method:e,url:t,data:(a||{}).data}))}}),He.forEach(["post","put","patch"],function(e){function t(t){return function(a,n,i){return this.request(Mt(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:a,data:n}))}}ra.prototype[e]=t(),ra.prototype[e+"Form"]=t(!0)});const la={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(la).forEach(([e,t])=>{la[t]=e});const ca=function e(t){const a=new ra(t),n=se(ra.prototype.request,a);return He.extend(n,ra.prototype,a,{allOwnKeys:!0}),He.extend(n,a,null,{allOwnKeys:!0}),n.create=function(a){return e(Mt(t,a))},n}(gt);ca.Axios=ra,ca.CanceledError=St,ca.CancelToken=class e{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const a=this;this.promise.then(e=>{if(!a._listeners)return;let t=a._listeners.length;for(;t-- >0;)a._listeners[t](e);a._listeners=null}),this.promise.then=e=>{let t;const n=new Promise(e=>{a.subscribe(e),t=e}).then(e);return n.cancel=function(){a.unsubscribe(t)},n},e(function(e,n,i){a.reason||(a.reason=new St(e,n,i),t(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;return{token:new e(function(e){t=e}),cancel:t}}},ca.isCancel=Et,ca.VERSION=aa,ca.toFormData=et,ca.AxiosError=Ge,ca.Cancel=ca.CanceledError,ca.all=function(e){return Promise.all(e)},ca.spread=function(e){return function(t){return e.apply(null,t)}},ca.isAxiosError=function(e){return He.isObject(e)&&!0===e.isAxiosError},ca.mergeConfig=Mt,ca.AxiosHeaders=Ct,ca.formToJSON=e=>ft(He.isHTMLForm(e)?new FormData(e):e),ca.getAdapter=Xt,ca.HttpStatusCode=la,ca.default=ca;const{Axios:da,AxiosError:ua,CanceledError:ha,isCancel:pa,CancelToken:ma,VERSION:fa,all:ga,Cancel:va,isAxiosError:ba,spread:wa,toFormData:ya,AxiosHeaders:_a,HttpStatusCode:Ca,formToJSON:ka,getAdapter:Ea,mergeConfig:Sa}=ca,Ta=ca.create({baseURL:"https://mozoqr.com/api",headers:{"Content-Type":"application/json",Accept:"application/json"}});Ta.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),Ta.interceptors.response.use(e=>{try{const t=e.data;if(t){const e=t.token||t.access_token||t.plainTextToken||t.user&&t.user.token||t.user&&t.user.access_token;e&&localStorage.setItem("token",e)}}catch(t){}return e},e=>(e.response&&401===e.response.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),e.message=(e=>{if(e.response){const t=e.response.data;if(t){if("string"==typeof t)return t;if(t.message)return t.message;if(t.error)return t.error}return`Error ${e.response.status}: ${e.response.statusText||"Error en la respuesta del servidor"}`}return e.request?"No se recibió respuesta del servidor. Verifique su conexión.":e.message||"Ocurrió un error desconocido."})(e),Promise.reject(e)));const Ia={login:e=>Ta.post("login",e),loginWithGoogle:e=>Ta.post("login/google",{token:e}),forgotPassword:e=>Ta.post("forgot-password",e),resetPassword:e=>Ta.post("reset-password",e),callWaiter:e=>Ta.post(`tables/${e}/call-waiter`),register:e=>Ta.post("register",e),getCurrentUser:()=>Ta.get("user"),logout:()=>Ta.post("logout"),selectRole:e=>Ta.post("role/select",{role:e}),updateProfile:e=>Ta.post("profile/update",e,{headers:{"Content-Type":"multipart/form-data"}}),sendWhatsAppMessage:e=>Ta.post("profile/whatsapp/send",e),getNotifications:()=>Ta.get("notifications"),handleNotification:(e,t)=>Ta.post(`notifications/handle/${e}`,t),globalNotifications:e=>Ta.post("notifications/global",e),storeDeviceToken:e=>Ta.post("device-token",e),deleteDeviceToken:e=>Ta.delete("device-token",{data:e}),toggleTableNotifications:e=>Ta.post(`tables/toggle-notifications/${e}`),waiterOnboard:e=>Ta.post("waiter/onboard",{code:e}),getWaiterTables:()=>Ta.get("waiter/tables"),listWaiterProfiles:()=>Ta.get("waiter/profiles"),createWaiterProfile:e=>Ta.post("waiter/profiles",e),deleteWaiterProfile:e=>Ta.delete(`waiter/profiles/${e}`),getWaiterNotifications:()=>Ta.get("waiter/notifications"),handleWaiterNotification:(e,t)=>Ta.post(`waiter/notifications/handle/${e}`,t),waiterGlobalNotifications:e=>Ta.post("waiter/notifications/global",e),waiterToggleTableNotifications:e=>Ta.post(`waiter/tables/toggle-notifications/${e}`),getBusinessInfo:()=>Ta.get("admin/business"),switchView:e=>Ta.post("admin/switch-view",e),removeStaff:e=>Ta.delete(`admin/staff/${e}`),handleStaffRequest:(e,t)=>Ta.post(`admin/staff/request/${e}`,t),getStaffRequests:()=>Ta.get("admin/staff/requests"),getArchivedStaffRequests:()=>Ta.get("admin/staff/requests/archived"),getTables:()=>Ta.get("tables"),createTable:e=>Ta.post("tables",e),updateTable:(e,t)=>Ta.put(`tables/${e}`,t),deleteTable:e=>Ta.delete(`tables/${e}`),getMenus:()=>Ta.get("menus"),uploadMenu:e=>Ta.post("menus",e,{headers:{"Content-Type":"multipart/form-data"}}),setDefaultMenu:e=>Ta.post("menus/default",e),generateQRCode:e=>{const t="https://mozoqr.com";return console.log("🔍 Generating QR with base URL:",t),console.log("📋 Environment vars:",{VITE_QR_BASE_URL:"https://mozoqr.com",VITE_URL_API:"https://mozoqr.com/api/",window_origin:window.location.origin}),Ta.post(`admin/qr/generate/${e}`,{base_url:t})},exportQR:e=>Ta.post("admin/qr/export",e),getSettings:()=>Ta.get("admin/settings"),updateSettings:e=>Ta.post("admin/settings",e),deleteMenu:e=>Ta.delete(`menus/${e}`),renameMenu:(e,t)=>Ta.put(`menus/${e}`,t),reorderMenus:e=>Ta.post("menus/reorder",{menu_order:e}),previewMenu:e=>Ta.get(`menus/${e}/preview`,{responseType:"blob"}),cloneTable:(e,t)=>Ta.post(`tables/clone/${e}`,t),getStaff:(e=1)=>Ta.get(`admin/staff?page=${e}`),getStaffMember:e=>Ta.get(`admin/staff/${e}`),updateStaffMember:(e,t)=>t instanceof FormData?Ta.post(`admin/staff/${e}?_method=PUT`,t,{headers:{"Content-Type":"multipart/form-data"}}):Ta.put(`admin/staff/${e}`,t),inviteStaff:e=>Ta.post("admin/staff/invite",e),addReview:(e,t)=>Ta.post(`admin/staff/${e}/reviews`,t),deleteReview:(e,t)=>Ta.delete(`admin/staff/${e}/reviews/${t}`),changePassword:e=>Ta.post("change-password",e),deleteAccount:e=>Ta.delete("delete-account",{data:e}),getAdminStatistics:()=>Ta.get("admin/statistics"),sendQrEmail:e=>Ta.post("admin/qr/email",e),getAdminNotifications:()=>Ta.get("admin/notifications"),listWorkHistory:()=>Ta.get("profile/work-history"),addWorkHistory:e=>Ta.post("profile/work-history",e),updateWorkHistory:(e,t)=>Ta.put(`profile/work-history/${e}`,t),deleteWorkHistory:e=>Ta.delete(`profile/work-history/${e}`),getAdminTables:()=>Ta.get("admin/tables"),getAdminTableDetails:e=>Ta.get(`admin/tables/${e}`),updateAdminTable:(e,t)=>Ta.put(`admin/tables/${e}`,t),deleteAdminTable:e=>Ta.delete(`admin/tables/${e}`),getAdminStaff:()=>Ta.get("admin/staff"),getAdminStaffDetails:e=>Ta.get(`admin/staff/${e}`),createAdminStaff:e=>Ta.post("admin/staff",e),updateAdminStaff:(e,t)=>Ta.post(`admin/staff/${e}`,t),deleteAdminStaff:e=>Ta.delete(`admin/staff/${e}`),getAdminMenus:()=>Ta.get("admin/menus"),getAdminMenuDetails:e=>Ta.get(`admin/menus/${e}`),createAdminMenu:e=>Ta.post("admin/menus",e),updateAdminMenu:(e,t)=>Ta.post(`admin/menus/update/${e}`,t),deleteAdminMenu:e=>Ta.delete(`admin/menus/${e}`),getAdminRequests:()=>Ta.get("admin/requests"),sendNotificationToAll:e=>Ta.post("admin/notifications/send-to-all",e),sendNotificationToUser:e=>Ta.post("admin/notifications/send-to-user",e),sendNotificationToDevice:e=>Ta.post("admin/notifications/send-to-device",e),sendNotificationToTopic:e=>Ta.post("admin/notifications/send-to-topic",e),subscribeToTopic:e=>Ta.post("admin/notifications/subscribe-to-topic",e),unsubscribeFromTopic:e=>Ta.post("admin/notifications/unsubscribe-from-topic",e),storeDeviceToken:e=>Ta.post("device-token",e),getDeviceTokens:e=>Ta.get(`device-tokens/${e}`),deleteDeviceToken:e=>Ta.delete(`device-token/${e}`),sendPushToUser:e=>Ta.post("admin/notifications/send-to-user",e),healthCheck:()=>Ta.get("health-check"),getFirebaseConfig:()=>Ta.get("firebase/config"),registerWaiterFcm:e=>Ta.post("waiter/fcm/register",e),refreshWaiterFcm:e=>Ta.post("waiter/fcm/refresh",e),deleteWaiterFcmToken:e=>Ta.delete("waiter/fcm/token",{data:e}),testWaiterFcm:e=>Ta.post("waiter/fcm/test",e),getPendingCalls:()=>Ta.get("waiter/calls/pending"),acknowledgeCall:e=>Ta.post(`waiter/calls/${e}/acknowledge`),completeCall:e=>Ta.post(`waiter/calls/${e}/complete`),getWaiterCallHistory:(e={})=>Ta.get("waiter/calls/history",{params:e}),getAdminCallHistory:(e={})=>Ta.get("admin/calls/history",{params:e}),activateTable:e=>Ta.post(`waiter/tables/${e}/activate`),deactivateTable:e=>Ta.delete(`waiter/tables/${e}/activate`),activateMultipleTables:e=>Ta.post("waiter/tables/activate/multiple",e),deactivateMultipleTables:e=>Ta.post("waiter/tables/deactivate/multiple",e),silenceTable:(e,t)=>Ta.post(`waiter/tables/${e}/silence`,t),unsilenceTable:e=>Ta.delete(`waiter/tables/${e}/silence`),silenceMultipleTables:e=>Ta.post("waiter/tables/silence/multiple",e),unsilenceMultipleTables:e=>Ta.post("waiter/tables/unsilence/multiple",e),getSilencedTables:()=>Ta.get("waiter/tables/silenced"),getAssignedTables:()=>Ta.get("waiter/tables/assigned"),getAvailableTables:()=>Ta.get("waiter/tables/available"),getAdminSilencedTables:()=>Ta.get("admin/tables/silenced"),adminUnsilenceTable:e=>Ta.delete(`admin/tables/${e}/silence`),getWaiterTableProfiles:()=>Ta.get("waiter/table-profiles"),getWaiterTableProfile:e=>Ta.get(`waiter/table-profiles/${e}`),createWaiterTableProfile:e=>Ta.post("waiter/table-profiles",e),updateWaiterTableProfile:(e,t)=>Ta.put(`waiter/table-profiles/${e}`,t),deleteWaiterTableProfile:e=>Ta.delete(`waiter/table-profiles/${e}`),activateWaiterTableProfile:e=>Ta.post(`waiter/table-profiles/${e}/activate`),deactivateWaiterTableProfile:e=>Ta.post(`waiter/table-profiles/${e}/deactivate`),getWaiterTableProfileNotifications:()=>Ta.get("waiter/table-profiles/notifications"),getWaiterDashboard:()=>Ta.get("waiter/dashboard"),getWaiterTableStatus:()=>Ta.get("waiter/tables/status"),getWaiterBusinesses:()=>Ta.get("waiter/businesses"),setActiveWaiterBusiness:e=>Ta.post("waiter/set-active-business",{business_id:e}),getActiveWaiterBusiness:()=>Ta.get("waiter/businesses/active"),getWaiterBusinessTables:e=>Ta.get(`waiter/businesses/${e}/tables`),joinBusinessWithCode:e=>Ta.post("waiter/join-business",{business_code:e}),leaveWaiterBusiness:e=>Ta.delete(`waiter/businesses/${e}/leave`)},Na={async getNotifications(){try{return(await Ia.getNotifications()).data}catch(e){throw console.error("Error obteniendo notificaciones:",e),e}},async handleNotification(e,t){try{return(await Ia.handleNotification(e,{action:t})).data}catch(a){throw console.error("Error manejando notificación:",a),a}},async globalNotifications(e){try{return(await Ia.globalNotifications({enabled:e})).data}catch(t){throw console.error("Error configurando notificaciones globales:",t),t}},async getWaiterNotifications(){try{return(await Ia.getWaiterNotifications()).data}catch(e){throw console.error("Error obteniendo notificaciones de mozo:",e),e}},async handleWaiterNotification(e,t){try{return(await Ia.handleWaiterNotification(e,{action:t})).data}catch(a){throw console.error("Error manejando notificación de mozo:",a),a}},async waiterGlobalNotifications(e){try{return(await Ia.waiterGlobalNotifications({enabled:e})).data}catch(t){throw console.error("Error configurando notificaciones globales de mozo:",t),t}},async waiterToggleTableNotifications(e){try{return(await Ia.waiterToggleTableNotifications(e)).data}catch(t){throw console.error("Error alternando notificaciones de mesa para mozo:",t),t}},async getAdminNotifications(){try{return(await Ia.getAdminNotifications()).data}catch(e){throw console.error("Error obteniendo notificaciones de administrador:",e),e}},async storeDeviceToken(e,t="web",a=null){try{const n={token:e,platform:t};a&&(n.user_id=a);return(await Ia.storeDeviceToken(n)).data}catch(n){throw console.error("Error guardando token de dispositivo:",n),n}},async deleteDeviceToken(e){try{return(await Ia.deleteDeviceToken(e)).data}catch(t){throw console.error("Error eliminando token de dispositivo:",t),t}},async getDeviceTokens(e){try{return(await Ia.getDeviceTokens(e)).data}catch(t){throw console.error("Error obteniendo tokens de dispositivo:",t),t}},async sendNotificationToAll(e,t,a=null){try{const n={title:e,body:t};a&&(n.data=a);return(await Ia.sendNotificationToAll(n)).data}catch(n){throw console.error("Error enviando notificación a todos:",n),n}},async sendNotificationToUser(e,t,a,n=null){try{const i={user_id:e,title:t,body:a};n&&(i.data=n);return(await Ia.sendNotificationToUser(i)).data}catch(i){throw console.error("Error enviando notificación a usuario:",i),i}},async sendNotificationToDevice(e,t,a,n=null){try{const i={token:e,title:t,body:a};n&&(i.data=n);return(await Ia.sendNotificationToDevice(i)).data}catch(i){throw console.error("Error enviando notificación a dispositivo:",i),i}},async sendNotificationToTopic(e,t,a,n=null){try{const i={topic:e,title:t,body:a};n&&(i.data=n);return(await Ia.sendNotificationToTopic(i)).data}catch(i){throw console.error("Error enviando notificación a topic:",i),i}},async subscribeToTopic(e,t){try{const a={tokens:Array.isArray(e)?e:[e],topic:t};return(await Ia.subscribeToTopic(a)).data}catch(a){throw console.error("Error suscribiendo a topic:",a),a}},async unsubscribeFromTopic(e,t){try{const a={tokens:Array.isArray(e)?e:[e],topic:t};return(await Ia.unsubscribeFromTopic(a)).data}catch(a){throw console.error("Error desuscribiendo de topic:",a),a}},async toggleTableNotifications(e){try{return(await Ia.toggleTableNotifications(e)).data}catch(t){throw console.error("Error alternando notificaciones de mesa:",t),t}},async callWaiter(e){try{return(await Ia.callWaiter(e)).data}catch(t){throw console.error("Error llamando al camarero:",t),t}},async markAllAsRead(e){try{const t=e.map(e=>this.handleNotification(e.id,"mark_as_read"));return await Promise.all(t)}catch(t){throw console.error("Error marcando todas como leídas:",t),t}},async deleteAllRead(e){try{const t=e.map(e=>this.handleNotification(e.id,"delete"));return await Promise.all(t)}catch(t){throw console.error("Error eliminando todas las leídas:",t),t}},async getNotificationsByRole(e){try{switch(e){case"waiter":return await this.getWaiterNotifications();case"admin":return await this.getAdminNotifications();default:return await this.getNotifications()}}catch(t){throw console.error("Error obteniendo notificaciones por rol:",t),t}},async healthCheck(){try{return await Ia.healthCheck()}catch(e){throw console.error("Error en el health check de la API:",e),e}},async testWebSocketConnection(){try{if(!localStorage.getItem("token"))throw new Error("No hay token de autenticación");const e=localStorage.getItem("user"),{initializeEcho:t}=(e&&JSON.parse(e),await z(async()=>{const{initializeEcho:e}=await import("./echo-CW7OwuwS.js");return{initializeEcho:e}},__vite__mapDeps([3,1,2]))),a=t();if(!a)throw new Error("No se pudo inicializar Echo");if(!a.connector||!a.connector.pusher)throw new Error("Pusher no está disponible en Echo");return await new Promise((e,t)=>{const n=setTimeout(()=>{t(new Error("Timeout en la conexión WebSocket (5 segundos)"))},5e3);a.connector.pusher.connection.bind("connected",()=>{clearTimeout(n),e()}),a.connector.pusher.connection.bind("error",e=>{clearTimeout(n),console.error("🔍 Error en WebSocket:",e),t(new Error(`Error de conexión: ${e.message||"Error desconocido"}`))}),a.connector.pusher.connection.bind("disconnected",()=>{}),a.connector.pusher.connection.bind("connecting",()=>{})}),{success:!0,message:"Conexión WebSocket exitosa"}}catch(e){throw console.error("🔍 Error en testWebSocketConnection:",e),console.error("🔍 Stack trace:",e.stack),e}}},xa={apiKey:"AIzaSyBlupKSIy7qtTsXukqROyVjMNx03X8CCzU",authDomain:"mozoqr-7d32c.firebaseapp.com",projectId:"mozoqr-7d32c",storageBucket:"mozoqr-7d32c.firebasestorage.app",databaseURL:"https://mozoqr-7d32c-default-rtdb.firebaseio.com",messagingSenderId:"175482362472",appId:"1:175482362472:web:308070c885bacc71b6b9dd",measurementId:"G-6N7J4X94DH"};let Aa=null,Pa=null,Ra=null;const Da=async()=>{try{if("undefined"==typeof window)return console.log("🔥 Firebase: Not supported in non-browser environment"),null;const t=Object.entries(xa).filter(([e,t])=>!t).map(([e,t])=>e);if(t.length>0)return console.error("🔥 Firebase: Incomplete configuration. Missing keys:",t),null;if(console.log("🔥 Initializing Firebase..."),xa.databaseURL||console.warn("⚠️ Falta VITE_FIREBASE_DATABASE_URL (Realtime Database). Añade la URL si usas RTDB para reconciliación."),xa.appId&&/:android:/.test(xa.appId)&&console.warn("⚠️ appId es Android. Si estás en Web, define VITE_FIREBASE_APP_ID con el appId Web (contiene :web:)."),"serviceWorker"in navigator)try{await navigator.serviceWorker.register("/firebase-messaging-sw.js");console.log("🔥 Service Worker registered successfully")}catch(e){console.error("🔥 Service Worker registration failed:",e)}const{initializeApp:a}=await z(async()=>{const{initializeApp:e}=await import("./index.esm-DpHw5pYd.js");return{initializeApp:e}},__vite__mapDeps([4,1,2])),{getMessaging:n,isSupported:i}=await z(async()=>{const{getMessaging:e,isSupported:t}=await import("./index.esm-CGUsxFyW.js");return{getMessaging:e,isSupported:t}},__vite__mapDeps([5,1,2])),{getFirestore:s}=await z(async()=>{const{getFirestore:e}=await import("./index.esm-Bh6acWP0.js");return{getFirestore:e}},__vite__mapDeps([6,1,2]));return await i()?(Aa=a(xa),console.log("🔥 Firebase App initialized appId=",xa.appId,"projectId=",xa.projectId),Pa=n(Aa),console.log("🔥 Firebase Messaging initialized"),Ra=s(Aa),console.log("🔥 Firestore initialized"),{app:Aa,messaging:Pa,db:Ra}):(console.log("🔥 Firebase Messaging not supported in this browser"),null)}catch(e){return console.error("🔥 Firebase initialization error:",e),null}},Ma=async()=>{try{if(!Pa){if(!(await Da()))throw new Error("Firebase initialization failed")}const{getToken:e}=await z(async()=>{const{getToken:e}=await import("./index.esm-CGUsxFyW.js");return{getToken:e}},__vite__mapDeps([5,1,2]));if("undefined"==typeof Notification)console.warn("🔥 Notification API no disponible en este entorno (probablemente WebView). Saltando solicitud de permisos.");else{let e=Notification.permission;if(console.log("🔥 Current notification permission:",e),"default"===e&&(console.log("🔥 Requesting notification permissions..."),e=await Notification.requestPermission(),console.log("🔥 Permission after request:",e)),"denied"===e)throw console.error("🔥 Notification permissions DENIED by user"),console.error('🔥 SOLUTION: Click the 🔒 in the address bar and change Notifications to "Allow"'),new Error('Notification permissions denied. Click the 🔒 in the address bar and change Notifications to "Allow", then reload the page.');if("granted"!==e)throw new Error("Notification permissions not granted");console.log("✅ Notification permissions granted")}console.log("🔥 Getting FCM token...");const t="BNJgpNkgB0a0y7gHT-SNBFLMGIZw-Xx8NTBDCn_4dVqekzgmnGmKMIn10t-6gWl3Qj_msyCcfbsVycnAp8USs6M",a={};t&&(console.log("🔥 Using VAPID key:",t.substring(0,10)+"..."),a.vapidKey=t);const n=await e(Pa,a);if(!n)throw new Error("Failed to obtain FCM token");return console.log("🔥 FCM token obtained (length="+n.length+"):",n.substring(0,25)+"..."),localStorage.setItem("fcm_token",n),n}catch(e){throw console.error("🔥 FCM token error:",e),e}},La=async e=>{try{if(!Pa){if(!(await Da()))return}const{onMessage:t}=await z(async()=>{const{onMessage:e}=await import("./index.esm-CGUsxFyW.js");return{onMessage:e}},__vite__mapDeps([5,1,2]));console.log("🔥 Setting up foreground message listener..."),t(Pa,t=>{console.log("🔥🚨 FCM MESSAGE RECEIVED (Firebase onMessage):",t),console.log("🔥📱 Detailed payload:",{notification:t.notification,data:t.data,from:t.from,messageId:t.messageId}),console.log("🔥⏰ Timestamp:",(new Date).toLocaleTimeString());const a=Oa(t);if(e&&"function"==typeof e)try{e(a)}catch(n){console.error("🔥❌ Error in onMessage callback:",n)}try{z(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>tr);return{useNotificationsStore:e}},void 0).then(({useNotificationsStore:e})=>{var t;const n=e(),i={id:`fcm-${Date.now()}`,type:(null==(t=a.data)?void 0:t.type)||"FCMNotification",data:{title:a.title,message:a.body,...a.data},created_at:(new Date).toISOString(),read_at:null,source:"firebase-foreground"};console.log("🔥📨 Adding FCM notification to store:",i),n.addNewNotification(i)})}catch(n){console.error("🔥❌ Error adding FCM notification to store:",n)}"granted"===Notification.permission&&Fa(a)}),console.log("🔥 Foreground message listener configured")}catch(t){console.error("🔥 Error setting up message listener:",t)}},Oa=e=>{var t,a,n;console.log("🔄 Processing notification payload...");let i={title:(null==(t=e.notification)?void 0:t.title)||"Nueva notificación",body:(null==(a=e.notification)?void 0:a.body)||"Tienes una nueva notificación",data:e.data||{}};if(null==(n=e.data)?void 0:n.type){const t=e.data.type;switch(console.log("🔄 Notification type:",t),t){case"TestNotification":i={title:"🧪 Test Notification",body:"This is a test notification sent to all business users",data:{...e.data,icon:"🧪",priority:"normal",channels:["Database","Broadcast","FCM"]}};break;case"UserSpecificNotification":i={title:e.data.title||"👤 Personalized Notification",body:e.data.message||"You have a new personalized notification",data:{...e.data,icon:"👤",priority:"high",channels:["Database","Broadcast","FCM"]}};break;case"WebSocketTestNotification":i={title:"⚡ WebSocket + FCM Test",body:"This notification arrives via WebSocket (real-time) and FCM (push)",data:{...e.data,icon:"⚡",priority:"high",test_mode:"websocket_fcm"}};break;case"WebSocketOnlyNotification":i={title:"🔌 WebSocket Only Test",body:"This notification ONLY arrives via WebSocket in real-time",data:{...e.data,icon:"🔌",priority:"normal",test_mode:"websocket_only"}};break;default:e.notification&&(i={title:e.notification.title,body:e.notification.body,data:{...e.data,icon:"📱",priority:"normal"}})}}return console.log("✅ Notification processed:",i),i},Fa=e=>{try{const{title:t,body:a,data:n}=e;if(t||a){const e=new Notification(t||"Nueva notificación",{body:a||"Tienes una nueva notificación",icon:"/favicon.ico",tag:`fcm-notification-${Date.now()}`,data:n,requireInteraction:!0});console.log("🔥🔔 Browser notification displayed:",e)}}catch(t){console.error("🔥❌ Error showing browser notification:",t)}},Ua=async()=>{try{if(!Pa)return void console.log("🔥 Firebase Messaging not initialized");const{deleteToken:e}=await z(async()=>{const{deleteToken:e}=await import("./index.esm-CGUsxFyW.js");return{deleteToken:e}},__vite__mapDeps([5,1,2]));await e(Pa),localStorage.removeItem("fcm_token"),console.log("🔥 FCM token deleted successfully")}catch(e){throw console.error("🔥 FCM token deletion error:",e),e}},Ba=()=>Ra||(console.error("🔥 Firestore not initialized. Call initializeFirebase() first."),null),qa=()=>{const e={configured:!1,initialized:!1,messagingAvailable:!1,firestoreAvailable:!1,tokenExists:!1,notificationPermission:"undefined"!=typeof Notification?Notification.permission:"unavailable"};try{const t=Object.entries(xa).filter(([e,t])=>!t).map(([e,t])=>e);return e.configured=0===t.length,e.initialized=!!Aa&&!!Pa&&!!Ra,e.messagingAvailable=!!Pa,e.firestoreAvailable=!!Ra,e.tokenExists=!!localStorage.getItem("fcm_token"),"Notification"in window&&(e.notificationPermission=Notification.permission),e}catch(t){return console.error("🔥 Error getting Firebase status:",t),e}},ja={initializeFirebase:Da,getFCMToken:Ma,setupForegroundMessageListener:La,deleteFCMToken:Ua,getFirestore:Ba,getFirebaseStatus:qa,config:xa},$a=Object.freeze(Object.defineProperty({__proto__:null,default:ja,deleteFCMToken:Ua,getFCMToken:Ma,getFirebaseStatus:qa,getFirestore:Ba,initializeFirebase:Da,setupForegroundMessageListener:La},Symbol.toStringTag,{value:"Module"})),za=()=>{try{const e=Y.getPlatform();return"android"===e?"android":"ios"===e?"ios":"web"}catch(e){return"web"}};async function Va(){try{if(!(await ja.initializeFirebase()))return null;return await ja.getFCMToken()}catch(e){return console.warn("notificationClient: no se pudo obtener FCM token:",(null==e?void 0:e.message)||e),null}}async function Wa(e={},t={}){const a=t.platformOverride||za();let n=null;try{n=await Va()}catch(o){}const i={...e};n&&(i.fcm_token=n,i.platform=a);const s=await Ia.login(i);if(!n)try{const e=await Va();e&&await async function(e,t=null){try{const a=t||za();return await Na.storeDeviceToken(e,a),localStorage.setItem("fcm_token",e),!0}catch(a){return console.warn("notificationClient: error registrando token despues de login:",(null==a?void 0:a.message)||a),!1}}(e,a)}catch(o){}return s}const Ha=e=>{try{return"object"==typeof e&&null!==e&&"value"in e?n(e):e}catch(t){return console.warn("Error accessing reactive value:",t),null}},Ga=e=>{try{const t=Ha(e);return t?String(t):""}catch(t){return console.warn("Error converting token to string:",t),""}},Ya=e("auth",()=>{const e=t(null),n=t(localStorage.getItem("token")||null),i=t(!1),s=t(!!Ga(n)),o=t(!1),r=t(null),l=t(null),c=localStorage.getItem("user");if(c)try{const t=JSON.parse(c);t.selectedRole&&(l.value=t.selectedRole,t.role=t.selectedRole),e.value=t}catch(h){console.error("AuthStore - Error al parsear usuario de localStorage:",h)}const d=a(()=>{var t;return l.value||(null==(t=e.value)?void 0:t.role)||null}),u=async()=>{try{await async function(){try{const t=localStorage.getItem("fcm_token");if(t){try{await Na.deleteDeviceToken({token:t})}catch(h){try{await Ia.delete("device-token",{data:{token:t}})}catch(e){console.warn("notificationClient: fallback delete failed",e)}}localStorage.removeItem("fcm_token")}try{await Ia.logout()}catch(e){}return localStorage.removeItem("token"),localStorage.removeItem("user"),!0}catch(r){return console.warn("notificationClient: error en logoutAndUnregister",r),!1}}()}catch(t){console.warn("AuthStore - Error en logoutAndUnregister:",t)}e.value=null,n.value=null,s.value=!1,l.value=null,localStorage.removeItem("token"),localStorage.removeItem("userRole"),localStorage.removeItem("user"),localStorage.removeItem("fcm_token");try{const{deleteFCMToken:e}=await z(async()=>{const{deleteFCMToken:e}=await Promise.resolve().then(()=>$a);return{deleteFCMToken:e}},void 0);await e()}catch(t){console.warn("Error eliminando token FCM:",t)}try{const{useNotificationsStore:e}=await z(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>tr);return{useNotificationsStore:e}},void 0);e().disconnectRealTimeNotifications()}catch(t){console.warn("Error desconectando Firestore listeners:",t)}return!0};return{user:e,token:n,isAuthenticated:s,initialized:i,isLoading:o,error:r,selectedRole:l,currentRole:d,login:async t=>{var a;o.value=!0,r.value=null;try{const o=(await Wa(t)).data||{},r=o.token||o.access_token||o.plainTextToken;e.value=o.user,n.value=r||null,s.value=!0,l.value=(null==(a=o.user)?void 0:a.selectedRole)||null;const d=Ga(n);d&&localStorage.setItem("token",d),localStorage.setItem("user",JSON.stringify(o.user)),i.value=!0;try{const{initializePushNotifications:e}=await z(async()=>{const{initializePushNotifications:e}=await Promise.resolve().then(()=>ox);return{initializePushNotifications:e}},void 0),{useNotificationsStore:t}=((await z(async()=>{const{Capacitor:e}=await Promise.resolve().then(()=>ae);return{Capacitor:e}},void 0)).Capacitor.getPlatform(),await e(),await z(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>tr);return{useNotificationsStore:e}},void 0));t().initializeRealTimeNotifications()}catch(c){}return o.user}catch(h){throw console.error("AuthStore - Error en login:",h),r.value=h.message||"Error al iniciar sesión",h}finally{o.value=!1}},register:async t=>{o.value=!0,r.value=null;try{const a=(await Ia.register(t)).data||{};e.value=a.user,n.value=a.token||null,s.value=!0,l.value=null;const i=Ga(n);return i&&localStorage.setItem("token",i),localStorage.setItem("user",JSON.stringify(a.user)),a.user}catch(h){throw r.value=h.message||"Error al registrarse",h}finally{o.value=!1}},logout:u,fetchUser:async()=>{if(e.value)return;const t=localStorage.getItem("user");if(t)try{e.value=JSON.parse(t)}catch(h){}else s.value&&u()},updateProfile:async t=>{try{const a=Object.fromEntries(t.entries());return e.value={...e.value,...a},localStorage.setItem("user",JSON.stringify(e.value)),{data:{user:e.value}}}catch(a){throw console.error("Error actualizando el perfil:",a),a}},forgotPassword:async e=>{o.value=!0,r.value=null;try{return!0}catch(h){throw r.value=h.message||"Error al enviar email de recuperación",h}finally{o.value=!1}},resetPassword:async(e,t)=>{o.value=!0,r.value=null;try{return!0}catch(h){throw r.value=h.message||"Error al restablecer contraseña",h}finally{o.value=!1}},setSelectedRole:t=>{l.value=t,e.value&&(e.value={...e.value,role:t});const a=localStorage.getItem("user");if(a)try{const e=JSON.parse(a);e.selectedRole=t,e.role=t,localStorage.setItem("user",JSON.stringify(e))}catch(h){console.error("AuthStore - Error actualizando usuario en localStorage:",h)}try{const e=localStorage.getItem("token");e&&(n.value=e,s.value=!0)}catch(h){console.warn("AuthStore - Error sincronizando token desde localStorage:",h)}},getSelectedRole:()=>Ha(l),tryToLogin:async()=>{const t=localStorage.getItem("token"),a=localStorage.getItem("user");if(!t)return!1;try{if(n.value=t,a){const t=JSON.parse(a);e.value=t,l.value=t.selectedRole||t.role}return await Ia.getCurrentUser()?(s.value=!0,i.value=!0,!0):(u(),!1)}catch(h){return await u(),i.value=!0,!1}}}});
/*!
* sweetalert2 v11.22.0
* Released under the MIT License.
*/
function Ka(e,t,a){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:a;throw new TypeError("Private element is not present on this object")}function Qa(e,t){return e.get(Ka(e,t))}function Ja(e,t,a){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,a)}const Za={},Xa=e=>new Promise(t=>{if(!e)return t();const a=window.scrollX,n=window.scrollY;Za.restoreFocusTimeout=setTimeout(()=>{Za.previousActiveElement instanceof HTMLElement?(Za.previousActiveElement.focus(),Za.previousActiveElement=null):document.body&&document.body.focus(),t()},100),window.scrollTo(a,n)}),en="swal2-",tn=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error","draggable","dragging"].reduce((e,t)=>(e[t]=en+t,e),{}),an=["success","warning","info","question","error"].reduce((e,t)=>(e[t]=en+t,e),{}),nn="SweetAlert2:",sn=e=>e.charAt(0).toUpperCase()+e.slice(1),on=e=>{console.warn(`${nn} ${"object"==typeof e?e.join(" "):e}`)},rn=e=>{console.error(`${nn} ${e}`)},ln=[],cn=(e,t=null)=>{var a;a=`"${e}" is deprecated and will be removed in the next major release.${t?` Use "${t}" instead.`:""}`,ln.includes(a)||(ln.push(a),on(a))},dn=e=>"function"==typeof e?e():e,un=e=>e&&"function"==typeof e.toPromise,hn=e=>un(e)?e.toPromise():Promise.resolve(e),pn=e=>e&&Promise.resolve(e)===e,mn=()=>document.body.querySelector(`.${tn.container}`),fn=e=>{const t=mn();return t?t.querySelector(e):null},gn=e=>fn(`.${e}`),vn=()=>gn(tn.popup),bn=()=>gn(tn.icon),wn=()=>gn(tn.title),yn=()=>gn(tn["html-container"]),_n=()=>gn(tn.image),Cn=()=>gn(tn["progress-steps"]),kn=()=>gn(tn["validation-message"]),En=()=>fn(`.${tn.actions} .${tn.confirm}`),Sn=()=>fn(`.${tn.actions} .${tn.cancel}`),Tn=()=>fn(`.${tn.actions} .${tn.deny}`),In=()=>fn(`.${tn.loader}`),Nn=()=>gn(tn.actions),xn=()=>gn(tn.footer),An=()=>gn(tn["timer-progress-bar"]),Pn=()=>gn(tn.close),Rn=()=>{const e=vn();if(!e)return[];const t=e.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),a=Array.from(t).sort((e,t)=>{const a=parseInt(e.getAttribute("tabindex")||"0"),n=parseInt(t.getAttribute("tabindex")||"0");return a>n?1:a<n?-1:0}),n=e.querySelectorAll('\n  a[href],\n  area[href],\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled]),\n  button:not([disabled]),\n  iframe,\n  object,\n  embed,\n  [tabindex="0"],\n  [contenteditable],\n  audio[controls],\n  video[controls],\n  summary\n'),i=Array.from(n).filter(e=>"-1"!==e.getAttribute("tabindex"));return[...new Set(a.concat(i))].filter(e=>Qn(e))},Dn=()=>On(document.body,tn.shown)&&!On(document.body,tn["toast-shown"])&&!On(document.body,tn["no-backdrop"]),Mn=()=>{const e=vn();return!!e&&On(e,tn.toast)},Ln=(e,t)=>{if(e.textContent="",t){const a=(new DOMParser).parseFromString(t,"text/html"),n=a.querySelector("head");n&&Array.from(n.childNodes).forEach(t=>{e.appendChild(t)});const i=a.querySelector("body");i&&Array.from(i.childNodes).forEach(t=>{t instanceof HTMLVideoElement||t instanceof HTMLAudioElement?e.appendChild(t.cloneNode(!0)):e.appendChild(t)})}},On=(e,t)=>{if(!t)return!1;const a=t.split(/\s+/);for(let n=0;n<a.length;n++)if(!e.classList.contains(a[n]))return!1;return!0},Fn=(e,t,a)=>{if(((e,t)=>{Array.from(e.classList).forEach(a=>{Object.values(tn).includes(a)||Object.values(an).includes(a)||Object.values(t.showClass||{}).includes(a)||e.classList.remove(a)})})(e,t),!t.customClass)return;const n=t.customClass[a];n&&("string"==typeof n||n.forEach?jn(e,n):on(`Invalid type of customClass.${a}! Expected string or iterable object, got "${typeof n}"`))},Un=(e,t)=>{if(!t)return null;switch(t){case"select":case"textarea":case"file":return e.querySelector(`.${tn.popup} > .${tn[t]}`);case"checkbox":return e.querySelector(`.${tn.popup} > .${tn.checkbox} input`);case"radio":return e.querySelector(`.${tn.popup} > .${tn.radio} input:checked`)||e.querySelector(`.${tn.popup} > .${tn.radio} input:first-child`);case"range":return e.querySelector(`.${tn.popup} > .${tn.range} input`);default:return e.querySelector(`.${tn.popup} > .${tn.input}`)}},Bn=e=>{if(e.focus(),"file"!==e.type){const t=e.value;e.value="",e.value=t}},qn=(e,t,a)=>{e&&t&&("string"==typeof t&&(t=t.split(/\s+/).filter(Boolean)),t.forEach(t=>{Array.isArray(e)?e.forEach(e=>{a?e.classList.add(t):e.classList.remove(t)}):a?e.classList.add(t):e.classList.remove(t)}))},jn=(e,t)=>{qn(e,t,!0)},$n=(e,t)=>{qn(e,t,!1)},zn=(e,t)=>{const a=Array.from(e.children);for(let n=0;n<a.length;n++){const e=a[n];if(e instanceof HTMLElement&&On(e,t))return e}},Vn=(e,t,a)=>{a===`${parseInt(a)}`&&(a=parseInt(a)),a||0===parseInt(a)?e.style.setProperty(t,"number"==typeof a?`${a}px`:a):e.style.removeProperty(t)},Wn=(e,t="flex")=>{e&&(e.style.display=t)},Hn=e=>{e&&(e.style.display="none")},Gn=(e,t="block")=>{e&&new MutationObserver(()=>{Kn(e,e.innerHTML,t)}).observe(e,{childList:!0,subtree:!0})},Yn=(e,t,a,n)=>{const i=e.querySelector(t);i&&i.style.setProperty(a,n)},Kn=(e,t,a="flex")=>{t?Wn(e,a):Hn(e)},Qn=e=>!(!e||!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)),Jn=e=>!!(e.scrollHeight>e.clientHeight),Zn=e=>{const t=window.getComputedStyle(e),a=parseFloat(t.getPropertyValue("animation-duration")||"0"),n=parseFloat(t.getPropertyValue("transition-duration")||"0");return a>0||n>0},Xn=(e,t=!1)=>{const a=An();a&&Qn(a)&&(t&&(a.style.transition="none",a.style.width="100%"),setTimeout(()=>{a.style.transition=`width ${e/1e3}s linear`,a.style.width="0%"},10))},ei=`\n <div aria-labelledby="${tn.title}" aria-describedby="${tn["html-container"]}" class="${tn.popup}" tabindex="-1">\n   <button type="button" class="${tn.close}"></button>\n   <ul class="${tn["progress-steps"]}"></ul>\n   <div class="${tn.icon}"></div>\n   <img class="${tn.image}" />\n   <h2 class="${tn.title}" id="${tn.title}"></h2>\n   <div class="${tn["html-container"]}" id="${tn["html-container"]}"></div>\n   <input class="${tn.input}" id="${tn.input}" />\n   <input type="file" class="${tn.file}" />\n   <div class="${tn.range}">\n     <input type="range" />\n     <output></output>\n   </div>\n   <select class="${tn.select}" id="${tn.select}"></select>\n   <div class="${tn.radio}"></div>\n   <label class="${tn.checkbox}">\n     <input type="checkbox" id="${tn.checkbox}" />\n     <span class="${tn.label}"></span>\n   </label>\n   <textarea class="${tn.textarea}" id="${tn.textarea}"></textarea>\n   <div class="${tn["validation-message"]}" id="${tn["validation-message"]}"></div>\n   <div class="${tn.actions}">\n     <div class="${tn.loader}"></div>\n     <button type="button" class="${tn.confirm}"></button>\n     <button type="button" class="${tn.deny}"></button>\n     <button type="button" class="${tn.cancel}"></button>\n   </div>\n   <div class="${tn.footer}"></div>\n   <div class="${tn["timer-progress-bar-container"]}">\n     <div class="${tn["timer-progress-bar"]}"></div>\n   </div>\n </div>\n`.replace(/(^|\n)\s*/g,""),ti=()=>{Za.currentInstance.resetValidationMessage()},ai=e=>{const t=(()=>{const e=mn();return!!e&&(e.remove(),$n([document.documentElement,document.body],[tn["no-backdrop"],tn["toast-shown"],tn["has-column"]]),!0)})();if("undefined"==typeof window||"undefined"==typeof document)return void rn("SweetAlert2 requires document to initialize");const a=document.createElement("div");a.className=tn.container,t&&jn(a,tn["no-transition"]),Ln(a,ei),a.dataset.swal2Theme=e.theme;const n="string"==typeof(i=e.target)?document.querySelector(i):i;var i;n.appendChild(a),e.topLayer&&(a.setAttribute("popover",""),a.showPopover()),(e=>{const t=vn();t.setAttribute("role",e.toast?"alert":"dialog"),t.setAttribute("aria-live",e.toast?"polite":"assertive"),e.toast||t.setAttribute("aria-modal","true")})(e),(e=>{"rtl"===window.getComputedStyle(e).direction&&jn(mn(),tn.rtl)})(n),(()=>{const e=vn(),t=zn(e,tn.input),a=zn(e,tn.file),n=e.querySelector(`.${tn.range} input`),i=e.querySelector(`.${tn.range} output`),s=zn(e,tn.select),o=e.querySelector(`.${tn.checkbox} input`),r=zn(e,tn.textarea);t.oninput=ti,a.onchange=ti,s.onchange=ti,o.onchange=ti,r.oninput=ti,n.oninput=()=>{ti(),i.value=n.value},n.onchange=()=>{ti(),i.value=n.value}})()},ni=(e,t)=>{e instanceof HTMLElement?t.appendChild(e):"object"==typeof e?ii(e,t):e&&Ln(t,e)},ii=(e,t)=>{e.jquery?si(t,e):Ln(t,e.toString())},si=(e,t)=>{if(e.textContent="",0 in t)for(let a=0;a in t;a++)e.appendChild(t[a].cloneNode(!0));else e.appendChild(t.cloneNode(!0))},oi=(e,t)=>{const a=Nn(),n=In();a&&n&&(t.showConfirmButton||t.showDenyButton||t.showCancelButton?Wn(a):Hn(a),Fn(a,t,"actions"),function(e,t,a){const n=En(),i=Tn(),s=Sn();if(!n||!i||!s)return;li(n,"confirm",a),li(i,"deny",a),li(s,"cancel",a),function(e,t,a,n){if(!n.buttonsStyling)return void $n([e,t,a],tn.styled);jn([e,t,a],tn.styled),n.confirmButtonColor&&e.style.setProperty("--swal2-confirm-button-background-color",n.confirmButtonColor);n.denyButtonColor&&t.style.setProperty("--swal2-deny-button-background-color",n.denyButtonColor);n.cancelButtonColor&&a.style.setProperty("--swal2-cancel-button-background-color",n.cancelButtonColor);ri(e),ri(t),ri(a)}(n,i,s,a),a.reverseButtons&&(a.toast?(e.insertBefore(s,n),e.insertBefore(i,n)):(e.insertBefore(s,t),e.insertBefore(i,t),e.insertBefore(n,t)))}(a,n,t),Ln(n,t.loaderHtml||""),Fn(n,t,"loader"))};function ri(e){const t=window.getComputedStyle(e);if(t.getPropertyValue("--swal2-action-button-focus-box-shadow"))return;const a=t.backgroundColor.replace(/rgba?\((\d+), (\d+), (\d+).*/,"rgba($1, $2, $3, 0.5)");e.style.setProperty("--swal2-action-button-focus-box-shadow",t.getPropertyValue("--swal2-outline").replace(/ rgba\(.*/,` ${a}`))}function li(e,t,a){const n=sn(t);Kn(e,a[`show${n}Button`],"inline-block"),Ln(e,a[`${t}ButtonText`]||""),e.setAttribute("aria-label",a[`${t}ButtonAriaLabel`]||""),e.className=tn[t],Fn(e,a,`${t}Button`)}const ci=(e,t)=>{const a=mn();a&&(!function(e,t){"string"==typeof t?e.style.background=t:t||jn([document.documentElement,document.body],tn["no-backdrop"])}(a,t.backdrop),function(e,t){if(!t)return;t in tn?jn(e,tn[t]):(on('The "position" parameter is not valid, defaulting to "center"'),jn(e,tn.center))}(a,t.position),function(e,t){if(!t)return;jn(e,tn[`grow-${t}`])}(a,t.grow),Fn(a,t,"container"))};var di={innerParams:new WeakMap,domCache:new WeakMap};const ui=["input","file","range","select","radio","checkbox","textarea"],hi=e=>{if(!e.input)return;if(!wi[e.input])return void rn(`Unexpected type of input! Expected ${Object.keys(wi).join(" | ")}, got "${e.input}"`);const t=vi(e.input);if(!t)return;const a=wi[e.input](t,e);Wn(t),e.inputAutoFocus&&setTimeout(()=>{Bn(a)})},pi=(e,t)=>{const a=vn();if(!a)return;const n=Un(a,e);if(n){(e=>{for(let t=0;t<e.attributes.length;t++){const a=e.attributes[t].name;["id","type","value","style"].includes(a)||e.removeAttribute(a)}})(n);for(const e in t)n.setAttribute(e,t[e])}},mi=e=>{if(!e.input)return;const t=vi(e.input);t&&Fn(t,e,"input")},fi=(e,t)=>{!e.placeholder&&t.inputPlaceholder&&(e.placeholder=t.inputPlaceholder)},gi=(e,t,a)=>{if(a.inputLabel){const n=document.createElement("label"),i=tn["input-label"];n.setAttribute("for",e.id),n.className=i,"object"==typeof a.customClass&&jn(n,a.customClass.inputLabel),n.innerText=a.inputLabel,t.insertAdjacentElement("beforebegin",n)}},vi=e=>{const t=vn();if(t)return zn(t,tn[e]||tn.input)},bi=(e,t)=>{["string","number"].includes(typeof t)?e.value=`${t}`:pn(t)||on(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof t}"`)},wi={};wi.text=wi.email=wi.password=wi.number=wi.tel=wi.url=wi.search=wi.date=wi["datetime-local"]=wi.time=wi.week=wi.month=(e,t)=>(bi(e,t.inputValue),gi(e,e,t),fi(e,t),e.type=t.input,e),wi.file=(e,t)=>(gi(e,e,t),fi(e,t),e),wi.range=(e,t)=>{const a=e.querySelector("input"),n=e.querySelector("output");return bi(a,t.inputValue),a.type=t.input,bi(n,t.inputValue),gi(a,e,t),e},wi.select=(e,t)=>{if(e.textContent="",t.inputPlaceholder){const a=document.createElement("option");Ln(a,t.inputPlaceholder),a.value="",a.disabled=!0,a.selected=!0,e.appendChild(a)}return gi(e,e,t),e},wi.radio=e=>(e.textContent="",e),wi.checkbox=(e,t)=>{const a=Un(vn(),"checkbox");a.value="1",a.checked=Boolean(t.inputValue);const n=e.querySelector("span");return Ln(n,t.inputPlaceholder||t.inputLabel),a},wi.textarea=(e,t)=>{bi(e,t.inputValue),fi(e,t),gi(e,e,t);return setTimeout(()=>{if("MutationObserver"in window){const a=parseInt(window.getComputedStyle(vn()).width);new MutationObserver(()=>{if(!document.body.contains(e))return;const n=e.offsetWidth+(i=e,parseInt(window.getComputedStyle(i).marginLeft)+parseInt(window.getComputedStyle(i).marginRight));var i;n>a?vn().style.width=`${n}px`:Vn(vn(),"width",t.width)}).observe(e,{attributes:!0,attributeFilter:["style"]})}}),e};const yi=(e,t)=>{const a=yn();a&&(Gn(a),Fn(a,t,"htmlContainer"),t.html?(ni(t.html,a),Wn(a,"block")):t.text?(a.textContent=t.text,Wn(a,"block")):Hn(a),((e,t)=>{const a=vn();if(!a)return;const n=di.innerParams.get(e),i=!n||t.input!==n.input;ui.forEach(e=>{const n=zn(a,tn[e]);n&&(pi(e,t.inputAttributes),n.className=tn[e],i&&Hn(n))}),t.input&&(i&&hi(t),mi(t))})(e,t))},_i=(e,t)=>{for(const[a,n]of Object.entries(an))t.icon!==a&&$n(e,n);jn(e,t.icon&&an[t.icon]),Ei(e,t),Ci(),Fn(e,t,"icon")},Ci=()=>{const e=vn();if(!e)return;const t=window.getComputedStyle(e).getPropertyValue("background-color"),a=e.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let n=0;n<a.length;n++)a[n].style.backgroundColor=t},ki=(e,t)=>{if(!t.icon&&!t.iconHtml)return;let a=e.innerHTML,n="";if(t.iconHtml)n=Si(t.iconHtml);else if("success"===t.icon)n='\n  <div class="swal2-success-circular-line-left"></div>\n  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>\n  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>\n  <div class="swal2-success-circular-line-right"></div>\n',a=a.replace(/ style=".*?"/g,"");else if("error"===t.icon)n='\n  <span class="swal2-x-mark">\n    <span class="swal2-x-mark-line-left"></span>\n    <span class="swal2-x-mark-line-right"></span>\n  </span>\n';else if(t.icon){n=Si({question:"?",warning:"!",info:"i"}[t.icon])}a.trim()!==n.trim()&&Ln(e,n)},Ei=(e,t)=>{if(t.iconColor){e.style.color=t.iconColor,e.style.borderColor=t.iconColor;for(const a of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])Yn(e,a,"background-color",t.iconColor);Yn(e,".swal2-success-ring","border-color",t.iconColor)}},Si=e=>`<div class="${tn["icon-content"]}">${e}</div>`;let Ti=!1,Ii=0,Ni=0,xi=0,Ai=0;const Pi=e=>{const t=vn();if(e.target===t||bn().contains(e.target)){Ti=!0;const a=Mi(e);Ii=a.clientX,Ni=a.clientY,xi=parseInt(t.style.insetInlineStart)||0,Ai=parseInt(t.style.insetBlockStart)||0,jn(t,"swal2-dragging")}},Ri=e=>{const t=vn();if(Ti){let{clientX:a,clientY:n}=Mi(e);t.style.insetInlineStart=`${xi+(a-Ii)}px`,t.style.insetBlockStart=`${Ai+(n-Ni)}px`}},Di=()=>{const e=vn();Ti=!1,$n(e,"swal2-dragging")},Mi=e=>{let t=0,a=0;return e.type.startsWith("mouse")?(t=e.clientX,a=e.clientY):e.type.startsWith("touch")&&(t=e.touches[0].clientX,a=e.touches[0].clientY),{clientX:t,clientY:a}},Li=(e,t)=>{const a=mn(),n=vn();if(a&&n){if(t.toast){Vn(a,"width",t.width),n.style.width="100%";const e=In();e&&n.insertBefore(e,bn())}else Vn(n,"width",t.width);Vn(n,"padding",t.padding),t.color&&(n.style.color=t.color),t.background&&(n.style.background=t.background),Hn(kn()),Oi(n,t),t.draggable&&!t.toast?(jn(n,tn.draggable),(e=>{e.addEventListener("mousedown",Pi),document.body.addEventListener("mousemove",Ri),e.addEventListener("mouseup",Di),e.addEventListener("touchstart",Pi),document.body.addEventListener("touchmove",Ri),e.addEventListener("touchend",Di)})(n)):($n(n,tn.draggable),(e=>{e.removeEventListener("mousedown",Pi),document.body.removeEventListener("mousemove",Ri),e.removeEventListener("mouseup",Di),e.removeEventListener("touchstart",Pi),document.body.removeEventListener("touchmove",Ri),e.removeEventListener("touchend",Di)})(n))}},Oi=(e,t)=>{const a=t.showClass||{};e.className=`${tn.popup} ${Qn(e)?a.popup:""}`,t.toast?(jn([document.documentElement,document.body],tn["toast-shown"]),jn(e,tn.toast)):jn(e,tn.modal),Fn(e,t,"popup"),"string"==typeof t.customClass&&jn(e,t.customClass),t.icon&&jn(e,tn[`icon-${t.icon}`])},Fi=e=>{const t=document.createElement("li");return jn(t,tn["progress-step"]),Ln(t,e),t},Ui=e=>{const t=document.createElement("li");return jn(t,tn["progress-step-line"]),e.progressStepsDistance&&Vn(t,"width",e.progressStepsDistance),t},Bi=(e,t)=>{Li(0,t),ci(0,t),((e,t)=>{const a=Cn();if(!a)return;const{progressSteps:n,currentProgressStep:i}=t;n&&0!==n.length&&void 0!==i?(Wn(a),a.textContent="",i>=n.length&&on("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),n.forEach((e,s)=>{const o=Fi(e);if(a.appendChild(o),s===i&&jn(o,tn["active-progress-step"]),s!==n.length-1){const e=Ui(t);a.appendChild(e)}})):Hn(a)})(0,t),((e,t)=>{const a=di.innerParams.get(e),n=bn();if(!n)return;if(a&&t.icon===a.icon)return ki(n,t),void _i(n,t);if(!t.icon&&!t.iconHtml)return void Hn(n);if(t.icon&&-1===Object.keys(an).indexOf(t.icon))return rn(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${t.icon}"`),void Hn(n);Wn(n),ki(n,t),_i(n,t),jn(n,t.showClass&&t.showClass.icon),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",Ci)})(e,t),((e,t)=>{const a=_n();a&&(t.imageUrl?(Wn(a,""),a.setAttribute("src",t.imageUrl),a.setAttribute("alt",t.imageAlt||""),Vn(a,"width",t.imageWidth),Vn(a,"height",t.imageHeight),a.className=tn.image,Fn(a,t,"image")):Hn(a))})(0,t),((e,t)=>{const a=wn();a&&(Gn(a),Kn(a,t.title||t.titleText,"block"),t.title&&ni(t.title,a),t.titleText&&(a.innerText=t.titleText),Fn(a,t,"title"))})(0,t),((e,t)=>{const a=Pn();a&&(Ln(a,t.closeButtonHtml||""),Fn(a,t,"closeButton"),Kn(a,t.showCloseButton),a.setAttribute("aria-label",t.closeButtonAriaLabel||""))})(0,t),yi(e,t),oi(0,t),((e,t)=>{const a=xn();a&&(Gn(a),Kn(a,t.footer,"block"),t.footer&&ni(t.footer,a),Fn(a,t,"footer"))})(0,t);const a=vn();"function"==typeof t.didRender&&a&&t.didRender(a),Za.eventEmitter.emit("didRender",a)},qi=()=>{var e;return null===(e=En())||void 0===e?void 0:e.click()},ji=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),$i=e=>{e.keydownTarget&&e.keydownHandlerAdded&&(e.keydownTarget.removeEventListener("keydown",e.keydownHandler,{capture:e.keydownListenerCapture}),e.keydownHandlerAdded=!1)},zi=(e,t)=>{var a;const n=Rn();if(n.length)return-2===(e+=t)&&(e=n.length-1),e===n.length?e=0:-1===e&&(e=n.length-1),void n[e].focus();null===(a=vn())||void 0===a||a.focus()},Vi=["ArrowRight","ArrowDown"],Wi=["ArrowLeft","ArrowUp"],Hi=(e,t,a)=>{e&&(t.isComposing||229===t.keyCode||(e.stopKeydownPropagation&&t.stopPropagation(),"Enter"===t.key?Gi(t,e):"Tab"===t.key?Yi(t):[...Vi,...Wi].includes(t.key)?Ki(t.key):"Escape"===t.key&&Qi(t,e,a)))},Gi=(e,t)=>{if(!dn(t.allowEnterKey))return;const a=Un(vn(),t.input);if(e.target&&a&&e.target instanceof HTMLElement&&e.target.outerHTML===a.outerHTML){if(["textarea","file"].includes(t.input))return;qi(),e.preventDefault()}},Yi=e=>{const t=e.target,a=Rn();let n=-1;for(let i=0;i<a.length;i++)if(t===a[i]){n=i;break}e.shiftKey?zi(n,-1):zi(n,1),e.stopPropagation(),e.preventDefault()},Ki=e=>{const t=Nn(),a=En(),n=Tn(),i=Sn();if(!(t&&a&&n&&i))return;const s=[a,n,i];if(document.activeElement instanceof HTMLElement&&!s.includes(document.activeElement))return;const o=Vi.includes(e)?"nextElementSibling":"previousElementSibling";let r=document.activeElement;if(r){for(let e=0;e<t.children.length;e++){if(r=r[o],!r)return;if(r instanceof HTMLButtonElement&&Qn(r))break}r instanceof HTMLButtonElement&&r.focus()}},Qi=(e,t,a)=>{dn(t.allowEscapeKey)&&(e.preventDefault(),a(ji.esc))};var Ji={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const Zi=()=>{Array.from(document.body.children).forEach(e=>{e.hasAttribute("data-previous-aria-hidden")?(e.setAttribute("aria-hidden",e.getAttribute("data-previous-aria-hidden")||""),e.removeAttribute("data-previous-aria-hidden")):e.removeAttribute("aria-hidden")})},Xi="undefined"!=typeof window&&!!window.GestureEvent,es=()=>{const e=mn();if(!e)return;let t;e.ontouchstart=e=>{t=ts(e)},e.ontouchmove=e=>{t&&(e.preventDefault(),e.stopPropagation())}},ts=e=>{const t=e.target,a=mn(),n=yn();return!(!a||!n)&&(!as(e)&&!ns(e)&&(t===a||!(Jn(a)||!(t instanceof HTMLElement)||((e,t)=>{let a=e;for(;a&&a!==t;){if(Jn(a))return!0;a=a.parentElement}return!1})(t,n)||"INPUT"===t.tagName||"TEXTAREA"===t.tagName||Jn(n)&&n.contains(t))))},as=e=>e.touches&&e.touches.length&&"stylus"===e.touches[0].touchType,ns=e=>e.touches&&e.touches.length>1;let is=null;const ss=e=>{null===is&&(document.body.scrollHeight>window.innerHeight||"scroll"===e)&&(is=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${is+(()=>{const e=document.createElement("div");e.className=tn["scrollbar-measure"],document.body.appendChild(e);const t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t})()}px`)};function os(e,t,a,n){Mn()?ms(e,n):(Xa(a).then(()=>ms(e,n)),$i(Za)),Xi?(t.setAttribute("style","display:none !important"),t.removeAttribute("class"),t.innerHTML=""):t.remove(),Dn()&&(null!==is&&(document.body.style.paddingRight=`${is}px`,is=null),(()=>{if(On(document.body,tn.iosfix)){const e=parseInt(document.body.style.top,10);$n(document.body,tn.iosfix),document.body.style.top="",document.body.scrollTop=-1*e}})(),Zi()),$n([document.documentElement,document.body],[tn.shown,tn["height-auto"],tn["no-backdrop"],tn["toast-shown"]])}function rs(e){e=us(e);const t=Ji.swalPromiseResolve.get(this),a=ls(this);this.isAwaitingPromise?e.isDismissed||(ds(this),t(e)):a&&t(e)}const ls=e=>{const t=vn();if(!t)return!1;const a=di.innerParams.get(e);if(!a||On(t,a.hideClass.popup))return!1;$n(t,a.showClass.popup),jn(t,a.hideClass.popup);const n=mn();return $n(n,a.showClass.backdrop),jn(n,a.hideClass.backdrop),hs(e,t,a),!0};function cs(e){const t=Ji.swalPromiseReject.get(this);ds(this),t&&t(e)}const ds=e=>{e.isAwaitingPromise&&(delete e.isAwaitingPromise,di.innerParams.get(e)||e._destroy())},us=e=>void 0===e?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},e),hs=(e,t,a)=>{var n;const i=mn(),s=Zn(t);"function"==typeof a.willClose&&a.willClose(t),null===(n=Za.eventEmitter)||void 0===n||n.emit("willClose",t),s?ps(e,t,i,a.returnFocus,a.didClose):os(e,i,a.returnFocus,a.didClose)},ps=(e,t,a,n,i)=>{Za.swalCloseEventFinishedCallback=os.bind(null,e,a,n,i);const s=function(e){var a;e.target===t&&(null===(a=Za.swalCloseEventFinishedCallback)||void 0===a||a.call(Za),delete Za.swalCloseEventFinishedCallback,t.removeEventListener("animationend",s),t.removeEventListener("transitionend",s))};t.addEventListener("animationend",s),t.addEventListener("transitionend",s)},ms=(e,t)=>{setTimeout(()=>{var a;"function"==typeof t&&t.bind(e.params)(),null===(a=Za.eventEmitter)||void 0===a||a.emit("didClose"),e._destroy&&e._destroy()})},fs=e=>{let t=vn();if(t||new Ko,t=vn(),!t)return;const a=In();Mn()?Hn(bn()):gs(t,e),Wn(a),t.setAttribute("data-loading","true"),t.setAttribute("aria-busy","true"),t.focus()},gs=(e,t)=>{const a=Nn(),n=In();a&&n&&(!t&&Qn(En())&&(t=En()),Wn(a),t&&(Hn(t),n.setAttribute("data-button-to-replace",t.className),a.insertBefore(n,t)),jn([e,a],tn.loading))},vs=e=>e.checked?1:0,bs=e=>e.checked?e.value:null,ws=e=>e.files&&e.files.length?null!==e.getAttribute("multiple")?e.files:e.files[0]:null,ys=(e,t)=>{const a=vn();if(!a)return;const n=e=>{"select"===t.input?function(e,t,a){const n=zn(e,tn.select);if(!n)return;const i=(e,t,n)=>{const i=document.createElement("option");i.value=n,Ln(i,t),i.selected=ks(n,a.inputValue),e.appendChild(i)};t.forEach(e=>{const t=e[0],a=e[1];if(Array.isArray(a)){const e=document.createElement("optgroup");e.label=t,e.disabled=!1,n.appendChild(e),a.forEach(t=>i(e,t[1],t[0]))}else i(n,a,t)}),n.focus()}(a,Cs(e),t):"radio"===t.input&&function(e,t,a){const n=zn(e,tn.radio);if(!n)return;t.forEach(e=>{const t=e[0],i=e[1],s=document.createElement("input"),o=document.createElement("label");s.type="radio",s.name=tn.radio,s.value=t,ks(t,a.inputValue)&&(s.checked=!0);const r=document.createElement("span");Ln(r,i),r.className=tn.label,o.appendChild(s),o.appendChild(r),n.appendChild(o)});const i=n.querySelectorAll("input");i.length&&i[0].focus()}(a,Cs(e),t)};un(t.inputOptions)||pn(t.inputOptions)?(fs(En()),hn(t.inputOptions).then(t=>{e.hideLoading(),n(t)})):"object"==typeof t.inputOptions?n(t.inputOptions):rn("Unexpected type of inputOptions! Expected object, Map or Promise, got "+typeof t.inputOptions)},_s=(e,t)=>{const a=e.getInput();a&&(Hn(a),hn(t.inputValue).then(n=>{a.value="number"===t.input?`${parseFloat(n)||0}`:`${n}`,Wn(a),a.focus(),e.hideLoading()}).catch(t=>{rn(`Error in inputValue promise: ${t}`),a.value="",Wn(a),a.focus(),e.hideLoading()}))};const Cs=e=>{const t=[];return e instanceof Map?e.forEach((e,a)=>{let n=e;"object"==typeof n&&(n=Cs(n)),t.push([a,n])}):Object.keys(e).forEach(a=>{let n=e[a];"object"==typeof n&&(n=Cs(n)),t.push([a,n])}),t},ks=(e,t)=>!!t&&t.toString()===e.toString(),Es=(e,t)=>{const a=di.innerParams.get(e);if(!a.input)return void rn(`The "input" parameter is needed to be set when using returnInputValueOn${sn(t)}`);const n=e.getInput(),i=((e,t)=>{const a=e.getInput();if(!a)return null;switch(t.input){case"checkbox":return vs(a);case"radio":return bs(a);case"file":return ws(a);default:return t.inputAutoTrim?a.value.trim():a.value}})(e,a);a.inputValidator?Ss(e,i,t):n&&!n.checkValidity()?(e.enableButtons(),e.showValidationMessage(a.validationMessage||n.validationMessage)):"deny"===t?Ts(e,i):xs(e,i)},Ss=(e,t,a)=>{const n=di.innerParams.get(e);e.disableInput();Promise.resolve().then(()=>hn(n.inputValidator(t,n.validationMessage))).then(n=>{e.enableButtons(),e.enableInput(),n?e.showValidationMessage(n):"deny"===a?Ts(e,t):xs(e,t)})},Ts=(e,t)=>{const a=di.innerParams.get(e||void 0);if(a.showLoaderOnDeny&&fs(Tn()),a.preDeny){e.isAwaitingPromise=!0;Promise.resolve().then(()=>hn(a.preDeny(t,a.validationMessage))).then(a=>{!1===a?(e.hideLoading(),ds(e)):e.close({isDenied:!0,value:void 0===a?t:a})}).catch(t=>Ns(e||void 0,t))}else e.close({isDenied:!0,value:t})},Is=(e,t)=>{e.close({isConfirmed:!0,value:t})},Ns=(e,t)=>{e.rejectPromise(t)},xs=(e,t)=>{const a=di.innerParams.get(e||void 0);if(a.showLoaderOnConfirm&&fs(),a.preConfirm){e.resetValidationMessage(),e.isAwaitingPromise=!0;Promise.resolve().then(()=>hn(a.preConfirm(t,a.validationMessage))).then(a=>{Qn(kn())||!1===a?(e.hideLoading(),ds(e)):Is(e,void 0===a?t:a)}).catch(t=>Ns(e||void 0,t))}else Is(e,t)};function As(){const e=di.innerParams.get(this);if(!e)return;const t=di.domCache.get(this);Hn(t.loader),Mn()?e.icon&&Wn(bn()):Ps(t),$n([t.popup,t.actions],tn.loading),t.popup.removeAttribute("aria-busy"),t.popup.removeAttribute("data-loading"),t.confirmButton.disabled=!1,t.denyButton.disabled=!1,t.cancelButton.disabled=!1}const Ps=e=>{const t=e.popup.getElementsByClassName(e.loader.getAttribute("data-button-to-replace"));t.length?Wn(t[0],"inline-block"):Qn(En())||Qn(Tn())||Qn(Sn())||Hn(e.actions)};function Rs(){const e=di.innerParams.get(this),t=di.domCache.get(this);return t?Un(t.popup,e.input):null}function Ds(e,t,a){const n=di.domCache.get(e);t.forEach(e=>{n[e].disabled=a})}function Ms(e,t){const a=vn();if(a&&e)if("radio"===e.type){const e=a.querySelectorAll(`[name="${tn.radio}"]`);for(let a=0;a<e.length;a++)e[a].disabled=t}else e.disabled=t}function Ls(){Ds(this,["confirmButton","denyButton","cancelButton"],!1)}function Os(){Ds(this,["confirmButton","denyButton","cancelButton"],!0)}function Fs(){Ms(this.getInput(),!1)}function Us(){Ms(this.getInput(),!0)}function Bs(e){const t=di.domCache.get(this),a=di.innerParams.get(this);Ln(t.validationMessage,e),t.validationMessage.className=tn["validation-message"],a.customClass&&a.customClass.validationMessage&&jn(t.validationMessage,a.customClass.validationMessage),Wn(t.validationMessage);const n=this.getInput();n&&(n.setAttribute("aria-invalid","true"),n.setAttribute("aria-describedby",tn["validation-message"]),Bn(n),jn(n,tn.inputerror))}function qs(){const e=di.domCache.get(this);e.validationMessage&&Hn(e.validationMessage);const t=this.getInput();t&&(t.removeAttribute("aria-invalid"),t.removeAttribute("aria-describedby"),$n(t,tn.inputerror))}const js={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,draggable:!1,animation:!0,theme:"light",showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0,topLayer:!1},$s=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","draggable","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","theme","willClose"],zs={allowEnterKey:void 0},Vs=["allowOutsideClick","allowEnterKey","backdrop","draggable","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],Ws=e=>Object.prototype.hasOwnProperty.call(js,e),Hs=e=>-1!==$s.indexOf(e),Gs=e=>zs[e],Ys=e=>{Ws(e)||on(`Unknown parameter "${e}"`)},Ks=e=>{Vs.includes(e)&&on(`The parameter "${e}" is incompatible with toasts`)},Qs=e=>{const t=Gs(e);t&&cn(e,t)},Js=e=>{!1===e.backdrop&&e.allowOutsideClick&&on('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`'),e.theme&&!["light","dark","auto","minimal","borderless","embed-iframe","bulma","bulma-light","bulma-dark"].includes(e.theme)&&on(`Invalid theme "${e.theme}"`);for(const t in e)Ys(t),e.toast&&Ks(t),Qs(t)};function Zs(e){const t=mn(),a=vn(),n=di.innerParams.get(this);if(!a||On(a,n.hideClass.popup))return void on("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");const i=Xs(e),s=Object.assign({},n,i);Js(s),t.dataset.swal2Theme=s.theme,Bi(this,s),di.innerParams.set(this,s),Object.defineProperties(this,{params:{value:Object.assign({},this.params,e),writable:!1,enumerable:!0}})}const Xs=e=>{const t={};return Object.keys(e).forEach(a=>{Hs(a)?t[a]=e[a]:on(`Invalid parameter to update: ${a}`)}),t};function eo(){const e=di.domCache.get(this),t=di.innerParams.get(this);t?(e.popup&&Za.swalCloseEventFinishedCallback&&(Za.swalCloseEventFinishedCallback(),delete Za.swalCloseEventFinishedCallback),"function"==typeof t.didDestroy&&t.didDestroy(),Za.eventEmitter.emit("didDestroy"),to(this)):ao(this)}const to=e=>{ao(e),delete e.params,delete Za.keydownHandler,delete Za.keydownTarget,delete Za.currentInstance},ao=e=>{e.isAwaitingPromise?(no(di,e),e.isAwaitingPromise=!0):(no(Ji,e),no(di,e),delete e.isAwaitingPromise,delete e.disableButtons,delete e.enableButtons,delete e.getInput,delete e.disableInput,delete e.enableInput,delete e.hideLoading,delete e.disableLoading,delete e.showValidationMessage,delete e.resetValidationMessage,delete e.close,delete e.closePopup,delete e.closeModal,delete e.closeToast,delete e.rejectPromise,delete e.update,delete e._destroy)},no=(e,t)=>{for(const a in e)e[a].delete(t)};var io=Object.freeze({__proto__:null,_destroy:eo,close:rs,closeModal:rs,closePopup:rs,closeToast:rs,disableButtons:Os,disableInput:Us,disableLoading:As,enableButtons:Ls,enableInput:Fs,getInput:Rs,handleAwaitingPromise:ds,hideLoading:As,rejectPromise:cs,resetValidationMessage:qs,showValidationMessage:Bs,update:Zs});const so=(e,t,a)=>{t.popup.onclick=()=>{e&&(oo(e)||e.timer||e.input)||a(ji.close)}},oo=e=>!!(e.showConfirmButton||e.showDenyButton||e.showCancelButton||e.showCloseButton);let ro=!1;const lo=e=>{e.popup.onmousedown=()=>{e.container.onmouseup=function(t){e.container.onmouseup=()=>{},t.target===e.container&&(ro=!0)}}},co=e=>{e.container.onmousedown=t=>{t.target===e.container&&t.preventDefault(),e.popup.onmouseup=function(t){e.popup.onmouseup=()=>{},(t.target===e.popup||t.target instanceof HTMLElement&&e.popup.contains(t.target))&&(ro=!0)}}},uo=(e,t,a)=>{t.container.onclick=n=>{ro?ro=!1:n.target===t.container&&dn(e.allowOutsideClick)&&a(ji.backdrop)}},ho=e=>e instanceof Element||(e=>"object"==typeof e&&e.jquery)(e);const po=()=>{if(Za.timeout)return(()=>{const e=An();if(!e)return;const t=parseInt(window.getComputedStyle(e).width);e.style.removeProperty("transition"),e.style.width="100%";const a=t/parseInt(window.getComputedStyle(e).width)*100;e.style.width=`${a}%`})(),Za.timeout.stop()},mo=()=>{if(Za.timeout){const e=Za.timeout.start();return Xn(e),e}};let fo=!1;const go={};const vo=e=>{for(let t=e.target;t&&t!==document;t=t.parentNode)for(const e in go){const a=t.getAttribute(e);if(a)return void go[e].fire({template:a})}};Za.eventEmitter=new class{constructor(){this.events={}}_getHandlersByEventName(e){return void 0===this.events[e]&&(this.events[e]=[]),this.events[e]}on(e,t){const a=this._getHandlersByEventName(e);a.includes(t)||a.push(t)}once(e,t){const a=(...n)=>{this.removeListener(e,a),t.apply(this,n)};this.on(e,a)}emit(e,...t){this._getHandlersByEventName(e).forEach(e=>{try{e.apply(this,t)}catch(a){console.error(a)}})}removeListener(e,t){const a=this._getHandlersByEventName(e),n=a.indexOf(t);n>-1&&a.splice(n,1)}removeAllListeners(e){void 0!==this.events[e]&&(this.events[e].length=0)}reset(){this.events={}}};var bo=Object.freeze({__proto__:null,argsToParams:e=>{const t={};return"object"!=typeof e[0]||ho(e[0])?["title","html","icon"].forEach((a,n)=>{const i=e[n];"string"==typeof i||ho(i)?t[a]=i:void 0!==i&&rn(`Unexpected type of ${a}! Expected "string" or "Element", got ${typeof i}`)}):Object.assign(t,e[0]),t},bindClickHandler:function(e="data-swal-template"){go[e]=this,fo||(document.body.addEventListener("click",vo),fo=!0)},clickCancel:()=>{var e;return null===(e=Sn())||void 0===e?void 0:e.click()},clickConfirm:qi,clickDeny:()=>{var e;return null===(e=Tn())||void 0===e?void 0:e.click()},enableLoading:fs,fire:function(...e){return new this(...e)},getActions:Nn,getCancelButton:Sn,getCloseButton:Pn,getConfirmButton:En,getContainer:mn,getDenyButton:Tn,getFocusableElements:Rn,getFooter:xn,getHtmlContainer:yn,getIcon:bn,getIconContent:()=>gn(tn["icon-content"]),getImage:_n,getInputLabel:()=>gn(tn["input-label"]),getLoader:In,getPopup:vn,getProgressSteps:Cn,getTimerLeft:()=>Za.timeout&&Za.timeout.getTimerLeft(),getTimerProgressBar:An,getTitle:wn,getValidationMessage:kn,increaseTimer:e=>{if(Za.timeout){const t=Za.timeout.increase(e);return Xn(t,!0),t}},isDeprecatedParameter:Gs,isLoading:()=>{const e=vn();return!!e&&e.hasAttribute("data-loading")},isTimerRunning:()=>!(!Za.timeout||!Za.timeout.isRunning()),isUpdatableParameter:Hs,isValidParameter:Ws,isVisible:()=>Qn(vn()),mixin:function(e){return class extends(this){_main(t,a){return super._main(t,Object.assign({},e,a))}}},off:(e,t)=>{e?t?Za.eventEmitter.removeListener(e,t):Za.eventEmitter.removeAllListeners(e):Za.eventEmitter.reset()},on:(e,t)=>{Za.eventEmitter.on(e,t)},once:(e,t)=>{Za.eventEmitter.once(e,t)},resumeTimer:mo,showLoading:fs,stopTimer:po,toggleTimer:()=>{const e=Za.timeout;return e&&(e.running?po():mo())}});class wo{constructor(e,t){this.callback=e,this.remaining=t,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=(new Date).getTime()-this.started.getTime()),this.remaining}increase(e){const t=this.running;return t&&this.stop(),this.remaining+=e,t&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const yo=["swal-title","swal-html","swal-footer"],_o=e=>{const t={};return Array.from(e.querySelectorAll("swal-param")).forEach(e=>{xo(e,["name","value"]);const a=e.getAttribute("name"),n=e.getAttribute("value");a&&n&&(t[a]="boolean"==typeof js[a]?"false"!==n:"object"==typeof js[a]?JSON.parse(n):n)}),t},Co=e=>{const t={};return Array.from(e.querySelectorAll("swal-function-param")).forEach(e=>{const a=e.getAttribute("name"),n=e.getAttribute("value");a&&n&&(t[a]=new Function(`return ${n}`)())}),t},ko=e=>{const t={};return Array.from(e.querySelectorAll("swal-button")).forEach(e=>{xo(e,["type","color","aria-label"]);const a=e.getAttribute("type");a&&["confirm","cancel","deny"].includes(a)&&(t[`${a}ButtonText`]=e.innerHTML,t[`show${sn(a)}Button`]=!0,e.hasAttribute("color")&&(t[`${a}ButtonColor`]=e.getAttribute("color")),e.hasAttribute("aria-label")&&(t[`${a}ButtonAriaLabel`]=e.getAttribute("aria-label")))}),t},Eo=e=>{const t={},a=e.querySelector("swal-image");return a&&(xo(a,["src","width","height","alt"]),a.hasAttribute("src")&&(t.imageUrl=a.getAttribute("src")||void 0),a.hasAttribute("width")&&(t.imageWidth=a.getAttribute("width")||void 0),a.hasAttribute("height")&&(t.imageHeight=a.getAttribute("height")||void 0),a.hasAttribute("alt")&&(t.imageAlt=a.getAttribute("alt")||void 0)),t},So=e=>{const t={},a=e.querySelector("swal-icon");return a&&(xo(a,["type","color"]),a.hasAttribute("type")&&(t.icon=a.getAttribute("type")),a.hasAttribute("color")&&(t.iconColor=a.getAttribute("color")),t.iconHtml=a.innerHTML),t},To=e=>{const t={},a=e.querySelector("swal-input");a&&(xo(a,["type","label","placeholder","value"]),t.input=a.getAttribute("type")||"text",a.hasAttribute("label")&&(t.inputLabel=a.getAttribute("label")),a.hasAttribute("placeholder")&&(t.inputPlaceholder=a.getAttribute("placeholder")),a.hasAttribute("value")&&(t.inputValue=a.getAttribute("value")));const n=Array.from(e.querySelectorAll("swal-input-option"));return n.length&&(t.inputOptions={},n.forEach(e=>{xo(e,["value"]);const a=e.getAttribute("value");if(!a)return;const n=e.innerHTML;t.inputOptions[a]=n})),t},Io=(e,t)=>{const a={};for(const n in t){const i=t[n],s=e.querySelector(i);s&&(xo(s,[]),a[i.replace(/^swal-/,"")]=s.innerHTML.trim())}return a},No=e=>{const t=yo.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(e.children).forEach(e=>{const a=e.tagName.toLowerCase();t.includes(a)||on(`Unrecognized element <${a}>`)})},xo=(e,t)=>{Array.from(e.attributes).forEach(a=>{-1===t.indexOf(a.name)&&on([`Unrecognized attribute "${a.name}" on <${e.tagName.toLowerCase()}>.`,""+(t.length?`Allowed attributes are: ${t.join(", ")}`:"To set the value, use HTML within the element.")])})},Ao=e=>{const t=mn(),a=vn();"function"==typeof e.willOpen&&e.willOpen(a),Za.eventEmitter.emit("willOpen",a);const n=window.getComputedStyle(document.body).overflowY;Mo(t,a,e),setTimeout(()=>{Ro(t,a)},10),Dn()&&(Do(t,e.scrollbarPadding,n),(()=>{const e=mn();Array.from(document.body.children).forEach(t=>{t.contains(e)||(t.hasAttribute("aria-hidden")&&t.setAttribute("data-previous-aria-hidden",t.getAttribute("aria-hidden")||""),t.setAttribute("aria-hidden","true"))})})()),Mn()||Za.previousActiveElement||(Za.previousActiveElement=document.activeElement),"function"==typeof e.didOpen&&setTimeout(()=>e.didOpen(a)),Za.eventEmitter.emit("didOpen",a),$n(t,tn["no-transition"])},Po=e=>{const t=vn();if(e.target!==t)return;const a=mn();t.removeEventListener("animationend",Po),t.removeEventListener("transitionend",Po),a.style.overflowY="auto"},Ro=(e,t)=>{Zn(t)?(e.style.overflowY="hidden",t.addEventListener("animationend",Po),t.addEventListener("transitionend",Po)):e.style.overflowY="auto"},Do=(e,t,a)=>{(()=>{if(Xi&&!On(document.body,tn.iosfix)){const e=document.body.scrollTop;document.body.style.top=-1*e+"px",jn(document.body,tn.iosfix),es()}})(),t&&"hidden"!==a&&ss(a),setTimeout(()=>{e.scrollTop=0})},Mo=(e,t,a)=>{jn(e,a.showClass.backdrop),a.animation?(t.style.setProperty("opacity","0","important"),Wn(t,"grid"),setTimeout(()=>{jn(t,a.showClass.popup),t.style.removeProperty("opacity")},10)):Wn(t,"grid"),jn([document.documentElement,document.body],tn.shown),a.heightAuto&&a.backdrop&&!a.toast&&jn([document.documentElement,document.body],tn["height-auto"])};var Lo=(e,t)=>/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(e)?Promise.resolve():Promise.resolve(t||"Invalid email address"),Oo=(e,t)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(e)?Promise.resolve():Promise.resolve(t||"Invalid URL");function Fo(e){!function(e){e.inputValidator||("email"===e.input&&(e.inputValidator=Lo),"url"===e.input&&(e.inputValidator=Oo))}(e),e.showLoaderOnConfirm&&!e.preConfirm&&on("showLoaderOnConfirm is set to true, but preConfirm is not defined.\nshowLoaderOnConfirm should be used together with preConfirm, see usage example:\nhttps://sweetalert2.github.io/#ajax-request"),function(e){(!e.target||"string"==typeof e.target&&!document.querySelector(e.target)||"string"!=typeof e.target&&!e.target.appendChild)&&(on('Target parameter is not valid, defaulting to "body"'),e.target="body")}(e),"string"==typeof e.title&&(e.title=e.title.split("\n").join("<br />")),ai(e)}let Uo;var Bo=new WeakMap;class qo{constructor(...e){if(Ja(this,Bo,void 0),"undefined"==typeof window)return;Uo=this;const t=Object.freeze(this.constructor.argsToParams(e));var a,n,i;this.params=t,this.isAwaitingPromise=!1,a=Bo,n=this,i=this._main(Uo.params),a.set(Ka(a,n),i)}_main(e,t={}){if(Js(Object.assign({},t,e)),Za.currentInstance){const e=Ji.swalPromiseResolve.get(Za.currentInstance),{isAwaitingPromise:t}=Za.currentInstance;Za.currentInstance._destroy(),t||e({isDismissed:!0}),Dn()&&Zi()}Za.currentInstance=Uo;const a=$o(e,t);Fo(a),Object.freeze(a),Za.timeout&&(Za.timeout.stop(),delete Za.timeout),clearTimeout(Za.restoreFocusTimeout);const n=zo(Uo);return Bi(Uo,a),di.innerParams.set(Uo,a),jo(Uo,n,a)}then(e){return Qa(Bo,this).then(e)}finally(e){return Qa(Bo,this).finally(e)}}const jo=(e,t,a)=>new Promise((n,i)=>{const s=t=>{e.close({isDismissed:!0,dismiss:t})};Ji.swalPromiseResolve.set(e,n),Ji.swalPromiseReject.set(e,i),t.confirmButton.onclick=()=>{(e=>{const t=di.innerParams.get(e);e.disableButtons(),t.input?Es(e,"confirm"):xs(e,!0)})(e)},t.denyButton.onclick=()=>{(e=>{const t=di.innerParams.get(e);e.disableButtons(),t.returnInputValueOnDeny?Es(e,"deny"):Ts(e,!1)})(e)},t.cancelButton.onclick=()=>{((e,t)=>{e.disableButtons(),t(ji.cancel)})(e,s)},t.closeButton.onclick=()=>{s(ji.close)},((e,t,a)=>{e.toast?so(e,t,a):(lo(t),co(t),uo(e,t,a))})(a,t,s),((e,t,a)=>{$i(e),t.toast||(e.keydownHandler=e=>Hi(t,e,a),e.keydownTarget=t.keydownListenerCapture?window:vn(),e.keydownListenerCapture=t.keydownListenerCapture,e.keydownTarget.addEventListener("keydown",e.keydownHandler,{capture:e.keydownListenerCapture}),e.keydownHandlerAdded=!0)})(Za,a,s),((e,t)=>{"select"===t.input||"radio"===t.input?ys(e,t):["text","email","number","tel","textarea"].some(e=>e===t.input)&&(un(t.inputValue)||pn(t.inputValue))&&(fs(En()),_s(e,t))})(e,a),Ao(a),Vo(Za,a,s),Wo(t,a),setTimeout(()=>{t.container.scrollTop=0})}),$o=(e,t)=>{const a=(e=>{const t="string"==typeof e.template?document.querySelector(e.template):e.template;if(!t)return{};const a=t.content;return No(a),Object.assign(_o(a),Co(a),ko(a),Eo(a),So(a),To(a),Io(a,yo))})(e),n=Object.assign({},js,t,a,e);return n.showClass=Object.assign({},js.showClass,n.showClass),n.hideClass=Object.assign({},js.hideClass,n.hideClass),!1===n.animation&&(n.showClass={backdrop:"swal2-noanimation"},n.hideClass={}),n},zo=e=>{const t={popup:vn(),container:mn(),actions:Nn(),confirmButton:En(),denyButton:Tn(),cancelButton:Sn(),loader:In(),closeButton:Pn(),validationMessage:kn(),progressSteps:Cn()};return di.domCache.set(e,t),t},Vo=(e,t,a)=>{const n=An();Hn(n),t.timer&&(e.timeout=new wo(()=>{a("timer"),delete e.timeout},t.timer),t.timerProgressBar&&(Wn(n),Fn(n,t,"timerProgressBar"),setTimeout(()=>{e.timeout&&e.timeout.running&&Xn(t.timer)})))},Wo=(e,t)=>{if(!t.toast)return dn(t.allowEnterKey)?void(Ho(e)||Go(e,t)||zi(-1,1)):(cn("allowEnterKey"),void Yo())},Ho=e=>{const t=Array.from(e.popup.querySelectorAll("[autofocus]"));for(const a of t)if(a instanceof HTMLElement&&Qn(a))return a.focus(),!0;return!1},Go=(e,t)=>t.focusDeny&&Qn(e.denyButton)?(e.denyButton.focus(),!0):t.focusCancel&&Qn(e.cancelButton)?(e.cancelButton.focus(),!0):!(!t.focusConfirm||!Qn(e.confirmButton))&&(e.confirmButton.focus(),!0),Yo=()=>{document.activeElement instanceof HTMLElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()};if("undefined"!=typeof window&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|by|xn--p1ai)$/)){const e=new Date,t=localStorage.getItem("swal-initiation");t?(e.getTime()-Date.parse(t))/864e5>3&&setTimeout(()=>{document.body.style.pointerEvents="none";const e=document.createElement("audio");e.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",e.loop=!0,document.body.appendChild(e),setTimeout(()=>{e.play().catch(()=>{})},2500)},500):localStorage.setItem("swal-initiation",`${e}`)}qo.prototype.disableButtons=Os,qo.prototype.enableButtons=Ls,qo.prototype.getInput=Rs,qo.prototype.disableInput=Us,qo.prototype.enableInput=Fs,qo.prototype.hideLoading=As,qo.prototype.disableLoading=As,qo.prototype.showValidationMessage=Bs,qo.prototype.resetValidationMessage=qs,qo.prototype.close=rs,qo.prototype.closePopup=rs,qo.prototype.closeModal=rs,qo.prototype.closeToast=rs,qo.prototype.rejectPromise=cs,qo.prototype.update=Zs,qo.prototype._destroy=eo,Object.assign(qo,bo),Object.keys(io).forEach(e=>{qo[e]=function(...t){return Uo&&Uo[e]?Uo[e](...t):null}}),qo.DismissReason=ji,qo.version="11.22.0";const Ko=qo;Ko.default=Ko,"undefined"!=typeof document&&function(e,t){var a=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(a),a.styleSheet)a.styleSheet.disabled||(a.styleSheet.cssText=t);else try{a.innerHTML=t}catch(n){a.innerText=t}}(document,':root{--swal2-outline: 0 0 0 3px rgba(100, 150, 200, 0.5);--swal2-container-padding: 0.625em;--swal2-backdrop: rgba(0, 0, 0, 0.4);--swal2-backdrop-transition: background-color 0.1s;--swal2-width: 32em;--swal2-padding: 0 0 1.25em;--swal2-border: none;--swal2-border-radius: 0.3125rem;--swal2-background: white;--swal2-color: #545454;--swal2-show-animation: swal2-show 0.3s;--swal2-hide-animation: swal2-hide 0.15s forwards;--swal2-icon-zoom: 1;--swal2-icon-animations: true;--swal2-title-padding: 0.8em 1em 0;--swal2-html-container-padding: 1em 1.6em 0.3em;--swal2-input-border: 1px solid #d9d9d9;--swal2-input-border-radius: 0.1875em;--swal2-input-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-background: transparent;--swal2-input-transition: border-color 0.2s, box-shadow 0.2s;--swal2-input-hover-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-focus-border: 1px solid #b4dbed;--swal2-input-focus-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px $swal2-outline-color;--swal2-progress-step-background: #add8e6;--swal2-validation-message-background: #f0f0f0;--swal2-validation-message-color: #666;--swal2-footer-border-color: #eee;--swal2-footer-background: transparent;--swal2-footer-color: inherit;--swal2-close-button-position: initial;--swal2-close-button-inset: auto;--swal2-close-button-font-size: 2.5em;--swal2-close-button-color: #ccc;--swal2-close-button-transition: color 0.2s, box-shadow 0.2s;--swal2-close-button-outline: initial;--swal2-close-button-box-shadow: inset 0 0 0 3px transparent;--swal2-close-button-focus-box-shadow: inset var(--swal2-outline);--swal2-close-button-hover-transform: none;--swal2-actions-justify-content: center;--swal2-actions-width: auto;--swal2-actions-margin: 1.25em auto 0;--swal2-actions-padding: 0;--swal2-actions-border-radius: 0;--swal2-actions-background: transparent;--swal2-action-button-transition: background-color 0.2s, box-shadow 0.2s;--swal2-action-button-hover: black 10%;--swal2-action-button-active: black 10%;--swal2-confirm-button-box-shadow: none;--swal2-confirm-button-border-radius: 0.25em;--swal2-confirm-button-background-color: #7066e0;--swal2-confirm-button-color: #fff;--swal2-deny-button-box-shadow: none;--swal2-deny-button-border-radius: 0.25em;--swal2-deny-button-background-color: #dc3741;--swal2-deny-button-color: #fff;--swal2-cancel-button-box-shadow: none;--swal2-cancel-button-border-radius: 0.25em;--swal2-cancel-button-background-color: #6e7881;--swal2-cancel-button-color: #fff;--swal2-toast-show-animation: swal2-toast-show 0.5s;--swal2-toast-hide-animation: swal2-toast-hide 0.1s forwards;--swal2-toast-border: none;--swal2-toast-box-shadow: 0 0 1px hsl(0deg 0% 0% / 0.075), 0 1px 2px hsl(0deg 0% 0% / 0.075), 1px 2px 4px hsl(0deg 0% 0% / 0.075), 1px 3px 8px hsl(0deg 0% 0% / 0.075), 2px 4px 16px hsl(0deg 0% 0% / 0.075)}[data-swal2-theme=dark]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}@media(prefers-color-scheme: dark){[data-swal2-theme=auto]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px var(--swal2-backdrop)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:var(--swal2-container-padding);overflow-x:hidden;transition:var(--swal2-backdrop-transition);-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:var(--swal2-backdrop)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container)[popover]{width:auto;border:0}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:var(--swal2-width);max-width:100%;padding:var(--swal2-padding);border:var(--swal2-border);border-radius:var(--swal2-border-radius);background:var(--swal2-background);color:var(--swal2-color);font-family:inherit;font-size:1rem;container-name:swal2-popup}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:var(--swal2-title-padding);color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:var(--swal2-actions-justify-content);width:var(--swal2-actions-width);margin:var(--swal2-actions-margin);padding:var(--swal2-actions-padding);border-radius:var(--swal2-actions-border-radius);background:var(--swal2-actions-background)}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:var(--swal2-action-button-transition);border:none;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border-radius:var(--swal2-confirm-button-border-radius);background:initial;background-color:var(--swal2-confirm-button-background-color);box-shadow:var(--swal2-confirm-button-box-shadow);color:var(--swal2-confirm-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):hover{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):active{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border-radius:var(--swal2-deny-button-border-radius);background:initial;background-color:var(--swal2-deny-button-background-color);box-shadow:var(--swal2-deny-button-box-shadow);color:var(--swal2-deny-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):hover{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):active{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border-radius:var(--swal2-cancel-button-border-radius);background:initial;background-color:var(--swal2-cancel-button-background-color);box-shadow:var(--swal2-cancel-button-box-shadow);color:var(--swal2-cancel-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):hover{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):active{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none;box-shadow:var(--swal2-action-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-styled)[disabled]:not(.swal2-loading){opacity:.4}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid var(--swal2-footer-border-color);background:var(--swal2-footer-background);color:var(--swal2-footer-color);font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:var(--swal2-border-radius);border-bottom-left-radius:var(--swal2-border-radius)}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){position:var(--swal2-close-button-position);inset:var(--swal2-close-button-inset);z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:var(--swal2-close-button-transition);border:none;border-radius:var(--swal2-border-radius);outline:var(--swal2-close-button-outline);background:rgba(0,0,0,0);color:var(--swal2-close-button-color);font-family:monospace;font-size:var(--swal2-close-button-font-size);cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:var(--swal2-close-button-hover-transform);background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:var(--swal2-close-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:var(--swal2-html-container-padding);overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:var(--swal2-input-transition);border:var(--swal2-input-border);border-radius:var(--swal2-input-border-radius);background:var(--swal2-input-background);box-shadow:var(--swal2-input-box-shadow);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):hover,div:where(.swal2-container) input:where(.swal2-file):hover,div:where(.swal2-container) textarea:where(.swal2-textarea):hover{box-shadow:var(--swal2-input-hover-box-shadow)}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:var(--swal2-input-focus-border);outline:none;box-shadow:var(--swal2-input-focus-box-shadow)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:var(--swal2-background)}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:var(--swal2-input-background);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:var(--swal2-input-background);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:var(--swal2-background);color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:var(--swal2-validation-message-background);color:var(--swal2-validation-message-color);font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:var(--swal2-progress-step-background);color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:var(--swal2-progress-step-background)}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;zoom:var(--swal2-icon-zoom);border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}}div:where(.swal2-icon).swal2-warning{border-color:#f8bb86;color:#f8bb86}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}}div:where(.swal2-icon).swal2-info{border-color:#3fc3ee;color:#3fc3ee}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}}div:where(.swal2-icon).swal2-question{border-color:#87adbd;color:#87adbd}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:var(--swal2-show-animation)}.swal2-hide{animation:var(--swal2-hide-animation)}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;border:var(--swal2-toast-border);background:var(--swal2-background);box-shadow:var(--swal2-toast-box-shadow);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}@container swal2-popup style(--swal2-icon-animations:true){.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}}.swal2-toast.swal2-show{animation:var(--swal2-toast-show-animation)}.swal2-toast.swal2-hide{animation:var(--swal2-toast-hide-animation)}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}');const Qo=Ko.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",Ko.stopTimer),e.addEventListener("mouseleave",Ko.resumeTimer)}}),Jo=e=>{Qo.fire({icon:"success",title:e})},Zo=e=>{Qo.fire({icon:"error",title:e})},Xo=async(e,t,a="Confirmar",n="Cancelar",i="warning")=>(await Ko.fire({title:e,text:t,icon:i,showCancelButton:!0,confirmButtonColor:"danger"===i?"#dc3545":"#007bff",cancelButtonColor:"#6c757d",confirmButtonText:a,cancelButtonText:n,reverseButtons:!0})).isConfirmed,er=e("notifications",{state:()=>({unreadNotifications:[],readNotifications:[],unreadCount:0,waiterUnreadNotifications:[],waiterReadNotifications:[],waiterUnreadCount:0,adminNotifications:[],loading:!1,loadingWaiter:!1,loadingAdmin:!1,globalNotificationsEnabled:!0,tableNotificationsEnabled:{},isConnected:!1}),getters:{allUnreadNotifications:e=>[...e.unreadNotifications,...e.waiterUnreadNotifications],allReadNotifications:e=>[...e.readNotifications,...e.waiterReadNotifications],totalUnreadCount:e=>e.unreadCount+e.waiterUnreadCount,hasUnreadNotifications:e=>e.unreadCount>0||e.waiterUnreadCount>0,getNotificationsByType:e=>t=>[...e.unreadNotifications,...e.readNotifications,...e.waiterUnreadNotifications,...e.waiterReadNotifications].filter(e=>e.type===t),hasNotification:e=>t=>!!(e.unreadNotifications.find(e=>e.id===t)||e.readNotifications.find(e=>e.id===t)||e.waiterUnreadNotifications.find(e=>e.id===t)||e.waiterReadNotifications.find(e=>e.id===t))},actions:{async loadNotifications(){try{this.loading=!0;const e=await Na.getNotifications();return this.unreadNotifications=e.unread_notifications||[],this.readNotifications=e.read_notifications||[],this.unreadCount=e.unread_count||0,e}catch(e){throw console.error("Error cargando notificaciones:",e),Zo("Error al cargar las notificaciones"),e}finally{this.loading=!1}},async handleNotification(e,t){try{const a=await Na.handleNotification(e,t);if("mark_as_read"===t){const t=this.unreadNotifications.find(t=>t.id===e);t&&(this.unreadNotifications=this.unreadNotifications.filter(t=>t.id!==e),this.readNotifications.unshift(t),this.unreadCount=Math.max(0,this.unreadCount-1))}else"delete"===t&&(this.unreadNotifications=this.unreadNotifications.filter(t=>t.id!==e),this.readNotifications=this.readNotifications.filter(t=>t.id!==e));return Jo(a.message||"Notificación procesada correctamente"),a}catch(a){throw console.error("Error manejando notificación:",a),Zo("Error al procesar la notificación"),a}},async markAllAsRead(){try{if(0===this.unreadNotifications.length)return;await Na.markAllAsRead(this.unreadNotifications),this.readNotifications.unshift(...this.unreadNotifications),this.unreadNotifications=[],this.unreadCount=0,Jo("Todas las notificaciones marcadas como leídas")}catch(e){throw console.error("Error marcando todas como leídas:",e),Zo("Error al marcar como leídas"),e}},async deleteAllRead(){try{if(0===this.readNotifications.length)return;await Na.deleteAllRead(this.readNotifications),this.readNotifications=[],Jo("Notificaciones leídas eliminadas")}catch(e){throw console.error("Error eliminando notificaciones leídas:",e),Zo("Error al eliminar notificaciones"),e}},async loadWaiterNotifications(){try{this.loadingWaiter=!0;const e=await Na.getWaiterNotifications();return this.waiterUnreadNotifications=e.unread_notifications||[],this.waiterReadNotifications=e.read_notifications||[],this.waiterUnreadCount=e.unread_count||0,e}catch(e){throw console.error("Error cargando notificaciones de mozo:",e),Zo("Error al cargar las notificaciones"),e}finally{this.loadingWaiter=!1}},async handleWaiterNotification(e,t){try{const a=await Na.handleWaiterNotification(e,t);if("mark_as_read"===t){const t=this.waiterUnreadNotifications.find(t=>t.id===e);t&&(this.waiterUnreadNotifications=this.waiterUnreadNotifications.filter(t=>t.id!==e),this.waiterReadNotifications.unshift(t),this.waiterUnreadCount=Math.max(0,this.waiterUnreadCount-1))}else"delete"===t&&(this.waiterUnreadNotifications=this.waiterUnreadNotifications.filter(t=>t.id!==e),this.waiterReadNotifications=this.waiterReadNotifications.filter(t=>t.id!==e));return Jo(a.message||"Notificación procesada correctamente"),a}catch(a){throw console.error("Error manejando notificación de mozo:",a),Zo("Error al procesar la notificación"),a}},async setWaiterGlobalNotifications(e){try{const t=await Na.waiterGlobalNotifications(e);return this.globalNotificationsEnabled=e,Jo(t.message||"Configuración actualizada"),t}catch(t){throw console.error("Error configurando notificaciones globales:",t),Zo("Error al actualizar la configuración"),t}},async loadAdminNotifications(){try{this.loadingAdmin=!0;const e=await Na.getAdminNotifications();return this.adminNotifications=e.notifications||[],e}catch(e){throw console.error("Error cargando notificaciones de administrador:",e),Zo("Error al cargar las notificaciones"),e}finally{this.loadingAdmin=!1}},async storeDeviceToken(e,t="web"){try{const a=await Na.storeDeviceToken(e,t);return Jo("Token de dispositivo guardado"),a}catch(a){throw console.error("Error guardando token de dispositivo:",a),Zo("Error al guardar el token"),a}},async deleteDeviceToken(e){try{const t=await Na.deleteDeviceToken(e);return Jo("Token de dispositivo eliminado"),t}catch(t){throw console.error("Error eliminando token de dispositivo:",t),Zo("Error al eliminar el token"),t}},async toggleTableNotifications(e){try{const t=await Na.toggleTableNotifications(e);return this.tableNotificationsEnabled[e]=t.notifications_enabled,Jo(t.message||"Estado de notificaciones actualizado"),t}catch(t){throw console.error("Error alternando notificaciones de mesa:",t),Zo("Error al actualizar notificaciones de mesa"),t}},async initializeRealTimeNotifications(){return Ya(),console.log("🔥 Notificaciones en tiempo real delegadas a Firebase Realtime"),console.log("ℹ️ Las notificaciones de mozo se manejan directamente con Firebase"),this.isConnected=!0,!0},async disconnectRealTimeNotifications(){console.log("🔥 Desconectando notificaciones en tiempo real..."),this.isConnected=!1,console.log("✅ Notificaciones desconectadas")},addNewNotification(e){const t=this.unreadNotifications.find(t=>t.id===e.id),a=this.waiterUnreadNotifications.find(t=>t.id===e.id);if(t||a)return console.log("🔍 Notificación ya existe, actualizando...",e.id),void this.updateExistingNotification(e);"waiter_call"===e.type||"table_call"===e.type?(this.waiterUnreadNotifications.unshift(e),this.waiterUnreadCount++,console.log("🍽️ Nueva notificación de mozo agregada:",e.title||e.body)):(this.unreadNotifications.unshift(e),this.unreadCount++,console.log("🔔 Nueva notificación general agregada:",e.title||e.body));const n=e.title||e.body||e.message||"Tienes una nueva notificación";Jo(`Nueva notificación: ${n}`)},updateExistingNotification(e){const t=this.unreadNotifications.findIndex(t=>t.id===e.id);if(-1!==t){if(this.unreadNotifications[t]=e,e.read_at){const e=this.unreadNotifications.splice(t,1)[0];this.readNotifications.unshift(e),this.unreadCount=Math.max(0,this.unreadCount-1)}return}const a=this.waiterUnreadNotifications.findIndex(t=>t.id===e.id);if(-1===a)console.log("⚠️ No se encontró la notificación para actualizar:",e.id);else if(this.waiterUnreadNotifications[a]=e,e.read_at){const e=this.waiterUnreadNotifications.splice(a,1)[0];this.waiterReadNotifications.unshift(e),this.waiterUnreadCount=Math.max(0,this.waiterUnreadCount-1)}},removeNotification(e){this.unreadNotifications=this.unreadNotifications.filter(t=>t.id!==e),this.readNotifications=this.readNotifications.filter(t=>t.id!==e),this.waiterUnreadNotifications=this.waiterUnreadNotifications.filter(t=>t.id!==e),this.waiterReadNotifications=this.waiterReadNotifications.filter(t=>t.id!==e),this.unreadCount=this.unreadNotifications.length,this.waiterUnreadCount=this.waiterUnreadNotifications.length,console.log("🗑️ Notificación eliminada:",e)},clearState(){this.unreadNotifications=[],this.readNotifications=[],this.unreadCount=0,this.waiterUnreadNotifications=[],this.waiterReadNotifications=[],this.waiterUnreadCount=0,this.adminNotifications=[],this.loading=!1,this.loadingWaiter=!1,this.loadingAdmin=!1,this.globalNotificationsEnabled=!0,this.tableNotificationsEnabled={}}}}),tr=Object.freeze(Object.defineProperty({__proto__:null,useNotificationsStore:er},Symbol.toStringTag,{value:"Module"})),ar=(e,t)=>{const a=e.__vccOpts||e;for(const[n,i]of t)a[n]=i;return a},nr={class:"notification-bell-container"},ir={key:0,class:"notification-badge"},sr={class:"dropdown-header"},or={class:"notification-count"},rr={key:0,class:"notification-list"},lr=["onClick"],cr={class:"notification-content"},dr={class:"notification-title"},ur={class:"notification-message"},hr={class:"notification-time"},pr={key:0,class:"unread-dot"},mr={key:1,class:"empty-notifications"},fr={key:2,class:"dropdown-footer"},gr=ar({__name:"NotificationBell",setup(e){const n=er(),f=t(!1),g=a(()=>n.totalUnreadCount),v=a(()=>n.hasUnreadNotifications),b=a(()=>n.allUnreadNotifications.concat(n.allReadNotifications)),w=a(()=>g.value>99?"99+":g.value);function y(){f.value=!f.value}function _(){f.value=!1}function C(){n.allUnreadNotifications.forEach(e=>{n.handleNotification(e.id,"read")}),_()}function k(e){if(!e)return"";const t=new Date(e),a=new Date-t,n=Math.floor(a/36e5),i=Math.floor(a/6e4);return n>24?t.toLocaleDateString():n>0?`${n}h`:i>0?`${i}m`:"ahora"}function E(e){e.target.closest(".notification-bell-container")||_()}return i(()=>{document.addEventListener("click",E)}),s(()=>{document.removeEventListener("click",E)}),(e,t)=>(r(),o("div",nr,[l("button",{onClick:y,class:u(["notification-bell",{"has-notifications":v.value}])},[t[1]||(t[1]=l("i",{class:"bi bi-bell"},null,-1)),g.value>0?(r(),o("span",ir,d(w.value),1)):c("",!0)],2),f.value?(r(),o("div",{key:0,class:"notification-dropdown",onClick:t[0]||(t[0]=h(()=>{},["stop"]))},[l("div",sr,[t[2]||(t[2]=l("h4",null,"Notificaciones",-1)),l("span",or,d(g.value)+" nuevas",1)]),b.value.length>0?(r(),o("div",rr,[(r(!0),o(p,null,m(b.value.slice(0,5),e=>{var t,a;return r(),o("div",{key:e.id,class:u(["notification-item",{unread:!e.read_at}]),onClick:t=>function(e){e.read_at||n.handleNotification(e.id,"read")}(e)},[l("div",cr,[l("div",dr,d((null==(t=e.data)?void 0:t.title)||e.title||"Notificación"),1),l("div",ur,d((null==(a=e.data)?void 0:a.message)||e.body||"Nueva notificación recibida"),1),l("div",hr,d(k(e.created_at)),1)]),e.read_at?c("",!0):(r(),o("div",pr))],10,lr)}),128))])):(r(),o("div",mr,t[3]||(t[3]=[l("i",{class:"bi bi-bell-slash"},null,-1),l("p",null,"No hay notificaciones",-1)]))),b.value.length>0?(r(),o("div",fr,[l("button",{onClick:C,class:"action-btn"},"Marcar todas como leídas")])):c("",!0)])):c("",!0)]))}},[["__scopeId","data-v-3a3df5a8"]]),vr={class:"navbar-container"},br={class:"top-bar"},wr={class:"navbar-left"},yr={class:"app-title"},_r={key:0,class:"navbar-right"},Cr=ar({__name:"Navbar",props:{title:{type:String,default:"MÖZÖ"}},setup(e){const t=ie(),a=Ya();return(i,s)=>(r(),o("div",vr,[l("header",br,[l("div",wr,[l("button",{class:"menu-toggle",onClick:s[0]||(s[0]=(...e)=>n(t).toggleOffCanvas&&n(t).toggleOffCanvas(...e)),"aria-label":"Abrir menú"},s[1]||(s[1]=[l("i",{class:"bi bi-list"},null,-1)])),l("h1",yr,d(e.title),1)]),n(a).isAuthenticated?(r(),o("div",_r,[f(gr)])):c("",!0)])]))}},[["__scopeId","data-v-33d07fba"]]),kr={class:"off-canvas-panel"},Er={class:"panel-header"},Sr={class:"panel-nav"},Tr={key:0},Ir={key:1},Nr=ar({__name:"OffCanvasNavbar",setup(e){const t=ie(),s=Ya(),d=g(),h=a(()=>t.isOffCanvasOpen),p=a(()=>s.currentRole);i(()=>{});const m=async()=>{t.closeOffCanvas(),await s.logout(),d.push("/login")},f=e=>{t.closeOffCanvas(),d.push({name:e})};return(e,a)=>(r(),o("div",{class:u(["off-canvas-container",{open:h.value}])},[l("div",{class:"off-canvas-backdrop",onClick:a[0]||(a[0]=(...e)=>n(t).closeOffCanvas&&n(t).closeOffCanvas(...e))}),l("aside",kr,[l("header",Er,[a[7]||(a[7]=l("h3",null,"Menú",-1)),l("button",{onClick:a[1]||(a[1]=(...e)=>n(t).closeOffCanvas&&n(t).closeOffCanvas(...e)),class:"close-btn"},"×")]),l("nav",Sr,[l("ul",null,["admin"===p.value?(r(),o("li",Tr,[l("a",{onClick:a[2]||(a[2]=e=>f("admin-home"))},a[8]||(a[8]=[l("i",{class:"bi bi-speedometer2"},null,-1),v(" Dashboard ")]))])):c("",!0),l("li",null,[l("a",{onClick:a[3]||(a[3]=e=>f("admin-notification-debug"))},a[9]||(a[9]=[l("i",{class:"bi bi-bug"},null,-1),v(" Debug Notificaciones ")]))]),"waiter"===p.value?(r(),o("li",Ir,[l("a",{onClick:a[4]||(a[4]=e=>f("waiter-dashboard"))},a[10]||(a[10]=[l("i",{class:"bi bi-grid-1x2-fill"},null,-1),v(" Tablero ")]))])):c("",!0),l("li",null,[l("a",{onClick:a[5]||(a[5]=e=>f("profile"))},a[11]||(a[11]=[l("i",{class:"bi bi-person-fill"},null,-1),v(" Mi Perfil ")]))]),l("li",null,[l("a",{onClick:a[6]||(a[6]=e=>f("role-selection"))},a[12]||(a[12]=[l("i",{class:"bi bi-person-badge-fill"},null,-1),v(" Cambiar Rol ")]))]),a[14]||(a[14]=l("li",{class:"separator"},null,-1)),l("li",null,[l("a",{onClick:m},a[13]||(a[13]=[l("i",{class:"bi bi-box-arrow-right"},null,-1),v(" Cerrar Sesión ")]))])])])])],2))}},[["__scopeId","data-v-7bd94440"]]),xr="0.0.45",Ar=()=>`v${xr}`,Pr={class:"app-container"},Rr={key:2,class:"app-footer"},Dr={class:"footer-content"},Mr={class:"version"},Lr={__name:"App",setup(e){const t=b(),h=g(),p=Ya(),m=er(),v=a(()=>!["login","register","forgot-password","reset-password","role-selection"].includes(t.name)),E=a(()=>void 0===p.initialized||p.initialized),S=()=>{["login","register","forgot-password","reset-password","role-selection"].includes(t.name)?ne.exitApp():h.options.history.state.back?h.back():ne.exitApp()};return i(async()=>{if((async()=>{try{await ne.addListener("backButton",S)}catch(e){console.warn("No se pudo configurar el listener del botón atrás:",e)}})(),await p.tryToLogin(),p.isAuthenticated){m.loadNotifications(),m.initializeRealTimeNotifications();try{const e=!!window.Capacitor&&window.Capacitor.getPlatform&&"web"!==window.Capacitor.getPlatform(),t=localStorage.getItem("fcm_token");if(!e&&!t&&!window.__pushInitStarted){window.__pushInitStarted=!0,console.log("🔔 (Fallback) Inicializando push porque fcm_token está vacío tras login restaurado...");const{initializePushNotifications:e}=await z(async()=>{const{initializePushNotifications:e}=await Promise.resolve().then(()=>ox);return{initializePushNotifications:e}},void 0);await e();const t=localStorage.getItem("fcm_token");console.log("🔔 (Fallback) Resultado obtención token:",t?t.substring(0,25)+"...":"NO TOKEN"),t||console.warn("⚠️ (Fallback) No se pudo obtener token FCM en inicialización tardía.")}}catch(e){console.warn("⚠️ (Fallback) Error asegurando token FCM:",e)}}}),s(()=>{(async()=>{try{await ne.removeAllListeners("backButton")}catch(e){console.warn("Error al limpiar listeners del botón atrás:",e)}})(),p.isAuthenticated&&m.disconnectRealTimeNotifications()}),(e,t)=>{const a=_("router-view");return r(),o("div",Pr,[v.value&&E.value?(r(),w(Cr,{key:0})):c("",!0),v.value&&E.value?(r(),w(Nr,{key:1})):c("",!0),l("main",{class:u({"with-navbar":v.value})},[f(a,null,{default:y(({Component:e})=>[f(C,{name:"fade",mode:"out-in"},{default:y(()=>[(r(),w(k(e)))]),_:2},1024)]),_:1})],2),v.value&&E.value?(r(),o("footer",Rr,[l("div",Dr,[t[0]||(t[0]=l("span",{class:"app-name"},"MozoApp",-1)),l("span",Mr,d(n(Ar)()),1)])])):c("",!0)])}}},Or={setToken(e){e?localStorage.setItem("token",e):console.error("Intento de guardar un token inválido:",e)},getToken:()=>localStorage.getItem("token"),removeToken(){localStorage.removeItem("token")},setUser(e){localStorage.setItem("user",JSON.stringify(e))},getUser(){const e=localStorage.getItem("user");return e?JSON.parse(e):null},removeUser(){localStorage.removeItem("user")},isAuthenticated(){return!!this.getToken()},async login(e,t){var a,n;try{const i=await Ia.login({email:e,password:t}),s=i.data.token||i.data.access_token||i.data.plainTextToken||i.data.user&&i.data.user.token||i.data.user&&i.data.user.access_token||(null==(n=null==(a=i.headers)?void 0:a.authorization)?void 0:n.replace("Bearer ",""));if(!s)throw console.error("No se encontró un token válido en la respuesta:",i.data),new Error("No se recibió un token válido del servidor");return this.setToken(s),this.setUser(i.data.user),i.data}catch(i){throw console.error("Error en login:",i),i}},async loginWithGoogle(e){try{const t=await Ia.loginWithGoogle(e),a=t.data.token||t.data.access_token||t.data.plainTextToken||t.data.user&&t.data.user.token||t.data.user&&t.data.user.access_token;if(!a)throw new Error("No se recibió un token válido del servidor");return this.setToken(a),this.setUser(t.data.user),t.data}catch(t){throw console.error("Error en loginWithGoogle:",t),t}},async register(e,t,a,n){try{return(await Ia.register({name:e,email:t,password:a,password_confirmation:n})).data}catch(i){throw i}},async forgotPassword(e){try{return(await Ia.forgotPassword({email:e})).data}catch(t){throw t}},async resetPassword(e,t,a,n){try{return(await Ia.resetPassword({token:e,email:t,password:a,password_confirmation:n})).data}catch(i){throw i}},async logout(){try{const e=localStorage.getItem("fcm_token");this.isAuthenticated()&&e&&await Ia.deleteDeviceToken({token:e}),this.isAuthenticated()&&await Ia.logout()}catch(e){console.error("Error durante el logout en el servidor:",e)}finally{er().disconnectRealTimeNotifications(),this.removeToken(),this.removeUser(),localStorage.removeItem("fcm_token")}},async getCurrentUser(){try{const e=await Ia.getCurrentUser();return this.setUser(e.data),e.data}catch(e){throw e}},async selectRole(e){try{const t=(await Ia.selectRole(e)).data||{},a=t.token||t.access_token||t.plainTextToken||t.user&&t.user.token||t.user&&t.user.access_token;a&&this.setToken(a);const n=this.getUser();return n&&(n.role=e,this.setUser(n)),t}catch(t){throw console.error("Error en selectRole:",t),t}}},Fr={class:"auth-container"},Ur={class:"auth-card"},Br={key:0,class:"alert alert-danger"},qr={class:"mb-3"},jr=["disabled"],$r={class:"mb-3"},zr=["disabled"],Vr={class:"d-flex justify-content-between align-items-center mb-4"},Wr={class:"form-check"},Hr=["disabled"],Gr={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Yr=["disabled"],Kr={class:"text-center mt-4"};const Qr=ar({name:"LoginView",setup(){const e=g(),n=t(""),i=t(""),s=t(!1),o=t(""),r=t(!1),l=a(()=>""!==n.value.trim()&&""!==i.value.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.value));return{email:n,password:i,remember:s,error:o,loading:r,isFormValid:l,handleLogin:async()=>{var t,a;if(l.value){r.value=!0,o.value="";try{await Or.login(n.value,i.value),e.push({name:"role-selection"})}catch(s){console.error("Error de inicio de sesión:",s),o.value=(null==(a=null==(t=s.response)?void 0:t.data)?void 0:a.message)||"Error al iniciar sesión. Por favor, inténtalo de nuevo."}finally{r.value=!1}}},handleGoogleLogin:async()=>{alert("La función de inicio de sesión con Google será implementada próximamente")}}}},[["render",function(e,t,a,n,i,s){const u=_("router-link");return r(),o("div",Fr,[l("div",Ur,[t[14]||(t[14]=l("div",{class:"text-center mb-4"},[l("h1",{class:"h3"},"Iniciar Sesión"),l("p",{class:"text-muted"},"Accede a tu cuenta de MOZO")],-1)),n.error?(r(),o("div",Br,d(n.error),1)):c("",!0),l("form",{onSubmit:t[4]||(t[4]=h((...e)=>n.handleLogin&&n.handleLogin(...e),["prevent"]))},[l("div",qr,[t[5]||(t[5]=l("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),E(l("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,jr),[[S,n.email]])]),l("div",$r,[t[6]||(t[6]=l("label",{for:"password",class:"form-label"},"Contraseña",-1)),E(l("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),required:"",disabled:n.loading,placeholder:"Tu contraseña"},null,8,zr),[[S,n.password]])]),l("div",Vr,[l("div",Wr,[E(l("input",{class:"form-check-input",type:"checkbox",id:"remember","onUpdate:modelValue":t[2]||(t[2]=e=>n.remember=e)},null,512),[[T,n.remember]]),t[7]||(t[7]=l("label",{class:"form-check-label",for:"remember"}," Recordarme ",-1))]),f(u,{to:"/forgot-password",class:"link-primary"},{default:y(()=>t[8]||(t[8]=[v("¿Olvidaste tu contraseña?")])),_:1,__:[8]})]),l("button",{type:"submit",class:"btn btn-primary w-100 mb-3",disabled:n.loading||!n.isFormValid},[n.loading?(r(),o("span",Gr)):c("",!0),t[9]||(t[9]=v(" Iniciar sesión "))],8,Hr),t[13]||(t[13]=l("div",{class:"text-center my-3"},[l("span",{class:"text-muted"},"O continúa con")],-1)),l("button",{type:"button",class:"btn btn-outline-secondary w-100 mb-3",onClick:t[3]||(t[3]=(...e)=>n.handleGoogleLogin&&n.handleGoogleLogin(...e)),disabled:n.loading},t[10]||(t[10]=[l("i",{class:"bi bi-google me-2"},null,-1),v(" Google ")]),8,Yr),l("div",Kr,[t[12]||(t[12]=l("span",{class:"text-muted"},"¿No tienes una cuenta?",-1)),f(u,{to:"/register",class:"link-primary ms-1"},{default:y(()=>t[11]||(t[11]=[v("Registrarse")])),_:1,__:[11]})])],32)])])}],["__scopeId","data-v-5d787c1e"]]),Jr={class:"auth-container"},Zr={class:"auth-card"},Xr={key:0,class:"alert alert-danger"},el={class:"mb-3"},tl=["disabled"],al={class:"mb-3"},nl=["disabled"],il={key:0,class:"form-text text-danger"},sl={class:"mb-3"},ol=["disabled"],rl={key:0,class:"form-text text-danger"},ll={class:"mb-4"},cl=["disabled"],dl={key:0,class:"form-text text-danger"},ul=["disabled"],hl={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},pl={class:"text-center"};const ml=ar({name:"RegisterView",setup(){const e=g(),n=t(""),i=t(""),s=t(""),o=t(""),r=t(""),l=t(!1),c=a(()=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.value)),d=a(()=>s.value.length>=8),u=a(()=>s.value===o.value),h=a(()=>""!==n.value.trim()&&c.value&&d.value&&u.value);return{name:n,email:i,password:s,passwordConfirmation:o,error:r,loading:l,isEmailValid:c,isPasswordValid:d,doPasswordsMatch:u,isFormValid:h,handleRegister:async()=>{var t,a;if(h.value){l.value=!0,r.value="";try{await Or.register(n.value,i.value,s.value,o.value),e.push({path:"/login",query:{registered:"success"}})}catch(c){console.error("Error de registro:",c),r.value=(null==(a=null==(t=c.response)?void 0:t.data)?void 0:a.message)||"Error al crear la cuenta. Por favor, inténtalo de nuevo."}finally{l.value=!1}}}}}},[["render",function(e,t,a,n,i,s){const u=_("router-link");return r(),o("div",Jr,[l("div",Zr,[t[12]||(t[12]=l("div",{class:"text-center mb-4"},[l("h1",{class:"h3"},"Crear cuenta"),l("p",{class:"text-muted"},"Regístrate para acceder a MOZO")],-1)),n.error?(r(),o("div",Xr,d(n.error),1)):c("",!0),l("form",{onSubmit:t[4]||(t[4]=h((...e)=>n.handleRegister&&n.handleRegister(...e),["prevent"]))},[l("div",el,[t[5]||(t[5]=l("label",{for:"name",class:"form-label"},"Nombre completo",-1)),E(l("input",{type:"text",class:"form-control",id:"name","onUpdate:modelValue":t[0]||(t[0]=e=>n.name=e),required:"",disabled:n.loading,placeholder:"Tu nombre completo"},null,8,tl),[[S,n.name]])]),l("div",al,[t[6]||(t[6]=l("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),E(l("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[1]||(t[1]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,nl),[[S,n.email]]),!n.isEmailValid&&n.email?(r(),o("div",il," Introduce un correo electrónico válido ")):c("",!0)]),l("div",sl,[t[7]||(t[7]=l("label",{for:"password",class:"form-label"},"Contraseña",-1)),E(l("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[2]||(t[2]=e=>n.password=e),required:"",disabled:n.loading,placeholder:"Mínimo 8 caracteres"},null,8,ol),[[S,n.password]]),!n.isPasswordValid&&n.password?(r(),o("div",rl," La contraseña debe tener al menos 8 caracteres ")):c("",!0)]),l("div",ll,[t[8]||(t[8]=l("label",{for:"passwordConfirmation",class:"form-label"},"Confirmar contraseña",-1)),E(l("input",{type:"password",class:"form-control",id:"passwordConfirmation","onUpdate:modelValue":t[3]||(t[3]=e=>n.passwordConfirmation=e),required:"",disabled:n.loading,placeholder:"Repite tu contraseña"},null,8,cl),[[S,n.passwordConfirmation]]),!n.doPasswordsMatch&&n.passwordConfirmation?(r(),o("div",dl," Las contraseñas no coinciden ")):c("",!0)]),l("button",{type:"submit",class:"btn btn-primary w-100 mb-4",disabled:n.loading||!n.isFormValid},[n.loading?(r(),o("span",hl)):c("",!0),t[9]||(t[9]=v(" Crear cuenta "))],8,ul),l("div",pl,[t[11]||(t[11]=l("span",{class:"text-muted"},"¿Ya tienes una cuenta?",-1)),f(u,{to:"/login",class:"link-primary ms-1"},{default:y(()=>t[10]||(t[10]=[v("Iniciar sesión")])),_:1,__:[10]})])],32)])])}],["__scopeId","data-v-0e5d0e5f"]]),fl={class:"auth-container"},gl={class:"auth-card"},vl={key:0,class:"alert alert-success"},bl={key:1,class:"alert alert-danger"},wl={class:"mb-4"},yl=["disabled"],_l=["disabled"],Cl={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},kl={class:"text-center"},El={key:3,class:"text-center mt-3"};const Sl=ar({name:"ForgotPasswordView",setup(){const e=t(""),n=t(""),i=t(""),s=t(!1),o=a(()=>""!==e.value.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value));return{email:e,error:n,success:i,loading:s,isFormValid:o,handleForgotPassword:async()=>{var t,a;if(o.value){s.value=!0,n.value="",i.value="";try{await Or.forgotPassword(e.value),i.value="Se ha enviado un enlace de recuperación a tu correo electrónico. Por favor, revisa tu bandeja de entrada.",e.value=""}catch(r){console.error("Error al solicitar recuperación de contraseña:",r),n.value=(null==(a=null==(t=r.response)?void 0:t.data)?void 0:a.message)||"No se pudo enviar el enlace de recuperación. Por favor, inténtalo de nuevo."}finally{s.value=!1}}}}}},[["render",function(e,t,a,n,i,s){const u=_("router-link");return r(),o("div",fl,[l("div",gl,[t[6]||(t[6]=l("div",{class:"text-center mb-4"},[l("h1",{class:"h3"},"Recuperar contraseña"),l("p",{class:"text-muted"},"Ingresa tu correo electrónico para recibir un enlace de recuperación")],-1)),n.success?(r(),o("div",vl,d(n.success),1)):c("",!0),n.error?(r(),o("div",bl,d(n.error),1)):c("",!0),n.success?c("",!0):(r(),o("form",{key:2,onSubmit:t[1]||(t[1]=h((...e)=>n.handleForgotPassword&&n.handleForgotPassword(...e),["prevent"]))},[l("div",wl,[t[2]||(t[2]=l("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),E(l("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,yl),[[S,n.email]])]),l("button",{type:"submit",class:"btn btn-primary w-100 mb-4",disabled:n.loading||!n.isFormValid},[n.loading?(r(),o("span",Cl)):c("",!0),t[3]||(t[3]=v(" Enviar enlace de recuperación "))],8,_l),l("div",kl,[f(u,{to:"/login",class:"link-primary"},{default:y(()=>t[4]||(t[4]=[l("i",{class:"bi bi-arrow-left me-1"},null,-1),v(" Volver a inicio de sesión ")])),_:1,__:[4]})])],32)),n.success?(r(),o("div",El,[f(u,{to:"/login",class:"btn btn-outline-primary"},{default:y(()=>t[5]||(t[5]=[v(" Volver a inicio de sesión ")])),_:1,__:[5]})])):c("",!0)])])}],["__scopeId","data-v-af089bfd"]]),Tl={name:"ResetPasswordView",setup(){g();const e=b(),n=t(""),s=t(""),o=t(""),r=t(""),l=t(""),c=t(""),d=t(!1),u=a(()=>o.value.length>=8),h=a(()=>o.value===r.value),p=a(()=>""!==n.value&&""!==s.value.trim()&&u.value&&h.value);i(()=>{n.value=e.query.token||"",s.value=e.query.email||"",n.value||(l.value="Token de restablecimiento no válido o expirado. Por favor, solicita un nuevo enlace de recuperación.")});return{email:s,password:o,passwordConfirmation:r,error:l,success:c,loading:d,isPasswordValid:u,doPasswordsMatch:h,isFormValid:p,handleResetPassword:async()=>{var e,t;if(p.value){d.value=!0,l.value="",c.value="";try{await Or.resetPassword(n.value,s.value,o.value,r.value),c.value="Tu contraseña ha sido restablecida con éxito. Ya puedes iniciar sesión con tu nueva contraseña.",o.value="",r.value=""}catch(a){console.error("Error al restablecer contraseña:",a),l.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"No se pudo restablecer la contraseña. Por favor, inténtalo de nuevo o solicita un nuevo enlace."}finally{d.value=!1}}}}}},Il={class:"auth-container"},Nl={class:"auth-card"},xl={key:0,class:"alert alert-success"},Al={key:1,class:"alert alert-danger"},Pl={class:"mb-3"},Rl=["disabled"],Dl={class:"mb-3"},Ml=["disabled"],Ll={key:0,class:"form-text text-danger"},Ol={class:"mb-4"},Fl=["disabled"],Ul={key:0,class:"form-text text-danger"},Bl=["disabled"],ql={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},jl={class:"text-center"},$l={key:3,class:"text-center mt-3"};const zl=ar(Tl,[["render",function(e,t,a,n,i,s){const u=_("router-link");return r(),o("div",Il,[l("div",Nl,[t[10]||(t[10]=l("div",{class:"text-center mb-4"},[l("h1",{class:"h3"},"Restablecer contraseña"),l("p",{class:"text-muted"},"Crea una nueva contraseña segura")],-1)),n.success?(r(),o("div",xl,d(n.success),1)):c("",!0),n.error?(r(),o("div",Al,d(n.error),1)):c("",!0),n.success?c("",!0):(r(),o("form",{key:2,onSubmit:t[3]||(t[3]=h((...e)=>n.handleResetPassword&&n.handleResetPassword(...e),["prevent"]))},[l("div",Pl,[t[4]||(t[4]=l("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),E(l("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,Rl),[[S,n.email]])]),l("div",Dl,[t[5]||(t[5]=l("label",{for:"password",class:"form-label"},"Nueva contraseña",-1)),E(l("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),required:"",disabled:n.loading,placeholder:"Mínimo 8 caracteres"},null,8,Ml),[[S,n.password]]),!n.isPasswordValid&&n.password?(r(),o("div",Ll," La contraseña debe tener al menos 8 caracteres ")):c("",!0)]),l("div",Ol,[t[6]||(t[6]=l("label",{for:"passwordConfirmation",class:"form-label"},"Confirmar nueva contraseña",-1)),E(l("input",{type:"password",class:"form-control",id:"passwordConfirmation","onUpdate:modelValue":t[2]||(t[2]=e=>n.passwordConfirmation=e),required:"",disabled:n.loading,placeholder:"Repite tu nueva contraseña"},null,8,Fl),[[S,n.passwordConfirmation]]),!n.doPasswordsMatch&&n.passwordConfirmation?(r(),o("div",Ul," Las contraseñas no coinciden ")):c("",!0)]),l("button",{type:"submit",class:"btn btn-primary w-100 mb-4",disabled:n.loading||!n.isFormValid},[n.loading?(r(),o("span",ql)):c("",!0),t[7]||(t[7]=v(" Cambiar contraseña "))],8,Bl),l("div",jl,[f(u,{to:"/login",class:"link-primary"},{default:y(()=>t[8]||(t[8]=[l("i",{class:"bi bi-arrow-left me-1"},null,-1),v(" Volver a inicio de sesión ")])),_:1,__:[8]})])],32)),n.success?(r(),o("div",$l,[f(u,{to:"/login",class:"btn btn-primary"},{default:y(()=>t[9]||(t[9]=[v(" Ir a inicio de sesión ")])),_:1,__:[9]})])):c("",!0)])])}],["__scopeId","data-v-9859a781"]]),Vl={class:"container d-flex justify-content-center align-items-center vh-100"},Wl={class:"row justify-content-center align-items-center w-100"},Hl={class:"role-card col-11 d-flex flex-column justify-content-center align-items-center"},Gl={class:"row justify-content-between align-items-center w-100"},Yl={class:"col me-2 d-flex flex-column justify-content-center align-items-center px-0"},Kl={class:"col ms-2 d-flex flex-column justify-content-center align-items-center px-0"},Ql={class:"mt-5 text-center row justify-content-center align-items-center w-100"},Jl=["disabled"],Zl=ar({__name:"RoleSelection",props:[],setup(e){const a=g(),n=t(""),i=t(!1),s=t(""),c=Ya(),d=async e=>{if(s.value)return;s.value=e,n.value="";try{console.log("RoleSelection - Inicio de selección de rol:",e),console.log("RoleSelection - Token antes de selectRole:",localStorage.getItem("token"));const t=await Or.selectRole(e);console.log("RoleSelection - Respuesta de selectRole:",t),console.log("RoleSelection - Token después de selectRole:",localStorage.getItem("token"))}catch(i){console.warn("RoleSelection - selectRole falló, se continúa localmente:",(null==i?void 0:i.message)||i),console.error("RoleSelection - Error completo:",i)}console.log("RoleSelection - Actualizando estado local con setSelectedRole"),c.setSelectedRole(e),console.log("RoleSelection - Estado actualizado, token actual:",localStorage.getItem("token"));const t="waiter"===e?"waiter-dashboard":"admin";console.log("RoleSelection - Redirigiendo a:",t),a.push({name:t}),s.value=""},u=async()=>{try{await Or.logout(),c.logout(),a.push({name:"login"})}catch(e){a.push({name:"login"})}};return(e,t)=>(r(),o("div",Vl,[l("div",Wl,[l("div",Hl,[t[5]||(t[5]=l("div",{class:"text-center mb-4 row justify-content-center align-items-center w-100"},[l("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+DQogIDwhLS0gRm9uZG8gZGVsIGxvZ28gLS0+DQogIDxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiByeD0iNDAiIGZpbGw9IiM3QzZDRjMiLz4NCiAgDQogIDwhLS0gT2pvcyAtLT4NCiAgPGNpcmNsZSBjeD0iNzAiIGN5PSI4MCIgcj0iMTUiIGZpbGw9ImJsYWNrIi8+DQogIDxjaXJjbGUgY3g9IjEzMCIgY3k9IjgwIiByPSIxNSIgZmlsbD0iYmxhY2siLz4NCiAgDQogIDwhLS0gQ2VqYXMgLS0+DQogIDxsaW5lIHgxPSI1MCIgeTE9IjYwIiB4Mj0iOTAiIHkyPSI2MCIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSI1IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4NCiAgPGxpbmUgeDE9IjExMCIgeTE9IjYwIiB4Mj0iMTUwIiB5Mj0iNjAiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+DQogIA0KICA8IS0tIEJvY2Egc29ucmllbnRlIC0tPg0KICA8cGF0aCBkPSJNNzAgMTMwIFExMDAgMTYwIDEzMCAxMzAiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+DQogIA0KICA8IS0tIFRleHRvICJNT1pPIiAtLT4NCiAgPHRleHQgeD0iMTAwIiB5PSIxMTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZvbnQtc2l6ZT0iMzQiIGZpbGw9ImJsYWNrIj5NT1pPPC90ZXh0Pg0KPC9zdmc+IA==",alt:"MOZO Logo",class:"logo mb-3"}),l("h1",{class:"h3"},"¿Qué rol tienes?")],-1)),l("div",Gl,[l("div",Yl,[l("div",{class:"role-option static",onClick:t[0]||(t[0]=e=>d("admin"))},t[2]||(t[2]=[l("div",{class:"role-icon"},[l("i",{class:"bi bi-house-door"})],-1),l("h3",{class:"h5 mt-3"},"Dueño",-1)]))]),l("div",Kl,[l("div",{class:"role-option static",onClick:t[1]||(t[1]=e=>d("waiter"))},t[3]||(t[3]=[l("div",{class:"role-icon"},[l("i",{class:"bi bi-person"})],-1),l("h3",{class:"h5 mt-3"},"Mozo",-1)]))])]),l("div",Ql,[l("button",{class:"btn btn-outline-secondary w-100",onClick:u,disabled:i.value||!!s.value},t[4]||(t[4]=[l("i",{class:"bi bi-box-arrow-left me-1"},null,-1),v(" Cerrar sesión ")]),8,Jl)])])])]))}},[["__scopeId","data-v-22e7f38d"]]);const Xl=new class{async callWaiter(e,t={}){const{message:a,urgency:n="normal",client_info:i}=t;try{return(await Ia.callWaiter(e)).data}catch(s){throw console.error("Error calling waiter:",s),this.handleError(s)}}async getPendingCalls(){try{return(await Ia.getPendingCalls()).data}catch(e){throw this.handleError(e)}}async acknowledgCall(e){try{return(await Ia.acknowledgeCall(e)).data}catch(t){throw this.handleError(t)}}async completeCall(e){try{return(await Ia.completeCall(e)).data}catch(t){throw this.handleError(t)}}async getWaiterCallHistory(e="today",t=1,a=20){try{return(await Ia.getWaiterCallHistory({filter:e,page:t,limit:a})).data}catch(n){throw this.handleError(n)}}async getAdminCallHistory(e="today",t=1,a=20){try{return(await Ia.getAdminCallHistory({filter:e,page:t,limit:a})).data}catch(n){throw this.handleError(n)}}async activateTable(e){var t;try{return(await Ia.activateTable(e)).data}catch(a){throw console.error("❌ Error activating table:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data),this.handleError(a)}}async deactivateTable(e){try{return(await Ia.deactivateTable(e)).data}catch(t){throw console.error("Error deactivating table:",t),this.handleError(t)}}async activateMultipleTables(e){var t;try{return(await Ia.activateMultipleTables({table_ids:e})).data}catch(a){throw console.error("❌ Error activating multiple tables:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data),this.handleError(a)}}async deactivateMultipleTables(e){try{return(await Ia.deactivateMultipleTables({table_ids:e})).data}catch(t){throw console.error("Error deactivating multiple tables:",t),this.handleError(t)}}async silenceTable(e,t=30,a=""){var n;const i={duration_minutes:t,notes:"string"==typeof a?a:""};try{const t=await Ia.silenceTable(e,i);return console.log("✅ Respuesta silenciar mesa:",t.data),t.data}catch(s){throw console.error("❌ Error silencing table:",s),console.error("❌ Error details:",null==(n=s.response)?void 0:n.data),this.handleError(s)}}async unsilenceTable(e){var t;console.log("🔊 Quitando silencio de mesa:",e);try{const t=await Ia.unsilenceTable(e);return console.log("✅ Respuesta quitar silencio:",t.data),t.data}catch(a){console.error("❌ Error unsilencing table:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data)}}async silenceMultipleTables(e,t=30,a=""){try{return(await Ia.post("/waiter/tables/silence/multiple",{table_ids:e,duration_minutes:t,notes:a})).data}catch(n){throw console.error("Error silencing multiple tables:",n),this.handleError(n)}}async unsilenceMultipleTables(e){try{return(await Ia.post("/waiter/tables/unsilence/multiple",{table_ids:e})).data}catch(t){throw console.error("Error unsilencing multiple tables:",t),this.handleError(t)}}async getSilencedTables(){try{return(await Ia.getSilencedTables()).data}catch(e){throw console.error("Error getting silenced tables:",e),this.handleError(e)}}async getAssignedTables(){try{return(await Ia.getAssignedTables()).data}catch(e){throw console.error("Error getting assigned tables:",e),this.handleError(e)}}async getAvailableTables(){try{return(await Ia.getAvailableTables()).data}catch(e){throw console.error("Error getting available tables:",e),this.handleError(e)}}async getWaiterBusinesses(){try{return(await Ia.getWaiterBusinesses()).data}catch(e){throw console.error("Error getting waiter businesses:",e),this.handleError(e)}}async setActiveWaiterBusiness(e){try{return(await Ia.setActiveWaiterBusiness(e)).data}catch(t){throw console.error("Error setting active business:",t),this.handleError(t)}}async getActiveWaiterBusiness(){try{return(await Ia.getActiveWaiterBusiness()).data}catch(e){throw console.error("Error getting active business:",e),this.handleError(e)}}async getWaiterBusinessTables(e){var t;try{return(await Ia.getWaiterBusinessTables(e)).data}catch(a){throw console.error("❌ Error getting business tables:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data),this.handleError(a)}}async joinBusinessWithCode(e){try{return(await Ia.joinBusinessWithCode(e)).data}catch(t){throw console.error("Error joining business with code:",t),this.handleError(t)}}async leaveWaiterBusiness(e){try{return(await Ia.leaveWaiterBusiness(e)).data}catch(t){throw console.error("Error leaving business:",t),this.handleError(t)}}async getAdminSilencedTables(){try{return(await Ia.get("/admin/tables/silenced")).data}catch(e){throw console.error("Error getting admin silenced tables:",e),this.handleError(e)}}async adminUnsilenceTable(e){try{return(await Ia.delete(`/admin/tables/${e}/silence`)).data}catch(t){throw console.error("Error admin unsilencing table:",t),this.handleError(t)}}handleError(e){var t;return(null==(t=e.response)?void 0:t.data)?{success:!1,message:e.response.data.message||"Error en la solicitud",code:e.response.status,data:e.response.data}:{success:!1,message:e.message||"Error de conexión",code:"NETWORK_ERROR"}}formatResponseTime(e){if(e<60)return`${e}s`;if(e<3600){const t=Math.floor(e/60),a=e%60;return a>0?`${t}m ${a}s`:`${t}m`}{const t=Math.floor(e/3600),a=Math.floor(e%3600/60);return a>0?`${t}h ${a}m`:`${t}h`}}formatTimeAgo(e){const t=new Date-new Date(e),a=Math.floor(t/6e4);if(a<1)return"Ahora";if(a<60)return`${a}m`;if(a<1440){return`${Math.floor(a/60)}h`}return`${Math.floor(a/1440)}d`}getUrgencyColor(e,t=0){return"high"===e?"#dc3545":t>5?"#fd7e14":"#007bff"}getUrgencyIcon(e,t=0){return"high"===e?"🚨":t>5?"⏰":"🔔"}},ec=Object.freeze(Object.defineProperty({__proto__:null,default:Xl},Symbol.toStringTag,{value:"Module"}));var tc={};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ac="${JSCORE_VERSION}",nc=function(e,t){if(!e)throw ic(t)},ic=function(e){return new Error("Firebase Database ("+ac+") INTERNAL ASSERT FAILED: "+e)},sc=function(e){const t=[];let a=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[a++]=i:i<2048?(t[a++]=i>>6|192,t[a++]=63&i|128):55296==(64512&i)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[a++]=i>>18|240,t[a++]=i>>12&63|128,t[a++]=i>>6&63|128,t[a++]=63&i|128):(t[a++]=i>>12|224,t[a++]=i>>6&63|128,t[a++]=63&i|128)}return t},oc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const a=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,r=i+2<e.length,l=r?e[i+2]:0,c=t>>2,d=(3&t)<<4|o>>4;let u=(15&o)<<2|l>>6,h=63&l;r||(h=64,s||(u=64)),n.push(a[c],a[d],a[u],a[h])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(sc(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let a=0,n=0;for(;a<e.length;){const i=e[a++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[a++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[a++])<<12|(63&e[a++])<<6|63&e[a++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{const s=e[a++],o=e[a++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const a=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<e.length;){const t=a[e.charAt(i++)],s=i<e.length?a[e.charAt(i)]:0;++i;const o=i<e.length?a[e.charAt(i)]:64;++i;const r=i<e.length?a[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==r)throw new rc;const l=t<<2|s>>4;if(n.push(l),64!==o){const e=s<<4&240|o>>2;if(n.push(e),64!==r){const e=o<<6&192|r;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const lc=function(e){const t=sc(e);return oc.encodeByteArray(t,!0)},cc=function(e){return lc(e).replace(/\./g,"")},dc=function(e){try{return oc.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function uc(e){return hc(void 0,e)}function hc(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const a in t)t.hasOwnProperty(a)&&pc(a)&&(e[a]=hc(e[a],t[a]));return e}function pc(e){return"__proto__"!==e}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const mc=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,fc=()=>{try{return mc()||(()=>{if("undefined"==typeof process)return;const e=tc.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(a){return}const t=e&&dc(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},gc=e=>{const t=(e=>{var t,a;return null==(a=null==(t=fc())?void 0:t.emulatorHosts)?void 0:a[e]})(e);if(!t)return;const a=t.lastIndexOf(":");if(a<=0||a+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(a+1),10);return"["===t[0]?[t.substring(1,a-1),n]:[t.substring(0,a),n]},vc=()=>{var e;return null==(e=fc())?void 0:e.config};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class bc{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,a)=>{t?this.reject(t):this.resolve(a),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,a))}}}
/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wc(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function yc(e){return(await fetch(e,{credentials:"include"})).ok}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _c(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const a=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s={iss:`https://securetoken.google.com/${a}`,aud:a,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[cc(JSON.stringify({alg:"none",type:"JWT"})),cc(JSON.stringify(s)),""].join(".")}const Cc={};let kc=!1;function Ec(e,t){if("undefined"==typeof window||"undefined"==typeof document||!wc(window.location.host)||Cc[e]===t||Cc[e]||kc)return;function a(e){return`__firebase__banner__${e}`}Cc[e]=t;const n="__firebase__banner",i=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(Cc))Cc[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{kc=!0,function(){const e=document.getElementById(n);e&&e.remove()}()},e}function o(){const e=function(e){let t=document.getElementById(e),a=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),a=!0),{created:a,element:t}}(n),t=a("text"),o=document.getElementById(t)||document.createElement("span"),r=a("learnmore"),l=document.getElementById(r)||document.createElement("a"),c=a("preprendIcon"),d=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(l,r);const a=s();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(d,c),t.append(d,o,l,a),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",d.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(d.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sc(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function Tc(){try{return"object"==typeof indexedDB}catch(e){return!1}}function Ic(){return new Promise((e,t)=>{try{let a=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),a||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{a=!1},i.onerror=()=>{var e;t((null==(e=i.error)?void 0:e.message)||"")}}catch(a){t(a)}})}function Nc(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc extends Error{constructor(e,t,a){super(t),this.code=e,this.customData=a,this.name="FirebaseError",Object.setPrototypeOf(this,xc.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ac.prototype.create)}}class Ac{constructor(e,t,a){this.service=e,this.serviceName=t,this.errors=a}create(e,...t){const a=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(Pc,(e,a)=>{const n=t[a];return null!=n?String(n):`<${a}?>`})}(i,a):"Error",o=`${this.serviceName}: ${s} (${n}).`;return new xc(n,o,a)}}const Pc=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rc(e){return JSON.parse(e)}function Dc(e){return JSON.stringify(e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mc=function(e){let t={},a={},n={},i="";try{const s=e.split(".");t=Rc(dc(s[0])||""),a=Rc(dc(s[1])||""),i=s[2],n=a.d||{},delete a.d}catch(s){}return{header:t,claims:a,data:n,signature:i}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Lc(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Oc(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function Fc(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Uc(e,t,a){const n={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=t.call(a,e[i],i,e));return n}function Bc(e,t){if(e===t)return!0;const a=Object.keys(e),n=Object.keys(t);for(const i of a){if(!n.includes(i))return!1;const a=e[i],s=t[i];if(qc(a)&&qc(s)){if(!Bc(a,s))return!1}else if(a!==s)return!1}for(const i of n)if(!a.includes(i))return!1;return!0}function qc(e){return null!==e&&"object"==typeof e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class jc{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const a=this.W_;if("string"==typeof e)for(let d=0;d<16;d++)a[d]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let d=0;d<16;d++)a[d]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let d=16;d<80;d++){const e=a[d-3]^a[d-8]^a[d-14]^a[d-16];a[d]=4294967295&(e<<1|e>>>31)}let n,i,s=this.chain_[0],o=this.chain_[1],r=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let d=0;d<80;d++){d<40?d<20?(n=l^o&(r^l),i=1518500249):(n=o^r^l,i=1859775393):d<60?(n=o&r|l&(o|r),i=2400959708):(n=o^r^l,i=3395469782);const e=(s<<5|s>>>27)+n+c+i+a[d]&4294967295;c=l,l=r,r=4294967295&(o<<30|o>>>2),o=s,s=e}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+r&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const a=t-this.blockSize;let n=0;const i=this.buf_;let s=this.inbuf_;for(;n<t;){if(0===s)for(;n<=a;)this.compress_(e,n),n+=this.blockSize;if("string"==typeof e){for(;n<t;)if(i[s]=e.charCodeAt(n),++s,++n,s===this.blockSize){this.compress_(i),s=0;break}}else for(;n<t;)if(i[s]=e[n],++s,++n,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);let a=0;for(let n=0;n<5;n++)for(let t=24;t>=0;t-=8)e[a]=this.chain_[n]>>t&255,++a;return e}}function $c(e,t){return`${e} failed: ${t} argument `}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zc=function(e){let t=0;for(let a=0;a<e.length;a++){const n=e.charCodeAt(a);n<128?t++:n<2048?t+=2:n>=55296&&n<=56319?(t+=4,a++):t+=3}return t};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Vc(e){return e&&e._delegate?e._delegate:e}class Wc{constructor(e,t,a){this.name=e,this.instanceFactory=t,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hc="[DEFAULT]";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new bc;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&e.resolve(a)}catch(a){}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),a=(null==e?void 0:e.optional)??!1;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(a)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(n){if(a)return null;throw n}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e))try{this.getOrInitializeService({instanceIdentifier:Hc})}catch(t){}for(const[e,a]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});a.resolve(e)}catch(t){}}}}clearInstance(e=Hc){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=Hc){return this.instances.has(e)}getOptions(e=Hc){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:a,options:t});for(const[i,s]of this.instancesDeferred.entries()){a===this.normalizeInstanceIdentifier(i)&&s.resolve(n)}return n}onInit(e,t){const a=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(a)??new Set;n.add(e),this.onInitCallbacks.set(a,n);const i=this.instances.get(a);return i&&e(i,a),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){const a=this.onInitCallbacks.get(t);if(a)for(const n of a)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===Hc?void 0:n),options:t}),this.instances.set(e,a),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}var n;return a||null}normalizeInstanceIdentifier(e=Hc){return this.component?this.component.multipleInstances?e:Hc:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Yc{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Gc(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kc,Qc;(Qc=Kc||(Kc={}))[Qc.DEBUG=0]="DEBUG",Qc[Qc.VERBOSE=1]="VERBOSE",Qc[Qc.INFO=2]="INFO",Qc[Qc.WARN=3]="WARN",Qc[Qc.ERROR=4]="ERROR",Qc[Qc.SILENT=5]="SILENT";const Jc={debug:Kc.DEBUG,verbose:Kc.VERBOSE,info:Kc.INFO,warn:Kc.WARN,error:Kc.ERROR,silent:Kc.SILENT},Zc=Kc.INFO,Xc={[Kc.DEBUG]:"log",[Kc.VERBOSE]:"log",[Kc.INFO]:"info",[Kc.WARN]:"warn",[Kc.ERROR]:"error"},ed=(e,t,...a)=>{if(t<e.logLevel)return;const n=(new Date).toISOString(),i=Xc[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${n}]  ${e.name}:`,...a)};class td{constructor(e){this.name=e,this._logLevel=Zc,this._logHandler=ed,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Kc))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?Jc[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Kc.DEBUG,...e),this._logHandler(this,Kc.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Kc.VERBOSE,...e),this._logHandler(this,Kc.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Kc.INFO,...e),this._logHandler(this,Kc.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Kc.WARN,...e),this._logHandler(this,Kc.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Kc.ERROR,...e),this._logHandler(this,Kc.ERROR,...e)}}let ad,nd;const id=new WeakMap,sd=new WeakMap,od=new WeakMap,rd=new WeakMap,ld=new WeakMap;let cd={get(e,t,a){if(e instanceof IDBTransaction){if("done"===t)return sd.get(e);if("objectStoreNames"===t)return e.objectStoreNames||od.get(e);if("store"===t)return a.objectStoreNames[1]?void 0:a.objectStore(a.objectStoreNames[0])}return hd(e[t])},set:(e,t,a)=>(e[t]=a,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function dd(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(nd||(nd=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(pd(this),t),hd(id.get(this))}:function(...t){return hd(e.apply(pd(this),t))}:function(t,...a){const n=e.call(pd(this),t,...a);return od.set(n,t.sort?t.sort():[t]),hd(n)}}function ud(e){return"function"==typeof e?dd(e):(e instanceof IDBTransaction&&function(e){if(sd.has(e))return;const t=new Promise((t,a)=>{const n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{a(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});sd.set(e,t)}(e),t=e,(ad||(ad=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,cd):e);var t}function hd(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,a)=>{const n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(hd(e.result)),n()},s=()=>{a(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&id.set(t,e)}).catch(()=>{}),ld.set(t,e),t}(e);if(rd.has(e))return rd.get(e);const t=ud(e);return t!==e&&(rd.set(e,t),ld.set(t,e)),t}const pd=e=>ld.get(e);function md(e,t,{blocked:a,upgrade:n,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),r=hd(o);return n&&o.addEventListener("upgradeneeded",e=>{n(hd(o.result),e.oldVersion,e.newVersion,hd(o.transaction),e)}),a&&o.addEventListener("blocked",e=>a(e.oldVersion,e.newVersion,e)),r.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),r}function fd(e,{blocked:t}={}){const a=indexedDB.deleteDatabase(e);return t&&a.addEventListener("blocked",e=>t(e.oldVersion,e)),hd(a).then(()=>{})}const gd=["get","getKey","getAll","getAllKeys","count"],vd=["put","add","delete","clear"],bd=new Map;function wd(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(bd.get(t))return bd.get(t);const a=t.replace(/FromIndex$/,""),n=t!==a,i=vd.includes(a);if(!(a in(n?IDBIndex:IDBObjectStore).prototype)||!i&&!gd.includes(a))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[a](...t),i&&s.done]))[0]};return bd.set(t,s),s}cd=(e=>({...e,get:(t,a,n)=>wd(t,a)||e.get(t,a,n),has:(t,a)=>!!wd(t,a)||e.has(t,a)}))(cd);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class yd{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const _d="@firebase/app",Cd="0.14.1",kd=new td("@firebase/app"),Ed="@firebase/app-compat",Sd="@firebase/analytics-compat",Td="@firebase/analytics",Id="@firebase/app-check-compat",Nd="@firebase/app-check",xd="@firebase/auth",Ad="@firebase/auth-compat",Pd="@firebase/database",Rd="@firebase/data-connect",Dd="@firebase/database-compat",Md="@firebase/functions",Ld="@firebase/functions-compat",Od="@firebase/installations",Fd="@firebase/installations-compat",Ud="@firebase/messaging",Bd="@firebase/messaging-compat",qd="@firebase/performance",jd="@firebase/performance-compat",$d="@firebase/remote-config",zd="@firebase/remote-config-compat",Vd="@firebase/storage",Wd="@firebase/storage-compat",Hd="@firebase/firestore",Gd="@firebase/ai",Yd="@firebase/firestore-compat",Kd="firebase",Qd="[DEFAULT]",Jd={[_d]:"fire-core",[Ed]:"fire-core-compat",[Td]:"fire-analytics",[Sd]:"fire-analytics-compat",[Nd]:"fire-app-check",[Id]:"fire-app-check-compat",[xd]:"fire-auth",[Ad]:"fire-auth-compat",[Pd]:"fire-rtdb",[Rd]:"fire-data-connect",[Dd]:"fire-rtdb-compat",[Md]:"fire-fn",[Ld]:"fire-fn-compat",[Od]:"fire-iid",[Fd]:"fire-iid-compat",[Ud]:"fire-fcm",[Bd]:"fire-fcm-compat",[qd]:"fire-perf",[jd]:"fire-perf-compat",[$d]:"fire-rc",[zd]:"fire-rc-compat",[Vd]:"fire-gcs",[Wd]:"fire-gcs-compat",[Hd]:"fire-fst",[Yd]:"fire-fst-compat",[Gd]:"fire-vertex","fire-js":"fire-js",[Kd]:"fire-js-all"},Zd=new Map,Xd=new Map,eu=new Map;function tu(e,t){try{e.container.addComponent(t)}catch(a){kd.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,a)}}function au(e){const t=e.name;if(eu.has(t))return kd.debug(`There were multiple attempts to register component ${t}.`),!1;eu.set(t,e);for(const a of Zd.values())tu(a,e);for(const a of Xd.values())tu(a,e);return!0}function nu(e,t){const a=e.container.getProvider("heartbeat").getImmediate({optional:!0});return a&&a.triggerHeartbeat(),e.container.getProvider(t)}function iu(e){return null!=e&&void 0!==e.settings}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const su=new Ac("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ou{constructor(e,t,a){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Wc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw su.create("app-deleted",{appName:this._name})}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ru="12.1.0";function lu(e,t={}){let a=e;if("object"!=typeof t){t={name:t}}const n={name:Qd,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw su.create("bad-app-name",{appName:String(i)});if(a||(a=vc()),!a)throw su.create("no-options");const s=Zd.get(i);if(s){if(Bc(a,s.options)&&Bc(n,s.config))return s;throw su.create("duplicate-app",{appName:i})}const o=new Yc(i);for(const l of eu.values())o.addComponent(l);const r=new ou(a,n,o);return Zd.set(i,r),r}function cu(e=Qd){const t=Zd.get(e);if(!t&&e===Qd&&vc())return lu();if(!t)throw su.create("no-app",{appName:e});return t}function du(e,t,a){let n=Jd[e]??e;a&&(n+=`-${a}`);const i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){const e=[`Unable to register library "${n}" with version "${t}":`];return i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void kd.warn(e.join(" "))}au(new Wc(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uu="firebase-heartbeat-store";let hu=null;function pu(){return hu||(hu=md("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(uu)}catch(a){console.warn(a)}}}).catch(e=>{throw su.create("idb-open",{originalErrorMessage:e.message})})),hu}async function mu(e,t){try{const a=(await pu()).transaction(uu,"readwrite"),n=a.objectStore(uu);await n.put(t,fu(e)),await a.done}catch(a){if(a instanceof xc)kd.warn(a.message);else{const e=su.create("idb-set",{originalErrorMessage:null==a?void 0:a.message});kd.warn(e.message)}}}function fu(e){return`${e.name}!${e.options.appId}`}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gu{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new bu(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=vu();if(null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:a}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,a=e[0].date;for(let n=1;n<e.length;n++)e[n].date<a&&(a=e[n].date,t=n);return t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){kd.warn(a)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=vu(),{heartbeatsToSend:a,unsentEntries:n}=function(e,t=1024){const a=[];let n=e.slice();for(const i of e){const e=a.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),wu(a)>t){e.dates.pop();break}}else if(a.push({agent:i.agent,dates:[i.date]}),wu(a)>t){a.pop();break}n=n.slice(1)}return{heartbeatsToSend:a,unsentEntries:n}}(this._heartbeatsCache.heartbeats),i=cc(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return kd.warn(t),""}}}function vu(){return(new Date).toISOString().substring(0,10)}class bu{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Tc()&&Ic().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await pu()).transaction(uu),a=await t.objectStore(uu).get(fu(e));return await t.done,a}catch(t){if(t instanceof xc)kd.warn(t.message);else{const e=su.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});kd.warn(e.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return mu(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return mu(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function wu(e){return cc(JSON.stringify({version:2,heartbeats:e})).length}var yu;yu="",au(new Wc("platform-logger",e=>new yd(e),"PRIVATE")),au(new Wc("heartbeat",e=>new gu(e),"PRIVATE")),du(_d,Cd,yu),du(_d,Cd,"esm2020"),du("fire-js","");var _u={};const Cu="@firebase/database",ku="1.1.0";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let Eu="";function Su(e){Eu=e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tu{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Dc(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Rc(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iu{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Lc(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nu=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Tu(t)}}catch(t){}return new Iu},xu=Nu("localStorage"),Au=Nu("sessionStorage"),Pu=new td("@firebase/database"),Ru=function(){let e=1;return function(){return e++}}(),Du=function(e){const t=function(e){const t=[];let a=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);if(i>=55296&&i<=56319){const t=i-55296;n++,nc(n<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(n)-56320)}i<128?t[a++]=i:i<2048?(t[a++]=i>>6|192,t[a++]=63&i|128):i<65536?(t[a++]=i>>12|224,t[a++]=i>>6&63|128,t[a++]=63&i|128):(t[a++]=i>>18|240,t[a++]=i>>12&63|128,t[a++]=i>>6&63|128,t[a++]=63&i|128)}return t}(e),a=new jc;a.update(t);const n=a.digest();return oc.encodeByteArray(n)},Mu=function(...e){let t="";for(let a=0;a<e.length;a++){const n=e[a];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=Mu.apply(null,n):t+="object"==typeof n?Dc(n):n,t+=" "}return t};let Lu=null,Ou=!0;const Fu=function(...e){if(!0===Ou&&(Ou=!1,null===Lu&&!0===Au.get("logging_enabled")&&(nc(!0,"Can't turn on custom loggers persistently."),Pu.logLevel=Kc.VERBOSE,Lu=Pu.log.bind(Pu))),Lu){const t=Mu.apply(null,e);Lu(t)}},Uu=function(e){return function(...t){Fu(e,...t)}},Bu=function(...e){const t="FIREBASE INTERNAL ERROR: "+Mu(...e);Pu.error(t)},qu=function(...e){const t=`FIREBASE FATAL ERROR: ${Mu(...e)}`;throw Pu.error(t),new Error(t)},ju=function(...e){const t="FIREBASE WARNING: "+Mu(...e);Pu.warn(t)},$u=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},zu="[MIN_NAME]",Vu="[MAX_NAME]",Wu=function(e,t){if(e===t)return 0;if(e===zu||t===Vu)return-1;if(t===zu||e===Vu)return 1;{const a=Xu(e),n=Xu(t);return null!==a?null!==n?a-n===0?e.length-t.length:a-n:-1:null!==n?1:e<t?-1:1}},Hu=function(e,t){return e===t?0:e<t?-1:1},Gu=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Dc(t))},Yu=function(e){if("object"!=typeof e||null===e)return Dc(e);const t=[];for(const n in e)t.push(n);t.sort();let a="{";for(let n=0;n<t.length;n++)0!==n&&(a+=","),a+=Dc(t[n]),a+=":",a+=Yu(e[t[n]]);return a+="}",a},Ku=function(e,t){const a=e.length;if(a<=t)return[e];const n=[];for(let i=0;i<a;i+=t)i+t>a?n.push(e.substring(i,a)):n.push(e.substring(i,i+t));return n};function Qu(e,t){for(const a in e)e.hasOwnProperty(a)&&t(a,e[a])}const Ju=function(e){nc(!$u(e),"Invalid JSON number");const t=1023;let a,n,i,s,o;0===e?(n=0,i=0,a=1/e==-1/0?1:0):(a=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),t),n=s+t,i=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(n=0,i=Math.round(e/Math.pow(2,-1074))));const r=[];for(o=52;o;o-=1)r.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;o-=1)r.push(n%2?1:0),n=Math.floor(n/2);r.push(a?1:0),r.reverse();const l=r.join("");let c="";for(o=0;o<64;o+=8){let e=parseInt(l.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()};const Zu=new RegExp("^-?(0*)\\d{1,10}$"),Xu=function(e){if(Zu.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},eh=function(e){try{e()}catch(t){setTimeout(()=>{const e=t.stack||"";throw ju("Exception was thrown by user callback.",e),t},Math.floor(0))}},th=function(e,t){const a=setTimeout(e,t);return"number"==typeof a&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(a):"object"==typeof a&&a.unref&&a.unref(),a};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ah{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,iu(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,a)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,a):t(null)},0)})}addTokenChangeListener(e){var t;null==(t=this.appCheckProvider)||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){ju(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(e,t,a){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=a,this.auth_=null,this.auth_=a.getImmediate({optional:!0}),this.auth_||a.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(Fu("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,a)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,a):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ju(e)}}class ih{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}ih.OWNER="owner";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const sh=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,oh="ac",rh="websocket",lh="long_polling";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ch{constructor(e,t,a,n,i=!1,s="",o=!1,r=!1,l=null){this.secure=t,this.namespace=a,this.webSocketOnly=n,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=r,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=xu.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&xu.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function dh(e,t,a){let n;if(nc("string"==typeof t,"typeof type must == string"),nc("object"==typeof a,"typeof params must == object"),t===rh)n=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==lh)throw new Error("Unknown connection type: "+t);n=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(a.ns=e.namespace);const i=[];return Qu(a,(e,t)=>{i.push(e+"="+t)}),n+i.join("&")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uh{constructor(){this.counters_={}}incrementCounter(e,t=1){Lc(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return uc(this.counters_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hh={},ph={};function mh(e){const t=e.toString();return hh[t]||(hh[t]=new uh),hh[t]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class fh{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&eh(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gh="start";class vh{constructor(e,t,a,n,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=a,this.appCheckToken=n,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Uu(e),this.stats_=mh(t),this.urlFn=e=>(this.appCheckToken&&(e[oh]=this.appCheckToken),dh(t,lh,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new fh(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const a=function(){document.body?t||(t=!0,e()):setTimeout(a,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&a()}),window.attachEvent("onload",a))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new bh((...e)=>{const[t,a,n,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===gh)this.id=a,this.password=n;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{const[t,a]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,a)},()=>{this.onClosed_()},this.urlFn);const e={};e[gh]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[oh]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&sh.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){vh.forceAllow_=!0}static forceDisallow(){vh.forceDisallow_=!0}static isAvailable(){return!!vh.forceAllow_||!(vh.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Dc(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const a=lc(t),n=Ku(a,1840);for(let i=0;i<n.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const a={dframe:"t"};a.id=e,a.pw=t,this.myDisconnFrame.src=this.urlFn(a),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Dc(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class bh{constructor(e,t,a,n){this.onDisconnect=a,this.urlFn=n,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Ru(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=bh.createIFrame_();let a="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){a='<script>document.domain="'+document.domain+'";<\/script>'}const n="<html><body>"+a+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(n),this.myIFrame.doc.close()}catch(i){Fu("frame writing exception"),i.stack&&Fu(i.stack),Fu(i)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Fu("No IE domain setting required")}catch(t){const a=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+a+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),a="",n=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+a.length<=1870))break;{const e=this.pendingSegs.shift();a=a+"&seg"+n+"="+e.seg+"&ts"+n+"="+e.ts+"&d"+n+"="+e.d,n++}}return t+=a,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,a){this.pendingSegs.push({seg:e,ts:t,d:a}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const a=()=>{this.outstandingRequests.delete(t),this.newRequest_()},n=setTimeout(a,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(n),a()})}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const a=this.myIFrame.doc.createElement("script");a.type="text/javascript",a.async=!0,a.src=e,a.onload=a.onreadystatechange=function(){const e=a.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,a.parentNode&&a.parentNode.removeChild(a),t())},a.onerror=()=>{Fu("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(a)}catch(a){}},Math.floor(1))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wh=null;"undefined"!=typeof MozWebSocket?wh=MozWebSocket:"undefined"!=typeof WebSocket&&(wh=WebSocket);class yh{constructor(e,t,a,n,i,s,o){this.connId=e,this.applicationId=a,this.appCheckToken=n,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Uu(this.connId),this.stats_=mh(t),this.connURL=yh.connectionURL_(t,s,o,n,a),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,a,n,i){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&sh.test(location.hostname)&&(s.r="f"),t&&(s.s=t),a&&(s.ls=a),n&&(s[oh]=n),i&&(s.p=i),dh(e,rh,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,xu.set("previous_websocket_failure",!0);try{let e;this.mySock=new wh(this.connURL,[],e)}catch(a){this.log_("Error instantiating WebSocket.");const e=a.message||a.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){yh.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,a=navigator.userAgent.match(t);a&&a.length>1&&parseFloat(a[1])<4.4&&(e=!0)}return!e&&null!==wh&&!yh.forceDisallow_}static previouslyFailed(){return xu.isInMemoryStorage||!0===xu.get("previous_websocket_failure")}markConnectionHealthy(){xu.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=Rc(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(nc(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=Dc(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const a=Ku(t,16384);a.length>1&&this.sendString_(String(a.length));for(let n=0;n<a.length;n++)this.sendString_(a[n])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}yh.responsesRequiredToBeHealthy=2,yh.healthyTimeout=3e4;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class _h{static get ALL_TRANSPORTS(){return[vh,yh]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=yh&&yh.isAvailable();let a=t&&!yh.previouslyFailed();if(e.webSocketOnly&&(t||ju("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),a=!0),a)this.transports_=[yh];else{const e=this.transports_=[];for(const t of _h.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);_h.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}_h.globalTransportInitialized_=!1;class Ch{constructor(e,t,a,n,i,s,o,r,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=a,this.appCheckToken_=n,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=r,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Uu("c:"+this.id+":"),this.transportManager_=new _h(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),a=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,a)},Math.floor(0));const n=e.healthyTimeout||0;n>0&&(this.healthyTimeout_=th(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(n)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Gu("t",e),a=Gu("d",e);if("c"===t)this.onSecondaryControl_(a);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(a)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Gu("t",e),a=Gu("d",e);"c"===t?this.onControl_(a):"d"===t&&this.onDataMessage_(a)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Gu("t",e);if("d"in e){const a=e.d;if("h"===t){const e={...a};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(a):"r"===t?this.onReset_(a):"e"===t?Bu("Server Error: "+a):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Bu("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,a=e.v,n=e.h;this.sessionId=e.s,this.repoInfo_.host=n,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==a&&ju("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),a=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,a),th(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):th(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(xu.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kh{put(e,t,a,n){}merge(e,t,a,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,a){}onDisconnectMerge(e,t,a){}onDisconnectCancel(e,t){}reportStats(e){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eh{constructor(e){this.allowedEvents_=e,this.listeners_={},nc(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const a=[...this.listeners_[e]];for(let e=0;e<a.length;e++)a[e].callback.apply(a[e].context,t)}}on(e,t,a){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:a});const n=this.getInitialEvent(e);n&&t.apply(a,n)}off(e,t,a){this.validateEventType_(e);const n=this.listeners_[e]||[];for(let i=0;i<n.length;i++)if(n[i].callback===t&&(!a||a===n[i].context))return void n.splice(i,1)}validateEventType_(e){nc(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sh extends Eh{static getInstance(){return new Sh}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Sc()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return nc("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Th{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Ih(){return new Th("")}function Nh(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function xh(e){return e.pieces_.length-e.pieceNum_}function Ah(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Th(e.pieces_,t)}function Ph(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Rh(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Dh(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let a=e.pieceNum_;a<e.pieces_.length-1;a++)t.push(e.pieces_[a]);return new Th(t,0)}function Mh(e,t){const a=[];for(let n=e.pieceNum_;n<e.pieces_.length;n++)a.push(e.pieces_[n]);if(t instanceof Th)for(let n=t.pieceNum_;n<t.pieces_.length;n++)a.push(t.pieces_[n]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&a.push(e[t])}return new Th(a,0)}function Lh(e){return e.pieceNum_>=e.pieces_.length}function Oh(e,t){const a=Nh(e),n=Nh(t);if(null===a)return t;if(a===n)return Oh(Ah(e),Ah(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Fh(e,t){if(xh(e)!==xh(t))return!1;for(let a=e.pieceNum_,n=t.pieceNum_;a<=e.pieces_.length;a++,n++)if(e.pieces_[a]!==t.pieces_[n])return!1;return!0}function Uh(e,t){let a=e.pieceNum_,n=t.pieceNum_;if(xh(e)>xh(t))return!1;for(;a<e.pieces_.length;){if(e.pieces_[a]!==t.pieces_[n])return!1;++a,++n}return!0}class Bh{constructor(e,t){this.errorPrefix_=t,this.parts_=Rh(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let a=0;a<this.parts_.length;a++)this.byteLength_+=zc(this.parts_[a]);qh(this)}}function qh(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+jh(e))}function jh(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $h extends Eh{static getInstance(){return new $h}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return nc("visible"===e,"Unknown event type: "+e),[this.visible_]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zh=1e3;class Vh extends kh{constructor(e,t,a,n,i,s,o,r){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=a,this.onConnectStatus_=n,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=r,this.id=Vh.nextPersistentConnectionId_++,this.log_=Uu("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=zh,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,r)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");$h.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Sh.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,a){const n=++this.requestNumber_,i={r:n,a:e,b:t};this.log_(Dc(i)),nc(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),a&&(this.requestCBHash_[n]=a)}get(e){this.initConnection_();const t=new bc,a={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const a=e.d;"ok"===e.s?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(a),this.outstandingGetCount_++;const n=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(n),t.promise}listen(e,t,a,n){this.initConnection_();const i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),nc(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),nc(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");const o={onComplete:n,hashFn:t,query:e,tag:a};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,a=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(a)})}sendListen_(e){const t=e.query,a=t._path.toString(),n=t._queryIdentifier;this.log_("Listen on "+a+" for "+n);const i={p:a};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,i=>{const s=i.d,o=i.s;Vh.warnOnListenWarnings_(s,t);(this.listens.get(a)&&this.listens.get(a).get(n))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(a,n),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&Lc(e,"w")){const a=Oc(e,"w");if(Array.isArray(a)&&~a.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',a=t._path.toString();ju(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${a} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=Mc(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=Mc(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",a={cred:e};null===this.authOverride_?a.noauth=!0:"object"==typeof this.authOverride_&&(a.authvar=this.authOverride_),this.sendRequest(t,a,t=>{const a=t.s,n=t.d||"error";this.authToken_===e&&("ok"===a?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(a,n))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,a=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,a)})}unlisten(e,t){const a=e._path.toString(),n=e._queryIdentifier;this.log_("Unlisten called for "+a+" "+n),nc(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(a,n)&&this.connected_&&this.sendUnlisten_(a,n,e._queryObject,t)}sendUnlisten_(e,t,a,n){this.log_("Unlisten on "+e+" for "+t);const i={p:e};n&&(i.q=a,i.t=n),this.sendRequest("n",i)}onDisconnectPut(e,t,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,a):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:a})}onDisconnectMerge(e,t,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,a):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:a})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,a,n){const i={p:t,d:a};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{n&&setTimeout(()=>{n(e.s,e.d)},Math.floor(0))})}put(e,t,a,n){this.putInternal("p",e,t,a,n)}merge(e,t,a,n){this.putInternal("m",e,t,a,n)}putInternal(e,t,a,n,i){this.initConnection_();const s={p:t,d:a};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:n}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,a=this.outstandingPuts_[e].request,n=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,a,a=>{this.log_(t+" response",a),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),n&&n(a.s,a.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Dc(e));const t=e.r,a=this.requestCBHash_[t];a&&(delete this.requestCBHash_[t],a(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Bu("Unrecognized action received from server: "+Dc(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){nc(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=zh,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=zh,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=zh),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),a=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Vh.nextConnectionId_++,s=this.lastSessionId;let o=!1,r=null;const l=function(){r?r.close():(o=!0,n())},c=function(e){nc(r,"sendRequest call when we're not connected not allowed."),r.sendRequest(e)};this.realtime_={close:l,sendRequest:c};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[e,l]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);o?Fu("getToken() completed but was canceled"):(Fu("getToken() completed. Creating connection."),this.authToken_=e&&e.accessToken,this.appCheckToken_=l&&l.token,r=new Ch(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,a,n,e=>{ju(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&ju(e),l())}}}interrupt(e){Fu("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Fu("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Fc(this.interruptReasons_)&&(this.reconnectDelay_=zh,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let a;a=t?t.map(e=>Yu(e)).join("$"):"default";const n=this.removeListen_(e,a);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(e,t){const a=new Th(e).toString();let n;if(this.listens.has(a)){const e=this.listens.get(a);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(a)}else n=void 0;return n}onAuthRevoked_(e,t){Fu("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Fu("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+Eu.replace(/\./g,"-")]=1,Sc()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Sh.getInstance().currentlyOnline();return Fc(this.interruptReasons_)&&e}}Vh.nextPersistentConnectionId_=0,Vh.nextConnectionId_=0;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Wh{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Wh(e,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hh{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const a=new Wh(zu,e),n=new Wh(zu,t);return 0!==this.compare(a,n)}minPost(){return Wh.MIN}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gh;class Yh extends Hh{static get __EMPTY_NODE(){return Gh}static set __EMPTY_NODE(e){Gh=e}compare(e,t){return Wu(e.name,t.name)}isDefinedOn(e){throw ic("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Wh.MIN}maxPost(){return new Wh(Vu,Gh)}makePost(e,t){return nc("string"==typeof e,"KeyIndex indexValue must always be a string."),new Wh(e,Gh)}toString(){return".key"}}const Kh=new Yh;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qh{constructor(e,t,a,n,i=null){this.isReverse_=n,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?a(e.key,t):1,n&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Jh{constructor(e,t,a,n,i){this.key=e,this.value=t,this.color=null!=a?a:Jh.RED,this.left=null!=n?n:Zh.EMPTY_NODE,this.right=null!=i?i:Zh.EMPTY_NODE}copy(e,t,a,n,i){return new Jh(null!=e?e:this.key,null!=t?t:this.value,null!=a?a:this.color,null!=n?n:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,a){let n=this;const i=a(e,n.key);return n=i<0?n.copy(null,null,null,n.left.insert(e,t,a),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,a)),n.fixUp_()}removeMin_(){if(this.left.isEmpty())return Zh.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let a,n;if(a=this,t(e,a.key)<0)a.left.isEmpty()||a.left.isRed_()||a.left.left.isRed_()||(a=a.moveRedLeft_()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed_()&&(a=a.rotateRight_()),a.right.isEmpty()||a.right.isRed_()||a.right.left.isRed_()||(a=a.moveRedRight_()),0===t(e,a.key)){if(a.right.isEmpty())return Zh.EMPTY_NODE;n=a.right.min_(),a=a.copy(n.key,n.value,null,null,a.right.removeMin_())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Jh.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Jh.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Jh.RED=!0,Jh.BLACK=!1;class Zh{constructor(e,t=Zh.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Zh(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Jh.BLACK,null,null))}remove(e){return new Zh(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Jh.BLACK,null,null))}get(e){let t,a=this.root_;for(;!a.isEmpty();){if(t=this.comparator_(e,a.key),0===t)return a.value;t<0?a=a.left:t>0&&(a=a.right)}return null}getPredecessorKey(e){let t,a=this.root_,n=null;for(;!a.isEmpty();){if(t=this.comparator_(e,a.key),0===t){if(a.left.isEmpty())return n?n.key:null;for(a=a.left;!a.right.isEmpty();)a=a.right;return a.key}t<0?a=a.left:t>0&&(n=a,a=a.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Qh(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Qh(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Qh(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Qh(this.root_,null,this.comparator_,!0,e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Xh(e,t){return Wu(e.name,t.name)}function ep(e,t){return Wu(e,t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tp;Zh.EMPTY_NODE=new class{copy(e,t,a,n,i){return this}insert(e,t,a){return new Jh(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const ap=function(e){return"number"==typeof e?"number:"+Ju(e):"string:"+e},np=function(e){if(e.isLeafNode()){const t=e.val();nc("string"==typeof t||"number"==typeof t||"object"==typeof t&&Lc(t,".sv"),"Priority must be a string or number.")}else nc(e===tp||e.isEmpty(),"priority of unexpected type.");nc(e===tp||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let ip,sp,op;class rp{static set __childrenNodeConstructor(e){ip=e}static get __childrenNodeConstructor(){return ip}constructor(e,t=rp.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,nc(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),np(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new rp(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:rp.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Lh(e)?this:".priority"===Nh(e)?this.priorityNode_:rp.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:rp.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const a=Nh(e);return null===a?t:t.isEmpty()&&".priority"!==a?this:(nc(".priority"!==a||1===xh(e),".priority must be the last token in a path"),this.updateImmediateChild(a,rp.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ah(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+ap(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?Ju(this.value_):this.value_,this.lazyHash_=Du(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===rp.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof rp.__childrenNodeConstructor?-1:(nc(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,a=typeof this.value_,n=rp.VALUE_TYPE_ORDER.indexOf(t),i=rp.VALUE_TYPE_ORDER.indexOf(a);return nc(n>=0,"Unknown leaf type: "+t),nc(i>=0,"Unknown leaf type: "+a),n===i?"object"===a?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-n}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}rp.VALUE_TYPE_ORDER=["object","boolean","number","string"];const lp=new class extends Hh{compare(e,t){const a=e.node.getPriority(),n=t.node.getPriority(),i=a.compareTo(n);return 0===i?Wu(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Wh.MIN}maxPost(){return new Wh(Vu,new rp("[PRIORITY-POST]",op))}makePost(e,t){const a=sp(e);return new Wh(t,new rp("[PRIORITY-POST]",a))}toString(){return".priority"}},cp=Math.log(2);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dp{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/cp,10)),this.current_=this.count-1;const a=(n=this.count,parseInt(Array(n+1).join("1"),2));var n;this.bits_=e+1&a}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const up=function(e,t,a,n){e.sort(t);const i=function(t,n){const s=n-t;let o,r;if(0===s)return null;if(1===s)return o=e[t],r=a?a(o):o,new Jh(r,o.node,Jh.BLACK,null,null);{const l=parseInt(s/2,10)+t,c=i(t,l),d=i(l+1,n);return o=e[l],r=a?a(o):o,new Jh(r,o.node,Jh.BLACK,c,d)}},s=function(t){let n=null,s=null,o=e.length;const r=function(t,n){const s=o-t,r=o;o-=t;const c=i(s+1,r),d=e[s],u=a?a(d):d;l(new Jh(u,d.node,n,null,c))},l=function(e){n?(n.left=e,n=e):(s=e,n=e)};for(let e=0;e<t.count;++e){const a=t.nextBitIsOne(),n=Math.pow(2,t.count-(e+1));a?r(n,Jh.BLACK):(r(n,Jh.BLACK),r(n,Jh.RED))}return s}(new dp(e.length));return new Zh(n||t,s)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hp;const pp={};class mp{static get Default(){return nc(pp&&lp,"ChildrenNode.ts has not been loaded"),hp=hp||new mp({".priority":pp},{".priority":lp}),hp}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Oc(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Zh?t:null}hasIndex(e){return Lc(this.indexSet_,e.toString())}addIndex(e,t){nc(e!==Kh,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const a=[];let n=!1;const i=t.getIterator(Wh.Wrap);let s,o=i.getNext();for(;o;)n=n||e.isDefinedOn(o.node),a.push(o),o=i.getNext();s=n?up(a,e.getCompare()):pp;const r=e.toString(),l={...this.indexSet_};l[r]=e;const c={...this.indexes_};return c[r]=s,new mp(c,l)}addToIndexes(e,t){const a=Uc(this.indexes_,(a,n)=>{const i=Oc(this.indexSet_,n);if(nc(i,"Missing index implementation for "+n),a===pp){if(i.isDefinedOn(e.node)){const a=[],n=t.getIterator(Wh.Wrap);let s=n.getNext();for(;s;)s.name!==e.name&&a.push(s),s=n.getNext();return a.push(e),up(a,i.getCompare())}return pp}{const n=t.get(e.name);let i=a;return n&&(i=i.remove(new Wh(e.name,n))),i.insert(e,e.node)}});return new mp(a,this.indexSet_)}removeFromIndexes(e,t){const a=Uc(this.indexes_,a=>{if(a===pp)return a;{const n=t.get(e.name);return n?a.remove(new Wh(e.name,n)):a}});return new mp(a,this.indexSet_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fp;class gp{static get EMPTY_NODE(){return fp||(fp=new gp(new Zh(ep),null,mp.Default))}constructor(e,t,a){this.children_=e,this.priorityNode_=t,this.indexMap_=a,this.lazyHash_=null,this.priorityNode_&&np(this.priorityNode_),this.children_.isEmpty()&&nc(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||fp}updatePriority(e){return this.children_.isEmpty()?this:new gp(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?fp:t}}getChild(e){const t=Nh(e);return null===t?this:this.getImmediateChild(t).getChild(Ah(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(nc(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const a=new Wh(e,t);let n,i;t.isEmpty()?(n=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(a,this.children_)):(n=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(a,this.children_));const s=n.isEmpty()?fp:this.priorityNode_;return new gp(n,s,i)}}updateChild(e,t){const a=Nh(e);if(null===a)return t;{nc(".priority"!==Nh(e)||1===xh(e),".priority must be the last token in a path");const n=this.getImmediateChild(a).updateChild(Ah(e),t);return this.updateImmediateChild(a,n)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let a=0,n=0,i=!0;if(this.forEachChild(lp,(s,o)=>{t[s]=o.val(e),a++,i&&gp.INTEGER_REGEXP_.test(s)?n=Math.max(n,Number(s)):i=!1}),!e&&i&&n<2*a){const e=[];for(const a in t)e[a]=t[a];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+ap(this.getPriority().val())+":"),this.forEachChild(lp,(t,a)=>{const n=a.hash();""!==n&&(e+=":"+t+":"+n)}),this.lazyHash_=""===e?"":Du(e)}return this.lazyHash_}getPredecessorChildName(e,t,a){const n=this.resolveIndex_(a);if(n){const a=n.getPredecessorKey(new Wh(e,t));return a?a.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Wh(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Wh(t,this.children_.get(t)):null}forEachChild(e,t){const a=this.resolveIndex_(e);return a?a.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const a=this.resolveIndex_(t);if(a)return a.getIteratorFrom(e,e=>e);{const a=this.children_.getIteratorFrom(e.name,Wh.Wrap);let n=a.peek();for(;null!=n&&t.compare(n,e)<0;)a.getNext(),n=a.peek();return a}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const a=this.resolveIndex_(t);if(a)return a.getReverseIteratorFrom(e,e=>e);{const a=this.children_.getReverseIteratorFrom(e.name,Wh.Wrap);let n=a.peek();for(;null!=n&&t.compare(n,e)>0;)a.getNext(),n=a.peek();return a}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===vp?-1:0}withIndex(e){if(e===Kh||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new gp(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Kh||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(lp),a=t.getIterator(lp);let n=e.getNext(),i=a.getNext();for(;n&&i;){if(n.name!==i.name||!n.node.equals(i.node))return!1;n=e.getNext(),i=a.getNext()}return null===n&&null===i}return!1}return!1}}resolveIndex_(e){return e===Kh?null:this.indexMap_.get(e.toString())}}gp.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const vp=new class extends gp{constructor(){super(new Zh(ep),gp.EMPTY_NODE,mp.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return gp.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Wh,{MIN:{value:new Wh(zu,gp.EMPTY_NODE)},MAX:{value:new Wh(Vu,vp)}}),Yh.__EMPTY_NODE=gp.EMPTY_NODE,rp.__childrenNodeConstructor=gp,tp=vp,function(e){op=e}(vp);function bp(e,t=null){if(null===e)return gp.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),nc(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){return new rp(e,bp(t))}if(e instanceof Array){let a=gp.EMPTY_NODE;return Qu(e,(t,n)=>{if(Lc(e,t)&&"."!==t.substring(0,1)){const e=bp(n);!e.isLeafNode()&&e.isEmpty()||(a=a.updateImmediateChild(t,e))}}),a.updatePriority(bp(t))}{const a=[];let n=!1;if(Qu(e,(e,t)=>{if("."!==e.substring(0,1)){const i=bp(t);i.isEmpty()||(n=n||!i.getPriority().isEmpty(),a.push(new Wh(e,i)))}}),0===a.length)return gp.EMPTY_NODE;const i=up(a,Xh,e=>e.name,ep);if(n){const e=up(a,lp.getCompare());return new gp(i,bp(t),new mp({".priority":e},{".priority":lp}))}return new gp(i,bp(t),mp.Default)}}!function(e){sp=e}(bp);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class wp extends Hh{constructor(e){super(),this.indexPath_=e,nc(!Lh(e)&&".priority"!==Nh(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const a=this.extractChild(e.node),n=this.extractChild(t.node),i=a.compareTo(n);return 0===i?Wu(e.name,t.name):i}makePost(e,t){const a=bp(e),n=gp.EMPTY_NODE.updateChild(this.indexPath_,a);return new Wh(t,n)}maxPost(){const e=gp.EMPTY_NODE.updateChild(this.indexPath_,vp);return new Wh(Vu,e)}toString(){return Rh(this.indexPath_,0).join("/")}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yp=new class extends Hh{compare(e,t){const a=e.node.compareTo(t.node);return 0===a?Wu(e.name,t.name):a}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Wh.MIN}maxPost(){return Wh.MAX}makePost(e,t){const a=bp(e);return new Wh(t,a)}toString(){return".value"}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _p(e){return{type:"value",snapshotNode:e}}function Cp(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function kp(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Ep(e,t,a){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:a}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Sp{constructor(e){this.index_=e}updateChild(e,t,a,n,i,s){nc(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(n).equals(a.getChild(n))&&o.isEmpty()===a.isEmpty()?e:(null!=s&&(a.isEmpty()?e.hasChild(t)?s.trackChildChange(kp(t,o)):nc(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(Cp(t,a)):s.trackChildChange(Ep(t,a,o))),e.isLeafNode()&&a.isEmpty()?e:e.updateImmediateChild(t,a).withIndex(this.index_))}updateFullNode(e,t,a){return null!=a&&(e.isLeafNode()||e.forEachChild(lp,(e,n)=>{t.hasChild(e)||a.trackChildChange(kp(e,n))}),t.isLeafNode()||t.forEachChild(lp,(t,n)=>{if(e.hasChild(t)){const i=e.getImmediateChild(t);i.equals(n)||a.trackChildChange(Ep(t,n,i))}else a.trackChildChange(Cp(t,n))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?gp.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tp{constructor(e){this.indexedFilter_=new Sp(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Tp.getStartPost_(e),this.endPost_=Tp.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,a=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&a}updateChild(e,t,a,n,i,s){return this.matches(new Wh(t,a))||(a=gp.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,a,n,i,s)}updateFullNode(e,t,a){t.isLeafNode()&&(t=gp.EMPTY_NODE);let n=t.withIndex(this.index_);n=n.updatePriority(gp.EMPTY_NODE);const i=this;return t.forEachChild(lp,(e,t)=>{i.matches(new Wh(e,t))||(n=n.updateImmediateChild(e,gp.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,n,a)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ip{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new Tp(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,a,n,i,s){return this.rangedFilter_.matches(new Wh(t,a))||(a=gp.EMPTY_NODE),e.getImmediateChild(t).equals(a)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,a,n,i,s):this.fullLimitUpdateChild_(e,t,a,i,s)}updateFullNode(e,t,a){let n;if(t.isLeafNode()||t.isEmpty())n=gp.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;n=gp.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let a=0;for(;e.hasNext()&&a<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;n=n.updateImmediateChild(t.name,t.node),a++}}}else{let e;n=t.withIndex(this.index_),n=n.updatePriority(gp.EMPTY_NODE),e=this.reverse_?n.getReverseIterator(this.index_):n.getIterator(this.index_);let a=0;for(;e.hasNext();){const t=e.getNext();a<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?a++:n=n.updateImmediateChild(t.name,gp.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,n,a)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,a,n,i){let s;if(this.reverse_){const e=this.index_.getCompare();s=(t,a)=>e(a,t)}else s=this.index_.getCompare();const o=e;nc(o.numChildren()===this.limit_,"");const r=new Wh(t,a),l=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),c=this.rangedFilter_.matches(r);if(o.hasChild(t)){const e=o.getImmediateChild(t);let d=n.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=d&&(d.name===t||o.hasChild(d.name));)d=n.getChildAfterChild(this.index_,d,this.reverse_);const u=null==d?1:s(d,r);if(c&&!a.isEmpty()&&u>=0)return null!=i&&i.trackChildChange(Ep(t,a,e)),o.updateImmediateChild(t,a);{null!=i&&i.trackChildChange(kp(t,e));const a=o.updateImmediateChild(t,gp.EMPTY_NODE);return null!=d&&this.rangedFilter_.matches(d)?(null!=i&&i.trackChildChange(Cp(d.name,d.node)),a.updateImmediateChild(d.name,d.node)):a}}return a.isEmpty()?e:c&&s(l,r)>=0?(null!=i&&(i.trackChildChange(kp(l.name,l.node)),i.trackChildChange(Cp(t,a))),o.updateImmediateChild(t,a).updateImmediateChild(l.name,gp.EMPTY_NODE)):e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Np{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=lp}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return nc(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return nc(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:zu}hasEnd(){return this.endSet_}getIndexEndValue(){return nc(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return nc(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Vu}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return nc(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===lp}copy(){const e=new Np;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function xp(e){const t={};if(e.isDefault())return t;let a;if(e.index_===lp?a="$priority":e.index_===yp?a="$value":e.index_===Kh?a="$key":(nc(e.index_ instanceof wp,"Unrecognized index type!"),a=e.index_.toString()),t.orderBy=Dc(a),e.startSet_){const a=e.startAfterSet_?"startAfter":"startAt";t[a]=Dc(e.indexStartValue_),e.startNameSet_&&(t[a]+=","+Dc(e.indexStartName_))}if(e.endSet_){const a=e.endBeforeSet_?"endBefore":"endAt";t[a]=Dc(e.indexEndValue_),e.endNameSet_&&(t[a]+=","+Dc(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function Ap(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let a=e.viewFrom_;""===a&&(a=e.isViewFromLeft()?"l":"r"),t.vf=a}return e.index_!==lp&&(t.i=e.index_.toString()),t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pp extends kh{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(nc(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,a,n){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=a,this.appCheckTokenProvider_=n,this.log_=Uu("p:rest:"),this.listens_={}}listen(e,t,a,n){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const s=Pp.getListenId_(e,a),o={};this.listens_[s]=o;const r=xp(e._queryParams);this.restRequest_(i+".json",r,(e,t)=>{let r=t;if(404===e&&(r=null,e=null),null===e&&this.onDataUpdate_(i,r,!1,a),Oc(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",n(t,null)}})}unlisten(e,t){const a=Pp.getListenId_(e,t);delete this.listens_[a]}get(e){const t=xp(e._queryParams),a=e._path.toString(),n=new bc;return this.restRequest_(a+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(a,i,!1,null),n.resolve(i)):n.reject(new Error(i))}),n.promise}refreshAuthToken(e){}restRequest_(e,t={},a){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([n,i])=>{n&&n.accessToken&&(t.auth=n.accessToken),i&&i.token&&(t.ac=i.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+function(e){const t=[];for(const[a,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(a)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(a)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(a&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let t=null;if(o.status>=200&&o.status<300){try{t=Rc(o.responseText)}catch(e){ju("Failed to parse JSON response for "+s+": "+o.responseText)}a(null,t)}else 401!==o.status&&404!==o.status&&ju("Got unsuccessful REST response for "+s+" Status: "+o.status),a(o.status);a=null}},o.open("GET",s,!0),o.send()})}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rp{constructor(){this.rootNode_=gp.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dp(){return{value:null,children:new Map}}function Mp(e,t,a){if(Lh(t))e.value=a,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,a);else{const n=Nh(t);e.children.has(n)||e.children.set(n,Dp());Mp(e.children.get(n),t=Ah(t),a)}}function Lp(e,t,a){null!==e.value?a(t,e.value):function(e,t){e.children.forEach((e,a)=>{t(a,e)})}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,(e,n)=>{Lp(n,new Th(t.toString()+"/"+e),a)})}class Op{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&Qu(this.last_,(e,a)=>{t[e]=t[e]-a}),this.last_=e,t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fp{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Op(e);const a=1e4+2e4*Math.random();th(this.reportStats_.bind(this),Math.floor(a))}reportStats_(){const e=this.statsListener_.get(),t={};let a=!1;Qu(e,(e,n)=>{n>0&&Lc(this.statsToReport_,e)&&(t[e]=n,a=!0)}),a&&this.server_.reportStats(t),th(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Up,Bp;function qp(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(Bp=Up||(Up={}))[Bp.OVERWRITE=0]="OVERWRITE",Bp[Bp.MERGE=1]="MERGE",Bp[Bp.ACK_USER_WRITE=2]="ACK_USER_WRITE",Bp[Bp.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class jp{constructor(e,t,a){this.path=e,this.affectedTree=t,this.revert=a,this.type=Up.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Lh(this.path)){if(null!=this.affectedTree.value)return nc(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Th(e));return new jp(Ih(),t,this.revert)}}return nc(Nh(this.path)===e,"operationForChild called for unrelated child."),new jp(Ah(this.path),this.affectedTree,this.revert)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p{constructor(e,t){this.source=e,this.path=t,this.type=Up.LISTEN_COMPLETE}operationForChild(e){return Lh(this.path)?new $p(this.source,Ih()):new $p(this.source,Ah(this.path))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zp{constructor(e,t,a){this.source=e,this.path=t,this.snap=a,this.type=Up.OVERWRITE}operationForChild(e){return Lh(this.path)?new zp(this.source,Ih(),this.snap.getImmediateChild(e)):new zp(this.source,Ah(this.path),this.snap)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vp{constructor(e,t,a){this.source=e,this.path=t,this.children=a,this.type=Up.MERGE}operationForChild(e){if(Lh(this.path)){const t=this.children.subtree(new Th(e));return t.isEmpty()?null:t.value?new zp(this.source,Ih(),t.value):new Vp(this.source,Ih(),t)}return nc(Nh(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Vp(this.source,Ah(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wp{constructor(e,t,a){this.node_=e,this.fullyInitialized_=t,this.filtered_=a}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Lh(e))return this.isFullyInitialized()&&!this.filtered_;const t=Nh(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hp{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Gp(e,t,a,n,i,s){const o=n.filter(e=>e.type===a);o.sort((t,a)=>function(e,t,a){if(null==t.childName||null==a.childName)throw ic("Should only compare child_ events.");const n=new Wh(t.childName,t.snapshotNode),i=new Wh(a.childName,a.snapshotNode);return e.index_.compare(n,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,a)),o.forEach(a=>{const n=function(e,t,a){return"value"===t.type||"child_removed"===t.type||(t.prevName=a.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,a,s);i.forEach(i=>{i.respondsTo(a.type)&&t.push(i.createEvent(n,e.query_))})})}function Yp(e,t){return{eventCache:e,serverCache:t}}function Kp(e,t,a,n){return Yp(new Wp(t,a,n),e.serverCache)}function Qp(e,t,a,n){return Yp(e.eventCache,new Wp(t,a,n))}function Jp(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Zp(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xp;class em{static fromObject(e){let t=new em(null);return Qu(e,(e,a)=>{t=t.set(new Th(e),a)}),t}constructor(e,t=(()=>(Xp||(Xp=new Zh(Hu)),Xp))()){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Ih(),value:this.value};if(Lh(e))return null;{const a=Nh(e),n=this.children.get(a);if(null!==n){const i=n.findRootMostMatchingPathAndValue(Ah(e),t);if(null!=i){return{path:Mh(new Th(a),i.path),value:i.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Lh(e))return this;{const t=Nh(e),a=this.children.get(t);return null!==a?a.subtree(Ah(e)):new em(null)}}set(e,t){if(Lh(e))return new em(t,this.children);{const a=Nh(e),n=(this.children.get(a)||new em(null)).set(Ah(e),t),i=this.children.insert(a,n);return new em(this.value,i)}}remove(e){if(Lh(e))return this.children.isEmpty()?new em(null):new em(null,this.children);{const t=Nh(e),a=this.children.get(t);if(a){const n=a.remove(Ah(e));let i;return i=n.isEmpty()?this.children.remove(t):this.children.insert(t,n),null===this.value&&i.isEmpty()?new em(null):new em(this.value,i)}return this}}get(e){if(Lh(e))return this.value;{const t=Nh(e),a=this.children.get(t);return a?a.get(Ah(e)):null}}setTree(e,t){if(Lh(e))return t;{const a=Nh(e),n=(this.children.get(a)||new em(null)).setTree(Ah(e),t);let i;return i=n.isEmpty()?this.children.remove(a):this.children.insert(a,n),new em(this.value,i)}}fold(e){return this.fold_(Ih(),e)}fold_(e,t){const a={};return this.children.inorderTraversal((n,i)=>{a[n]=i.fold_(Mh(e,n),t)}),t(e,this.value,a)}findOnPath(e,t){return this.findOnPath_(e,Ih(),t)}findOnPath_(e,t,a){const n=!!this.value&&a(t,this.value);if(n)return n;if(Lh(e))return null;{const n=Nh(e),i=this.children.get(n);return i?i.findOnPath_(Ah(e),Mh(t,n),a):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ih(),t)}foreachOnPath_(e,t,a){if(Lh(e))return this;{this.value&&a(t,this.value);const n=Nh(e),i=this.children.get(n);return i?i.foreachOnPath_(Ah(e),Mh(t,n),a):new em(null)}}foreach(e){this.foreach_(Ih(),e)}foreach_(e,t){this.children.inorderTraversal((a,n)=>{n.foreach_(Mh(e,a),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,a)=>{a.value&&e(t,a.value)})}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tm{constructor(e){this.writeTree_=e}static empty(){return new tm(new em(null))}}function am(e,t,a){if(Lh(t))return new tm(new em(a));{const n=e.writeTree_.findRootMostValueAndPath(t);if(null!=n){const i=n.path;let s=n.value;const o=Oh(i,t);return s=s.updateChild(o,a),new tm(e.writeTree_.set(i,s))}{const n=new em(a),i=e.writeTree_.setTree(t,n);return new tm(i)}}}function nm(e,t,a){let n=e;return Qu(a,(e,a)=>{n=am(n,Mh(t,e),a)}),n}function im(e,t){if(Lh(t))return tm.empty();{const a=e.writeTree_.setTree(t,new em(null));return new tm(a)}}function sm(e,t){return null!=om(e,t)}function om(e,t){const a=e.writeTree_.findRootMostValueAndPath(t);return null!=a?e.writeTree_.get(a.path).getChild(Oh(a.path,t)):null}function rm(e){const t=[],a=e.writeTree_.value;return null!=a?a.isLeafNode()||a.forEachChild(lp,(e,a)=>{t.push(new Wh(e,a))}):e.writeTree_.children.inorderTraversal((e,a)=>{null!=a.value&&t.push(new Wh(e,a.value))}),t}function lm(e,t){if(Lh(t))return e;{const a=om(e,t);return new tm(null!=a?new em(a):e.writeTree_.subtree(t))}}function cm(e){return e.writeTree_.isEmpty()}function dm(e,t){return um(Ih(),e.writeTree_,t)}function um(e,t,a){if(null!=t.value)return a.updateChild(e,t.value);{let n=null;return t.children.inorderTraversal((t,i)=>{".priority"===t?(nc(null!==i.value,"Priority writes must always be leaf nodes"),n=i.value):a=um(Mh(e,t),i,a)}),a.getChild(e).isEmpty()||null===n||(a=a.updateChild(Mh(e,".priority"),n)),a}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hm(e,t){return Sm(t,e)}function pm(e,t){const a=e.allWrites.findIndex(e=>e.writeId===t);nc(a>=0,"removeWrite called with nonexistent writeId.");const n=e.allWrites[a];e.allWrites.splice(a,1);let i=n.visible,s=!1,o=e.allWrites.length-1;for(;i&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=a&&mm(t,n.path)?i=!1:Uh(n.path,t.path)&&(s=!0)),o--}if(i){if(s)return function(e){e.visibleWrites=gm(e.allWrites,fm,Ih()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(n.snap)e.visibleWrites=im(e.visibleWrites,n.path);else{Qu(n.children,t=>{e.visibleWrites=im(e.visibleWrites,Mh(n.path,t))})}return!0}return!1}function mm(e,t){if(e.snap)return Uh(e.path,t);for(const a in e.children)if(e.children.hasOwnProperty(a)&&Uh(Mh(e.path,a),t))return!0;return!1}function fm(e){return e.visible}function gm(e,t,a){let n=tm.empty();for(let i=0;i<e.length;++i){const s=e[i];if(t(s)){const e=s.path;let t;if(s.snap)Uh(a,e)?(t=Oh(a,e),n=am(n,t,s.snap)):Uh(e,a)&&(t=Oh(e,a),n=am(n,Ih(),s.snap.getChild(t)));else{if(!s.children)throw ic("WriteRecord should have .snap or .children");if(Uh(a,e))t=Oh(a,e),n=nm(n,t,s.children);else if(Uh(e,a))if(t=Oh(e,a),Lh(t))n=nm(n,Ih(),s.children);else{const e=Oc(s.children,Nh(t));if(e){const a=e.getChild(Ah(t));n=am(n,Ih(),a)}}}}}return n}function vm(e,t,a,n,i){if(n||i){const s=lm(e.visibleWrites,t);if(!i&&cm(s))return a;if(i||null!=a||sm(s,Ih())){const s=function(e){return(e.visible||i)&&(!n||!~n.indexOf(e.writeId))&&(Uh(e.path,t)||Uh(t,e.path))};return dm(gm(e.allWrites,s,t),a||gp.EMPTY_NODE)}return null}{const n=om(e.visibleWrites,t);if(null!=n)return n;{const n=lm(e.visibleWrites,t);if(cm(n))return a;if(null!=a||sm(n,Ih())){return dm(n,a||gp.EMPTY_NODE)}return null}}}function bm(e,t,a,n){return vm(e.writeTree,e.treePath,t,a,n)}function wm(e,t){return function(e,t,a){let n=gp.EMPTY_NODE;const i=om(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(lp,(e,t)=>{n=n.updateImmediateChild(e,t)}),n;if(a){const i=lm(e.visibleWrites,t);return a.forEachChild(lp,(e,t)=>{const a=dm(lm(i,new Th(e)),t);n=n.updateImmediateChild(e,a)}),rm(i).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}return rm(lm(e.visibleWrites,t)).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}(e.writeTree,e.treePath,t)}function ym(e,t,a,n){return function(e,t,a,n,i){nc(n||i,"Either existingEventSnap or existingServerSnap must exist");const s=Mh(t,a);if(sm(e.visibleWrites,s))return null;{const t=lm(e.visibleWrites,s);return cm(t)?i.getChild(a):dm(t,i.getChild(a))}}(e.writeTree,e.treePath,t,a,n)}function _m(e,t){return function(e,t){return om(e.visibleWrites,t)}(e.writeTree,Mh(e.treePath,t))}function Cm(e,t,a,n,i,s){return function(e,t,a,n,i,s,o){let r;const l=lm(e.visibleWrites,t),c=om(l,Ih());if(null!=c)r=c;else{if(null==a)return[];r=dm(l,a)}if(r=r.withIndex(o),r.isEmpty()||r.isLeafNode())return[];{const e=[],t=o.getCompare(),a=s?r.getReverseIteratorFrom(n,o):r.getIteratorFrom(n,o);let l=a.getNext();for(;l&&e.length<i;)0!==t(l,n)&&e.push(l),l=a.getNext();return e}}(e.writeTree,e.treePath,t,a,n,i,s)}function km(e,t,a){return function(e,t,a,n){const i=Mh(t,a),s=om(e.visibleWrites,i);if(null!=s)return s;if(n.isCompleteForChild(a))return dm(lm(e.visibleWrites,i),n.getNode().getImmediateChild(a));return null}(e.writeTree,e.treePath,t,a)}function Em(e,t){return Sm(Mh(e.treePath,t),e.writeTree)}function Sm(e,t){return{treePath:e,writeTree:t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tm{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,a=e.childName;nc("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),nc(".priority"!==a,"Only non-priority child changes can be tracked.");const n=this.changeMap.get(a);if(n){const i=n.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(a,Ep(a,e.snapshotNode,n.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(a);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(a,kp(a,n.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(a,Cp(a,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw ic("Illegal combination of changes: "+e+" occurred after "+n);this.changeMap.set(a,Ep(a,e.snapshotNode,n.oldSnap))}}else this.changeMap.set(a,e)}getChanges(){return Array.from(this.changeMap.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Im=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,a){return null}};class Nm{constructor(e,t,a=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=a}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Wp(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return km(this.writes_,e,t)}}getChildAfterChild(e,t,a){const n=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Zp(this.viewCache_),i=Cm(this.writes_,n,t,1,a,e);return 0===i.length?null:i[0]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xm(e,t,a,n,i){const s=new Tm;let o,r;if(a.type===Up.OVERWRITE){const l=a;l.source.fromUser?o=Rm(e,t,l.path,l.snap,n,i,s):(nc(l.source.fromServer,"Unknown source."),r=l.source.tagged||t.serverCache.isFiltered()&&!Lh(l.path),o=Pm(e,t,l.path,l.snap,n,i,r,s))}else if(a.type===Up.MERGE){const l=a;l.source.fromUser?o=function(e,t,a,n,i,s,o){let r=t;return n.foreach((n,l)=>{const c=Mh(a,n);Dm(t,Nh(c))&&(r=Rm(e,r,c,l,i,s,o))}),n.foreach((n,l)=>{const c=Mh(a,n);Dm(t,Nh(c))||(r=Rm(e,r,c,l,i,s,o))}),r}(e,t,l.path,l.children,n,i,s):(nc(l.source.fromServer,"Unknown source."),r=l.source.tagged||t.serverCache.isFiltered(),o=Lm(e,t,l.path,l.children,n,i,r,s))}else if(a.type===Up.ACK_USER_WRITE){const r=a;o=r.revert?function(e,t,a,n,i,s){let o;if(null!=_m(n,a))return t;{const r=new Nm(n,t,i),l=t.eventCache.getNode();let c;if(Lh(a)||".priority"===Nh(a)){let a;if(t.serverCache.isFullyInitialized())a=bm(n,Zp(t));else{const e=t.serverCache.getNode();nc(e instanceof gp,"serverChildren would be complete if leaf node"),a=wm(n,e)}c=e.filter.updateFullNode(l,a,s)}else{const i=Nh(a);let d=km(n,i,t.serverCache);null==d&&t.serverCache.isCompleteForChild(i)&&(d=l.getImmediateChild(i)),c=null!=d?e.filter.updateChild(l,i,d,Ah(a),r,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(l,i,gp.EMPTY_NODE,Ah(a),r,s):l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=bm(n,Zp(t)),o.isLeafNode()&&(c=e.filter.updateFullNode(c,o,s)))}return o=t.serverCache.isFullyInitialized()||null!=_m(n,Ih()),Kp(t,c,o,e.filter.filtersNodes())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,r.path,n,i,s):function(e,t,a,n,i,s,o){if(null!=_m(i,a))return t;const r=t.serverCache.isFiltered(),l=t.serverCache;if(null!=n.value){if(Lh(a)&&l.isFullyInitialized()||l.isCompleteForPath(a))return Pm(e,t,a,l.getNode().getChild(a),i,s,r,o);if(Lh(a)){let n=new em(null);return l.getNode().forEachChild(Kh,(e,t)=>{n=n.set(new Th(e),t)}),Lm(e,t,a,n,i,s,r,o)}return t}{let c=new em(null);return n.foreach((e,t)=>{const n=Mh(a,e);l.isCompleteForPath(n)&&(c=c.set(e,l.getNode().getChild(n)))}),Lm(e,t,a,c,i,s,r,o)}}(e,t,r.path,r.affectedTree,n,i,s)}else{if(a.type!==Up.LISTEN_COMPLETE)throw ic("Unknown operation type: "+a.type);o=function(e,t,a,n,i){const s=t.serverCache,o=Qp(t,s.getNode(),s.isFullyInitialized()||Lh(a),s.isFiltered());return Am(e,o,a,n,Im,i)}(e,t,a.path,n,s)}const l=s.getChanges();return function(e,t,a){const n=t.eventCache;if(n.isFullyInitialized()){const i=n.getNode().isLeafNode()||n.getNode().isEmpty(),s=Jp(e);(a.length>0||!e.eventCache.isFullyInitialized()||i&&!n.getNode().equals(s)||!n.getNode().getPriority().equals(s.getPriority()))&&a.push(_p(Jp(t)))}}(t,o,l),{viewCache:o,changes:l}}function Am(e,t,a,n,i,s){const o=t.eventCache;if(null!=_m(n,a))return t;{let r,l;if(Lh(a))if(nc(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const a=Zp(t),i=wm(n,a instanceof gp?a:gp.EMPTY_NODE);r=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{const a=bm(n,Zp(t));r=e.filter.updateFullNode(t.eventCache.getNode(),a,s)}else{const c=Nh(a);if(".priority"===c){nc(1===xh(a),"Can't have a priority with additional path components");const i=o.getNode();l=t.serverCache.getNode();const s=ym(n,a,i,l);r=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{const d=Ah(a);let u;if(o.isCompleteForChild(c)){l=t.serverCache.getNode();const e=ym(n,a,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(c).updateChild(d,e):o.getNode().getImmediateChild(c)}else u=km(n,c,t.serverCache);r=null!=u?e.filter.updateChild(o.getNode(),c,u,d,i,s):o.getNode()}}return Kp(t,r,o.isFullyInitialized()||Lh(a),e.filter.filtersNodes())}}function Pm(e,t,a,n,i,s,o,r){const l=t.serverCache;let c;const d=o?e.filter:e.filter.getIndexedFilter();if(Lh(a))c=d.updateFullNode(l.getNode(),n,null);else if(d.filtersNodes()&&!l.isFiltered()){const e=l.getNode().updateChild(a,n);c=d.updateFullNode(l.getNode(),e,null)}else{const e=Nh(a);if(!l.isCompleteForPath(a)&&xh(a)>1)return t;const i=Ah(a),s=l.getNode().getImmediateChild(e).updateChild(i,n);c=".priority"===e?d.updatePriority(l.getNode(),s):d.updateChild(l.getNode(),e,s,i,Im,null)}const u=Qp(t,c,l.isFullyInitialized()||Lh(a),d.filtersNodes());return Am(e,u,a,i,new Nm(i,u,s),r)}function Rm(e,t,a,n,i,s,o){const r=t.eventCache;let l,c;const d=new Nm(i,t,s);if(Lh(a))c=e.filter.updateFullNode(t.eventCache.getNode(),n,o),l=Kp(t,c,!0,e.filter.filtersNodes());else{const i=Nh(a);if(".priority"===i)c=e.filter.updatePriority(t.eventCache.getNode(),n),l=Kp(t,c,r.isFullyInitialized(),r.isFiltered());else{const s=Ah(a),c=r.getNode().getImmediateChild(i);let u;if(Lh(s))u=n;else{const e=d.getCompleteChild(i);u=null!=e?".priority"===Ph(s)&&e.getChild(Dh(s)).isEmpty()?e:e.updateChild(s,n):gp.EMPTY_NODE}if(c.equals(u))l=t;else{l=Kp(t,e.filter.updateChild(r.getNode(),i,u,s,d,o),r.isFullyInitialized(),e.filter.filtersNodes())}}}return l}function Dm(e,t){return e.eventCache.isCompleteForChild(t)}function Mm(e,t,a){return a.foreach((e,a)=>{t=t.updateChild(e,a)}),t}function Lm(e,t,a,n,i,s,o,r){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l,c=t;l=Lh(a)?n:new em(null).setTree(a,n);const d=t.serverCache.getNode();return l.children.inorderTraversal((a,n)=>{if(d.hasChild(a)){const l=Mm(0,t.serverCache.getNode().getImmediateChild(a),n);c=Pm(e,c,new Th(a),l,i,s,o,r)}}),l.children.inorderTraversal((a,n)=>{const l=!t.serverCache.isCompleteForChild(a)&&null===n.value;if(!d.hasChild(a)&&!l){const l=Mm(0,t.serverCache.getNode().getImmediateChild(a),n);c=Pm(e,c,new Th(a),l,i,s,o,r)}}),c}class Om{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const a=this.query_._queryParams,n=new Sp(a.getIndex()),i=(s=a).loadsAllData()?new Sp(s.getIndex()):s.hasLimit()?new Ip(s):new Tp(s);var s;this.processor_=function(e){return{filter:e}}(i);const o=t.serverCache,r=t.eventCache,l=n.updateFullNode(gp.EMPTY_NODE,o.getNode(),null),c=i.updateFullNode(gp.EMPTY_NODE,r.getNode(),null),d=new Wp(l,o.isFullyInitialized(),n.filtersNodes()),u=new Wp(c,r.isFullyInitialized(),i.filtersNodes());this.viewCache_=Yp(u,d),this.eventGenerator_=new Hp(this.query_)}get query(){return this.query_}}function Fm(e,t){const a=Zp(e.viewCache_);return a&&(e.query._queryParams.loadsAllData()||!Lh(t)&&!a.getImmediateChild(Nh(t)).isEmpty())?a.getChild(t):null}function Um(e){return 0===e.eventRegistrations_.length}function Bm(e,t,a){const n=[];if(a){nc(null==t,"A cancel should cancel all event registrations.");const i=e.query._path;e.eventRegistrations_.forEach(e=>{const t=e.createCancelEvent(a,i);t&&n.push(t)})}if(t){let a=[];for(let n=0;n<e.eventRegistrations_.length;++n){const i=e.eventRegistrations_[n];if(i.matches(t)){if(t.hasAnyCallback()){a=a.concat(e.eventRegistrations_.slice(n+1));break}}else a.push(i)}e.eventRegistrations_=a}else e.eventRegistrations_=[];return n}function qm(e,t,a,n){t.type===Up.MERGE&&null!==t.source.queryId&&(nc(Zp(e.viewCache_),"We should always have a full cache before handling merges"),nc(Jp(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=xm(e.processor_,i,t,a,n);var o,r;return o=e.processor_,r=s.viewCache,nc(r.eventCache.getNode().isIndexed(o.filter.getIndex()),"Event snap not indexed"),nc(r.serverCache.getNode().isIndexed(o.filter.getIndex()),"Server snap not indexed"),nc(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,jm(e,s.changes,s.viewCache.eventCache.getNode(),null)}function jm(e,t,a,n){const i=n?[n]:e.eventRegistrations_;return function(e,t,a,n){const i=[],s=[];return t.forEach(t=>{var a;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((a=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:a}))}),Gp(e,i,"child_removed",t,n,a),Gp(e,i,"child_added",t,n,a),Gp(e,i,"child_moved",s,n,a),Gp(e,i,"child_changed",t,n,a),Gp(e,i,"value",t,n,a),i}(e.eventGenerator_,t,a,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $m,zm;class Vm{constructor(){this.views=new Map}}function Wm(e,t,a,n){const i=t.source.queryId;if(null!==i){const s=e.views.get(i);return nc(null!=s,"SyncTree gave us an op for an invalid query."),qm(s,t,a,n)}{let i=[];for(const s of e.views.values())i=i.concat(qm(s,t,a,n));return i}}function Hm(e,t,a,n,i,s){const o=function(e,t,a,n,i){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=bm(a,i?n:null),s=!1;e?s=!0:n instanceof gp?(e=wm(a,n),s=!1):(e=gp.EMPTY_NODE,s=!1);const o=Yp(new Wp(e,s,!1),new Wp(n,i,!1));return new Om(t,o)}return o}(e,t,n,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,a),function(e,t){const a=e.viewCache_.eventCache,n=[];a.getNode().isLeafNode()||a.getNode().forEachChild(lp,(e,t)=>{n.push(Cp(e,t))});return a.isFullyInitialized()&&n.push(_p(a.getNode())),jm(e,n,a.getNode(),t)}(o,a)}function Gm(e,t,a,n){const i=t._queryIdentifier,s=[];let o=[];const r=Zm(e);if("default"===i)for(const[l,c]of e.views.entries())o=o.concat(Bm(c,a,n)),Um(c)&&(e.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{const t=e.views.get(i);t&&(o=o.concat(Bm(t,a,n)),Um(t)&&(e.views.delete(i),t.query._queryParams.loadsAllData()||s.push(t.query)))}return r&&!Zm(e)&&s.push(new(nc($m,"Reference.ts has not been loaded"),$m)(t._repo,t._path)),{removed:s,events:o}}function Ym(e){const t=[];for(const a of e.views.values())a.query._queryParams.loadsAllData()||t.push(a);return t}function Km(e,t){let a=null;for(const n of e.views.values())a=a||Fm(n,t);return a}function Qm(e,t){if(t._queryParams.loadsAllData())return Xm(e);{const a=t._queryIdentifier;return e.views.get(a)}}function Jm(e,t){return null!=Qm(e,t)}function Zm(e){return null!=Xm(e)}function Xm(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ef=1;class tf{constructor(e){this.listenProvider_=e,this.syncPointTree_=new em(null),this.pendingWriteTree_={visibleWrites:tm.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function af(e,t,a,n,i){return function(e,t,a,n,i){nc(n>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:a,writeId:n,visible:i}),i&&(e.visibleWrites=am(e.visibleWrites,t,a)),e.lastWriteId=n}(e.pendingWriteTree_,t,a,n,i),i?cf(e,new zp({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,a)):[]}function nf(e,t,a=!1){const n=function(e,t){for(let a=0;a<e.allWrites.length;a++){const n=e.allWrites[a];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(pm(e.pendingWriteTree_,t)){let t=new em(null);return null!=n.snap?t=t.set(Ih(),!0):Qu(n.children,e=>{t=t.set(new Th(e),!0)}),cf(e,new jp(n.path,t,a))}return[]}function sf(e,t,a){return cf(e,new zp({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,a))}function of(e,t,a,n,i=!1){const s=t._path,o=e.syncPointTree_.get(s);let r=[];if(o&&("default"===t._queryIdentifier||Jm(o,t))){const l=Gm(o,t,a,n);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));const c=l.removed;if(r=l.events,!i){const a=-1!==c.findIndex(e=>e._queryParams.loadsAllData()),i=e.syncPointTree_.findOnPath(s,(e,t)=>Zm(t));if(a&&!i){const t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){const a=function(e){return e.fold((e,t,a)=>{if(t&&Zm(t)){return[Xm(t)]}{let e=[];return t&&(e=Ym(t)),Qu(a,(t,a)=>{e=e.concat(a)}),e}})}(t);for(let t=0;t<a.length;++t){const n=a[t],i=n.query,s=hf(e,n);e.listenProvider_.startListening(bf(i),pf(e,i),s.hashFn,s.onComplete)}}}if(!i&&c.length>0&&!n)if(a){const a=null;e.listenProvider_.stopListening(bf(t),a)}else c.forEach(t=>{const a=e.queryToTagMap.get(mf(t));e.listenProvider_.stopListening(bf(t),a)})}!function(e,t){for(let a=0;a<t.length;++a){const n=t[a];if(!n._queryParams.loadsAllData()){const t=mf(n),a=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(a)}}}(e,c)}return r}function rf(e,t,a,n=!1){const i=t._path;let s=null,o=!1;e.syncPointTree_.foreachOnPath(i,(e,t)=>{const a=Oh(e,i);s=s||Km(t,a),o=o||Zm(t)});let r,l=e.syncPointTree_.get(i);if(l?(o=o||Zm(l),s=s||Km(l,Ih())):(l=new Vm,e.syncPointTree_=e.syncPointTree_.set(i,l)),null!=s)r=!0;else{r=!1,s=gp.EMPTY_NODE;e.syncPointTree_.subtree(i).foreachChild((e,t)=>{const a=Km(t,Ih());a&&(s=s.updateImmediateChild(e,a))})}const c=Jm(l,t);if(!c&&!t._queryParams.loadsAllData()){const a=mf(t);nc(!e.queryToTagMap.has(a),"View does not exist, but we have a tag");const n=ef++;e.queryToTagMap.set(a,n),e.tagToQueryMap.set(n,a)}let d=Hm(l,t,a,hm(e.pendingWriteTree_,i),s,r);if(!c&&!o&&!n){const a=Qm(l,t);d=d.concat(function(e,t,a){const n=t._path,i=pf(e,t),s=hf(e,a),o=e.listenProvider_.startListening(bf(t),i,s.hashFn,s.onComplete),r=e.syncPointTree_.subtree(n);if(i)nc(!Zm(r.value),"If we're adding a query, it shouldn't be shadowed");else{const t=r.fold((e,t,a)=>{if(!Lh(e)&&t&&Zm(t))return[Xm(t).query];{let e=[];return t&&(e=e.concat(Ym(t).map(e=>e.query))),Qu(a,(t,a)=>{e=e.concat(a)}),e}});for(let a=0;a<t.length;++a){const n=t[a];e.listenProvider_.stopListening(bf(n),pf(e,n))}}return o}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,a))}return d}function lf(e,t,a){const n=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,a)=>{const n=Km(a,Oh(e,t));if(n)return n});return vm(n,t,i,a,!0)}function cf(e,t){return df(t,e.syncPointTree_,null,hm(e.pendingWriteTree_,Ih()))}function df(e,t,a,n){if(Lh(e.path))return uf(e,t,a,n);{const i=t.get(Ih());null==a&&null!=i&&(a=Km(i,Ih()));let s=[];const o=Nh(e.path),r=e.operationForChild(o),l=t.children.get(o);if(l&&r){const e=a?a.getImmediateChild(o):null,t=Em(n,o);s=s.concat(df(r,l,e,t))}return i&&(s=s.concat(Wm(i,e,n,a))),s}}function uf(e,t,a,n){const i=t.get(Ih());null==a&&null!=i&&(a=Km(i,Ih()));let s=[];return t.children.inorderTraversal((t,i)=>{const o=a?a.getImmediateChild(t):null,r=Em(n,t),l=e.operationForChild(t);l&&(s=s.concat(uf(l,i,o,r)))}),i&&(s=s.concat(Wm(i,e,n,a))),s}function hf(e,t){const a=t.query,n=pf(e,a);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||gp.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return n?function(e,t,a){const n=ff(e,a);if(n){const a=gf(n),i=a.path,s=a.queryId,o=Oh(i,t);return vf(e,i,new $p(qp(s),o))}return[]}(e,a._path,n):function(e,t){return cf(e,new $p({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,a._path);{const n=function(e,t){let a="Unknown Error";"too_big"===e?a="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?a="Client doesn't have permission to access the desired data.":"unavailable"===e&&(a="The service is unavailable");const n=new Error(e+" at "+t._path.toString()+": "+a);return n.code=e.toUpperCase(),n}(t,a);return of(e,a,null,n)}}}}function pf(e,t){const a=mf(t);return e.queryToTagMap.get(a)}function mf(e){return e._path.toString()+"$"+e._queryIdentifier}function ff(e,t){return e.tagToQueryMap.get(t)}function gf(e){const t=e.indexOf("$");return nc(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Th(e.substr(0,t))}}function vf(e,t,a){const n=e.syncPointTree_.get(t);nc(n,"Missing sync point for query tag that we're tracking");return Wm(n,a,hm(e.pendingWriteTree_,t),null)}function bf(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(nc(zm,"Reference.ts has not been loaded"),zm)(e._repo,e._path):e}class wf{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new wf(t)}node(){return this.node_}}class yf{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Mh(this.path_,e);return new yf(this.syncTree_,t)}node(){return lf(this.syncTree_,this.path_)}}const _f=function(e,t,a){return e&&"object"==typeof e?(nc(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Cf(e[".sv"],t,a):"object"==typeof e[".sv"]?kf(e[".sv"],t):void nc(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Cf=function(e,t,a){if("timestamp"===e)return a.timestamp;nc(!1,"Unexpected server value: "+e)},kf=function(e,t,a){e.hasOwnProperty("increment")||nc(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const n=e.increment;"number"!=typeof n&&nc(!1,"Unexpected increment value: "+n);const i=t.node();if(nc(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return n;const s=i.getValue();return"number"!=typeof s?n:s+n},Ef=function(e,t,a){return Sf(e,new wf(t),a)};function Sf(e,t,a){const n=e.getPriority().val(),i=_f(n,t.getImmediateChild(".priority"),a);let s;if(e.isLeafNode()){const n=e,s=_f(n.getValue(),t,a);return s!==n.getValue()||i!==n.getPriority().val()?new rp(s,bp(i)):e}{const n=e;return s=n,i!==n.getPriority().val()&&(s=s.updatePriority(new rp(i))),n.forEachChild(lp,(e,n)=>{const i=Sf(n,t.getImmediateChild(e),a);i!==n&&(s=s.updateImmediateChild(e,i))}),s}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(e="",t=null,a={children:{},childCount:0}){this.name=e,this.parent=t,this.node=a}}function If(e,t){let a=t instanceof Th?t:new Th(t),n=e,i=Nh(a);for(;null!==i;){const e=Oc(n.node.children,i)||{children:{},childCount:0};n=new Tf(i,n,e),a=Ah(a),i=Nh(a)}return n}function Nf(e){return e.node.value}function xf(e,t){e.node.value=t,Mf(e)}function Af(e){return e.node.childCount>0}function Pf(e,t){Qu(e.node.children,(a,n)=>{t(new Tf(a,e,n))})}function Rf(e,t,a,n){a&&t(e),Pf(e,e=>{Rf(e,t,!0)})}function Df(e){return new Th(null===e.parent?e.name:Df(e.parent)+"/"+e.name)}function Mf(e){null!==e.parent&&function(e,t,a){const n=function(e){return void 0===Nf(e)&&!Af(e)}(a),i=Lc(e.node.children,t);n&&i?(delete e.node.children[t],e.node.childCount--,Mf(e)):n||i||(e.node.children[t]=a.node,e.node.childCount++,Mf(e))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e.parent,e.name,e)}const Lf=/[\[\].#$\/\u0000-\u001F\u007F]/,Of=/[\[\].#$\u0000-\u001F\u007F]/,Ff=10485760,Uf=function(e){return"string"==typeof e&&0!==e.length&&!Lf.test(e)},Bf=function(e){return"string"==typeof e&&0!==e.length&&!Of.test(e)},qf=function(e,t,a){const n=a instanceof Th?new Bh(a,e):a;if(void 0===t)throw new Error(e+"contains undefined "+jh(n));if("function"==typeof t)throw new Error(e+"contains a function "+jh(n)+" with contents = "+t.toString());if($u(t))throw new Error(e+"contains "+t.toString()+" "+jh(n));if("string"==typeof t&&t.length>Ff/3&&zc(t)>Ff)throw new Error(e+"contains a string greater than "+Ff+" utf8 bytes "+jh(n)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let a=!1,i=!1;if(Qu(t,(t,s)=>{if(".value"===t)a=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!Uf(t)))throw new Error(e+" contains an invalid key ("+t+") "+jh(n)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var o,r;r=t,(o=n).parts_.length>0&&(o.byteLength_+=1),o.parts_.push(r),o.byteLength_+=zc(r),qh(o),qf(e,s,n),function(e){const t=e.parts_.pop();e.byteLength_-=zc(t),e.parts_.length>0&&(e.byteLength_-=1)}(n)}),a&&i)throw new Error(e+' contains ".value" child '+jh(n)+" in addition to actual children.")}},jf=function(e,t,a,n){if(!Bf(a))throw new Error($c(e,t)+'was an invalid path = "'+a+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},$f=function(e,t){const a=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Uf(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==a.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Bf(e)}(a))throw new Error($c(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class zf{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Vf(e,t){let a=null;for(let n=0;n<t.length;n++){const i=t[n],s=i.getPath();null===a||Fh(s,a.path)||(e.eventLists_.push(a),a=null),null===a&&(a={events:[],path:s}),a.events.push(i)}a&&e.eventLists_.push(a)}function Wf(e,t,a){Vf(e,a),Gf(e,e=>Fh(e,t))}function Hf(e,t,a){Vf(e,a),Gf(e,e=>Uh(e,t)||Uh(t,e))}function Gf(e,t){e.recursionDepth_++;let a=!0;for(let n=0;n<e.eventLists_.length;n++){const i=e.eventLists_[n];if(i){t(i.path)?(Yf(e.eventLists_[n]),e.eventLists_[n]=null):a=!1}}a&&(e.eventLists_=[]),e.recursionDepth_--}function Yf(e){for(let t=0;t<e.events.length;t++){const a=e.events[t];if(null!==a){e.events[t]=null;const n=a.getEventRunner();Lu&&Fu("event: "+a.toString()),eh(n)}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kf{constructor(e,t,a,n){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=a,this.appCheckProvider_=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new zf,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Dp(),this.transactionQueueTree_=new Tf,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Qf(e,t,a){if(e.stats_=mh(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Pp(e.repoInfo_,(t,a,n,i)=>{Xf(e,t,a,n,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>eg(e,!0),0);else{if(null!=a){if("object"!=typeof a)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Dc(a)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}e.persistentConnection_=new Vh(e.repoInfo_,t,(t,a,n,i)=>{Xf(e,t,a,n,i)},t=>{eg(e,t)},t=>{!function(e,t){Qu(t,(t,a)=>{tg(e,t,a)})}(e,t)},e.authTokenProvider_,e.appCheckProvider_,a),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){const a=e.toString();return ph[a]||(ph[a]=t()),ph[a]}(e.repoInfo_,()=>new Fp(e.stats_,e.server_)),e.infoData_=new Rp,e.infoSyncTree_=new tf({startListening:(t,a,n,i)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=sf(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),tg(e,"connected",!1),e.serverSyncTree_=new tf({startListening:(t,a,n,i)=>(e.server_.listen(t,n,a,(a,n)=>{const s=i(a,n);Hf(e.eventQueue_,t._path,s)}),[]),stopListening:(t,a)=>{e.server_.unlisten(t,a)}})}function Jf(e){const t=e.infoData_.getNode(new Th(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Zf(e){return(t=(t={timestamp:Jf(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function Xf(e,t,a,n,i){e.dataUpdateCount++;const s=new Th(t);a=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,a):a;let o=[];if(i)if(n){const t=Uc(a,e=>bp(e));o=function(e,t,a,n){const i=ff(e,n);if(i){const n=gf(i),s=n.path,o=n.queryId,r=Oh(s,t),l=em.fromObject(a);return vf(e,s,new Vp(qp(o),r,l))}return[]}(e.serverSyncTree_,s,t,i)}else{const t=bp(a);o=function(e,t,a,n){const i=ff(e,n);if(null!=i){const n=gf(i),s=n.path,o=n.queryId,r=Oh(s,t);return vf(e,s,new zp(qp(o),r,a))}return[]}(e.serverSyncTree_,s,t,i)}else if(n){const t=Uc(a,e=>bp(e));o=function(e,t,a){const n=em.fromObject(a);return cf(e,new Vp({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}(e.serverSyncTree_,s,t)}else{const t=bp(a);o=sf(e.serverSyncTree_,s,t)}let r=s;o.length>0&&(r=rg(e,s)),Hf(e.eventQueue_,r,o)}function eg(e,t){tg(e,"connected",t),!1===t&&function(e){ig(e,"onDisconnectEvents");const t=Zf(e),a=Dp();Lp(e.onDisconnect_,Ih(),(n,i)=>{const s=function(e,t,a,n){return Sf(t,new yf(a,e),n)}(n,i,e.serverSyncTree_,t);Mp(a,n,s)});let n=[];Lp(a,Ih(),(t,a)=>{n=n.concat(sf(e.serverSyncTree_,t,a));const i=function(e,t){const a=Df(lg(e,t)),n=If(e.transactionQueueTree_,t);return function(e,t){let a=e.parent;for(;null!==a;){if(t(a))return!0;a=a.parent}}(n,t=>{hg(e,t)}),hg(e,n),Rf(n,t=>{hg(e,t)}),a}(e,t);rg(e,i)}),e.onDisconnect_=Dp(),Hf(e.eventQueue_,Ih(),n)}(e)}function tg(e,t,a){const n=new Th("/.info/"+t),i=bp(a);e.infoData_.updateSnapshot(n,i);const s=sf(e.infoSyncTree_,n,i);Hf(e.eventQueue_,n,s)}function ag(e){return e.nextWriteId_++}function ng(e,t,a){let n;n=".info"===Nh(t._path)?of(e.infoSyncTree_,t,a):of(e.serverSyncTree_,t,a),Wf(e.eventQueue_,t._path,n)}function ig(e,...t){let a="";e.persistentConnection_&&(a=e.persistentConnection_.id+":"),Fu(a,...t)}function sg(e,t,a){return lf(e.serverSyncTree_,t,a)||gp.EMPTY_NODE}function og(e,t=e.transactionQueueTree_){if(t||ug(e,t),Nf(t)){const a=cg(e,t);nc(a.length>0,"Sending zero length transaction queue");a.every(e=>0===e.status)&&function(e,t,a){const n=a.map(e=>e.currentWriteId),i=sg(e,t,n);let s=i;const o=i.hash();for(let c=0;c<a.length;c++){const e=a[c];nc(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const n=Oh(t,e.path);s=s.updateChild(n,e.currentOutputSnapshotRaw)}const r=s.val(!0),l=t;e.server_.put(l.toString(),r,n=>{ig(e,"transaction put response",{path:l.toString(),status:n});let i=[];if("ok"===n){const n=[];for(let t=0;t<a.length;t++)a[t].status=2,i=i.concat(nf(e.serverSyncTree_,a[t].currentWriteId)),a[t].onComplete&&n.push(()=>a[t].onComplete(null,!0,a[t].currentOutputSnapshotResolved)),a[t].unwatcher();ug(e,If(e.transactionQueueTree_,t)),og(e,e.transactionQueueTree_),Hf(e.eventQueue_,t,i);for(let e=0;e<n.length;e++)eh(n[e])}else{if("datastale"===n)for(let e=0;e<a.length;e++)3===a[e].status?a[e].status=4:a[e].status=0;else{ju("transaction at "+l.toString()+" failed: "+n);for(let e=0;e<a.length;e++)a[e].status=4,a[e].abortReason=n}rg(e,t)}},o)}(e,Df(t),a)}else Af(t)&&Pf(t,t=>{og(e,t)})}function rg(e,t){const a=lg(e,t),n=Df(a);return function(e,t,a){if(0===t.length)return;const n=[];let i=[];const s=t.filter(e=>0===e.status),o=s.map(e=>e.currentWriteId);for(let r=0;r<t.length;r++){const s=t[r],l=Oh(a,s.path);let c,d=!1;if(nc(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===s.status)d=!0,c=s.abortReason,i=i.concat(nf(e.serverSyncTree_,s.currentWriteId,!0));else if(0===s.status)if(s.retryCount>=25)d=!0,c="maxretry",i=i.concat(nf(e.serverSyncTree_,s.currentWriteId,!0));else{const a=sg(e,s.path,o);s.currentInputSnapshot=a;const n=t[r].update(a.val());if(void 0!==n){qf("transaction failed: Data returned ",n,s.path);let t=bp(n);"object"==typeof n&&null!=n&&Lc(n,".priority")||(t=t.updatePriority(a.getPriority()));const r=s.currentWriteId,l=Zf(e),c=Ef(t,a,l);s.currentOutputSnapshotRaw=t,s.currentOutputSnapshotResolved=c,s.currentWriteId=ag(e),o.splice(o.indexOf(r),1),i=i.concat(af(e.serverSyncTree_,s.path,c,s.currentWriteId,s.applyLocally)),i=i.concat(nf(e.serverSyncTree_,r,!0))}else d=!0,c="nodata",i=i.concat(nf(e.serverSyncTree_,s.currentWriteId,!0))}Hf(e.eventQueue_,a,i),i=[],d&&(t[r].status=2,function(e){setTimeout(e,Math.floor(0))}(t[r].unwatcher),t[r].onComplete&&("nodata"===c?n.push(()=>t[r].onComplete(null,!1,t[r].currentInputSnapshot)):n.push(()=>t[r].onComplete(new Error(c),!1,null))))}ug(e,e.transactionQueueTree_);for(let r=0;r<n.length;r++)eh(n[r]);og(e,e.transactionQueueTree_)}(e,cg(e,a),n),n}function lg(e,t){let a,n=e.transactionQueueTree_;for(a=Nh(t);null!==a&&void 0===Nf(n);)n=If(n,a),a=Nh(t=Ah(t));return n}function cg(e,t){const a=[];return dg(e,t,a),a.sort((e,t)=>e.order-t.order),a}function dg(e,t,a){const n=Nf(t);if(n)for(let i=0;i<n.length;i++)a.push(n[i]);Pf(t,t=>{dg(e,t,a)})}function ug(e,t){const a=Nf(t);if(a){let e=0;for(let t=0;t<a.length;t++)2!==a[t].status&&(a[e]=a[t],e++);a.length=e,xf(t,a.length>0?a:void 0)}Pf(t,t=>{ug(e,t)})}function hg(e,t){const a=Nf(t);if(a){const n=[];let i=[],s=-1;for(let t=0;t<a.length;t++)3===a[t].status||(1===a[t].status?(nc(s===t-1,"All SENT items should be at beginning of queue."),s=t,a[t].status=3,a[t].abortReason="set"):(nc(0===a[t].status,"Unexpected transaction status in abort"),a[t].unwatcher(),i=i.concat(nf(e.serverSyncTree_,a[t].currentWriteId,!0)),a[t].onComplete&&n.push(a[t].onComplete.bind(null,new Error("set"),!1,null))));-1===s?xf(t,void 0):a.length=s+1,Hf(e.eventQueue_,Df(t),i);for(let e=0;e<n.length;e++)eh(n[e])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pg=function(e,t){const a=mg(e),n=a.namespace;"firebase.com"===a.domain&&qu(a.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===a.domain||qu("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),a.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&ju("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const i="ws"===a.scheme||"wss"===a.scheme;return{repoInfo:new ch(a.host,a.secure,n,i,t,"",n!==a.subdomain),path:new Th(a.pathString)}},mg=function(e){let t="",a="",n="",i="",s="",o=!0,r="https",l=443;if("string"==typeof e){let c=e.indexOf("//");c>=0&&(r=e.substring(0,c-1),e=e.substring(c+2));let d=e.indexOf("/");-1===d&&(d=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(d,u)),d<u&&(i=function(e){let t="";const a=e.split("/");for(let i=0;i<a.length;i++)if(a[i].length>0){let e=a[i];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(n){}t+="/"+e}return t}(e.substring(d,u)));const h=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const a of e.split("&")){if(0===a.length)continue;const n=a.split("=");2===n.length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):ju(`Invalid query segment '${a}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));c=t.indexOf(":"),c>=0?(o="https"===r||"wss"===r,l=parseInt(t.substring(c+1),10)):c=t.length;const p=t.slice(0,c);if("localhost"===p.toLowerCase())a="localhost";else if(p.split(".").length<=2)a=p;else{const e=t.indexOf(".");n=t.substring(0,e).toLowerCase(),a=t.substring(e+1),s=n}"ns"in h&&(s=h.ns)}return{host:t,port:l,domain:a,subdomain:n,secure:o,scheme:r,pathString:i,namespace:s}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class fg{constructor(e,t,a,n){this.eventType=e,this.eventRegistration=t,this.snapshot=a,this.prevName=n}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Dc(this.snapshot.exportVal())}}class gg{constructor(e,t,a){this.eventRegistration=e,this.error=t,this.path=a}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return nc(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bg{constructor(e,t,a,n){this._repo=e,this._path=t,this._queryParams=a,this._orderByCalled=n}get key(){return Lh(this._path)?null:Ph(this._path)}get ref(){return new wg(this._repo,this._path)}get _queryIdentifier(){const e=Ap(this._queryParams),t=Yu(e);return"{}"===t?"default":t}get _queryObject(){return Ap(this._queryParams)}isEqual(e){if(!((e=Vc(e))instanceof bg))return!1;const t=this._repo===e._repo,a=Fh(this._path,e._path),n=this._queryIdentifier===e._queryIdentifier;return t&&a&&n}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let a=e.pieceNum_;a<e.pieces_.length;a++)""!==e.pieces_[a]&&(t+="/"+encodeURIComponent(String(e.pieces_[a])));return t||"/"}(this._path)}}class wg extends bg{constructor(e,t){super(e,t,new Np,!1)}get parent(){const e=Dh(this._path);return null===e?null:new wg(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class yg{constructor(e,t,a){this._node=e,this.ref=t,this._index=a}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Th(e),a=Cg(this.ref,e);return new yg(this._node.getChild(t),a,lp)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,(t,a)=>e(new yg(a,Cg(this.ref,t),lp)))}hasChild(e){const t=new Th(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function _g(e,t){return(e=Vc(e))._checkNotDeleted("ref"),void 0!==t?Cg(e._root,t):e._root}function Cg(e,t){var a,n,i;return null===Nh((e=Vc(e))._path)?(a="child",n="path",(i=t)&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),jf(a,n,i)):jf("child","path",t),new wg(e._repo,Mh(e._path,t))}class kg{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const a=t._queryParams.getIndex();return new fg("value",this,new yg(e.snapshotNode,new wg(t._repo,t._path),a))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new gg(this,e,t):null}matches(e){return e instanceof kg&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}function Eg(e,t,a,n,i){let s;if("object"==typeof n&&(s=void 0,i=n),"function"==typeof n&&(s=n),i&&i.onlyOnce){const t=a,n=(a,n)=>{ng(e._repo,e,r),t(a,n)};n.userCallback=a.userCallback,n.context=a.context,a=n}const o=new vg(a,s||void 0),r=new kg(o);return function(e,t,a){let n;n=".info"===Nh(t._path)?rf(e.infoSyncTree_,t,a):rf(e.serverSyncTree_,t,a),Wf(e.eventQueue_,t._path,n)}(e._repo,e,r),()=>ng(e._repo,e,r)}function Sg(e,t,a,n){return Eg(e,0,t,a,n)}!function(e){nc(!$m,"__referenceConstructor has already been defined"),$m=e}(wg),function(e){nc(!zm,"__referenceConstructor has already been defined"),zm=e}(wg);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Tg={};let Ig=!1;function Ng(e,t,a,n,i){let s=n||e.options.databaseURL;void 0===s&&(e.options.projectId||qu("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Fu("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,r=pg(s,i),l=r.repoInfo;"undefined"!=typeof process&&_u&&(o=_u.FIREBASE_DATABASE_EMULATOR_HOST),o?(s=`http://${o}?ns=${l.namespace}`,r=pg(s,i),l=r.repoInfo):r.repoInfo.secure;const c=new nh(e.name,e.options,t);$f("Invalid Firebase Database URL",r),Lh(r.path)||qu("Database URL must point to the root of a Firebase Database (not including a child path).");const d=function(e,t,a,n){let i=Tg[t.name];i||(i={},Tg[t.name]=i);let s=i[e.toURLString()];s&&qu("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new Kf(e,Ig,a,n),i[e.toURLString()]=s,s}(l,e,c,new ah(e,a));return new xg(d,e)}class xg{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Qf(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new wg(this._repo,Ih())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const a=Tg[t];a&&a[e.key]===e||qu(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete a[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&qu("Cannot call "+e+" on a deleted database.")}}function Ag(e,t,a,n={}){(e=Vc(e))._checkNotDeleted("useEmulator");const i=`${t}:${a}`,s=e._repoInternal;if(e._instanceStarted){if(i===e._repoInternal.repoInfo_.host&&Bc(n,s.repoInfo_.emulatorOptions))return;qu("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)n.mockUserToken&&qu('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new ih(ih.OWNER);else if(n.mockUserToken){const t="string"==typeof n.mockUserToken?n.mockUserToken:_c(n.mockUserToken,e.app.options.projectId);o=new ih(t)}wc(t)&&(yc(t),Ec("Database",!0)),function(e,t,a,n){const i=t.lastIndexOf(":"),s=wc(t.substring(0,i));e.repoInfo_=new ch(t,s,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,a),n&&(e.authTokenProvider_=n)}(s,i,n,o)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Vh.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Vh.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},function(e){Su(ru),au(new Wc("database",(e,{instanceIdentifier:t})=>Ng(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),du(Cu,ku,e),du(Cu,ku,"esm2020")}();const Pg=Object.freeze(Object.defineProperty({__proto__:null,DataSnapshot:yg,Database:xg,_QueryImpl:bg,_QueryParams:Np,_ReferenceImpl:wg,_repoManagerDatabaseFromApp:Ng,_setSDKVersion:Su,_validatePathString:jf,child:Cg,connectDatabaseEmulator:Ag,getDatabase:function(e=cu(),t){const a=nu(e,"database").getImmediate({identifier:t});if(!a._instanceStarted){const e=gc("database");e&&Ag(a,...e)}return a},onValue:Sg,ref:_g},Symbol.toStringTag,{value:"Module"}));let Rg,Dg;async function Mg(){if(Dg)return Dg;const{getDatabase:e}=await z(async()=>{const{getDatabase:e}=await Promise.resolve().then(()=>Pg);return{getDatabase:e}},void 0),t=Rg||await(Rg||ja.initializeFirebase().then(e=>(Rg=null==e?void 0:e.app,Rg)));if(!t)throw new Error("Firebase app no inicializada");return Dg=e(t),Dg}class Lg{constructor(e){this.waiterId=e,this.listeners=new Map,this.activeCalls=new Map,this.db=null,this.initializing=!1,this._expectedInitialCallIds=new Set,this._initialSetProcessed=!1}async startListening(){if(!this.db)try{this.db=await Mg()}catch(t){return void console.error("❌ No se pudo obtener instancia Realtime DB:",t)}const e=Sg(_g(this.db,`waiters/${this.waiterId}/active_calls`),e=>{const t=e.val()||[];this.initializing&&!this._initialSetProcessed&&(this._expectedInitialCallIds=new Set(t.map(e=>String(e))),0===this._expectedInitialCallIds.size&&(this.initializing=!1,this._initialSetProcessed=!0)),this.updateActiveCallsListeners(t)},e=>{console.error("🚨 Error en UNIFIED listener:",e),this.handleError(e)});this.initializing=!0,this.listeners.set("waiter",e)}updateActiveCallsListeners(e){Array.from(this.activeCalls.keys()).forEach(t=>{e.includes(t)||(this.removeCallListener(t),this.onCallRemoved(t))}),e.forEach(e=>{this.activeCalls.has(e)||this.addCallListener(e)})}addCallListener(e){if(!this.db)return;const t=Sg(_g(this.db,`active_calls/${e}`),t=>{const a=t.val();if(a){const t=!this.activeCalls.has(e);this.activeCalls.set(e,a);const n=this.normalizeCallData(a);t?this.onNewCall(n):this.onCallUpdated(n),"acknowledged"!==a.status&&"completed"!==a.status||setTimeout(()=>{this.onCallMovedToHistory(e,n)},400),this.initializing&&!this._initialSetProcessed&&(this._expectedInitialCallIds.has(String(e))&&this._expectedInitialCallIds.delete(String(e)),0===this._expectedInitialCallIds.size&&(this.initializing=!1,this._initialSetProcessed=!0))}});this.listeners.set(`call_${e}`,t)}removeCallListener(e){const t=`call_${e}`;if(this.listeners.has(t)){this.listeners.get(t)(),this.listeners.delete(t)}this.activeCalls.delete(e)}onNewCall(e){console.debug("⚡ UNIFIED: Nueva llamada:",e.id,e);"pending"===e.status?(window.dispatchEvent(new CustomEvent("newWaiterCall",{detail:e})),window.dispatchEvent(new CustomEvent("ultraFastAddCall",{detail:e})),this.initializing||(this.playUltraFastSound(),this.vibrateUltraFast(),this.scheduleNativeNotification(e),this.showBrowserNotification(e)),this.logStatus(e,"pending")):this.onCallMovedToHistory(e.id,e)}onCallUpdated(e){"acknowledged"===e.status&&(this.showStatusUpdate(`Mesa ${e.table_number} - Atendiendo`),this.logStatus(e,"acknowledged")),window.dispatchEvent(new CustomEvent("updateCallStatus",{detail:e}))}onCallRemoved(e){this.showStatusUpdate("Servicio completado"),window.dispatchEvent(new CustomEvent("removeCall",{detail:{callId:e}}))}onCallMovedToHistory(e,t){let a="";switch(t.status){case"acknowledged":a=`Mesa ${t.table_number} - Atendiendo`;break;case"completed":a=`Mesa ${t.table_number} - Completado`;break;default:a=`Mesa ${t.table_number} - Actualizado`}this.showStatusUpdate(a),window.dispatchEvent(new CustomEvent("removeCall",{detail:{callId:e}})),window.dispatchEvent(new CustomEvent("callMovedToHistory",{detail:{callId:e,callData:t,status:t.status}})),"acknowledged"===t.status?this.logStatus(t,"acknowledged"):"completed"===t.status&&this.logStatus(t,"completed")}logStatus(e,t){try{if(!e||!e.id)return;switch(t){case"pending":console.info("[UNIFIED][PENDING]",`id=${e.id}`,`mesa=${e.table_number}`,`t=${e.called_at}`);break;case"acknowledged":console.info("[UNIFIED][ACKNOWLEDGED]",`id=${e.id}`,`mesa=${e.table_number}`,`ack=${e.acknowledged_at}`);break;case"completed":console.info("[UNIFIED][COMPLETED]",`id=${e.id}`,`mesa=${e.table_number}`,`comp=${e.completed_at}`)}}catch(a){}}normalizeCallData(e){var t,a;return{id:e.id,table_number:(null==(t=e.table)?void 0:t.number)||e.table_number,message:e.message||"Cliente solicita atención",urgency:e.urgency||"normal",status:e.status,called_at:e.called_at,acknowledged_at:e.acknowledged_at,completed_at:e.completed_at,timestamp:e.called_at,waiter_id:(null==(a=e.waiter)?void 0:a.id)||this.waiterId,table:e.table,waiter:e.waiter}}scheduleNativeNotification(e){try{Y&&Y.isPluginAvailable&&Y.isPluginAvailable("LocalNotifications")&&z(async()=>{const{LocalNotifications:e}=await import("./index-BoVJG3f6.js");return{LocalNotifications:e}},__vite__mapDeps([7,1,2])).then(({LocalNotifications:t})=>{t.schedule({notifications:[{title:`Mesa ${e.table_number} · ${e.urgency?e.urgency.toUpperCase():""}`,body:e.message||"Solicita atención",id:Number(Date.now()%1e5),extra:{callId:e.id,source:"unified-realtime"},schedule:null,smallIcon:void 0}]}).then(()=>{}).catch(e=>console.warn("⚠️ Error scheduling local notification:",e))}).catch(e=>{console.warn("⚠️ Error importing LocalNotifications:",e)})}catch(t){console.warn("⚠️ Exception scheduling native notification:",t)}}showBrowserNotification(e){try{if("undefined"==typeof Notification)return;if("granted"!==Notification.permission)return;const t=new Notification(`⚡ Mesa ${e.table_number}`,{body:`${e.message||"Solicita atención"} (UNIFIED)`,icon:"/favicon.ico",tag:`unified-call-${e.id}`,requireInteraction:!0});t.onclick=()=>{window.focus(),t.close()}}catch(t){}}playUltraFastSound(){try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),a=e.createGain();t.connect(a),a.connect(e.destination),t.frequency.setValueAtTime(800,e.currentTime),t.frequency.setValueAtTime(400,e.currentTime+.1),a.gain.setValueAtTime(.3,e.currentTime),a.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),t.start(e.currentTime),t.stop(e.currentTime+.3)}catch(e){const t=new Audio;t.src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+nfvnUjBjd+zO/eizEIDGKw5+mqWRMJRZzp4b5+JgU2jdXzzX4tBSF1xe/ejzQIElyx6OyrYRYJSKXi67RiHAY8k9nyyXkpBSR+zO/ijDEIDWOz6OyrXRQIR6Hn4L55KAU5jNTx0IAvBh1qtOnnqlkSCUig5OqyYhsGPJHY8sp7KgUle8vt3o4yBxFYr+ftrWIaBjeL0/LNfjAGIn3M7+CNMA==",t.volume=.7,t.play().catch(e=>{})}}vibrateUltraFast(){navigator.vibrate&&navigator.vibrate([100,50,100,50,200])}showStatusUpdate(e){const t=document.createElement("div");t.className="status-update",t.textContent=`⚡ ${e}`,document.body.appendChild(t),setTimeout(()=>t.classList.add("show"),10),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>t.remove(),200)},2e3)}async acknowledgeCall(e){try{const a=localStorage.getItem("token");let n=null;try{const t=await z(()=>Promise.resolve().then(()=>ec),void 0),a=t&&(t.default||t);if(a&&"function"==typeof a.acknowledgCall)n=await a.acknowledgCall(e);else{if(!a||"function"!=typeof a.acknowledgeCall)throw new Error("No acknowledge helper found");n=await a.acknowledgeCall(e)}}catch(t){n=await fetch(`https://mozoqr.com/api/waiter/calls/${e}/acknowledge`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}})}let i=!1;if(n&&"boolean"==typeof n.ok?i=n.ok:n&&"boolean"==typeof n.success?i=!1!==n.success:n&&(i=!0),!i){const e=n&&(n.status||n.code||"unknown");throw new Error(`Acknowledge failed: ${e}`)}window.dispatchEvent(new CustomEvent("callAcknowledged",{detail:{callId:e}}))}catch(a){console.error("UNIFIED: Error reconociendo llamada:",a),this.showError("Error al reconocer la llamada")}}async completeCall(e){try{const a=localStorage.getItem("token");let n=null;try{const t=await z(()=>Promise.resolve().then(()=>ec),void 0),a=t&&(t.default||t);if(a&&"function"==typeof a.completeCall)n=await a.completeCall(e);else{if(!a||"function"!=typeof a.complete)throw new Error("No complete helper found");n=await a.complete(e)}}catch(t){n=await fetch(`https://mozoqr.com/api/waiter/calls/${e}/complete`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}})}let i=!1;if(n&&"boolean"==typeof n.ok?i=n.ok:n&&"boolean"==typeof n.success?i=!1!==n.success:n&&(i=!0),!i){const e=n&&(n.status||n.code||"unknown");throw new Error(`Complete failed: ${e}`)}console.log("⚡ UNIFIED: Llamada completada"),window.dispatchEvent(new CustomEvent("removeCall",{detail:{callId:e}}));try{const{useNotificationsStore:t}=await z(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>tr);return{useNotificationsStore:e}},void 0);t().removeNotification(e)}catch(t){console.warn("⚠️ Unable to remove notification from store:",t)}}catch(a){console.error("UNIFIED: Error completando llamada:",a),this.showError("Error al completar la llamada")}}stopListening(){this.listeners.forEach(e=>{e()}),this.listeners.clear(),this.activeCalls.clear(),console.log("🛑 UNIFIED listener detenido")}async createTestCall(){console.log("🧪 UNIFIED: Creando llamada de prueba...");try{(await fetch("https://mozoqr.com/api/tables/1/call-waiter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Llamada de prueba UNIFIED",urgency:"high"})})).ok&&console.log("✅ UNIFIED: Llamada de prueba creada")}catch(e){console.error("❌ UNIFIED: Error creando llamada de prueba:",e)}}handleError(e){console.error("🚨 UNIFIED: Error en listener:",e),this.showError("Error de conexión en tiempo real")}showError(e){const t=document.createElement("div");t.className="ultra-fast-error",t.innerHTML=`\n            <p>❌ ${e}</p>\n            <p>Reintentando automáticamente...</p>\n            <button onclick="this.remove()">Cerrar</button>\n        `,document.body.appendChild(t),setTimeout(()=>{t.parentElement&&t.remove()},5e3),setTimeout(()=>{this.startListening()},2e3)}}window.addEventListener("beforeunload",()=>{window.unifiedNotifications&&window.unifiedNotifications.stopListening()});const Og={class:"modal-header"},Fg={class:"modal-body"},Ug={key:0,class:"loading-state"},Bg={key:1},qg={key:0,class:"selection-summary"},jg={class:"tables-grid"},$g=["onClick"],zg={class:"table-checkbox"},Vg=["checked","onChange"],Wg={class:"table-info"},Hg={class:"table-number"},Gg={key:0,class:"table-name"},Yg={class:"table-details"},Kg={key:0},Qg={key:1},Jg={key:0,class:"empty-state"},Zg={key:1,class:"quick-actions"},Xg={class:"modal-footer"},ev=["disabled"],tv={__name:"TableSelector",props:{availableTables:{type:Array,default:()=>[]},assignedTables:{type:Array,default:()=>[]}},emits:["close","tables-selected"],setup(e,{emit:n}){const s=e,f=n,g=t([]),b=t(!1),w=a(()=>s.availableTables||[]),y=e=>{const t=g.value.indexOf(e);-1===t?g.value.push(e):g.value.splice(t,1)},_=()=>{g.value=w.value.map(e=>e.id)},C=()=>{g.value=[]},k=()=>{console.log("🎯 TableSelector: Confirmando selección de mesas:",g.value),f("tables-selected",g.value)};return i(()=>{console.log("🏠 TableSelector mounted"),console.log("📋 Mesas disponibles recibidas:",s.availableTables),console.log("📋 Mesas asignadas recibidas:",s.assignedTables),console.log("Available tables:",w.value),console.log("Assigned tables:",s.assignedTables)}),(e,t)=>(r(),o("div",{class:"modal-overlay",onClick:t[4]||(t[4]=t=>e.$emit("close"))},[l("div",{class:"modal-content",onClick:t[3]||(t[3]=h(()=>{},["stop"]))},[l("div",Og,[t[6]||(t[6]=l("h3",null,[l("i",{class:"fas fa-table"}),v(" Seleccionar Mesas para Activar ")],-1)),l("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},t[5]||(t[5]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",Fg,[b.value?(r(),o("div",Ug,t[7]||(t[7]=[l("div",{class:"spinner"},null,-1),l("p",null,"Cargando mesas disponibles...",-1)]))):(r(),o("div",Bg,[g.value.length>0?(r(),o("div",qg,[l("strong",null,d(g.value.length)+" mesa(s) seleccionada(s)",1)])):c("",!0),l("div",jg,[(r(!0),o(p,null,m(w.value,e=>(r(),o("div",{key:e.id,class:u(["table-card",{selected:g.value.includes(e.id)}]),onClick:t=>y(e.id)},[l("div",zg,[l("input",{type:"checkbox",checked:g.value.includes(e.id),onClick:t[1]||(t[1]=h(()=>{},["stop"])),onChange:t=>y(e.id)},null,40,Vg)]),l("div",Wg,[l("div",Hg,"Mesa "+d(e.number),1),e.name&&e.name!==`Mesa ${e.number}`?(r(),o("div",Gg,d(e.name),1)):c("",!0),l("div",Yg,[e.capacity?(r(),o("span",Kg,[t[8]||(t[8]=l("i",{class:"fas fa-users"},null,-1)),v(" "+d(e.capacity)+" personas ",1)])):c("",!0),e.location?(r(),o("span",Qg,[t[9]||(t[9]=l("i",{class:"fas fa-map-marker-alt"},null,-1)),v(" "+d(e.location),1)])):c("",!0)])])],10,$g))),128)),0===w.value.length?(r(),o("div",Jg,t[10]||(t[10]=[l("i",{class:"fas fa-table"},null,-1),l("p",null,"No hay mesas disponibles para activar",-1),l("small",null,"Todas las mesas ya están asignadas a otros mozos",-1)]))):c("",!0)]),w.value.length>0?(r(),o("div",Zg,[l("button",{onClick:_,class:"quick-btn"},[t[11]||(t[11]=l("i",{class:"fas fa-check-double"},null,-1)),v(" Seleccionar Todas ("+d(w.value.length)+") ",1)]),g.value.length>0?(r(),o("button",{key:0,onClick:C,class:"quick-btn"},t[12]||(t[12]=[l("i",{class:"fas fa-times"},null,-1),v(" Deseleccionar Todas ")]))):c("",!0)])):c("",!0)]))]),l("div",Xg,[l("button",{onClick:t[2]||(t[2]=t=>e.$emit("close")),class:"btn btn-secondary"}," Cancelar "),l("button",{onClick:k,class:"btn btn-primary",disabled:0===g.value.length||b.value},[t[13]||(t[13]=l("i",{class:"fas fa-check"},null,-1)),v(" Activar "+d(g.value.length)+" Mesa(s) ",1)],8,ev)])])]))}},av=ar(tv,[["__scopeId","data-v-f6fe2c8a"]]),nv={class:"business-selector"},iv={key:0,class:"business-dropdown"},sv={class:"business-details"},ov={class:"business-name"},rv={class:"business-subtitle"},lv={class:"dropdown-arrow"},cv={key:0,class:"dropdown-menu"},dv={class:"dropdown-header"},uv={class:"businesses-list"},hv=["onClick"],pv={class:"business-info"},mv={class:"business-name"},fv={class:"business-address"},gv={key:0,class:"current-indicator"},vv={class:"dropdown-footer"},bv={key:1,class:"no-business-state"},wv={class:"no-business-content"},yv={class:"modal-content"},_v={class:"modal-body"},Cv={class:"form-group"},kv=["disabled"],Ev={class:"modal-footer"},Sv=["disabled"],Tv=["disabled"],Iv={key:0,class:"fas fa-spinner fa-spin"},Nv={key:1},xv={__name:"BusinessSelector",emits:["business-changed","businesses-loaded"],setup(e,{expose:a,emit:n}){const f=n,g=t([]),b=t(null),w=t(!1),y=t(!1),_=t(""),C=t(!1),k=t(!1),T=async()=>{k.value=!0;try{const e=await Xl.getWaiterBusinesses();e.success?(g.value=e.businesses||[],e.active_business_id&&g.value.length>0?b.value=g.value.find(t=>t.id===e.active_business_id)||null:b.value=e.active_business||null,f("businesses-loaded",{businesses:g.value,activeBusiness:b.value,needsBusiness:e.needs_business||0===g.value.length})):(console.error("❌ Error en respuesta de negocios:",e.message),Zo(e.message||"Error cargando negocios"))}catch(e){console.error("💥 Error loading businesses:",e),Zo("Error cargando negocios")}finally{k.value=!1}},I=async()=>{if(_.value.trim()){C.value=!0;try{const e=await Xl.joinBusinessWithCode(_.value.trim());e.success?(Jo(e.message||"Te has unido al negocio exitosamente"),_.value="",N(),await T()):Zo(e.message||"Error uniéndose al negocio")}catch(e){console.error("Error joining business:",e),Zo("Error uniéndose al negocio")}finally{C.value=!1}}},N=()=>{y.value=!1,_.value="",C.value=!1},x=e=>{e.target.closest(".business-dropdown")||(w.value=!1)};return i(async()=>{await T(),document.addEventListener("click",x)}),s(()=>{document.removeEventListener("click",x)}),a({loadBusinesses:T,getCurrentBusiness:()=>b.value}),(e,t)=>{var a;return r(),o("div",nv,[g.value.length>0?(r(),o("div",iv,[l("div",{class:"current-business",onClick:t[0]||(t[0]=e=>w.value=!w.value)},[t[5]||(t[5]=l("div",{class:"business-icon"},[l("i",{class:"fas fa-building"})],-1)),l("div",sv,[l("div",ov,d((null==(a=b.value)?void 0:a.name)||"Seleccionar Negocio"),1),l("div",rv,d(g.value.length)+" negocio"+d(1!==g.value.length?"s":""),1)]),l("div",lv,[l("i",{class:u(["fas fa-chevron-down",{rotated:w.value}])},null,2)])]),w.value?(r(),o("div",cv,[l("div",dv,[t[7]||(t[7]=l("h4",null,"Mis Negocios",-1)),l("button",{onClick:t[1]||(t[1]=e=>w.value=!1),class:"close-btn"},t[6]||(t[6]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",uv,[(r(!0),o(p,null,m(g.value,e=>{var a,n;return r(),o("button",{key:e.id,onClick:t=>(async e=>{try{const t=await Xl.setActiveWaiterBusiness(e.id);t.success?(b.value=e,w.value=!1,Jo(`Negocio "${e.name}" seleccionado`),f("business-changed",e)):Zo(t.message||"Error seleccionando negocio")}catch(t){console.error("Error selecting business:",t),Zo("Error seleccionando negocio")}})(e),class:u(["business-item",{active:(null==(a=b.value)?void 0:a.id)===e.id}])},[l("div",pv,[l("div",mv,d(e.name),1),l("div",fv,d(e.address||"Sin dirección"),1)]),(null==(n=b.value)?void 0:n.id)===e.id?(r(),o("div",gv,t[8]||(t[8]=[l("i",{class:"fas fa-check"},null,-1)]))):c("",!0)],10,hv)}),128))]),l("div",vv,[l("button",{onClick:t[2]||(t[2]=e=>{y.value=!0,w.value=!1}),class:"join-btn"},t[9]||(t[9]=[l("i",{class:"fas fa-plus"},null,-1),v(" Unirse a nuevo negocio ")]))])])):c("",!0)])):(r(),o("div",bv,[l("div",wv,[t[11]||(t[11]=l("i",{class:"fas fa-building"},null,-1)),t[12]||(t[12]=l("h3",null,"Sin negocios asignados",-1)),t[13]||(t[13]=l("p",null,"Necesitas unirte a un negocio para empezar a trabajar",-1)),l("button",{onClick:t[3]||(t[3]=e=>y.value=!0),class:"join-btn primary"},t[10]||(t[10]=[l("i",{class:"fas fa-plus"},null,-1),v(" Unirse a negocio ")]))])])),y.value?(r(),o("div",{key:2,class:"modal-overlay",onClick:h(N,["self"])},[l("div",yv,[l("div",{class:"modal-header"},[t[15]||(t[15]=l("h3",null,"Unirse a negocio",-1)),l("button",{onClick:N,class:"close-btn"},t[14]||(t[14]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",_v,[t[17]||(t[17]=l("p",null,"Ingresa el código del negocio al que deseas unirte:",-1)),l("form",{onSubmit:h(I,["prevent"])},[l("div",Cv,[t[16]||(t[16]=l("label",{for:"businessCode"},"Código del negocio:",-1)),E(l("input",{id:"businessCode","onUpdate:modelValue":t[4]||(t[4]=e=>_.value=e),type:"text",class:"form-input",placeholder:"Ej: ABC123",disabled:C.value,required:""},null,8,kv),[[S,_.value]])])],32)]),l("div",Ev,[l("button",{onClick:N,class:"btn btn-secondary",disabled:C.value}," Cancelar ",8,Sv),l("button",{onClick:I,class:"btn btn-primary",disabled:C.value||!_.value.trim()},[C.value?(r(),o("i",Iv)):(r(),o("span",Nv,"Unirse"))],8,Tv)])])])):c("",!0)])}}},Av=ar(xv,[["__scopeId","data-v-5b8ddc75"]]),Pv={class:"business-tables-manager"},Rv={class:"manager-header"},Dv={class:"manager-stats"},Mv={class:"stat-item"},Lv={class:"stat-number"},Ov={class:"stat-item success"},Fv={class:"stat-number"},Uv={class:"stat-item warning"},Bv={class:"stat-number"},qv={class:"stat-item danger"},jv={class:"stat-number"},$v={class:"tables-container"},zv={key:0,class:"loading-state"},Vv={key:1,class:"tables-grid"},Wv={class:"table-header"},Hv={class:"table-number"},Gv={class:"table-status"},Yv={key:0,class:"fas fa-exclamation-triangle status-icon urgent",title:"Tiene llamadas pendientes"},Kv={key:1,class:"fas fa-volume-mute status-icon silenced",title:"Silenciada"},Qv={key:2,class:"fas fa-check status-icon active",title:"Activa y asignada"},Jv={key:3,class:"fas fa-ban status-icon silenced",title:"Mesa silenciada"},Zv={key:4,class:"fas fa-circle status-icon available",title:"Disponible"},Xv={class:"table-info"},eb={key:0,class:"table-name"},tb={class:"table-details"},ab={key:0},nb={key:1},ib={key:1,class:"assigned-waiter"},sb={class:"table-actions"},ob=["onClick"],rb=["onClick"],lb=["onClick"],cb=["onClick"],db={key:2,class:"no-actions"},ub={key:0},hb={key:1},pb={key:0,class:"empty-state"},mb={class:"quick-actions"},fb=["disabled"],gb=ar({__name:"BusinessTablesManager",props:{businessId:{type:[String,Number],required:!0},businessName:{type:String,default:"Negocio"}},emits:["tables-updated"],setup(e,{expose:n,emit:s}){const h=e,f=s,g=t([]),b=t(!1),w=a(()=>g.value.length),y=a(()=>g.value.filter(e=>e.assigned_to_me).length),_=a(()=>g.value.filter(e=>!e.assigned_to_me&&!e.is_silenced).length),C=a(()=>g.value.filter(e=>e.is_silenced).length),k=a(()=>g.value.filter(e=>e.assigned_to_me)),E=a(()=>g.value.filter(e=>!e.assigned_to_me&&!e.is_silenced)),S=async()=>{b.value=!0,console.log("🏢 Cargando mesas del negocio:",h.businessId);try{const e=await Xl.getWaiterBusinessTables(h.businessId);console.log("📋 Respuesta de mesas del negocio:",e),e.success?(g.value=e.tables||[],console.log("✅ Mesas cargadas:",g.value.length,g.value),g.value.forEach((e,t)=>{t<3&&console.log(`🔍 Mesa ${e.number}:`,{id:e.id,assigned_to_me:e.assigned_to_me,is_silenced:e.is_silenced,assigned_waiter:e.assigned_waiter})}),console.log("📊 Estadísticas calculadas:"),console.log("  - Total mesas:",g.value.length),console.log("  - Asignadas a mí:",g.value.filter(e=>e.assigned_to_me).length),console.log("  - Disponibles:",g.value.filter(e=>!e.assigned_to_me&&!e.is_silenced).length),console.log("  - Silenciadas:",g.value.filter(e=>e.is_silenced).length),f("tables-updated",g.value)):(console.error("❌ Error en respuesta:",e.message),Zo(e.message||"Error cargando mesas del negocio"))}catch(e){console.error("💥 Error loading business tables:",e),Zo("Error cargando mesas del negocio")}finally{b.value=!1}},T=async()=>{await S()},I=async()=>{var e;const t=E.value;if(0!==t.length)try{if(await Xo("¿Tomar todas las mesas disponibles?",`Se asignarán ${t.length} mesas a tu cuenta.`,"Tomar todas","Cancelar","info")){const a=t.map(e=>e.id),n=await Xl.activateMultipleTables(a);n.success?(Jo(`${(null==(e=n.summary)?void 0:e.successful)||t.length} mesas asignadas`),await S()):Zo(n.message||"Error asignando mesas")}}catch(a){console.error("Error activating multiple tables:",a),Zo("Error asignando mesas múltiples")}},N=async()=>{var e;const t=k.value;if(0!==t.length)try{if(await Xo("¿Desasignarte de todas las mesas?",`Se desasignarán ${t.length} mesas de tu cuenta.`,"Desasignar todas","Cancelar","warning")){const a=t.map(e=>e.id),n=await Xl.deactivateMultipleTables(a);n.success?(Jo(`${(null==(e=n.summary)?void 0:e.successful)||t.length} mesas desasignadas`),await S()):Zo(n.message||"Error desasignando mesas")}}catch(a){console.error("Error deactivating multiple tables:",a),Zo("Error desasignando mesas múltiples")}};return i(()=>{console.log("🏢 BusinessTablesManager mounted with businessId:",h.businessId),S()}),n({loadBusinessTables:S,refreshTables:T}),(t,a)=>(r(),o("div",Pv,[l("div",Rv,[l("h3",null,[a[0]||(a[0]=l("i",{class:"fas fa-table"},null,-1)),v(" Mesas de "+d(e.businessName),1)]),l("div",Dv,[l("div",Mv,[l("div",Lv,d(w.value),1),a[1]||(a[1]=l("div",{class:"stat-label"},"Total mesas",-1))]),l("div",Ov,[l("div",Fv,d(y.value),1),a[2]||(a[2]=l("div",{class:"stat-label"},"Asignadas a mí",-1))]),l("div",Uv,[l("div",Bv,d(_.value),1),a[3]||(a[3]=l("div",{class:"stat-label"},"Disponibles",-1))]),l("div",qv,[l("div",jv,d(C.value),1),a[4]||(a[4]=l("div",{class:"stat-label"},"Silenciadas",-1))])])]),l("div",$v,[b.value?(r(),o("div",zv,a[5]||(a[5]=[l("div",{class:"spinner"},null,-1),l("p",null,"Cargando mesas del negocio...",-1)]))):(r(),o("div",Vv,[(r(!0),o(p,null,m(g.value,e=>(r(),o("div",{key:e.id,class:u(["table-card",{assigned:e.assigned_to_me,available:!e.assigned_to_me&&!e.is_silenced,silenced:e.is_silenced,"has-calls":e.pending_calls_count>0}])},[l("div",Wv,[l("div",Hv,"Mesa "+d(e.number),1),l("div",Gv,[e.assigned_to_me&&e.pending_calls_count>0?(r(),o("i",Yv)):e.assigned_to_me&&e.is_silenced?(r(),o("i",Kv)):e.assigned_to_me?(r(),o("i",Qv)):e.is_silenced?(r(),o("i",Jv)):(r(),o("i",Zv))])]),l("div",Xv,[e.name&&e.name!==`Mesa ${e.number}`?(r(),o("div",eb,d(e.name),1)):c("",!0),l("div",tb,[e.capacity?(r(),o("span",ab,[a[6]||(a[6]=l("i",{class:"fas fa-users"},null,-1)),v(" "+d(e.capacity)+" personas ",1)])):c("",!0),e.pending_calls_count>0?(r(),o("span",nb,[a[7]||(a[7]=l("i",{class:"fas fa-bell"},null,-1)),v(" "+d(e.pending_calls_count)+" llamada(s) ",1)])):c("",!0)]),e.assigned_waiter&&!e.assigned_to_me?(r(),o("div",ib,[a[8]||(a[8]=l("i",{class:"fas fa-user"},null,-1)),v(" Asignada a: "+d(e.assigned_waiter.name),1)])):c("",!0)]),l("div",sb,[e.assigned_to_me?(r(),o(p,{key:0},[e.is_silenced?(r(),o("button",{key:0,onClick:t=>(async e=>{try{const t=await Xl.unsilenceTable(e);t.success?(Jo(t.message||"Mesa activada"),await S()):Zo(t.message||"Error activando mesa")}catch(t){console.error("Error unsilencing table:",t),Zo("Error activando mesa")}})(e.id),class:"action-btn unsilence",title:"Activar mesa"},a[9]||(a[9]=[l("i",{class:"fas fa-volume-up"},null,-1)]),8,ob)):(r(),o("button",{key:1,onClick:t=>(async e=>{try{if(await Xo("¿Silenciar mesa?","La mesa no podrá realizar llamadas durante 30 minutos.","Silenciar","Cancelar","warning")){const t=await Xl.silenceTable(e,30);t.success?(Jo(t.message||"Mesa silenciada"),await S()):Zo(t.message||"Error silenciando mesa")}}catch(t){console.error("Error silencing table:",t),Zo("Error silenciando mesa")}})(e.id),class:"action-btn silence",title:"Silenciar mesa"},a[10]||(a[10]=[l("i",{class:"fas fa-volume-mute"},null,-1)]),8,rb)),l("button",{onClick:t=>(async e=>{try{if(await Xo("¿Desasignarte de esta mesa?","Ya no recibirás llamadas de esta mesa.","Desasignar","Cancelar","warning")){const t=await Xl.deactivateTable(e);t.success?(Jo(t.message||"Mesa desasignada"),await S()):Zo(t.message||"Error desasignando mesa")}}catch(t){console.error("Error deactivating table:",t),Zo("Error desasignando mesa")}})(e.id),class:"action-btn deactivate",title:"Desasignarme de esta mesa"},a[11]||(a[11]=[l("i",{class:"fas fa-times"},null,-1)]),8,lb)],64)):e.is_silenced?(r(),o("div",db,[e.is_silenced?(r(),o("span",ub,"Mesa silenciada")):(r(),o("span",hb,"No disponible"))])):(r(),o("button",{key:1,onClick:t=>(async e=>{console.log("🚀 BusinessTablesManager: Iniciando activación de mesa:",e);try{const t=await Xl.activateTable(e);console.log("📊 BusinessTablesManager: Respuesta de activación:",t),t.success?(console.log("✅ BusinessTablesManager: Mesa activada exitosamente"),Jo(t.message||"Mesa activada"),console.log("🔄 BusinessTablesManager: Recargando mesas del negocio..."),await S()):(console.error("❌ BusinessTablesManager: Error en respuesta:",t.message),Zo(t.message||"Error activando mesa"))}catch(t){console.error("💥 BusinessTablesManager: Error completo activando mesa:",t),Zo("Error activando mesa")}})(e.id),class:"action-btn activate",title:"Asignarme esta mesa"},a[12]||(a[12]=[l("i",{class:"fas fa-plus"},null,-1),v(" Tomar ")]),8,cb))])],2))),128)),0===g.value.length?(r(),o("div",pb,a[13]||(a[13]=[l("i",{class:"fas fa-table"},null,-1),l("h4",null,"Sin mesas registradas",-1),l("p",null,"Este negocio no tiene mesas registradas aún.",-1)]))):c("",!0)]))]),l("div",mb,[l("button",{onClick:T,class:"action-btn primary",disabled:b.value},[l("i",{class:u(["fas fa-sync-alt",{"fa-spin":b.value}])},null,2),a[14]||(a[14]=v(" Actualizar "))],8,fb),k.value.length>0?(r(),o("button",{key:0,onClick:N,class:"action-btn danger"},[a[15]||(a[15]=l("i",{class:"fas fa-sign-out-alt"},null,-1)),v(" Desasignarme de todas ("+d(k.value.length)+") ",1)])):c("",!0),E.value.length>0?(r(),o("button",{key:1,onClick:I,class:"action-btn success"},[a[16]||(a[16]=l("i",{class:"fas fa-check-double"},null,-1)),v(" Tomar todas disponibles ("+d(E.value.length)+") ",1)])):c("",!0)])]))}},[["__scopeId","data-v-0cdb7b2a"]]),vb={class:"table-profiles-manager"},bb={class:"profiles-header"},wb={key:0,class:"profiles-list"},yb={class:"profile-header"},_b={class:"profile-info"},Cb={class:"profile-name"},kb={key:0,class:"active-badge"},Eb={class:"profile-meta"},Sb={class:"table-count"},Tb={class:"created-date"},Ib={class:"profile-actions"},Nb=["onClick","disabled"],xb=["onClick","disabled"],Ab=["onClick"],Pb=["onClick"],Rb={class:"profile-tables"},Db={class:"tables-list"},Mb={key:0,class:"fas fa-exclamation-triangle",title:"En conflicto con otro mozo"},Lb={key:0,class:"conflict-info"},Ob={key:1,class:"activation-summary"},Fb={key:0,class:"summary-item success"},Ub={key:1,class:"summary-item info"},Bb={key:2,class:"summary-item warning"},qb={key:0,class:"empty-state"},jb={key:1,class:"loading-state"},$b={class:"modal-content"},zb={class:"modal-header"},Vb={class:"modal-body"},Wb={class:"form-group"},Hb={class:"form-group"},Gb={class:"tables-grid"},Yb=["value","disabled"],Kb={class:"table-info"},Qb={class:"table-number"},Jb={key:0,class:"table-name"},Zb={key:1,class:"status-badge mine"},Xb={key:2,class:"status-badge conflict"},ew={key:3,class:"status-badge available"},tw={class:"form-help"},aw={class:"form-actions"},nw=["disabled"],iw={key:0,class:"fas fa-spinner fa-spin"},sw={key:1,class:"fas fa-save"},ow=ar({__name:"TableProfilesManager",props:{businessId:{type:Number,required:!0},availableTables:{type:Array,default:()=>[]},assignedTables:{type:Array,default:()=>[]}},emits:["profiles-updated"],setup(e,{emit:t}){const n=e,s=t,f=I({profiles:[],loading:!1,processing:null,saving:!1,showCreateModal:!1,editingProfile:null,formData:{name:"",table_ids:[]}}),g=a(()=>f.profiles),b=a(()=>f.loading),w=a(()=>f.processing),y=a(()=>f.saving),_=a({get:()=>f.showCreateModal,set:e=>f.showCreateModal=e}),C=a(()=>f.editingProfile),k=a(()=>f.formData),N=a(()=>[...n.availableTables,...n.assignedTables].map(e=>({...e,is_assigned_to_me:n.assignedTables.some(t=>t.id===e.id),is_assigned_to_other:e.assigned_waiter&&"Tú"!==e.assigned_waiter,assigned_waiter:e.assigned_waiter||"Disponible"}))),x=async()=>{f.loading=!0;try{const e=await Ia.getWaiterTableProfiles();e.data.success?(f.profiles=e.data.profiles||[],console.log("✅ Perfiles cargados:",f.profiles.length)):Zo(e.data.message||"Error cargando perfiles")}catch(e){console.error("Error loading profiles:",e),Zo("Error cargando perfiles")}finally{f.loading=!1}},A=async()=>{if(f.formData.name.trim()&&0!==f.formData.table_ids.length){f.saving=!0;try{const e={name:f.formData.name.trim(),table_ids:f.formData.table_ids};let t;t=f.editingProfile?await Ia.updateWaiterTableProfile(f.editingProfile.id,e):await Ia.createWaiterTableProfile(e),t.data.success?(Jo(t.data.message||`Perfil ${f.editingProfile?"actualizado":"creado"} correctamente`),P(),await x(),s("profiles-updated")):Zo(t.data.message||`Error ${f.editingProfile?"actualizando":"creando"} perfil`)}catch(e){console.error("Error saving profile:",e),Zo(`Error ${f.editingProfile?"actualizando":"creando"} perfil`)}finally{f.saving=!1}}else Zo("Completa todos los campos requeridos")},P=()=>{f.showCreateModal=!1,f.editingProfile=null,f.formData={name:"",table_ids:[]}},R=e=>n.assignedTables.some(t=>t.number===e),D=e=>{if(!e)return"";return new Date(e).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})};return i(async()=>{console.log("🏠 TableProfilesManager mounted"),await x()}),(e,t)=>(r(),o("div",vb,[l("div",bb,[t[5]||(t[5]=l("div",{class:"header-info"},[l("h3",null,[l("i",{class:"fas fa-bookmark"}),v(" Mis Perfiles de Mesa ")]),l("p",{class:"header-description"}," Crea perfiles con conjuntos de mesas para activar rápidamente ")],-1)),l("button",{onClick:t[0]||(t[0]=e=>_.value=!0),class:"btn btn-primary"},t[4]||(t[4]=[l("i",{class:"fas fa-plus"},null,-1),v(" Crear Perfil ")]))]),b.value?c("",!0):(r(),o("div",wb,[(r(!0),o(p,null,m(g.value,e=>{var a,n,i;return r(),o("div",{key:e.id,class:u(["profile-card",{active:e.is_active,"has-conflicts":(null==(a=e.conflict_tables)?void 0:a.length)>0}])},[l("div",yb,[l("div",_b,[l("h4",Cb,[v(d(e.name)+" ",1),e.is_active?(r(),o("span",kb,"ACTIVO")):c("",!0)]),l("div",Eb,[l("span",Sb,[t[6]||(t[6]=l("i",{class:"fas fa-table"},null,-1)),v(" "+d((null==(n=e.table_numbers)?void 0:n.length)||0)+" mesas ",1)]),l("span",Tb," Creado "+d(D(e.created_at)),1)])]),l("div",Ib,[e.is_active?c("",!0):(r(),o("button",{key:0,onClick:t=>(async e=>{f.processing=e;try{const t=await Ia.activateWaiterTableProfile(e);t.data.success?(Jo(t.data.message||"Perfil activado"),await x(),s("profiles-updated")):Zo(t.data.message||"Error activando perfil")}catch(t){console.error("Error activating profile:",t),Zo("Error activando perfil")}finally{f.processing=null}})(e.id),class:"action-btn activate",disabled:w.value===e.id,title:"Activar perfil"},t[7]||(t[7]=[l("i",{class:"fas fa-play"},null,-1)]),8,Nb)),e.is_active?(r(),o("button",{key:1,onClick:t=>(async e=>{if(await Xo("¿Desactivar perfil?","Se desasignarán todas las mesas de este perfil.","Desactivar","Cancelar","warning")){f.processing=e;try{const t=await Ia.deactivateWaiterTableProfile(e);t.data.success?(Jo(t.data.message||"Perfil desactivado"),await x(),s("profiles-updated")):Zo(t.data.message||"Error desactivando perfil")}catch(t){console.error("Error deactivating profile:",t),Zo("Error desactivando perfil")}finally{f.processing=null}}})(e.id),class:"action-btn deactivate",disabled:w.value===e.id,title:"Desactivar perfil"},t[8]||(t[8]=[l("i",{class:"fas fa-pause"},null,-1)]),8,xb)):c("",!0),l("button",{onClick:t=>(e=>{f.editingProfile=e,f.formData={name:e.name,table_ids:[...e.table_ids||[]]},f.showCreateModal=!1})(e),class:"action-btn edit",title:"Editar perfil"},t[9]||(t[9]=[l("i",{class:"fas fa-edit"},null,-1)]),8,Ab),l("button",{onClick:t=>(async(e,t)=>{if(await Xo(`¿Eliminar perfil "${t}"?`,"Esta acción no se puede deshacer.","Eliminar","Cancelar","danger"))try{const t=await Ia.deleteWaiterTableProfile(e);t.data.success?(Jo(t.data.message||"Perfil eliminado"),await x(),s("profiles-updated")):Zo(t.data.message||"Error eliminando perfil")}catch(a){console.error("Error deleting profile:",a),Zo("Error eliminando perfil")}})(e.id,e.name),class:"action-btn delete",title:"Eliminar perfil"},t[10]||(t[10]=[l("i",{class:"fas fa-trash"},null,-1)]),8,Pb)])]),l("div",Rb,[l("div",Db,[(r(!0),o(p,null,m(e.table_numbers,t=>{var a,n;return r(),o("span",{key:t,class:u(["table-tag",{conflict:null==(a=e.conflict_tables)?void 0:a.includes(t),assigned:R(t)}])},[v(" Mesa "+d(t)+" ",1),(null==(n=e.conflict_tables)?void 0:n.includes(t))?(r(),o("i",Mb)):c("",!0)],2)}),128))])]),(null==(i=e.conflict_tables)?void 0:i.length)>0?(r(),o("div",Lb,[t[11]||(t[11]=l("i",{class:"fas fa-exclamation-triangle"},null,-1)),l("span",null,d(e.conflict_tables.length)+" mesa(s) en conflicto con otros mozos",1)])):c("",!0),e.is_active&&e.activation_summary?(r(),o("div",Ob,[e.activation_summary.activated>0?(r(),o("div",Fb,[t[12]||(t[12]=l("i",{class:"fas fa-check"},null,-1)),v(" "+d(e.activation_summary.activated)+" activadas ",1)])):c("",!0),e.activation_summary.already_yours>0?(r(),o("div",Ub,[t[13]||(t[13]=l("i",{class:"fas fa-user-check"},null,-1)),v(" "+d(e.activation_summary.already_yours)+" ya eran tuyas ",1)])):c("",!0),e.activation_summary.conflicts>0?(r(),o("div",Bb,[t[14]||(t[14]=l("i",{class:"fas fa-exclamation-triangle"},null,-1)),v(" "+d(e.activation_summary.conflicts)+" en conflicto ",1)])):c("",!0)])):c("",!0)],2)}),128)),0===g.value.length?(r(),o("div",qb,[t[16]||(t[16]=l("i",{class:"fas fa-bookmark"},null,-1)),t[17]||(t[17]=l("h4",null,"No tienes perfiles creados",-1)),t[18]||(t[18]=l("p",null,"Crea tu primer perfil para agrupar mesas que usas frecuentemente",-1)),l("button",{onClick:t[1]||(t[1]=e=>_.value=!0),class:"btn btn-primary"},t[15]||(t[15]=[l("i",{class:"fas fa-plus"},null,-1),v(" Crear Primer Perfil ")]))])):c("",!0)])),b.value?(r(),o("div",jb,t[19]||(t[19]=[l("i",{class:"fas fa-spinner fa-spin"},null,-1),l("p",null,"Cargando perfiles...",-1)]))):c("",!0),_.value||C.value?(r(),o("div",{key:2,class:"modal-overlay",onClick:h(P,["self"])},[l("div",$b,[l("div",zb,[l("h3",null,[t[20]||(t[20]=l("i",{class:"fas fa-bookmark"},null,-1)),v(" "+d(C.value?"Editar Perfil":"Crear Nuevo Perfil"),1)]),l("button",{onClick:P,class:"close-btn"},t[21]||(t[21]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",Vb,[l("form",{onSubmit:h(A,["prevent"])},[l("div",Wb,[t[22]||(t[22]=l("label",{for:"profileName"},"Nombre del perfil",-1)),E(l("input",{id:"profileName","onUpdate:modelValue":t[2]||(t[2]=e=>k.value.name=e),type:"text",class:"form-input",placeholder:"Ej: Zona A, Terraza, Mesas VIP...",maxlength:"50",required:""},null,512),[[S,k.value.name]]),t[23]||(t[23]=l("small",{class:"form-help"}," Máximo 50 caracteres. Debe ser único. ",-1))]),l("div",Hb,[t[24]||(t[24]=l("label",null,"Selecciona las mesas (máximo 20)",-1)),l("div",Gb,[(r(!0),o(p,null,m(N.value,e=>(r(),o("label",{key:e.id,class:u(["table-checkbox",{selected:k.value.table_ids.includes(e.id),assigned:e.is_assigned_to_me,conflict:e.is_assigned_to_other}])},[E(l("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":t[3]||(t[3]=e=>k.value.table_ids=e),disabled:k.value.table_ids.length>=20&&!k.value.table_ids.includes(e.id)},null,8,Yb),[[T,k.value.table_ids]]),l("span",Kb,[l("span",Qb,"Mesa "+d(e.number),1),e.name&&e.name!==`Mesa ${e.number}`?(r(),o("span",Jb,d(e.name),1)):c("",!0),e.is_assigned_to_me?(r(),o("span",Zb,"Tuya")):e.is_assigned_to_other?(r(),o("span",Xb,d(e.assigned_waiter),1)):(r(),o("span",ew,"Disponible"))])],2))),128))]),l("small",tw," Seleccionadas: "+d(k.value.table_ids.length)+"/20 ",1)]),l("div",aw,[l("button",{type:"button",onClick:P,class:"btn btn-secondary"}," Cancelar "),l("button",{type:"submit",class:"btn btn-primary",disabled:!k.value.name.trim()||0===k.value.table_ids.length||y.value},[y.value?(r(),o("i",iw)):(r(),o("i",sw)),v(" "+d(C.value?"Actualizar":"Crear")+" Perfil ",1)],8,nw)])],32)])])])):c("",!0)]))}},[["__scopeId","data-v-ad74d18c"]]),rw={class:"waiter-dashboard"},lw={class:"dashboard-header"},cw={class:"waiter-info"},dw={class:"waiter-details"},uw={class:"business-selector-container"},hw={class:"dashboard-stats"},pw={class:"stat-item"},mw={class:"stat-number"},fw={class:"stat-item urgent"},gw={class:"stat-number"},vw={class:"stat-item"},bw={class:"stat-number"},ww={class:"dashboard-content"},yw={class:"left-column"},_w={class:"section-card"},Cw={class:"section-header"},kw={class:"section-actions"},Ew=["disabled"],Sw={class:"tables-list"},Tw={class:"table-info"},Iw={class:"table-name"},Nw={key:0,class:"urgency-icon"},xw={key:1,class:"silence-icon"},Aw={key:2,class:"ok-icon"},Pw={key:0,class:"table-subtitle"},Rw={class:"table-actions"},Dw=["onClick"],Mw=["onClick"],Lw=["onClick"],Ow=["onClick"],Fw={key:0,class:"empty-state"},Uw={key:0},Bw={key:1},qw={class:"right-column"},jw={class:"section-card"},$w={class:"notifications-list",id:"calls-container"},zw={class:"notification-info"},Vw={class:"notification-title"},Ww={class:"notification-message"},Hw={class:"notification-time"},Gw={key:0,class:"urgent-badge"},Yw={class:"notification-actions"},Kw=["onClick","disabled"],Qw=["onClick","disabled"],Jw=["onClick"],Zw={key:0,class:"empty-notifications"},Xw={key:0},ey={key:1},ty={class:"section-card"},ay={class:"acknowledged-list"},ny={class:"notification-info"},iy={class:"notification-title"},sy={class:"notification-message"},oy={class:"notification-time"},ry={class:"notification-actions"},ly=["onClick","disabled"],cy={key:0,class:"empty-notifications"},dy={class:"modal-content large"},uy={class:"modal-header"},hy={class:"modal-body"},py={class:"modal-content large"},my={class:"modal-header"},fy={class:"modal-body"},gy=ar({__name:"Dashboard",setup(e){const b=g(),y=Ya(),_=I({assignedTables:[],availableTables:[],pendingCalls:[],callHistory:[],silencedTables:[],businesses:[],currentBusiness:null,needsBusiness:!1,loading:!1,processingCall:null,showTableSelector:!1,showTablesManager:!1,showProfilesManager:!1}),C=a(()=>_.availableTables),k=a(()=>_.silencedTables),E=a(()=>_.loading),S=a(()=>_.processingCall),T=a({get:()=>_.showTableSelector,set:e=>_.showTableSelector=e}),N=a({get:()=>_.showTablesManager,set:e=>_.showTablesManager=e}),x=a({get:()=>_.showProfilesManager,set:e=>_.showProfilesManager=e}),A=t(null);a(()=>_.businesses);const P=a(()=>_.currentBusiness),R=a(()=>_.needsBusiness);a(()=>{var e;return(null==(e=_.currentBusiness)?void 0:e.name)||"Seleccionar Negocio"});const D=a(()=>{try{if(window&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls){const e=new Set(Array.from(window.ultraFastNotifications.activeCalls.keys()).map(e=>String(e)));return _.pendingCalls.filter(t=>!e.has(String(t.id)))}}catch(e){}return _.pendingCalls}),M=a(()=>{try{const e=new Set(window&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls?Array.from(window.ultraFastNotifications.activeCalls.keys()).map(e=>String(e)):[]);return _.callHistory.filter(t=>!e.has(String(t.id)))}catch(e){return _.callHistory}});a(()=>{try{if(window&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls){const e=new Set(Array.from(window.ultraFastNotifications.activeCalls.keys()).map(e=>String(e)));return _.pendingCalls.filter(t=>!e.has(String(t.id)))}}catch(e){}return _.pendingCalls});const L=a(()=>_.assignedTables);function O(e){const t=String(e.id);_.callHistory=_.callHistory.filter(e=>String(e.id)!==t);const a=_.pendingCalls.findIndex(e=>String(e.id)===t),n=Date.now(),i=e.called_at||e.timestamp||n,s=Math.max(0,Math.floor((n-i)/6e4)),o={...e,minutes_ago:s};-1===a?_.pendingCalls.unshift(o):_.pendingCalls[a]={..._.pendingCalls[a],...o}}function F(e){try{const a=null==e?void 0:e.detail;if(!a||!a.id)return;O(a);try{"function"==typeof H&&H()}catch(t){}}catch(t){console.warn("Error handling ultraFastAddCall:",t)}}function U(e){try{const t=null==e?void 0:e.detail;if(!t||!t.id)return;O(t)}catch(t){console.warn("Error handling updateCallStatus:",t)}}function B(e){var t;try{const a=null==(t=null==e?void 0:e.detail)?void 0:t.callId;if(!a)return;const n=String(a);_.pendingCalls=_.pendingCalls.filter(e=>String(e.id)!==n)}catch(a){console.warn("Error handling removeCall:",a)}}function q(){_.pendingCalls=[]}function j(e){var t;try{const a=null==(t=null==e?void 0:e.detail)?void 0:t.callId;if(!a)return;const n=_.pendingCalls.findIndex(e=>String(e.id)===String(a));if(-1!==n){const e={..._.pendingCalls[n],status:"acknowledged"};_.pendingCalls.splice(n,1),_.callHistory.unshift(e)}}catch(a){console.warn("Error handling callAcknowledged:",a)}}function $(e){try{const t=(null==e?void 0:e.detail)||{},a=t.callId||t.callData&&t.callData.id,n=t.callData||null;if(!a)return;if(n&&"pending"===n.status)return;_.pendingCalls=_.pendingCalls.filter(e=>String(e.id)!==String(a));const i=_.callHistory.find(e=>String(e.id)===String(a));i?Object.assign(i,n||{}):n&&_.callHistory.unshift(n)}catch(t){console.warn("Error manejando callMovedToHistory en Dashboard:",t)}}let V=null;const W=async()=>{if(!_.needsBusiness&&_.currentBusiness){_.loading=!0;try{await Promise.all([H(),G(),K(),Q()])}catch(e){console.error("Error loading dashboard data:",e),Zo("Error cargando datos del dashboard")}finally{_.loading=!1}}};i(async()=>{await W(),window.__waiterDashboardListenersRegistered||(window.addEventListener("ultraFastAddCall",F),window.addEventListener("newWaiterCall",F),window.addEventListener("updateCallStatus",U),window.addEventListener("removeCall",B),window.addEventListener("clearAllCalls",q),window.addEventListener("callAcknowledged",j),window.addEventListener("callMovedToHistory",$),window.__waiterDashboardListenersRegistered=!0);try{window.debugUltra=()=>({pendingCalls:_.pendingCalls.slice(),activeCalls:window.ultraFastNotifications?Array.from(window.ultraFastNotifications.activeCalls.keys()):[]})}catch(e){}}),s(()=>{try{window.__waiterDashboardListenersRegistered&&(window.removeEventListener("ultraFastAddCall",F),window.removeEventListener("newWaiterCall",F),window.removeEventListener("updateCallStatus",U),window.removeEventListener("removeCall",B),window.removeEventListener("clearAllCalls",q),window.removeEventListener("callAcknowledged",j),window.removeEventListener("callMovedToHistory",$),window.__waiterDashboardListenersRegistered=!1)}catch(e){console.warn("Error removing ultraFast event listeners:",e)}try{V&&V.stopListening&&V.stopListening()}catch(e){console.warn("Error stopping ultraFastNotifications on unmount:",e)}});const H=async()=>{var e;if(_.currentBusiness)try{const t=await Xl.getWaiterBusinessTables(_.currentBusiness.id);if(t.success){const a=(null==(e=t.tables)?void 0:e.filter(e=>{var t;return"assigned_to_me"===(null==(t=e.status)?void 0:t.assignment)}))||[];_.assignedTables=a}}catch(t){console.error("❌ Error cargando mesas asignadas:",t),Zo("Error al cargar las mesas asignadas")}},G=async()=>{},K=async()=>{try{const e=await Xl.getAvailableTables();e.success&&(_.availableTables=e.available_tables||[])}catch(e){console.error("💥 Error loading available tables:",e)}},Q=async()=>{try{const e=await Xl.getSilencedTables();e.success&&(_.silencedTables=e.silenced_tables||[])}catch(e){console.error("Error loading silenced tables:",e)}},J=async e=>{try{if(await Xo("¿Silenciar mesa?","La mesa no podrá realizar llamadas durante 30 minutos.","Silenciar","Cancelar","warning")){const t=await Xl.silenceTable(e,30);t.success?(Jo(t.message||"Mesa silenciada"),await H(),await Q()):Zo(t.message||"Error silenciando mesa")}}catch(t){console.error("Error silencing table:",t),Zo("Error silenciando mesa")}},Z=async()=>{await W()},X=async()=>{try{if(await Xo("¿Finalizar turno?","Te desasignarás de todas las mesas y saldrás de la aplicación.","Finalizar Turno","Cancelar","danger")){if(_.assignedTables.length>0){const e=_.assignedTables.map(e=>e.id);await Xl.deactivateMultipleTables(e)}oe(),await y.logout(),Jo("Turno finalizado correctamente"),await b.push("/login")}}catch(e){console.error("Error ending shift:",e),Zo("Error finalizando turno")}},ee=e=>{_.businesses=e.businesses||[],_.currentBusiness=e.activeBusiness||null,_.needsBusiness=e.needsBusiness||!1,_.currentBusiness&&!_.needsBusiness&&(W(),se())},te=e=>{_.currentBusiness=e,_.assignedTables=[],_.availableTables=[],_.pendingCalls=[],_.silencedTables=[],W(),se()},ae=async e=>{var t;if(_.showTableSelector=!1,0!==e.length)try{const a=await Xl.activateMultipleTables(e);a.success?(console.log("✅ Dashboard: Mesas activadas exitosamente"),Jo(a.message||`${(null==(t=a.summary)?void 0:t.successful)||e.length} mesas activadas`),await H(),await K(),se()):Zo(a.message||"Error activando mesas")}catch(a){console.error("💥 Dashboard: Error completo activando mesas múltiples:",a),Zo("Error activando mesas")}},ne=async e=>{await W()},ie=async()=>{await W()},se=async()=>{if(y.user&&!_.needsBusiness)try{V=function(e){"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission();try{Y&&Y.isPluginAvailable&&Y.isPluginAvailable("LocalNotifications")&&z(async()=>{const{LocalNotifications:e}=await import("./index-BoVJG3f6.js");return{LocalNotifications:e}},__vite__mapDeps([7,1,2])).then(({LocalNotifications:e})=>{e.requestPermissions().then(e=>{console.log("UNIFIED: LocalNotifications permissions:",e)}).catch(e=>{console.warn("Error pidiendo permisos LocalNotifications:",e)}),e.createChannel&&e.createChannel({id:"mozo_waiter",name:"Mozo - Llamadas",importance:5,visibility:1,description:"Notificaciones de llamadas y eventos importantes para mozos"}).then(()=>{console.log("✅ UNIFIED: Canal mozo_waiter creado")}).catch(e=>{console.warn("⚠️ Error creando canal mozo_waiter:",e)})}).catch(e=>console.warn("⚠️ No se pudo importar LocalNotifications:",e))}catch(a){console.warn("⚠️ Excepción al preparar LocalNotifications:",a)}const t=new Lg(e);return t.startListening(),console.log("⚡ UNIFIED notifications inicializadas"),t}(y.user.id.toString())}catch(e){console.error("❌ Error configurando Ultra Fast Firebase:",e),Zo("Error configurando notificaciones ultra rápidas")}},oe=async()=>{try{V&&(V.stopListening(),V=null)}catch(e){console.error("❌ Error desconectando Ultra Fast Firebase:",e)}};i(async()=>{window.addEventListener("newWaiterCall",re),window.addEventListener("updateCallStatus",le),window.addEventListener("removeCall",ce),window.addEventListener("clearAllCalls",de)}),s(()=>{oe(),window.removeEventListener("newWaiterCall",re),window.removeEventListener("updateCallStatus",le),window.removeEventListener("removeCall",ce),window.removeEventListener("clearAllCalls",de)});const re=async e=>{console.log("🔔 Nueva llamada desde Firebase:",e.detail),_.pendingCalls.unshift(e.detail),await H()},le=async e=>{console.log("🔄 Llamada actualizada desde Firebase:",e.detail);const t=e.detail,a=_.pendingCalls.findIndex(e=>e.id===t.id);-1!==a&&(_.pendingCalls[a]=t)},ce=async e=>{const{callId:t}=e.detail;_.pendingCalls=_.pendingCalls.filter(e=>e.id!==t),await H()},de=async e=>{_.pendingCalls=[],await H()},ue=async()=>{if(V)try{const e=await V.createTestCall();Jo(`🧪 Llamada de prueba creada: Mesa ${e.table_number}`)}catch(e){console.error("Error creando llamada de prueba:",e),Zo("Error al crear la llamada de prueba")}else Zo("Sistema de notificaciones ultra rápidas no disponible")};return(e,t)=>{var a;return r(),o("div",rw,[l("div",lw,[l("div",cw,[t[9]||(t[9]=l("div",{class:"waiter-avatar"},[l("i",{class:"fas fa-user-circle"})],-1)),l("div",dw,[l("h2",null,d((null==(a=n(y).user)?void 0:a.name)||"Mozo"),1),l("div",uw,[f(Av,{onBusinessChanged:te,onBusinessesLoaded:ee,ref_key:"businessSelector",ref:A},null,512)])])]),l("div",hw,[l("div",pw,[l("div",mw,d(L.value.length),1),t[10]||(t[10]=l("div",{class:"stat-label"},"Mesas asignadas",-1))]),l("div",fw,[l("div",gw,d(D.value.length),1),t[11]||(t[11]=l("div",{class:"stat-label"},"Llamadas pendientes",-1))]),l("div",vw,[l("div",bw,d(k.value.length),1),t[12]||(t[12]=l("div",{class:"stat-label"},"Mesas silenciadas",-1))])])]),l("div",ww,[l("div",yw,[l("div",_w,[l("div",Cw,[t[17]||(t[17]=l("h3",null,[l("i",{class:"fas fa-table"}),v(" Todas ")],-1)),l("div",kw,[R.value?c("",!0):(r(),o("button",{key:0,onClick:t[0]||(t[0]=e=>x.value=!0),class:"action-btn info"},t[13]||(t[13]=[l("i",{class:"fas fa-bookmark"},null,-1),v(" Perfiles ")]))),R.value?c("",!0):(r(),o("button",{key:1,onClick:t[1]||(t[1]=e=>N.value=!0),class:"action-btn secondary"},t[14]||(t[14]=[l("i",{class:"fas fa-cog"},null,-1),v(" Gestionar Mesas ")]))),R.value?c("",!0):(r(),o("button",{key:2,onClick:t[2]||(t[2]=e=>T.value=!0),class:"action-btn primary"},t[15]||(t[15]=[l("i",{class:"fas fa-plus"},null,-1),v(" Activar Mesas ")]))),l("button",{onClick:Z,class:"action-btn",disabled:E.value},[l("i",{class:u(["fas fa-sync-alt",{"fa-spin":E.value}])},null,2)],8,Ew),l("button",{onClick:ue,class:"action-btn warning"},t[16]||(t[16]=[l("i",{class:"fas fa-flask"},null,-1),v(" Test Call ")]))])]),l("div",Sw,[(r(!0),o(p,null,m(L.value,e=>(r(),o("div",{key:e.id,class:u(["table-item",{"has-calls":e.pending_calls_count>0,silenced:e.is_silenced}])},[l("div",Tw,[l("div",Iw,[v(" Mesa "+d(e.number)+" ",1),e.pending_calls_count>0?(r(),o("span",Nw,t[18]||(t[18]=[l("i",{class:"fas fa-exclamation-triangle"},null,-1)]))):e.is_silenced?(r(),o("span",xw,t[19]||(t[19]=[l("i",{class:"fas fa-volume-mute"},null,-1)]))):(r(),o("span",Aw,t[20]||(t[20]=[l("i",{class:"fas fa-check"},null,-1)])))]),e.name&&e.name!==`Mesa ${e.number}`?(r(),o("div",Pw,d(e.name),1)):c("",!0)]),l("div",Rw,[e.notifications_enabled?c("",!0):(r(),o("button",{key:0,onClick:t=>(async e=>{try{const t=await Xl.activateTable(e);t.success?(Jo(t.message||"Mesa activada"),await H(),se()):Zo(t.message||"Error activando mesa")}catch(t){console.error("💥 Dashboard: Error completo activando mesa:",t),Zo("Error activando mesa")}})(e.id),class:"table-action-btn activate",title:"Activar llamadas"},t[21]||(t[21]=[l("i",{class:"fas fa-check"},null,-1)]),8,Dw)),!e.is_silenced&&e.notifications_enabled?(r(),o("button",{key:1,onClick:t=>J(e.id),class:"table-action-btn silence",title:"Silenciar"},t[22]||(t[22]=[l("i",{class:"fas fa-volume-mute"},null,-1)]),8,Mw)):c("",!0),e.is_silenced?(r(),o("button",{key:2,onClick:t=>(async e=>{try{const t=await Xl.unsilenceTable(e);t.success?(Jo(t.message||"Silencio removido"),await H(),await Q()):Zo(t.message||"Error removiendo silencio")}catch(t){console.error("Error unsilencing table:",t),Zo("Error removiendo silencio")}})(e.id),class:"table-action-btn unsilence",title:"Activar"},t[23]||(t[23]=[l("i",{class:"fas fa-volume-up"},null,-1)]),8,Lw)):c("",!0),l("button",{onClick:t=>(async e=>{try{if(await Xo("¿Desactivar mesa?","Te desasignarás de esta mesa y no recibirás más llamadas.","Desactivar","Cancelar","warning")){const t=await Xl.deactivateTable(e);t.success?(Jo(t.message||"Mesa desactivada"),await H(),await K(),await G(),se()):Zo(t.message||"Error desactivando mesa")}}catch(t){console.error("Error deactivating table:",t),Zo("Error desactivando mesa")}})(e.id),class:"table-action-btn deactivate",title:"Desactivar"},t[24]||(t[24]=[l("i",{class:"fas fa-times"},null,-1)]),8,Ow)])],2))),128)),0===L.value.length?(r(),o("div",Fw,[t[25]||(t[25]=l("i",{class:"fas fa-table"},null,-1)),R.value?(r(),o("p",Bw,"Selecciona un negocio para ver las mesas disponibles")):(r(),o("p",Uw,"No tienes mesas asignadas")),R.value?c("",!0):(r(),o("button",{key:2,onClick:t[3]||(t[3]=e=>T.value=!0),class:"btn btn-primary"}," Activar Mesas "))])):c("",!0)])])]),l("div",qw,[l("div",jw,[t[30]||(t[30]=l("div",{class:"section-header"},[l("h3",null,"Notificaciones:")],-1)),l("div",$w,[(r(!0),o(p,null,m(D.value,e=>{var a;return r(),o("div",{key:e.id,class:u(["notification-item",{urgent:"high"===e.urgency,old:e.minutes_ago>5}])},[l("div",zw,[l("div",Vw," Mesa "+d(e.table_number||(null==(a=e.table)?void 0:a.number))+": ",1),l("div",Ww,d(e.message||"Solicita mozo"),1),l("div",Hw,[v(" Hace "+d(e.minutes_ago)+"m ",1),"high"===e.urgency?(r(),o("span",Gw,"URGENTE")):c("",!0)])]),l("div",Yw,[l("button",{onClick:t=>(async e=>{if(V)try{_.processingCall=e,await V.acknowledgeCall(e)}catch(t){console.error("Error reconociendo llamada:",t),Zo("Error al reconocer la llamada")}finally{_.processingCall=null}else Zo("Sistema de notificaciones ultra rápidas no disponible")})(e.id),class:"notification-action-btn ok",disabled:S.value===e.id,title:"OK - Confirmar llamada"},t[26]||(t[26]=[l("i",{class:"fas fa-check"},null,-1)]),8,Kw),l("button",{onClick:t=>(async e=>{if(V)try{_.processingCall=e,await V.completeCall(e)}catch(t){console.error("Error completando llamada:",t),Zo("Error al completar la llamada")}finally{_.processingCall=null}else Zo("Sistema de notificaciones ultra rápidas no disponible")})(e.id),class:"notification-action-btn complete",disabled:S.value===e.id,title:"Completar atención"},t[27]||(t[27]=[l("i",{class:"fas fa-check-double"},null,-1)]),8,Qw),l("button",{onClick:t=>(async e=>{await J(e),await G()})(e.table.id),class:"notification-action-btn silence",title:"Silenciar mesa"},t[28]||(t[28]=[l("i",{class:"fas fa-volume-mute"},null,-1)]),8,Jw)])],2)}),128)),0===D.value.length?(r(),o("div",Zw,[t[29]||(t[29]=l("i",{class:"fas fa-bell-slash"},null,-1)),R.value?(r(),o("p",ey,"Selecciona un negocio para ver las llamadas")):(r(),o("p",Xw,"No hay llamadas pendientes"))])):c("",!0)])]),l("div",ty,[t[33]||(t[33]=l("div",{class:"section-header"},[l("h3",null,"Historial")],-1)),l("div",ay,[(r(!0),o(p,null,m(M.value,e=>{var a;return r(),o("div",{key:`hist-${e.id}`,class:"notification-item acknowledged"},[l("div",ny,[l("div",iy,"Mesa "+d(e.table_number||(null==(a=e.table)?void 0:a.number))+":",1),l("div",sy,d(e.message||"Solicita mozo"),1),l("div",oy,d(e.acknowledged_at?"Atendida":""),1)]),l("div",ry,[l("button",{onClick:t=>(async e=>{if(e){_.processingCall=e;try{V&&V.completeCall?await V.completeCall(e):await Xl.completeCall(e),_.callHistory=_.callHistory.filter(t=>String(t.id)!==String(e)),Jo("Llamada marcada como completada")}catch(t){console.error("Error completing call from history:",t),Zo("Error completando la llamada")}finally{_.processingCall=null}}})(e.id),class:"notification-action-btn complete",disabled:S.value===e.id,title:"Completar desde historial"},t[31]||(t[31]=[l("i",{class:"fas fa-check-double"},null,-1)]),8,ly)])])}),128)),0===M.value.length?(r(),o("div",cy,t[32]||(t[32]=[l("i",{class:"fas fa-history"},null,-1),l("p",null,"No hay historial disponible",-1)]))):c("",!0)])]),l("div",{class:"section-card"},[l("button",{onClick:X,class:"end-shift-btn"},t[34]||(t[34]=[l("i",{class:"fas fa-sign-out-alt"},null,-1),v(" Salir y desactivar notificaciones ")]))])])]),T.value&&!R.value?(r(),w(av,{key:0,"available-tables":C.value,"assigned-tables":L.value,onClose:t[4]||(t[4]=e=>T.value=!1),onTablesSelected:ae},null,8,["available-tables","assigned-tables"])):c("",!0),N.value&&P.value?(r(),o("div",{key:1,class:"modal-overlay",onClick:t[6]||(t[6]=h(e=>N.value=!1,["self"]))},[l("div",dy,[l("div",uy,[l("h3",null,[t[35]||(t[35]=l("i",{class:"fas fa-building"},null,-1)),v(" "+d(P.value.name)+" - Gestión de Mesas ",1)]),l("button",{onClick:t[5]||(t[5]=e=>N.value=!1),class:"close-btn"},t[36]||(t[36]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",hy,[f(gb,{"business-id":P.value.id,"business-name":P.value.name,onTablesUpdated:ne},null,8,["business-id","business-name"])])])])):c("",!0),x.value&&P.value?(r(),o("div",{key:2,class:"modal-overlay",onClick:t[8]||(t[8]=h(e=>x.value=!1,["self"]))},[l("div",py,[l("div",my,[t[38]||(t[38]=l("h3",null,[l("i",{class:"fas fa-bookmark"}),v(" Perfiles de Mesa ")],-1)),l("button",{onClick:t[7]||(t[7]=e=>x.value=!1),class:"close-btn"},t[37]||(t[37]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",fy,[f(ow,{"business-id":P.value.id,"available-tables":C.value,"assigned-tables":L.value,onProfilesUpdated:ie},null,8,["business-id","available-tables","assigned-tables"])])])])):c("",!0)])}}},[["__scopeId","data-v-257fbbc7"]]),vy={class:"editable-field"},by={key:0,class:"field-label"},wy={key:1,class:"edit-container"},yy=["placeholder"],_y=["placeholder","min","max"],Cy=["value"],ky=ar({__name:"EditableField",props:{value:{type:[String,Number],default:""},label:{type:String,default:""},type:{type:String,default:"text"},placeholder:{type:String,default:""},options:{type:Array,default:()=>[]},editable:{type:Boolean,default:!0},min:{type:[Number,String],default:null},max:{type:[Number,String],default:null},unit:{type:String,default:""},displayValue:{type:String,default:""}},emits:["update:value"],setup(e,{emit:n}){const i=e,s=n,f=t(i.value),g=t(!1),b=t(null);N(()=>i.value,e=>{g.value||(f.value=e)});const w=a(()=>{if(i.displayValue)return i.displayValue;if("select"===i.type&&i.options.length){const e=i.options.find(e=>e.value===f.value);return e?e.label:f.value}return f.value+(i.unit?" "+i.unit:"")}),y=()=>{i.editable&&(g.value=!0,setTimeout(()=>{b.value&&b.value.focus()},100))},_=()=>{g.value=!1,s("update:value",f.value)},C=e=>{"Enter"===e.key?_():"Escape"===e.key&&(g.value=!1,f.value=i.value)},k=()=>{g.value=!1,f.value=i.value};return(t,a)=>(r(),o("div",vy,[e.label?(r(),o("div",by,d(e.label),1)):c("",!0),l("div",{class:u(["field-content",{"is-editing":g.value}])},[g.value?(r(),o("div",wy,["text"===e.type?E((r(),o("input",{key:0,ref_key:"inputRef",ref:b,type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e),placeholder:e.placeholder,class:"edit-input",onKeydown:C,onChange:_,onBlur:k},null,40,yy)),[[S,f.value]]):"number"===e.type?E((r(),o("input",{key:1,ref_key:"inputRef",ref:b,type:"number","onUpdate:modelValue":a[1]||(a[1]=e=>f.value=e),placeholder:e.placeholder,min:e.min,max:e.max,class:"edit-input",onKeydown:C,onChange:_,onBlur:k},null,40,_y)),[[S,f.value]]):"date"===e.type?E((r(),o("input",{key:2,ref_key:"inputRef",ref:b,type:"date","onUpdate:modelValue":a[2]||(a[2]=e=>f.value=e),class:"edit-input",onKeydown:C,onChange:_,onBlur:k},null,544)),[[S,f.value]]):"textarea"===e.type?E((r(),o("textarea",{key:3,ref_key:"inputRef",ref:b,"onUpdate:modelValue":a[3]||(a[3]=e=>f.value=e),rows:"3",class:"edit-input",onKeydown:C,onChange:_,onBlur:k},null,544)),[[S,f.value]]):"select"===e.type?E((r(),o("select",{key:4,ref_key:"inputRef",ref:b,"onUpdate:modelValue":a[4]||(a[4]=e=>f.value=e),class:"edit-select",onChange:_,onBlur:k},[(r(!0),o(p,null,m(e.options,e=>(r(),o("option",{key:e.value,value:e.value},d(e.label),9,Cy))),128))],544)),[[x,f.value]]):c("",!0),l("div",{class:"edit-actions"},[l("button",{type:"button",class:"action-button save-button",onClick:_},a[6]||(a[6]=[l("i",{class:"bi bi-check"},null,-1)])),l("button",{type:"button",class:"action-button cancel-button",onClick:k},a[7]||(a[7]=[l("i",{class:"bi bi-x"},null,-1)]))])])):(r(),o("div",{key:0,class:"display-value",onClick:y},[v(d(w.value)+" ",1),e.editable?(r(),o("button",{key:0,class:"edit-button",onClick:h(y,["stop"])},a[5]||(a[5]=[l("i",{class:"bi bi-pencil"},null,-1)]))):c("",!0)]))],2)]))}},[["__scopeId","data-v-c09b4c9d"]]),Ey={class:"profile-container"},Sy={class:"container py-4"},Ty={class:"row justify-content-center"},Iy={class:"col-12 col-lg-8"},Ny={class:"card"},xy={class:"card-body"},Ay={key:0,class:"alert alert-success"},Py={key:1,class:"alert alert-danger"},Ry={key:2,class:"text-center my-5"},Dy={class:"mb-4 text-center"},My={class:"avatar-container"},Ly=["src"],Oy={class:"avatar-overlay"},Fy={class:"mb-3"},Uy=["disabled"],By={class:"mb-3"},qy=["disabled"],jy={class:"mb-3"},$y=["disabled"],zy={class:"mb-3"},Vy=["disabled"],Wy={class:"mb-3"},Hy=["disabled"],Gy={key:0,class:"form-text"},Yy={class:"mb-4"},Ky=["disabled"],Qy={key:0,class:"form-text"},Jy={class:"d-flex gap-2 mt-4"},Zy=["disabled"],Xy={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},e_=["disabled"],t_={class:"text-end"},a_=["disabled"],n_={class:"modal-dialog"},i_={class:"modal-content"},s_={class:"modal-header"},o_={class:"modal-body"},r_={class:"mb-3"},l_=["disabled"],c_={class:"modal-footer"},d_=["disabled"],u_=["disabled"],h_={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},p_={key:0,class:"modal-backdrop fade show"};const m_=ar({name:"WaiterProfileView",setup(){const e=g(),n=Ya(),s=t({name:"",email:"",phone:"",avatar:""}),o=t({current:"",new:"",confirm:""}),r=t(!0),l=t(!1),c=t(""),d=t(""),u=t(null),h=t(null),p=t(!1),m=t(""),f=t(!1),v=a(()=>!o.value.new||o.value.new.length>=8),b=a(()=>!o.value.new||!o.value.confirm||o.value.new===o.value.confirm),w=a(()=>!(!s.value.name||!s.value.email)&&(!(o.value.current||o.value.new||o.value.confirm)||o.value.current&&v.value&&b.value));i(()=>{(async()=>{r.value=!0,c.value="";try{const e=Or.getUser()||{id:"1",name:"Juan Pérez",email:"juan@ejemplo.com",phone:"555-123-4567",avatar:"https://randomuser.me/api/portraits/men/32.jpg"};s.value={...e}}catch(e){console.error("Error al cargar datos del usuario:",e),c.value="No se pudieron cargar tus datos. Por favor, inténtalo de nuevo."}finally{r.value=!1}})()});const y=t(!1),_=t(["Atención al cliente","Trabajo en equipo","Resolución de problemas","Manejo de bandeja","Conocimiento de vinos"]);return{user:s,passwords:o,loading:r,updating:l,error:c,success:d,avatarPreview:u,showDeleteModal:p,deleteConfirmation:m,deleting:f,isPasswordValid:v,doPasswordsMatch:b,isFormValid:w,handleAvatarChange:e=>{const t=e.target.files[0];if(!t)return;if(t.size>5242880)return void(c.value="La imagen no puede ser mayor a 5MB");h.value=t;const a=new FileReader;a.onload=e=>{u.value=e.target.result},a.readAsDataURL(t)},updateProfile:async()=>{var e,t;if(w.value){l.value=!0,c.value="",d.value="";try{const e=new FormData;e.append("name",s.value.name),e.append("email",s.value.email),e.append("phone",s.value.phone||""),h.value&&e.append("avatar",h.value),o.value.current&&o.value.new&&(e.append("current_password",o.value.current),e.append("password",o.value.new),e.append("password_confirmation",o.value.confirm)),console.log("Perfil actualizado:",{name:s.value.name,email:s.value.email,phone:s.value.phone,passwordChanged:!!o.value.current,avatarChanged:!!h.value});const t=Or.getUser();t&&(t.name=s.value.name,t.email=s.value.email,t.phone=s.value.phone,u.value&&(t.avatar=u.value),Or.setUser(t)),o.value.current="",o.value.new="",o.value.confirm="",h.value=null,d.value="Perfil actualizado correctamente"}catch(a){console.error("Error al actualizar perfil:",a),c.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"No se pudo actualizar el perfil. Por favor, inténtalo de nuevo."}finally{l.value=!1}}},deleteAccount:async()=>{var t,a;if("ELIMINAR"===m.value){f.value=!0;try{console.log("Cuenta eliminada"),await Or.logout(),e.push("/login")}catch(n){console.error("Error al eliminar cuenta:",n),c.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"No se pudo eliminar la cuenta. Por favor, inténtalo de nuevo.",p.value=!1,m.value="",f.value=!1}}},goBack:()=>{e.push("/waiter")},isEditing:y,skills:_,handleUpdate:async(e,t)=>{console.log(`Actualizando ${e} a ${t}`);const a=new FormData;a.append(e,t);try{await n.updateProfile(a)}catch(i){console.error("Fallo al actualizar, la tienda necesita ser corregida.",i)}}}}},[["render",function(e,t,a,n,i,s){return r(),o("div",Ey,[l("div",Sy,[l("div",Ty,[l("div",Iy,[l("div",Ny,[l("div",xy,[t[26]||(t[26]=l("h1",{class:"h3 mb-4"},"Mi perfil",-1)),n.success?(r(),o("div",Ay,d(n.success),1)):c("",!0),n.error?(r(),o("div",Py,d(n.error),1)):c("",!0),n.loading&&!n.user.name?(r(),o("div",Ry,t[14]||(t[14]=[l("div",{class:"spinner-border text-primary",role:"status"},[l("span",{class:"visually-hidden"},"Cargando...")],-1)]))):(r(),o("form",{key:3,onSubmit:t[9]||(t[9]=h((...e)=>n.updateProfile&&n.updateProfile(...e),["prevent"]))},[l("div",Dy,[l("div",My,[l("img",{src:n.user.avatar||"/placeholder-avatar.png",alt:"Avatar",class:"avatar-img"},null,8,Ly),l("div",Oy,[t[15]||(t[15]=l("label",{for:"avatar-upload",class:"avatar-edit-btn"},[l("i",{class:"bi bi-camera"})],-1)),l("input",{type:"file",id:"avatar-upload",accept:"image/*",class:"visually-hidden",onChange:t[0]||(t[0]=(...e)=>n.handleAvatarChange&&n.handleAvatarChange(...e))},null,32)])])]),l("div",Fy,[t[16]||(t[16]=l("label",{for:"name",class:"form-label"},"Nombre completo",-1)),E(l("input",{type:"text",class:"form-control",id:"name","onUpdate:modelValue":t[1]||(t[1]=e=>n.user.name=e),required:"",disabled:n.updating},null,8,Uy),[[S,n.user.name]])]),l("div",By,[t[17]||(t[17]=l("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),E(l("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[2]||(t[2]=e=>n.user.email=e),required:"",disabled:n.updating},null,8,qy),[[S,n.user.email]])]),l("div",jy,[t[18]||(t[18]=l("label",{for:"phone",class:"form-label"},"Teléfono",-1)),E(l("input",{type:"tel",class:"form-control",id:"phone","onUpdate:modelValue":t[3]||(t[3]=e=>n.user.phone=e),disabled:n.updating},null,8,$y),[[S,n.user.phone]])]),t[23]||(t[23]=l("hr",{class:"my-4"},null,-1)),t[24]||(t[24]=l("h4",{class:"h5 mb-3"},"Cambiar contraseña",-1)),l("div",zy,[t[19]||(t[19]=l("label",{for:"current-password",class:"form-label"},"Contraseña actual",-1)),E(l("input",{type:"password",class:"form-control",id:"current-password","onUpdate:modelValue":t[4]||(t[4]=e=>n.passwords.current=e),disabled:n.updating},null,8,Vy),[[S,n.passwords.current]])]),l("div",Wy,[t[20]||(t[20]=l("label",{for:"new-password",class:"form-label"},"Nueva contraseña",-1)),E(l("input",{type:"password",class:"form-control",id:"new-password","onUpdate:modelValue":t[5]||(t[5]=e=>n.passwords.new=e),disabled:n.updating},null,8,Hy),[[S,n.passwords.new]]),n.passwords.new&&!n.isPasswordValid?(r(),o("div",Gy," La contraseña debe tener al menos 8 caracteres ")):c("",!0)]),l("div",Yy,[t[21]||(t[21]=l("label",{for:"confirm-password",class:"form-label"},"Confirmar nueva contraseña",-1)),E(l("input",{type:"password",class:"form-control",id:"confirm-password","onUpdate:modelValue":t[6]||(t[6]=e=>n.passwords.confirm=e),disabled:n.updating},null,8,Ky),[[S,n.passwords.confirm]]),n.passwords.confirm&&!n.doPasswordsMatch?(r(),o("div",Qy," Las contraseñas no coinciden ")):c("",!0)]),l("div",Jy,[l("button",{type:"submit",class:"btn btn-primary",disabled:n.updating||!n.isFormValid},[n.updating?(r(),o("span",Xy)):c("",!0),t[22]||(t[22]=v(" Guardar cambios "))],8,Zy),l("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[7]||(t[7]=(...e)=>n.goBack&&n.goBack(...e)),disabled:n.updating}," Cancelar ",8,e_)]),t[25]||(t[25]=l("hr",{class:"my-4"},null,-1)),l("div",t_,[l("button",{type:"button",class:"btn btn-outline-danger",onClick:t[8]||(t[8]=e=>n.showDeleteModal=!0),disabled:n.updating}," Eliminar cuenta ",8,a_)])],32))])])])])]),l("div",{class:u(["modal",{"show d-block":n.showDeleteModal}]),tabindex:"-1"},[l("div",n_,[l("div",i_,[l("div",s_,[t[27]||(t[27]=l("h5",{class:"modal-title"},"Eliminar cuenta",-1)),l("button",{type:"button",class:"btn-close",onClick:t[10]||(t[10]=e=>n.showDeleteModal=!1)})]),l("div",o_,[t[29]||(t[29]=l("p",{class:"mb-3"},"¿Estás seguro de que deseas eliminar tu cuenta? Esta acción no se puede deshacer.",-1)),t[30]||(t[30]=l("div",{class:"alert alert-danger"},[l("i",{class:"bi bi-exclamation-triangle-fill me-2"}),v(" Al eliminar tu cuenta perderás todo el acceso a tus datos y negocios asociados. ")],-1)),l("div",r_,[t[28]||(t[28]=l("label",{for:"confirm-delete",class:"form-label"},'Escribe "ELIMINAR" para confirmar',-1)),E(l("input",{type:"text",class:"form-control",id:"confirm-delete","onUpdate:modelValue":t[11]||(t[11]=e=>n.deleteConfirmation=e),disabled:n.deleting},null,8,l_),[[S,n.deleteConfirmation]])])]),l("div",c_,[l("button",{type:"button",class:"btn btn-secondary",onClick:t[12]||(t[12]=e=>n.showDeleteModal=!1),disabled:n.deleting}," Cancelar ",8,d_),l("button",{type:"button",class:"btn btn-danger",onClick:t[13]||(t[13]=(...e)=>n.deleteAccount&&n.deleteAccount(...e)),disabled:"ELIMINAR"!==n.deleteConfirmation||n.deleting},[n.deleting?(r(),o("span",h_)):c("",!0),t[31]||(t[31]=v(" Eliminar mi cuenta "))],8,u_)])])])],2),n.showDeleteModal?(r(),o("div",p_)):c("",!0)])}],["__scopeId","data-v-bc0a0118"]]),f_=e("waiter",()=>{const e=t(localStorage.getItem("waiterBusinessId")||null),n=t(null),i=t([]),s=t([]),o=t([]),r=t(!1),l=t(null),c=a(()=>!!e.value),d=a(()=>o.value.filter(e=>"pending"===e.status).sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp))),u=e=>({...e,name:String(e.number),notifications_on:e.notifications_enabled??!0,is_muted:!(e.notifications_enabled??1),color:e.color??null,alert:!1});return{businessId:e,businessData:n,tables:i,profiles:s,notifications:o,isLoading:r,error:l,isAssociated:c,activeNotifications:d,associateBusiness:async t=>{var a,i;r.value=!0,l.value=null;try{const a=await Ia.waiterOnboard(t),{business:i}=a.data;return e.value=i.id,n.value=i,localStorage.setItem("waiterBusinessId",i.id),!0}catch(s){throw l.value=(null==(i=null==(a=s.response)?void 0:a.data)?void 0:i.message)||"Error al asociar el negocio.",s}finally{r.value=!1}},fetchInitialData:async()=>{var e,t,a;if(c.value){r.value=!0,l.value=null;try{const[t,a,n]=await Promise.all([Ia.getWaiterTables(),Ia.listWaiterProfiles(),Ia.getWaiterNotifications()]),r=(null==(e=t.data)?void 0:e.tables)??t.data;i.value=Array.isArray(r)?r.map(u):[],s.value=a.data,o.value=n.data}catch(n){l.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al cargar los datos iniciales.",console.error(n)}finally{r.value=!1}}},toggleTableNotifications:async e=>{var t,a;const n=e.notifications_on;e.notifications_on=!n,e.is_muted=!e.notifications_on;try{await Ia.toggleTableNotifications(e.id,{value:e.notifications_on})}catch(i){e.notifications_on=n,e.is_muted=!n,l.value=(null==(a=null==(t=i.response)?void 0:t.data)?void 0:a.message)||"Error al actualizar la mesa.",console.error(i)}},fetchNotifications:async()=>{try{const e=await Ia.getWaiterNotifications();o.value=e.data}catch(e){console.error("Error fetching notifications:",e)}},handleNotification:async(e,t)=>{var a,n;try{await Ia.handleWaiterNotification(e,{action:t}),o.value=o.value.filter(t=>t.id!==e)}catch(i){l.value=(null==(n=null==(a=i.response)?void 0:a.data)?void 0:n.message)||"Error al procesar la notificación.",console.error(i)}},createProfile:async e=>{var t,a;try{const t=await Ia.createWaiterProfile({name:e});s.value.push(t.data)}catch(n){l.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al crear el perfil.",console.error(n)}},deleteProfile:async e=>{var t,a;try{await Ia.deleteWaiterProfile(e),s.value=s.value.filter(t=>t.id!==e)}catch(n){l.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al eliminar el perfil.",console.error(n)}},clearWaiterData:()=>{e.value=null,n.value=null,i.value=[],s.value=[],o.value=[],localStorage.removeItem("waiterBusinessId")}}}),g_={class:"onboarding-container"},v_={class:"content-wrapper"},b_=["src"],w_={class:"form-container"},y_=["disabled"],__={key:0,class:"spinner"},C_={key:1},k_=["onInput","onKeydown"],E_={key:0,class:"error-feedback"},S_=ar({__name:"Onboarding",setup(e){const a=g(),i=f_(),s=Ya(),u=t(["","","",""]),f=t(!1),v=t(""),b=t([]),w=e=>{e.preventDefault();const t=e.clipboardData.getData("text").trim().slice(0,4);/^\d{4}$/.test(t)&&(t.split("").forEach((e,t)=>{u.value[t]=e,b.value[t].value=e}),b.value[3].focus(),y())},y=async()=>{const e=u.value.join("");if(4===e.length){f.value=!0,v.value="";try{await i.associateBusiness(e),await s.fetchUser(),a.push({name:"waiter-dashboard"})}catch(t){v.value=t.message||"El código es incorrecto o ha expirado.","vibrate"in navigator&&navigator.vibrate(100)}finally{f.value=!1}}else v.value="El código debe tener 4 dígitos."},_=()=>{a.push("/profile")};return(e,t)=>{var a;return r(),o("div",g_,[l("div",v_,[l("div",{class:"user-header",onClick:_,title:"Editar perfil"},[l("img",{src:(null==(a=n(s).user)?void 0:a.avatar)||"/src/assets/default-avatar.png",alt:"Avatar",class:"user-avatar"},null,8,b_),t[0]||(t[0]=l("div",{class:"business-selector-wrapper",title:"Vincúlate introduciendo un código"},[l("span",null,"Negocio:"),l("select",{disabled:""},[l("option",null,"Ninguno")])],-1))]),l("div",w_,[l("form",{onSubmit:h(y,["prevent"])},[l("button",{type:"submit",class:"btn-primary",disabled:f.value},[f.value?(r(),o("span",__)):(r(),o("span",C_,"AGREGAR NEGOCIO"))],8,y_),t[1]||(t[1]=l("h2",{class:"code-prompt"},"Código",-1)),l("div",{class:"otp-inputs",onPaste:w},[(r(),o(p,null,m(4,e=>l("input",{key:e,type:"text",inputmode:"numeric",maxlength:"1",class:"otp-box",ref_for:!0,ref:t=>b.value[e-1]=t,onInput:t=>((e,t)=>{const a=e.target;let n=a.value;/^\d*$/.test(n)?(u.value[t-1]=n,n&&a.nextElementSibling&&a.nextElementSibling.focus()):a.value=""})(t,e),onKeydown:e=>{var t;"Backspace"===(t=e).key&&!t.target.value&&t.target.previousElementSibling&&t.target.previousElementSibling.focus()}},null,40,k_)),64))],32)],32),v.value?(r(),o("p",E_,d(v.value),1)):c("",!0)])])])}}},[["__scopeId","data-v-f5df5087"]]),T_={class:"dashboard"},I_={class:"container py-3"},N_={class:"role-section"},x_={class:"role-dropdown me-2"},A_={class:"dropdown-menu","aria-labelledby":"roleMenu"},P_={class:"user-id-container d-flex align-items-center"},R_={class:"user-id me-2"},D_={class:"row mb-3"},M_={class:"col-12"},L_={class:"card"},O_={class:"card-body"},F_={class:"d-flex gap-2"},U_=["disabled"],B_=["disabled"],q_={class:"row g-3 card-grid"},j_={class:"col-6"},$_={class:"col-6"},z_={class:"col-6"},V_={class:"col-6"},W_={class:"position-fixed bottom-0 end-0 p-3",style:{"z-index":"11"}},H_={key:0,class:"toast show",role:"alert","aria-live":"assertive","aria-atomic":"true"},G_={class:"toast-header"},Y_={class:"toast-body"};const K_=ar({name:"AdminDashboardView",setup(){const e=g(),a=t("FGT-464"),n=t("admin"),s=t(!1),o=t(""),r=t(!1);return i(()=>{(async()=>{try{a.value="FGT-464"}catch(e){console.error("Error al cargar datos del negocio:",e)}})()}),{businessCode:a,selectedRole:n,showToast:s,toastMessage:o,isSendingNotification:r,copyBusinessCode:()=>{navigator.clipboard.writeText(a.value).then(()=>{s.value=!0,o.value="Código copiado al portapapeles",setTimeout(()=>{s.value=!1},3e3)}).catch(e=>{console.error("Error al copiar al portapapeles:",e)})},sendTestNotification:async()=>{r.value=!0;try{await Ta.post("/admin/notifications/test",{waiter_id:"all"});s.value=!0,o.value="Notificación de prueba enviada exitosamente",window.debugPanel&&window.debugPanel.addLog("info","Notificación de prueba enviada a todos los mozos","Admin Dashboard")}catch(e){console.error("Error al enviar notificación de prueba:",e),s.value=!0,o.value="Error al enviar notificación de prueba",window.debugPanel&&window.debugPanel.addLog("error",`Error al enviar notificación: ${e.message}`,"Admin Dashboard",e)}finally{r.value=!1,setTimeout(()=>{s.value=!1},3e3)}},sendTestNotificationToSpecificWaiter:async()=>{const e=prompt("Ingresa el ID del mozo para enviar la notificación de prueba:");if(e){r.value=!0;try{await Ta.post("/admin/notifications/test",{waiter_id:e});s.value=!0,o.value=`Notificación de prueba enviada al mozo ${e}`,window.debugPanel&&window.debugPanel.addLog("info",`Notificación de prueba enviada al mozo ${e}`,"Admin Dashboard")}catch(t){console.error("Error al enviar notificación de prueba:",t),s.value=!0,o.value="Error al enviar notificación de prueba",window.debugPanel&&window.debugPanel.addLog("error",`Error al enviar notificación: ${t.message}`,"Admin Dashboard",t)}finally{r.value=!1,setTimeout(()=>{s.value=!1},3e3)}}},handleRoleChange:()=>{"admin"===n.value?n.value="waiter":n.value="admin","waiter"===n.value&&e.push("/waiter")}}}},[["render",function(e,t,a,n,i,s){const u=_("router-link");return r(),o("div",T_,[l("div",I_,[l("div",N_,[l("div",x_,[t[6]||(t[6]=l("button",{class:"btn btn-outline-secondary dropdown-toggle",id:"roleMenu","data-bs-toggle":"dropdown"}," Rol Admin ",-1)),l("ul",A_,[l("li",null,[l("a",{class:"dropdown-item",href:"#",onClick:t[0]||(t[0]=e=>n.selectedRole="admin")},"Admin")]),l("li",null,[l("a",{class:"dropdown-item",href:"#",onClick:t[1]||(t[1]=(...e)=>n.handleRoleChange&&n.handleRoleChange(...e))},"Mozo")])])]),l("div",P_,[l("span",R_,"ID:"+d(n.businessCode),1),l("button",{class:"btn btn-sm btn-outline-secondary",onClick:t[2]||(t[2]=(...e)=>n.copyBusinessCode&&n.copyBusinessCode(...e)),title:"Copiar al portapapeles"},t[7]||(t[7]=[l("i",{class:"bi bi-clipboard"},null,-1)]))])]),l("div",D_,[l("div",M_,[l("div",L_,[l("div",O_,[t[10]||(t[10]=l("h5",{class:"card-title"},[l("i",{class:"bi bi-bell-fill text-primary me-2"}),v(" Prueba de Notificaciones ")],-1)),t[11]||(t[11]=l("p",{class:"card-text text-muted"}," Envía una notificación de prueba a todos los mozos activos para verificar el sistema. ",-1)),l("div",F_,[l("button",{class:"btn btn-primary",onClick:t[3]||(t[3]=(...e)=>n.sendTestNotification&&n.sendTestNotification(...e)),disabled:n.isSendingNotification},[t[8]||(t[8]=l("i",{class:"bi bi-send me-2"},null,-1)),v(" "+d(n.isSendingNotification?"Enviando...":"Enviar Notificación de Prueba"),1)],8,U_),l("button",{class:"btn btn-outline-secondary",onClick:t[4]||(t[4]=(...e)=>n.sendTestNotificationToSpecificWaiter&&n.sendTestNotificationToSpecificWaiter(...e)),disabled:n.isSendingNotification},t[9]||(t[9]=[l("i",{class:"bi bi-person-plus me-2"},null,-1),v(" Enviar a Mozo Específico ")]),8,B_)])])])])]),l("div",q_,[l("div",j_,[f(u,{to:"/admin/qr",class:"card dashboard-card text-center text-decoration-none"},{default:y(()=>t[12]||(t[12]=[l("div",{class:"card-body"},[l("i",{class:"bi bi-qr-code"})],-1),l("div",{class:"card-footer"},"QR",-1)])),_:1,__:[12]})]),l("div",$_,[f(u,{to:"/admin/stats",class:"card dashboard-card text-center text-decoration-none"},{default:y(()=>t[13]||(t[13]=[l("div",{class:"card-body"},[l("i",{class:"bi bi-graph-up"})],-1),l("div",{class:"card-footer"},"ESTADÍSTICAS",-1)])),_:1,__:[13]})]),l("div",z_,[f(u,{to:"/admin/staff",class:"card dashboard-card text-center text-decoration-none"},{default:y(()=>t[14]||(t[14]=[l("div",{class:"card-body"},[l("i",{class:"bi bi-person-fill"})],-1),l("div",{class:"card-footer"},"PERSONAL",-1)])),_:1,__:[14]})]),l("div",V_,[f(u,{to:"/admin/settings",class:"card dashboard-card text-center text-decoration-none"},{default:y(()=>t[15]||(t[15]=[l("div",{class:"card-body"},[l("i",{class:"bi bi-gear-fill"})],-1),l("div",{class:"card-footer"},"CONFIGURACIÓN",-1)])),_:1,__:[15]})])])]),l("div",W_,[n.showToast?(r(),o("div",H_,[l("div",G_,[t[16]||(t[16]=l("strong",{class:"me-auto"},"Notificación",-1)),l("button",{type:"button",class:"btn-close",onClick:t[5]||(t[5]=e=>n.showToast=!1)})]),l("div",Y_,d(n.toastMessage),1)])):c("",!0)])])}]]),Q_=e("admin",()=>{const e=t(localStorage.getItem("businessId")||null),n=t(null),i=t([]),s=t([]),o=t([]),r=t([]),l=t([]),c=t(null),d=t(!1),u=t(null),h=t({next:null,prev:null}),p=t({current_page:1,last_page:1}),m=a(()=>i.value.length>0),f=a(()=>s.value.length>0),g=a(()=>o.value.filter(e=>"pending"===e.status)),v=async()=>{var e;d.value=!0,u.value=null;try{const t=await Ia.getMenus(),a=(null==(e=t.data)?void 0:e.menus)??t.data,n=Array.isArray(a)?a:[];return i.value=n.map(e=>({id:e.id,name:e.name,url:e.view_url||e.file_path,thumbnailUrl:e.preview_url||e.thumbnail_url||"/src/assets/pdf-thumb.png",isDefault:e.is_default})),i.value}catch(t){throw u.value=t.message||"Error al cargar menús",t}finally{d.value=!1}},b=async()=>{d.value=!0,u.value=null;try{const e=await Ia.getTables();return s.value=e.data.tables||[],!0}catch(e){return u.value=e.message||"Error al obtener mesas",!1}finally{d.value=!1}},w=async()=>{var e;d.value=!0,u.value=null;try{const t=await Ia.getStaffRequests(),a=(null==(e=t.data)?void 0:e.requests)??t.data,n=Array.isArray(a)?a:[];return o.value=n,o.value}catch(t){throw u.value=t.message||"Error al cargar solicitudes de personal",t}finally{d.value=!1}},y=async()=>{var e,t;d.value=!0,u.value=null;try{const a=await Ia.getArchivedStaffRequests(),n=(null==(e=a.data)?void 0:e.archived_requests)??(null==(t=a.data)?void 0:t.requests)??a.data,i=Array.isArray(n)?n:[];return r.value=i,r.value}catch(a){throw u.value=a.message||"Error al cargar solicitudes archivadas",a}finally{d.value=!1}},_=async(e=1)=>{var t,a,n,i,s,o,r,c,m,f;d.value=!0,u.value=null;try{const d="string"==typeof e?await Ta.get(e.replace(Ta.defaults.baseURL+"/","")):await Ia.getStaff(e),u=(null==(t=d.data)?void 0:t.staff)??(null==(a=d.data)?void 0:a.data)??d.data;return l.value=Array.isArray(u)?u:[],h.value={next:(null==(i=null==(n=d.data)?void 0:n.links)?void 0:i.next)??null,prev:(null==(o=null==(s=d.data)?void 0:s.links)?void 0:o.prev)??null},p.value={current_page:(null==(c=null==(r=d.data)?void 0:r.meta)?void 0:c.current_page)??1,last_page:(null==(f=null==(m=d.data)?void 0:m.meta)?void 0:f.last_page)??1},l.value}catch(g){throw u.value=g.message||"Error al cargar el personal",g}finally{d.value=!1}};return{businessId:e,businessData:n,menus:i,tables:s,staffRequests:o,archivedRequests:r,staff:l,statistics:c,isLoading:d,error:u,staffLinks:h,staffMeta:p,hasMenus:m,hasTables:f,pendingRequests:g,fetchBusinessData:async()=>{d.value=!0,u.value=null;try{return n.value={id:"rest-1",name:"Mi Restaurante",address:"Calle Principal 123",phone:"+34 678 123 456",email:"contacto@mirestaurante.com",logo:"/src/assets/mozo-logo.svg",description:"El mejor restaurante de la ciudad",openingHours:{monday:{open:"12:00",close:"23:00"},tuesday:{open:"12:00",close:"23:00"},wednesday:{open:"12:00",close:"23:00"},thursday:{open:"12:00",close:"23:00"},friday:{open:"12:00",close:"00:00"},saturday:{open:"12:00",close:"00:00"},sunday:{open:"12:00",close:"23:00"}},tables:20,capacity:80,averageRating:4.5},e.value||(e.value=n.value.id,localStorage.setItem("businessId",n.value.id)),n.value}catch(t){throw u.value=t.message||"Error al cargar datos del negocio",t}finally{d.value=!1}},fetchMenus:v,setDefaultMenu:async e=>{d.value=!0,u.value=null;try{return await Ia.setDefaultMenu({menu_id:e}),await v(),!0}catch(t){throw u.value=t.message||"Error al establecer menú predeterminado",t}finally{d.value=!1}},uploadMenu:async e=>{d.value=!0,u.value=null;try{const t=await Ia.uploadMenu(e);return await v(),t.data}catch(t){throw u.value=t.message||"Error al subir menú",t}finally{d.value=!1}},fetchTables:b,createTable:async e=>{d.value=!0,u.value=null;try{await Ia.createTable(e);return await b(),!0}catch(t){return u.value=t.message||"Error al crear mesa",!1}finally{d.value=!1}},updateTable:async(e,t)=>{d.value=!0,u.value=null;try{const a=await Ia.updateTable(e,t),n=s.value.findIndex(t=>t.id===e);return-1!==n&&(s.value[n]=a.data),a.data}catch(a){throw u.value=a.message||"Error al actualizar mesa",a}finally{d.value=!1}},deleteTable:async e=>{d.value=!0,u.value=null;try{return await Ia.deleteTable(e),s.value=s.value.filter(t=>t.id!==e),!0}catch(t){throw u.value=t.message||"Error al eliminar mesa",t}finally{d.value=!1}},fetchStaffRequests:w,fetchArchivedRequests:y,handleStaffRequest:async(e,t)=>{d.value=!0,u.value=null;try{return await Ia.handleStaffRequest(e,{action:t}),await w(),await y(),"confirm"===t&&await _(),!0}catch(a){throw u.value=a.message||"Error al procesar solicitud",a}finally{d.value=!1}},fetchStaff:_,inviteStaff:async e=>{d.value=!0,u.value=null;try{const t=await Ia.inviteStaff(e);return await w(),t.data}catch(t){throw u.value=t.message||"Error al enviar invitación",t}finally{d.value=!1}},fetchDashboardStats:async()=>{var e;d.value=!0,u.value=null;try{const t=await Ia.getAdminStatistics();return(null==(e=t.data)?void 0:e.statistics)??t.data}catch(t){throw u.value=t.message||"Error al cargar estadísticas",t}finally{d.value=!1}},fetchStaffMember:async e=>{var t;d.value=!0,u.value=null;try{const a=await Ia.getStaffMember(e);return(null==(t=a.data)?void 0:t.staff)??a.data}catch(a){throw u.value=a.message||"Error al cargar datos del miembro del personal",a}finally{d.value=!1}},updateStaffMember:async(e,t)=>{d.value=!0,u.value=null;try{const a=await Ia.updateStaffMember(e,t),n=l.value.findIndex(t=>t.id===e);return-1!==n&&(l.value[n]={...l.value[n],...a.data}),a.data}catch(a){throw u.value=a.message||"Error al actualizar miembro del personal",a}finally{d.value=!1}},removeStaff:async e=>{d.value=!0,u.value=null;try{return await Ia.removeStaff(e),l.value=l.value.filter(t=>t.id!==e),!0}catch(t){throw u.value=t.message||"Error al eliminar miembro del personal",t}finally{d.value=!1}},addReview:async(e,t)=>{d.value=!0,u.value=null;try{return(await Ia.addReview(e,t)).data}catch(a){throw u.value=a.message||"Error al añadir reseña",a}finally{d.value=!1}},deleteReview:async(e,t)=>{d.value=!0,u.value=null;try{return await Ia.deleteReview(e,t),!0}catch(a){throw u.value=a.message||"Error al eliminar reseña",a}finally{d.value=!1}},renameMenu:async(e,t)=>{d.value=!0,u.value=null;try{return await Ia.renameMenu(e,{name:t}),await v(),!0}catch(a){return u.value=a.message||"Error al renombrar menú",!1}finally{d.value=!1}},deleteMenu:async e=>{d.value=!0,u.value=null;try{return await Ia.deleteMenu(e),await v(),!0}catch(t){throw u.value=t.message||"Error al eliminar menú",t}finally{d.value=!1}},reorderMenus:async e=>{try{await Ia.reorderMenus(e),i.value.sort((t,a)=>e.indexOf(t.id)-e.indexOf(a.id))}catch(t){console.error("Error reordenando menús",t)}},previewMenu:async e=>{try{const t=await Ia.previewMenu(e);return URL.createObjectURL(t.data)}catch(t){return console.error("Error obteniendo preview",t),null}},cloneTable:async(e,t)=>{d.value=!0;try{const a=await Ia.cloneTable(e,t);s.value.push(a.data)}catch(a){console.error("Error clonando mesa",a)}finally{d.value=!1}},generateQrCode:async e=>{d.value=!0,u.value=null;try{await Ia.generateQRCode(e),await b()}catch(t){throw u.value=t.message||"Error al generar código QR",t}finally{d.value=!1}}}}),J_={class:"dashboard"},Z_={class:"container py-3"},X_={class:"role-section"},eC={class:"user-id"},tC={key:0,class:"text-center py-5"},aC={key:1,class:"alert alert-danger"},nC={key:2,class:"row g-3 card-grid"},iC={class:"col-6"},sC={class:"col-6"},oC={class:"col-6"},rC={class:"col-6"},lC={__name:"Home",setup(e){const a=g(),s=Q_();Ya();const c=t(!1),u=t(""),p=t({activeRequests:0,pendingRequests:0,totalOrders:0,totalSales:0,salesThisMonth:0});i(async()=>{c.value=!0,u.value="";try{await s.fetchBusinessData(),await s.fetchStaffRequests();const e=await s.fetchDashboardStats();p.value=e}catch(e){u.value=e.message||"Error al cargar datos del negocio"}finally{c.value=!1}});const m=e=>{a.push({name:e})};return(e,t)=>(r(),o("div",J_,[l("div",Z_,[l("div",X_,[t[5]||(t[5]=A('<div class="role-dropdown me-2"><button class="btn btn-outline-secondary dropdown-toggle" id="roleMenu" data-bs-toggle="dropdown"> Rol Admin </button><ul class="dropdown-menu" aria-labelledby="roleMenu"><li><a class="dropdown-item" href="#">Admin</a></li><li><a class="dropdown-item" href="#">Mozo</a></li></ul></div>',1)),l("span",eC,"ID:"+d(n(s).businessId),1)]),c.value?(r(),o("div",tC,t[6]||(t[6]=[l("div",{class:"spinner-border text-primary",role:"status"},[l("span",{class:"visually-hidden"},"Cargando...")],-1),l("p",{class:"mt-2"},"Cargando...",-1)]))):u.value?(r(),o("div",aC,[l("p",null,d(u.value),1),l("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=t=>e.$router.go(0))}," Reintentar ")])):(r(),o("div",nC,[l("div",iC,[l("a",{href:"#",onClick:t[1]||(t[1]=h(e=>m("admin-qr"),["prevent"])),class:"card dashboard-card text-center text-decoration-none"},t[7]||(t[7]=[l("div",{class:"card-body"},[l("i",{class:"bi bi-qr-code"})],-1),l("div",{class:"card-footer"},"QR",-1)]))]),l("div",sC,[l("a",{href:"#",onClick:t[2]||(t[2]=h(e=>m("admin-stats"),["prevent"])),class:"card dashboard-card text-center text-decoration-none"},t[8]||(t[8]=[l("div",{class:"card-body"},[l("i",{class:"bi bi-graph-up"})],-1),l("div",{class:"card-footer"},"ESTADÍSTICAS",-1)]))]),l("div",oC,[l("a",{href:"#",onClick:t[3]||(t[3]=h(e=>m("admin-staff"),["prevent"])),class:"card dashboard-card text-center text-decoration-none"},t[9]||(t[9]=[l("div",{class:"card-body"},[l("i",{class:"bi bi-person-fill"})],-1),l("div",{class:"card-footer"},"PERSONAL",-1)]))]),l("div",rC,[l("a",{href:"#",onClick:t[4]||(t[4]=h(e=>m("admin-settings"),["prevent"])),class:"card dashboard-card text-center text-decoration-none"},t[10]||(t[10]=[l("div",{class:"card-body"},[l("i",{class:"bi bi-gear-fill"})],-1),l("div",{class:"card-footer"},"CONFIGURACIÓN",-1)]))])]))])]))}},cC={class:"modal-content rounded-4"},dC={class:"modal-header"},uC={class:"modal-title"},hC={class:"modal-body"},pC={key:0,class:"modal-footer"},mC=ar({__name:"BaseModal",props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:""},size:{type:String,default:"",validator:e=>["","sm","lg","xl"].includes(e)},centered:{type:Boolean,default:!0},scrollable:{type:Boolean,default:!1},staticBackdrop:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:n}){const s=e,h=n,p=t(null);let m=null;i(()=>{p.value&&(m=new q(p.value,{backdrop:!s.staticBackdrop||"static",keyboard:!s.staticBackdrop}),p.value.addEventListener("hidden.bs.modal",()=>{h("update:modelValue",!1)}),s.modelValue&&m.show())}),P(()=>{m&&m.dispose()}),N(()=>s.modelValue,e=>{!m&&p.value&&(m=new q(p.value,{backdrop:!s.staticBackdrop||"static",keyboard:!s.staticBackdrop})),e&&m?m.show():!e&&m&&m.hide()});const f=a(()=>{const e=["modal-dialog"];return s.centered&&e.push("modal-dialog-centered"),s.scrollable&&e.push("modal-dialog-scrollable"),s.size&&e.push(`modal-${s.size}`),e.join(" ")});return(t,a)=>(r(),o("div",{ref_key:"modalElement",ref:p,class:"modal fade",tabindex:"-1","aria-hidden":"true"},[l("div",{class:u(f.value)},[l("div",cC,[l("div",dC,[l("h5",uC,d(e.title),1),l("button",{type:"button",class:"btn-close",onClick:a[0]||(a[0]=e=>h("update:modelValue",!1)),"aria-label":"Close"})]),l("div",hC,[R(t.$slots,"default",{},void 0)]),t.$slots.footer?(r(),o("div",pC,[R(t.$slots,"footer",{},void 0)])):c("",!0)])],2)],512))}},[["__scopeId","data-v-aefedeba"]]),fC={class:"mb-3"},gC={class:"form-label"},vC=["type","placeholder"],bC=["disabled"],wC={__name:"InputModal",props:{modelValue:Boolean,title:{type:String,default:"Ingresar dato"},label:{type:String,default:""},placeholder:{type:String,default:""},defaultValue:{type:[String,Number],default:""},inputType:{type:String,default:"text"}},emits:["update:modelValue","confirm"],setup(e,{emit:a}){const n=e,i=a,s=t(n.defaultValue);N(()=>n.modelValue,e=>{e&&(s.value=n.defaultValue)});const o=()=>{const e="number"===n.inputType?s.value:s.value.trim();i("confirm",e),i("update:modelValue",!1)};return(t,a)=>(r(),w(mC,{"model-value":e.modelValue,"onUpdate:modelValue":a[2]||(a[2]=e=>t.$emit("update:modelValue",e)),title:e.title,size:"sm"},{footer:y(()=>[l("button",{class:"btn btn-secondary",onClick:a[1]||(a[1]=e=>t.$emit("update:modelValue",!1))},"Cancelar"),l("button",{class:"btn btn-primary",disabled:!s.value.toString().trim(),onClick:o},"Aceptar",8,bC)]),default:y(()=>[l("div",fC,[l("label",gC,d(e.label),1),E(l("input",{type:e.inputType,class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),placeholder:e.placeholder},null,8,vC),[[D,s.value]])])]),_:1},8,["model-value","title"]))}},yC=ar({__name:"SkeletonLoader",props:{width:{type:String,default:"100%"},height:{type:String,default:"1rem"},borderRadius:{type:String,default:"4px"}},setup:e=>(t,a)=>(r(),o("div",{class:"skeleton",style:M({width:e.width,height:e.height,borderRadius:e.borderRadius})},null,4))},[["__scopeId","data-v-7bfd6ab9"]]),_C={class:"menu-card-skeleton"},CC={class:"skeleton-info"},kC=ar({__name:"MenuCardSkeleton",setup:e=>(e,t)=>(r(),o("div",_C,[f(yC,{height:"150px",borderRadius:"12px 12px 0 0"}),l("div",CC,[f(yC,{width:"70%",height:"1.25rem",borderRadius:"4px"}),f(yC,{width:"40%",height:"1rem",borderRadius:"4px",style:{"margin-top":"8px"}})])]))},[["__scopeId","data-v-01f8ef4d"]]),EC={class:"table-item-skeleton"},SC=ar({__name:"TableListItemSkeleton",setup:e=>(e,t)=>(r(),o("div",EC,[f(yC,{width:"80%",height:"24px",borderRadius:"6px"})]))},[["__scopeId","data-v-41c50015"]]),TC={class:"qr-container"},IC={class:"tabs-container"},NC={class:"tabs-header d-flex justify-content-center align-items-center"},xC={key:0,class:"loading-container"},AC={key:1,class:"alert alert-danger"},PC={class:"qr-content"},RC={key:0,class:"qr-layout"},DC={class:"tables-panel"},MC={class:"select-all-container"},LC=["checked"],OC={key:0,class:"tables-list"},FC={key:1,class:"tables-list"},UC=["onClick"],BC=["checked","onChange"],qC={class:"qr-panel"},jC={key:0,class:"qr-display-multiple"},$C={class:"share-buttons"},zC={key:1,class:"qr-display"},VC={class:"qr-table-name"},WC={key:0,class:"qr-code-item"},HC={key:0,class:"qr-image-loader"},GC=["src"],YC={key:2,class:"qr-image-error"},KC={class:"share-buttons"},QC={key:1,class:"no-qr-codes"},JC={key:2,class:"qr-placeholder"},ZC={key:1,class:"menu-layout"},XC={key:0,class:"menu-grid"},ek={key:1,class:"menu-grid"},tk=["onClick"],ak={class:"card-content"},nk={class:"menu-info"},ik={class:"menu-name"},sk={key:0,class:"menu-badge"},ok=["onClick"],rk=["onClick"],lk=["onClick"],ck=["onClick"],dk=["onClick"],uk={key:0,class:"processing-overlay"},hk={class:"download-modal-content"},pk={class:"form-group"},mk={class:"email-modal-content"},fk={class:"form-group"},gk={class:"form-group"},vk={class:"form-group"},bk={class:"form-group"},wk=ar({__name:"QR",setup(e){g();const n=Q_(),s=a(()=>n.isLoading),b=a(()=>n.error),w=a(()=>n.tables),_=a(()=>n.menus),C=t(null);t("");const k=t(localStorage.getItem("adminQRTab")||"tables"),T=t(!1),I=t(""),A=t(null),P=t(null),R=t([]),D=t(!1),M=t("pdf");let L=[];const O=t(""),F=t(!1),U=t(!1),B=t("pdf"),q=t(""),j=t("Mesas QR"),$=t("Te comparto los códigos.");let z=[];const V=e=>R.value.some(t=>t.id===e.id),W=e=>{e.target.checked?R.value=[...w.value]:R.value=[]},H=e=>{k.value=e,localStorage.setItem("adminQRTab",e)},G=()=>{I.value="",T.value=!0},Y=async e=>{const t=parseInt(e,10);if(isNaN(t)||t<=0)Zo("Por favor, ingresa un número de mesa válido y mayor a cero.");else try{await n.createTable({number:t}),Jo("Mesa creada correctamente")}catch(a){Zo(a.message||"Error al crear la mesa")}},K=async()=>{if(C.value)try{await n.generateQrCode(C.value.id),Jo("Se ha procesado el QR para la mesa.")}catch(e){Zo(e.message||"Error al generar código QR")}},Q=async()=>{const{value:e}=await Ko.fire({title:"Selecciona un PDF",input:"file",inputAttributes:{accept:"application/pdf"},confirmButtonText:"Subir",showCancelButton:!0,cancelButtonText:"Cancelar"});if(!e)return;if(e.size>10485760)return void Zo("El archivo supera los 10 MB");const{value:t}=await Ko.fire({title:"Nombre del menú",input:"text",inputValue:e.name.replace(/\.pdf$/i,""),showCancelButton:!0,confirmButtonText:"Guardar"});if(!t)return;const a=new FormData;a.append("file",e),a.append("name",t),await n.uploadMenu(a),Jo("Menú subido")},J=e=>{L=e,D.value=!0},Z=async()=>{D.value=!1;const e=L.filter(e=>e.qr_code&&e.qr_code.id).map(e=>e.qr_code.id);if(0===e.length)return void Zo("Ninguna de las mesas seleccionadas tiene un QR para exportar.");const t=M.value;try{const a=await Ta.post("/admin/qr/export",{qr_ids:e,format:t},{responseType:"blob"}),n=window.URL.createObjectURL(a.data),i=document.createElement("a");i.href=n;const s=a.headers["content-disposition"];let o;if(s){const e=s.match(/filename="(.+)"/);e&&2===e.length&&(o=e[1])}if(!o){const a=t;if(1===e.length){o=`QR_Mesa_${L.find(t=>t.qr_code&&t.qr_code.id===e[0]).number}.${a}`}else o=`QRs_Export.${a}`}i.download=o,document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(n)}catch(a){Zo("Error al exportar los códigos QR.")}},X=e=>{z=e,U.value=!0},ee=async()=>{U.value=!1;const e=q.value.split(",").map(e=>e.trim()).filter(e=>e);if(0===e.length)return void Zo("Ingresa al menos un destinatario.");const t=z.filter(e=>e.qr_code&&e.qr_code.id).map(e=>e.qr_code.id);if(0===t.length)return void Zo("Ninguna de las mesas seleccionadas tiene un QR para enviar.");const a={qr_ids:t,format:B.value,recipients:e,subject:j.value,body:$.value};try{await Ta.post("/admin/qr/email",a),Jo("Correo enviado correctamente.")}catch(n){Zo(n.message||"Error al enviar el correo.")}};return i(()=>{n.fetchTables(),n.fetchMenus()}),N(C,async e=>{if(O.value&&(URL.revokeObjectURL(O.value),O.value=""),e&&e.qr_code){F.value=!0;try{const t=await Ta.get(`/admin/qr/preview/${e.id}`,{responseType:"blob"});O.value=URL.createObjectURL(t.data)}catch(t){console.error("Error fetching QR code image:",t),Zo("No se pudo cargar la imagen del QR.")}finally{F.value=!1}}}),(e,t)=>(r(),o("div",TC,[l("div",IC,[l("div",NC,[l("button",{class:u(["tab-button",{active:"tables"===k.value}]),onClick:t[0]||(t[0]=e=>H("tables"))}," MESAS ",2),l("button",{class:u(["tab-button",{active:"menus"===k.value}]),onClick:t[1]||(t[1]=e=>H("menus"))}," MENÚ ",2)])]),s.value&&!w.value.length?(r(),o("div",xC,t[19]||(t[19]=[l("div",{class:"loading-spinner"},null,-1),l("p",null,"Cargando datos...",-1)]))):c("",!0),b.value&&!s.value?(r(),o("div",AC,d(b.value),1)):c("",!0),l("div",PC,["tables"===k.value?(r(),o("div",RC,[l("div",DC,[t[21]||(t[21]=l("h2",{class:"panel-title"},"Selecciona una mesa",-1)),l("div",MC,[l("input",{type:"checkbox",onChange:W,checked:w.value.length>0&&R.value.length===w.value.length,class:"form-check-input"},null,40,LC),t[20]||(t[20]=l("label",null,"Seleccionar todo",-1))]),s.value?(r(),o("div",OC,[(r(),o(p,null,m(8,e=>f(SC,{key:e})),64))])):(r(),o("div",FC,[(r(!0),o(p,null,m(w.value,e=>(r(),o("div",{key:e.id,class:u(["table-item",{active:C.value&&C.value.id===e.id}]),onClick:t=>(e=>{C.value=e})(e)},[l("input",{type:"checkbox",checked:V(e),onChange:t=>(e=>{const t=R.value.findIndex(t=>t.id===e.id);-1===t?R.value.push(e):R.value.splice(t,1)})(e),onClick:t[2]||(t[2]=h(()=>{},["stop"])),class:"form-check-input"},null,40,BC),l("span",null,d((e.name||`MESA ${e.number}`).toUpperCase()),1)],10,UC))),128))])),l("button",{class:"add-table-btn",onClick:G},"MESA ＋")]),l("div",qC,[R.value.length>0?(r(),o("div",jC,[l("h3",null,d(R.value.length)+" mesa(s) seleccionada(s)",1),t[24]||(t[24]=l("p",null,"Selecciona una acción para aplicar a todas las mesas seleccionadas.",-1)),l("div",$C,[l("button",{onClick:t[3]||(t[3]=e=>J(R.value)),class:"share-btn download"},t[22]||(t[22]=[l("i",{class:"bi bi-download"},null,-1),v(" Descargar QRs ")])),l("button",{onClick:t[4]||(t[4]=e=>X(R.value)),class:"share-btn email"},t[23]||(t[23]=[l("i",{class:"bi bi-envelope-fill"},null,-1),v(" Enviar por correo ")]))])])):C.value?(r(),o("div",zC,[l("h3",VC,"Mesa "+d(C.value.number),1),C.value.qr_code?(r(),o("div",WC,[F.value?(r(),o("div",HC,t[25]||(t[25]=[l("div",{class:"loading-spinner-small"},null,-1)]))):O.value?(r(),o("img",{key:1,src:O.value,alt:"Código QR",class:"qr-image"},null,8,GC)):(r(),o("div",YC,t[26]||(t[26]=[l("i",{class:"bi bi-exclamation-triangle-fill"},null,-1),l("span",null,"Error al cargar QR",-1)]))),l("div",KC,[l("button",{onClick:t[5]||(t[5]=e=>J([C.value])),class:"share-btn download"},t[27]||(t[27]=[l("i",{class:"bi bi-download"},null,-1),v(" Descargar ")])),l("button",{onClick:t[6]||(t[6]=e=>(async e=>{if(e&&e.qr_code)try{const t=await Ta.post("/admin/qr/export",{qr_ids:[e.qr_code.id],format:"png"},{responseType:"blob"}),a=new File([t.data],`QR_Mesa_${e.number}.png`,{type:"image/png"});if(navigator.canShare&&navigator.canShare({files:[a]}))await navigator.share({files:[a],title:`Código QR para Mesa ${e.number}`,text:`Aquí está el código QR para la mesa ${e.number}.`});else{const e=window.URL.createObjectURL(a),t=document.createElement("a");t.href=e,t.download=a.name,document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(e),Jo("Archivo descargado (el navegador no admite compartir).")}}catch(t){"AbortError"!==t.name&&Zo("Error al intentar compartir el código QR.")}else Zo("La mesa no tiene un QR para compartir.")})(C.value)),class:"share-btn share"},t[28]||(t[28]=[l("i",{class:"bi bi-share-fill"},null,-1),v(" Compartir ")])),l("button",{onClick:t[7]||(t[7]=e=>X([C.value])),class:"share-btn email"},t[29]||(t[29]=[l("i",{class:"bi bi-envelope-fill"},null,-1),v(" Enviar ")]))]),l("button",{class:"btn btn-secondary mt-3",onClick:K},"Regenerar QR")])):(r(),o("div",QC,[t[30]||(t[30]=l("p",null,"Esta mesa aún no tiene un código QR.",-1)),l("button",{class:"btn btn-primary mt-3",onClick:K},"Generar QR")]))])):(r(),o("div",JC,t[31]||(t[31]=[l("p",null,"Selecciona una mesa para ver su código QR",-1)])))])])):(r(),o("div",ZC,[t[39]||(t[39]=l("div",{class:"row mb-3"},[l("div",{class:"col-12 d-flex flex-column align-items-start justify-content-start"},[l("h2",null,"Menús"),l("p",{class:"text-left"},"Administra tus menús para que tus clientes puedan escanearlos y verlos en su mesa.")])],-1)),s.value?(r(),o("div",XC,[(r(),o(p,null,m(6,e=>f(kC,{key:e})),64))])):(r(),o("div",ek,[(r(!0),o(p,null,m(_.value,e=>(r(),o("div",{key:e.id,class:u(["menu-card",{default:e.isDefault,processing:P.value===e.id}]),onClick:t=>{return a=e.id,void(A.value=A.value===a?null:a);var a}},[l("div",ak,[t[32]||(t[32]=l("div",{class:"menu-cover"},null,-1)),l("div",nk,[l("span",ik,d(e.name),1),e.isDefault?(r(),o("span",sk,"PREDETERMINADO")):c("",!0)])]),l("div",{class:u(["menu-actions",{show:A.value===e.id}]),onClick:t[8]||(t[8]=h(()=>{},["stop"]))},[e.isPredefined?c("",!0):(r(),o("button",{key:0,onClick:t=>(async e=>{P.value=e.id;try{await n.setDefaultMenu(e.id),Jo("Menú predeterminado actualizado"),A.value=null}catch(t){Zo(t.message||"Error al establecer menú predeterminado")}finally{P.value=null}})(e),class:"action-item"},t[33]||(t[33]=[l("span",{class:"action-icon select"},[l("i",{class:"bi bi-check-lg"})],-1),l("span",{class:"action-label"},"Seleccionar",-1)]),8,ok)),l("button",{onClick:t=>(async e=>{const t=await n.previewMenu(e.id);t&&window.open(t,"_blank")})(e),class:"action-item"},t[34]||(t[34]=[l("span",{class:"action-icon view"},[l("i",{class:"bi bi-eye-fill"})],-1),l("span",{class:"action-label"},"Ver",-1)]),8,rk),l("button",{onClick:t=>(async e=>{const{value:t}=await Ko.fire({title:"Nuevo nombre",input:"text",inputValue:e.name,showCancelButton:!0});if(t&&t!==e.name){P.value=e.id;try{await n.renameMenu(e.id,t),Jo("Nombre cambiado"),A.value=null}catch(a){Zo(a.message||"Error al renombrar menú")}finally{P.value=null}}})(e),class:"action-item"},t[35]||(t[35]=[l("span",{class:"action-icon rename"},[l("i",{class:"bi bi-pencil-fill"})],-1),l("span",{class:"action-label"},"Renombrar",-1)]),8,lk),l("button",{onClick:t=>(async e=>{P.value=e.id;try{const t=await Ta.get(`/menus/${e.id}/download`,{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=a;const i=t.headers["content-disposition"];let s=`${e.name}.pdf`;if(i){const e=i.match(/filename="(.+)"/);e&&2===e.length&&(s=e[1])}n.setAttribute("download",s),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(a),A.value=null}catch(t){Zo(t.message||"Error al descargar el archivo.")}finally{P.value=null}})(e),class:"action-item"},t[36]||(t[36]=[l("span",{class:"action-icon download"},[l("i",{class:"bi bi-download"})],-1),l("span",{class:"action-label"},"Descargar",-1)]),8,ck),e.isPredefined?c("",!0):(r(),o("button",{key:1,onClick:t=>(async e=>{if(e.isPredefined)return void Zo("No puedes eliminar el menú predeterminado.");if((await Ko.fire({title:`¿Eliminar "${e.name}"?`,text:"Esta acción es irreversible",icon:"warning",showCancelButton:!0})).isConfirmed){P.value=e.id;try{await n.deleteMenu(e.id),Jo("Menú eliminado"),A.value=null}catch(t){Zo(t.message||"Error al eliminar el menú")}finally{P.value=null}}})(e),class:"action-item"},t[37]||(t[37]=[l("span",{class:"action-icon delete"},[l("i",{class:"bi bi-trash-fill"})],-1),l("span",{class:"action-label"},"Eliminar",-1)]),8,dk))],2),P.value===e.id?(r(),o("div",uk,t[38]||(t[38]=[l("div",{class:"loading-spinner-small"},null,-1)]))):c("",!0)],10,tk))),128)),l("div",{class:"add-menu-card w-100",onClick:Q}," ＋ Agregar menú (PDF) ")]))]))]),f(wC,{modelValue:T.value,"onUpdate:modelValue":t[9]||(t[9]=e=>T.value=e),title:"Nueva mesa",label:"Número de la mesa",placeholder:"Ej: 5","input-type":"number",onConfirm:Y},null,8,["modelValue"]),f(mC,{modelValue:D.value,"onUpdate:modelValue":t[12]||(t[12]=e=>D.value=e),title:"Exportar Códigos QR"},{footer:y(()=>[l("button",{class:"btn btn-secondary",onClick:t[11]||(t[11]=e=>D.value=!1)},"Cancelar"),l("button",{class:"btn btn-primary",onClick:Z},"Descargar")]),default:y(()=>[l("div",hk,[t[42]||(t[42]=l("p",null,"Selecciona el formato en el que deseas descargar los códigos QR.",-1)),l("div",pk,[t[41]||(t[41]=l("label",{for:"format-select"},"Formato:",-1)),E(l("select",{id:"format-select","onUpdate:modelValue":t[10]||(t[10]=e=>M.value=e),class:"form-control"},t[40]||(t[40]=[l("option",{value:"pdf"},"PDF",-1),l("option",{value:"png"},"PNG",-1),l("option",{value:"svg"},"SVG",-1),l("option",{value:"zip"},"ZIP (PNGs comprimidos)",-1)]),512),[[x,M.value]])])])]),_:1},8,["modelValue"]),f(mC,{modelValue:U.value,"onUpdate:modelValue":t[18]||(t[18]=e=>U.value=e),title:"Enviar Códigos QR por Email"},{footer:y(()=>[l("button",{class:"btn btn-secondary",onClick:t[17]||(t[17]=e=>U.value=!1)},"Cancelar"),l("button",{class:"btn btn-primary",onClick:ee},"Enviar")]),default:y(()=>[l("div",mk,[l("div",fk,[t[43]||(t[43]=l("label",{for:"recipients-input"},"Destinatarios (separa correos con coma):",-1)),E(l("input",{id:"recipients-input","onUpdate:modelValue":t[13]||(t[13]=e=>q.value=e),type:"text",class:"form-control",placeholder:"ej: correo@dominio.com, otro@dominio.com"},null,512),[[S,q.value]])]),l("div",gk,[t[44]||(t[44]=l("label",{for:"subject-input"},"Asunto:",-1)),E(l("input",{id:"subject-input","onUpdate:modelValue":t[14]||(t[14]=e=>j.value=e),type:"text",class:"form-control"},null,512),[[S,j.value]])]),l("div",vk,[t[45]||(t[45]=l("label",{for:"body-input"},"Mensaje:",-1)),E(l("textarea",{id:"body-input","onUpdate:modelValue":t[15]||(t[15]=e=>$.value=e),class:"form-control",rows:"3"},null,512),[[S,$.value]])]),l("div",bk,[t[47]||(t[47]=l("label",{for:"email-format-select"},"Formato:",-1)),E(l("select",{id:"email-format-select","onUpdate:modelValue":t[16]||(t[16]=e=>B.value=e),class:"form-control"},t[46]||(t[46]=[l("option",{value:"pdf"},"PDF",-1),l("option",{value:"png"},"PNG",-1)]),512),[[x,B.value]])])])]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-f41c6eb0"]]),yk={class:"stats-container"};const _k=ar({},[["render",function(e,t){return r(),o("div",yk,t[0]||(t[0]=[l("div",{class:"coming-soon-container"},[l("i",{class:"bi bi-bar-chart-line-fill icon"}),l("h1",null,"Estadísticas"),l("p",null,"Esta sección estará disponible próximamente."),l("p",null,"Estamos trabajando para ofrecerte los mejores análisis para tu negocio.")],-1)]))}],["__scopeId","data-v-29de642f"]]),Ck=["type","disabled"],kk={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Ek={__name:"BaseButton",props:{variant:{type:String,default:"primary",validator:e=>["primary","secondary","outline-primary","outline-secondary","success","danger","warning","info","light","dark","link"].includes(e)},size:{type:String,default:"",validator:e=>["","sm","lg"].includes(e)},block:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},type:{type:String,default:"button"}},emits:["click"],setup(e,{emit:t}){const n=e,i=t,s=a(()=>{const e=["btn"];return e.push(`btn-${n.variant}`),n.size&&e.push(`btn-${n.size}`),n.block&&e.push("w-100"),n.loading&&e.push("position-relative"),e.join(" ")}),d=e=>{n.disabled||n.loading||i("click",e)};return(t,a)=>(r(),o("button",{type:e.type,class:u(s.value),disabled:e.disabled||e.loading,onClick:d},[e.loading?(r(),o("div",kk)):c("",!0),l("span",{class:u({"opacity-0":e.loading})},[R(t.$slots,"default",{},void 0)],2)],10,Ck))}},Sk=ar(Ek,[["__scopeId","data-v-9b101dda"]]),Tk={class:"request-card"},Ik={class:"requester-info"},Nk=["src","alt"],xk={class:"text-info"},Ak={class:"name"},Pk={class:"position"},Rk={class:"actions"},Dk={__name:"RequestCard",props:{request:{type:Object,required:!0},isArchived:{type:Boolean,default:!1}},emits:["confirm","archive","reject","unarchive"],setup:(e,{emit:t})=>(t,a)=>(r(),o("div",Tk,[e.isArchived?c("",!0):(r(),o("button",{key:0,class:"close-button",onClick:a[0]||(a[0]=h(a=>t.$emit("reject",e.request),["stop"]))},a[5]||(a[5]=[l("i",{class:"bi bi-x"},null,-1)]))),l("div",Ik,[l("img",{src:e.request.avatar,alt:`Avatar de ${e.request.name}`,class:"avatar"},null,8,Nk),l("div",xk,[l("h4",Ak,d(e.request.name),1),l("p",Pk,d(e.request.position),1)])]),l("div",Rk,[e.isArchived?(r(),o("button",{key:1,class:"btn btn-primary",onClick:a[4]||(a[4]=h(a=>t.$emit("unarchive",e.request),["stop"]))},a[9]||(a[9]=[l("i",{class:"bi bi-arrow-counterclockwise"},null,-1),v(" Desarchivar ")]))):(r(),o(p,{key:0},[l("button",{class:"btn btn-primary",onClick:a[1]||(a[1]=h(a=>t.$emit("confirm",e.request),["stop"]))},a[6]||(a[6]=[l("i",{class:"bi bi-check-lg"},null,-1),v(" Confirmar ")])),l("button",{class:"btn btn-secondary",onClick:a[2]||(a[2]=h(a=>t.$emit("archive",e.request),["stop"]))},a[7]||(a[7]=[l("i",{class:"bi bi-archive"},null,-1),v(" Archivar ")])),l("button",{class:"btn btn-danger",onClick:a[3]||(a[3]=h(a=>t.$emit("reject",e.request),["stop"]))},a[8]||(a[8]=[l("i",{class:"bi bi-x-lg"},null,-1),v(" Rechazar ")]))],64))])]))},Mk=ar(Dk,[["__scopeId","data-v-ecca35ff"]]),Lk={class:"staff-avatar"},Ok=["src","alt"],Fk={class:"employee-name"},Uk={class:"staff-info"},Bk={class:"rating-container"},qk={class:"stars"},jk={class:"comments-count"},$k={__name:"StaffCard",props:{employee:{type:Object,required:!0}},emits:["view","remove"],setup(e,{emit:t}){const a=e,n=t,i=()=>{n("view",a.employee)},s=e=>{e.stopPropagation(),n("remove",a.employee)};return(t,a)=>(r(),o("div",{class:"staff-card",onClick:i},[l("button",{class:"remove-button",onClick:s},a[0]||(a[0]=[l("i",{class:"bi bi-x"},null,-1)])),l("div",Lk,[l("img",{src:e.employee.avatar||"https://randomuser.me/api/portraits/men/32.jpg",alt:e.employee.name,class:"avatar-image"},null,8,Ok)]),l("h3",Fk,d(e.employee.name),1),l("div",Uk,[l("div",Bk,[l("div",qk,[(r(),o(p,null,m(5,t=>l("i",{key:t,class:u(["bi",t<=Math.round(e.employee.rating||0)?"bi-star-fill":"bi-star"])},null,2)),64))]),l("div",jk,[a[1]||(a[1]=l("i",{class:"bi bi-chat-left-text"},null,-1)),l("span",null,d(e.employee.reviewsCount||0)+" comentarios",1)])])])]))}},zk=ar($k,[["__scopeId","data-v-b19334dd"]]),Vk={class:"staff-card-skeleton"},Wk={class:"avatar-skeleton"},Hk={class:"info-skeleton"},Gk={__name:"StaffCardSkeleton",setup:e=>(e,t)=>(r(),o("div",Vk,[l("div",Wk,[f(yC,{width:"64px",height:"64px",borderRadius:"50%"})]),l("div",Hk,[f(yC,{width:"60%",height:"1.2rem",borderRadius:"4px"}),f(yC,{width:"40%",height:"1rem",borderRadius:"4px",style:{"margin-top":"8px"}})])]))},Yk=ar(Gk,[["__scopeId","data-v-77a45dbe"]]),Kk={class:"request-card-skeleton"},Qk={class:"info-skeleton"},Jk={class:"actions-skeleton"},Zk={__name:"RequestCardSkeleton",setup:e=>(e,t)=>(r(),o("div",Kk,[l("div",Qk,[f(yC,{width:"50%",height:"1.1rem",borderRadius:"4px"}),f(yC,{width:"30%",height:"0.9rem",borderRadius:"4px",style:{"margin-top":"8px"}})]),l("div",Jk,[f(yC,{width:"40px",height:"40px",borderRadius:"50%"}),f(yC,{width:"40px",height:"40px",borderRadius:"50%"})])]))},Xk=ar(Zk,[["__scopeId","data-v-8e0a7703"]]),eE={class:"staff-page"},tE={class:"page-header"},aE={key:0,class:"header-stats"},nE={class:"stat-item"},iE={class:"stat-value"},sE={class:"stat-item"},oE={class:"stat-value"},rE={key:0,class:"loading-container"},lE={key:1,class:"error-container"},cE={class:"error-message"},dE={key:2,class:"staff-content"},uE={class:"staff-section"},hE={class:"section-header"},pE={class:"section-title"},mE={key:0,class:"badge bg-primary rounded-pill"},fE={key:0,class:"section-actions"},gE={key:0,class:"requests-list"},vE={key:1},bE={key:0,class:"text-center p-4 text-muted"},wE={key:1,class:"requests-list"},yE={class:"staff-section"},_E={class:"section-header"},CE={key:0,class:"staff-grid"},kE={key:1,class:"staff-grid"},EE={key:0},SE={key:2,class:"pagination-container"},TE=["disabled"],IE=["disabled"],NE={class:"invite-form"},xE={class:"form-group"},AE={class:"form-group"},PE=["disabled"],RE={key:0},DE={key:1},ME=["disabled"],LE={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},OE={__name:"Staff",setup(e){const n=g(),s=Q_(),u=t(!1),h=t(""),b=a(()=>s.staff),_=a(()=>s.staffRequests),C=a(()=>s.archivedRequests),k=t(!1),T=t(!1);t(!1),t(!1);const I=t(null);t(null);const N=t(""),A=t(""),P=t("waiter"),R=t(!1),D=a(()=>s.staffLinks),M=a(()=>s.staffMeta),L=a(()=>{if(!b.value.length)return[];let e=[...b.value];if(N.value){const t=N.value.toLowerCase();e=e.filter(e=>{var a,n,i;return(null==(a=e.name)?void 0:a.toLowerCase().includes(t))||(null==(n=e.email)?void 0:n.toLowerCase().includes(t))||(null==(i=e.position)?void 0:i.toLowerCase().includes(t))})}return e}),O=a(()=>R.value?C.value:_.value),F=a(()=>{if(!b.value.length)return{total:0,avgRating:0};const e=b.value.length;return{total:e,avgRating:(b.value.reduce((e,t)=>e+(t.rating||0),0)/e).toFixed(1)}});i(async()=>{u.value=!0,h.value="";try{await Promise.all([s.fetchStaff(),s.fetchStaffRequests(),s.fetchArchivedRequests()])}catch(e){h.value=e.message||"Error al cargar datos de personal"}finally{u.value=!1}});const U=async()=>{if(A.value&&P.value){u.value=!0,h.value="";try{await s.inviteStaff({email:A.value,role:P.value}),A.value="",P.value="waiter",k.value=!1}catch(e){h.value=e.message||"Error al enviar invitación"}finally{u.value=!1}}else h.value="Por favor, completa todos los campos"},B=async e=>{u.value=!0,h.value="";try{await s.handleStaffRequest(e.id,"confirm")}catch(t){h.value=t.message||"Error al confirmar solicitud"}finally{u.value=!1}},q=async e=>{u.value=!0,h.value="";try{await s.handleStaffRequest(e.id,"archive")}catch(t){h.value=t.message||"Error al archivar solicitud"}finally{u.value=!1}},j=async e=>{u.value=!0,h.value="";try{await s.handleStaffRequest(e.id,"unarchive")}catch(t){h.value=t.message||"Error al desarchivar solicitud"}finally{u.value=!1}},$=async e=>{u.value=!0,h.value="";try{await s.handleStaffRequest(e.id,"reject")}catch(t){h.value=t.message||"Error al rechazar solicitud"}finally{u.value=!1}},z=async()=>{if(_.value.length){u.value=!0,h.value="";try{for(const e of _.value)await s.handleStaffRequest(e.id,"confirm")}catch(e){h.value=e.message||"Error al confirmar todas las solicitudes"}finally{u.value=!1}}},V=async()=>{if(_.value.length){u.value=!0,h.value="";try{for(const e of _.value)await s.handleStaffRequest(e.id,"archive")}catch(e){h.value=e.message||"Error al archivar todas las solicitudes"}finally{u.value=!1}}},W=e=>{I.value=e,T.value=!0},H=async()=>{if(I.value){u.value=!0,h.value="";try{await s.removeStaff(I.value.id),T.value=!1,I.value=null}catch(e){h.value=e.message||"Error al eliminar miembro del personal"}finally{u.value=!1}}},G=()=>{R.value=!R.value},Y=e=>{n.push("/admin/staff/"+e.id)},K=()=>{k.value=!0},Q=async()=>{D.value.next&&(u.value=!0,await s.fetchStaff(D.value.next),u.value=!1)},J=async()=>{D.value.prev&&(u.value=!0,await s.fetchStaff(D.value.prev),u.value=!1)};return(e,t)=>(r(),o("div",eE,[l("div",tE,[t[11]||(t[11]=l("h1",{class:"page-title"},"Gestión de Personal",-1)),!u.value&&b.value.length>0?(r(),o("div",aE,[l("div",nE,[l("span",iE,d(F.value.total),1),t[8]||(t[8]=l("span",{class:"stat-label"},"Total",-1))]),l("div",sE,[l("span",oE,d(F.value.avgRating),1),t[9]||(t[9]=l("span",{class:"stat-label"},"Rating promedio",-1))])])):c("",!0),f(Sk,{onClick:K,variant:"primary",icon:"fas fa-plus"},{default:y(()=>t[10]||(t[10]=[v(" Invitar Personal ")])),_:1,__:[10]})]),u.value?(r(),o("div",rE,t[12]||(t[12]=[l("div",{class:"spinner"},null,-1),l("p",null,"Cargando personal...",-1)]))):h.value?(r(),o("div",lE,[l("p",cE,d(h.value),1),f(Sk,{onClick:t[0]||(t[0]=t=>e.$router.go(0)),variant:"primary"},{default:y(()=>t[13]||(t[13]=[v(" Reintentar ")])),_:1,__:[13]})])):(r(),o("div",dE,[l("section",uE,[l("div",hE,[l("div",null,[l("h2",pE,[v(d(R.value?"Solicitudes Archivadas":"Solicitudes Pendientes")+" ",1),!R.value&&_.value.length?(r(),o("span",mE,d(_.value.length),1)):c("",!0)])]),R.value?c("",!0):(r(),o("div",fE,[f(Sk,{onClick:V,size:"sm",disabled:!_.value.length},{default:y(()=>t[14]||(t[14]=[v("Archivar Todo")])),_:1,__:[14]},8,["disabled"]),f(Sk,{onClick:z,size:"sm",variant:"success",disabled:!_.value.length},{default:y(()=>t[15]||(t[15]=[v("Confirmar Todo")])),_:1,__:[15]},8,["disabled"])]))]),u.value?(r(),o("div",gE,[(r(),o(p,null,m(3,e=>f(Xk,{key:e})),64))])):(r(),o("div",vE,[O.value.length?(r(),o("div",wE,[(r(!0),o(p,null,m(O.value,e=>(r(),w(Mk,{key:e.id,request:e,"is-archived":R.value,onConfirm:B,onArchive:q,onUnarchive:j,onReject:$},null,8,["request","is-archived"]))),128))])):(r(),o("div",bE,t[16]||(t[16]=[l("p",null,"No hay solicitudes para mostrar.",-1)])))])),f(Sk,{onClick:G,size:"sm",class:"mt-3"},{default:y(()=>[v(d(R.value?"Ver Pendientes":"Ver Archivadas"),1)]),_:1})]),l("section",yE,[l("div",_E,[t[17]||(t[17]=l("h2",{class:"section-title"},"Tu Personal",-1)),E(l("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>N.value=e),class:"search-input",placeholder:"Buscar personal..."},null,512),[[S,N.value]])]),u.value?(r(),o("div",CE,[(r(),o(p,null,m(4,e=>f(Yk,{key:e})),64))])):(r(),o("div",kE,[L.value.length?c("",!0):(r(),o("p",EE,"No se encontró personal.")),(r(!0),o(p,null,m(L.value,e=>(r(),w(zk,{key:e.id,employee:e,onRemove:W,onView:Y},null,8,["employee"]))),128))])),M.value.last_page>1?(r(),o("div",SE,[l("button",{class:"pagination-button",disabled:!D.value.prev,onClick:J},"Anterior",8,TE),l("span",null,d(M.value.current_page)+" / "+d(M.value.last_page),1),l("button",{class:"pagination-button",disabled:!D.value.next,onClick:Q},"Siguiente",8,IE)])):c("",!0)])])),f(mC,{modelValue:k.value,"onUpdate:modelValue":t[5]||(t[5]=e=>k.value=e),title:"Invitar Personal",size:"md"},{footer:y(()=>[l("button",{class:"btn btn-secondary",onClick:t[4]||(t[4]=e=>k.value=!1)}," Cancelar "),l("button",{class:"btn btn-primary",onClick:U,disabled:!A.value||u.value},[u.value?(r(),o("span",RE,"Enviando...")):(r(),o("span",DE,"Enviar invitación"))],8,PE)]),default:y(()=>[l("div",NE,[l("div",xE,[t[18]||(t[18]=l("label",{for:"invite-email"},"Correo electrónico",-1)),E(l("input",{id:"invite-email",type:"email","onUpdate:modelValue":t[2]||(t[2]=e=>A.value=e),placeholder:"Ingresa el correo electrónico",class:"form-control"},null,512),[[S,A.value]])]),l("div",AE,[t[20]||(t[20]=l("label",{for:"invite-role"},"Cargo",-1)),E(l("select",{id:"invite-role","onUpdate:modelValue":t[3]||(t[3]=e=>P.value=e),class:"form-control"},t[19]||(t[19]=[l("option",{value:"waiter"},"Mozo",-1),l("option",{value:"kitchen"},"Cocinero",-1),l("option",{value:"cashier"},"Cajero",-1),l("option",{value:"manager"},"Gerente",-1),l("option",{value:"cleaning"},"Limpieza",-1)]),512),[[x,P.value]])])])]),_:1},8,["modelValue"]),f(mC,{modelValue:T.value,"onUpdate:modelValue":t[7]||(t[7]=e=>T.value=e),title:"Desvincular empleado",size:"sm"},{footer:y(()=>[l("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=e=>T.value=!1)}," Cancelar "),l("button",{class:"btn btn-danger",onClick:H,disabled:u.value},[u.value?(r(),o("span",LE)):c("",!0),t[21]||(t[21]=v(" Desvincular "))],8,ME)]),default:y(()=>{var e;return[l("p",null,"¿Estás seguro de que deseas desvincular a "+d(null==(e=I.value)?void 0:e.name)+"?",1),t[22]||(t[22]=l("p",{class:"warning-text"},"Esta acción no se puede deshacer.",-1))]}),_:1,__:[22]},8,["modelValue"])]))}},FE=ar(OE,[["__scopeId","data-v-490bad46"]]),UE=["src","alt"],BE={key:0,class:"avatar-overlay"},qE={key:1,class:"avatar-loading"},jE={__name:"ProfileAvatar",props:{src:{type:String,default:""},alt:{type:String,default:"Foto de perfil"},editable:{type:Boolean,default:!1}},emits:["update:src","file-selected"],setup(e,{emit:a}){const n=e,i=a,s=t(n.src),d=t(!1),h=t(null);N(()=>n.src,e=>{s.value=e});const p=()=>{n.editable&&h.value&&h.value.click()},m=e=>{const t=e.target.files[0];if(!t)return;d.value=!0;const a=new FileReader;a.onload=e=>{s.value=e.target.result,i("update:src",s.value),i("file-selected",t),d.value=!1},a.readAsDataURL(t)};return(t,a)=>(r(),o("div",{class:u(["profile-avatar",{editable:e.editable}]),onClick:p},[l("img",{src:s.value,alt:e.alt,class:"avatar-image"},null,8,UE),e.editable?(r(),o("div",BE,a[0]||(a[0]=[l("i",{class:"bi bi-camera"},null,-1)]))):c("",!0),d.value?(r(),o("div",qE,a[1]||(a[1]=[l("div",{class:"spinner"},null,-1)]))):c("",!0),e.editable?(r(),o("input",{key:2,ref_key:"fileInput",ref:h,type:"file",accept:"image/*",class:"file-input",onChange:m},null,544)):c("",!0)],2))}},$E=ar(jE,[["__scopeId","data-v-b3232b9c"]]),zE={class:"review-card"},VE={class:"review-header"},WE={class:"reviewer-info"},HE=["src","alt"],GE={class:"reviewer-name"},YE={class:"review-rating"},KE={class:"stars-container"},QE={class:"rating-value"},JE={class:"review-text"},ZE={class:"review-footer"},XE={key:0,class:"review-date"},eS={__name:"ReviewCard",props:{review:{type:Object,required:!0},canDelete:{type:Boolean,default:!1}},emits:["delete"],setup(e,{emit:a}){const n=e,i=a,s=t(!1),h=()=>{s.value=!0},f=()=>{i("delete",n.review.id),s.value=!1},g=e=>{if(!e)return"";return new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})};return(t,a)=>{var n,i,v;return r(),o("div",zE,[l("div",VE,[l("div",WE,[l("img",{src:null==(n=e.review.reviewer)?void 0:n.avatar,alt:null==(i=e.review.reviewer)?void 0:i.name,class:"reviewer-avatar"},null,8,HE),l("h3",GE,d(null==(v=e.review.reviewer)?void 0:v.name),1)]),l("div",YE,[l("div",KE,[(r(),o(p,null,m(5,t=>l("i",{key:t,class:u(["bi",t<=e.review.rating?"bi-star-fill":"bi-star"])},null,2)),64))]),l("span",QE,d(e.review.rating),1)]),e.canDelete?(r(),o("button",{key:0,class:"delete-button",onClick:h,"aria-label":"Eliminar reseña"},a[2]||(a[2]=[l("i",{class:"bi bi-trash"},null,-1)]))):c("",!0)]),l("p",JE,d(e.review.comment),1),l("div",ZE,[e.review.date?(r(),o("span",XE,d(g(e.review.date)),1)):c("",!0)]),s.value?(r(),w(mC,{key:0,modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value=e),title:"Eliminar reseña",size:"sm"},{footer:y(()=>[l("button",{class:"btn btn-secondary",onClick:a[0]||(a[0]=e=>s.value=!1)}," Cancelar "),l("button",{class:"btn btn-danger",onClick:f}," Eliminar ")]),default:y(()=>[a[3]||(a[3]=l("p",null,"¿Estás seguro de que deseas eliminar esta reseña?",-1)),a[4]||(a[4]=l("p",{class:"warning-text"},"Esta acción no se puede deshacer.",-1))]),_:1,__:[3,4]},8,["modelValue"])):c("",!0)])}}},tS=ar(eS,[["__scopeId","data-v-99cedcd8"]]),aS={class:"base-input-wrapper"},nS={key:0,class:"base-input-label"},iS={key:0,class:"required-indicator"},sS=["type","value","placeholder","disabled","required","autocomplete","name"],oS={key:1,class:"base-input-error-message"},rS={__name:"BaseInput",props:{modelValue:{type:[String,Number],default:""},label:{type:String,default:""},placeholder:{type:String,default:""},type:{type:String,default:"text"},error:{type:String,default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},autocomplete:{type:String,default:"off"},name:{type:String,default:""}},emits:["update:modelValue","focus","blur"],setup(e,{emit:n}){const i=e,s=n,h=t(i.modelValue),p=t(!1);N(()=>i.modelValue,e=>{h.value=e});const m=e=>{const t=e.target.value;h.value=t,s("update:modelValue",t)},f=e=>{p.value=!0,s("focus",e)},g=e=>{p.value=!1,s("blur",e)},b=a(()=>["base-input",{"base-input-disabled":i.disabled},{"base-input-error":i.error},{"base-input-focused":p.value}]);return(t,a)=>(r(),o("div",aS,[e.label?(r(),o("label",nS,[v(d(e.label)+" ",1),e.required?(r(),o("span",iS,"*")):c("",!0)])):c("",!0),l("input",{type:e.type,value:h.value,placeholder:e.placeholder,disabled:e.disabled,required:e.required,autocomplete:e.autocomplete,name:e.name,class:u(b.value),onInput:m,onFocus:f,onBlur:g},null,42,sS),e.error?(r(),o("p",oS,d(e.error),1)):c("",!0)]))}},lS=ar(rS,[["__scopeId","data-v-da9b847d"]]),cS={class:"form-group"},dS={class:"form-group"},uS={__name:"SendNotificationModal",props:{modelValue:Boolean,loading:Boolean},emits:["update:modelValue","submit"],setup(e,{emit:n}){const i=n,s=t({title:"",body:""}),o=a(()=>""!==s.value.title.trim()&&""!==s.value.body.trim()),c=()=>{o.value&&i("submit",{...s.value})};return(t,a)=>(r(),w(mC,{"model-value":e.modelValue,title:"Enviar Notificación","onUpdate:modelValue":a[3]||(a[3]=e=>t.$emit("update:modelValue",e))},{body:y(()=>[l("form",{onSubmit:h(c,["prevent"]),class:"send-notification-form"},[l("div",cS,[a[4]||(a[4]=l("label",{for:"title"},"Título",-1)),f(lS,{id:"title",modelValue:s.value.title,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value.title=e),placeholder:"Ej: Recordatorio de reunión",required:""},null,8,["modelValue"])]),l("div",dS,[a[5]||(a[5]=l("label",{for:"body"},"Mensaje",-1)),E(l("textarea",{id:"body","onUpdate:modelValue":a[1]||(a[1]=e=>s.value.body=e),rows:"4",placeholder:"Escribe aquí el mensaje de la notificación...",required:"",class:"textarea-input"},null,512),[[S,s.value.body]])])],32)]),footer:y(()=>[f(Sk,{onClick:a[2]||(a[2]=e=>t.$emit("update:modelValue",!1)),variant:"secondary"},{default:y(()=>a[6]||(a[6]=[v(" Cancelar ")])),_:1,__:[6]}),f(Sk,{onClick:c,loading:e.loading,disabled:!o.value},{default:y(()=>a[7]||(a[7]=[v(" Enviar ")])),_:1,__:[7]},8,["loading","disabled"])]),_:1},8,["model-value"]))}},hS=ar(uS,[["__scopeId","data-v-a3aa051f"]]),pS={class:"staff-detail-container"},mS={key:0,class:"loading-container"},fS={key:1,class:"error-container"},gS={key:2,class:"staff-detail-content"},vS={class:"profile-card"},bS={class:"profile-header"},wS={class:"profile-name-container"},yS={class:"profile-data"},_S={class:"data-row"},CS={key:0,class:"text-muted",style:{"font-size":"0.875rem"}},kS={class:"data-row"},ES={class:"data-row"},SS={class:"data-row"},TS={class:"data-row"},IS={class:"data-row"},NS={class:"data-row"},xS={class:"data-row"},AS={class:"data-row"},PS={class:"data-row"},RS={class:"data-row"},DS={class:"data-row"},MS={class:"data-row"},LS={class:"data-row"},OS={class:"data-row"},FS={class:"profile-actions"},US={class:"reviews-section d-none"},BS={class:"reviews-header"},qS={class:"average-rating"},jS={class:"stars-container"},$S={class:"rating-text"},zS={class:"add-review-buttons"},VS={key:0,class:"empty-reviews"},WS={key:1,class:"reviews-list"},HS={class:"confirm-content"},GS={class:"confirm-input"},YS=["disabled"],KS={class:"add-review-form"},QS={class:"rating-input"},JS={class:"star-rating"},ZS=["onClick"],XS={class:"comment-input"},eT=["disabled"],tT={key:0},aT={key:1},nT=ar({__name:"StaffDetail",setup(e){const s=b(),h=g(),_=Q_(),C=s.params.id,k=t(!1),T=t(""),I=t(null),N=t(!1),x=t(!1),A=t(""),P=t({rating:5,comment:""}),R=t(!1),D=t(!1),M=t(!1),L={experience:"experience_years",seniority:"seniority_years",schedule:"employment_type",currentSchedule:"current_schedule"};i(async()=>{k.value=!0,T.value="";try{const e=await _.fetchStaffMember(C);I.value=e}catch(e){T.value=e.message||"Error al cargar datos del empleado"}finally{k.value=!1}});const O=async()=>{if("ELIMINAR"===A.value){k.value=!0,T.value="";try{await _.removeStaff(C),h.push("/admin/staff")}catch(e){T.value=e.message||"Error al eliminar al miembro del personal"}finally{k.value=!1,N.value=!1}}},F=async(e,t)=>{if(!I.value)return;if("birth_date"===e){const e=new Date(t),a=new Date;let n=a.getFullYear()-e.getFullYear();const i=a.getMonth()-e.getMonth();if((i<0||0===i&&a.getDate()<e.getDate())&&n--,n<16)return void(T.value="El empleado debe ser mayor de 16 años")}R.value=!0;const a=L[e]||e;try{if(await _.updateStaffMember(C,{[a]:t}),I.value[a]=t,I.value[e]=t,"birth_date"===e){const e=new Date(t).toLocaleDateString("es-ES");I.value.birthdate_formatted=e}}catch(n){T.value=n.message||`Error al actualizar ${e}`}finally{R.value=!1}},U=async e=>{if(e)try{R.value=!0;const t=new FormData;t.append("avatar",e),await _.updateStaffMember(C,t,!0);const a=new FileReader;a.onload=e=>{I.value&&(I.value.avatar_url=e.target.result)},a.readAsDataURL(e)}catch(t){T.value=t.message||"Error al subir avatar"}finally{R.value=!1}},B=async e=>{if(I.value)try{R.value=!0,await _.deleteReview(C,e),I.value.reviews=I.value.reviews.filter(t=>t.id!==e)}catch(t){T.value=t.message||"Error al eliminar reseña"}finally{R.value=!1}},q=async()=>{if(I.value&&P.value.comment)try{R.value=!0;const e=await _.addReview(C,P.value);I.value.reviews.push(e),P.value={rating:5,comment:""},x.value=!1}catch(e){T.value=e.message||"Error al agregar reseña"}finally{R.value=!1}},j=()=>{if(I.value&&I.value.phone){const e=encodeURIComponent("Hola, te contacto desde la app MOZO.");window.open(`https://wa.me/${I.value.phone}?text=${e}`,"_blank")}else alert("Este empleado no tiene un número de teléfono registrado.")},$=()=>{h.push("/admin/staff")},z=[{value:"Masculino",label:"Masculino"},{value:"Femenino",label:"Femenino"},{value:"No binario",label:"No binario"},{value:"Prefiero no especificar",label:"Prefiero no especificar"}],V=[{value:"Gerente",label:"Gerente"},{value:"Mozo",label:"Mozo"},{value:"Cajero",label:"Cajero"},{value:"Cocinero",label:"Cocinero"},{value:"Limpieza",label:"Limpieza"}],W=[{value:"Tiempo completo",label:"Tiempo completo"},{value:"Medio tiempo",label:"Medio tiempo"},{value:"Por horas",label:"Por horas"},{value:"Fines de semana",label:"Fines de semana"}],H=()=>{x.value=!0},G=a(()=>{if(!I.value||!I.value.reviews.length)return 0;return(I.value.reviews.reduce((e,t)=>e+t.rating,0)/I.value.reviews.length).toFixed(1)}),Y=a(()=>I.value&&I.value.reviews.length?[...I.value.reviews].sort((e,t)=>new Date(t.date)-new Date(e.date)):[]),K=a(()=>{if(!I.value||!I.value.birth_date)return null;const e=new Date(I.value.birth_date),t=new Date;let a=t.getFullYear()-e.getFullYear();const n=t.getMonth()-e.getMonth();return(n<0||0===n&&t.getDate()<e.getDate())&&a--,a}),Q=async e=>{var t,a;M.value=!0;try{const t={user_id:I.value.user.id,title:e.title,body:e.body},a=await Ia.sendPushToUser(t);Jo(a.message||"Notificación enviada con éxito"),D.value=!1}catch(n){Zo((null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al enviar la notificación")}finally{M.value=!1}},J=()=>{N.value=!0};return(e,t)=>(r(),o("div",pS,[l("div",{class:"staff-header"},[l("button",{class:"back-button",onClick:$},t[26]||(t[26]=[l("i",{class:"bi bi-arrow-left"},null,-1),v(" Volver ")]))]),k.value?(r(),o("div",mS,t[27]||(t[27]=[l("div",{class:"loading-spinner"},null,-1),l("p",null,"Cargando datos del empleado...",-1)]))):T.value?(r(),o("div",fS,[l("p",null,d(T.value),1),f(Sk,{onClick:t[0]||(t[0]=t=>e.$router.go(0)),variant:"primary"},{default:y(()=>t[28]||(t[28]=[v(" Reintentar ")])),_:1,__:[28]})])):I.value?(r(),o("div",gS,[l("div",vS,[l("div",bS,[f($E,{src:I.value.avatar_url,alt:`Foto de ${I.value.name}`,editable:!0,onFileSelected:U},null,8,["src","alt"]),l("div",wS,[f(ky,{value:I.value.name,"onUpdate:value":t[1]||(t[1]=e=>F("name",e)),type:"text",placeholder:"Nombre completo",editable:!0,class:"profile-name"},null,8,["value"])])]),l("div",yS,[l("div",_S,[f(ky,{value:I.value.birth_date,"display-value":I.value.birthdate_formatted,label:"Fecha de nacimiento","onUpdate:value":t[2]||(t[2]=e=>F("birth_date",e)),type:"date",editable:!0},null,8,["value","display-value"]),K.value?(r(),o("div",CS,"Edad: "+d(K.value)+" años",1)):c("",!0)]),l("div",kS,[f(ky,{value:I.value.height,label:"Estatura","onUpdate:value":t[3]||(t[3]=e=>F("height",e)),type:"number",min:1,max:2.5,step:.01,unit:"mt",editable:!0},null,8,["value"])]),l("div",ES,[f(ky,{value:I.value.weight,label:"Peso","onUpdate:value":t[4]||(t[4]=e=>F("weight",e)),type:"number",min:30,max:200,unit:"kg",editable:!0},null,8,["value"])]),l("div",SS,[f(ky,{value:I.value.gender,label:"Sexo","onUpdate:value":t[5]||(t[5]=e=>F("gender",e)),type:"select",options:z,editable:!0},null,8,["value"])]),l("div",TS,[f(ky,{value:I.value.experience_years,label:"Años de experiencia","onUpdate:value":t[6]||(t[6]=e=>F("experience",e)),type:"number",min:0,max:50,unit:"años",editable:!0},null,8,["value"])]),l("div",IS,[f(ky,{value:I.value.seniority_years,label:"Antigüedad","onUpdate:value":t[7]||(t[7]=e=>F("seniority",e)),type:"number",min:0,max:50,unit:"años de antigüedad",editable:!0},null,8,["value"])]),l("div",NS,[f(ky,{value:I.value.email,label:"Email","onUpdate:value":t[8]||(t[8]=e=>F("email",e)),type:"text",editable:!0},null,8,["value"])]),l("div",xS,[f(ky,{value:I.value.phone,label:"Teléfono","onUpdate:value":t[9]||(t[9]=e=>F("phone",e)),type:"text",editable:!0},null,8,["value"])]),l("div",AS,[f(ky,{value:I.value.hire_date,label:"Fecha de contratación","onUpdate:value":t[10]||(t[10]=e=>F("hire_date",e)),type:"date",editable:!0},null,8,["value"])]),l("div",PS,[f(ky,{value:I.value.position,label:"Cargo","onUpdate:value":t[11]||(t[11]=e=>F("position",e)),type:"select",options:V,editable:!0},null,8,["value"])]),l("div",RS,[f(ky,{value:I.value.salary,label:"Salario","onUpdate:value":t[12]||(t[12]=e=>F("salary",e)),type:"number",min:0,step:.01,unit:"$",editable:!0},null,8,["value"])]),l("div",DS,[f(ky,{value:I.value.notes,label:"Notas","onUpdate:value":t[13]||(t[13]=e=>F("notes",e)),type:"textarea",editable:!0},null,8,["value"])]),l("div",MS,[f(ky,{value:I.value.education,label:"Condición","onUpdate:value":t[14]||(t[14]=e=>F("education",e)),type:"text",editable:!0},null,8,["value"])]),l("div",LS,[f(ky,{value:I.value.employment_type,label:"Modalidad","onUpdate:value":t[15]||(t[15]=e=>F("schedule",e)),type:"select",options:W,editable:!0},null,8,["value"])]),l("div",OS,[f(ky,{value:I.value.current_schedule,label:"Horario actual","onUpdate:value":t[16]||(t[16]=e=>F("currentSchedule",e)),type:"text",editable:!0},null,8,["value"])])]),l("div",FS,[f(Sk,{variant:"primary",onClick:t[17]||(t[17]=t=>e.$router.push(`/admin/staff/${n(C)}/history`)),class:"action-button d-none"},{default:y(()=>t[29]||(t[29]=[v(" Ver historial ")])),_:1,__:[29]}),f(Sk,{variant:"secondary",onClick:e.sendMessage,class:"action-button"},{default:y(()=>t[30]||(t[30]=[v(" Mandar mensaje ")])),_:1,__:[30]},8,["onClick"]),f(Sk,{variant:"info",onClick:t[18]||(t[18]=e=>D.value=!0),class:"action-button"},{default:y(()=>t[31]||(t[31]=[l("i",{class:"bi bi-paper-plane"},null,-1),v(" Enviar Notificación ")])),_:1,__:[31]}),f(Sk,{variant:"danger",onClick:J,class:"action-button"},{default:y(()=>t[32]||(t[32]=[l("i",{class:"bi bi-trash"},null,-1),v(" Eliminar Empleado ")])),_:1,__:[32]})])]),l("div",US,[l("div",BS,[t[35]||(t[35]=l("h2",{class:"section-title"},"Reseñas",-1)),l("div",qS,[l("div",jS,[(r(),o(p,null,m(5,e=>l("i",{key:e,class:u(["bi",e<=Math.round(I.value.rating)?"bi-star-fill":"bi-star"])},null,2)),64))]),l("span",$S,d(G.value),1)]),l("div",zS,[f(Sk,{onClick:H,variant:"primary",class:"add-review-button"},{default:y(()=>t[33]||(t[33]=[l("i",{class:"bi bi-plus-lg"},null,-1),v(" Añadir reseña ")])),_:1,__:[33]}),f(Sk,{onClick:j,variant:"secondary"},{default:y(()=>t[34]||(t[34]=[l("i",{class:"bi bi-whatsapp"},null,-1),v(" Contactar ")])),_:1,__:[34]})])]),Y.value.length?(r(),o("div",WS,[(r(!0),o(p,null,m(Y.value,e=>(r(),w(tS,{key:e.id,review:e,"can-delete":!0,onDelete:B},null,8,["review"]))),128))])):(r(),o("div",VS,t[36]||(t[36]=[l("p",null,"No hay reseñas todavía.",-1)])))])])):c("",!0),f(mC,{modelValue:N.value,"onUpdate:modelValue":t[21]||(t[21]=e=>N.value=e),title:"Eliminar empleado",size:"md"},{footer:y(()=>[l("button",{class:"btn btn-secondary",onClick:t[20]||(t[20]=e=>N.value=!1)}," Cancelar "),l("button",{class:"btn btn-danger",onClick:O,disabled:"ELIMINAR"!==A.value}," Eliminar ",8,YS)]),default:y(()=>{var e;return[l("div",HS,[l("p",null,"¿Estás seguro de que deseas eliminar a "+d(null==(e=I.value)?void 0:e.name)+" del personal?",1),t[38]||(t[38]=l("p",{class:"confirm-warning"},"Esta acción no se puede deshacer.",-1)),l("div",GS,[t[37]||(t[37]=l("label",{for:"confirm-text"},'Escribe "ELIMINAR" para confirmar',-1)),E(l("input",{type:"text",id:"confirm-text","onUpdate:modelValue":t[19]||(t[19]=e=>A.value=e),class:"form-control"},null,512),[[S,A.value]])])])]}),_:1},8,["modelValue"]),f(mC,{modelValue:x.value,"onUpdate:modelValue":t[24]||(t[24]=e=>x.value=e),title:"Añadir nueva reseña",size:"md"},{footer:y(()=>[l("button",{class:"btn btn-secondary",onClick:t[23]||(t[23]=e=>x.value=!1)}," Cancelar "),l("button",{class:"btn btn-primary",onClick:q,disabled:!P.value.comment||R.value},[R.value?(r(),o("span",tT,"Guardando...")):(r(),o("span",aT,"Guardar reseña"))],8,eT)]),default:y(()=>[l("div",KS,[l("div",QS,[t[39]||(t[39]=l("label",null,"Calificación",-1)),l("div",JS,[(r(),o(p,null,m(5,e=>l("button",{key:e,type:"button",class:u(["star-button",{active:e<=P.value.rating}]),onClick:t=>P.value.rating=e},[l("i",{class:u(["bi",e<=P.value.rating?"bi-star-fill":"bi-star"])},null,2)],10,ZS)),64))])]),l("div",XS,[t[40]||(t[40]=l("label",{for:"review-comment"},"Comentario",-1)),E(l("textarea",{id:"review-comment","onUpdate:modelValue":t[22]||(t[22]=e=>P.value.comment=e),rows:"4",placeholder:"Escribe tu comentario aquí...",class:"form-control"},null,512),[[S,P.value.comment]])])])]),_:1},8,["modelValue"]),f(hS,{modelValue:D.value,"onUpdate:modelValue":t[25]||(t[25]=e=>D.value=e),loading:M.value,onSubmit:Q},null,8,["modelValue","loading"])]))}},[["__scopeId","data-v-1a682f9c"]]),iT={class:"profile-container"},sT={key:0,class:"loading-container"},oT={key:1,class:"alert alert-danger"},rT={key:2,class:"alert alert-success"},lT={key:3,class:"profile-content"},cT={class:"profile-card"},dT={class:"profile-main"},uT={class:"profile-image-container"},hT=["src"],pT={class:"profile-info"},mT={class:"form-group"},fT=["disabled"],gT={class:"form-group"},vT=["disabled"],bT={class:"form-group"},wT=["disabled"],yT={class:"form-group"},_T=["disabled"],CT={class:"form-group"},kT={class:"form-group"},ET=["disabled"],ST={class:"form-group"},TT=["disabled"],IT={key:0,class:"form-text"},NT={class:"form-group"},xT=["disabled"],AT={key:0,class:"form-text"},PT={class:"profile-actions"},RT=["disabled"],DT={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},MT=["disabled"],LT={class:"confirm-content"},OT={class:"confirm-input"},FT=["disabled"],UT=["disabled"],BT=["disabled"],qT={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},jT=ar({__name:"Profile",setup(e){const n=g(),s=Ya(),u=t({name:"",email:"",phone:"",avatar:"",role:"admin",business:{name:"",code:""}}),p=t({current:"",new:"",confirm:""}),m=t(!0),b=t(!1),w=t(""),_=t(""),C=t(null),k=t(null),T=t(!1),I=t(""),N=t(!1),x=a(()=>!p.value.new||p.value.new.length>=8),A=a(()=>!p.value.new||!p.value.confirm||p.value.new===p.value.confirm),P=a(()=>!(!u.value.name||!u.value.email)&&(!(p.value.current||p.value.new||p.value.confirm)||p.value.current&&x.value&&A.value)),R=e=>{const t=e.target.files[0];if(!t)return;if(t.size>5242880)return void(w.value="La imagen no puede ser mayor a 5MB");k.value=t;const a=new FileReader;a.onload=e=>{C.value=e.target.result},a.readAsDataURL(t)},D=async()=>{var e,t;if(P.value){b.value=!0,w.value="",_.value="";try{const e=new FormData;e.append("name",u.value.name),e.append("email",u.value.email),e.append("phone",u.value.phone||""),k.value&&e.append("avatar",k.value),p.value.current&&p.value.new&&(e.append("current_password",p.value.current),e.append("password",p.value.new),e.append("password_confirmation",p.value.confirm)),console.log("Perfil actualizado:",{name:u.value.name,email:u.value.email,phone:u.value.phone,passwordChanged:!!p.value.current,avatarChanged:!!k.value});const t=s.getUser();t&&(t.name=u.value.name,t.email=u.value.email,t.phone=u.value.phone,C.value&&(t.avatar=C.value),s.setUser(t)),p.value.current="",p.value.new="",p.value.confirm="",k.value=null,_.value="Perfil actualizado correctamente"}catch(a){console.error("Error al actualizar perfil:",a),w.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"No se pudo actualizar el perfil. Por favor, inténtalo de nuevo."}finally{b.value=!1}}},M=async()=>{var e,t;if("ELIMINAR"===I.value){N.value=!0;try{console.log("Cuenta eliminada"),await s.logout(),n.push("/login")}catch(a){console.error("Error al eliminar cuenta:",a),w.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"No se pudo eliminar la cuenta. Por favor, inténtalo de nuevo.",T.value=!1,I.value="",N.value=!1}}},L=()=>{n.push("/admin")};return i(()=>{(async()=>{m.value=!0,w.value="";try{const e=s.getUser()||{id:"1",name:"Administrador",email:"admin@ejemplo.com",phone:"555-987-6543",avatar:"https://randomuser.me/api/portraits/men/42.jpg",role:"admin",business:{name:"Mi Restaurante",code:"FGT-464"}};u.value={...e}}catch(e){console.error("Error al cargar datos del usuario:",e),w.value="No se pudieron cargar tus datos. Por favor, inténtalo de nuevo."}finally{m.value=!1}})()}),(e,t)=>(r(),o("div",iT,[l("div",{class:"profile-header"},[l("button",{class:"back-button",onClick:L}," ← Volver ")]),m.value&&!u.value.name?(r(),o("div",sT,t[12]||(t[12]=[l("div",{class:"loading-spinner"},null,-1),l("p",null,"Cargando datos del perfil...",-1)]))):c("",!0),w.value?(r(),o("div",oT,d(w.value),1)):c("",!0),_.value?(r(),o("div",rT,d(_.value),1)):c("",!0),!m.value||u.value.name?(r(),o("div",lT,[l("div",cT,[l("div",dT,[l("div",uT,[l("img",{src:C.value||u.value.avatar||"/placeholder-avatar.png",alt:"Foto de perfil",class:"profile-image"},null,8,hT),t[13]||(t[13]=l("label",{for:"avatar-upload",class:"avatar-edit-btn"},[l("i",{class:"bi bi-camera"})],-1)),l("input",{type:"file",id:"avatar-upload",accept:"image/*",class:"visually-hidden",onChange:R},null,32)]),l("div",pT,[l("form",{onSubmit:h(D,["prevent"])},[l("div",mT,[t[14]||(t[14]=l("label",{for:"name"},"Nombre completo",-1)),E(l("input",{type:"text",id:"name","onUpdate:modelValue":t[0]||(t[0]=e=>u.value.name=e),class:"form-control",required:"",disabled:b.value},null,8,fT),[[S,u.value.name]])]),l("div",gT,[t[15]||(t[15]=l("label",{for:"email"},"Correo electrónico",-1)),E(l("input",{type:"email",id:"email","onUpdate:modelValue":t[1]||(t[1]=e=>u.value.email=e),class:"form-control",required:"",disabled:b.value},null,8,vT),[[S,u.value.email]])]),l("div",bT,[t[16]||(t[16]=l("label",{for:"phone"},"Teléfono",-1)),E(l("input",{type:"tel",id:"phone","onUpdate:modelValue":t[2]||(t[2]=e=>u.value.phone=e),class:"form-control",disabled:b.value},null,8,wT),[[S,u.value.phone]])]),l("div",yT,[t[17]||(t[17]=l("label",{for:"business-name"},"Nombre del negocio",-1)),E(l("input",{type:"text",id:"business-name","onUpdate:modelValue":t[3]||(t[3]=e=>u.value.business.name=e),class:"form-control",disabled:b.value},null,8,_T),[[S,u.value.business.name]])]),l("div",CT,[t[18]||(t[18]=l("label",{for:"business-code"},"Código del negocio",-1)),E(l("input",{type:"text",id:"business-code","onUpdate:modelValue":t[4]||(t[4]=e=>u.value.business.code=e),class:"form-control",disabled:""},null,512),[[S,u.value.business.code]])]),t[23]||(t[23]=l("div",{class:"profile-divider"},[l("h3",null,"Cambiar contraseña")],-1)),l("div",kT,[t[19]||(t[19]=l("label",{for:"current-password"},"Contraseña actual",-1)),E(l("input",{type:"password",id:"current-password","onUpdate:modelValue":t[5]||(t[5]=e=>p.value.current=e),class:"form-control",disabled:b.value},null,8,ET),[[S,p.value.current]])]),l("div",ST,[t[20]||(t[20]=l("label",{for:"new-password"},"Nueva contraseña",-1)),E(l("input",{type:"password",id:"new-password","onUpdate:modelValue":t[6]||(t[6]=e=>p.value.new=e),class:"form-control",disabled:b.value},null,8,TT),[[S,p.value.new]]),p.value.new&&!x.value?(r(),o("div",IT," La contraseña debe tener al menos 8 caracteres ")):c("",!0)]),l("div",NT,[t[21]||(t[21]=l("label",{for:"confirm-password"},"Confirmar nueva contraseña",-1)),E(l("input",{type:"password",id:"confirm-password","onUpdate:modelValue":t[7]||(t[7]=e=>p.value.confirm=e),class:"form-control",disabled:b.value},null,8,xT),[[S,p.value.confirm]]),p.value.confirm&&!A.value?(r(),o("div",AT," Las contraseñas no coinciden ")):c("",!0)]),l("div",PT,[l("button",{type:"submit",class:"btn btn-primary",disabled:b.value||!P.value},[b.value?(r(),o("span",DT)):c("",!0),t[22]||(t[22]=v(" Guardar cambios "))],8,RT),l("button",{type:"button",class:"btn btn-danger",onClick:t[8]||(t[8]=e=>T.value=!0),disabled:b.value}," Eliminar cuenta ",8,MT)])],32)])])])])):c("",!0),f(mC,{modelValue:T.value,"onUpdate:modelValue":t[11]||(t[11]=e=>T.value=e),title:"Eliminar cuenta",size:"md"},{footer:y(()=>[l("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=e=>T.value=!1),disabled:N.value}," Cancelar ",8,UT),l("button",{type:"button",class:"btn btn-danger",onClick:M,disabled:"ELIMINAR"!==I.value||N.value},[N.value?(r(),o("span",qT)):c("",!0),t[27]||(t[27]=v(" Eliminar mi cuenta "))],8,BT)]),default:y(()=>[l("div",LT,[t[25]||(t[25]=l("p",null,"¿Estás seguro de que deseas eliminar tu cuenta? Esta acción no se puede deshacer.",-1)),t[26]||(t[26]=l("div",{class:"alert alert-danger"},[l("i",{class:"bi bi-exclamation-triangle-fill me-2"}),v(" Al eliminar tu cuenta perderás todo el acceso a tus datos y negocios asociados. ")],-1)),l("div",OT,[t[24]||(t[24]=l("label",{for:"confirm-delete"},'Escribe "ELIMINAR" para confirmar',-1)),E(l("input",{type:"text",class:"form-control",id:"confirm-delete","onUpdate:modelValue":t[9]||(t[9]=e=>I.value=e),disabled:N.value},null,8,FT),[[S,I.value]])])])]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-7f2d5965"]]),$T={class:"settings-container"},zT={key:0,class:"loading-container"},VT={key:1,class:"error-container"},WT={key:2,class:"settings-content"},HT={key:0,class:"success-message"},GT={class:"settings-section"},YT={class:"form-group"},KT={class:"form-group"},QT={class:"form-row"},JT={class:"form-group"},ZT={class:"form-group"},XT={class:"form-group"},eI={class:"form-actions"},tI={class:"settings-section"},aI={class:"section-header"},nI={key:0,class:"empty-tables"},iI={key:1,class:"tables-list"},sI={class:"table-info"},oI={class:"table-number"},rI={class:"table-details"},lI={class:"table-name"},cI={class:"table-capacity"},dI={class:"table-actions"},uI=["onClick"],hI=["onClick"],pI={class:"settings-section danger-zone"},mI={class:"form-row"},fI={class:"form-group"},gI={class:"form-group"},vI={class:"form-group"},bI={class:"form-row"},wI={class:"form-group"},yI={class:"form-group"},_I={class:"form-group"},CI={class:"confirm-content"},kI=ar({__name:"Settings",setup(e){const a=g(),n=Q_(),s=Ya(),u=t(!1),b=t(""),_=t(""),C=t(null),k=t([]),T=t(!1),N=t(!1),x=t(!1),A=t(null),P=I({number:"",name:"",capacity:4});i(async()=>{u.value=!0,b.value="";try{const[e,t]=await Promise.all([n.fetchBusinessData(),n.fetchTables()]);C.value=e||{},k.value=t||[]}catch(e){b.value=e.message||"Error al cargar datos"}finally{u.value=!1}});const R=async()=>{if(C.value){u.value=!0,b.value="",_.value="";try{await n.updateBusinessData(C.value),_.value="Configuración guardada con éxito"}catch(e){b.value=e.message||"Error al guardar configuración"}finally{u.value=!1}}},D=async()=>{if(P.number&&P.capacity){u.value=!0,b.value="";try{const e=await n.createTable(P);e&&(k.value.push(e),P.number="",P.name="",P.capacity=4,T.value=!1)}catch(e){b.value=e.message||"Error al crear mesa"}finally{u.value=!1}}else b.value="Por favor, completa todos los campos requeridos"},M=async()=>{if(A.value){u.value=!0,b.value="";try{await n.updateTable(A.value),k.value=k.value.map(e=>e.id===A.value.id?A.value:e),N.value=!1,A.value=null}catch(e){b.value=e.message||"Error al actualizar mesa"}finally{u.value=!1}}},L=async()=>{if(A.value){u.value=!0,b.value="";try{await n.deleteTable(A.value.id),k.value=k.value.filter(e=>e.id!==A.value.id),x.value=!1,A.value=null}catch(e){b.value=e.message||"Error al eliminar mesa"}finally{u.value=!1}}},O=()=>{a.push({name:"admin-home"})},F=async()=>{await s.logout(),a.push("/login")};return(e,t)=>(r(),o("div",$T,[l("div",{class:"settings-header"},[l("button",{class:"back-button",onClick:O}," ← Volver "),t[19]||(t[19]=l("h1",null,"Configuración",-1))]),u.value?(r(),o("div",zT,t[20]||(t[20]=[l("div",{class:"loading-spinner"},null,-1),l("p",null,"Cargando configuración...",-1)]))):b.value?(r(),o("div",VT,[l("p",null,d(b.value),1),f(Sk,{onClick:t[0]||(t[0]=t=>e.$router.go(0)),variant:"primary"},{default:y(()=>t[21]||(t[21]=[v(" Reintentar ")])),_:1,__:[21]})])):C.value?(r(),o("div",WT,[_.value?(r(),o("div",HT,d(_.value),1)):c("",!0),l("div",GT,[t[28]||(t[28]=l("h2",null,"Información del negocio",-1)),l("form",{onSubmit:h(R,["prevent"]),class:"business-form"},[l("div",YT,[t[22]||(t[22]=l("label",{for:"business-name"},"Nombre del restaurante",-1)),E(l("input",{id:"business-name",type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>C.value.name=e),required:""},null,512),[[S,C.value.name]])]),l("div",KT,[t[23]||(t[23]=l("label",{for:"business-address"},"Dirección",-1)),E(l("input",{id:"business-address",type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>C.value.address=e)},null,512),[[S,C.value.address]])]),l("div",QT,[l("div",JT,[t[24]||(t[24]=l("label",{for:"business-phone"},"Teléfono",-1)),E(l("input",{id:"business-phone",type:"tel","onUpdate:modelValue":t[3]||(t[3]=e=>C.value.phone=e)},null,512),[[S,C.value.phone]])]),l("div",ZT,[t[25]||(t[25]=l("label",{for:"business-email"},"Email",-1)),E(l("input",{id:"business-email",type:"email","onUpdate:modelValue":t[4]||(t[4]=e=>C.value.email=e)},null,512),[[S,C.value.email]])])]),l("div",XT,[t[26]||(t[26]=l("label",{for:"business-description"},"Descripción",-1)),E(l("textarea",{id:"business-description","onUpdate:modelValue":t[5]||(t[5]=e=>C.value.description=e),rows:"3"},null,512),[[S,C.value.description]])]),l("div",eI,[f(Sk,{type:"submit",variant:"primary",loading:u.value},{default:y(()=>t[27]||(t[27]=[v(" Guardar cambios ")])),_:1,__:[27]},8,["loading"])])],32)]),l("div",tI,[l("div",aI,[t[30]||(t[30]=l("h2",null,"Mesas",-1)),f(Sk,{onClick:t[6]||(t[6]=e=>T.value=!0),variant:"primary"},{default:y(()=>t[29]||(t[29]=[v(" Añadir mesa ")])),_:1,__:[29]})]),0===k.value.length?(r(),o("div",nI,t[31]||(t[31]=[l("p",null,"No hay mesas configuradas",-1),l("p",null,"Añade mesas para que los clientes puedan hacer pedidos",-1)]))):(r(),o("div",iI,[(r(!0),o(p,null,m(k.value,e=>(r(),o("div",{key:e.id,class:"table-card"},[l("div",sI,[l("div",oI,d(e.number),1),l("div",rI,[l("span",lI,d(e.name||`Mesa ${e.number}`),1),l("span",cI,d(e.capacity)+" personas",1)])]),l("div",dI,[l("button",{onClick:t=>(e=>{A.value={...e},N.value=!0})(e),class:"edit-button"}," Editar ",8,uI),l("button",{onClick:t=>(e=>{A.value=e,x.value=!0})(e),class:"delete-button"}," Eliminar ",8,hI)])]))),128))]))]),l("div",pI,[t[33]||(t[33]=l("h2",null,"Cerrar Sesión",-1)),t[34]||(t[34]=l("p",null,"Finaliza tu sesión actual de forma segura.",-1)),f(Sk,{onClick:F,variant:"danger-outline"},{default:y(()=>t[32]||(t[32]=[v(" Cerrar sesión ")])),_:1,__:[32]})])])):c("",!0),f(mC,{modelValue:T.value,"onUpdate:modelValue":t[11]||(t[11]=e=>T.value=e),title:"Añadir nueva mesa",size:"md"},{footer:y(()=>[f(Sk,{onClick:t[10]||(t[10]=e=>T.value=!1),variant:"outline"},{default:y(()=>t[38]||(t[38]=[v(" Cancelar ")])),_:1,__:[38]}),f(Sk,{onClick:D,variant:"primary",loading:u.value},{default:y(()=>t[39]||(t[39]=[v(" Añadir ")])),_:1,__:[39]},8,["loading"])]),default:y(()=>[l("form",{onSubmit:h(D,["prevent"]),class:"table-form"},[l("div",mI,[l("div",fI,[t[35]||(t[35]=l("label",{for:"table-number"},"Número*",-1)),E(l("input",{id:"table-number",type:"number","onUpdate:modelValue":t[7]||(t[7]=e=>P.number=e),min:"1",required:""},null,512),[[S,P.number]])]),l("div",gI,[t[36]||(t[36]=l("label",{for:"table-capacity"},"Capacidad*",-1)),E(l("input",{id:"table-capacity",type:"number","onUpdate:modelValue":t[8]||(t[8]=e=>P.capacity=e),min:"1",required:""},null,512),[[S,P.capacity]])])]),l("div",vI,[t[37]||(t[37]=l("label",{for:"table-name"},"Nombre (opcional)",-1)),E(l("input",{id:"table-name",type:"text","onUpdate:modelValue":t[9]||(t[9]=e=>P.name=e),placeholder:"Ej: Terraza 1"},null,512),[[S,P.name]])])],32)]),_:1},8,["modelValue"]),A.value?(r(),w(mC,{key:3,modelValue:N.value,"onUpdate:modelValue":t[16]||(t[16]=e=>N.value=e),title:"Editar mesa",size:"md"},{footer:y(()=>[f(Sk,{onClick:t[15]||(t[15]=e=>N.value=!1),variant:"outline"},{default:y(()=>t[43]||(t[43]=[v(" Cancelar ")])),_:1,__:[43]}),f(Sk,{onClick:M,variant:"primary",loading:u.value},{default:y(()=>t[44]||(t[44]=[v(" Guardar ")])),_:1,__:[44]},8,["loading"])]),default:y(()=>[l("form",{onSubmit:h(M,["prevent"]),class:"table-form"},[l("div",bI,[l("div",wI,[t[40]||(t[40]=l("label",{for:"edit-table-number"},"Número*",-1)),E(l("input",{id:"edit-table-number",type:"number","onUpdate:modelValue":t[12]||(t[12]=e=>A.value.number=e),min:"1",required:""},null,512),[[S,A.value.number]])]),l("div",yI,[t[41]||(t[41]=l("label",{for:"edit-table-capacity"},"Capacidad*",-1)),E(l("input",{id:"edit-table-capacity",type:"number","onUpdate:modelValue":t[13]||(t[13]=e=>A.value.capacity=e),min:"1",required:""},null,512),[[S,A.value.capacity]])])]),l("div",_I,[t[42]||(t[42]=l("label",{for:"edit-table-name"},"Nombre (opcional)",-1)),E(l("input",{id:"edit-table-name",type:"text","onUpdate:modelValue":t[14]||(t[14]=e=>A.value.name=e),placeholder:"Ej: Terraza 1"},null,512),[[S,A.value.name]])])],32)]),_:1},8,["modelValue"])):c("",!0),A.value?(r(),w(mC,{key:4,modelValue:x.value,"onUpdate:modelValue":t[18]||(t[18]=e=>x.value=e),title:"Eliminar mesa",size:"sm"},{footer:y(()=>[f(Sk,{onClick:t[17]||(t[17]=e=>x.value=!1),variant:"outline"},{default:y(()=>t[46]||(t[46]=[v(" Cancelar ")])),_:1,__:[46]}),f(Sk,{onClick:L,variant:"danger",loading:u.value},{default:y(()=>t[47]||(t[47]=[v(" Eliminar ")])),_:1,__:[47]},8,["loading"])]),default:y(()=>[l("div",CI,[l("p",null,"¿Estás seguro de que deseas eliminar la mesa "+d(A.value.number)+"?",1),t[45]||(t[45]=l("p",{class:"confirm-warning"},"Esta acción no se puede deshacer.",-1))])]),_:1},8,["modelValue"])):c("",!0)]))}},[["__scopeId","data-v-6566ffad"]]),EI={class:"debug-panel"},SI={class:"debug-section"},TI={class:"status-grid"},II={class:"status-icon"},NI={class:"status-icon"},xI={class:"status-icon"},AI={class:"status-item"},PI={class:"debug-section"},RI={class:"button-grid"},DI=["disabled"],MI=["disabled"],LI=["disabled"],OI=["disabled"],FI={class:"debug-section"},UI={class:"test-form"},BI={class:"form-row"},qI={class:"form-row"},jI={class:"form-row"},$I=["disabled"],zI={class:"debug-section"},VI={class:"token-actions"},WI=["disabled"],HI={key:0,class:"debug-section"},GI={class:"debug-logs"},YI={class:"log-time"},KI={class:"log-message"},QI={class:"debug-section"},JI={class:"tech-info"},ZI={class:"info-item"},XI={class:"info-item"},eN={class:"info-item"},tN={class:"info-item"},aN={__name:"NotificationDebugPanel",setup(e){const s=Ya(),h=er(),f=t(!1),g=t([]),b=t(null),w=t({title:"🧪 Notificación de Prueba",body:"Esta es una notificación de prueba desde el panel de debug",type:"all"}),y=a(()=>s.isAuthenticated),_=t(!1),C=a(()=>!!b.value),k=I({browser:"",pushSupport:!1,serviceWorkerSupport:!1,firebaseProject:""});function T(e,t="info"){g.value.push({id:Date.now()+Math.random(),timestamp:new Date,message:e,type:t}),console.log(`[NotificationDebug] ${e}`)}function N(){g.value=[],T("🧹 Log limpiado","info")}function A(){const e=g.value.map(e=>`[${e.timestamp.toLocaleString()}] ${e.type.toUpperCase()}: ${e.message}`).join("\n"),t=new Blob([e],{type:"text/plain"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=`notification-debug-${(new Date).toISOString().slice(0,10)}.log`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a),T("💾 Log descargado","success")}async function P(){if(!f.value){f.value=!0,T("🔔 Solicitando permisos de notificación...","info");try{if(!("Notification"in window))throw new Error("Este navegador no soporta notificaciones push");const e=await Notification.requestPermission();T(`📋 Resultado de permisos: ${e}`,"info"),"granted"===e?(systemStatus.permissions=!0,T("✅ Permisos concedidos","success"),Jo("Permisos de notificación concedidos"),await R()):(systemStatus.permissions=!1,T("❌ Permisos denegados","error"),Zo("Permisos de notificación denegados"))}catch(e){T(`❌ Error pidiendo permisos: ${e.message}`,"error"),Zo(`Error: ${e.message}`)}finally{f.value=!1}}}async function R(){if(!f.value){f.value=!0,T("🚀 Inicializando Firebase Cloud Messaging...","info");try{if(!s.isAuthenticated)throw new Error("Usuario no autenticado");await Da();const e=await Ma();if(!e)throw new Error("No se pudo obtener el token FCM");b.value=e,T(`🔑 Token FCM obtenido: ${e.substring(0,20)}...`,"success"),T("🔥 Listener de mensajes en primer plano configurado","success"),await D()}catch(e){T(`❌ Error inicializando FCM: ${e.message}`,"error"),Zo(`Error inicializando FCM: ${e.message}`)}finally{f.value=!1}}}async function D(){if(f.value)return;const e=b.value||localStorage.getItem("fcm_token");if(e){f.value=!0,T("📤 Enviando token al servidor...","info");try{await Na.storeDeviceToken(e,"web",s.user.id);T("✅ Token enviado al servidor exitosamente","success"),Jo("Token FCM registrado en el servidor")}catch(t){T(`❌ Error enviando token: ${t.message}`,"error"),Zo(`Error enviando token: ${t.message}`)}finally{f.value=!1}}else T("❌ No hay token FCM para enviar","error")}async function M(){if(!f.value){f.value=!0,T("📥 Cargando notificaciones...","info");try{await h.loadNotifications(),T(`📬 ${h.totalUnreadCount} notificaciones no leídas cargadas`,"success"),Jo("Notificaciones cargadas")}catch(e){T(`❌ Error cargando notificaciones: ${e.message}`,"error"),Zo(`Error cargando notificaciones: ${e.message}`)}finally{f.value=!1}}}async function L(){if(f.value)return;if(!w.value.title.trim()||!w.value.body.trim())return void Zo("Título y mensaje son requeridos");f.value=!0;const{title:e,body:t,type:a}=w.value;T(`📨 Enviando notificación tipo: ${a}`,"info");try{let n;switch(a){case"all":n=await Na.sendNotificationToAll(e,t),T("✅ Notificación enviada a todos los usuarios","success");break;case"user":n=await Na.sendNotificationToUser(s.user.id,e,t),T("✅ Notificación enviada solo para ti","success");break;case"device":const a=b.value||localStorage.getItem("fcm_token");if(!a)throw new Error("No hay token FCM disponible");n=await Na.sendNotificationToDevice(a,e,t),T("✅ Notificación enviada a tu dispositivo","success");break;default:throw new Error("Tipo de notificación no válido")}Jo("Notificación enviada exitosamente"),T(`📝 Respuesta: ${JSON.stringify(n)}`,"info")}catch(n){T(`❌ Error enviando notificación: ${n.message}`,"error"),Zo(`Error enviando notificación: ${n.message}`)}finally{f.value=!1}}function O(){const e=b.value||localStorage.getItem("fcm_token");e?(T("🔑 Token FCM actual:","info"),T(e,"info"),Jo("Token mostrado en el log")):(T("❌ No hay token FCM disponible","error"),Zo("No hay token FCM disponible"))}async function F(){const e=b.value||localStorage.getItem("fcm_token");if(e)try{await navigator.clipboard.writeText(e),T("📋 Token copiado al portapapeles","success"),Jo("Token copiado al portapapeles")}catch(t){T("❌ Error copiando token","error"),Zo("Error copiando token")}else Zo("No hay token para copiar")}async function U(){if(f.value)return;if(b.value||localStorage.getItem("fcm_token")){f.value=!0,T("🗑️ Eliminando token...","info");try{b.value=null,localStorage.removeItem("fcm_token"),T("✅ Token eliminado","success"),Jo("Token eliminado")}catch(e){T(`❌ Error eliminando token: ${e.message}`,"error"),Zo(`Error eliminando token: ${e.message}`)}finally{f.value=!1}}else Zo("No hay token para eliminar")}return i(()=>{T("🔧 Panel de debug cargado","info"),k.browser=navigator.userAgent.split("(")[0].trim(),k.pushSupport="Notification"in window,k.serviceWorkerSupport="serviceWorker"in navigator,k.firebaseProject="mozoqr-7d32c","Notification"in window&&(_.value="granted"===Notification.permission,T(`📋 Permisos actuales: ${Notification.permission}`,"info"));const e=localStorage.getItem("fcm_token");e&&(b.value=e,T(`🔑 Token FCM encontrado: ${e.substring(0,20)}...`,"info")),T("👤 Usuario autenticado: "+(s.isAuthenticated?"Sí":"No"),"info"),s.user&&T(`👤 ID: ${s.user.id} | Email: ${s.user.email}`,"info")}),(e,t)=>(r(),o("div",EI,[t[21]||(t[21]=l("div",{class:"debug-header"},[l("h3",null,"🧪 Debug de Notificaciones FCM"),l("p",{class:"debug-subtitle"},"Panel para probar y debuggear notificaciones push")],-1)),l("div",SI,[t[7]||(t[7]=l("h4",null,"📊 Estado del Sistema",-1)),l("div",TI,[l("div",{class:u(["status-item",{active:y.value}])},[l("span",II,d(y.value?"✅":"❌"),1),t[3]||(t[3]=l("span",null,"Usuario Autenticado",-1))],2),l("div",{class:u(["status-item",{active:_.value}])},[l("span",NI,d(_.value?"✅":"❌"),1),t[4]||(t[4]=l("span",null,"Permisos Push",-1))],2),l("div",{class:u(["status-item",{active:C.value}])},[l("span",xI,d(C.value?"✅":"❌"),1),t[5]||(t[5]=l("span",null,"Token FCM",-1))],2),l("div",AI,[t[6]||(t[6]=l("span",{class:"status-icon"},"🔔",-1)),l("span",null,d(n(h).totalUnreadCount)+" no leídas",1)])])]),l("div",PI,[t[8]||(t[8]=l("h4",null,"⚡ Acciones Rápidas",-1)),l("div",RI,[l("button",{onClick:P,disabled:f.value,class:"debug-btn primary"},d(f.value?"Procesando...":"🔔 Pedir Permisos"),9,DI),l("button",{onClick:R,disabled:f.value,class:"debug-btn secondary"}," 🚀 Inicializar FCM ",8,MI),l("button",{onClick:D,disabled:f.value,class:"debug-btn secondary"}," 📤 Enviar Token al Servidor ",8,LI),l("button",{onClick:M,disabled:f.value,class:"debug-btn info"}," 📥 Cargar Notificaciones ",8,OI)])]),l("div",FI,[t[13]||(t[13]=l("h4",null,"📤 Enviar Notificaciones de Prueba",-1)),l("div",UI,[l("div",BI,[t[9]||(t[9]=l("label",null,"Título:",-1)),E(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>w.value.title=e),placeholder:"Título de la notificación"},null,512),[[S,w.value.title]])]),l("div",qI,[t[10]||(t[10]=l("label",null,"Mensaje:",-1)),E(l("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>w.value.body=e),placeholder:"Cuerpo del mensaje",rows:"2"},null,512),[[S,w.value.body]])]),l("div",jI,[t[12]||(t[12]=l("label",null,"Tipo:",-1)),E(l("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>w.value.type=e)},t[11]||(t[11]=[l("option",{value:"all"},"🌐 Enviar a Todos",-1),l("option",{value:"user"},"👤 Enviar Solo a Mí",-1),l("option",{value:"device"},"📱 Enviar a Mi Device",-1)]),512),[[x,w.value.type]])]),l("button",{onClick:L,disabled:f.value,class:"debug-btn primary full-width"},d(f.value?"Enviando...":"📨 Enviar Notificación"),9,$I)])]),l("div",zI,[t[14]||(t[14]=l("h4",null,"🔑 Gestión de Device Tokens",-1)),l("div",VI,[l("button",{onClick:O,class:"debug-btn secondary"}," 👀 Ver Token Actual "),l("button",{onClick:F,class:"debug-btn secondary"}," 📋 Copiar Token "),l("button",{onClick:U,disabled:f.value,class:"debug-btn danger"}," 🗑️ Eliminar Token ",8,WI)])]),g.value.length>0?(r(),o("div",HI,[t[15]||(t[15]=l("h4",null,"📝 Log de Eventos",-1)),l("div",GI,[(r(!0),o(p,null,m(g.value.slice(-10),e=>{return r(),o("div",{key:e.id,class:u(["log-item",e.type])},[l("span",YI,d((t=e.timestamp,t.toLocaleTimeString())),1),l("span",KI,d(e.message),1)],2);var t}),128))]),l("div",{class:"log-actions"},[l("button",{onClick:N,class:"debug-btn small"},"Limpiar Log"),l("button",{onClick:A,class:"debug-btn small"},"💾 Descargar Log")])])):c("",!0),l("div",QI,[t[20]||(t[20]=l("h4",null,"🔧 Información Técnica",-1)),l("div",JI,[l("div",ZI,[t[16]||(t[16]=l("strong",null,"Navegador:",-1)),v(" "+d(k.browser),1)]),l("div",XI,[t[17]||(t[17]=l("strong",null,"Soporte Push:",-1)),v(" "+d(k.pushSupport?"Sí":"No"),1)]),l("div",eN,[t[18]||(t[18]=l("strong",null,"Service Worker:",-1)),v(" "+d(k.serviceWorkerSupport?"Sí":"No"),1)]),l("div",tN,[t[19]||(t[19]=l("strong",null,"Firebase Project:",-1)),v(" "+d(k.firebaseProject),1)])])])]))}},nN=ar(aN,[["__scopeId","data-v-03f702b6"]]),iN={class:"notification-debug"},sN={key:0,class:"current-notifications"},oN={class:"notifications-list"},rN={class:"notification-header"},lN={class:"notification-time"},cN={class:"notification-body"},dN={class:"notification-meta"},uN={class:"notification-type"},hN={class:"notification-status"},pN=ar({__name:"NotificationDebug",setup(e){const t=er(),n=a(()=>[...t.unreadNotifications,...t.readNotifications]);async function i(){try{await(async()=>{try{console.log("🧪 Enviando notificación de prueba para app cerrada...");const e=await Ia.post("/notifications/test-background",{title:"🔔 Prueba App Cerrada",message:"Esta notificación debe aparecer cuando la app está cerrada",data:{type:"background_test",timestamp:(new Date).toISOString(),test_mode:!0}});return console.log("✅ Notificación de prueba enviada:",e.data),e.data}catch(e){throw console.error("❌ Error enviando notificación de prueba:",e),e}})(),alert("✅ Notificación de prueba enviada. Cierra la app y verifica que llegue la notificación.")}catch(e){alert("❌ Error enviando notificación: "+e.message)}}async function s(){try{await(async(e=10)=>{try{console.log(`🕐 Programando notificación de prueba en ${e} segundos...`);const t=await Ia.post("/notifications/schedule-test",{delay:e,title:"⏰ Notificación Programada",message:`Esta notificación fue programada hace ${e} segundos`,data:{type:"scheduled_test",scheduled_at:(new Date).toISOString(),delay_seconds:e}});return console.log("✅ Notificación programada:",t.data),t.data}catch(t){throw console.error("❌ Error programando notificación:",t),t}})(15),alert("✅ Notificación programada para 15 segundos. Cierra la app y espera.")}catch(e){alert("❌ Error programando notificación: "+e.message)}}function h(){const e={steps:["1. Asegúrate de estar autenticado en la app","2. Ejecuta sendTestBackgroundNotification() o scheduleTestNotification()","3. Cierra completamente la aplicación (no solo minimizar)","4. Espera unos segundos","5. Deberías ver la notificación en la barra de notificaciones","6. Al tocar la notificación, la app debe abrirse"],note:"Para Android, asegúrate de que los permisos de notificaciones estén activados y que la app no esté en modo ahorro de batería."},t=`\nInstrucciones para probar notificaciones:\n\n${e.steps.join("\n")}\n\nNota: ${e.note}\n  `;alert(t)}return(e,t)=>(r(),o("div",iN,[t[2]||(t[2]=l("div",{class:"page-header"},[l("h1",null,"Panel de Debug - Notificaciones"),l("p",{class:"subtitle"},"Prueba y monitorea el sistema de notificaciones FCM")],-1)),f(nN),l("div",{class:"background-tests"},[t[0]||(t[0]=l("h2",null,"📴 Pruebas App Cerrada",-1)),t[1]||(t[1]=l("p",{class:"test-description"}," Estas pruebas envían notificaciones que deben llegar cuando la aplicación está completamente cerrada. ",-1)),l("div",{class:"test-buttons"},[l("button",{onClick:i,class:"test-btn primary"}," 🧪 Probar App Cerrada "),l("button",{onClick:s,class:"test-btn secondary"}," ⏰ Notificación en 15s "),l("button",{onClick:h,class:"test-btn info"}," 📋 Ver Instrucciones ")])]),n.value.length>0?(r(),o("div",sN,[l("h2",null,"📬 Notificaciones Actuales ("+d(n.value.length)+")",1),l("div",oN,[(r(!0),o(p,null,m(n.value.slice(0,10),e=>{var t,a,n;return r(),o("div",{key:e.id,class:u(["notification-preview",{unread:!e.read_at}])},[l("div",rN,[l("strong",null,d((null==(t=e.data)?void 0:t.title)||e.title||"Sin título"),1),l("span",lN,d((n=e.created_at||e.timestamp,new Date(n).toLocaleString())),1)]),l("p",cN,d((null==(a=e.data)?void 0:a.message)||e.body||"Sin mensaje"),1),l("div",dN,[l("span",uN,d(e.type||"notification"),1),l("span",hN,d(e.read_at?"Leída":"No leída"),1)])],2)}),128))])])):c("",!0),t[3]||(t[3]=A('<div class="instructions" data-v-da0dde4d><h2 data-v-da0dde4d>📋 Instrucciones de Uso</h2><div class="instruction-steps" data-v-da0dde4d><div class="step" data-v-da0dde4d><span class="step-number" data-v-da0dde4d>1</span><div class="step-content" data-v-da0dde4d><strong data-v-da0dde4d>Inicializar Sistema:</strong><p data-v-da0dde4d>Haz clic en &quot;Inicializar Sistema&quot; para configurar FCM y obtener permisos.</p></div></div><div class="step" data-v-da0dde4d><span class="step-number" data-v-da0dde4d>2</span><div class="step-content" data-v-da0dde4d><strong data-v-da0dde4d>Probar Notificaciones:</strong><p data-v-da0dde4d>Usa &quot;Test Local&quot; para notificaciones inmediatas o &quot;Servidor&quot; para probar el backend.</p></div></div><div class="step" data-v-da0dde4d><span class="step-number" data-v-da0dde4d>3</span><div class="step-content" data-v-da0dde4d><strong data-v-da0dde4d>Verificar en el Bell:</strong><p data-v-da0dde4d>Las notificaciones aparecerán en el icono de campana en la barra superior.</p></div></div></div></div>',1))]))}},[["__scopeId","data-v-da0dde4d"]]),mN={class:"call-waiter-container"},fN={key:0,class:"call-idle-state"},gN=["disabled"],vN={key:0},bN={key:1},wN={key:1,class:"call-calling-state"},yN={key:2,class:"call-waiting-state"},_N={class:"call-status-card"},CN={class:"wait-time"},kN={key:3,class:"call-acknowledged-state"},EN={key:4,class:"call-error-state"},SN={class:"call-status-card error"},TN={class:"urgency-options"},IN=ar({__name:"CallWaiterButton",props:{tableId:{type:[String,Number],required:!0},businessId:{type:[String,Number],required:!0},tableNumber:{type:[String,Number],default:null}},emits:["call-status-change"],setup(e,{emit:t}){const n=e,p=t,m=I({callState:"idle",loading:!1,showUrgencyOptions:!1,waitTimeSeconds:0,errorMessage:{},currentCallId:null,waitTimer:null}),f=a(()=>m.callState),g=a(()=>m.loading),b=a({get:()=>m.showUrgencyOptions,set:e=>m.showUrgencyOptions=e}),w=a(()=>m.waitTimeSeconds),y=a(()=>m.errorMessage),_=a(()=>{const e=m.waitTimeSeconds;if(e<60)return`${e}s`;return`${Math.floor(e/60)}m ${e%60}s`}),C=()=>{m.showUrgencyOptions=!0},k=()=>{E("urgent")},E=async(e="normal")=>{m.showUrgencyOptions=!1,m.callState="calling",m.loading=!0,p("call-status-change","calling");try{console.log("📞 Calling waiter...",{tableId:n.tableId,urgency:e,tableNumber:n.tableNumber});const t=await Xl.callWaiter(n.tableId,{message:"urgent"===e?"Solicitud urgente":"Solicita mozo",urgency:"urgent"===e?"high":"normal",client_info:{timestamp:(new Date).toISOString(),table_number:n.tableNumber}});t.success?(console.log("✅ Waiter called successfully:",t),m.currentCallId=t.call_id,m.callState="waiting",m.waitTimeSeconds=0,N(),A(),p("call-status-change","waiting")):S(t)}catch(t){console.error("❌ Error calling waiter:",t),S(t)}finally{m.loading=!1}},S=e=>{var t,a;m.callState="error",(null==(t=e.message)?void 0:t.includes("no_waiter_assigned"))?m.errorMessage={title:"Mozo no disponible",description:"No hay un mozo asignado a esta mesa actualmente. Por favor, solicite ayuda al personal del establecimiento."}:(null==(a=e.message)?void 0:a.includes("table_silenced"))?m.errorMessage={title:"Mesa temporalmente silenciada",description:"Su mesa está temporalmente silenciada. Inténtelo de nuevo en unos minutos."}:m.errorMessage={title:"Error en la conexión",description:"No pudimos procesar su solicitud. Verifique su conexión a internet e inténtelo nuevamente."},p("call-status-change","error")},T=()=>{x(),P(),m.callState="idle",m.currentCallId=null,m.waitTimeSeconds=0,m.errorMessage={},p("call-status-change","idle")},N=()=>{x(),m.waitTimer=setInterval(()=>{m.waitTimeSeconds+=1},1e3)},x=()=>{m.waitTimer&&(clearInterval(m.waitTimer),m.waitTimer=null)},A=()=>{window.addEventListener("waiter-call-acknowledged",R),window.addEventListener("waiter-call-completed",D)},P=()=>{window.removeEventListener("waiter-call-acknowledged",R),window.removeEventListener("waiter-call-completed",D)},R=e=>{console.log("✅ Waiter acknowledged call:",e.detail),e.detail.call_id===m.currentCallId&&(x(),m.callState="acknowledged",p("call-status-change","acknowledged"))},D=e=>{console.log("✅ Waiter completed call:",e.detail),e.detail.call_id===m.currentCallId&&T()};return i(()=>{console.log("🔔 CallWaiterButton mounted",{tableId:n.tableId,businessId:n.businessId,tableNumber:n.tableNumber})}),s(()=>{x(),P()}),(e,t)=>(r(),o("div",mN,["idle"===f.value?(r(),o("div",fN,[t[5]||(t[5]=l("div",{class:"call-info"},[l("h3",null,[l("i",{class:"fas fa-concierge-bell"}),v(" ¿Necesitas ayuda? ")]),l("p",null,"Presiona el botón para llamar a tu mozo")],-1)),l("button",{onClick:C,class:"call-button primary",disabled:g.value},[l("i",{class:u(["fas fa-bell",{"fa-spin":g.value}])},null,2),g.value?(r(),o("span",bN,"Conectando...")):(r(),o("span",vN,"Llamar Mozo"))],8,gN)])):"calling"===f.value?(r(),o("div",wN,t[6]||(t[6]=[l("div",{class:"call-status-card"},[l("div",{class:"status-icon calling"},[l("i",{class:"fas fa-paper-plane"})]),l("h3",null,"Llamando mozo..."),l("p",null,"Estamos notificando a tu mozo"),l("div",{class:"loading-dots"},[l("span"),l("span"),l("span")])],-1)]))):"waiting"===f.value?(r(),o("div",yN,[l("div",_N,[t[9]||(t[9]=l("div",{class:"status-icon waiting"},[l("i",{class:"fas fa-clock"})],-1)),t[10]||(t[10]=l("h3",null,"¡Mozo notificado!",-1)),t[11]||(t[11]=l("p",null,"Aguarde por favor, su mozo fue notificado y lo atenderá en breve",-1)),l("div",CN,[t[7]||(t[7]=l("i",{class:"fas fa-hourglass-half"},null,-1)),l("span",null,"Tiempo de espera: "+d(_.value),1)]),w.value>120?(r(),o("button",{key:0,onClick:k,class:"call-button urgent"},t[8]||(t[8]=[l("i",{class:"fas fa-exclamation-triangle"},null,-1),v(" Llamar urgente ")]))):c("",!0)])])):"acknowledged"===f.value?(r(),o("div",kN,[l("div",{class:"call-status-card success"},[t[13]||(t[13]=l("div",{class:"status-icon acknowledged"},[l("i",{class:"fas fa-check"})],-1)),t[14]||(t[14]=l("h3",null,"¡Mozo en camino!",-1)),t[15]||(t[15]=l("p",null,"Su mozo confirmó la llamada y se dirige a su mesa",-1)),l("button",{onClick:T,class:"call-button secondary"},t[12]||(t[12]=[l("i",{class:"fas fa-redo"},null,-1),v(" Nueva solicitud ")]))])])):"error"===f.value?(r(),o("div",EN,[l("div",SN,[t[17]||(t[17]=l("div",{class:"status-icon error"},[l("i",{class:"fas fa-exclamation-triangle"})],-1)),l("h3",null,d(y.value.title||"Error en la llamada"),1),l("p",null,d(y.value.description||"No pudimos contactar con su mozo. Intente nuevamente."),1),l("button",{onClick:T,class:"call-button primary"},t[16]||(t[16]=[l("i",{class:"fas fa-redo"},null,-1),v(" Intentar nuevamente ")]))])])):c("",!0),b.value?(r(),o("div",{key:5,class:"urgency-modal-overlay",onClick:t[4]||(t[4]=e=>b.value=!1)},[l("div",{class:"urgency-modal",onClick:t[3]||(t[3]=h(()=>{},["stop"]))},[t[20]||(t[20]=l("h4",null,"Tipo de solicitud",-1)),l("div",TN,[l("button",{onClick:t[0]||(t[0]=e=>E("normal")),class:"urgency-option normal"},t[18]||(t[18]=[l("i",{class:"fas fa-bell"},null,-1),l("span",null,"Normal",-1),l("small",null,"Solicitud general",-1)])),l("button",{onClick:t[1]||(t[1]=e=>E("urgent")),class:"urgency-option urgent"},t[19]||(t[19]=[l("i",{class:"fas fa-exclamation-triangle"},null,-1),l("span",null,"Urgente",-1),l("small",null,"Necesito atención inmediata",-1)]))]),l("button",{onClick:t[2]||(t[2]=e=>b.value=!1),class:"cancel-btn"}," Cancelar ")])])):c("",!0)]))}},[["__scopeId","data-v-28254294"]]),NN={class:"menu-table-page"},xN={class:"business-header"},AN={class:"business-info"},PN={key:0,class:"business-logo"},RN=["src","alt"],DN={class:"business-details"},MN={class:"table-info"},LN={key:0,class:"business-address"},ON={class:"main-content"},FN={class:"menu-section"},UN={key:0,class:"loading-state"},BN={key:1,class:"error-state"},qN={key:2,class:"pdf-container"},jN=["src"],$N={class:"pdf-actions"},zN=["href"],VN={key:3,class:"no-menu-state"},WN={class:"waiter-call-section"},HN={class:"page-footer"},GN={class:"app-branding"},YN={class:"version"},KN=ar({__name:"MenuTable",setup(e){const t=b(),s=a(()=>t.params.tableId),u=a(()=>t.query.business_id),h=a(()=>t.query.table_number||s.value),p=I({businessData:{},menuPdfUrl:null,loadingMenu:!0,loadingBusiness:!0,menuError:!1,businessError:!1,callStatus:"idle"}),m=a(()=>p.businessData),g=a(()=>p.menuPdfUrl),w=a(()=>p.loadingMenu),y=a(()=>p.menuError),_=async()=>{if(u.value)try{p.loadingBusiness=!0,p.businessError=!1;const e=await Ia.get(`/public/business/${u.value}`);if(!e.data.success)throw new Error(e.data.message||"Error loading business info");p.businessData=e.data.business,console.log("✅ Business info loaded:",p.businessData)}catch(e){console.error("❌ Error loading business info:",e),p.businessError=!0,p.businessData={name:"Restaurante",address:null,logo:null}}finally{p.loadingBusiness=!1}else console.error("Business ID not provided")},C=async()=>{if(!u.value)return console.error("Business ID not provided for menu"),void(p.loadingMenu=!1);try{p.loadingMenu=!0,p.menuError=!1;const e=await Ia.get(`/public/business/${u.value}/menu`);e.data.success&&e.data.menu_pdf_url?(p.menuPdfUrl=e.data.menu_pdf_url,console.log("✅ Menu PDF loaded:",p.menuPdfUrl)):(console.warn("⚠️ No menu available for this business"),p.menuPdfUrl=null)}catch(e){console.error("❌ Error loading menu:",e),p.menuError=!0}finally{p.loadingMenu=!1}},k=e=>{p.callStatus=e,console.log("📱 Call status changed:",e)};return i(async()=>{console.log("🏠 MenuTable mounted",{tableId:s.value,businessId:u.value,tableNumber:h.value}),s.value&&u.value?await Promise.all([_(),C()]):console.error("❌ Missing required parameters")}),(e,t)=>(r(),o("div",NN,[l("div",xN,[l("div",AN,[m.value.logo?(r(),o("div",PN,[l("img",{src:m.value.logo,alt:m.value.name},null,8,RN)])):c("",!0),l("div",DN,[l("h1",null,d(m.value.name||"Bienvenido"),1),l("div",MN,[t[0]||(t[0]=l("i",{class:"fas fa-table"},null,-1)),l("span",null,"Mesa "+d(h.value),1)]),m.value.address?(r(),o("div",LN,[t[1]||(t[1]=l("i",{class:"fas fa-map-marker-alt"},null,-1)),l("span",null,d(m.value.address),1)])):c("",!0)])])]),l("div",ON,[l("div",FN,[t[8]||(t[8]=l("div",{class:"section-header"},[l("h2",null,[l("i",{class:"fas fa-utensils"}),v(" Nuestro Menú ")])],-1)),w.value?(r(),o("div",UN,t[2]||(t[2]=[l("div",{class:"spinner"},null,-1),l("p",null,"Cargando menú...",-1)]))):y.value?(r(),o("div",BN,[t[4]||(t[4]=l("i",{class:"fas fa-exclamation-triangle"},null,-1)),t[5]||(t[5]=l("p",null,"No pudimos cargar el menú",-1)),l("button",{onClick:C,class:"retry-btn"},t[3]||(t[3]=[l("i",{class:"fas fa-refresh"},null,-1),v(" Reintentar ")]))])):g.value?(r(),o("div",qN,[l("iframe",{src:g.value,class:"pdf-viewer",title:"Menú del restaurante",frameborder:"0"},null,8,jN),l("div",$N,[l("a",{href:g.value,target:"_blank",class:"pdf-action-btn"},t[6]||(t[6]=[l("i",{class:"fas fa-external-link-alt"},null,-1),v(" Ver menú completo ")]),8,zN)])])):(r(),o("div",VN,t[7]||(t[7]=[l("i",{class:"fas fa-file-pdf"},null,-1),l("p",null,"Menú no disponible temporalmente",-1),l("small",null,"Consulte con el personal del establecimiento",-1)])))]),l("div",WN,[f(IN,{"table-id":s.value,"business-id":u.value,"table-number":h.value,onCallStatusChange:k},null,8,["table-id","business-id","table-number"])])]),l("div",HN,[l("div",GN,[t[9]||(t[9]=l("span",null,"Powered by",-1)),t[10]||(t[10]=l("strong",null,"MozoApp",-1)),l("span",YN,d(n(Ar)()),1)])])]))}},[["__scopeId","data-v-eae715a0"]]),QN=L({history:O("/"),routes:[{path:"/",name:"root",beforeEnter:(e,t,a)=>{const n=Ya(),{isAuthenticated:i,currentRole:s}=F(n);if(i.value){return a({name:"waiter"===(s.value||"admin")?"waiter-dashboard":"admin"})}return a({name:"login"})}},{path:"/login",name:"login",component:Qr,meta:{requiresGuest:!0}},{path:"/register",name:"register",component:ml,meta:{requiresGuest:!0}},{path:"/forgot-password",name:"forgot-password",component:Sl,meta:{requiresGuest:!0}},{path:"/reset-password",name:"reset-password",component:zl,meta:{requiresGuest:!0}},{path:"/role-selection",name:"role-selection",component:Zl,meta:{requiresAuth:!0}},{path:"/waiter/dashboard",name:"waiter-dashboard",component:gy,meta:{requiresAuth:!0,role:"waiter"}},{path:"/waiter/onboard",name:"waiter-onboard",component:S_,meta:{requiresAuth:!0,role:"waiter"}},{path:"/profile",name:"profile",component:m_,meta:{requiresAuth:!0}},{path:"/admin",name:"admin",component:K_,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/home",name:"admin-home",component:lC,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/qr",name:"admin-qr",component:wk,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/stats",name:"admin-stats",component:_k,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/staff",name:"admin-staff",component:FE,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/staff/:id",name:"admin-staff-detail",component:nT,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/profile",name:"admin-profile",component:jT,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/settings",name:"admin-settings",component:kI,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/notification-debug",name:"admin-notification-debug",component:pN,meta:{requiresAuth:!0,role:"admin"}},{path:"/menu/mesa/:tableId",name:"menu-table",component:KN,meta:{isPublic:!0}},{path:"/:pathMatch(.*)*",redirect:"/"}]});QN.beforeEach(async(e,t,a)=>{const n=Ya(),{isAuthenticated:i}=F(n);if(e.meta.isPublic)return a();i.value&&!n.user&&await n.fetchUser(),a()});const JN=K("PushNotifications",{}),ZN={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_DEBUG_MODE:"true",VITE_FIREBASE_ANDROID_APP_ID:"1:175482362472:android:f2589ca9ec71fd0cb6b9dd",VITE_FIREBASE_API_KEY:"AIzaSyBlupKSIy7qtTsXukqROyVjMNx03X8CCzU",VITE_FIREBASE_APP_ID:"1:175482362472:web:308070c885bacc71b6b9dd",VITE_FIREBASE_AUTH_DOMAIN:"mozoqr-7d32c.firebaseapp.com",VITE_FIREBASE_DATABASE_URL:"https://mozoqr-7d32c-default-rtdb.firebaseio.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"175482362472",VITE_FIREBASE_PROJECT_ID:"mozoqr-7d32c",VITE_FIREBASE_STORAGE_BUCKET:"mozoqr-7d32c.firebasestorage.app",VITE_FIREBASE_VAPID_KEY:"BNJgpNkgB0a0y7gHT-SNBFLMGIZw-Xx8NTBDCn_4dVqekzgmnGmKMIn10t-6gWl3Qj_msyCcfbsVycnAp8USs6M",VITE_MEASUREMENT_ID:"G-6N7J4X94DH",VITE_PUSHER_APP_CLUSTER:"us2",VITE_PUSHER_APP_KEY:"bd06ab967cc733531514",VITE_QR_BASE_URL:"https://mozoqr.com",VITE_URL_API:"https://mozoqr.com/api/"},XN=t({configured:!1,tokenExists:!1}),ex=async()=>{if(!Y.isPluginAvailable("PushNotifications"))return{available:!1,reason:"Plugin no disponible"};try{const e=await JN.checkPermissions(),t=localStorage.getItem("fcm_token");return{available:!0,permissions:e.receive,hasToken:!!t,token:t?`${t.substring(0,20)}...`:null,platform:Y.getPlatform()}}catch(e){return{available:!1,reason:e.message}}},tx=()=>{const e=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_PROJECT_ID"].filter(e=>!ZN[e]);return{configured:0===e.length,missing:e,config:{apiKey:"Configurada",projectId:"Configurada"}}};(async()=>{try{if(Y.isPluginAvailable&&Y.isPluginAvailable("LocalNotifications")){const t=(await z(()=>import("./index-BoVJG3f6.js"),__vite__mapDeps([7,1,2]))).LocalNotifications;try{t&&t.createChannel&&(await t.createChannel({id:"mozo_waiter",name:"Mozo - Llamadas",importance:5,visibility:1,description:"Notificaciones de llamadas y eventos importantes para mozos"}),console.log("✅ Canal mozo_waiter creado al importar pushNotifications"))}catch(e){console.warn("⚠️ Error creando canal mozo_waiter al importar:",e)}}}catch(e){console.warn("⚠️ No se pudo crear canal mozo_waiter al importar pushNotifications:",e)}})();const ax=async()=>{console.log("🔔 Inicializando sistema de notificaciones push...");const e=Y.getPlatform();console.log("🔔 Plataforma detectada:",e),await(async()=>{if(console.log("🔔 Setting up push notification listeners..."),"web"===Y.getPlatform())try{return console.log("🔔 Setting up Firebase listeners for web..."),await ja.setupForegroundMessageListener(e=>{console.log("🚨 FCM NOTIFICATION RECEIVED IN REAL-TIME:",e),console.log("⏰ Received at:",(new Date).toLocaleTimeString()),z(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>tr);return{useNotificationsStore:e}},void 0).then(({useNotificationsStore:t})=>{var a,n,i,s;const o=t(),r=(null==(a=e.data)?void 0:a.call_id)||(null==(n=e.data)?void 0:n.callId)||(null==(i=e.data)?void 0:i.callID)||null,l={id:r||`fcm-${Date.now()}`,type:(null==(s=e.data)?void 0:s.type)||(r?"waiter_call":"FCMNotification"),data:{title:e.title,message:e.body,...e.data},created_at:(new Date).toISOString(),read_at:null,source:"fcm-realtime"};try{if(r&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls&&window.ultraFastNotifications.activeCalls.has(r))return void console.log("🔍 Skipping FCM store add for call already in UltraFast activeCalls:",r)}catch(c){console.warn("⚠️ Error checking ultraFastNotifications activeCalls for dedupe:",c)}console.log("📨 Adding notification to store:",l),r&&(o.waiterUnreadNotifications.find(e=>e.id===r)||o.unreadNotifications.find(e=>e.id===r))?console.log("🔁 Duplicate notification skipped (canonicalCallId):",r):(o.addNewNotification(l),console.log("✅ Notification added to reactive store!"))}).catch(e=>{console.error("❌ Error importing notifications store:",e)})}),void console.log("✅ Firebase listeners configured for web")}catch(e){return void console.error("❌ Error setting up Firebase listeners:",e)}if(Y.isPluginAvailable("PushNotifications"))try{JN.addListener("registration",async t=>{var a,n,i,s;console.log("✅ Push registration success, token:",t.value),localStorage.setItem("fcm_token",t.value);let o=0;const r=e=>new Promise(t=>setTimeout(t,e));for(;o<5;)try{const e=Ya();if(console.log("🔔 Intento de envío de token - intento",o+1,"authState:",{isAuthenticated:e.isAuthenticated,userId:null==(a=e.user)?void 0:a.id}),e.isAuthenticated&&(null==(n=e.user)?void 0:n.id)){const a=Y.getPlatform();console.log("🔔 Enviando token al backend (móvil):",{token:t.value.substring(0,20)+"...",platform:a,userId:null==(i=e.user)?void 0:i.id});const n=await Na.storeDeviceToken(t.value,a,null==(s=e.user)?void 0:s.id);console.log("✅ Device token stored successfully (móvil):",n);break}o++,console.log("⚠️ Usuario no autenticado aún, reintentando en 500ms..."),await r(500);continue}catch(e){console.error("❌ Error intentando enviar token (móvil):",e),o++,await r(500)}5===o&&console.warn("⚠️ No se pudo enviar token al backend después de varios intentos. Se dejó guardado localmente.")}),JN.addListener("registrationError",e=>{console.error("❌ Error on registration:",JSON.stringify(e))}),JN.addListener("pushNotificationReceived",e=>{var t,a,n;const i=(null==(t=e.android)?void 0:t.priority)||(null==(a=e.data)?void 0:a.priority)||"unknown",s=(null==(n=e.data)?void 0:n.status)||"unknown";if(console.log(`🔔 Push received - Priority: ${i}, Status: ${s}`),console.log("🔔 Full notification:",JSON.stringify(e,null,2)),nx(`📨 Push: ${i}/${s}`),ix(e))return console.log(`🚫 Notificación filtrada - Priority: ${i}, Status: ${s}`),void nx(`🚫 FILTRADA: ${i}/${s}`);console.log(`✅ Notificación permitida - Priority: ${i}, Status: ${s}`),nx(`✅ PERMITIDA: ${i}/${s}`);const o=sx(e);Y.isPluginAvailable("LocalNotifications")?z(async()=>{const{LocalNotifications:e}=await import("./index-BoVJG3f6.js");return{LocalNotifications:e}},__vite__mapDeps([7,1,2])).then(({LocalNotifications:e})=>{e.schedule({notifications:[{title:o.title,body:o.body,id:(new Date).getTime(),sound:null,actionTypeId:"OPEN_APP",extra:{...o.data,receivedAt:(new Date).toISOString(),source:"push-foreground"}}]}).catch(e=>{console.error("❌ Error programando notificación local:",e)})}).catch(e=>{console.error("❌ Error importando LocalNotifications:",e)}):"Notification"in window&&"granted"===Notification.permission&&new Notification(o.title,{body:o.body,icon:"/favicon.ico",tag:"push-notification",data:o.data})}),JN.addListener("pushNotificationActionPerformed",e=>{console.log("🔔 Push action performed:",JSON.stringify(e,null,2));const t=e.notification.data;t&&t.route&&console.log("🔔 Navegando a:",t.route)}),console.log("✅ Listeners de notificaciones configurados correctamente")}catch(e){console.error("❌ Error configurando listeners:",e)}else console.log("⚠️ Plugin PushNotifications no disponible para listeners")})();const t=await(async()=>{var e;console.log("🔔 Starting push notification registration...");const t=Y.getPlatform(),a=Y.isNativePlatform();if(console.log("🔔 DETECTED - Platform:",t,"Native:",a),"web"===t&&!a)try{if(console.log("🔔 Web platform detected, using Firebase FCM..."),!(await ja.initializeFirebase()))return{success:!1,error:"Firebase initialization failed"};const t=await ja.getFCMToken();console.log("🔔 FCM token obtained for web:",t.substring(0,20)+"..."),localStorage.setItem("fcm_token",t);const a=Ya();if(a.isAuthenticated)try{const n=await Na.storeDeviceToken(t,"web",null==(e=a.user)?void 0:e.id);console.log("✅ Device token stored:",n),XN.value={configured:!0,tokenExists:!0}}catch(n){console.error("❌ Error storing device token:",n)}else console.warn("⚠️ User not authenticated - token not sent to server");return{success:!0,token:t}}catch(n){return console.error("❌ FCM registration error:",n),{success:!1,error:n.message}}try{if(console.log("🔔 MOBILE: Starting Capacitor push notification registration..."),console.log("🔔 MOBILE: Platform:",Y.getPlatform()),console.log("🔔 MOBILE: Native platform:",Y.isNativePlatform()),!Y.isPluginAvailable("PushNotifications"))return console.warn("⚠️ Plugin PushNotifications no disponible para registro (móvil)"),{success:!1,error:"PushNotifications plugin not available"};console.log("✅ MOBILE: PushNotifications plugin available");try{console.log("🔔 MOBILE: Requesting push permissions...");const e=await JN.requestPermissions();if(console.log("🔔 MOBILE: Push permission result:",e),e&&"denied"===e.receive)return console.error("❌ MOBILE: Push permissions DENIED"),{success:!1,error:"Push permissions denied"};console.log("✅ MOBILE: Push permissions OK")}catch(i){console.warn("⚠️ MOBILE: Error requesting push permissions:",i)}return console.log("🔔 MOBILE: Calling PushNotifications.register()..."),await JN.register(),console.log("✅ MOBILE: PushNotifications.register() completed"),{success:!0,token:null}}catch(n){return console.error("❌ Mobile push registration error:",n),{success:!1,error:n.message}}})();Y.isPluginAvailable&&Y.isPluginAvailable("LocalNotifications")&&z(async()=>{const{LocalNotifications:e}=await import("./index-BoVJG3f6.js");return{LocalNotifications:e}},__vite__mapDeps([7,1,2])).then(({LocalNotifications:e})=>{try{e&&e.createChannel&&e.createChannel({id:"mozo_waiter",name:"Mozo - Llamadas",importance:5,visibility:1,description:"Notificaciones de llamadas y eventos importantes para mozos"}).then(()=>{console.log("✅ Canal de notificaciones Android creado: mozo_waiter")}).catch(e=>{console.warn("⚠️ Error creando canal LocalNotifications:",e)})}catch(t){console.warn("⚠️ Excepción creando canal LocalNotifications:",t)}}).catch(e=>{console.warn("⚠️ No se pudo importar LocalNotifications para crear canal:",e)});const a=await ex(),n=tx(),i=ja.getFirebaseStatus();return console.log("🔔 Estado final de notificaciones:",{platform:e,registration:t,status:a,firebase:n,firebaseStatus:i}),{platform:e,registration:t,status:a,firebase:n,firebaseStatus:i}},nx=e=>{try{const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      top: 50px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: rgba(0,0,0,0.9);\n      color: white;\n      padding: 12px 20px;\n      border-radius: 8px;\n      z-index: 10000;\n      font-size: 14px;\n      font-weight: bold;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.5);\n      max-width: 90%;\n      text-align: center;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.parentElement&&t.remove()},3e3)}catch(t){console.warn("Toast debug failed:",t)}},ix=e=>{try{if(!e.data)return!1;const t="string"==typeof e.data?JSON.parse(e.data):e.data;return"acknowledged"===t.status||"completed"===t.status?(console.log("🚫 Filtrando actualización de estado:",t.status),!0):e.android&&"normal"===e.android.priority?(console.log("🚫 Filtrando notificación de prioridad normal (posible confirmación)"),!0):"normal"===t.priority&&"new_call"!==t.type&&(console.log("🚫 Filtrando notificación normal que no es llamada nueva"),!0)}catch(t){return console.warn("⚠️ Error filtering notification:",t),!1}},sx=e=>{console.log("🔄 Procesando notificación del backend...");let t={title:e.title||"Nueva notificación",body:e.body||"Tienes una nueva notificación",data:e.data||{}};if(e.data){const a="string"==typeof e.data?JSON.parse(e.data):e.data;switch(console.log("🔄 Datos de notificación:",a),a.type){case"TestNotification":t={title:"Notificación de Prueba",body:"Esta es una notificación de prueba enviada a todos los usuarios del negocio",data:{...a,icon:"🧪",priority:"normal",channels:["Database","Broadcast","FCM"]}};break;case"UserSpecificNotification":t={title:a.title||"Notificación Personalizada",body:a.message||"Tienes una nueva notificación personalizada",data:{...a,icon:"👤",priority:"high",channels:["Database","Broadcast","FCM"]}};break;case"WebSocketTestNotification":t={title:"⚡ Prueba WebSocket + FCM",body:"Esta notificación llega por WebSocket (tiempo real) y FCM (push)",data:{...a,icon:"⚡",priority:"high",test_mode:"websocket_fcm"}};break;case"WebSocketOnlyNotification":t={title:"🔌 Prueba Solo WebSocket",body:"Esta notificación SOLO llega por WebSocket en tiempo real",data:{...a,icon:"🔌",priority:"normal",test_mode:"websocket_only"}};break;default:e.title&&e.body&&(t={title:e.title,body:e.body,data:{...a,icon:"📱",priority:"normal"}})}}return console.log("✅ Notificación procesada:",t),t},ox=Object.freeze(Object.defineProperty({__proto__:null,checkFirebaseConfig:tx,fcmStatus:XN,getNotificationStatus:ex,initializePushNotifications:ax},Symbol.toStringTag,{value:"Module"}));const rx=U(Lr),lx=B();rx.use(lx),rx.use(QN),rx.mount("#app"),"undefined"!=typeof window&&navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",e=>{if(!e.data||"fcm_event"!==e.data.type)return;const t=e.data.payload.data||{},a=j(),n=t.call_id||t.callId;var i;n&&(a.has(n)||a.upsert({id:n,table_id:t.table_id,table_number:t.table_number,status:t.status||(i=t.type,"new_call"===i?"pending":"acknowledged"===i?"acknowledged":"completed"===i?"completed":"pending"),urgency:t.urgency,called_at:t.timestamp||Date.now(),last_updated:Date.now(),event_type:t.type||"event"}))});const cx=(()=>{try{if(!window.Capacitor)return!1;if("function"==typeof window.Capacitor.isNativePlatform)return window.Capacitor.isNativePlatform();if("function"==typeof window.Capacitor.getPlatform){const e=window.Capacitor.getPlatform();return"android"===e||"ios"===e}return!1}catch(e){return!1}})();cx&&(console.log("🔔 NATIVE: Inicializando push notifications en startup..."),setTimeout(async()=>{try{await ax()}catch(e){console.error("❌ Error inicializando push notifications en native:",e)}},1e3)),!cx&&"serviceWorker"in navigator&&navigator.serviceWorker.register("/firebase-messaging-sw.js").then(e=>console.log("Service Worker registrado:",e.scope)).catch(e=>console.warn("No se pudo registrar el Service Worker:",e)),cx?console.log("Saltando runNotificationDiagnostics en entorno nativo"):async function(){console.group("[NotificationDiagnostics] Iniciando diagnóstico de notificaciones");try{if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.getRegistration("/firebase-messaging-sw.js");e?(console.log("[NotificationDiagnostics] Service Worker registrado. Scope:",e.scope),console.log("[NotificationDiagnostics] Service Worker active state:",e.active?e.active.state:"no active")):console.warn("[NotificationDiagnostics] Service Worker /firebase-messaging-sw.js NO registrado")}catch(e){console.warn("[NotificationDiagnostics] Error comprobando Service Worker:",e)}else console.warn("[NotificationDiagnostics] Service Workers no soportados en este navegador");const n="undefined"!=typeof Notification?Notification.permission:"unsupported";console.log("[NotificationDiagnostics] Permission:",n);const i=localStorage.getItem("fcm_token");if(console.log("[NotificationDiagnostics] fcm_token en localStorage:",i?`${i.substring(0,20)}...`:"no encontrado"),"denied"===n)console.warn("[NotificationDiagnostics] Permisos DENEGADOS - no se intentará obtener token");else try{if("default"===n){console.log("[NotificationDiagnostics] Solicitando permiso de notificaciones...");const e=await Notification.requestPermission();if(console.log("[NotificationDiagnostics] Resultado requestPermission():",e),"granted"!==e)return console.warn("[NotificationDiagnostics] Permiso no concedido; abortando obtención de token"),void console.groupEnd()}if(console.log("[NotificationDiagnostics] Inicializando Firebase y solicitando token..."),await ja.initializeFirebase())try{const e=await ja.getFCMToken();if(console.log("[NotificationDiagnostics] FCM token obtenido:",e?`${e.substring(0,20)}...`:"no token"),e&&localStorage.setItem("fcm_token",e),localStorage.getItem("token"))try{console.log("[NotificationDiagnostics] Intentando enviar token al backend (prueba) con platform=web..."),await Na.storeDeviceToken(e,"web"),console.log("[NotificationDiagnostics] Intento de registro en backend: OK (verificar en DB)")}catch(t){console.warn("[NotificationDiagnostics] Error enviando token al backend:",(null==t?void 0:t.message)||t)}else console.log("[NotificationDiagnostics] No hay auth token en localStorage; no se enviará token al backend")}catch(a){console.warn("[NotificationDiagnostics] Error obteniendo FCM token:",(null==a?void 0:a.message)||a)}else console.warn("[NotificationDiagnostics] No se pudo inicializar Firebase (revisar variables env y SW)")}catch(e){console.warn("[NotificationDiagnostics] Error durante diagnóstico FCM:",e)}}finally{console.groupEnd()}}().catch(e=>console.warn("Error ejecutando diagnósticos de notificación:",e));export{Wc as C,Qd as D,Ac as E,xc as F,td as L,ru as S,Q as W,tu as _,Zd as a,eu as b,nu as c,iu as d,au as e,Xd as f,cu as g,K as h,lu as i,z as j,Vc as k,Tc as l,Nc as m,fd as n,md as o,gc as p,wc as q,du as r,yc as s,Bc as t,Ec as u,Ic as v,_c as w,Kc as x,Or as y};
