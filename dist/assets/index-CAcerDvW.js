const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/echo-CsrB9MK9.js","assets/vendor-DPnOlTVy.js","assets/bootstrap--QliLv9A.js","assets/index.esm-CWP_HgUh.js","assets/index.esm-PpI2LJYX.js","assets/index.esm-B4WFe6kg.js","assets/staffRealtime-CQQLemJX.js","assets/web-B9FgIizL.js","assets/web-BoasosxK.js","assets/index-F8_fAb3q.js","assets/JoinStaff-CfbO3qEg.js","assets/JoinStaff-BT0k6x4w.css","assets/Completeness-BbP7MUeN.js","assets/Completeness-CbHRmKuw.css","assets/redirectResultHandler-Ci_IUV6f.js","assets/androidFCM-DnXR5pmY.js"])))=>i.map(i=>d[i]);
var e;import{k as t,r as a,l as n,d as i,c as s,a as o,b as r,t as l,m as c,p as d,v as u,f as h,q as p,w as m,s as f,e as v,o as g,g as b,h as w,u as y,F as _,i as k,n as C,x as E,y as I,z as S,T,A as N,B as A,C as P,D as R,E as x,G as D,H as O,I as L,j as M,J as U,K as F,L as q,M as B,N as j,O as $,P as z,Q as V}from"./vendor-DPnOlTVy.js";import{M as W}from"./bootstrap--QliLv9A.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const H={},G=function(e,t,a){let n=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=(null==a?void 0:a.nonce)||(null==a?void 0:a.getAttribute("nonce"));n=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in H)return;H[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,i&&n.setAttribute("nonce",i),document.head.appendChild(n),t?new Promise((t,a)=>{n.addEventListener("load",t),n.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)})},K=t("calls",{state:()=>({calls:{},waiterActiveIds:[],businessActiveIds:[],stats:{pending_count:0,total_active_calls:0},initialized:!1,loading:!1,lastSync:null}),getters:{list:e=>Object.values(e.calls).sort((e,t)=>(t.called_at||0)-(e.called_at||0)),pending:e=>Object.values(e.calls).filter(e=>"pending"===e.status),acknowledged:e=>Object.values(e.calls).filter(e=>"acknowledged"===e.status),active:e=>Object.values(e.calls).filter(e=>"completed"!==e.status),has:e=>t=>!!e.calls[t]},actions:{upsert(e){if(!e||!e.id)return;const t=this.calls[e.id];if(t){const a={pending:1,acknowledged:2,completed:3};if(a[e.status]<a[t.status])return}this.calls[e.id]={...t||{},...e},this.lastSync=Date.now()},remove(e){this.calls[e]&&delete this.calls[e]},setWaiterActive(e){this.waiterActiveIds=e||[]},updateStats(e){this.stats={...this.stats,...e||{}}},markInitialized(){this.initialized=!0}}});function J(e,t){return function(){return e.apply(t,arguments)}}const{toString:Y}=Object.prototype,{getPrototypeOf:Q}=Object,{iterator:Z,toStringTag:X}=Symbol,ee=(e=>t=>{const a=Y.call(t);return e[a]||(e[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),te=e=>(e=e.toLowerCase(),t=>ee(t)===e),ae=e=>t=>typeof t===e,{isArray:ne}=Array,ie=ae("undefined");const se=te("ArrayBuffer");const oe=ae("string"),re=ae("function"),le=ae("number"),ce=e=>null!==e&&"object"==typeof e,de=e=>{if("object"!==ee(e))return!1;const t=Q(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||X in e||Z in e)},ue=te("Date"),he=te("File"),pe=te("Blob"),me=te("FileList"),fe=te("URLSearchParams"),[ve,ge,be,we]=["ReadableStream","Request","Response","Headers"].map(te);function ye(e,t,{allOwnKeys:a=!1}={}){if(null==e)return;let n,i;if("object"!=typeof e&&(e=[e]),ne(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const i=a?Object.getOwnPropertyNames(e):Object.keys(e),s=i.length;let o;for(n=0;n<s;n++)o=i[n],t.call(null,e[o],o,e)}}function _e(e,t){t=t.toLowerCase();const a=Object.keys(e);let n,i=a.length;for(;i-- >0;)if(n=a[i],t===n.toLowerCase())return n;return null}const ke="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Ce=e=>!ie(e)&&e!==ke;const Ee=(e=>t=>e&&t instanceof e)("undefined"!=typeof Uint8Array&&Q(Uint8Array)),Ie=te("HTMLFormElement"),Se=(({hasOwnProperty:e})=>(t,a)=>e.call(t,a))(Object.prototype),Te=te("RegExp"),Ne=(e,t)=>{const a=Object.getOwnPropertyDescriptors(e),n={};ye(a,(a,i)=>{let s;!1!==(s=t(a,i,e))&&(n[i]=s||a)}),Object.defineProperties(e,n)};const Ae=te("AsyncFunction"),Pe=(Re="function"==typeof setImmediate,xe=re(ke.postMessage),Re?setImmediate:xe?(De=`axios@${Math.random()}`,Oe=[],ke.addEventListener("message",({source:e,data:t})=>{e===ke&&t===De&&Oe.length&&Oe.shift()()},!1),e=>{Oe.push(e),ke.postMessage(De,"*")}):e=>setTimeout(e));var Re,xe,De,Oe;const Le="undefined"!=typeof queueMicrotask?queueMicrotask.bind(ke):"undefined"!=typeof process&&process.nextTick||Pe,Me={isArray:ne,isArrayBuffer:se,isBuffer:function(e){return null!==e&&!ie(e)&&null!==e.constructor&&!ie(e.constructor)&&re(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||re(e.append)&&("formdata"===(t=ee(e))||"object"===t&&re(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&se(e.buffer),t},isString:oe,isNumber:le,isBoolean:e=>!0===e||!1===e,isObject:ce,isPlainObject:de,isReadableStream:ve,isRequest:ge,isResponse:be,isHeaders:we,isUndefined:ie,isDate:ue,isFile:he,isBlob:pe,isRegExp:Te,isFunction:re,isStream:e=>ce(e)&&re(e.pipe),isURLSearchParams:fe,isTypedArray:Ee,isFileList:me,forEach:ye,merge:function e(){const{caseless:t}=Ce(this)&&this||{},a={},n=(n,i)=>{const s=t&&_e(a,i)||i;de(a[s])&&de(n)?a[s]=e(a[s],n):de(n)?a[s]=e({},n):ne(n)?a[s]=n.slice():a[s]=n};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&ye(arguments[i],n);return a},extend:(e,t,a,{allOwnKeys:n}={})=>(ye(t,(t,n)=>{a&&re(t)?e[n]=J(t,a):e[n]=t},{allOwnKeys:n}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,a,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),a&&Object.assign(e.prototype,a)},toFlatObject:(e,t,a,n)=>{let i,s,o;const r={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)o=i[s],n&&!n(o,e,t)||r[o]||(t[o]=e[o],r[o]=!0);e=!1!==a&&Q(e)}while(e&&(!a||a(e,t))&&e!==Object.prototype);return t},kindOf:ee,kindOfTest:te,endsWith:(e,t,a)=>{e=String(e),(void 0===a||a>e.length)&&(a=e.length),a-=t.length;const n=e.indexOf(t,a);return-1!==n&&n===a},toArray:e=>{if(!e)return null;if(ne(e))return e;let t=e.length;if(!le(t))return null;const a=new Array(t);for(;t-- >0;)a[t]=e[t];return a},forEachEntry:(e,t)=>{const a=(e&&e[Z]).call(e);let n;for(;(n=a.next())&&!n.done;){const a=n.value;t.call(e,a[0],a[1])}},matchAll:(e,t)=>{let a;const n=[];for(;null!==(a=e.exec(t));)n.push(a);return n},isHTMLForm:Ie,hasOwnProperty:Se,hasOwnProp:Se,reduceDescriptors:Ne,freezeMethods:e=>{Ne(e,(t,a)=>{if(re(e)&&-1!==["arguments","caller","callee"].indexOf(a))return!1;const n=e[a];re(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")}))})},toObjectSet:(e,t)=>{const a={},n=e=>{e.forEach(e=>{a[e]=!0})};return ne(e)?n(e):n(String(e).split(t)),a},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,a){return t.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:_e,global:ke,isContextDefined:Ce,isSpecCompliantForm:function(e){return!!(e&&re(e.append)&&"FormData"===e[X]&&e[Z])},toJSONObject:e=>{const t=new Array(10),a=(e,n)=>{if(ce(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const i=ne(e)?[]:{};return ye(e,(e,t)=>{const s=a(e,n+1);!ie(s)&&(i[t]=s)}),t[n]=void 0,i}}return e};return a(e,0)},isAsyncFn:Ae,isThenable:e=>e&&(ce(e)||re(e))&&re(e.then)&&re(e.catch),setImmediate:Pe,asap:Le,isIterable:e=>null!=e&&re(e[Z])};function Ue(e,t,a,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),a&&(this.config=a),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}Me.inherits(Ue,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Me.toJSONObject(this.config),code:this.code,status:this.status}}});const Fe=Ue.prototype,qe={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{qe[e]={value:e}}),Object.defineProperties(Ue,qe),Object.defineProperty(Fe,"isAxiosError",{value:!0}),Ue.from=(e,t,a,n,i,s)=>{const o=Object.create(Fe);return Me.toFlatObject(e,o,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),Ue.call(o,e.message,t,a,n,i),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};function Be(e){return Me.isPlainObject(e)||Me.isArray(e)}function je(e){return Me.endsWith(e,"[]")?e.slice(0,-2):e}function $e(e,t,a){return e?e.concat(t).map(function(e,t){return e=je(e),!a&&t?"["+e+"]":e}).join(a?".":""):t}const ze=Me.toFlatObject(Me,{},null,function(e){return/^is[A-Z]/.test(e)});function Ve(e,t,a){if(!Me.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(a=Me.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!Me.isUndefined(t[e])})).metaTokens,i=a.visitor||c,s=a.dots,o=a.indexes,r=(a.Blob||"undefined"!=typeof Blob&&Blob)&&Me.isSpecCompliantForm(t);if(!Me.isFunction(i))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(Me.isDate(e))return e.toISOString();if(!r&&Me.isBlob(e))throw new Ue("Blob is not supported. Use a Buffer instead.");return Me.isArrayBuffer(e)||Me.isTypedArray(e)?r&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,a,i){let r=e;if(e&&!i&&"object"==typeof e)if(Me.endsWith(a,"{}"))a=n?a:a.slice(0,-2),e=JSON.stringify(e);else if(Me.isArray(e)&&function(e){return Me.isArray(e)&&!e.some(Be)}(e)||(Me.isFileList(e)||Me.endsWith(a,"[]"))&&(r=Me.toArray(e)))return a=je(a),r.forEach(function(e,n){!Me.isUndefined(e)&&null!==e&&t.append(!0===o?$e([a],n,s):null===o?a:a+"[]",l(e))}),!1;return!!Be(e)||(t.append($e(i,a,s),l(e)),!1)}const d=[],u=Object.assign(ze,{defaultVisitor:c,convertValue:l,isVisitable:Be});if(!Me.isObject(e))throw new TypeError("data must be an object");return function e(a,n){if(!Me.isUndefined(a)){if(-1!==d.indexOf(a))throw Error("Circular reference detected in "+n.join("."));d.push(a),Me.forEach(a,function(a,s){!0===(!(Me.isUndefined(a)||null===a)&&i.call(t,a,Me.isString(s)?s.trim():s,n,u))&&e(a,n?n.concat(s):[s])}),d.pop()}}(e),t}function We(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function He(e,t){this._pairs=[],e&&Ve(e,this,t)}const Ge=He.prototype;function Ke(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Je(e,t,a){if(!t)return e;const n=a&&a.encode||Ke;Me.isFunction(a)&&(a={serialize:a});const i=a&&a.serialize;let s;if(s=i?i(t,a):Me.isURLSearchParams(t)?t.toString():new He(t,a).toString(n),s){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}Ge.append=function(e,t){this._pairs.push([e,t])},Ge.toString=function(e){const t=e?function(t){return e.call(this,t,We)}:We;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};class Ye{constructor(){this.handlers=[]}use(e,t,a){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!a&&a.synchronous,runWhen:a?a.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Me.forEach(this.handlers,function(t){null!==t&&e(t)})}}const Qe={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ze={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:He,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Xe="undefined"!=typeof window&&"undefined"!=typeof document,et="object"==typeof navigator&&navigator||void 0,tt=Xe&&(!et||["ReactNative","NativeScript","NS"].indexOf(et.product)<0),at="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,nt=Xe&&window.location.href||"http://localhost",it={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Xe,hasStandardBrowserEnv:tt,hasStandardBrowserWebWorkerEnv:at,navigator:et,origin:nt},Symbol.toStringTag,{value:"Module"})),...Ze};function st(e){function t(e,a,n,i){let s=e[i++];if("__proto__"===s)return!0;const o=Number.isFinite(+s),r=i>=e.length;if(s=!s&&Me.isArray(n)?n.length:s,r)return Me.hasOwnProp(n,s)?n[s]=[n[s],a]:n[s]=a,!o;n[s]&&Me.isObject(n[s])||(n[s]=[]);return t(e,a,n[s],i)&&Me.isArray(n[s])&&(n[s]=function(e){const t={},a=Object.keys(e);let n;const i=a.length;let s;for(n=0;n<i;n++)s=a[n],t[s]=e[s];return t}(n[s])),!o}if(Me.isFormData(e)&&Me.isFunction(e.entries)){const a={};return Me.forEachEntry(e,(e,n)=>{t(function(e){return Me.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),n,a,0)}),a}return null}const ot={transitional:Qe,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const a=t.getContentType()||"",n=a.indexOf("application/json")>-1,i=Me.isObject(e);i&&Me.isHTMLForm(e)&&(e=new FormData(e));if(Me.isFormData(e))return n?JSON.stringify(st(e)):e;if(Me.isArrayBuffer(e)||Me.isBuffer(e)||Me.isStream(e)||Me.isFile(e)||Me.isBlob(e)||Me.isReadableStream(e))return e;if(Me.isArrayBufferView(e))return e.buffer;if(Me.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(a.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Ve(e,new it.classes.URLSearchParams,Object.assign({visitor:function(e,t,a,n){return it.isNode&&Me.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((s=Me.isFileList(e))||a.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Ve(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),function(e,t,a){if(Me.isString(e))try{return(t||JSON.parse)(e),Me.trim(e)}catch(n){if("SyntaxError"!==n.name)throw n}return(a||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||ot.transitional,a=t&&t.forcedJSONParsing,n="json"===this.responseType;if(Me.isResponse(e)||Me.isReadableStream(e))return e;if(e&&Me.isString(e)&&(a&&!this.responseType||n)){const a=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(i){if(a){if("SyntaxError"===i.name)throw Ue.from(i,Ue.ERR_BAD_RESPONSE,this,null,this.response);throw i}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:it.classes.FormData,Blob:it.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Me.forEach(["delete","get","head","post","put","patch"],e=>{ot.headers[e]={}});const rt=Me.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),lt=Symbol("internals");function ct(e){return e&&String(e).trim().toLowerCase()}function dt(e){return!1===e||null==e?e:Me.isArray(e)?e.map(dt):String(e)}function ut(e,t,a,n,i){return Me.isFunction(n)?n.call(this,t,a):(i&&(t=a),Me.isString(t)?Me.isString(n)?-1!==t.indexOf(n):Me.isRegExp(n)?n.test(t):void 0:void 0)}let ht=class{constructor(e){e&&this.set(e)}set(e,t,a){const n=this;function i(e,t,a){const i=ct(t);if(!i)throw new Error("header name must be a non-empty string");const s=Me.findKey(n,i);(!s||void 0===n[s]||!0===a||void 0===a&&!1!==n[s])&&(n[s||t]=dt(e))}const s=(e,t)=>Me.forEach(e,(e,a)=>i(e,a,t));if(Me.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(Me.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))s((e=>{const t={};let a,n,i;return e&&e.split("\n").forEach(function(e){i=e.indexOf(":"),a=e.substring(0,i).trim().toLowerCase(),n=e.substring(i+1).trim(),!a||t[a]&&rt[a]||("set-cookie"===a?t[a]?t[a].push(n):t[a]=[n]:t[a]=t[a]?t[a]+", "+n:n)}),t})(e),t);else if(Me.isObject(e)&&Me.isIterable(e)){let a,n,i={};for(const t of e){if(!Me.isArray(t))throw TypeError("Object iterator must return a key-value pair");i[n=t[0]]=(a=i[n])?Me.isArray(a)?[...a,t[1]]:[a,t[1]]:t[1]}s(i,t)}else null!=e&&i(t,e,a);return this}get(e,t){if(e=ct(e)){const a=Me.findKey(this,e);if(a){const e=this[a];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=a.exec(e);)t[n[1]]=n[2];return t}(e);if(Me.isFunction(t))return t.call(this,e,a);if(Me.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ct(e)){const a=Me.findKey(this,e);return!(!a||void 0===this[a]||t&&!ut(0,this[a],a,t))}return!1}delete(e,t){const a=this;let n=!1;function i(e){if(e=ct(e)){const i=Me.findKey(a,e);!i||t&&!ut(0,a[i],i,t)||(delete a[i],n=!0)}}return Me.isArray(e)?e.forEach(i):i(e),n}clear(e){const t=Object.keys(this);let a=t.length,n=!1;for(;a--;){const i=t[a];e&&!ut(0,this[i],i,e,!0)||(delete this[i],n=!0)}return n}normalize(e){const t=this,a={};return Me.forEach(this,(n,i)=>{const s=Me.findKey(a,i);if(s)return t[s]=dt(n),void delete t[i];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,a)=>t.toUpperCase()+a)}(i):String(i).trim();o!==i&&delete t[i],t[o]=dt(n),a[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Me.forEach(this,(a,n)=>{null!=a&&!1!==a&&(t[n]=e&&Me.isArray(a)?a.join(", "):a)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const a=new this(e);return t.forEach(e=>a.set(e)),a}static accessor(e){const t=(this[lt]=this[lt]={accessors:{}}).accessors,a=this.prototype;function n(e){const n=ct(e);t[n]||(!function(e,t){const a=Me.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+a,{value:function(e,a,i){return this[n].call(this,t,e,a,i)},configurable:!0})})}(a,e),t[n]=!0)}return Me.isArray(e)?e.forEach(n):n(e),this}};function pt(e,t){const a=this||ot,n=t||a,i=ht.from(n.headers);let s=n.data;return Me.forEach(e,function(e){s=e.call(a,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function mt(e){return!(!e||!e.__CANCEL__)}function ft(e,t,a){Ue.call(this,null==e?"canceled":e,Ue.ERR_CANCELED,t,a),this.name="CanceledError"}function vt(e,t,a){const n=a.config.validateStatus;a.status&&n&&!n(a.status)?t(new Ue("Request failed with status code "+a.status,[Ue.ERR_BAD_REQUEST,Ue.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a)):e(a)}ht.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Me.reduceDescriptors(ht.prototype,({value:e},t)=>{let a=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[a]=e}}}),Me.freezeMethods(ht),Me.inherits(ft,Ue,{__CANCEL__:!0});const gt=(e,t,a=3)=>{let n=0;const i=function(e,t){e=e||10;const a=new Array(e),n=new Array(e);let i,s=0,o=0;return t=void 0!==t?t:1e3,function(r){const l=Date.now(),c=n[o];i||(i=l),a[s]=r,n[s]=l;let d=o,u=0;for(;d!==s;)u+=a[d++],d%=e;if(s=(s+1)%e,s===o&&(o=(o+1)%e),l-i<t)return;const h=c&&l-c;return h?Math.round(1e3*u/h):void 0}}(50,250);return function(e,t){let a,n,i=0,s=1e3/t;const o=(t,s=Date.now())=>{i=s,a=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[(...e)=>{const t=Date.now(),r=t-i;r>=s?o(e,t):(a=e,n||(n=setTimeout(()=>{n=null,o(a)},s-r)))},()=>a&&o(a)]}(a=>{const s=a.loaded,o=a.lengthComputable?a.total:void 0,r=s-n,l=i(r);n=s;e({loaded:s,total:o,progress:o?s/o:void 0,bytes:r,rate:l||void 0,estimated:l&&o&&s<=o?(o-s)/l:void 0,event:a,lengthComputable:null!=o,[t?"download":"upload"]:!0})},a)},bt=(e,t)=>{const a=null!=e;return[n=>t[0]({lengthComputable:a,total:e,loaded:n}),t[1]]},wt=e=>(...t)=>Me.asap(()=>e(...t)),yt=it.hasStandardBrowserEnv?((e,t)=>a=>(a=new URL(a,it.origin),e.protocol===a.protocol&&e.host===a.host&&(t||e.port===a.port)))(new URL(it.origin),it.navigator&&/(msie|trident)/i.test(it.navigator.userAgent)):()=>!0,_t=it.hasStandardBrowserEnv?{write(e,t,a,n,i,s){const o=[e+"="+encodeURIComponent(t)];Me.isNumber(a)&&o.push("expires="+new Date(a).toGMTString()),Me.isString(n)&&o.push("path="+n),Me.isString(i)&&o.push("domain="+i),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function kt(e,t,a){let n=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(n||0==a)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Ct=e=>e instanceof ht?{...e}:e;function Et(e,t){t=t||{};const a={};function n(e,t,a,n){return Me.isPlainObject(e)&&Me.isPlainObject(t)?Me.merge.call({caseless:n},e,t):Me.isPlainObject(t)?Me.merge({},t):Me.isArray(t)?t.slice():t}function i(e,t,a,i){return Me.isUndefined(t)?Me.isUndefined(e)?void 0:n(void 0,e,0,i):n(e,t,0,i)}function s(e,t){if(!Me.isUndefined(t))return n(void 0,t)}function o(e,t){return Me.isUndefined(t)?Me.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function r(a,i,s){return s in t?n(a,i):s in e?n(void 0,a):void 0}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:r,headers:(e,t,a)=>i(Ct(e),Ct(t),0,!0)};return Me.forEach(Object.keys(Object.assign({},e,t)),function(n){const s=l[n]||i,o=s(e[n],t[n],n);Me.isUndefined(o)&&s!==r||(a[n]=o)}),a}const It=e=>{const t=Et({},e);let a,{data:n,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:o,headers:r,auth:l}=t;if(t.headers=r=ht.from(r),t.url=Je(kt(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&r.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),Me.isFormData(n))if(it.hasStandardBrowserEnv||it.hasStandardBrowserWebWorkerEnv)r.setContentType(void 0);else if(!1!==(a=r.getContentType())){const[e,...t]=a?a.split(";").map(e=>e.trim()).filter(Boolean):[];r.setContentType([e||"multipart/form-data",...t].join("; "))}if(it.hasStandardBrowserEnv&&(i&&Me.isFunction(i)&&(i=i(t)),i||!1!==i&&yt(t.url))){const e=s&&o&&_t.read(o);e&&r.set(s,e)}return t},St="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,a){const n=It(e);let i=n.data;const s=ht.from(n.headers).normalize();let o,r,l,c,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=n;function m(){c&&c(),d&&d(),n.cancelToken&&n.cancelToken.unsubscribe(o),n.signal&&n.signal.removeEventListener("abort",o)}let f=new XMLHttpRequest;function v(){if(!f)return;const n=ht.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());vt(function(e){t(e),m()},function(e){a(e),m()},{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:n,config:e,request:f}),f=null}f.open(n.method.toUpperCase(),n.url,!0),f.timeout=n.timeout,"onloadend"in f?f.onloadend=v:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(v)},f.onabort=function(){f&&(a(new Ue("Request aborted",Ue.ECONNABORTED,e,f)),f=null)},f.onerror=function(){a(new Ue("Network Error",Ue.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const i=n.transitional||Qe;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),a(new Ue(t,i.clarifyTimeoutError?Ue.ETIMEDOUT:Ue.ECONNABORTED,e,f)),f=null},void 0===i&&s.setContentType(null),"setRequestHeader"in f&&Me.forEach(s.toJSON(),function(e,t){f.setRequestHeader(t,e)}),Me.isUndefined(n.withCredentials)||(f.withCredentials=!!n.withCredentials),u&&"json"!==u&&(f.responseType=n.responseType),p&&([l,d]=gt(p,!0),f.addEventListener("progress",l)),h&&f.upload&&([r,c]=gt(h),f.upload.addEventListener("progress",r),f.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(o=t=>{f&&(a(!t||t.type?new ft(null,e,f):t),f.abort(),f=null)},n.cancelToken&&n.cancelToken.subscribe(o),n.signal&&(n.signal.aborted?o():n.signal.addEventListener("abort",o)));const g=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);g&&-1===it.protocols.indexOf(g)?a(new Ue("Unsupported protocol "+g+":",Ue.ERR_BAD_REQUEST,e)):f.send(i||null)})},Tt=(e,t)=>{const{length:a}=e=e?e.filter(Boolean):[];if(t||a){let a,n=new AbortController;const i=function(e){if(!a){a=!0,o();const t=e instanceof Error?e:this.reason;n.abort(t instanceof Ue?t:new ft(t instanceof Error?t.message:t))}};let s=t&&setTimeout(()=>{s=null,i(new Ue(`timeout ${t} of ms exceeded`,Ue.ETIMEDOUT))},t);const o=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)}),e=null)};e.forEach(e=>e.addEventListener("abort",i));const{signal:r}=n;return r.unsubscribe=()=>Me.asap(o),r}},Nt=function*(e,t){let a=e.byteLength;if(a<t)return void(yield e);let n,i=0;for(;i<a;)n=i+t,yield e.slice(i,n),i=n},At=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:a}=await t.read();if(e)break;yield a}}finally{await t.cancel()}},Pt=(e,t,a,n)=>{const i=async function*(e,t){for await(const a of At(e))yield*Nt(a,t)}(e,t);let s,o=0,r=e=>{s||(s=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await i.next();if(t)return r(),void e.close();let s=n.byteLength;if(a){let e=o+=s;a(e)}e.enqueue(new Uint8Array(n))}catch(t){throw r(t),t}},cancel:e=>(r(e),i.return())},{highWaterMark:2})},Rt="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,xt=Rt&&"function"==typeof ReadableStream,Dt=Rt&&("function"==typeof TextEncoder?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),Ot=(e,...t)=>{try{return!!e(...t)}catch(a){return!1}},Lt=xt&&Ot(()=>{let e=!1;const t=new Request(it.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),Mt=xt&&Ot(()=>Me.isReadableStream(new Response("").body)),Ut={stream:Mt&&(e=>e.body)};var Ft;Rt&&(Ft=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Ut[e]&&(Ut[e]=Me.isFunction(Ft[e])?t=>t[e]():(t,a)=>{throw new Ue(`Response type '${e}' is not supported`,Ue.ERR_NOT_SUPPORT,a)})}));const qt=async(e,t)=>{const a=Me.toFiniteNumber(e.getContentLength());return null==a?(async e=>{if(null==e)return 0;if(Me.isBlob(e))return e.size;if(Me.isSpecCompliantForm(e)){const t=new Request(it.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return Me.isArrayBufferView(e)||Me.isArrayBuffer(e)?e.byteLength:(Me.isURLSearchParams(e)&&(e+=""),Me.isString(e)?(await Dt(e)).byteLength:void 0)})(t):a},Bt={http:null,xhr:St,fetch:Rt&&(async e=>{let{url:t,method:a,data:n,signal:i,cancelToken:s,timeout:o,onDownloadProgress:r,onUploadProgress:l,responseType:c,headers:d,withCredentials:u="same-origin",fetchOptions:h}=It(e);c=c?(c+"").toLowerCase():"text";let p,m=Tt([i,s&&s.toAbortSignal()],o);const f=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let v;try{if(l&&Lt&&"get"!==a&&"head"!==a&&0!==(v=await qt(d,n))){let e,a=new Request(t,{method:"POST",body:n,duplex:"half"});if(Me.isFormData(n)&&(e=a.headers.get("content-type"))&&d.setContentType(e),a.body){const[e,t]=bt(v,gt(wt(l)));n=Pt(a.body,65536,e,t)}}Me.isString(u)||(u=u?"include":"omit");const i="credentials"in Request.prototype;p=new Request(t,{...h,signal:m,method:a.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:i?u:void 0});let s=await fetch(p);const o=Mt&&("stream"===c||"response"===c);if(Mt&&(r||o&&f)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=s[t]});const t=Me.toFiniteNumber(s.headers.get("content-length")),[a,n]=r&&bt(t,gt(wt(r),!0))||[];s=new Response(Pt(s.body,65536,a,()=>{n&&n(),f&&f()}),e)}c=c||"text";let g=await Ut[Me.findKey(Ut,c)||"text"](s,e);return!o&&f&&f(),await new Promise((t,a)=>{vt(t,a,{data:g,headers:ht.from(s.headers),status:s.status,statusText:s.statusText,config:e,request:p})})}catch(g){if(f&&f(),g&&"TypeError"===g.name&&/Load failed|fetch/i.test(g.message))throw Object.assign(new Ue("Network Error",Ue.ERR_NETWORK,e,p),{cause:g.cause||g});throw Ue.from(g,g&&g.code,e,p)}})};Me.forEach(Bt,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(a){}Object.defineProperty(e,"adapterName",{value:t})}});const jt=e=>`- ${e}`,$t=e=>Me.isFunction(e)||null===e||!1===e,zt=e=>{e=Me.isArray(e)?e:[e];const{length:t}=e;let a,n;const i={};for(let s=0;s<t;s++){let t;if(a=e[s],n=a,!$t(a)&&(n=Bt[(t=String(a)).toLowerCase()],void 0===n))throw new Ue(`Unknown adapter '${t}'`);if(n)break;i[t||"#"+s]=n}if(!n){const e=Object.entries(i).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new Ue("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(jt).join("\n"):" "+jt(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n};function Vt(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ft(null,e)}function Wt(e){Vt(e),e.headers=ht.from(e.headers),e.data=pt.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return zt(e.adapter||ot.adapter)(e).then(function(t){return Vt(e),t.data=pt.call(e,e.transformResponse,t),t.headers=ht.from(t.headers),t},function(t){return mt(t)||(Vt(e),t&&t.response&&(t.response.data=pt.call(e,e.transformResponse,t.response),t.response.headers=ht.from(t.response.headers))),Promise.reject(t)})}const Ht="1.9.0",Gt={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Gt[e]=function(a){return typeof a===e||"a"+(t<1?"n ":" ")+e}});const Kt={};Gt.transitional=function(e,t,a){function n(e,t){return"[Axios v1.9.0] Transitional option '"+e+"'"+t+(a?". "+a:"")}return(a,i,s)=>{if(!1===e)throw new Ue(n(i," has been removed"+(t?" in "+t:"")),Ue.ERR_DEPRECATED);return t&&!Kt[i]&&(Kt[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(a,i,s)}},Gt.spelling=function(e){return(t,a)=>(console.warn(`${a} is likely a misspelling of ${e}`),!0)};const Jt={assertOptions:function(e,t,a){if("object"!=typeof e)throw new Ue("options must be an object",Ue.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let i=n.length;for(;i-- >0;){const s=n[i],o=t[s];if(o){const t=e[s],a=void 0===t||o(t,s,e);if(!0!==a)throw new Ue("option "+s+" must be "+a,Ue.ERR_BAD_OPTION_VALUE);continue}if(!0!==a)throw new Ue("Unknown option "+s,Ue.ERR_BAD_OPTION)}},validators:Gt},Yt=Jt.validators;let Qt=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Ye,response:new Ye}}async request(e,t){try{return await this._request(e,t)}catch(a){if(a instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{a.stack?t&&!String(a.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(a.stack+="\n"+t):a.stack=t}catch(n){}}throw a}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Et(this.defaults,t);const{transitional:a,paramsSerializer:n,headers:i}=t;void 0!==a&&Jt.assertOptions(a,{silentJSONParsing:Yt.transitional(Yt.boolean),forcedJSONParsing:Yt.transitional(Yt.boolean),clarifyTimeoutError:Yt.transitional(Yt.boolean)},!1),null!=n&&(Me.isFunction(n)?t.paramsSerializer={serialize:n}:Jt.assertOptions(n,{encode:Yt.function,serialize:Yt.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Jt.assertOptions(t,{baseUrl:Yt.spelling("baseURL"),withXsrfToken:Yt.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&Me.merge(i.common,i[t.method]);i&&Me.forEach(["delete","get","head","post","put","patch","common"],e=>{delete i[e]}),t.headers=ht.concat(s,i);const o=[];let r=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(r=r&&e.synchronous,o.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let d,u=0;if(!r){const e=[Wt.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,l),d=e.length,c=Promise.resolve(t);u<d;)c=c.then(e[u++],e[u++]);return c}d=o.length;let h=t;for(u=0;u<d;){const e=o[u++],t=o[u++];try{h=e(h)}catch(p){t.call(this,p);break}}try{c=Wt.call(this,h)}catch(p){return Promise.reject(p)}for(u=0,d=l.length;u<d;)c=c.then(l[u++],l[u++]);return c}getUri(e){return Je(kt((e=Et(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Me.forEach(["delete","get","head","options"],function(e){Qt.prototype[e]=function(t,a){return this.request(Et(a||{},{method:e,url:t,data:(a||{}).data}))}}),Me.forEach(["post","put","patch"],function(e){function t(t){return function(a,n,i){return this.request(Et(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:a,data:n}))}}Qt.prototype[e]=t(),Qt.prototype[e+"Form"]=t(!0)});const Zt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Zt).forEach(([e,t])=>{Zt[t]=e});const Xt=function e(t){const a=new Qt(t),n=J(Qt.prototype.request,a);return Me.extend(n,Qt.prototype,a,{allOwnKeys:!0}),Me.extend(n,a,null,{allOwnKeys:!0}),n.create=function(a){return e(Et(t,a))},n}(ot);Xt.Axios=Qt,Xt.CanceledError=ft,Xt.CancelToken=class e{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const a=this;this.promise.then(e=>{if(!a._listeners)return;let t=a._listeners.length;for(;t-- >0;)a._listeners[t](e);a._listeners=null}),this.promise.then=e=>{let t;const n=new Promise(e=>{a.subscribe(e),t=e}).then(e);return n.cancel=function(){a.unsubscribe(t)},n},e(function(e,n,i){a.reason||(a.reason=new ft(e,n,i),t(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;return{token:new e(function(e){t=e}),cancel:t}}},Xt.isCancel=mt,Xt.VERSION=Ht,Xt.toFormData=Ve,Xt.AxiosError=Ue,Xt.Cancel=Xt.CanceledError,Xt.all=function(e){return Promise.all(e)},Xt.spread=function(e){return function(t){return e.apply(null,t)}},Xt.isAxiosError=function(e){return Me.isObject(e)&&!0===e.isAxiosError},Xt.mergeConfig=Et,Xt.AxiosHeaders=ht,Xt.formToJSON=e=>st(Me.isHTMLForm(e)?new FormData(e):e),Xt.getAdapter=zt,Xt.HttpStatusCode=Zt,Xt.default=Xt;const{Axios:ea,AxiosError:ta,CanceledError:aa,isCancel:na,CancelToken:ia,VERSION:sa,all:oa,Cancel:ra,isAxiosError:la,spread:ca,toFormData:da,AxiosHeaders:ua,HttpStatusCode:ha,formToJSON:pa,getAdapter:ma,mergeConfig:fa}=Xt,va=Xt.create({baseURL:"https://mozoqr.com/api",headers:{"Content-Type":"application/json",Accept:"application/json"}});va.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),va.interceptors.response.use(e=>{try{const t=e.data;if(t){const e=t.token||t.access_token||t.plainTextToken||t.user&&t.user.token||t.user&&t.user.access_token;e&&localStorage.setItem("token",e)}if(!localStorage.getItem("token")&&e.headers){const t=e.headers.authorization||e.headers.Authorization;t&&t.startsWith("Bearer ")&&localStorage.setItem("token",t.replace("Bearer ",""))}}catch(t){}return e},e=>(e.response&&401===e.response.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),e.message=(e=>{if(e.response){const t=e.response.data;if(t){if("string"==typeof t)return t;if(t.message)return t.message;if(t.error)return t.error}return`Error ${e.response.status}: ${e.response.statusText||"Error en la respuesta del servidor"}`}return e.request?"No se recibió respuesta del servidor. Verifique su conexión.":e.message||"Ocurrió un error desconocido."})(e),Promise.reject(e)));const ga={login:e=>va.post("login",e),loginWithGoogle:e=>va.post("login/google",e),checkUserExists:e=>va.post("check-user-exists",{email:e}),forgotPassword:e=>va.post("forgot-password",e),resetPassword:e=>va.post("reset-password",e),callWaiter:e=>va.post(`tables/${e}/call-waiter`),register:e=>va.post("register",e),getCurrentUser:()=>va.get("user"),logout:()=>va.post("logout"),selectRole:(e,t=null)=>{const a={role:e};return t&&(a.business_id=t),va.post("role/select",a)},updateProfile:e=>va.post("profile/update",e,{headers:{"Content-Type":"multipart/form-data"}}),updateWaiterProfile:e=>va.post("profile/waiter/update",e,{headers:{"Content-Type":"multipart/form-data"}}),getProfileCompleteness:()=>va.get("profile/completeness"),getActiveUserProfile:(e=null)=>{const t=e?{business_id:e}:{};return va.get("user-profile/active",{params:t})},getAllUserProfiles:()=>va.get("user-profile/all"),updateWaiterUserProfile:e=>va.post("user-profile/waiter/update",e,{headers:{"Content-Type":"multipart/form-data"}}),updateAdminUserProfile:e=>va.post("user-profile/admin/update",e,{headers:{"Content-Type":"multipart/form-data"}}),deleteUserProfileAvatar:e=>va.delete("user-profile/avatar",{data:e}),changePassword:e=>va.post("change-password",e),deleteAccount:e=>va.delete("delete-account",{data:e}),sendWhatsAppMessage:e=>va.post("profile/whatsapp/send",e),getNotifications:()=>va.get("user/notifications"),handleNotification:e=>va.post(`user/notifications/${e}/read`),globalNotifications:e=>va.post("notifications/global",e),storeDeviceToken:e=>va.post("device-token",e),deleteDeviceToken:e=>e&&"object"==typeof e?va.delete("device-token",{data:e}):"string"==typeof e||"number"==typeof e?va.delete(`device-token/${e}`):va.delete("device-token"),toggleTableNotifications:e=>va.post(`tables/toggle-notifications/${e}`),waiterOnboard:e=>va.post("waiter/onboard",{code:e}),getWaiterTables:()=>va.get("waiter/tables"),listWaiterProfiles:()=>va.get("waiter/profiles"),createWaiterProfile:e=>va.post("waiter/profiles",e),deleteWaiterProfile:e=>va.delete(`waiter/profiles/${e}`),getWaiterNotifications:()=>va.get("waiter/notifications"),handleWaiterNotification:(e,t)=>va.post(`waiter/notifications/handle/${e}`,t),waiterGlobalNotifications:e=>va.post("waiter/notifications/global",e),waiterToggleTableNotifications:e=>va.post(`waiter/tables/toggle-notifications/${e}`),getBusinessInfo:()=>va.get("admin/business"),getAdminBusinesses:()=>va.get("admin/businesses"),removeStaff:e=>va.delete(`admin/staff/${e}`),handleStaffRequest:(e,t)=>va.post(`admin/staff/request/${e}`,t),getStaffRequests:()=>va.get("admin/staff/requests"),getArchivedStaffRequests:()=>va.get("admin/staff/requests/archived"),getTables:()=>va.get("tables"),createTable:e=>va.post("tables",e),updateTable:(e,t)=>va.put(`tables/${e}`,t),deleteTable:e=>va.delete(`tables/${e}`),getMenus:()=>va.get("menus"),uploadMenu:e=>va.post("menus",e,{headers:{"Content-Type":"multipart/form-data"}}),setDefaultMenu:e=>va.post("menus/default",e),generateQRCode:e=>va.post(`admin/qr/generate/${e}`),regenerateQRCode:e=>va.post(`admin/qr/generate/${e}`,{regenerate:!0}),getQrPreview:e=>va.get(`admin/qr/preview/${e}`,{responseType:"text"}),exportQR:e=>va.post("admin/qr/export",e),sendQrEmail:e=>va.post("admin/qr/email",e),getSettings:()=>va.get("admin/settings"),updateSettings:e=>va.post("admin/settings",e),deleteMenu:e=>va.delete(`menus/${e}`),renameMenu:(e,t)=>va.put(`menus/${e}`,t),reorderMenus:e=>va.post("menus/reorder",{order:e}),previewMenu:e=>va.get(`menus/${e}/preview`,{responseType:"blob"}),downloadMenu:e=>va.get(`menus/${e}/download`,{responseType:"blob"}),cloneTable:(e,t)=>va.post(`tables/clone/${e}`,t),getStaff:(e=1)=>va.get(`admin/staff?page=${e}`),getStaffMember:e=>va.get(`admin/staff/${e}`),updateStaffMember:(e,t)=>t instanceof FormData?va.post(`admin/staff/${e}?_method=PUT`,t,{headers:{"Content-Type":"multipart/form-data"}}):va.put(`admin/staff/${e}`,t),inviteStaff:e=>va.post("admin/staff/invite",e),addReview:(e,t)=>va.post(`admin/staff/${e}/reviews`,t),deleteReview:(e,t)=>va.delete(`admin/staff/${e}/reviews/${t}`),changePassword:e=>va.post("change-password",e),deleteAccount:e=>va.delete("delete-account",{data:e}),getAdminStatistics:()=>va.get("admin/statistics"),getAdminNotifications:()=>va.get("admin/notifications"),listWorkHistory:()=>va.get("profile/work-history"),addWorkHistory:e=>va.post("profile/work-history",e),updateWorkHistory:(e,t)=>va.put(`profile/work-history/${e}`,t),deleteWorkHistory:e=>va.delete(`profile/work-history/${e}`),getAdminTables:()=>va.get("admin/tables"),getAdminTableDetails:e=>va.get(`admin/tables/${e}`),updateAdminTable:(e,t)=>va.put(`admin/tables/${e}`,t),deleteAdminTable:e=>va.delete(`admin/tables/${e}`),getAdminStaff:()=>va.get("admin/staff"),getAdminStaffDetails:e=>va.get(`admin/staff/${e}`),createAdminStaff:e=>va.post("admin/staff",e),updateAdminStaff:(e,t)=>va.post(`admin/staff/${e}`,t),deleteAdminStaff:e=>va.delete(`admin/staff/${e}`),getStaffByBusiness:e=>va.get(`staff?business_id=${e}`),createStaff:e=>va.post("staff",e),getStaffById:e=>va.get(`staff/${e}`),approveStaff:(e,t)=>va.post(`staff/${e}/approve`,t),rejectStaff:(e,t)=>va.post(`staff/${e}/reject`,t),inviteStaffMember:e=>va.post(`staff/${e}/invite`),getStaffWhatsApp:e=>va.get(`staff/${e}/whatsapp`),deleteStaffById:e=>va.delete(`staff/${e}`),joinStaffWithToken:(e,t)=>va.post(`staff/join/${e}`,t),testStaffNotifications:e=>va.post("staff/test-notifications",e),getAdminMenus:()=>va.get("admin/menus"),getAdminMenuDetails:e=>va.get(`admin/menus/${e}`),createAdminMenu:e=>va.post("admin/menus",e),updateAdminMenu:(e,t)=>va.post(`admin/menus/update/${e}`,t),deleteAdminMenu:e=>va.delete(`admin/menus/${e}`),getAdminRequests:()=>va.get("admin/requests"),sendNotificationToAll:e=>va.post("admin/notifications/send-to-all",e),sendNotificationToUser:e=>va.post("admin/notifications/send-to-user",e),sendNotificationToDevice:e=>va.post("admin/notifications/send-to-device",e),sendNotificationToTopic:e=>va.post("admin/notifications/send-to-topic",e),subscribeToTopic:e=>va.post("admin/notifications/subscribe-to-topic",e),unsubscribeFromTopic:e=>va.post("admin/notifications/unsubscribe-from-topic",e),getDeviceTokens:e=>va.get(`device-tokens/${e}`),sendPushToUser:e=>va.post("admin/notifications/send-to-user",e),healthCheck:()=>va.get("health-check"),getBusinessInfo:()=>va.get("admin/business"),createBusiness:e=>va.post("admin/business/create",e),joinBusiness:e=>va.post("join-business",{invitation_code:e}),regenerateInvitationCode:()=>va.post("admin/business/regenerate-invitation-code"),deleteBusiness:e=>va.delete(`admin/business/${e}`),getFirebaseConfig:()=>va.get("firebase/config"),registerWaiterFcm:e=>va.post("waiter/fcm/register",e),refreshWaiterFcm:e=>va.post("waiter/fcm/refresh",e),deleteWaiterFcmToken:e=>va.delete("waiter/fcm/token",{data:e}),testWaiterFcm:e=>va.post("waiter/fcm/test",e),getPendingCalls:()=>va.get("waiter/calls/pending"),acknowledgeCall:e=>va.post(`waiter/calls/${e}/acknowledge`),completeCall:e=>va.post(`waiter/calls/${e}/complete`),getWaiterCallHistory:(e={})=>va.get("waiter/calls/history",{params:e}),getAdminCallHistory:(e={})=>va.get("admin/calls/history",{params:e}),activateTable:e=>va.post(`waiter/tables/${e}/activate`),deactivateTable:e=>va.delete(`waiter/tables/${e}/activate`),activateMultipleTables:e=>va.post("waiter/tables/activate/multiple",e),deactivateMultipleTables:e=>va.post("waiter/tables/deactivate/multiple",e),silenceTable:(e,t)=>va.post(`waiter/tables/${e}/silence`,t),unsilenceTable:e=>va.delete(`waiter/tables/${e}/silence`),silenceMultipleTables:e=>va.post("waiter/tables/silence/multiple",e),unsilenceMultipleTables:e=>va.post("waiter/tables/unsilence/multiple",e),getSilencedTables:()=>va.get("waiter/tables/silenced"),getAssignedTables:()=>va.get("waiter/tables/assigned"),getAvailableTables:()=>va.get("waiter/tables/available"),getAdminSilencedTables:()=>va.get("admin/tables/silenced"),adminUnsilenceTable:e=>va.delete(`admin/tables/${e}/silence`),getWaiterTableProfiles:()=>va.get("waiter/table-profiles"),getWaiterTableProfile:e=>va.get(`waiter/table-profiles/${e}`),createWaiterTableProfile:e=>va.post("waiter/table-profiles",e),updateWaiterTableProfile:(e,t)=>va.put(`waiter/table-profiles/${e}`,t),deleteWaiterTableProfile:e=>va.delete(`waiter/table-profiles/${e}`),activateWaiterTableProfile:e=>va.post(`waiter/table-profiles/${e}/activate`),deactivateWaiterTableProfile:e=>va.post(`waiter/table-profiles/${e}/deactivate`),getWaiterTableProfileNotifications:()=>va.get("waiter/table-profiles/notifications"),getWaiterDashboard:()=>va.get("waiter/dashboard"),getWaiterTableStatus:()=>va.get("waiter/tables/status"),getWaiterBusinesses:()=>va.get("waiter/businesses"),setActiveWaiterBusiness:e=>va.post("waiter/set-active-business",{business_id:e}),getActiveWaiterBusiness:()=>va.get("waiter/businesses/active"),getWaiterBusinessTables:e=>va.get(`waiter/businesses/${e}/tables`),joinBusinessWithCode:e=>va.post("waiter/join-business",{business_code:e}),leaveWaiterBusiness:e=>va.delete(`waiter/businesses/${e}/leave`),blockIpForSpam:e=>va.post("waiter/ip/block",e),unblockIp:e=>va.post("waiter/ip/unblock",e),getBlockedIps:e=>va.get("waiter/ip/blocked",{params:e}),debugBlockedIp:e=>va.get("waiter/ip/debug",{params:e}),forceUnblockIp:e=>va.post("waiter/ip/force-unblock",e),getWaiterBusinessesActiveToday:()=>va.get("waiter/businesses/active-today"),leaveBusinessAsWaiter:e=>va.post("waiter/leave-business",e)},ba={async getNotifications(){try{return(await ga.getNotifications()).data}catch(e){throw console.error("Error obteniendo notificaciones:",e),e}},async handleNotification(e,t){try{if(!t||"mark_as_read"===t||"read"===t){const t=await ga.handleNotification(e);return t.data||t}return(await va.post(`notifications/handle/${e}`,{action:t})).data}catch(a){throw console.error("Error manejando notificación:",a),a}},async globalNotifications(e){try{return(await ga.globalNotifications({enabled:e})).data}catch(t){throw console.error("Error configurando notificaciones globales:",t),t}},async getWaiterNotifications(){try{return(await ga.getWaiterNotifications()).data}catch(e){throw console.error("Error obteniendo notificaciones de mozo:",e),e}},async handleWaiterNotification(e,t){try{return(await ga.handleWaiterNotification(e,{action:t})).data}catch(a){throw console.error("Error manejando notificación de mozo:",a),a}},async waiterGlobalNotifications(e){try{return(await ga.waiterGlobalNotifications({enabled:e})).data}catch(t){throw console.error("Error configurando notificaciones globales de mozo:",t),t}},async waiterToggleTableNotifications(e){try{return(await ga.waiterToggleTableNotifications(e)).data}catch(t){throw console.error("Error alternando notificaciones de mesa para mozo:",t),t}},async getAdminNotifications(){try{return(await ga.getAdminNotifications()).data}catch(e){throw console.error("Error obteniendo notificaciones de administrador:",e),e}},async storeDeviceToken(e,t="web",a=null){try{const n={token:e,platform:t};a&&(n.user_id=a);return(await ga.storeDeviceToken(n)).data}catch(n){throw console.error("Error guardando token de dispositivo:",n),n}},async deleteDeviceToken(e){try{return(await ga.deleteDeviceToken(e)).data}catch(t){throw console.error("Error eliminando token de dispositivo:",t),t}},async getDeviceTokens(e){try{return(await ga.getDeviceTokens(e)).data}catch(t){throw console.error("Error obteniendo tokens de dispositivo:",t),t}},async sendNotificationToAll(e,t,a=null){try{const n={title:e,body:t};a&&(n.data=a);return(await ga.sendNotificationToAll(n)).data}catch(n){throw console.error("Error enviando notificación a todos:",n),n}},async sendNotificationToUser(e,t,a,n=null){try{const i={user_id:e,title:t,body:a};n&&(i.data=n);return(await ga.sendNotificationToUser(i)).data}catch(i){throw console.error("Error enviando notificación a usuario:",i),i}},async sendNotificationToDevice(e,t,a,n=null){try{const i={token:e,title:t,body:a};n&&(i.data=n);return(await ga.sendNotificationToDevice(i)).data}catch(i){throw console.error("Error enviando notificación a dispositivo:",i),i}},async sendNotificationToTopic(e,t,a,n=null){try{const i={topic:e,title:t,body:a};n&&(i.data=n);return(await ga.sendNotificationToTopic(i)).data}catch(i){throw console.error("Error enviando notificación a topic:",i),i}},async subscribeToTopic(e,t){try{const a={tokens:Array.isArray(e)?e:[e],topic:t};return(await ga.subscribeToTopic(a)).data}catch(a){throw console.error("Error suscribiendo a topic:",a),a}},async unsubscribeFromTopic(e,t){try{const a={tokens:Array.isArray(e)?e:[e],topic:t};return(await ga.unsubscribeFromTopic(a)).data}catch(a){throw console.error("Error desuscribiendo de topic:",a),a}},async toggleTableNotifications(e){try{return(await ga.toggleTableNotifications(e)).data}catch(t){throw console.error("Error alternando notificaciones de mesa:",t),t}},async callWaiter(e){try{return(await ga.callWaiter(e)).data}catch(t){throw console.error("Error llamando al camarero:",t),t}},async markAllAsRead(e){try{const t=e.map(e=>this.handleNotification(e.id,"mark_as_read"));return await Promise.all(t)}catch(t){throw console.error("Error marcando todas como leídas:",t),t}},async deleteAllRead(e){try{const t=e.map(e=>va.post(`notifications/handle/${e.id}`,{action:"delete"}));return(await Promise.all(t)).map(e=>e.data)}catch(t){throw console.error("Error eliminando todas las leídas:",t),t}},async getNotificationsByRole(e){try{switch(e){case"waiter":return await this.getWaiterNotifications();case"admin":return await this.getAdminNotifications();default:return await this.getNotifications()}}catch(t){throw console.error("Error obteniendo notificaciones por rol:",t),t}},async healthCheck(){try{return await ga.healthCheck()}catch(e){throw console.error("Error en el health check de la API:",e),e}},async testWebSocketConnection(){try{if(!localStorage.getItem("token"))throw new Error("No hay token de autenticación");const e=localStorage.getItem("user"),{initializeEcho:t}=(e&&JSON.parse(e),await G(async()=>{const{initializeEcho:e}=await import("./echo-CsrB9MK9.js");return{initializeEcho:e}},__vite__mapDeps([0,1,2]))),a=t();if(!a)throw new Error("No se pudo inicializar Echo");if(!a.connector||!a.connector.pusher)throw new Error("Pusher no está disponible en Echo");return await new Promise((e,t)=>{const n=setTimeout(()=>{t(new Error("Timeout en la conexión WebSocket (5 segundos)"))},5e3);a.connector.pusher.connection.bind("connected",()=>{clearTimeout(n),e()}),a.connector.pusher.connection.bind("error",e=>{clearTimeout(n),console.error("🔍 Error en WebSocket:",e),t(new Error(`Error de conexión: ${e.message||"Error desconocido"}`))}),a.connector.pusher.connection.bind("disconnected",()=>{}),a.connector.pusher.connection.bind("connecting",()=>{})}),{success:!0,message:"Conexión WebSocket exitosa"}}catch(e){throw console.error("🔍 Error en testWebSocketConnection:",e),console.error("🔍 Stack trace:",e.stack),e}}},wa=Object.freeze(Object.defineProperty({__proto__:null,default:ba},Symbol.toStringTag,{value:"Module"})),ya={apiKey:"AIzaSyBlupKSIy7qtTsXukqROyVjMNx03X8CCzU",authDomain:"mozoqr-7d32c.firebaseapp.com",projectId:"mozoqr-7d32c",storageBucket:"mozoqr-7d32c.firebasestorage.app",databaseURL:"https://mozoqr-7d32c-default-rtdb.firebaseio.com",messagingSenderId:"175482362472",appId:"1:175482362472:web:308070c885bacc71b6b9dd",measurementId:"G-6N7J4X94DH"};let _a=null,ka=null,Ca=null,Ea=null;const Ia=async()=>{try{if("undefined"==typeof window)return console.log("🔥 Firebase: Not supported in non-browser environment"),null;const t=Object.entries(ya).filter(([e,t])=>!t).map(([e,t])=>e);if(t.length>0)return console.error("🔥 Firebase: Incomplete configuration. Missing keys:",t),null;console.log("🔥 Initializing Firebase...");const{initializeApp:a}=await G(async()=>{const{initializeApp:e}=await import("./index.esm-CWP_HgUh.js");return{initializeApp:e}},__vite__mapDeps([3,1,2]));_a=a(ya);const{getFirestore:n}=await G(async()=>{const{getFirestore:e}=await import("./index.esm-PpI2LJYX.js");return{getFirestore:e}},__vite__mapDeps([4,1,2]));Ca=n(_a);const{getAuth:i,signInAnonymously:s,onAuthStateChanged:o}=await G(async()=>{const{getAuth:e,signInAnonymously:t,onAuthStateChanged:a}=await Promise.resolve().then(()=>Ah);return{getAuth:e,signInAnonymously:t,onAuthStateChanged:a}},void 0);Ea=i(_a);try{const e=await s(Ea);console.log("🔥 Firebase Auth: Anonymous sign-in successful, UID:",e.user.uid),await new Promise(e=>{const t=o(Ea,a=>{a?console.log("🔥 Firebase Auth: User authenticated with UID:",a.uid):console.warn("🔥 Firebase Auth: No user authenticated"),t(),e()})})}catch(e){console.error("🔥 Firebase Auth: Anonymous sign-in failed:",e)}return{app:_a,db:Ca,auth:Ea}}catch(t){return console.error("🔥 Firebase App initialization error:",t),null}},Sa=async()=>(Ea||await Ia(),Ea),Ta=async()=>{try{if(!_a){if(!(await Ia()))return null}if("serviceWorker"in navigator)try{await navigator.serviceWorker.register("/firebase-messaging-sw.js")}catch(e){console.error("🔥 Service Worker registration failed:",e)}const{getMessaging:t,isSupported:a}=await G(async()=>{const{getMessaging:e,isSupported:t}=await import("./index.esm-B4WFe6kg.js");return{getMessaging:e,isSupported:t}},__vite__mapDeps([5,1,2]));if(!(await a())){console.log("🔥 Firebase Messaging not supported in this browser");const{getAuth:e}=await G(async()=>{const{getAuth:e}=await Promise.resolve().then(()=>Ah);return{getAuth:e}},void 0),t=e(_a);return{app:_a,messaging:null,db:Ca,auth:t}}ka=t(_a);const{getAuth:n}=await G(async()=>{const{getAuth:e}=await Promise.resolve().then(()=>Ah);return{getAuth:e}},void 0),i=n(_a);return{app:_a,messaging:ka,db:Ca,auth:i}}catch(e){console.error("🔥 Firebase initialization error:",e);try{const{getAuth:e}=await G(async()=>{const{getAuth:e}=await Promise.resolve().then(()=>Ah);return{getAuth:e}},void 0),t=e(_a);return{app:_a,messaging:null,db:Ca,auth:t}}catch(t){return{app:_a,messaging:null,db:Ca,auth:null}}}},Na=async()=>{try{if(!ka){if(!(await Ta()))throw new Error("Firebase initialization failed")}const{getToken:e}=await G(async()=>{const{getToken:e}=await import("./index.esm-B4WFe6kg.js");return{getToken:e}},__vite__mapDeps([5,1,2]));if("undefined"==typeof Notification)console.warn("🔥 Notification API no disponible en este entorno (probablemente WebView). Saltando solicitud de permisos.");else{let e=Notification.permission;if("default"===e&&(console.log("🔥 Requesting notification permissions..."),e=await Notification.requestPermission(),console.log("🔥 Permission after request:",e)),"denied"===e)throw console.error("🔥 Notification permissions DENIED by user"),console.error('🔥 SOLUTION: Click the 🔒 in the address bar and change Notifications to "Allow"'),new Error('Notification permissions denied. Click the 🔒 in the address bar and change Notifications to "Allow", then reload the page.');if("granted"!==e)throw new Error("Notification permissions not granted")}const t="BNJgpNkgB0a0y7gHT-SNBFLMGIZw-Xx8NTBDCn_4dVqekzgmnGmKMIn10t-6gWl3Qj_msyCcfbsVycnAp8USs6M",a={};t&&(a.vapidKey=t);const n=await e(ka,a);if(!n)throw new Error("Failed to obtain FCM token");return localStorage.setItem("fcm_token",n),n}catch(e){throw console.error("🔥 FCM token error:",e),e}},Aa=async e=>{try{if(!ka){if(!(await Ta()))return}const{onMessage:t}=await G(async()=>{const{onMessage:e}=await import("./index.esm-B4WFe6kg.js");return{onMessage:e}},__vite__mapDeps([5,1,2]));t(ka,t=>{const a=Pa(t);if(e&&"function"==typeof e)try{e(a)}catch(n){console.error("🔥❌ Error in onMessage callback:",n)}try{G(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>cr);return{useNotificationsStore:e}},void 0).then(({useNotificationsStore:e})=>{var t;const n=e(),i={id:`fcm-${Date.now()}`,type:(null==(t=a.data)?void 0:t.type)||"FCMNotification",data:{title:a.title,message:a.body,...a.data},created_at:(new Date).toISOString(),read_at:null,source:"firebase-foreground"};console.log("🔥📨 Adding FCM notification to store:",i),n.addNewNotification(i)})}catch(n){console.error("🔥❌ Error adding FCM notification to store:",n)}"granted"===Notification.permission&&Ra(a)})}catch(t){console.error("🔥 Error setting up message listener:",t)}},Pa=e=>{var t,a,n;let i={title:(null==(t=e.notification)?void 0:t.title)||"Nueva notificación",body:(null==(a=e.notification)?void 0:a.body)||"Tienes una nueva notificación",data:e.data||{}};if(null==(n=e.data)?void 0:n.type){switch(e.data.type){case"TestNotification":i={title:"🧪 Test Notification",body:"This is a test notification sent to all business users",data:{...e.data,icon:"🧪",priority:"normal",channels:["Database","Broadcast","FCM"]}};break;case"UserSpecificNotification":i={title:e.data.title||"👤 Personalized Notification",body:e.data.message||"You have a new personalized notification",data:{...e.data,icon:"👤",priority:"high",channels:["Database","Broadcast","FCM"]}};break;case"WebSocketTestNotification":i={title:"⚡ WebSocket + FCM Test",body:"This notification arrives via WebSocket (real-time) and FCM (push)",data:{...e.data,icon:"⚡",priority:"high",test_mode:"websocket_fcm"}};break;case"WebSocketOnlyNotification":i={title:"🔌 WebSocket Only Test",body:"This notification ONLY arrives via WebSocket in real-time",data:{...e.data,icon:"🔌",priority:"normal",test_mode:"websocket_only"}};break;default:e.notification&&(i={title:e.notification.title,body:e.notification.body,data:{...e.data,icon:"📱",priority:"normal"}})}}return i},Ra=e=>{try{const{title:t,body:a,data:n}=e;if(t||a){new Notification(t||"Nueva notificación",{body:a||"Tienes una nueva notificación",icon:"/favicon.ico",tag:`fcm-notification-${Date.now()}`,data:n,requireInteraction:!0})}}catch(t){console.error("🔥❌ Error showing browser notification:",t)}},xa=async()=>{try{if(!ka)return void console.log("🔥 Firebase Messaging not initialized");const{deleteToken:e}=await G(async()=>{const{deleteToken:e}=await import("./index.esm-B4WFe6kg.js");return{deleteToken:e}},__vite__mapDeps([5,1,2]));await e(ka),localStorage.removeItem("fcm_token"),console.log("🔥 FCM token deleted successfully")}catch(e){throw console.error("🔥 FCM token deletion error:",e),e}},Da=()=>Ca||(console.error("🔥 Firestore not initialized. Call initializeFirebase() first."),null),Oa=()=>{const e={configured:!1,initialized:!1,messagingAvailable:!1,firestoreAvailable:!1,tokenExists:!1,notificationPermission:"undefined"!=typeof Notification?Notification.permission:"unavailable"};try{const t=Object.entries(ya).filter(([e,t])=>!t).map(([e,t])=>e);return e.configured=0===t.length,e.initialized=!!_a&&!!ka&&!!Ca,e.messagingAvailable=!!ka,e.firestoreAvailable=!!Ca,e.tokenExists=!!localStorage.getItem("fcm_token"),"Notification"in window&&(e.notificationPermission=Notification.permission),e}catch(t){return console.error("🔥 Error getting Firebase status:",t),e}},La={initializeFirebase:Ta,initializeFirebaseApp:Ia,getFCMToken:Na,setupForegroundMessageListener:Aa,deleteFCMToken:xa,getFirestore:Da,getFirebaseStatus:Oa,config:ya},Ma=Object.freeze(Object.defineProperty({__proto__:null,default:La,deleteFCMToken:xa,getAuth:Sa,getFCMToken:Na,getFirebaseStatus:Oa,getFirestore:Da,initializeFirebase:Ta,initializeFirebaseApp:Ia,setupForegroundMessageListener:Aa},Symbol.toStringTag,{value:"Module"}));
/*! Capacitor: https://capacitorjs.com/ - MIT License */
var Ua,Fa;(Fa=Ua||(Ua={})).Unimplemented="UNIMPLEMENTED",Fa.Unavailable="UNAVAILABLE";class qa extends Error{constructor(e,t,a){super(e),this.message=e,this.code=t,this.data=a}}const Ba=e=>{const t=e.CapacitorCustomPlatform||null,a=e.Capacitor||{},n=a.Plugins=a.Plugins||{},i=()=>null!==t?t.name:(e=>{var t,a;return(null==e?void 0:e.androidBridge)?"android":(null===(a=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===a?void 0:a.bridge)?"ios":"web"})(e),s=e=>{var t;return null===(t=a.PluginHeaders)||void 0===t?void 0:t.find(t=>t.name===e)},o=new Map;return a.convertFileSrc||(a.convertFileSrc=e=>e),a.getPlatform=i,a.handleError=t=>e.console.error(t),a.isNativePlatform=()=>"web"!==i(),a.isPluginAvailable=e=>{const t=o.get(e);return!!(null==t?void 0:t.platforms.has(i()))||!!s(e)},a.registerPlugin=(e,r={})=>{const l=o.get(e);if(l)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),l.proxy;const c=i(),d=s(e);let u;const h=n=>{let i;const s=(...s)=>{const o=(async()=>(!u&&c in r?u=u="function"==typeof r[c]?await r[c]():r[c]:null!==t&&!u&&"web"in r&&(u=u="function"==typeof r.web?await r.web():r.web),u))().then(t=>{const o=((t,n)=>{var i,s;if(!d){if(t)return null===(s=t[n])||void 0===s?void 0:s.bind(t);throw new qa(`"${e}" plugin is not implemented on ${c}`,Ua.Unimplemented)}{const s=null==d?void 0:d.methods.find(e=>n===e.name);if(s)return"promise"===s.rtype?t=>a.nativePromise(e,n.toString(),t):(t,i)=>a.nativeCallback(e,n.toString(),t,i);if(t)return null===(i=t[n])||void 0===i?void 0:i.bind(t)}})(t,n);if(o){const e=o(...s);return i=null==e?void 0:e.remove,e}throw new qa(`"${e}.${n}()" is not implemented on ${c}`,Ua.Unimplemented)});return"addListener"===n&&(o.remove=async()=>i()),o};return s.toString=()=>`${n.toString()}() { [capacitor code] }`,Object.defineProperty(s,"name",{value:n,writable:!1,configurable:!1}),s},p=h("addListener"),m=h("removeListener"),f=(e,t)=>{const a=p({eventName:e},t),n=async()=>{const n=await a;m({eventName:e,callbackId:n},t)},i=new Promise(e=>a.then(()=>e({remove:n})));return i.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await n()},i},v=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return d?f:p;case"removeListener":return m;default:return h(t)}}});return n[e]=v,o.set(e,{name:e,proxy:v,platforms:new Set([...Object.keys(r),...d?[c]:[]])}),v},a.Exception=qa,a.DEBUG=!!a.DEBUG,a.isLoggingEnabled=!!a.isLoggingEnabled,a},ja=(e=>e.Capacitor=Ba(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),$a=ja.registerPlugin;class za{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let a=!1;this.listeners[e]||(this.listeners[e]=[],a=!0),this.listeners[e].push(t);const n=this.windowListeners[e];n&&!n.registered&&this.addWindowListener(n),a&&this.sendRetainedArgumentsForEvent(e);return Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,a){const n=this.listeners[e];if(n)n.forEach(e=>e(t));else if(a){let a=this.retainedEventArguments[e];a||(a=[]),a.push(t),this.retainedEventArguments[e]=a}}hasListeners(e){var t;return!!(null===(t=this.listeners[e])||void 0===t?void 0:t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new ja.Exception(e,Ua.Unimplemented)}unavailable(e="not available"){return new ja.Exception(e,Ua.Unavailable)}async removeListener(e,t){const a=this.listeners[e];if(!a)return;const n=a.indexOf(t);this.listeners[e].splice(n,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(t=>{this.notifyListeners(e,t)}))}}const Va=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Wa=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Ha extends za{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[a,n]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");a=Wa(a).trim(),n=Wa(n).trim(),t[a]=n}),t}async setCookie(e){try{const t=Va(e.key),a=Va(e.value),n=`; expires=${(e.expires||"").replace("expires=","")}`,i=(e.path||"/").replace("path=",""),s=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${a||""}${n}; path=${i}; ${s};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}$a("CapacitorCookies",{web:()=>new Ha});const Ga=(e,t={})=>{const a=Object.assign({method:e.method||"GET",headers:e.headers},t),n=((e={})=>{const t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((a,n,i)=>(a[n]=e[t[i]],a),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)a.body=e.data;else if(n.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[a,n]of Object.entries(e.data||{}))t.set(a,n);a.body=t.toString()}else if(n.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,a)=>{t.append(a,e)});else for(const a of Object.keys(e.data))t.append(a,e.data[a]);a.body=t;const n=new Headers(a.headers);n.delete("content-type"),a.headers=n}else(n.includes("application/json")||"object"==typeof e.data)&&(a.body=JSON.stringify(e.data));return a};class Ka extends za{async request(e){const t=Ga(e,e.webFetchExtra),a=((e,t=!0)=>e?Object.entries(e).reduce((e,a)=>{const[n,i]=a;let s,o;return Array.isArray(i)?(o="",i.forEach(e=>{s=t?encodeURIComponent(e):e,o+=`${n}=${s}&`}),o.slice(0,-1)):(s=t?encodeURIComponent(i):i,o=`${n}=${s}`),`${e}&${o}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),n=a?`${e.url}?${a}`:e.url,i=await fetch(n,t),s=i.headers.get("content-type")||"";let o,r,{responseType:l="text"}=i.ok?e:{};switch(s.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":r=await i.blob(),o=await(async e=>new Promise((t,a)=>{const n=new FileReader;n.onload=()=>{const e=n.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},n.onerror=e=>a(e),n.readAsDataURL(e)}))(r);break;case"json":o=await i.json();break;default:o=await i.text()}const c={};return i.headers.forEach((e,t)=>{c[t]=e}),{data:o,headers:c,status:i.status,url:i.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}$a("CapacitorHttp",{web:()=>new Ka});const Ja=Object.freeze(Object.defineProperty({__proto__:null,Capacitor:ja,CapacitorException:qa,get ExceptionCode(){return Ua},WebPlugin:za,buildRequestInit:Ga,registerPlugin:$a},Symbol.toStringTag,{value:"Module"})),Ya=()=>{try{const e=ja.getPlatform();return"android"===e?"android":"ios"===e?"ios":"web"}catch(e){return"web"}};async function Qa(){try{if(!(await La.initializeFirebase()))return null;return await La.getFCMToken()}catch(e){return console.warn("notificationClient: no se pudo obtener FCM token:",(null==e?void 0:e.message)||e),null}}async function Za(e={},t={}){const a=t.platformOverride||Ya();let n=null;try{n=await Qa()}catch(o){}const i={...e};n&&(i.fcm_token=n,i.platform=a);const s=await ga.login(i);if(!n)try{const e=await Qa();e&&await async function(e,t=null){try{const a=t||Ya();return await ba.storeDeviceToken(e,a),localStorage.setItem("fcm_token",e),!0}catch(a){return console.warn("notificationClient: error registrando token despues de login:",(null==a?void 0:a.message)||a),!1}}(e,a)}catch(o){}return s}const Xa=e=>{try{return"object"==typeof e&&null!==e&&"value"in e?i(e):e}catch(t){return console.warn("Error accessing reactive value:",t),null}},en=e=>{try{const t=Xa(e);return t?String(t):""}catch(t){return console.warn("Error converting token to string:",t),""}},tn=t("auth",()=>{const e=a(null),t=a(localStorage.getItem("token")||null),i=a(!1),s=a(!!en(t)),o=a(!1),r=a(null),l=a(null),c=a({userFetch:null,userFetchTimestamp:0,cacheDuration:12e4,pendingUserRequest:null}),d=localStorage.getItem("user");if(d)try{const t=JSON.parse(d);t.selectedRole&&(l.value=t.selectedRole,t.role=t.selectedRole),e.value=t}catch(f){console.error("AuthStore - Error al parsear usuario de localStorage:",f)}const u=n(()=>{var t;return l.value||(null==(t=e.value)?void 0:t.role)||null}),h=async a=>{var n;o.value=!0,r.value=null;try{const o=(await Za(a)).data||{},r=o.token||o.access_token||o.plainTextToken;e.value=o.user,t.value=r||null,s.value=!0,l.value=(null==(n=o.user)?void 0:n.selectedRole)||null;const d=en(t);d&&localStorage.setItem("token",d),localStorage.setItem("user",JSON.stringify(o.user)),i.value=!0;try{const{initializePushNotifications:e}=await G(async()=>{const{initializePushNotifications:e}=await Promise.resolve().then(()=>gM);return{initializePushNotifications:e}},void 0),{useNotificationsStore:t}=((await G(async()=>{const{Capacitor:e}=await Promise.resolve().then(()=>Ja);return{Capacitor:e}},void 0)).Capacitor.getPlatform(),await e(),await G(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>cr);return{useNotificationsStore:e}},void 0));t().initializeRealTimeNotifications()}catch(c){}return o.user}catch(f){throw console.error("AuthStore - Error en login:",f),r.value=f.message||"Error al iniciar sesión",f}finally{o.value=!1}},p=async(a=!1)=>{if(c.value.pendingUserRequest)return console.log("📦 fetchUser: Esperando petición pendiente..."),await c.value.pendingUserRequest;if(!a&&e.value)return console.log("📦 fetchUser: Usuario ya existe en memoria"),e.value;const n=Date.now();if(!a&&c.value.userFetch&&n-c.value.userFetchTimestamp<c.value.cacheDuration&&(console.log("📦 fetchUser: Usando datos del cache"),c.value.userFetch))return e.value=c.value.userFetch,e.value;const i=localStorage.getItem("user");if(i&&!a)try{const t=JSON.parse(i);return e.value=t,c.value.userFetch=t,c.value.userFetchTimestamp=n,console.log("📦 fetchUser: Usuario cargado desde localStorage"),e.value}catch(f){console.error("Error parsing stored user:",f)}return s.value&&en(t)?(console.log("📦 fetchUser: Obteniendo usuario del servidor..."),c.value.pendingUserRequest=(async()=>{var t;try{const t=await ga.getCurrentUser();return t?(e.value=t,c.value.userFetch=t,c.value.userFetchTimestamp=n,localStorage.setItem("user",JSON.stringify(t)),console.log("✅ fetchUser: Usuario obtenido y guardado"),t):(console.warn("fetchUser: Token inválido, cerrando sesión"),await m(),null)}catch(f){throw console.error("Error fetching user:",f),401===(null==(t=f.response)?void 0:t.status)&&await m(),f}finally{c.value.pendingUserRequest=null}})(),await c.value.pendingUserRequest):(console.log("📦 fetchUser: No hay token de autenticación"),null)},m=async()=>{c.value.userFetch=null,c.value.userFetchTimestamp=0,c.value.pendingUserRequest=null;try{await async function(){try{const t=localStorage.getItem("fcm_token");if(t){try{await ba.deleteDeviceToken({token:t})}catch(f){try{await ga.delete("device-token",{data:{token:t}})}catch(e){console.warn("notificationClient: fallback delete failed",e)}}localStorage.removeItem("fcm_token")}try{await ga.logout()}catch(e){}return localStorage.removeItem("token"),localStorage.removeItem("user"),!0}catch(r){return console.warn("notificationClient: error en logoutAndUnregister",r),!1}}()}catch(a){console.warn("AuthStore - Error en logoutAndUnregister:",a)}e.value=null,t.value=null,s.value=!1,l.value=null,localStorage.removeItem("token"),localStorage.removeItem("userRole"),localStorage.removeItem("user"),localStorage.removeItem("fcm_token");try{const{deleteFCMToken:e}=await G(async()=>{const{deleteFCMToken:e}=await Promise.resolve().then(()=>Ma);return{deleteFCMToken:e}},void 0);await e()}catch(a){console.warn("Error eliminando token FCM:",a)}try{const{useNotificationsStore:e}=await G(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>cr);return{useNotificationsStore:e}},void 0);e().disconnectRealTimeNotifications()}catch(a){console.warn("Error desconectando Firestore listeners:",a)}return!0};return{user:e,token:t,isAuthenticated:s,initialized:i,isLoading:o,error:r,selectedRole:l,currentRole:u,login:h,loginWithGoogle:async a=>{var n,c,d,u,h,p;o.value=!0,r.value=null;try{const o=(await ga.loginWithGoogle(a)).data||{},r=o.token||o.access_token||o.plainTextToken;e.value=o.user,t.value=r||null,s.value=!0,l.value=(null==(n=o.user)?void 0:n.selectedRole)||null;const h=en(t);if(h&&localStorage.setItem("token",h),e.value){try{const t={...e.value},n=(null==a?void 0:a.name)||(null==a?void 0:a.display_name),i=(null==a?void 0:a.avatar)||(null==a?void 0:a.imageUrl)||(null==a?void 0:a.picture),s=null==a?void 0:a.email;t.display_name&&""!==t.display_name||!n||(t.display_name=n),t.name&&""!==t.name||!n||(t.name=n),t.avatar&&""!==t.avatar||!i||(t.avatar=i),t.email&&""!==t.email||!s||(t.email=s),e.value=t}catch(m){}localStorage.setItem("user",JSON.stringify(e.value))}try{const t=(null==a?void 0:a.name)||(null==a?void 0:a.display_name);if(t&&(!(null==(c=e.value)?void 0:c.display_name)||""===e.value.display_name)){const a=new FormData;a.append("display_name",t);const n=await ga.updateProfile(a),i=(null==(d=null==n?void 0:n.data)?void 0:d.user)||(null==(u=null==n?void 0:n.data)?void 0:u.data)||null;i&&(e.value={...e.value,...i},localStorage.setItem("user",JSON.stringify(e.value)))}}catch(v){}try{const{initializePushNotifications:e}=await G(async()=>{const{initializePushNotifications:e}=await Promise.resolve().then(()=>gM);return{initializePushNotifications:e}},void 0);await e();const{useNotificationsStore:t}=await G(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>cr);return{useNotificationsStore:e}},void 0);t().initializeRealTimeNotifications()}catch(g){}return i.value=!0,o}catch(f){throw r.value=(null==(p=null==(h=f.response)?void 0:h.data)?void 0:p.message)||"Error en login con Google",t.value=null,e.value=null,s.value=!1,localStorage.removeItem("token"),localStorage.removeItem("user"),f}finally{o.value=!1}},register:async a=>{var n;o.value=!0,r.value=null;try{const o=(await ga.register(a)).data||{},r=o.token||o.access_token||o.plainTextToken;if(r&&o.user){e.value=o.user,t.value=r,s.value=!0,l.value=(null==(n=o.user)?void 0:n.selectedRole)||null;const a=en(t);a&&localStorage.setItem("token",a),localStorage.setItem("user",JSON.stringify(o.user));try{const{initializePushNotifications:e}=await G(async()=>{const{initializePushNotifications:e}=await Promise.resolve().then(()=>gM);return{initializePushNotifications:e}},void 0);await e();const{useNotificationsStore:t}=await G(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>cr);return{useNotificationsStore:e}},void 0);t().initializeRealTimeNotifications()}catch(c){}return i.value=!0,o.user}if((null==a?void 0:a.email)&&(null==a?void 0:a.password))return await h({email:a.email,password:a.password}),i.value=!0,e.value;throw s.value=!1,new Error("Registro exitoso pero no se pudo iniciar sesión automáticamente")}catch(f){throw r.value=f.message||"Error al registrarse",f}finally{o.value=!1}},logout:m,fetchUser:p,updateProfile:async t=>{try{const a=Object.fromEntries(t.entries());return e.value={...e.value,...a},localStorage.setItem("user",JSON.stringify(e.value)),{data:{user:e.value}}}catch(a){throw console.error("Error actualizando el perfil:",a),a}},forgotPassword:async e=>{o.value=!0,r.value=null;try{return!0}catch(f){throw r.value=f.message||"Error al enviar email de recuperación",f}finally{o.value=!1}},resetPassword:async(e,t)=>{o.value=!0,r.value=null;try{return!0}catch(f){throw r.value=f.message||"Error al restablecer contraseña",f}finally{o.value=!1}},setSelectedRole:a=>{l.value=a,e.value&&(e.value={...e.value,role:a});const n=localStorage.getItem("user");if(n)try{const e=JSON.parse(n);e.selectedRole=a,e.role=a,localStorage.setItem("user",JSON.stringify(e))}catch(f){console.error("AuthStore - Error actualizando usuario en localStorage:",f)}try{const e=localStorage.getItem("token");e&&(t.value=e,s.value=!0)}catch(f){console.warn("AuthStore - Error sincronizando token desde localStorage:",f)}},getSelectedRole:()=>Xa(l),tryToLogin:async()=>{if(i.value)return console.log("📦 tryToLogin: Ya inicializado, retornando estado actual"),s.value;const a=localStorage.getItem("token"),n=localStorage.getItem("user");if(!a)return i.value=!0,!1;try{if(t.value=a,n){const t=JSON.parse(n);e.value=t,l.value=t.selectedRole||t.role,c.value.userFetch=t,c.value.userFetchTimestamp=Date.now()}return await p(!1)?(s.value=!0,i.value=!0,!0):(await m(),!1)}catch(f){return await m(),i.value=!0,!1}}}}),an=Object.freeze(Object.defineProperty({__proto__:null,useAuthStore:tn},Symbol.toStringTag,{value:"Module"}));
/*!
* sweetalert2 v11.22.0
* Released under the MIT License.
*/
function nn(e,t,a){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:a;throw new TypeError("Private element is not present on this object")}function sn(e,t){return e.get(nn(e,t))}function on(e,t,a){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,a)}const rn={},ln=e=>new Promise(t=>{if(!e)return t();const a=window.scrollX,n=window.scrollY;rn.restoreFocusTimeout=setTimeout(()=>{rn.previousActiveElement instanceof HTMLElement?(rn.previousActiveElement.focus(),rn.previousActiveElement=null):document.body&&document.body.focus(),t()},100),window.scrollTo(a,n)}),cn="swal2-",dn=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error","draggable","dragging"].reduce((e,t)=>(e[t]=cn+t,e),{}),un=["success","warning","info","question","error"].reduce((e,t)=>(e[t]=cn+t,e),{}),hn="SweetAlert2:",pn=e=>e.charAt(0).toUpperCase()+e.slice(1),mn=e=>{console.warn(`${hn} ${"object"==typeof e?e.join(" "):e}`)},fn=e=>{console.error(`${hn} ${e}`)},vn=[],gn=(e,t=null)=>{var a;a=`"${e}" is deprecated and will be removed in the next major release.${t?` Use "${t}" instead.`:""}`,vn.includes(a)||(vn.push(a),mn(a))},bn=e=>"function"==typeof e?e():e,wn=e=>e&&"function"==typeof e.toPromise,yn=e=>wn(e)?e.toPromise():Promise.resolve(e),_n=e=>e&&Promise.resolve(e)===e,kn=()=>document.body.querySelector(`.${dn.container}`),Cn=e=>{const t=kn();return t?t.querySelector(e):null},En=e=>Cn(`.${e}`),In=()=>En(dn.popup),Sn=()=>En(dn.icon),Tn=()=>En(dn.title),Nn=()=>En(dn["html-container"]),An=()=>En(dn.image),Pn=()=>En(dn["progress-steps"]),Rn=()=>En(dn["validation-message"]),xn=()=>Cn(`.${dn.actions} .${dn.confirm}`),Dn=()=>Cn(`.${dn.actions} .${dn.cancel}`),On=()=>Cn(`.${dn.actions} .${dn.deny}`),Ln=()=>Cn(`.${dn.loader}`),Mn=()=>En(dn.actions),Un=()=>En(dn.footer),Fn=()=>En(dn["timer-progress-bar"]),qn=()=>En(dn.close),Bn=()=>{const e=In();if(!e)return[];const t=e.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),a=Array.from(t).sort((e,t)=>{const a=parseInt(e.getAttribute("tabindex")||"0"),n=parseInt(t.getAttribute("tabindex")||"0");return a>n?1:a<n?-1:0}),n=e.querySelectorAll('\n  a[href],\n  area[href],\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled]),\n  button:not([disabled]),\n  iframe,\n  object,\n  embed,\n  [tabindex="0"],\n  [contenteditable],\n  audio[controls],\n  video[controls],\n  summary\n'),i=Array.from(n).filter(e=>"-1"!==e.getAttribute("tabindex"));return[...new Set(a.concat(i))].filter(e=>ii(e))},jn=()=>Vn(document.body,dn.shown)&&!Vn(document.body,dn["toast-shown"])&&!Vn(document.body,dn["no-backdrop"]),$n=()=>{const e=In();return!!e&&Vn(e,dn.toast)},zn=(e,t)=>{if(e.textContent="",t){const a=(new DOMParser).parseFromString(t,"text/html"),n=a.querySelector("head");n&&Array.from(n.childNodes).forEach(t=>{e.appendChild(t)});const i=a.querySelector("body");i&&Array.from(i.childNodes).forEach(t=>{t instanceof HTMLVideoElement||t instanceof HTMLAudioElement?e.appendChild(t.cloneNode(!0)):e.appendChild(t)})}},Vn=(e,t)=>{if(!t)return!1;const a=t.split(/\s+/);for(let n=0;n<a.length;n++)if(!e.classList.contains(a[n]))return!1;return!0},Wn=(e,t,a)=>{if(((e,t)=>{Array.from(e.classList).forEach(a=>{Object.values(dn).includes(a)||Object.values(un).includes(a)||Object.values(t.showClass||{}).includes(a)||e.classList.remove(a)})})(e,t),!t.customClass)return;const n=t.customClass[a];n&&("string"==typeof n||n.forEach?Jn(e,n):mn(`Invalid type of customClass.${a}! Expected string or iterable object, got "${typeof n}"`))},Hn=(e,t)=>{if(!t)return null;switch(t){case"select":case"textarea":case"file":return e.querySelector(`.${dn.popup} > .${dn[t]}`);case"checkbox":return e.querySelector(`.${dn.popup} > .${dn.checkbox} input`);case"radio":return e.querySelector(`.${dn.popup} > .${dn.radio} input:checked`)||e.querySelector(`.${dn.popup} > .${dn.radio} input:first-child`);case"range":return e.querySelector(`.${dn.popup} > .${dn.range} input`);default:return e.querySelector(`.${dn.popup} > .${dn.input}`)}},Gn=e=>{if(e.focus(),"file"!==e.type){const t=e.value;e.value="",e.value=t}},Kn=(e,t,a)=>{e&&t&&("string"==typeof t&&(t=t.split(/\s+/).filter(Boolean)),t.forEach(t=>{Array.isArray(e)?e.forEach(e=>{a?e.classList.add(t):e.classList.remove(t)}):a?e.classList.add(t):e.classList.remove(t)}))},Jn=(e,t)=>{Kn(e,t,!0)},Yn=(e,t)=>{Kn(e,t,!1)},Qn=(e,t)=>{const a=Array.from(e.children);for(let n=0;n<a.length;n++){const e=a[n];if(e instanceof HTMLElement&&Vn(e,t))return e}},Zn=(e,t,a)=>{a===`${parseInt(a)}`&&(a=parseInt(a)),a||0===parseInt(a)?e.style.setProperty(t,"number"==typeof a?`${a}px`:a):e.style.removeProperty(t)},Xn=(e,t="flex")=>{e&&(e.style.display=t)},ei=e=>{e&&(e.style.display="none")},ti=(e,t="block")=>{e&&new MutationObserver(()=>{ni(e,e.innerHTML,t)}).observe(e,{childList:!0,subtree:!0})},ai=(e,t,a,n)=>{const i=e.querySelector(t);i&&i.style.setProperty(a,n)},ni=(e,t,a="flex")=>{t?Xn(e,a):ei(e)},ii=e=>!(!e||!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)),si=e=>!!(e.scrollHeight>e.clientHeight),oi=e=>{const t=window.getComputedStyle(e),a=parseFloat(t.getPropertyValue("animation-duration")||"0"),n=parseFloat(t.getPropertyValue("transition-duration")||"0");return a>0||n>0},ri=(e,t=!1)=>{const a=Fn();a&&ii(a)&&(t&&(a.style.transition="none",a.style.width="100%"),setTimeout(()=>{a.style.transition=`width ${e/1e3}s linear`,a.style.width="0%"},10))},li=`\n <div aria-labelledby="${dn.title}" aria-describedby="${dn["html-container"]}" class="${dn.popup}" tabindex="-1">\n   <button type="button" class="${dn.close}"></button>\n   <ul class="${dn["progress-steps"]}"></ul>\n   <div class="${dn.icon}"></div>\n   <img class="${dn.image}" />\n   <h2 class="${dn.title}" id="${dn.title}"></h2>\n   <div class="${dn["html-container"]}" id="${dn["html-container"]}"></div>\n   <input class="${dn.input}" id="${dn.input}" />\n   <input type="file" class="${dn.file}" />\n   <div class="${dn.range}">\n     <input type="range" />\n     <output></output>\n   </div>\n   <select class="${dn.select}" id="${dn.select}"></select>\n   <div class="${dn.radio}"></div>\n   <label class="${dn.checkbox}">\n     <input type="checkbox" id="${dn.checkbox}" />\n     <span class="${dn.label}"></span>\n   </label>\n   <textarea class="${dn.textarea}" id="${dn.textarea}"></textarea>\n   <div class="${dn["validation-message"]}" id="${dn["validation-message"]}"></div>\n   <div class="${dn.actions}">\n     <div class="${dn.loader}"></div>\n     <button type="button" class="${dn.confirm}"></button>\n     <button type="button" class="${dn.deny}"></button>\n     <button type="button" class="${dn.cancel}"></button>\n   </div>\n   <div class="${dn.footer}"></div>\n   <div class="${dn["timer-progress-bar-container"]}">\n     <div class="${dn["timer-progress-bar"]}"></div>\n   </div>\n </div>\n`.replace(/(^|\n)\s*/g,""),ci=()=>{rn.currentInstance.resetValidationMessage()},di=e=>{const t=(()=>{const e=kn();return!!e&&(e.remove(),Yn([document.documentElement,document.body],[dn["no-backdrop"],dn["toast-shown"],dn["has-column"]]),!0)})();if("undefined"==typeof window||"undefined"==typeof document)return void fn("SweetAlert2 requires document to initialize");const a=document.createElement("div");a.className=dn.container,t&&Jn(a,dn["no-transition"]),zn(a,li),a.dataset.swal2Theme=e.theme;const n="string"==typeof(i=e.target)?document.querySelector(i):i;var i;n.appendChild(a),e.topLayer&&(a.setAttribute("popover",""),a.showPopover()),(e=>{const t=In();t.setAttribute("role",e.toast?"alert":"dialog"),t.setAttribute("aria-live",e.toast?"polite":"assertive"),e.toast||t.setAttribute("aria-modal","true")})(e),(e=>{"rtl"===window.getComputedStyle(e).direction&&Jn(kn(),dn.rtl)})(n),(()=>{const e=In(),t=Qn(e,dn.input),a=Qn(e,dn.file),n=e.querySelector(`.${dn.range} input`),i=e.querySelector(`.${dn.range} output`),s=Qn(e,dn.select),o=e.querySelector(`.${dn.checkbox} input`),r=Qn(e,dn.textarea);t.oninput=ci,a.onchange=ci,s.onchange=ci,o.onchange=ci,r.oninput=ci,n.oninput=()=>{ci(),i.value=n.value},n.onchange=()=>{ci(),i.value=n.value}})()},ui=(e,t)=>{e instanceof HTMLElement?t.appendChild(e):"object"==typeof e?hi(e,t):e&&zn(t,e)},hi=(e,t)=>{e.jquery?pi(t,e):zn(t,e.toString())},pi=(e,t)=>{if(e.textContent="",0 in t)for(let a=0;a in t;a++)e.appendChild(t[a].cloneNode(!0));else e.appendChild(t.cloneNode(!0))},mi=(e,t)=>{const a=Mn(),n=Ln();a&&n&&(t.showConfirmButton||t.showDenyButton||t.showCancelButton?Xn(a):ei(a),Wn(a,t,"actions"),function(e,t,a){const n=xn(),i=On(),s=Dn();if(!n||!i||!s)return;vi(n,"confirm",a),vi(i,"deny",a),vi(s,"cancel",a),function(e,t,a,n){if(!n.buttonsStyling)return void Yn([e,t,a],dn.styled);Jn([e,t,a],dn.styled),n.confirmButtonColor&&e.style.setProperty("--swal2-confirm-button-background-color",n.confirmButtonColor);n.denyButtonColor&&t.style.setProperty("--swal2-deny-button-background-color",n.denyButtonColor);n.cancelButtonColor&&a.style.setProperty("--swal2-cancel-button-background-color",n.cancelButtonColor);fi(e),fi(t),fi(a)}(n,i,s,a),a.reverseButtons&&(a.toast?(e.insertBefore(s,n),e.insertBefore(i,n)):(e.insertBefore(s,t),e.insertBefore(i,t),e.insertBefore(n,t)))}(a,n,t),zn(n,t.loaderHtml||""),Wn(n,t,"loader"))};function fi(e){const t=window.getComputedStyle(e);if(t.getPropertyValue("--swal2-action-button-focus-box-shadow"))return;const a=t.backgroundColor.replace(/rgba?\((\d+), (\d+), (\d+).*/,"rgba($1, $2, $3, 0.5)");e.style.setProperty("--swal2-action-button-focus-box-shadow",t.getPropertyValue("--swal2-outline").replace(/ rgba\(.*/,` ${a}`))}function vi(e,t,a){const n=pn(t);ni(e,a[`show${n}Button`],"inline-block"),zn(e,a[`${t}ButtonText`]||""),e.setAttribute("aria-label",a[`${t}ButtonAriaLabel`]||""),e.className=dn[t],Wn(e,a,`${t}Button`)}const gi=(e,t)=>{const a=kn();a&&(!function(e,t){"string"==typeof t?e.style.background=t:t||Jn([document.documentElement,document.body],dn["no-backdrop"])}(a,t.backdrop),function(e,t){if(!t)return;t in dn?Jn(e,dn[t]):(mn('The "position" parameter is not valid, defaulting to "center"'),Jn(e,dn.center))}(a,t.position),function(e,t){if(!t)return;Jn(e,dn[`grow-${t}`])}(a,t.grow),Wn(a,t,"container"))};var bi={innerParams:new WeakMap,domCache:new WeakMap};const wi=["input","file","range","select","radio","checkbox","textarea"],yi=e=>{if(!e.input)return;if(!Ti[e.input])return void fn(`Unexpected type of input! Expected ${Object.keys(Ti).join(" | ")}, got "${e.input}"`);const t=Ii(e.input);if(!t)return;const a=Ti[e.input](t,e);Xn(t),e.inputAutoFocus&&setTimeout(()=>{Gn(a)})},_i=(e,t)=>{const a=In();if(!a)return;const n=Hn(a,e);if(n){(e=>{for(let t=0;t<e.attributes.length;t++){const a=e.attributes[t].name;["id","type","value","style"].includes(a)||e.removeAttribute(a)}})(n);for(const e in t)n.setAttribute(e,t[e])}},ki=e=>{if(!e.input)return;const t=Ii(e.input);t&&Wn(t,e,"input")},Ci=(e,t)=>{!e.placeholder&&t.inputPlaceholder&&(e.placeholder=t.inputPlaceholder)},Ei=(e,t,a)=>{if(a.inputLabel){const n=document.createElement("label"),i=dn["input-label"];n.setAttribute("for",e.id),n.className=i,"object"==typeof a.customClass&&Jn(n,a.customClass.inputLabel),n.innerText=a.inputLabel,t.insertAdjacentElement("beforebegin",n)}},Ii=e=>{const t=In();if(t)return Qn(t,dn[e]||dn.input)},Si=(e,t)=>{["string","number"].includes(typeof t)?e.value=`${t}`:_n(t)||mn(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof t}"`)},Ti={};Ti.text=Ti.email=Ti.password=Ti.number=Ti.tel=Ti.url=Ti.search=Ti.date=Ti["datetime-local"]=Ti.time=Ti.week=Ti.month=(e,t)=>(Si(e,t.inputValue),Ei(e,e,t),Ci(e,t),e.type=t.input,e),Ti.file=(e,t)=>(Ei(e,e,t),Ci(e,t),e),Ti.range=(e,t)=>{const a=e.querySelector("input"),n=e.querySelector("output");return Si(a,t.inputValue),a.type=t.input,Si(n,t.inputValue),Ei(a,e,t),e},Ti.select=(e,t)=>{if(e.textContent="",t.inputPlaceholder){const a=document.createElement("option");zn(a,t.inputPlaceholder),a.value="",a.disabled=!0,a.selected=!0,e.appendChild(a)}return Ei(e,e,t),e},Ti.radio=e=>(e.textContent="",e),Ti.checkbox=(e,t)=>{const a=Hn(In(),"checkbox");a.value="1",a.checked=Boolean(t.inputValue);const n=e.querySelector("span");return zn(n,t.inputPlaceholder||t.inputLabel),a},Ti.textarea=(e,t)=>{Si(e,t.inputValue),Ci(e,t),Ei(e,e,t);return setTimeout(()=>{if("MutationObserver"in window){const a=parseInt(window.getComputedStyle(In()).width);new MutationObserver(()=>{if(!document.body.contains(e))return;const n=e.offsetWidth+(i=e,parseInt(window.getComputedStyle(i).marginLeft)+parseInt(window.getComputedStyle(i).marginRight));var i;n>a?In().style.width=`${n}px`:Zn(In(),"width",t.width)}).observe(e,{attributes:!0,attributeFilter:["style"]})}}),e};const Ni=(e,t)=>{const a=Nn();a&&(ti(a),Wn(a,t,"htmlContainer"),t.html?(ui(t.html,a),Xn(a,"block")):t.text?(a.textContent=t.text,Xn(a,"block")):ei(a),((e,t)=>{const a=In();if(!a)return;const n=bi.innerParams.get(e),i=!n||t.input!==n.input;wi.forEach(e=>{const n=Qn(a,dn[e]);n&&(_i(e,t.inputAttributes),n.className=dn[e],i&&ei(n))}),t.input&&(i&&yi(t),ki(t))})(e,t))},Ai=(e,t)=>{for(const[a,n]of Object.entries(un))t.icon!==a&&Yn(e,n);Jn(e,t.icon&&un[t.icon]),xi(e,t),Pi(),Wn(e,t,"icon")},Pi=()=>{const e=In();if(!e)return;const t=window.getComputedStyle(e).getPropertyValue("background-color"),a=e.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let n=0;n<a.length;n++)a[n].style.backgroundColor=t},Ri=(e,t)=>{if(!t.icon&&!t.iconHtml)return;let a=e.innerHTML,n="";if(t.iconHtml)n=Di(t.iconHtml);else if("success"===t.icon)n='\n  <div class="swal2-success-circular-line-left"></div>\n  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>\n  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>\n  <div class="swal2-success-circular-line-right"></div>\n',a=a.replace(/ style=".*?"/g,"");else if("error"===t.icon)n='\n  <span class="swal2-x-mark">\n    <span class="swal2-x-mark-line-left"></span>\n    <span class="swal2-x-mark-line-right"></span>\n  </span>\n';else if(t.icon){n=Di({question:"?",warning:"!",info:"i"}[t.icon])}a.trim()!==n.trim()&&zn(e,n)},xi=(e,t)=>{if(t.iconColor){e.style.color=t.iconColor,e.style.borderColor=t.iconColor;for(const a of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])ai(e,a,"background-color",t.iconColor);ai(e,".swal2-success-ring","border-color",t.iconColor)}},Di=e=>`<div class="${dn["icon-content"]}">${e}</div>`;let Oi=!1,Li=0,Mi=0,Ui=0,Fi=0;const qi=e=>{const t=In();if(e.target===t||Sn().contains(e.target)){Oi=!0;const a=$i(e);Li=a.clientX,Mi=a.clientY,Ui=parseInt(t.style.insetInlineStart)||0,Fi=parseInt(t.style.insetBlockStart)||0,Jn(t,"swal2-dragging")}},Bi=e=>{const t=In();if(Oi){let{clientX:a,clientY:n}=$i(e);t.style.insetInlineStart=`${Ui+(a-Li)}px`,t.style.insetBlockStart=`${Fi+(n-Mi)}px`}},ji=()=>{const e=In();Oi=!1,Yn(e,"swal2-dragging")},$i=e=>{let t=0,a=0;return e.type.startsWith("mouse")?(t=e.clientX,a=e.clientY):e.type.startsWith("touch")&&(t=e.touches[0].clientX,a=e.touches[0].clientY),{clientX:t,clientY:a}},zi=(e,t)=>{const a=kn(),n=In();if(a&&n){if(t.toast){Zn(a,"width",t.width),n.style.width="100%";const e=Ln();e&&n.insertBefore(e,Sn())}else Zn(n,"width",t.width);Zn(n,"padding",t.padding),t.color&&(n.style.color=t.color),t.background&&(n.style.background=t.background),ei(Rn()),Vi(n,t),t.draggable&&!t.toast?(Jn(n,dn.draggable),(e=>{e.addEventListener("mousedown",qi),document.body.addEventListener("mousemove",Bi),e.addEventListener("mouseup",ji),e.addEventListener("touchstart",qi),document.body.addEventListener("touchmove",Bi),e.addEventListener("touchend",ji)})(n)):(Yn(n,dn.draggable),(e=>{e.removeEventListener("mousedown",qi),document.body.removeEventListener("mousemove",Bi),e.removeEventListener("mouseup",ji),e.removeEventListener("touchstart",qi),document.body.removeEventListener("touchmove",Bi),e.removeEventListener("touchend",ji)})(n))}},Vi=(e,t)=>{const a=t.showClass||{};e.className=`${dn.popup} ${ii(e)?a.popup:""}`,t.toast?(Jn([document.documentElement,document.body],dn["toast-shown"]),Jn(e,dn.toast)):Jn(e,dn.modal),Wn(e,t,"popup"),"string"==typeof t.customClass&&Jn(e,t.customClass),t.icon&&Jn(e,dn[`icon-${t.icon}`])},Wi=e=>{const t=document.createElement("li");return Jn(t,dn["progress-step"]),zn(t,e),t},Hi=e=>{const t=document.createElement("li");return Jn(t,dn["progress-step-line"]),e.progressStepsDistance&&Zn(t,"width",e.progressStepsDistance),t},Gi=(e,t)=>{zi(0,t),gi(0,t),((e,t)=>{const a=Pn();if(!a)return;const{progressSteps:n,currentProgressStep:i}=t;n&&0!==n.length&&void 0!==i?(Xn(a),a.textContent="",i>=n.length&&mn("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),n.forEach((e,s)=>{const o=Wi(e);if(a.appendChild(o),s===i&&Jn(o,dn["active-progress-step"]),s!==n.length-1){const e=Hi(t);a.appendChild(e)}})):ei(a)})(0,t),((e,t)=>{const a=bi.innerParams.get(e),n=Sn();if(!n)return;if(a&&t.icon===a.icon)return Ri(n,t),void Ai(n,t);if(!t.icon&&!t.iconHtml)return void ei(n);if(t.icon&&-1===Object.keys(un).indexOf(t.icon))return fn(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${t.icon}"`),void ei(n);Xn(n),Ri(n,t),Ai(n,t),Jn(n,t.showClass&&t.showClass.icon),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",Pi)})(e,t),((e,t)=>{const a=An();a&&(t.imageUrl?(Xn(a,""),a.setAttribute("src",t.imageUrl),a.setAttribute("alt",t.imageAlt||""),Zn(a,"width",t.imageWidth),Zn(a,"height",t.imageHeight),a.className=dn.image,Wn(a,t,"image")):ei(a))})(0,t),((e,t)=>{const a=Tn();a&&(ti(a),ni(a,t.title||t.titleText,"block"),t.title&&ui(t.title,a),t.titleText&&(a.innerText=t.titleText),Wn(a,t,"title"))})(0,t),((e,t)=>{const a=qn();a&&(zn(a,t.closeButtonHtml||""),Wn(a,t,"closeButton"),ni(a,t.showCloseButton),a.setAttribute("aria-label",t.closeButtonAriaLabel||""))})(0,t),Ni(e,t),mi(0,t),((e,t)=>{const a=Un();a&&(ti(a),ni(a,t.footer,"block"),t.footer&&ui(t.footer,a),Wn(a,t,"footer"))})(0,t);const a=In();"function"==typeof t.didRender&&a&&t.didRender(a),rn.eventEmitter.emit("didRender",a)},Ki=()=>{var e;return null===(e=xn())||void 0===e?void 0:e.click()},Ji=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),Yi=e=>{e.keydownTarget&&e.keydownHandlerAdded&&(e.keydownTarget.removeEventListener("keydown",e.keydownHandler,{capture:e.keydownListenerCapture}),e.keydownHandlerAdded=!1)},Qi=(e,t)=>{var a;const n=Bn();if(n.length)return-2===(e+=t)&&(e=n.length-1),e===n.length?e=0:-1===e&&(e=n.length-1),void n[e].focus();null===(a=In())||void 0===a||a.focus()},Zi=["ArrowRight","ArrowDown"],Xi=["ArrowLeft","ArrowUp"],es=(e,t,a)=>{e&&(t.isComposing||229===t.keyCode||(e.stopKeydownPropagation&&t.stopPropagation(),"Enter"===t.key?ts(t,e):"Tab"===t.key?as(t):[...Zi,...Xi].includes(t.key)?ns(t.key):"Escape"===t.key&&is(t,e,a)))},ts=(e,t)=>{if(!bn(t.allowEnterKey))return;const a=Hn(In(),t.input);if(e.target&&a&&e.target instanceof HTMLElement&&e.target.outerHTML===a.outerHTML){if(["textarea","file"].includes(t.input))return;Ki(),e.preventDefault()}},as=e=>{const t=e.target,a=Bn();let n=-1;for(let i=0;i<a.length;i++)if(t===a[i]){n=i;break}e.shiftKey?Qi(n,-1):Qi(n,1),e.stopPropagation(),e.preventDefault()},ns=e=>{const t=Mn(),a=xn(),n=On(),i=Dn();if(!(t&&a&&n&&i))return;const s=[a,n,i];if(document.activeElement instanceof HTMLElement&&!s.includes(document.activeElement))return;const o=Zi.includes(e)?"nextElementSibling":"previousElementSibling";let r=document.activeElement;if(r){for(let e=0;e<t.children.length;e++){if(r=r[o],!r)return;if(r instanceof HTMLButtonElement&&ii(r))break}r instanceof HTMLButtonElement&&r.focus()}},is=(e,t,a)=>{bn(t.allowEscapeKey)&&(e.preventDefault(),a(Ji.esc))};var ss={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const os=()=>{Array.from(document.body.children).forEach(e=>{e.hasAttribute("data-previous-aria-hidden")?(e.setAttribute("aria-hidden",e.getAttribute("data-previous-aria-hidden")||""),e.removeAttribute("data-previous-aria-hidden")):e.removeAttribute("aria-hidden")})},rs="undefined"!=typeof window&&!!window.GestureEvent,ls=()=>{const e=kn();if(!e)return;let t;e.ontouchstart=e=>{t=cs(e)},e.ontouchmove=e=>{t&&(e.preventDefault(),e.stopPropagation())}},cs=e=>{const t=e.target,a=kn(),n=Nn();return!(!a||!n)&&(!ds(e)&&!us(e)&&(t===a||!(si(a)||!(t instanceof HTMLElement)||((e,t)=>{let a=e;for(;a&&a!==t;){if(si(a))return!0;a=a.parentElement}return!1})(t,n)||"INPUT"===t.tagName||"TEXTAREA"===t.tagName||si(n)&&n.contains(t))))},ds=e=>e.touches&&e.touches.length&&"stylus"===e.touches[0].touchType,us=e=>e.touches&&e.touches.length>1;let hs=null;const ps=e=>{null===hs&&(document.body.scrollHeight>window.innerHeight||"scroll"===e)&&(hs=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${hs+(()=>{const e=document.createElement("div");e.className=dn["scrollbar-measure"],document.body.appendChild(e);const t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t})()}px`)};function ms(e,t,a,n){$n()?ks(e,n):(ln(a).then(()=>ks(e,n)),Yi(rn)),rs?(t.setAttribute("style","display:none !important"),t.removeAttribute("class"),t.innerHTML=""):t.remove(),jn()&&(null!==hs&&(document.body.style.paddingRight=`${hs}px`,hs=null),(()=>{if(Vn(document.body,dn.iosfix)){const e=parseInt(document.body.style.top,10);Yn(document.body,dn.iosfix),document.body.style.top="",document.body.scrollTop=-1*e}})(),os()),Yn([document.documentElement,document.body],[dn.shown,dn["height-auto"],dn["no-backdrop"],dn["toast-shown"]])}function fs(e){e=ws(e);const t=ss.swalPromiseResolve.get(this),a=vs(this);this.isAwaitingPromise?e.isDismissed||(bs(this),t(e)):a&&t(e)}const vs=e=>{const t=In();if(!t)return!1;const a=bi.innerParams.get(e);if(!a||Vn(t,a.hideClass.popup))return!1;Yn(t,a.showClass.popup),Jn(t,a.hideClass.popup);const n=kn();return Yn(n,a.showClass.backdrop),Jn(n,a.hideClass.backdrop),ys(e,t,a),!0};function gs(e){const t=ss.swalPromiseReject.get(this);bs(this),t&&t(e)}const bs=e=>{e.isAwaitingPromise&&(delete e.isAwaitingPromise,bi.innerParams.get(e)||e._destroy())},ws=e=>void 0===e?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},e),ys=(e,t,a)=>{var n;const i=kn(),s=oi(t);"function"==typeof a.willClose&&a.willClose(t),null===(n=rn.eventEmitter)||void 0===n||n.emit("willClose",t),s?_s(e,t,i,a.returnFocus,a.didClose):ms(e,i,a.returnFocus,a.didClose)},_s=(e,t,a,n,i)=>{rn.swalCloseEventFinishedCallback=ms.bind(null,e,a,n,i);const s=function(e){var a;e.target===t&&(null===(a=rn.swalCloseEventFinishedCallback)||void 0===a||a.call(rn),delete rn.swalCloseEventFinishedCallback,t.removeEventListener("animationend",s),t.removeEventListener("transitionend",s))};t.addEventListener("animationend",s),t.addEventListener("transitionend",s)},ks=(e,t)=>{setTimeout(()=>{var a;"function"==typeof t&&t.bind(e.params)(),null===(a=rn.eventEmitter)||void 0===a||a.emit("didClose"),e._destroy&&e._destroy()})},Cs=e=>{let t=In();if(t||new nr,t=In(),!t)return;const a=Ln();$n()?ei(Sn()):Es(t,e),Xn(a),t.setAttribute("data-loading","true"),t.setAttribute("aria-busy","true"),t.focus()},Es=(e,t)=>{const a=Mn(),n=Ln();a&&n&&(!t&&ii(xn())&&(t=xn()),Xn(a),t&&(ei(t),n.setAttribute("data-button-to-replace",t.className),a.insertBefore(n,t)),Jn([e,a],dn.loading))},Is=e=>e.checked?1:0,Ss=e=>e.checked?e.value:null,Ts=e=>e.files&&e.files.length?null!==e.getAttribute("multiple")?e.files:e.files[0]:null,Ns=(e,t)=>{const a=In();if(!a)return;const n=e=>{"select"===t.input?function(e,t,a){const n=Qn(e,dn.select);if(!n)return;const i=(e,t,n)=>{const i=document.createElement("option");i.value=n,zn(i,t),i.selected=Rs(n,a.inputValue),e.appendChild(i)};t.forEach(e=>{const t=e[0],a=e[1];if(Array.isArray(a)){const e=document.createElement("optgroup");e.label=t,e.disabled=!1,n.appendChild(e),a.forEach(t=>i(e,t[1],t[0]))}else i(n,a,t)}),n.focus()}(a,Ps(e),t):"radio"===t.input&&function(e,t,a){const n=Qn(e,dn.radio);if(!n)return;t.forEach(e=>{const t=e[0],i=e[1],s=document.createElement("input"),o=document.createElement("label");s.type="radio",s.name=dn.radio,s.value=t,Rs(t,a.inputValue)&&(s.checked=!0);const r=document.createElement("span");zn(r,i),r.className=dn.label,o.appendChild(s),o.appendChild(r),n.appendChild(o)});const i=n.querySelectorAll("input");i.length&&i[0].focus()}(a,Ps(e),t)};wn(t.inputOptions)||_n(t.inputOptions)?(Cs(xn()),yn(t.inputOptions).then(t=>{e.hideLoading(),n(t)})):"object"==typeof t.inputOptions?n(t.inputOptions):fn("Unexpected type of inputOptions! Expected object, Map or Promise, got "+typeof t.inputOptions)},As=(e,t)=>{const a=e.getInput();a&&(ei(a),yn(t.inputValue).then(n=>{a.value="number"===t.input?`${parseFloat(n)||0}`:`${n}`,Xn(a),a.focus(),e.hideLoading()}).catch(t=>{fn(`Error in inputValue promise: ${t}`),a.value="",Xn(a),a.focus(),e.hideLoading()}))};const Ps=e=>{const t=[];return e instanceof Map?e.forEach((e,a)=>{let n=e;"object"==typeof n&&(n=Ps(n)),t.push([a,n])}):Object.keys(e).forEach(a=>{let n=e[a];"object"==typeof n&&(n=Ps(n)),t.push([a,n])}),t},Rs=(e,t)=>!!t&&t.toString()===e.toString(),xs=(e,t)=>{const a=bi.innerParams.get(e);if(!a.input)return void fn(`The "input" parameter is needed to be set when using returnInputValueOn${pn(t)}`);const n=e.getInput(),i=((e,t)=>{const a=e.getInput();if(!a)return null;switch(t.input){case"checkbox":return Is(a);case"radio":return Ss(a);case"file":return Ts(a);default:return t.inputAutoTrim?a.value.trim():a.value}})(e,a);a.inputValidator?Ds(e,i,t):n&&!n.checkValidity()?(e.enableButtons(),e.showValidationMessage(a.validationMessage||n.validationMessage)):"deny"===t?Os(e,i):Us(e,i)},Ds=(e,t,a)=>{const n=bi.innerParams.get(e);e.disableInput();Promise.resolve().then(()=>yn(n.inputValidator(t,n.validationMessage))).then(n=>{e.enableButtons(),e.enableInput(),n?e.showValidationMessage(n):"deny"===a?Os(e,t):Us(e,t)})},Os=(e,t)=>{const a=bi.innerParams.get(e||void 0);if(a.showLoaderOnDeny&&Cs(On()),a.preDeny){e.isAwaitingPromise=!0;Promise.resolve().then(()=>yn(a.preDeny(t,a.validationMessage))).then(a=>{!1===a?(e.hideLoading(),bs(e)):e.close({isDenied:!0,value:void 0===a?t:a})}).catch(t=>Ms(e||void 0,t))}else e.close({isDenied:!0,value:t})},Ls=(e,t)=>{e.close({isConfirmed:!0,value:t})},Ms=(e,t)=>{e.rejectPromise(t)},Us=(e,t)=>{const a=bi.innerParams.get(e||void 0);if(a.showLoaderOnConfirm&&Cs(),a.preConfirm){e.resetValidationMessage(),e.isAwaitingPromise=!0;Promise.resolve().then(()=>yn(a.preConfirm(t,a.validationMessage))).then(a=>{ii(Rn())||!1===a?(e.hideLoading(),bs(e)):Ls(e,void 0===a?t:a)}).catch(t=>Ms(e||void 0,t))}else Ls(e,t)};function Fs(){const e=bi.innerParams.get(this);if(!e)return;const t=bi.domCache.get(this);ei(t.loader),$n()?e.icon&&Xn(Sn()):qs(t),Yn([t.popup,t.actions],dn.loading),t.popup.removeAttribute("aria-busy"),t.popup.removeAttribute("data-loading"),t.confirmButton.disabled=!1,t.denyButton.disabled=!1,t.cancelButton.disabled=!1}const qs=e=>{const t=e.popup.getElementsByClassName(e.loader.getAttribute("data-button-to-replace"));t.length?Xn(t[0],"inline-block"):ii(xn())||ii(On())||ii(Dn())||ei(e.actions)};function Bs(){const e=bi.innerParams.get(this),t=bi.domCache.get(this);return t?Hn(t.popup,e.input):null}function js(e,t,a){const n=bi.domCache.get(e);t.forEach(e=>{n[e].disabled=a})}function $s(e,t){const a=In();if(a&&e)if("radio"===e.type){const e=a.querySelectorAll(`[name="${dn.radio}"]`);for(let a=0;a<e.length;a++)e[a].disabled=t}else e.disabled=t}function zs(){js(this,["confirmButton","denyButton","cancelButton"],!1)}function Vs(){js(this,["confirmButton","denyButton","cancelButton"],!0)}function Ws(){$s(this.getInput(),!1)}function Hs(){$s(this.getInput(),!0)}function Gs(e){const t=bi.domCache.get(this),a=bi.innerParams.get(this);zn(t.validationMessage,e),t.validationMessage.className=dn["validation-message"],a.customClass&&a.customClass.validationMessage&&Jn(t.validationMessage,a.customClass.validationMessage),Xn(t.validationMessage);const n=this.getInput();n&&(n.setAttribute("aria-invalid","true"),n.setAttribute("aria-describedby",dn["validation-message"]),Gn(n),Jn(n,dn.inputerror))}function Ks(){const e=bi.domCache.get(this);e.validationMessage&&ei(e.validationMessage);const t=this.getInput();t&&(t.removeAttribute("aria-invalid"),t.removeAttribute("aria-describedby"),Yn(t,dn.inputerror))}const Js={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,draggable:!1,animation:!0,theme:"light",showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0,topLayer:!1},Ys=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","draggable","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","theme","willClose"],Qs={allowEnterKey:void 0},Zs=["allowOutsideClick","allowEnterKey","backdrop","draggable","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],Xs=e=>Object.prototype.hasOwnProperty.call(Js,e),eo=e=>-1!==Ys.indexOf(e),to=e=>Qs[e],ao=e=>{Xs(e)||mn(`Unknown parameter "${e}"`)},no=e=>{Zs.includes(e)&&mn(`The parameter "${e}" is incompatible with toasts`)},io=e=>{const t=to(e);t&&gn(e,t)},so=e=>{!1===e.backdrop&&e.allowOutsideClick&&mn('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`'),e.theme&&!["light","dark","auto","minimal","borderless","embed-iframe","bulma","bulma-light","bulma-dark"].includes(e.theme)&&mn(`Invalid theme "${e.theme}"`);for(const t in e)ao(t),e.toast&&no(t),io(t)};function oo(e){const t=kn(),a=In(),n=bi.innerParams.get(this);if(!a||Vn(a,n.hideClass.popup))return void mn("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");const i=ro(e),s=Object.assign({},n,i);so(s),t.dataset.swal2Theme=s.theme,Gi(this,s),bi.innerParams.set(this,s),Object.defineProperties(this,{params:{value:Object.assign({},this.params,e),writable:!1,enumerable:!0}})}const ro=e=>{const t={};return Object.keys(e).forEach(a=>{eo(a)?t[a]=e[a]:mn(`Invalid parameter to update: ${a}`)}),t};function lo(){const e=bi.domCache.get(this),t=bi.innerParams.get(this);t?(e.popup&&rn.swalCloseEventFinishedCallback&&(rn.swalCloseEventFinishedCallback(),delete rn.swalCloseEventFinishedCallback),"function"==typeof t.didDestroy&&t.didDestroy(),rn.eventEmitter.emit("didDestroy"),co(this)):uo(this)}const co=e=>{uo(e),delete e.params,delete rn.keydownHandler,delete rn.keydownTarget,delete rn.currentInstance},uo=e=>{e.isAwaitingPromise?(ho(bi,e),e.isAwaitingPromise=!0):(ho(ss,e),ho(bi,e),delete e.isAwaitingPromise,delete e.disableButtons,delete e.enableButtons,delete e.getInput,delete e.disableInput,delete e.enableInput,delete e.hideLoading,delete e.disableLoading,delete e.showValidationMessage,delete e.resetValidationMessage,delete e.close,delete e.closePopup,delete e.closeModal,delete e.closeToast,delete e.rejectPromise,delete e.update,delete e._destroy)},ho=(e,t)=>{for(const a in e)e[a].delete(t)};var po=Object.freeze({__proto__:null,_destroy:lo,close:fs,closeModal:fs,closePopup:fs,closeToast:fs,disableButtons:Vs,disableInput:Hs,disableLoading:Fs,enableButtons:zs,enableInput:Ws,getInput:Bs,handleAwaitingPromise:bs,hideLoading:Fs,rejectPromise:gs,resetValidationMessage:Ks,showValidationMessage:Gs,update:oo});const mo=(e,t,a)=>{t.popup.onclick=()=>{e&&(fo(e)||e.timer||e.input)||a(Ji.close)}},fo=e=>!!(e.showConfirmButton||e.showDenyButton||e.showCancelButton||e.showCloseButton);let vo=!1;const go=e=>{e.popup.onmousedown=()=>{e.container.onmouseup=function(t){e.container.onmouseup=()=>{},t.target===e.container&&(vo=!0)}}},bo=e=>{e.container.onmousedown=t=>{t.target===e.container&&t.preventDefault(),e.popup.onmouseup=function(t){e.popup.onmouseup=()=>{},(t.target===e.popup||t.target instanceof HTMLElement&&e.popup.contains(t.target))&&(vo=!0)}}},wo=(e,t,a)=>{t.container.onclick=n=>{vo?vo=!1:n.target===t.container&&bn(e.allowOutsideClick)&&a(Ji.backdrop)}},yo=e=>e instanceof Element||(e=>"object"==typeof e&&e.jquery)(e);const _o=()=>{if(rn.timeout)return(()=>{const e=Fn();if(!e)return;const t=parseInt(window.getComputedStyle(e).width);e.style.removeProperty("transition"),e.style.width="100%";const a=t/parseInt(window.getComputedStyle(e).width)*100;e.style.width=`${a}%`})(),rn.timeout.stop()},ko=()=>{if(rn.timeout){const e=rn.timeout.start();return ri(e),e}};let Co=!1;const Eo={};const Io=e=>{for(let t=e.target;t&&t!==document;t=t.parentNode)for(const e in Eo){const a=t.getAttribute(e);if(a)return void Eo[e].fire({template:a})}};rn.eventEmitter=new class{constructor(){this.events={}}_getHandlersByEventName(e){return void 0===this.events[e]&&(this.events[e]=[]),this.events[e]}on(e,t){const a=this._getHandlersByEventName(e);a.includes(t)||a.push(t)}once(e,t){const a=(...n)=>{this.removeListener(e,a),t.apply(this,n)};this.on(e,a)}emit(e,...t){this._getHandlersByEventName(e).forEach(e=>{try{e.apply(this,t)}catch(a){console.error(a)}})}removeListener(e,t){const a=this._getHandlersByEventName(e),n=a.indexOf(t);n>-1&&a.splice(n,1)}removeAllListeners(e){void 0!==this.events[e]&&(this.events[e].length=0)}reset(){this.events={}}};var So=Object.freeze({__proto__:null,argsToParams:e=>{const t={};return"object"!=typeof e[0]||yo(e[0])?["title","html","icon"].forEach((a,n)=>{const i=e[n];"string"==typeof i||yo(i)?t[a]=i:void 0!==i&&fn(`Unexpected type of ${a}! Expected "string" or "Element", got ${typeof i}`)}):Object.assign(t,e[0]),t},bindClickHandler:function(e="data-swal-template"){Eo[e]=this,Co||(document.body.addEventListener("click",Io),Co=!0)},clickCancel:()=>{var e;return null===(e=Dn())||void 0===e?void 0:e.click()},clickConfirm:Ki,clickDeny:()=>{var e;return null===(e=On())||void 0===e?void 0:e.click()},enableLoading:Cs,fire:function(...e){return new this(...e)},getActions:Mn,getCancelButton:Dn,getCloseButton:qn,getConfirmButton:xn,getContainer:kn,getDenyButton:On,getFocusableElements:Bn,getFooter:Un,getHtmlContainer:Nn,getIcon:Sn,getIconContent:()=>En(dn["icon-content"]),getImage:An,getInputLabel:()=>En(dn["input-label"]),getLoader:Ln,getPopup:In,getProgressSteps:Pn,getTimerLeft:()=>rn.timeout&&rn.timeout.getTimerLeft(),getTimerProgressBar:Fn,getTitle:Tn,getValidationMessage:Rn,increaseTimer:e=>{if(rn.timeout){const t=rn.timeout.increase(e);return ri(t,!0),t}},isDeprecatedParameter:to,isLoading:()=>{const e=In();return!!e&&e.hasAttribute("data-loading")},isTimerRunning:()=>!(!rn.timeout||!rn.timeout.isRunning()),isUpdatableParameter:eo,isValidParameter:Xs,isVisible:()=>ii(In()),mixin:function(e){return class extends(this){_main(t,a){return super._main(t,Object.assign({},e,a))}}},off:(e,t)=>{e?t?rn.eventEmitter.removeListener(e,t):rn.eventEmitter.removeAllListeners(e):rn.eventEmitter.reset()},on:(e,t)=>{rn.eventEmitter.on(e,t)},once:(e,t)=>{rn.eventEmitter.once(e,t)},resumeTimer:ko,showLoading:Cs,stopTimer:_o,toggleTimer:()=>{const e=rn.timeout;return e&&(e.running?_o():ko())}});class To{constructor(e,t){this.callback=e,this.remaining=t,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=(new Date).getTime()-this.started.getTime()),this.remaining}increase(e){const t=this.running;return t&&this.stop(),this.remaining+=e,t&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const No=["swal-title","swal-html","swal-footer"],Ao=e=>{const t={};return Array.from(e.querySelectorAll("swal-param")).forEach(e=>{Uo(e,["name","value"]);const a=e.getAttribute("name"),n=e.getAttribute("value");a&&n&&(t[a]="boolean"==typeof Js[a]?"false"!==n:"object"==typeof Js[a]?JSON.parse(n):n)}),t},Po=e=>{const t={};return Array.from(e.querySelectorAll("swal-function-param")).forEach(e=>{const a=e.getAttribute("name"),n=e.getAttribute("value");a&&n&&(t[a]=new Function(`return ${n}`)())}),t},Ro=e=>{const t={};return Array.from(e.querySelectorAll("swal-button")).forEach(e=>{Uo(e,["type","color","aria-label"]);const a=e.getAttribute("type");a&&["confirm","cancel","deny"].includes(a)&&(t[`${a}ButtonText`]=e.innerHTML,t[`show${pn(a)}Button`]=!0,e.hasAttribute("color")&&(t[`${a}ButtonColor`]=e.getAttribute("color")),e.hasAttribute("aria-label")&&(t[`${a}ButtonAriaLabel`]=e.getAttribute("aria-label")))}),t},xo=e=>{const t={},a=e.querySelector("swal-image");return a&&(Uo(a,["src","width","height","alt"]),a.hasAttribute("src")&&(t.imageUrl=a.getAttribute("src")||void 0),a.hasAttribute("width")&&(t.imageWidth=a.getAttribute("width")||void 0),a.hasAttribute("height")&&(t.imageHeight=a.getAttribute("height")||void 0),a.hasAttribute("alt")&&(t.imageAlt=a.getAttribute("alt")||void 0)),t},Do=e=>{const t={},a=e.querySelector("swal-icon");return a&&(Uo(a,["type","color"]),a.hasAttribute("type")&&(t.icon=a.getAttribute("type")),a.hasAttribute("color")&&(t.iconColor=a.getAttribute("color")),t.iconHtml=a.innerHTML),t},Oo=e=>{const t={},a=e.querySelector("swal-input");a&&(Uo(a,["type","label","placeholder","value"]),t.input=a.getAttribute("type")||"text",a.hasAttribute("label")&&(t.inputLabel=a.getAttribute("label")),a.hasAttribute("placeholder")&&(t.inputPlaceholder=a.getAttribute("placeholder")),a.hasAttribute("value")&&(t.inputValue=a.getAttribute("value")));const n=Array.from(e.querySelectorAll("swal-input-option"));return n.length&&(t.inputOptions={},n.forEach(e=>{Uo(e,["value"]);const a=e.getAttribute("value");if(!a)return;const n=e.innerHTML;t.inputOptions[a]=n})),t},Lo=(e,t)=>{const a={};for(const n in t){const i=t[n],s=e.querySelector(i);s&&(Uo(s,[]),a[i.replace(/^swal-/,"")]=s.innerHTML.trim())}return a},Mo=e=>{const t=No.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(e.children).forEach(e=>{const a=e.tagName.toLowerCase();t.includes(a)||mn(`Unrecognized element <${a}>`)})},Uo=(e,t)=>{Array.from(e.attributes).forEach(a=>{-1===t.indexOf(a.name)&&mn([`Unrecognized attribute "${a.name}" on <${e.tagName.toLowerCase()}>.`,""+(t.length?`Allowed attributes are: ${t.join(", ")}`:"To set the value, use HTML within the element.")])})},Fo=e=>{const t=kn(),a=In();"function"==typeof e.willOpen&&e.willOpen(a),rn.eventEmitter.emit("willOpen",a);const n=window.getComputedStyle(document.body).overflowY;$o(t,a,e),setTimeout(()=>{Bo(t,a)},10),jn()&&(jo(t,e.scrollbarPadding,n),(()=>{const e=kn();Array.from(document.body.children).forEach(t=>{t.contains(e)||(t.hasAttribute("aria-hidden")&&t.setAttribute("data-previous-aria-hidden",t.getAttribute("aria-hidden")||""),t.setAttribute("aria-hidden","true"))})})()),$n()||rn.previousActiveElement||(rn.previousActiveElement=document.activeElement),"function"==typeof e.didOpen&&setTimeout(()=>e.didOpen(a)),rn.eventEmitter.emit("didOpen",a),Yn(t,dn["no-transition"])},qo=e=>{const t=In();if(e.target!==t)return;const a=kn();t.removeEventListener("animationend",qo),t.removeEventListener("transitionend",qo),a.style.overflowY="auto"},Bo=(e,t)=>{oi(t)?(e.style.overflowY="hidden",t.addEventListener("animationend",qo),t.addEventListener("transitionend",qo)):e.style.overflowY="auto"},jo=(e,t,a)=>{(()=>{if(rs&&!Vn(document.body,dn.iosfix)){const e=document.body.scrollTop;document.body.style.top=-1*e+"px",Jn(document.body,dn.iosfix),ls()}})(),t&&"hidden"!==a&&ps(a),setTimeout(()=>{e.scrollTop=0})},$o=(e,t,a)=>{Jn(e,a.showClass.backdrop),a.animation?(t.style.setProperty("opacity","0","important"),Xn(t,"grid"),setTimeout(()=>{Jn(t,a.showClass.popup),t.style.removeProperty("opacity")},10)):Xn(t,"grid"),Jn([document.documentElement,document.body],dn.shown),a.heightAuto&&a.backdrop&&!a.toast&&Jn([document.documentElement,document.body],dn["height-auto"])};var zo=(e,t)=>/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(e)?Promise.resolve():Promise.resolve(t||"Invalid email address"),Vo=(e,t)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(e)?Promise.resolve():Promise.resolve(t||"Invalid URL");function Wo(e){!function(e){e.inputValidator||("email"===e.input&&(e.inputValidator=zo),"url"===e.input&&(e.inputValidator=Vo))}(e),e.showLoaderOnConfirm&&!e.preConfirm&&mn("showLoaderOnConfirm is set to true, but preConfirm is not defined.\nshowLoaderOnConfirm should be used together with preConfirm, see usage example:\nhttps://sweetalert2.github.io/#ajax-request"),function(e){(!e.target||"string"==typeof e.target&&!document.querySelector(e.target)||"string"!=typeof e.target&&!e.target.appendChild)&&(mn('Target parameter is not valid, defaulting to "body"'),e.target="body")}(e),"string"==typeof e.title&&(e.title=e.title.split("\n").join("<br />")),di(e)}let Ho;var Go=new WeakMap;class Ko{constructor(...e){if(on(this,Go,void 0),"undefined"==typeof window)return;Ho=this;const t=Object.freeze(this.constructor.argsToParams(e));var a,n,i;this.params=t,this.isAwaitingPromise=!1,a=Go,n=this,i=this._main(Ho.params),a.set(nn(a,n),i)}_main(e,t={}){if(so(Object.assign({},t,e)),rn.currentInstance){const e=ss.swalPromiseResolve.get(rn.currentInstance),{isAwaitingPromise:t}=rn.currentInstance;rn.currentInstance._destroy(),t||e({isDismissed:!0}),jn()&&os()}rn.currentInstance=Ho;const a=Yo(e,t);Wo(a),Object.freeze(a),rn.timeout&&(rn.timeout.stop(),delete rn.timeout),clearTimeout(rn.restoreFocusTimeout);const n=Qo(Ho);return Gi(Ho,a),bi.innerParams.set(Ho,a),Jo(Ho,n,a)}then(e){return sn(Go,this).then(e)}finally(e){return sn(Go,this).finally(e)}}const Jo=(e,t,a)=>new Promise((n,i)=>{const s=t=>{e.close({isDismissed:!0,dismiss:t})};ss.swalPromiseResolve.set(e,n),ss.swalPromiseReject.set(e,i),t.confirmButton.onclick=()=>{(e=>{const t=bi.innerParams.get(e);e.disableButtons(),t.input?xs(e,"confirm"):Us(e,!0)})(e)},t.denyButton.onclick=()=>{(e=>{const t=bi.innerParams.get(e);e.disableButtons(),t.returnInputValueOnDeny?xs(e,"deny"):Os(e,!1)})(e)},t.cancelButton.onclick=()=>{((e,t)=>{e.disableButtons(),t(Ji.cancel)})(e,s)},t.closeButton.onclick=()=>{s(Ji.close)},((e,t,a)=>{e.toast?mo(e,t,a):(go(t),bo(t),wo(e,t,a))})(a,t,s),((e,t,a)=>{Yi(e),t.toast||(e.keydownHandler=e=>es(t,e,a),e.keydownTarget=t.keydownListenerCapture?window:In(),e.keydownListenerCapture=t.keydownListenerCapture,e.keydownTarget.addEventListener("keydown",e.keydownHandler,{capture:e.keydownListenerCapture}),e.keydownHandlerAdded=!0)})(rn,a,s),((e,t)=>{"select"===t.input||"radio"===t.input?Ns(e,t):["text","email","number","tel","textarea"].some(e=>e===t.input)&&(wn(t.inputValue)||_n(t.inputValue))&&(Cs(xn()),As(e,t))})(e,a),Fo(a),Zo(rn,a,s),Xo(t,a),setTimeout(()=>{t.container.scrollTop=0})}),Yo=(e,t)=>{const a=(e=>{const t="string"==typeof e.template?document.querySelector(e.template):e.template;if(!t)return{};const a=t.content;return Mo(a),Object.assign(Ao(a),Po(a),Ro(a),xo(a),Do(a),Oo(a),Lo(a,No))})(e),n=Object.assign({},Js,t,a,e);return n.showClass=Object.assign({},Js.showClass,n.showClass),n.hideClass=Object.assign({},Js.hideClass,n.hideClass),!1===n.animation&&(n.showClass={backdrop:"swal2-noanimation"},n.hideClass={}),n},Qo=e=>{const t={popup:In(),container:kn(),actions:Mn(),confirmButton:xn(),denyButton:On(),cancelButton:Dn(),loader:Ln(),closeButton:qn(),validationMessage:Rn(),progressSteps:Pn()};return bi.domCache.set(e,t),t},Zo=(e,t,a)=>{const n=Fn();ei(n),t.timer&&(e.timeout=new To(()=>{a("timer"),delete e.timeout},t.timer),t.timerProgressBar&&(Xn(n),Wn(n,t,"timerProgressBar"),setTimeout(()=>{e.timeout&&e.timeout.running&&ri(t.timer)})))},Xo=(e,t)=>{if(!t.toast)return bn(t.allowEnterKey)?void(er(e)||tr(e,t)||Qi(-1,1)):(gn("allowEnterKey"),void ar())},er=e=>{const t=Array.from(e.popup.querySelectorAll("[autofocus]"));for(const a of t)if(a instanceof HTMLElement&&ii(a))return a.focus(),!0;return!1},tr=(e,t)=>t.focusDeny&&ii(e.denyButton)?(e.denyButton.focus(),!0):t.focusCancel&&ii(e.cancelButton)?(e.cancelButton.focus(),!0):!(!t.focusConfirm||!ii(e.confirmButton))&&(e.confirmButton.focus(),!0),ar=()=>{document.activeElement instanceof HTMLElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()};if("undefined"!=typeof window&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|by|xn--p1ai)$/)){const e=new Date,t=localStorage.getItem("swal-initiation");t?(e.getTime()-Date.parse(t))/864e5>3&&setTimeout(()=>{document.body.style.pointerEvents="none";const e=document.createElement("audio");e.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",e.loop=!0,document.body.appendChild(e),setTimeout(()=>{e.play().catch(()=>{})},2500)},500):localStorage.setItem("swal-initiation",`${e}`)}Ko.prototype.disableButtons=Vs,Ko.prototype.enableButtons=zs,Ko.prototype.getInput=Bs,Ko.prototype.disableInput=Hs,Ko.prototype.enableInput=Ws,Ko.prototype.hideLoading=Fs,Ko.prototype.disableLoading=Fs,Ko.prototype.showValidationMessage=Gs,Ko.prototype.resetValidationMessage=Ks,Ko.prototype.close=fs,Ko.prototype.closePopup=fs,Ko.prototype.closeModal=fs,Ko.prototype.closeToast=fs,Ko.prototype.rejectPromise=gs,Ko.prototype.update=oo,Ko.prototype._destroy=lo,Object.assign(Ko,So),Object.keys(po).forEach(e=>{Ko[e]=function(...t){return Ho&&Ho[e]?Ho[e](...t):null}}),Ko.DismissReason=Ji,Ko.version="11.22.0";const nr=Ko;nr.default=nr,"undefined"!=typeof document&&function(e,t){var a=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(a),a.styleSheet)a.styleSheet.disabled||(a.styleSheet.cssText=t);else try{a.innerHTML=t}catch(n){a.innerText=t}}(document,':root{--swal2-outline: 0 0 0 3px rgba(100, 150, 200, 0.5);--swal2-container-padding: 0.625em;--swal2-backdrop: rgba(0, 0, 0, 0.4);--swal2-backdrop-transition: background-color 0.1s;--swal2-width: 32em;--swal2-padding: 0 0 1.25em;--swal2-border: none;--swal2-border-radius: 0.3125rem;--swal2-background: white;--swal2-color: #545454;--swal2-show-animation: swal2-show 0.3s;--swal2-hide-animation: swal2-hide 0.15s forwards;--swal2-icon-zoom: 1;--swal2-icon-animations: true;--swal2-title-padding: 0.8em 1em 0;--swal2-html-container-padding: 1em 1.6em 0.3em;--swal2-input-border: 1px solid #d9d9d9;--swal2-input-border-radius: 0.1875em;--swal2-input-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-background: transparent;--swal2-input-transition: border-color 0.2s, box-shadow 0.2s;--swal2-input-hover-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-focus-border: 1px solid #b4dbed;--swal2-input-focus-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px $swal2-outline-color;--swal2-progress-step-background: #add8e6;--swal2-validation-message-background: #f0f0f0;--swal2-validation-message-color: #666;--swal2-footer-border-color: #eee;--swal2-footer-background: transparent;--swal2-footer-color: inherit;--swal2-close-button-position: initial;--swal2-close-button-inset: auto;--swal2-close-button-font-size: 2.5em;--swal2-close-button-color: #ccc;--swal2-close-button-transition: color 0.2s, box-shadow 0.2s;--swal2-close-button-outline: initial;--swal2-close-button-box-shadow: inset 0 0 0 3px transparent;--swal2-close-button-focus-box-shadow: inset var(--swal2-outline);--swal2-close-button-hover-transform: none;--swal2-actions-justify-content: center;--swal2-actions-width: auto;--swal2-actions-margin: 1.25em auto 0;--swal2-actions-padding: 0;--swal2-actions-border-radius: 0;--swal2-actions-background: transparent;--swal2-action-button-transition: background-color 0.2s, box-shadow 0.2s;--swal2-action-button-hover: black 10%;--swal2-action-button-active: black 10%;--swal2-confirm-button-box-shadow: none;--swal2-confirm-button-border-radius: 0.25em;--swal2-confirm-button-background-color: #7066e0;--swal2-confirm-button-color: #fff;--swal2-deny-button-box-shadow: none;--swal2-deny-button-border-radius: 0.25em;--swal2-deny-button-background-color: #dc3741;--swal2-deny-button-color: #fff;--swal2-cancel-button-box-shadow: none;--swal2-cancel-button-border-radius: 0.25em;--swal2-cancel-button-background-color: #6e7881;--swal2-cancel-button-color: #fff;--swal2-toast-show-animation: swal2-toast-show 0.5s;--swal2-toast-hide-animation: swal2-toast-hide 0.1s forwards;--swal2-toast-border: none;--swal2-toast-box-shadow: 0 0 1px hsl(0deg 0% 0% / 0.075), 0 1px 2px hsl(0deg 0% 0% / 0.075), 1px 2px 4px hsl(0deg 0% 0% / 0.075), 1px 3px 8px hsl(0deg 0% 0% / 0.075), 2px 4px 16px hsl(0deg 0% 0% / 0.075)}[data-swal2-theme=dark]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}@media(prefers-color-scheme: dark){[data-swal2-theme=auto]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px var(--swal2-backdrop)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:var(--swal2-container-padding);overflow-x:hidden;transition:var(--swal2-backdrop-transition);-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:var(--swal2-backdrop)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container)[popover]{width:auto;border:0}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:var(--swal2-width);max-width:100%;padding:var(--swal2-padding);border:var(--swal2-border);border-radius:var(--swal2-border-radius);background:var(--swal2-background);color:var(--swal2-color);font-family:inherit;font-size:1rem;container-name:swal2-popup}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:var(--swal2-title-padding);color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:var(--swal2-actions-justify-content);width:var(--swal2-actions-width);margin:var(--swal2-actions-margin);padding:var(--swal2-actions-padding);border-radius:var(--swal2-actions-border-radius);background:var(--swal2-actions-background)}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:var(--swal2-action-button-transition);border:none;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border-radius:var(--swal2-confirm-button-border-radius);background:initial;background-color:var(--swal2-confirm-button-background-color);box-shadow:var(--swal2-confirm-button-box-shadow);color:var(--swal2-confirm-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):hover{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):active{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border-radius:var(--swal2-deny-button-border-radius);background:initial;background-color:var(--swal2-deny-button-background-color);box-shadow:var(--swal2-deny-button-box-shadow);color:var(--swal2-deny-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):hover{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):active{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border-radius:var(--swal2-cancel-button-border-radius);background:initial;background-color:var(--swal2-cancel-button-background-color);box-shadow:var(--swal2-cancel-button-box-shadow);color:var(--swal2-cancel-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):hover{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):active{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none;box-shadow:var(--swal2-action-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-styled)[disabled]:not(.swal2-loading){opacity:.4}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid var(--swal2-footer-border-color);background:var(--swal2-footer-background);color:var(--swal2-footer-color);font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:var(--swal2-border-radius);border-bottom-left-radius:var(--swal2-border-radius)}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){position:var(--swal2-close-button-position);inset:var(--swal2-close-button-inset);z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:var(--swal2-close-button-transition);border:none;border-radius:var(--swal2-border-radius);outline:var(--swal2-close-button-outline);background:rgba(0,0,0,0);color:var(--swal2-close-button-color);font-family:monospace;font-size:var(--swal2-close-button-font-size);cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:var(--swal2-close-button-hover-transform);background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:var(--swal2-close-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:var(--swal2-html-container-padding);overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:var(--swal2-input-transition);border:var(--swal2-input-border);border-radius:var(--swal2-input-border-radius);background:var(--swal2-input-background);box-shadow:var(--swal2-input-box-shadow);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):hover,div:where(.swal2-container) input:where(.swal2-file):hover,div:where(.swal2-container) textarea:where(.swal2-textarea):hover{box-shadow:var(--swal2-input-hover-box-shadow)}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:var(--swal2-input-focus-border);outline:none;box-shadow:var(--swal2-input-focus-box-shadow)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:var(--swal2-background)}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:var(--swal2-input-background);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:var(--swal2-input-background);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:var(--swal2-background);color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:var(--swal2-validation-message-background);color:var(--swal2-validation-message-color);font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:var(--swal2-progress-step-background);color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:var(--swal2-progress-step-background)}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;zoom:var(--swal2-icon-zoom);border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}}div:where(.swal2-icon).swal2-warning{border-color:#f8bb86;color:#f8bb86}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}}div:where(.swal2-icon).swal2-info{border-color:#3fc3ee;color:#3fc3ee}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}}div:where(.swal2-icon).swal2-question{border-color:#87adbd;color:#87adbd}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:var(--swal2-show-animation)}.swal2-hide{animation:var(--swal2-hide-animation)}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;border:var(--swal2-toast-border);background:var(--swal2-background);box-shadow:var(--swal2-toast-box-shadow);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}@container swal2-popup style(--swal2-icon-animations:true){.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}}.swal2-toast.swal2-show{animation:var(--swal2-toast-show-animation)}.swal2-toast.swal2-hide{animation:var(--swal2-toast-hide-animation)}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}');const ir=nr.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",nr.stopTimer),e.addEventListener("mouseleave",nr.resumeTimer)}}),sr=e=>{ir.fire({icon:"success",title:e})},or=e=>{ir.fire({icon:"error",title:e})},rr=async(e,t,a="Confirmar",n="Cancelar",i="warning")=>(await nr.fire({title:e,text:t,icon:i,showCancelButton:!0,confirmButtonColor:"danger"===i?"#dc3545":"#007bff",cancelButtonColor:"#6c757d",confirmButtonText:a,cancelButtonText:n,reverseButtons:!0})).isConfirmed,lr=t("notifications",{state:()=>({unreadNotifications:[],readNotifications:[],unreadCount:0,waiterUnreadNotifications:[],waiterReadNotifications:[],waiterUnreadCount:0,adminNotifications:[],loading:!1,loadingWaiter:!1,loadingAdmin:!1,globalNotificationsEnabled:!0,soundEnabled:!0,tableNotificationsEnabled:{},isConnected:!1,realtimeListener:null,lastNotificationSound:0}),getters:{allUnreadNotifications:e=>[...e.unreadNotifications,...e.waiterUnreadNotifications],allReadNotifications:e=>[...e.readNotifications,...e.waiterReadNotifications],totalUnreadCount:e=>e.unreadCount+e.waiterUnreadCount,hasUnreadNotifications:e=>e.unreadCount>0||e.waiterUnreadCount>0,getNotificationsByType:e=>t=>[...e.unreadNotifications,...e.readNotifications,...e.waiterUnreadNotifications,...e.waiterReadNotifications].filter(e=>e.type===t),hasNotification:e=>t=>!!(e.unreadNotifications.find(e=>e.id===t)||e.readNotifications.find(e=>e.id===t)||e.waiterUnreadNotifications.find(e=>e.id===t)||e.waiterReadNotifications.find(e=>e.id===t))},actions:{async loadNotifications(){try{this.loading=!0;const e=await ba.getNotifications();return this.unreadNotifications=e.unread_notifications||[],this.readNotifications=e.read_notifications||[],this.unreadCount=e.unread_count||0,e}catch(e){throw console.error("Error cargando notificaciones:",e),or("Error al cargar las notificaciones"),e}finally{this.loading=!1}},async handleNotification(e,t){try{const a=await ba.handleNotification(e,t);if("mark_as_read"===t){const t=this.unreadNotifications.find(t=>t.id===e);t&&(this.unreadNotifications=this.unreadNotifications.filter(t=>t.id!==e),this.readNotifications.unshift(t),this.unreadCount=Math.max(0,this.unreadCount-1))}else"delete"===t&&(this.unreadNotifications=this.unreadNotifications.filter(t=>t.id!==e),this.readNotifications=this.readNotifications.filter(t=>t.id!==e));return sr(a.message||"Notificación procesada correctamente"),a}catch(a){throw console.error("Error manejando notificación:",a),or("Error al procesar la notificación"),a}},async markAllAsRead(){try{if(0===this.unreadNotifications.length)return;await ba.markAllAsRead(this.unreadNotifications),this.readNotifications.unshift(...this.unreadNotifications),this.unreadNotifications=[],this.unreadCount=0,sr("Todas las notificaciones marcadas como leídas")}catch(e){throw console.error("Error marcando todas como leídas:",e),or("Error al marcar como leídas"),e}},async deleteAllRead(){try{if(0===this.readNotifications.length)return;await ba.deleteAllRead(this.readNotifications),this.readNotifications=[],sr("Notificaciones leídas eliminadas")}catch(e){throw console.error("Error eliminando notificaciones leídas:",e),or("Error al eliminar notificaciones"),e}},async loadWaiterNotifications(){try{this.loadingWaiter=!0;const e=await ba.getWaiterNotifications();return this.waiterUnreadNotifications=e.unread_notifications||[],this.waiterReadNotifications=e.read_notifications||[],this.waiterUnreadCount=e.unread_count||0,e}catch(e){throw console.error("Error cargando notificaciones de mozo:",e),or("Error al cargar las notificaciones"),e}finally{this.loadingWaiter=!1}},async handleWaiterNotification(e,t){try{const a=await ba.handleWaiterNotification(e,t);if("mark_as_read"===t){const t=this.waiterUnreadNotifications.find(t=>t.id===e);t&&(this.waiterUnreadNotifications=this.waiterUnreadNotifications.filter(t=>t.id!==e),this.waiterReadNotifications.unshift(t),this.waiterUnreadCount=Math.max(0,this.waiterUnreadCount-1))}else"delete"===t&&(this.waiterUnreadNotifications=this.waiterUnreadNotifications.filter(t=>t.id!==e),this.waiterReadNotifications=this.waiterReadNotifications.filter(t=>t.id!==e));return sr(a.message||"Notificación procesada correctamente"),a}catch(a){throw console.error("Error manejando notificación de mozo:",a),or("Error al procesar la notificación"),a}},async setWaiterGlobalNotifications(e){try{const t=await ba.waiterGlobalNotifications(e);return this.globalNotificationsEnabled=e,sr(t.message||"Configuración actualizada"),t}catch(t){throw console.error("Error configurando notificaciones globales:",t),or("Error al actualizar la configuración"),t}},async loadAdminNotifications(){try{this.loadingAdmin=!0;const e=await ba.getAdminNotifications();return this.adminNotifications=e.notifications||[],e}catch(e){throw console.error("Error cargando notificaciones de administrador:",e),or("Error al cargar las notificaciones"),e}finally{this.loadingAdmin=!1}},async storeDeviceToken(e,t="web"){try{const a=await ba.storeDeviceToken(e,t);return sr("Token de dispositivo guardado"),a}catch(a){throw console.error("Error guardando token de dispositivo:",a),or("Error al guardar el token"),a}},async deleteDeviceToken(e){try{const t=await ba.deleteDeviceToken(e);return sr("Token de dispositivo eliminado"),t}catch(t){throw console.error("Error eliminando token de dispositivo:",t),or("Error al eliminar el token"),t}},async toggleTableNotifications(e){try{const t=await ba.toggleTableNotifications(e);return this.tableNotificationsEnabled[e]=t.notifications_enabled,sr(t.message||"Estado de notificaciones actualizado"),t}catch(t){throw console.error("Error alternando notificaciones de mesa:",t),or("Error al actualizar notificaciones de mesa"),t}},async initializeRealTimeNotifications(){var e;console.log("🚨🚨🚨 ADMIN DEBUG: initializeRealTimeNotifications CALLED - NEW CODE LOADED! 🚨🚨🚨");const t=tn();try{const n=t.user;if(console.log("🔍 DEBUG: initializeRealTimeNotifications called with user:",n),!n)return console.log("🔍 DEBUG: No user found, marking as connected and returning"),this.isConnected=!0,!0;console.log("🔍 DEBUG: Importing staffRealtime services...");const{startStaffRealtimeForAdmin:i,startStaffRealtimeForUser:s}=await G(async()=>{const{startStaffRealtimeForAdmin:e,startStaffRealtimeForUser:t}=await import("./staffRealtime-CQQLemJX.js");return{startStaffRealtimeForAdmin:e,startStaffRealtimeForUser:t}},__vite__mapDeps([6,1,2])),o=n.role||n.selectedRole;console.log("🔍 DEBUG: User role determined as:",o);let r=n.business_id;if(console.log("🔍 DEBUG: Initial business_id from user:",r),"admin"===o&&!r)try{console.log("🔍 DEBUG: Trying to get business_id from adminStore...");const{useAdminStore:t}=await G(async()=>{const{useAdminStore:e}=await Promise.resolve().then(()=>EE);return{useAdminStore:e}},void 0),a=t();r=null==(e=a.businessData)?void 0:e.id,console.log("🔍 DEBUG: business_id from adminStore:",r),console.log("🔍 DEBUG: Full adminStore.businessData:",a.businessData)}catch(a){console.error("🔍 DEBUG: Error loading admin store for business_id:",a)}if(console.log("🔍 DEBUG: Final values - role:",o,"user.business_id:",n.business_id,"final businessId:",r),"admin"===o&&r){console.log("🔔 Admin notifications: Starting realtime listener for businessId:",r);let e=Date.now();await i(r,t=>{try{if(console.log("🔔 Admin notifications: Received data:",t),t&&t.stats&&window.dispatchEvent(new CustomEvent("businessStaffStatsUpdate",{detail:{businessId:r,stats:t.stats,recent_activity:t.recent_activity}})),t&&t.recent_activity){const a=t.recent_activity,n=a.last_request_status,i=a.last_request_name||"Usuario",s=a.last_update||0;console.log("🔔 Admin notifications: Processing activity:",a,"status:",n),console.log("🔔 Admin notifications: Update time:",s,"Last seen:",e);const o=s>e;if(console.log("🔔 Admin notifications: Is new request?",o),"pending"===n||o){console.log("🔔 Admin notifications: Creating notification for","pending"===n?"PENDING":"NEW REQUEST");const e={id:`staff_req_${a.last_request_id}_${s}`,type:"staff_request",data:{title:"👥 Nueva solicitud de personal",message:`${i} quiere unirse a tu negocio`,route:"/admin/staff/requests",business_id:r,staff_request_id:a.last_request_id,requester_name:i},created_at:(new Date).toISOString()};this.addNewNotification(e)}s>e&&(e=s)}}catch(a){console.error("Error handling admin realtime staff update",a)}})}return n.id&&await s(n.id,e=>{try{if(!e)return;const t=e.current_request;if(t&&t.status){const e=t.status,a=t.business_name||"el negocio";if("confirmed"===e){const e={id:`user_staff_${t.id||Date.now()}`,type:"staff_request_approved",data:{title:"✅ ¡Solicitud aprobada!",message:`${a} te ha aceptado como parte del equipo`,route:"/waiter/dashboard",user_id:n.id,request:t,business_name:a},created_at:(new Date).toISOString()};this.addNewNotification(e),window.dispatchEvent(new CustomEvent("staffRequestApproved",{detail:{request:t,businessName:a}}))}else if("rejected"===e){const e={id:`user_staff_${t.id||Date.now()}`,type:"staff_request_rejected",data:{title:"❌ Solicitud rechazada",message:`${a} ha rechazado tu solicitud`,route:"/waiter/dashboard",user_id:n.id,request:t,business_name:a},created_at:(new Date).toISOString()};this.addNewNotification(e)}else if("invited"===e){const e={id:`user_staff_${t.id||Date.now()}`,type:"staff_invitation",data:{title:"📩 Invitación de trabajo",message:`${a} te ha invitado a trabajar con ellos`,route:"/staff/invitations",user_id:n.id,request:t,business_name:a},created_at:(new Date).toISOString()};this.addNewNotification(e)}}}catch(t){console.error("Error handling user realtime staff update",t)}}),this.isConnected=!0,!0}catch(n){return console.error("Error inicializando realtime staff listeners:",n),this.isConnected=!1,!1}},async disconnectRealTimeNotifications(){var e;try{const a=tn().user;if(a){const{stopStaffRealtimeForAdmin:n,stopStaffRealtimeForUser:i}=await G(async()=>{const{stopStaffRealtimeForAdmin:e,stopStaffRealtimeForUser:t}=await import("./staffRealtime-CQQLemJX.js");return{stopStaffRealtimeForAdmin:e,stopStaffRealtimeForUser:t}},__vite__mapDeps([6,1,2]));let s=a.business_id;if(!s&&("admin"===a.role||"admin"===a.selectedRole))try{const{useAdminStore:t}=await G(async()=>{const{useAdminStore:e}=await Promise.resolve().then(()=>EE);return{useAdminStore:e}},void 0);s=null==(e=t().businessData)?void 0:e.id}catch(t){console.warn("Could not load admin store for disconnecting:",t)}s&&n(s),a.id&&i(a.id)}}catch(a){console.warn("Error desconectando staff realtime listeners:",a)}this.isConnected=!1},addNewNotification(e){var t,a;const n=this.unreadNotifications.find(t=>t.id===e.id),i=this.waiterUnreadNotifications.find(t=>t.id===e.id);if(n||i)return void this.updateExistingNotification(e);"waiter_call"===e.type||"table_call"===e.type?(this.waiterUnreadNotifications.unshift(e),this.waiterUnreadCount++):(this.unreadNotifications.unshift(e),this.unreadCount++);const s=(null==(t=e.data)?void 0:t.key)||(null==(a=e.data)?void 0:a.notification_key)||e.notification_key;if(s&&s.startsWith("waiter_unlinked_")){console.log("🚫 Waiter unlinked notification detected:",e);const t=s.replace("waiter_unlinked_","");window.dispatchEvent(new CustomEvent("waiterUnlinked",{detail:{notification:e,businessId:t}}))}this.playNotificationSound(e.type||"default"),this.showEnhancedBrowserNotification(e)},updateExistingNotification(e){const t=this.unreadNotifications.findIndex(t=>t.id===e.id);if(-1!==t){if(this.unreadNotifications[t]=e,e.read_at){const e=this.unreadNotifications.splice(t,1)[0];this.readNotifications.unshift(e),this.unreadCount=Math.max(0,this.unreadCount-1)}return}const a=this.waiterUnreadNotifications.findIndex(t=>t.id===e.id);if(-1===a);else if(this.waiterUnreadNotifications[a]=e,e.read_at){const e=this.waiterUnreadNotifications.splice(a,1)[0];this.waiterReadNotifications.unshift(e),this.waiterUnreadCount=Math.max(0,this.waiterUnreadCount-1)}},removeNotification(e){this.unreadNotifications=this.unreadNotifications.filter(t=>t.id!==e),this.readNotifications=this.readNotifications.filter(t=>t.id!==e),this.waiterUnreadNotifications=this.waiterUnreadNotifications.filter(t=>t.id!==e),this.waiterReadNotifications=this.waiterReadNotifications.filter(t=>t.id!==e),this.unreadCount=this.unreadNotifications.length,this.waiterUnreadCount=this.waiterUnreadNotifications.length},playNotificationSound(e="default"){if(!this.soundEnabled||!this.globalNotificationsEnabled)return;const t=Date.now();if(!(t-this.lastNotificationSound<2e3)){this.lastNotificationSound=t;try{const t=new(window.AudioContext||window.webkitAudioContext),a=t.createOscillator(),n=t.createGain();a.connect(n),n.connect(t.destination);let i=800,s=600,o=.4,r=.5;switch(e){case"staff_request":case"staff_join_success":i=1200,s=900,o=.6,r=.7;break;case"waiter_call":case"table_call":case"call_waiter":i=1e3,s=800,o=.5,r=.8;break;case"system":case"info":i=700,s=500,o=.3,r=.4;break;case"warning":i=600,s=400,o=.7,r=.6}a.frequency.setValueAtTime(i,t.currentTime),a.frequency.setValueAtTime(s,t.currentTime+.1),n.gain.setValueAtTime(r,t.currentTime),n.gain.exponentialRampToValueAtTime(.01,t.currentTime+o),a.start(t.currentTime),a.stop(t.currentTime+o)}catch(a){console.warn("Web Audio API failed, using fallback sound:",a);try{const e=new Audio;e.src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+nfvnUjBjd+zO/eizEIDGKw5+mqWRMJRZzp4b5+JgU2jdXzzX4tBSF1xe/ejzQIElyx6OyrYRYJSKXi67RiHAY8k9nyyXkpBSR+zO/ijDEIDWOz6OyrXRQIR6Hn4L55KAU5jNTx0IAvBh1qtOnnqlkSCUig5OqyYhsGPJHY8sp7KgUle8vt3o4yBxFYr+ftrWIaBjeL0/LNfjAGIn3M7+CNMA==",e.volume=.5,e.play().catch(()=>{})}catch(n){console.warn("Could not play notification sound:",n)}}}},showEnhancedBrowserNotification(e){var t,a;try{if("undefined"==typeof Notification)return;if("granted"!==Notification.permission)return;const n=new Notification((null==(t=e.data)?void 0:t.title)||e.title||"Notificación",{body:(null==(a=e.data)?void 0:a.message)||e.message||"",icon:"/favicon.ico",tag:`notification-${e.id}`,requireInteraction:!0,badge:"/favicon.ico"});n.onclick=()=>{var t;window.focus(),n.close(),(null==(t=e.data)?void 0:t.route)&&window.dispatchEvent(new CustomEvent("notificationClick",{detail:{route:e.data.route}}))},["staff_request","waiter_call"].includes(e.type)||setTimeout(()=>{n.close()},8e3)}catch(n){console.warn("Could not show browser notification:",n)}},toggleSound(){this.soundEnabled=!this.soundEnabled;const e=this.soundEnabled?"🔊 Sonido de notificaciones activado":"🔇 Sonido de notificaciones desactivado";sr(e),localStorage.setItem("notifications_sound_enabled",this.soundEnabled?"1":"0")},async requestNotificationPermission(){try{if("undefined"==typeof Notification)return console.warn("Browser does not support notifications"),or("Tu navegador no soporta notificaciones"),!1;if("granted"===Notification.permission)return!0;if("denied"===Notification.permission)return or("Las notificaciones están bloqueadas. Actívalas en la configuración del navegador."),!1;return"granted"===await Notification.requestPermission()?(sr("✅ Notificaciones del navegador activadas"),!0):(or("❌ Notificaciones del navegador denegadas"),!1)}catch(e){return console.error("Error requesting notification permission:",e),or("Error al solicitar permisos de notificación"),!1}},initializeSettings(){const e=localStorage.getItem("notifications_sound_enabled");null!==e&&(this.soundEnabled="1"===e)},clearState(){this.unreadNotifications=[],this.readNotifications=[],this.unreadCount=0,this.waiterUnreadNotifications=[],this.waiterReadNotifications=[],this.waiterUnreadCount=0,this.adminNotifications=[],this.loading=!1,this.loadingWaiter=!1,this.loadingAdmin=!1,this.globalNotificationsEnabled=!0,this.soundEnabled=!0,this.tableNotificationsEnabled={},this.lastNotificationSound=0}}}),cr=Object.freeze(Object.defineProperty({__proto__:null,useNotificationsStore:lr},Symbol.toStringTag,{value:"Module"})),dr={setToken(e){e?localStorage.setItem("token",e):console.error("Intento de guardar un token inválido:",e)},getToken:()=>localStorage.getItem("token"),removeToken(){localStorage.removeItem("token")},setUser(e){localStorage.setItem("user",JSON.stringify(e))},getUser(){const e=localStorage.getItem("user");return e?JSON.parse(e):null},removeUser(){localStorage.removeItem("user")},isAuthenticated(){return!!this.getToken()},async login(e,t){var a,n;try{const i=await ga.login({email:e,password:t}),s=i.data.token||i.data.access_token||i.data.plainTextToken||i.data.user&&i.data.user.token||i.data.user&&i.data.user.access_token||(null==(n=null==(a=i.headers)?void 0:a.authorization)?void 0:n.replace("Bearer ",""));if(!s)throw console.error("No se encontró un token válido en la respuesta:",i.data),new Error("No se recibió un token válido del servidor");return this.setToken(s),this.setUser(i.data.user),i.data}catch(i){throw console.error("Error en login:",i),i}},async loginWithGoogle(e){try{const t=await ga.loginWithGoogle(e),a=t.data.token||t.data.access_token||t.data.plainTextToken||t.data.user&&t.data.user.token||t.data.user&&t.data.user.access_token;if(!a)throw new Error("No se recibió un token válido del servidor");return this.setToken(a),this.setUser(t.data.user),t.data}catch(t){throw console.error("Error en loginWithGoogle:",t),t}},async register(e,t,a,n){try{return(await ga.register({name:e,email:t,password:a,password_confirmation:n})).data}catch(i){throw i}},async forgotPassword(e){try{return(await ga.forgotPassword({email:e})).data}catch(t){throw t}},async resetPassword(e,t,a,n){try{return(await ga.resetPassword({token:e,email:t,password:a,password_confirmation:n})).data}catch(i){throw i}},async logout(){try{const e=localStorage.getItem("fcm_token");this.isAuthenticated()&&e&&await ga.deleteDeviceToken({token:e}),this.isAuthenticated()&&await ga.logout()}catch(e){console.error("Error durante el logout en el servidor:",e)}finally{lr().disconnectRealTimeNotifications(),this.removeToken(),this.removeUser(),localStorage.removeItem("fcm_token")}},async getCurrentUser(){try{const e=await ga.getCurrentUser();return this.setUser(e.data),e.data}catch(e){throw e}},async selectRole(e,t=null){try{const a=(await ga.selectRole(e,t)).data||{},n=a.token||a.access_token||a.plainTextToken||a.user&&a.user.token||a.user&&a.user.access_token;n&&this.setToken(n);const i=this.getUser();return i&&(i.role=e,this.setUser(i)),a}catch(a){throw console.error("Error en selectRole:",a),a}}};var ur={};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hr="${JSCORE_VERSION}",pr=function(e,t){if(!e)throw mr(t)},mr=function(e){return new Error("Firebase Database ("+hr+") INTERNAL ASSERT FAILED: "+e)},fr=function(e){const t=[];let a=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[a++]=i:i<2048?(t[a++]=i>>6|192,t[a++]=63&i|128):55296==(64512&i)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[a++]=i>>18|240,t[a++]=i>>12&63|128,t[a++]=i>>6&63|128,t[a++]=63&i|128):(t[a++]=i>>12|224,t[a++]=i>>6&63|128,t[a++]=63&i|128)}return t},vr={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const a=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,r=i+2<e.length,l=r?e[i+2]:0,c=t>>2,d=(3&t)<<4|o>>4;let u=(15&o)<<2|l>>6,h=63&l;r||(h=64,s||(u=64)),n.push(a[c],a[d],a[u],a[h])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(fr(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let a=0,n=0;for(;a<e.length;){const i=e[a++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[a++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[a++])<<12|(63&e[a++])<<6|63&e[a++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{const s=e[a++],o=e[a++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const a=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<e.length;){const t=a[e.charAt(i++)],s=i<e.length?a[e.charAt(i)]:0;++i;const o=i<e.length?a[e.charAt(i)]:64;++i;const r=i<e.length?a[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==r)throw new gr;const l=t<<2|s>>4;if(n.push(l),64!==o){const e=s<<4&240|o>>2;if(n.push(e),64!==r){const e=o<<6&192|r;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const br=function(e){const t=fr(e);return vr.encodeByteArray(t,!0)},wr=function(e){return br(e).replace(/\./g,"")},yr=function(e){try{return vr.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _r(e){return kr(void 0,e)}function kr(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const a in t)t.hasOwnProperty(a)&&Cr(a)&&(e[a]=kr(e[a],t[a]));return e}function Cr(e){return"__proto__"!==e}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Er=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,Ir=()=>{try{return Er()||(()=>{if("undefined"==typeof process)return;const e=ur.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(a){return}const t=e&&yr(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},Sr=e=>{var t,a;return null==(a=null==(t=Ir())?void 0:t.emulatorHosts)?void 0:a[e]},Tr=e=>{const t=Sr(e);if(!t)return;const a=t.lastIndexOf(":");if(a<=0||a+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(a+1),10);return"["===t[0]?[t.substring(1,a-1),n]:[t.substring(0,a),n]},Nr=()=>{var e;return null==(e=Ir())?void 0:e.config},Ar=e=>{var t;return null==(t=Ir())?void 0:t[`_${e}`]};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Pr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,a)=>{t?this.reject(t):this.resolve(a),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,a))}}}
/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rr(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function xr(e){return(await fetch(e,{credentials:"include"})).ok}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dr(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const a=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s={iss:`https://securetoken.google.com/${a}`,aud:a,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[wr(JSON.stringify({alg:"none",type:"JWT"})),wr(JSON.stringify(s)),""].join(".")}const Or={};let Lr=!1;function Mr(e,t){if("undefined"==typeof window||"undefined"==typeof document||!Rr(window.location.host)||Or[e]===t||Or[e]||Lr)return;function a(e){return`__firebase__banner__${e}`}Or[e]=t;const n="__firebase__banner",i=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(Or))Or[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{Lr=!0,function(){const e=document.getElementById(n);e&&e.remove()}()},e}function o(){const e=function(e){let t=document.getElementById(e),a=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),a=!0),{created:a,element:t}}(n),t=a("text"),o=document.getElementById(t)||document.createElement("span"),r=a("learnmore"),l=document.getElementById(r)||document.createElement("a"),c=a("preprendIcon"),d=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(l,r);const a=s();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(d,c),t.append(d,o,l,a),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",d.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(d.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ur(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Fr(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ur())}function qr(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Br(){try{return"object"==typeof indexedDB}catch(e){return!1}}function jr(){return new Promise((e,t)=>{try{let a=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),a||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{a=!1},i.onerror=()=>{var e;t((null==(e=i.error)?void 0:e.message)||"")}}catch(a){t(a)}})}function $r(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr extends Error{constructor(e,t,a){super(t),this.code=e,this.customData=a,this.name="FirebaseError",Object.setPrototypeOf(this,zr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Vr.prototype.create)}}class Vr{constructor(e,t,a){this.service=e,this.serviceName=t,this.errors=a}create(e,...t){const a=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(Wr,(e,a)=>{const n=t[a];return null!=n?String(n):`<${a}?>`})}(i,a):"Error",o=`${this.serviceName}: ${s} (${n}).`;return new zr(n,o,a)}}const Wr=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hr(e){return JSON.parse(e)}function Gr(e){return JSON.stringify(e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kr=function(e){let t={},a={},n={},i="";try{const s=e.split(".");t=Hr(yr(s[0])||""),a=Hr(yr(s[1])||""),i=s[2],n=a.d||{},delete a.d}catch(s){}return{header:t,claims:a,data:n,signature:i}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Jr(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Yr(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function Qr(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Zr(e,t,a){const n={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=t.call(a,e[i],i,e));return n}function Xr(e,t){if(e===t)return!0;const a=Object.keys(e),n=Object.keys(t);for(const i of a){if(!n.includes(i))return!1;const a=e[i],s=t[i];if(el(a)&&el(s)){if(!Xr(a,s))return!1}else if(a!==s)return!1}for(const i of n)if(!a.includes(i))return!1;return!0}function el(e){return null!==e&&"object"==typeof e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tl(e){const t=[];for(const[a,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(a)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(a)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const a=this.W_;if("string"==typeof e)for(let d=0;d<16;d++)a[d]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let d=0;d<16;d++)a[d]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let d=16;d<80;d++){const e=a[d-3]^a[d-8]^a[d-14]^a[d-16];a[d]=4294967295&(e<<1|e>>>31)}let n,i,s=this.chain_[0],o=this.chain_[1],r=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let d=0;d<80;d++){d<40?d<20?(n=l^o&(r^l),i=1518500249):(n=o^r^l,i=1859775393):d<60?(n=o&r|l&(o|r),i=2400959708):(n=o^r^l,i=3395469782);const e=(s<<5|s>>>27)+n+c+i+a[d]&4294967295;c=l,l=r,r=4294967295&(o<<30|o>>>2),o=s,s=e}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+r&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const a=t-this.blockSize;let n=0;const i=this.buf_;let s=this.inbuf_;for(;n<t;){if(0===s)for(;n<=a;)this.compress_(e,n),n+=this.blockSize;if("string"==typeof e){for(;n<t;)if(i[s]=e.charCodeAt(n),++s,++n,s===this.blockSize){this.compress_(i),s=0;break}}else for(;n<t;)if(i[s]=e[n],++s,++n,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);let a=0;for(let n=0;n<5;n++)for(let t=24;t>=0;t-=8)e[a]=this.chain_[n]>>t&255,++a;return e}}class nl{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,a){let n;if(void 0===e&&void 0===t&&void 0===a)throw new Error("Missing Observer.");n=function(e,t){if("object"!=typeof e||null===e)return!1;for(const a of t)if(a in e&&"function"==typeof e[a])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:a},void 0===n.next&&(n.next=il),void 0===n.error&&(n.error=il),void 0===n.complete&&(n.complete=il);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(a){"undefined"!=typeof console&&console.error&&console.error(a)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function il(){}function sl(e,t){return`${e} failed: ${t} argument `}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ol=function(e){let t=0;for(let a=0;a<e.length;a++){const n=e.charCodeAt(a);n<128?t++:n<2048?t+=2:n>=55296&&n<=56319?(t+=4,a++):t+=3}return t};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function rl(e){return e&&e._delegate?e._delegate:e}class ll{constructor(e,t,a){this.name=e,this.instanceFactory=t,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cl="[DEFAULT]";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dl{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Pr;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&e.resolve(a)}catch(a){}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),a=(null==e?void 0:e.optional)??!1;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(a)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(n){if(a)return null;throw n}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e))try{this.getOrInitializeService({instanceIdentifier:cl})}catch(t){}for(const[e,a]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});a.resolve(e)}catch(t){}}}}clearInstance(e=cl){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=cl){return this.instances.has(e)}getOptions(e=cl){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:a,options:t});for(const[i,s]of this.instancesDeferred.entries()){a===this.normalizeInstanceIdentifier(i)&&s.resolve(n)}return n}onInit(e,t){const a=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(a)??new Set;n.add(e),this.onInitCallbacks.set(a,n);const i=this.instances.get(a);return i&&e(i,a),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){const a=this.onInitCallbacks.get(t);if(a)for(const n of a)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===cl?void 0:n),options:t}),this.instances.set(e,a),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}var n;return a||null}normalizeInstanceIdentifier(e=cl){return this.component?this.component.multipleInstances?e:cl:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ul{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new dl(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var hl,pl;(pl=hl||(hl={}))[pl.DEBUG=0]="DEBUG",pl[pl.VERBOSE=1]="VERBOSE",pl[pl.INFO=2]="INFO",pl[pl.WARN=3]="WARN",pl[pl.ERROR=4]="ERROR",pl[pl.SILENT=5]="SILENT";const ml={debug:hl.DEBUG,verbose:hl.VERBOSE,info:hl.INFO,warn:hl.WARN,error:hl.ERROR,silent:hl.SILENT},fl=hl.INFO,vl={[hl.DEBUG]:"log",[hl.VERBOSE]:"log",[hl.INFO]:"info",[hl.WARN]:"warn",[hl.ERROR]:"error"},gl=(e,t,...a)=>{if(t<e.logLevel)return;const n=(new Date).toISOString(),i=vl[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${n}]  ${e.name}:`,...a)};class bl{constructor(e){this.name=e,this._logLevel=fl,this._logHandler=gl,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in hl))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ml[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,hl.DEBUG,...e),this._logHandler(this,hl.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,hl.VERBOSE,...e),this._logHandler(this,hl.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,hl.INFO,...e),this._logHandler(this,hl.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,hl.WARN,...e),this._logHandler(this,hl.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,hl.ERROR,...e),this._logHandler(this,hl.ERROR,...e)}}let wl,yl;const _l=new WeakMap,kl=new WeakMap,Cl=new WeakMap,El=new WeakMap,Il=new WeakMap;let Sl={get(e,t,a){if(e instanceof IDBTransaction){if("done"===t)return kl.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Cl.get(e);if("store"===t)return a.objectStoreNames[1]?void 0:a.objectStore(a.objectStoreNames[0])}return Al(e[t])},set:(e,t,a)=>(e[t]=a,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Tl(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(yl||(yl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Pl(this),t),Al(_l.get(this))}:function(...t){return Al(e.apply(Pl(this),t))}:function(t,...a){const n=e.call(Pl(this),t,...a);return Cl.set(n,t.sort?t.sort():[t]),Al(n)}}function Nl(e){return"function"==typeof e?Tl(e):(e instanceof IDBTransaction&&function(e){if(kl.has(e))return;const t=new Promise((t,a)=>{const n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{a(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});kl.set(e,t)}(e),t=e,(wl||(wl=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,Sl):e);var t}function Al(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,a)=>{const n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(Al(e.result)),n()},s=()=>{a(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&_l.set(t,e)}).catch(()=>{}),Il.set(t,e),t}(e);if(El.has(e))return El.get(e);const t=Nl(e);return t!==e&&(El.set(e,t),Il.set(t,e)),t}const Pl=e=>Il.get(e);function Rl(e,t,{blocked:a,upgrade:n,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),r=Al(o);return n&&o.addEventListener("upgradeneeded",e=>{n(Al(o.result),e.oldVersion,e.newVersion,Al(o.transaction),e)}),a&&o.addEventListener("blocked",e=>a(e.oldVersion,e.newVersion,e)),r.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),r}function xl(e,{blocked:t}={}){const a=indexedDB.deleteDatabase(e);return t&&a.addEventListener("blocked",e=>t(e.oldVersion,e)),Al(a).then(()=>{})}const Dl=["get","getKey","getAll","getAllKeys","count"],Ol=["put","add","delete","clear"],Ll=new Map;function Ml(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Ll.get(t))return Ll.get(t);const a=t.replace(/FromIndex$/,""),n=t!==a,i=Ol.includes(a);if(!(a in(n?IDBIndex:IDBObjectStore).prototype)||!i&&!Dl.includes(a))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[a](...t),i&&s.done]))[0]};return Ll.set(t,s),s}Sl=(e=>({...e,get:(t,a,n)=>Ml(t,a)||e.get(t,a,n),has:(t,a)=>!!Ml(t,a)||e.has(t,a)}))(Sl);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ul{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const Fl="@firebase/app",ql="0.14.1",Bl=new bl("@firebase/app"),jl="@firebase/app-compat",$l="@firebase/analytics-compat",zl="@firebase/analytics",Vl="@firebase/app-check-compat",Wl="@firebase/app-check",Hl="@firebase/auth",Gl="@firebase/auth-compat",Kl="@firebase/database",Jl="@firebase/data-connect",Yl="@firebase/database-compat",Ql="@firebase/functions",Zl="@firebase/functions-compat",Xl="@firebase/installations",ec="@firebase/installations-compat",tc="@firebase/messaging",ac="@firebase/messaging-compat",nc="@firebase/performance",ic="@firebase/performance-compat",sc="@firebase/remote-config",oc="@firebase/remote-config-compat",rc="@firebase/storage",lc="@firebase/storage-compat",cc="@firebase/firestore",dc="@firebase/ai",uc="@firebase/firestore-compat",hc="firebase",pc="[DEFAULT]",mc={[Fl]:"fire-core",[jl]:"fire-core-compat",[zl]:"fire-analytics",[$l]:"fire-analytics-compat",[Wl]:"fire-app-check",[Vl]:"fire-app-check-compat",[Hl]:"fire-auth",[Gl]:"fire-auth-compat",[Kl]:"fire-rtdb",[Jl]:"fire-data-connect",[Yl]:"fire-rtdb-compat",[Ql]:"fire-fn",[Zl]:"fire-fn-compat",[Xl]:"fire-iid",[ec]:"fire-iid-compat",[tc]:"fire-fcm",[ac]:"fire-fcm-compat",[nc]:"fire-perf",[ic]:"fire-perf-compat",[sc]:"fire-rc",[oc]:"fire-rc-compat",[rc]:"fire-gcs",[lc]:"fire-gcs-compat",[cc]:"fire-fst",[uc]:"fire-fst-compat",[dc]:"fire-vertex","fire-js":"fire-js",[hc]:"fire-js-all"},fc=new Map,vc=new Map,gc=new Map;function bc(e,t){try{e.container.addComponent(t)}catch(a){Bl.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,a)}}function wc(e){const t=e.name;if(gc.has(t))return Bl.debug(`There were multiple attempts to register component ${t}.`),!1;gc.set(t,e);for(const a of fc.values())bc(a,e);for(const a of vc.values())bc(a,e);return!0}function yc(e,t){const a=e.container.getProvider("heartbeat").getImmediate({optional:!0});return a&&a.triggerHeartbeat(),e.container.getProvider(t)}function _c(e){return null!=e&&void 0!==e.settings}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kc=new Vr("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Cc{constructor(e,t,a){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new ll("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw kc.create("app-deleted",{appName:this._name})}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ec="12.1.0";function Ic(e,t={}){let a=e;if("object"!=typeof t){t={name:t}}const n={name:pc,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw kc.create("bad-app-name",{appName:String(i)});if(a||(a=Nr()),!a)throw kc.create("no-options");const s=fc.get(i);if(s){if(Xr(a,s.options)&&Xr(n,s.config))return s;throw kc.create("duplicate-app",{appName:i})}const o=new ul(i);for(const l of gc.values())o.addComponent(l);const r=new Cc(a,n,o);return fc.set(i,r),r}function Sc(e=pc){const t=fc.get(e);if(!t&&e===pc&&Nr())return Ic();if(!t)throw kc.create("no-app",{appName:e});return t}function Tc(e,t,a){let n=mc[e]??e;a&&(n+=`-${a}`);const i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){const e=[`Unable to register library "${n}" with version "${t}":`];return i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Bl.warn(e.join(" "))}wc(new ll(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nc="firebase-heartbeat-store";let Ac=null;function Pc(){return Ac||(Ac=Rl("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Nc)}catch(a){console.warn(a)}}}).catch(e=>{throw kc.create("idb-open",{originalErrorMessage:e.message})})),Ac}async function Rc(e,t){try{const a=(await Pc()).transaction(Nc,"readwrite"),n=a.objectStore(Nc);await n.put(t,xc(e)),await a.done}catch(a){if(a instanceof zr)Bl.warn(a.message);else{const e=kc.create("idb-set",{originalErrorMessage:null==a?void 0:a.message});Bl.warn(e.message)}}}function xc(e){return`${e.name}!${e.options.appId}`}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dc{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Lc(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=Oc();if(null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:a}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,a=e[0].date;for(let n=1;n<e.length;n++)e[n].date<a&&(a=e[n].date,t=n);return t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Bl.warn(a)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Oc(),{heartbeatsToSend:a,unsentEntries:n}=function(e,t=1024){const a=[];let n=e.slice();for(const i of e){const e=a.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),Mc(a)>t){e.dates.pop();break}}else if(a.push({agent:i.agent,dates:[i.date]}),Mc(a)>t){a.pop();break}n=n.slice(1)}return{heartbeatsToSend:a,unsentEntries:n}}(this._heartbeatsCache.heartbeats),i=wr(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Bl.warn(t),""}}}function Oc(){return(new Date).toISOString().substring(0,10)}class Lc{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Br()&&jr().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Pc()).transaction(Nc),a=await t.objectStore(Nc).get(xc(e));return await t.done,a}catch(t){if(t instanceof zr)Bl.warn(t.message);else{const e=kc.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});Bl.warn(e.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return Rc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return Rc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function Mc(e){return wr(JSON.stringify({version:2,heartbeats:e})).length}var Uc;function Fc(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}Uc="",wc(new ll("platform-logger",e=>new Ul(e),"PRIVATE")),wc(new ll("heartbeat",e=>new Dc(e),"PRIVATE")),Tc(Fl,ql,Uc),Tc(Fl,ql,"esm2020"),Tc("fire-js","");const qc=Fc,Bc=new Vr("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),jc=new bl("@firebase/auth");function $c(e,...t){jc.logLevel<=hl.ERROR&&jc.error(`Auth (${Ec}): ${e}`,...t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zc(e,...t){throw Gc(e,...t)}function Vc(e,...t){return Gc(e,...t)}function Wc(e,t,a){const n={...qc(),[t]:a};return new Vr("auth","Firebase",n).create(t,{appName:e.name})}function Hc(e){return Wc(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Gc(e,...t){if("string"!=typeof e){const a=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(a,...n)}return Bc.create(e,...t)}function Kc(e,t,...a){if(!e)throw Gc(t,...a)}function Jc(e){const t="INTERNAL ASSERTION FAILED: "+e;throw $c(t),new Error(t)}function Yc(e,t){e||Jc(t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qc(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function Zc(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xc(){return"undefined"==typeof navigator||!navigator||!("onLine"in navigator)||"boolean"!=typeof navigator.onLine||"http:"!==Zc()&&"https:"!==Zc()&&!function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()&&!("connection"in navigator)||navigator.onLine}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ed{constructor(e,t){this.shortDelay=e,this.longDelay=t,Yc(t>e,"Short delay should be less than long delay!"),this.isMobile=Fr()||qr()}get(){return Xc()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function td(e,t){Yc(e.emulator,"Emulator should always be set here");const{url:a}=e.emulator;return t?`${a}${t.startsWith("/")?t.slice(1):t}`:a}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ad{static initialize(e,t,a){this.fetchImpl=e,t&&(this.headersImpl=t),a&&(this.responseImpl=a)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Jc("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Jc("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Jc("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nd={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},id=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],sd=new ed(3e4,6e4);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function od(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function rd(e,t,a,n,i={}){return ld(e,i,async()=>{let i={},s={};n&&("GET"===t?s=n:i={body:JSON.stringify(n)});const o=tl({key:e.config.apiKey,...s}).slice(1),r=await e._getAdditionalHeaders();r["Content-Type"]="application/json",e.languageCode&&(r["X-Firebase-Locale"]=e.languageCode);const l={method:t,headers:r,...i};return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&Rr(e.emulatorConfig.host)&&(l.credentials="include"),ad.fetch()(await dd(e,e.config.apiHost,a,o),l)})}async function ld(e,t,a){e._canInitEmulator=!1;const n={...nd,...t};try{const t=new ud(e),i=await Promise.race([a(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw hd(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[a,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===a)throw hd(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===a)throw hd(e,"email-already-in-use",s);if("USER_DISABLED"===a)throw hd(e,"user-disabled",s);const r=n[a]||a.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Wc(e,r,o);zc(e,r)}}catch(i){if(i instanceof zr)throw i;zc(e,"network-request-failed",{message:String(i)})}}async function cd(e,t,a,n,i={}){const s=await rd(e,t,a,n,i);return"mfaPendingCredential"in s&&zc(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function dd(e,t,a,n){const i=`${t}${a}?${n}`,s=e,o=s.config.emulator?td(e.config,i):`${e.config.apiScheme}://${i}`;if(id.includes(a)&&(await s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())){return s._getPersistence()._getFinalTarget(o).toString()}return o}class ud{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Vc(this.auth,"network-request-failed")),sd.get())})}}function hd(e,t,a){const n={appName:e.name};a.email&&(n.email=a.email),a.phoneNumber&&(n.phoneNumber=a.phoneNumber);const i=Vc(e,t,n);return i.customData._tokenResponse=a,i}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pd(e,t){return rd(e,"POST","/v1/accounts:lookup",t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function md(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}async function fd(e,t=!1){const a=rl(e),n=await a.getIdToken(t),i=gd(n);Kc(i&&i.exp&&i.auth_time&&i.iat,a.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:n,authTime:md(vd(i.auth_time)),issuedAtTime:md(vd(i.iat)),expirationTime:md(vd(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}function vd(e){return 1e3*Number(e)}function gd(e){const[t,a,n]=e.split(".");if(void 0===t||void 0===a||void 0===n)return $c("JWT malformed, contained fewer than 3 sections"),null;try{const e=yr(a);return e?JSON.parse(e):($c("Failed to decode base64 JWT payload"),null)}catch(i){return $c("Caught error parsing JWT payload as JSON",null==i?void 0:i.toString()),null}}function bd(e){const t=gd(e);return Kc(t,"internal-error"),Kc(void 0!==t.exp,"internal-error"),Kc(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wd(e,t,a=!1){if(a)return t;try{return await t}catch(n){throw n instanceof zr&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class yd{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _d{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=md(this.lastLoginAt),this.creationTime=md(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kd(e){var t;const a=e.auth,n=await e.getIdToken(),i=await wd(e,pd(a,{idToken:n}));Kc(null==i?void 0:i.users.length,a,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null==(t=s.providerUserInfo)?void 0:t.length)?Ed(s.providerUserInfo):[],r=(l=e.providerData,c=o,[...l.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var l,c;const d=e.isAnonymous,u=!(e.email&&s.passwordHash||(null==r?void 0:r.length)),h=!!d&&u,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:r,metadata:new _d(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(e,p)}async function Cd(e){const t=rl(e);await kd(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function Ed(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Id{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Kc(e.idToken,"internal-error"),Kc(void 0!==e.idToken,"internal-error"),Kc(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):bd(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Kc(0!==e.length,"internal-error");const t=bd(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(Kc(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:a,refreshToken:n,expiresIn:i}=await async function(e,t){const a=await ld(e,{},async()=>{const a=tl({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:i}=e.config,s=await dd(e,n,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const r={method:"POST",headers:o,body:a};return e.emulatorConfig&&Rr(e.emulatorConfig.host)&&(r.credentials="include"),ad.fetch()(s,r)});return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}}(e,t);this.updateTokensAndExpiration(a,n,Number(i))}updateTokensAndExpiration(e,t,a){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*a}static fromJSON(e,t){const{refreshToken:a,accessToken:n,expirationTime:i}=t,s=new Id;return a&&(Kc("string"==typeof a,"internal-error",{appName:e}),s.refreshToken=a),n&&(Kc("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),i&&(Kc("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Id,this.toJSON())}_performRefresh(){return Jc("not implemented")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sd(e,t){Kc("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Td{constructor({uid:e,auth:t,stsTokenManager:a,...n}){this.providerId="firebase",this.proactiveRefresh=new yd(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=n.displayName||null,this.email=n.email||null,this.emailVerified=n.emailVerified||!1,this.phoneNumber=n.phoneNumber||null,this.photoURL=n.photoURL||null,this.isAnonymous=n.isAnonymous||!1,this.tenantId=n.tenantId||null,this.providerData=n.providerData?[...n.providerData]:[],this.metadata=new _d(n.createdAt||void 0,n.lastLoginAt||void 0)}async getIdToken(e){const t=await wd(this,this.stsTokenManager.getToken(this.auth,e));return Kc(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return fd(this,e)}reload(){return Cd(this)}_assign(e){this!==e&&(Kc(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Td({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Kc(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let a=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),a=!0),t&&await kd(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(_c(this.auth.app))return Promise.reject(Hc(this.auth));const e=await this.getIdToken();return await wd(this,async function(e,t){return rd(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const a=t.displayName??void 0,n=t.email??void 0,i=t.phoneNumber??void 0,s=t.photoURL??void 0,o=t.tenantId??void 0,r=t._redirectEventId??void 0,l=t.createdAt??void 0,c=t.lastLoginAt??void 0,{uid:d,emailVerified:u,isAnonymous:h,providerData:p,stsTokenManager:m}=t;Kc(d&&m,e,"internal-error");const f=Id.fromJSON(this.name,m);Kc("string"==typeof d,e,"internal-error"),Sd(a,e.name),Sd(n,e.name),Kc("boolean"==typeof u,e,"internal-error"),Kc("boolean"==typeof h,e,"internal-error"),Sd(i,e.name),Sd(s,e.name),Sd(o,e.name),Sd(r,e.name),Sd(l,e.name),Sd(c,e.name);const v=new Td({uid:d,auth:e,email:n,emailVerified:u,displayName:a,isAnonymous:h,photoURL:s,phoneNumber:i,tenantId:o,stsTokenManager:f,createdAt:l,lastLoginAt:c});return p&&Array.isArray(p)&&(v.providerData=p.map(e=>({...e}))),r&&(v._redirectEventId=r),v}static async _fromIdTokenResponse(e,t,a=!1){const n=new Id;n.updateFromServerResponse(t);const i=new Td({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:a});return await kd(i),i}static async _fromGetAccountInfoResponse(e,t,a){const n=t.users[0];Kc(void 0!==n.localId,"internal-error");const i=void 0!==n.providerUserInfo?Ed(n.providerUserInfo):[],s=!(n.email&&n.passwordHash||(null==i?void 0:i.length)),o=new Id;o.updateFromIdToken(a);const r=new Td({uid:n.localId,auth:e,stsTokenManager:o,isAnonymous:s}),l={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new _d(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash||(null==i?void 0:i.length))};return Object.assign(r,l),r}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nd=new Map;function Ad(e){Yc(e instanceof Function,"Expected a class definition");let t=Nd.get(e);return t?(Yc(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Nd.set(e,t),t)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pd{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Pd.type="NONE";const Rd=Pd;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xd(e,t,a){return`firebase:${e}:${t}:${a}`}class Dd{constructor(e,t,a){this.persistence=e,this.auth=t,this.userKey=a;const{config:n,name:i}=this.auth;this.fullUserKey=xd(this.userKey,n.apiKey,i),this.fullPersistenceKey=xd("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await pd(this.auth,{idToken:e}).catch(()=>{});return t?Td._fromGetAccountInfoResponse(this.auth,t,e):null}return Td._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,a="authUser"){if(!t.length)return new Dd(Ad(Rd),e,a);const n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=n[0]||Ad(Rd);const s=xd(a,e.config.apiKey,e.name);let o=null;for(const l of t)try{const t=await l._get(s);if(t){let a;if("string"==typeof t){const n=await pd(e,{idToken:t}).catch(()=>{});if(!n)break;a=await Td._fromGetAccountInfoResponse(e,n,t)}else a=Td._fromJSON(e,t);l!==i&&(o=a),i=l;break}}catch{}const r=n.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&r.length?(i=r[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch{}})),new Dd(i,e,a)):new Dd(i,e,a)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Od(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Fd(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Ld(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Bd(t))return"Blackberry";if(jd(t))return"Webos";if(Md(t))return"Safari";if((t.includes("chrome/")||Ud(t))&&!t.includes("edge/"))return"Chrome";if(qd(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=e.match(t);if(2===(null==a?void 0:a.length))return a[1]}return"Other"}function Ld(e=Ur()){return/firefox\//i.test(e)}function Md(e=Ur()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Ud(e=Ur()){return/crios\//i.test(e)}function Fd(e=Ur()){return/iemobile/i.test(e)}function qd(e=Ur()){return/android/i.test(e)}function Bd(e=Ur()){return/blackberry/i.test(e)}function jd(e=Ur()){return/webos/i.test(e)}function $d(e=Ur()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function zd(){return function(){const e=Ur();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function Vd(e=Ur()){return $d(e)||qd(e)||jd(e)||Bd(e)||/windows phone/i.test(e)||Fd(e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wd(e,t=[]){let a;switch(e){case"Browser":a=Od(Ur());break;case"Worker":a=`${Od(Ur())}-${e}`;break;default:a=e}const n=t.length?t.join(","):"FirebaseCore-web";return`${a}/JsCore/${Ec}/${n}`}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hd{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const a=t=>new Promise((a,n)=>{try{a(e(t))}catch(i){n(i)}});a.onAbort=t,this.queue.push(a);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const a of this.queue)await a(e),a.onAbort&&t.push(a.onAbort)}catch(a){t.reverse();for(const e of t)try{e()}catch(n){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==a?void 0:a.message})}}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gd{constructor(e){var t;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=a.minPasswordLength??6,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),void 0!==a.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),void 0!==a.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),void 0!==a.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),void 0!==a.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(null==(t=e.allowedNonAlphanumericCharacters)?void 0:t.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const a=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;a&&(t.meetsMinPasswordLength=e.length>=a),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let a;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)a=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(e,t,a,n,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd{constructor(e,t,a,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=a,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Yd(this),this.idTokenSubscription=new Yd(this),this.beforeStateQueue=new Hd(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Bc,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ad(t)),this._initializationPromise=this.queue(async()=>{var a,n,i;if(!this._deleted&&(this.persistenceManager=await Dd.create(this,e),null==(a=this._resolvePersistenceManagerAvailable)||a.call(this),!this._deleted)){if(null==(n=this._popupRedirectResolver)?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(s){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(i=this.currentUser)?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(e,!0)):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await pd(this,{idToken:e}),a=await Td._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(a)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(_c(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let n=a,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=null==(t=this.redirectUser)?void 0:t._redirectEventId,s=null==n?void 0:n._redirectEventId,o=await this.tryRedirectSignIn(e);a&&a!==s||!(null==o?void 0:o.user)||(n=o.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(s){n=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return Kc(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(a){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await kd(e)}catch(t){if("auth/network-request-failed"!==(null==t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(_c(this.app))return Promise.reject(Hc(this));const t=e?rl(e):null;return t&&Kc(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Kc(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return _c(this.app)?Promise.reject(Hc(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return _c(this.app)?Promise.reject(Hc(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ad(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return rd(e,"GET","/v2/passwordPolicy",od(e,t))}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this),t=new Gd(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Vr("auth","Firebase",e())}onAuthStateChanged(e,t,a){return this.registerStateListener(this.authStateSubscription,e,t,a)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,a){return this.registerStateListener(this.idTokenSubscription,e,t,a)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const a=this.onAuthStateChanged(()=>{a(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return rd(e,"POST","/v2/accounts:revokeToken",od(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){const a=await this.getOrInitRedirectPersistenceManager(t);return null===e?a.removeCurrentUser():a.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ad(e)||this._popupRedirectResolver;Kc(t,this,"argument-error"),this.redirectPersistenceManager=await Dd.create(this,[Ad(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,a;return this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e?this._currentUser:(null==(a=this.redirectUser)?void 0:a._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const t=(null==(e=this.currentUser)?void 0:e.uid)??null;this.lastNotifiedUid!==t&&(this.lastNotifiedUid=t,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,a,n){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Kc(o,this,"internal-error"),o.then(()=>{s||i(this.currentUser)}),"function"==typeof t){const i=e.addObserver(t,a,n);return()=>{s=!0,i()}}{const a=e.addObserver(t);return()=>{s=!0,a()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Kc(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Wd(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const a=await(null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader());a&&(t["X-Firebase-Client"]=a);const n=await this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t}async _getAppCheckToken(){var e;if(_c(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){jc.logLevel<=hl.WARN&&jc.warn(`Auth (${Ec}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Jd(e){return rl(e)}class Yd{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const a=new nl(e,t);return a.subscribe.bind(a)}(e=>this.observer=e)}get next(){return Kc(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qd={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Zd(e,t){const a=yc(e,"auth");if(a.isInitialized()){const e=a.getImmediate();if(Xr(a.getOptions(),t??{}))return e;zc(e,"already-initialized")}return a.initialize({options:t})}function Xd(e,t,a){const n=Jd(e);Kc(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const i=eu(t),{host:s,port:o}=function(e){const t=eu(e),a=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!a)return{host:"",port:null};const n=a[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const e=i[1];return{host:e,port:tu(n.substr(e.length+1))}}{const[e,t]=n.split(":");return{host:e,port:tu(t)}}}(t),r=null===o?"":`:${o}`,l={url:`${i}//${s}${r}/`},c=Object.freeze({host:s,port:o,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!n._canInitEmulator)return Kc(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),void Kc(Xr(l,n.config.emulator)&&Xr(c,n.emulatorConfig),n,"emulator-config-failed");n.config.emulator=l,n.emulatorConfig=c,n.settings.appVerificationDisabledForTesting=!0,Rr(s)?(xr(`${i}//${s}${r}`),Mr("Auth",!0)):function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */()}function eu(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function tu(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class au{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Jc("not implemented")}_getIdTokenResponse(e){return Jc("not implemented")}_linkToIdToken(e,t){return Jc("not implemented")}_getReauthenticationResolver(e){return Jc("not implemented")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nu(e,t){return cd(e,"POST","/v1/accounts:signInWithIdp",od(e,t))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iu extends au{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new iu(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):zc("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:a,signInMethod:n,...i}=t;if(!a||!n)return null;const s=new iu(a,n);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return nu(e,this.buildRequest())}_linkToIdToken(e,t){const a=this.buildRequest();return a.idToken=t,nu(e,a)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,nu(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=tl(t)}return e}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class su{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ou extends su{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ru extends ou{constructor(){super("facebook.com")}static credential(e){return iu._fromParams({providerId:ru.PROVIDER_ID,signInMethod:ru.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ru.credentialFromTaggedObject(e)}static credentialFromError(e){return ru.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return ru.credential(e.oauthAccessToken)}catch{return null}}}ru.FACEBOOK_SIGN_IN_METHOD="facebook.com",ru.PROVIDER_ID="facebook.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class lu extends ou{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return iu._fromParams({providerId:lu.PROVIDER_ID,signInMethod:lu.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return lu.credentialFromTaggedObject(e)}static credentialFromError(e){return lu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:a}=e;if(!t&&!a)return null;try{return lu.credential(t,a)}catch{return null}}}lu.GOOGLE_SIGN_IN_METHOD="google.com",lu.PROVIDER_ID="google.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class cu extends ou{constructor(){super("github.com")}static credential(e){return iu._fromParams({providerId:cu.PROVIDER_ID,signInMethod:cu.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return cu.credentialFromTaggedObject(e)}static credentialFromError(e){return cu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return cu.credential(e.oauthAccessToken)}catch{return null}}}cu.GITHUB_SIGN_IN_METHOD="github.com",cu.PROVIDER_ID="github.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class du extends ou{constructor(){super("twitter.com")}static credential(e,t){return iu._fromParams({providerId:du.PROVIDER_ID,signInMethod:du.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return du.credentialFromTaggedObject(e)}static credentialFromError(e){return du.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:a}=e;if(!t||!a)return null;try{return du.credential(t,a)}catch{return null}}}du.TWITTER_SIGN_IN_METHOD="twitter.com",du.PROVIDER_ID="twitter.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class uu{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,a,n=!1){const i=await Td._fromIdTokenResponse(e,a,n),s=hu(a);return new uu({user:i,providerId:s,_tokenResponse:a,operationType:t})}static async _forOperation(e,t,a){await e._updateTokensIfNecessary(a,!0);const n=hu(a);return new uu({user:e,providerId:n,_tokenResponse:a,operationType:t})}}function hu(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class pu extends zr{constructor(e,t,a,n){super(t.code,t.message),this.operationType=a,this.user=n,Object.setPrototypeOf(this,pu.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(e,t,a,n){return new pu(e,t,a,n)}}function mu(e,t,a,n){return("reauthenticate"===t?a._getReauthenticationResolver(e):a._getIdTokenResponse(e)).catch(a=>{if("auth/multi-factor-auth-required"===a.code)throw pu._fromErrorAndOperation(e,a,t,n);throw a})}function fu(e,t,a,n){return rl(e).onIdTokenChanged(t,a,n)}function vu(e,t,a){return rl(e).beforeAuthStateChanged(t,a)}const gu="__sak";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bu{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(gu,"1"),this.storage.removeItem(gu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wu extends bu{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Vd(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const a=this.storage.getItem(t),n=this.localCache[t];a!==n&&e(t,n,a)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,a)=>{this.notifyListeners(e,a)});const a=e.key;t?this.detachListener():this.stopPolling();const n=()=>{const e=this.storage.getItem(a);(t||this.localCache[a]!==e)&&this.notifyListeners(a,e)},i=this.storage.getItem(a);zd()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}notifyListeners(e,t){this.localCache[e]=t;const a=this.listeners[e];if(a)for(const n of Array.from(a))n(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:a}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}wu.type="LOCAL";const yu=wu;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _u extends bu{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}_u.type="SESSION";const ku=_u;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Cu{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const a=new Cu(e);return this.receivers.push(a),a}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:a,eventType:n,data:i}=t.data,s=this.handlersMap[n];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:a,eventType:n});const o=Array.from(s).map(async e=>e(t.origin,i)),r=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(o);t.ports[0].postMessage({status:"done",eventId:a,eventType:n,response:r})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Eu(e="",t=10){let a="";for(let n=0;n<t;n++)a+=Math.floor(10*Math.random());return e+a}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Cu.receivers=[];class Iu{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,a=50){const n="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let i,s;return new Promise((o,r)=>{const l=Eu("",20);n.port1.start();const c=setTimeout(()=>{r(new Error("unsupported_event"))},a);s={messageChannel:n,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),i=setTimeout(()=>{r(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(c),clearTimeout(i),r(new Error("invalid_response"))}}},this.handlers.add(s),n.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[n.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Su(){return window}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Tu(){return void 0!==Su().WorkerGlobalScope&&"function"==typeof Su().importScripts}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Nu="firebaseLocalStorageDb",Au="firebaseLocalStorage",Pu="fbase_key";class Ru{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function xu(e,t){return e.transaction([Au],t?"readwrite":"readonly").objectStore(Au)}function Du(){const e=indexedDB.open(Nu,1);return new Promise((t,a)=>{e.addEventListener("error",()=>{a(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(Au,{keyPath:Pu})}catch(n){a(n)}}),e.addEventListener("success",async()=>{const a=e.result;a.objectStoreNames.contains(Au)?t(a):(a.close(),await function(){const e=indexedDB.deleteDatabase(Nu);return new Ru(e).toPromise()}(),t(await Du()))})})}async function Ou(e,t,a){const n=xu(e,!0).put({[Pu]:t,value:a});return new Ru(n).toPromise()}function Lu(e,t){const a=xu(e,!0).delete(t);return new Ru(a).toPromise()}class Mu{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Du()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(a){if(t++>3)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Tu()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Cu._getInstance(Tu()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}(),!this.activeServiceWorker)return;this.sender=new Iu(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&(null==(e=a[0])?void 0:e.fulfilled)&&(null==(t=a[0])?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Du();return await Ou(e,gu,"1"),await Lu(e,gu),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(a=>Ou(a,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const a=xu(e,!1).get(t),n=await new Ru(a).toPromise();return void 0===n?null:n.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Lu(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=xu(e,!1).getAll();return new Ru(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],a=new Set;if(0!==e.length)for(const{fbase_key:n,value:i}of e)a.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(i)&&(this.notifyListeners(n,i),t.push(n));for(const n of Object.keys(this.localCache))this.localCache[n]&&!a.has(n)&&(this.notifyListeners(n,null),t.push(n));return t}notifyListeners(e,t){this.localCache[e]=t;const a=this.listeners[e];if(a)for(const n of Array.from(a))n(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Mu.type="LOCAL";const Uu=Mu;
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Fu(e,t){return t?Ad(t):(Kc(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new ed(3e4,6e4);class qu extends au{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return nu(e,this._buildIdpRequest())}_linkToIdToken(e,t){return nu(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return nu(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Bu(e){
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
return async function(e,t,a=!1){if(_c(e.app))return Promise.reject(Hc(e));const n="signIn",i=await mu(e,n,t),s=await uu._fromIdTokenResponse(e,n,i);return a||await e._updateCurrentUser(s.user),s}(e.auth,new qu(e),e.bypassAuthState)}function ju(e){const{auth:t,user:a}=e;return Kc(a,t,"internal-error"),
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function(e,t,a=!1){const{auth:n}=e;if(_c(n.app))return Promise.reject(Hc(n));const i="reauthenticate";try{const s=await wd(e,mu(n,i,t,e),a);Kc(s.idToken,n,"internal-error");const o=gd(s.idToken);Kc(o,n,"internal-error");const{sub:r}=o;return Kc(e.uid===r,n,"user-mismatch"),uu._forOperation(e,i,s)}catch(s){throw"auth/user-not-found"===(null==s?void 0:s.code)&&zc(n,"user-mismatch"),s}}(a,new qu(e),e.bypassAuthState)}async function $u(e){const{auth:t,user:a}=e;return Kc(a,t,"internal-error"),async function(e,t,a=!1){const n=await wd(e,t._linkToIdToken(e.auth,await e.getIdToken()),a);return uu._forOperation(e,"link",n)}(a,new qu(e),e.bypassAuthState)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zu{constructor(e,t,a,n,i=!1){this.auth=e,this.resolver=a,this.user=n,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:a,postBody:n,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const r={auth:this.auth,requestUri:t,sessionId:a,tenantId:i||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(r))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Bu;case"linkViaPopup":case"linkViaRedirect":return $u;case"reauthViaPopup":case"reauthViaRedirect":return ju;default:zc(this.auth,"internal-error")}}resolve(e){Yc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Yc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vu=new ed(2e3,1e4);class Wu extends zu{constructor(e,t,a,n,i){super(e,t,n,i),this.provider=a,this.authWindow=null,this.pollId=null,Wu.currentPopupAction&&Wu.currentPopupAction.cancel(),Wu.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Kc(e,this.auth,"internal-error"),e}async onExecution(){Yc(1===this.filter.length,"Popup operations only handle one event");const e=Eu();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Vc(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(Vc(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Wu.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,a;(null==(a=null==(t=this.authWindow)?void 0:t.window)?void 0:a.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Vc(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Vu.get())};e()}}Wu.currentPopupAction=null;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Hu=new Map;class Gu extends zu{constructor(e,t,a=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,a),this.eventId=null}async execute(){let e=Hu.get(this.auth._key());if(!e){try{const t=await async function(e,t){const a=Yu(t),n=Ju(e);if(!(await n._isAvailable()))return!1;const i="true"===await n._get(a);return await n._remove(a),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Hu.set(this.auth._key(),e)}return this.bypassAuthState||Hu.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Ku(e,t){Hu.set(e._key(),t)}function Ju(e){return Ad(e._redirectPersistence)}function Yu(e){return xd("pendingRedirect",e.config.apiKey,e.name)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qu(e,t,a=!1){if(_c(e.app))return Promise.reject(Hc(e));const n=Jd(e),i=Fu(n,t),s=new Gu(n,i,a),o=await s.execute();return o&&!a&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,t)),o}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zu{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(e,a)&&(t=!0,this.sendToConsumer(e,a),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return eh(e);default:return!1}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var a;if(e.error&&!eh(e)){const n=(null==(a=e.error.code)?void 0:a.split("auth/")[1])||"internal-error";t.onError(Vc(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const a=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&a}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Xu(e))}saveEventToCache(e){this.cachedEventUids.add(Xu(e)),this.lastProcessedEventTime=Date.now()}}function Xu(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function eh({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const th=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ah=/^https?/;async function nh(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return rd(e,"GET","/v1/projects",t)}(e);for(const a of t)try{if(ih(a))return}catch{}zc(e,"unauthorized-domain")}function ih(e){const t=Qc(),{protocol:a,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===n?"chrome-extension:"===a&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===a&&i.hostname===n}if(!ah.test(a))return!1;if(th.test(e))return n===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sh=new ed(3e4,6e4);function oh(){const e=Su().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let a=0;a<e.CP.length;a++)e.CP[a]=null}function rh(e){return new Promise((t,a)=>{var n,i,s,o;function r(){oh(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{oh(),a(Vc(e,"network-request-failed"))},timeout:sh.get()})}if(null==(i=null==(n=Su().gapi)?void 0:n.iframes)?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null==(s=Su().gapi)?void 0:s.load)){const t=`__${"iframefcb"}${Math.floor(1e6*Math.random())}`;return Su()[t]=()=>{gapi.load?r():a(Vc(e,"network-request-failed"))},(o=`${Qd.gapiScript}?onload=${t}`,Qd.loadJS(o)).catch(e=>a(e))}r()}}).catch(e=>{throw lh=null,e})}let lh=null;
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ch=new ed(5e3,15e3),dh={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},uh=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function hh(e){const t=e.config;Kc(t.authDomain,e,"auth-domain-config-required");const a=t.emulator?td(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,n={apiKey:t.apiKey,appName:e.name,v:Ec},i=uh.get(e.config.apiHost);i&&(n.eid=i);const s=e._getFrameworks();return s.length&&(n.fw=s.join(",")),`${a}?${tl(n).slice(1)}`}async function ph(e){const t=await function(e){return lh=lh||rh(e),lh}(e),a=Su().gapi;return Kc(a,e,"internal-error"),t.open({where:document.body,url:hh(e),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:dh,dontclear:!0},t=>new Promise(async(a,n)=>{await t.restyle({setHideOnLeave:!1});const i=Vc(e,"network-request-failed"),s=Su().setTimeout(()=>{n(i)},ch.get());function o(){Su().clearTimeout(s),a(t)}t.ping(o).then(o,()=>{n(i)})}))}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class fh{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function vh(e,t,a,n=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let r="";const l={...mh,width:n.toString(),height:i.toString(),top:s,left:o},c=Ur().toLowerCase();a&&(r=Ud(c)?"_blank":a),Ld(c)&&(t=t||"http://localhost",l.scrollbars="yes");const d=Object.entries(l).reduce((e,[t,a])=>`${e}${t}=${a},`,"");if(function(e=Ur()){var t;return $d(e)&&!!(null==(t=window.navigator)?void 0:t.standalone)}(c)&&"_self"!==r)return function(e,t){const a=document.createElement("a");a.href=e,a.target=t;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(n)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t||"",r),new fh(null);const u=window.open(t||"",r,d);Kc(u,e,"popup-blocked");try{u.focus()}catch(h){}return new fh(u)}const gh="__/auth/handler",bh="emulator/auth/handler",wh=encodeURIComponent("fac");async function yh(e,t,a,n,i,s){Kc(e.config.authDomain,e,"auth-domain-config-required"),Kc(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:a,redirectUrl:n,v:Ec,eventId:i};if(t instanceof su){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",Qr(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries({}))o[e]=t}if(t instanceof ou){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const r=o;for(const d of Object.keys(r))void 0===r[d]&&delete r[d];const l=await e._getAppCheckToken(),c=l?`#${wh}=${encodeURIComponent(l)}`:"";return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${gh}`;return td(e,bh)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e)}?${tl(r).slice(1)}${c}`}const _h="webStorageSupport";const kh=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ku,this._completeRedirectFn=Qu,this._overrideRedirectResult=Ku}async _openPopup(e,t,a,n){var i;Yc(null==(i=this.eventManagers[e._key()])?void 0:i.manager,"_initialize() not called before _openPopup()");return vh(e,await yh(e,t,a,Qc(),n),Eu())}async _openRedirect(e,t,a,n){await this._originValidation(e);return function(e){Su().location.href=e}(await yh(e,t,a,Qc(),n)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:a}=this.eventManagers[t];return e?Promise.resolve(e):(Yc(a,"If manager is not set, promise should be"),a)}const a=this.initAndGetManager(e);return this.eventManagers[t]={promise:a},a.catch(()=>{delete this.eventManagers[t]}),a}async initAndGetManager(e){const t=await ph(e),a=new Zu(e);return t.register("authEvent",t=>{Kc(null==t?void 0:t.authEvent,e,"invalid-auth-event");return{status:a.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:a},this.iframes[e._key()]=t,a}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(_h,{type:_h},a=>{var n;const i=null==(n=null==a?void 0:a[0])?void 0:n[_h];void 0!==i&&t(!!i),zc(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=nh(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Vd()||Md()||$d()}};var Ch="@firebase/auth",Eh="1.11.0";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ih{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Kc(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Sh=Ar("authIdTokenMaxAge")||300;let Th=null;var Nh;Qd={loadJS:e=>new Promise((t,a)=>{const n=document.createElement("script");var i;n.setAttribute("src",e),n.onload=t,n.onerror=e=>{const t=Vc("internal-error");t.customData=e,a(t)},n.type="text/javascript",n.charset="UTF-8",((null==(i=document.getElementsByTagName("head"))?void 0:i[0])??document).appendChild(n)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Nh="Browser",wc(new ll("auth",(e,{options:t})=>{const a=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=a.options;Kc(s&&!s.includes(":"),"invalid-api-key",{appName:a.name});const r={apiKey:s,authDomain:o,clientPlatform:Nh,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Wd(Nh)},l=new Kd(a,n,i,r);return function(e,t){const a=(null==t?void 0:t.persistence)||[],n=(Array.isArray(a)?a:[a]).map(Ad);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,null==t?void 0:t.popupRedirectResolver)}(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,a)=>{e.getProvider("auth-internal").initialize()})),wc(new ll("auth-internal",e=>{const t=Jd(e.getProvider("auth").getImmediate());return new Ih(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Tc(Ch,Eh,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Nh)),Tc(Ch,Eh,"esm2020");const Ah=Object.freeze(Object.defineProperty({__proto__:null,AuthCredential:au,FacebookAuthProvider:ru,GithubAuthProvider:cu,GoogleAuthProvider:lu,OAuthCredential:iu,TwitterAuthProvider:du,beforeAuthStateChanged:vu,browserLocalPersistence:yu,browserPopupRedirectResolver:kh,browserSessionPersistence:ku,connectAuthEmulator:Xd,getAuth:function(e=Sc()){const t=yc(e,"auth");if(t.isInitialized())return t.getImmediate();const a=Zd(e,{popupRedirectResolver:kh,persistence:[Uu,yu,ku]}),n=Ar("authTokenSyncURL");if(n&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(n,location.origin);if(location.origin===e.origin){const t=(i=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),a=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(a&&a>Sh)return;const n=null==t?void 0:t.token;Th!==n&&(Th=n,await fetch(i,{method:n?"POST":"DELETE",headers:n?{Authorization:`Bearer ${n}`}:{}}))});vu(a,t,()=>t(a.currentUser)),fu(a,e=>t(e))}}var i;const s=Sr("auth");return s&&Xd(a,`http://${s}`),a},getIdTokenResult:fd,getRedirectResult:async function(e,t){return await Jd(e)._initializationPromise,Qu(e,t,!1)},inMemoryPersistence:Rd,indexedDBLocalPersistence:Uu,initializeAuth:Zd,onAuthStateChanged:function(e,t,a,n){return rl(e).onAuthStateChanged(t,a,n)},onIdTokenChanged:fu,prodErrorMap:qc,reload:Cd,signInAnonymously:async function(e){var t;if(_c(e.app))return Promise.reject(Hc(e));const a=Jd(e);if(await a._initializationPromise,null==(t=a.currentUser)?void 0:t.isAnonymous)return new uu({user:a.currentUser,providerId:null,operationType:"signIn"});const n=
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */await async function(e,t){return cd(e,"POST","/v1/accounts:signUp",od(e,t))}(a,{returnSecureToken:!0}),i=await uu._fromIdTokenResponse(a,"signIn",n,!0);return await a._updateCurrentUser(i.user),i},signInWithRedirect:function(e,t,a){return async function(e,t,a){if(_c(e.app))return Promise.reject(Hc(e));const n=Jd(e);(function(e,t,a){if(!(t instanceof a))throw a.name!==t.constructor.name&&zc(e,"argument-error"),Wc(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)})(e,t,su),await n._initializationPromise;const i=Fu(n,a);return await async function(e,t){return Ju(e)._set(Yu(t),"true")}(i,n),i._openRedirect(n,t,"signInViaRedirect")}(e,t,a)}},Symbol.toStringTag,{value:"Module"})),Ph=$a("App",{web:()=>G(()=>import("./web-B9FgIizL.js"),__vite__mapDeps([7,1,2])).then(e=>new e.AppWeb)}),Rh=$a("Browser",{web:()=>G(()=>import("./web-BoasosxK.js"),__vite__mapDeps([8,1,2])).then(e=>new e.BrowserWeb)});function xh(e=64){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=new Uint8Array(e);return crypto.getRandomValues(a),Array.from(a).map(e=>t[e%66]).join("")}async function Dh(){if(!ja.isNativePlatform())throw new Error("googleInAppLogin solo para plataformas nativas");const{androidClientId:e,redirectUri:t}=function(){const e="175482362472-d8i8so3lpdbkl30ls0gme012t18f9q8q.apps.googleusercontent.com",t=`com.googleusercontent.apps.${e.replace(".apps.googleusercontent.com","")}`;return{androidClientId:e,redirectUri:`${t}:/oauth2redirect`,redirectScheme:t}}(),a=xh(64),n=await async function(e){const t=(new TextEncoder).encode(e),a=await crypto.subtle.digest("SHA-256",t),n=Array.from(new Uint8Array(a));return btoa(String.fromCharCode.apply(null,n)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(a),i=xh(32),s=encodeURIComponent("openid email profile"),o=`https://accounts.google.com/o/oauth2/v2/auth?client_id=${encodeURIComponent(e)}&redirect_uri=${encodeURIComponent(t)}&response_type=code&scope=${s}&code_challenge=${n}&code_challenge_method=S256&state=${i}&prompt=select_account`;let r;try{const n=new Promise((e,t)=>{r=Ph.addListener("appUrlOpen",async a=>{try{const{params:t}=function(e){try{const t=new URL(e),a=Object.fromEntries(t.searchParams.entries());if(t.hash&&t.hash.startsWith("#")){const e=new URLSearchParams(t.hash.substring(1));for(const[t,n]of e.entries())a[t]=n}return{params:a,url:t}}catch(t){return{params:{},url:null}}}(a.url);if(t.state&&t.state!==i)return;(t.code||t.error)&&(await Rh.close(),e(t))}catch(n){t(n)}})});await Rh.open({url:o,presentationStyle:"popover"});const{code:s,error:l,error_description:c}=await n;if(l)throw new Error(c||l);if(!s)throw new Error("No se recibió código de autorización");const d=new URLSearchParams({code:s,client_id:e,redirect_uri:t,grant_type:"authorization_code",code_verifier:a}),u=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:d.toString()});if(!u.ok)throw new Error(`Fallo al canjear code: ${u.status}`);const h=await u.json(),p=h.id_token,m=h.access_token;if(!p)throw new Error("No se recibió id_token");const f=function(e){try{const[t,a]=e.split(".");return JSON.parse(atob(a))}catch(t){return{}}}(p);return{id_token:p,access_token:m,email:f.email,name:f.name,imageUrl:f.picture,sub:f.sub}}finally{r&&"function"==typeof r.remove&&r.remove()}}function Oh(){sessionStorage.removeItem("oauth_token_data"),console.log("🧹 Cleared stored OAuth token")}function Lh(){const e=a(!1),t=ja.isNativePlatform(),n={web:"175482362472-sbae126lpnl34rlsf24p8lmdau1obob3.apps.googleusercontent.com",android:"175482362472-d8i8so3lpdbkl30ls0gme012t18f9q8q.apps.googleusercontent.com",ios:"175482362472-qv7ql9v55gu9tq0um54u3u54up6584ud.apps.googleusercontent.com"},i=async()=>{try{console.log("🔵 Starting in-app Google OAuth (Browser + PKCE)...");const e=await Dh();if(e&&e.id_token)return{token:e.id_token,email:e.email,name:e.name,imageUrl:e.imageUrl,uid:e.sub,accessToken:e.access_token};const t=new lu;t.addScope("email"),t.addScope("profile");const a=await Sa();if(!a)throw new Error("Firebase Auth not initialized");const{signInWithRedirect:n}=await G(async()=>{const{signInWithRedirect:e}=await Promise.resolve().then(()=>Ah);return{signInWithRedirect:e}},void 0);return console.log("🔵 Falling back to Firebase signInWithRedirect..."),await n(a,t),null}catch(e){throw console.error("❌ Native Firebase Google Sign-In failed:",e),new Error(`Native Firebase Google Sign-In failed: ${e.message}`)}},s=async()=>{try{console.log("🔵 Starting OAuth2 Implicit Flow for web...");const e=function(){const e=sessionStorage.getItem("oauth_token_data");if(e)try{const t=JSON.parse(e);return console.log("🔍 Retrieved stored token data"),t}catch(t){console.error("❌ Error parsing stored token data:",t),sessionStorage.removeItem("oauth_token_data")}return null}();if(e&&e.access_token)return console.log("✅ Found stored OAuth token - processing..."),await r(e);console.log("🔍 Current URL:",window.location.href),console.log("🔍 Hash:",window.location.hash);const t=window.location.href;if(t.includes("#access_token=")||t.includes("#id_token="))return console.log("✅ OAuth2 redirect detected - processing response..."),await l();console.log("🔄 No OAuth2 redirect detected - initiating new flow...");const a=o();localStorage.setItem("oauth_state",a);const i=n.web,s=window.location.origin,c=encodeURIComponent(s),d=`https://accounts.google.com/o/oauth2/v2/auth?client_id=${i}&redirect_uri=${c}&response_type=id_token token&scope=${encodeURIComponent("email profile openid")}&state=${a}&prompt=select_account&include_granted_scopes=true&nonce=${o()}`;return console.log("🔄 OAuth2 Redirect URI:",s),console.log("🔄 Redirecting to Google OAuth2..."),window.location.href=d,null}catch(e){throw console.error("❌ Web OAuth2 Implicit Flow failed:",e),new Error(`Web OAuth2 failed: ${e.message}`)}},o=()=>{const e=new Uint32Array(8);return crypto.getRandomValues(e),Array.from(e,e=>("0"+e.toString(16)).substr(-2)).join("")},r=async e=>{try{console.log("🔍 Processing stored OAuth token...");const a=localStorage.getItem("oauth_state");if(console.log("🔍 State verification:",{received:e.state,stored:a}),e.state!==a)throw new Error("Invalid state parameter in stored token - possible CSRF attack");if(localStorage.removeItem("oauth_state"),!e.id_token)throw new Error("No ID token in stored data");let n;if(console.log("✅ Stored OAuth token validated - using ID token for backend"),e.access_token){const t=await fetch(`https://www.googleapis.com/oauth2/v1/userinfo?access_token=${e.access_token}`);t.ok&&(n=await t.json())}if(!n&&e.id_token)try{const t=JSON.parse(atob(e.id_token.split(".")[1]));n={id:t.sub,email:t.email,name:t.name,picture:t.picture}}catch(t){throw console.error("Error decoding ID token:",t),new Error("Failed to decode ID token")}return console.log("✅ User info obtained from stored token"),Oh(),{token:e.id_token,email:n.email,name:n.name,imageUrl:n.picture,uid:n.id,accessToken:e.access_token,idToken:e.id_token,tokenType:e.token_type,expiresIn:parseInt(e.expires_in),scope:e.scope,userInfo:n}}catch(t){throw console.error("❌ Error processing stored OAuth token:",t),Oh(),t}},l=async()=>{try{console.log("🔍 Processing OAuth redirect response...");const e=window.location.hash.substring(1);console.log("🔍 Hash parameters:",e);const t=new URLSearchParams(e),a=t.get("access_token"),n=t.get("token_type"),i=t.get("expires_in"),s=t.get("state"),o=t.get("scope");console.log("🔍 Extracted params:",{accessToken:a?"***":null,tokenType:n,expiresIn:i,state:s,scope:o});const r=localStorage.getItem("oauth_state");if(console.log("🔍 State verification:",{received:s,stored:r}),s!==r)throw new Error("Invalid state parameter - possible CSRF attack");if(localStorage.removeItem("oauth_state"),!a)throw new Error("No access token received from OAuth response");console.log("✅ OAuth2 access token obtained");const l=await fetch(`https://www.googleapis.com/oauth2/v1/userinfo?access_token=${a}`);if(!l.ok)throw new Error("Failed to fetch user information");const c=await l.json();return window.history.replaceState({},document.title,window.location.pathname+window.location.search),{token:a,email:c.email,name:c.name,imageUrl:c.picture,uid:c.id,accessToken:a,tokenType:n,expiresIn:parseInt(i),scope:o,userInfo:c}}catch(e){throw console.error("❌ Error processing OAuth2 redirect response:",e),window.history.replaceState({},document.title,window.location.pathname+window.location.search),e}};return{isLoading:e,isNativePlatform:t,signInWithGoogle:async()=>{e.value=!0;try{return t?await i():await s()}finally{e.value=!1}},extractEmailFromToken:e=>{try{return JSON.parse(atob(e.split(".")[1])).email}catch(t){return console.error("Error extracting email from token:",t),null}},getPlatformClientId:()=>{const e=ja.getPlatform();return n[e]||n.web}}}const Mh=(e,t)=>{const a=e.__vccOpts||e;for(const[n,i]of t)a[n]=i;return a},Uh={class:"auth-container"},Fh={class:"auth-card"},qh={key:0,class:"alert alert-danger"},Bh={class:"mb-3"},jh=["disabled"],$h={class:"mb-3"},zh=["disabled"],Vh={class:"d-flex justify-content-between align-items-center mb-4"},Wh={class:"form-check"},Hh=["disabled"],Gh={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Kh=["disabled"],Jh={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Yh={key:1,class:"bi bi-google me-2"},Qh={class:"text-center mt-4"};const Zh=Mh({name:"LoginView",setup(){const e=b(),t=tn(),{signInWithGoogle:i,isNativePlatform:s}=Lh(),o=a(""),r=a(""),l=a(!1),c=a(""),d=a(!1),u=n(()=>""!==o.value.trim()&&""!==r.value.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.value));return g(async()=>{var a,n,o,r;console.log("🔍 Login component mounted"),console.log("🔍 Is native platform:",s),console.log("🔍 Current URL:",window.location.href),console.log("🔍 Hash:",window.location.hash);try{if(!s){const s=sessionStorage.getItem("oauth_token_data"),o=window.location.hash.includes("access_token=")||window.location.hash.includes("id_token=");if(console.log("🔍 Checking OAuth tokens:",{hasStoredToken:!!s,hasHashToken:o}),s||o){console.log("✅ OAuth2 data detectado - procesando...",s?"(stored)":"(hash)"),d.value=!0;try{const a=await i();if(a){console.log("✅ Respuesta OAuth2 procesada:",a.email);const n={google_token:a.token,fcm_token:localStorage.getItem("fcm_token")||void 0,platform:"web",email:a.email,name:a.name,avatar:a.imageUrl},i=new URLSearchParams(window.location.search),s=i.get("invitation_code")||i.get("code");s&&(n.business_invitation_code=s);const o=await t.loginWithGoogle(n);o.staff_request_created&&console.log(`✅ Solicitud de staff creada para: ${o.business_name}`);const r=localStorage.getItem("redirectAfterLogin");r?(localStorage.removeItem("redirectAfterLogin"),e.push(r)):e.push({name:"role-selection"})}}catch(l){console.error("❌ Error procesando OAuth2 redirect:",l),c.value=(null==(n=null==(a=l.response)?void 0:a.data)?void 0:n.message)||l.message||"Error procesando autenticación de Google"}finally{d.value=!1}}}if(s){const{getAuth:a}=await G(async()=>{const{getAuth:e}=await Promise.resolve().then(()=>Ma);return{getAuth:e}},void 0),{getRedirectResult:n,GoogleAuthProvider:i}=await G(async()=>{const{getRedirectResult:e,GoogleAuthProvider:t}=await Promise.resolve().then(()=>Ah);return{getRedirectResult:e,GoogleAuthProvider:t}},void 0),s=await a();if(s){const a=await n(s);if(a){console.log("🔄 Procesando resultado de Firebase redirect móvil...");const n=a.user,s=i.credentialFromResult(a),u={token:await n.getIdToken(),email:n.email,name:n.displayName,imageUrl:n.photoURL,uid:n.uid,accessToken:null==s?void 0:s.accessToken};console.log("✅ Resultado de Firebase redirect procesado:",u.email),d.value=!0;const h={google_token:u.token,fcm_token:localStorage.getItem("fcm_token")||void 0,platform:"android",email:u.email,name:u.name,avatar:u.imageUrl},p=new URLSearchParams(window.location.search),m=p.get("invitation_code")||p.get("code");m&&(h.business_invitation_code=m);try{const a=await t.loginWithGoogle(h);a.staff_request_created&&console.log(`✅ Solicitud de staff creada para: ${a.business_name}`);const n=localStorage.getItem("redirectAfterLogin");n?(localStorage.removeItem("redirectAfterLogin"),e.push(n)):e.push({name:"role-selection"})}catch(l){console.error("❌ Error procesando login móvil con Google:",l),c.value=(null==(r=null==(o=l.response)?void 0:o.data)?void 0:r.message)||l.message||"Error al autenticarse con Google"}finally{d.value=!1}}}}}catch(u){console.error("❌ Error verificando resultado de redirect:",u)}}),{email:o,password:r,remember:l,error:c,loading:d,isNativePlatform:s,isFormValid:u,handleLogin:async()=>{var a,n;if(u.value){d.value=!0,c.value="";try{await t.login({email:o.value,password:r.value}),e.push({name:"role-selection"})}catch(i){console.error("Error de inicio de sesión:",i),c.value=(null==(n=null==(a=i.response)?void 0:a.data)?void 0:n.message)||"Error al iniciar sesión. Por favor, inténtalo de nuevo."}finally{d.value=!1}}},handleGoogleLogin:async()=>{var a,n,o,r;try{d.value=!0,c.value="",console.log("🔵 Iniciando autenticación con Google...",s?"NATIVO":"WEB");const a=await i();if(null===a)return void(c.value="Redirigiendo a Google Sign-In...");console.log("✅ Token de Google obtenido para:",a.email);const n={google_token:a.token,fcm_token:localStorage.getItem("fcm_token")||void 0,platform:s?"android":"web",email:a.email,name:a.name,avatar:a.imageUrl},o=new URLSearchParams(window.location.search),r=o.get("invitation_code")||o.get("code");r&&(n.business_invitation_code=r,console.log("🏢 Código de invitación detectado:",r)),console.log("🚀 Enviando datos de login/registro con Google al servidor...");const l=await t.loginWithGoogle(n);l.staff_request_created&&(console.log(`✅ Solicitud de staff creada para: ${l.business_name}`),l.message&&console.log("📢 Mensaje del servidor:",l.message));const u=localStorage.getItem("redirectAfterLogin");u?(localStorage.removeItem("redirectAfterLogin"),e.push(u)):e.push({name:"role-selection"})}catch(l){if(console.error("❌ Error en autenticación con Google:",l),"Redirecting to Google Sign-In..."===l.message)return void(c.value="Redirigiendo a Google Sign-In...");"Google sign-in cancelled by user"===l.message?c.value="Autenticación cancelada":401===(null==(a=l.response)?void 0:a.status)?c.value="Token de Google inválido. Por favor, inténtalo de nuevo.":c.value=(null==(o=null==(n=l.response)?void 0:n.data)?void 0:o.message)||l.message||"Error al autenticarse con Google"}finally{(null==(r=c.value)?void 0:r.includes("Redirigiendo"))||(d.value=!1)}}}}},[["render",function(e,t,a,n,i,g){const b=f("router-link");return w(),s("div",Uh,[o("div",Fh,[t[13]||(t[13]=o("div",{class:"text-center mb-4"},[o("h1",{class:"h3"},"Iniciar Sesión"),o("p",{class:"text-muted"},"Accede a tu cuenta de MOZO")],-1)),n.error?(w(),s("div",qh,l(n.error),1)):r("",!0),o("form",{onSubmit:t[4]||(t[4]=c((...e)=>n.handleLogin&&n.handleLogin(...e),["prevent"]))},[o("div",Bh,[t[5]||(t[5]=o("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),d(o("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,jh),[[u,n.email]])]),o("div",$h,[t[6]||(t[6]=o("label",{for:"password",class:"form-label"},"Contraseña",-1)),d(o("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),required:"",disabled:n.loading,placeholder:"Tu contraseña"},null,8,zh),[[u,n.password]])]),o("div",Vh,[o("div",Wh,[d(o("input",{class:"form-check-input",type:"checkbox",id:"remember","onUpdate:modelValue":t[2]||(t[2]=e=>n.remember=e)},null,512),[[p,n.remember]]),t[7]||(t[7]=o("label",{class:"form-check-label",for:"remember"}," Recordarme ",-1))]),h(b,{to:"/forgot-password",class:"link-primary"},{default:m(()=>t[8]||(t[8]=[v("¿Olvidaste tu contraseña?")])),_:1,__:[8]})]),o("button",{type:"submit",class:"btn btn-primary w-100 mb-3",disabled:n.loading||!n.isFormValid},[n.loading?(w(),s("span",Gh)):r("",!0),t[9]||(t[9]=v(" Iniciar sesión "))],8,Hh),t[12]||(t[12]=o("div",{class:"text-center my-3"},[o("span",{class:"text-muted"},"O continúa con")],-1)),o("button",{type:"button",class:"btn btn-outline-secondary w-100 mb-3",onClick:t[3]||(t[3]=(...e)=>n.handleGoogleLogin&&n.handleGoogleLogin(...e)),disabled:n.loading},[n.loading?(w(),s("span",Jh)):(w(),s("i",Yh)),v(" "+l(n.loading?"Iniciando...":"Continuar con Google"),1)],8,Kh),o("div",Qh,[t[11]||(t[11]=o("span",{class:"text-muted"},"¿No tienes una cuenta?",-1)),h(b,{to:"/register",class:"link-primary ms-1"},{default:m(()=>t[10]||(t[10]=[v("Registrarse")])),_:1,__:[10]})])],32)])])}],["__scopeId","data-v-83fb9e2b"]]);const Xh={name:"RegisterView",setup(){const e=b(),t=tn(),{signInWithGoogleAndCheckUser:i,isInitializing:s}=function(){const e=a(!1),t=a(!1),n=e=>{try{return JSON.parse(atob(e.split(".")[1])).email}catch(h){return console.error("Error extracting email from token:",h),null}},i=async()=>{if(!e.value)if(t.value)for(;t.value;)await new Promise(e=>setTimeout(e,100));else{t.value=!0;try{if(!(await Sa()))throw new Error("Firebase Auth not initialized");e.value=!0,t.value=!1,console.log("✅ Firebase Auth initialized for Google Sign-In")}catch(h){throw console.error("❌ Error initializing Firebase Auth:",h),t.value=!1,h}}},s=async()=>{try{await i(),console.log("🔵 Starting Firebase Google Sign-In...");const e=new lu;e.addScope("email"),e.addScope("profile"),e.setCustomParameters({prompt:"select_account"});const t=await Sa(),{signInWithRedirect:a,getRedirectResult:n}=await G(async()=>{const{signInWithRedirect:e,getRedirectResult:t}=await Promise.resolve().then(()=>Ah);return{signInWithRedirect:e,getRedirectResult:t}},void 0),s=await n(t);if(s){const e=s.user;return console.log("✅ Firebase redirect result obtained"),await e.getIdToken()}return console.log("🔄 Starting Firebase redirect..."),await a(t,e),null}catch(h){throw console.error("Error in Google sign-in:",h),h}};return g(()=>{i().catch(console.error)}),{isGoogleLoaded:e,isInitializing:t,initializeGoogle:i,signInWithGoogle:s,signInWithGoogleAndCheckUser:async(e=!1)=>{const t=await s();return t?{token:t,email:n(t),isRegistering:e}:null},extractEmailFromToken:n}}(),{signInWithGoogle:o,isNativePlatform:r}=Lh(),l=a(""),c=a(""),d=a(""),u=a(""),h=a(""),p=a(!1),m=n(()=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.value)),f=n(()=>d.value.length>=8),v=n(()=>d.value===u.value),w=n(()=>""!==l.value.trim()&&m.value&&f.value&&v.value);return{name:l,email:c,password:d,passwordConfirmation:u,error:h,loading:p,isInitializing:s,isEmailValid:m,isPasswordValid:f,doPasswordsMatch:v,isFormValid:w,handleRegister:async()=>{var a,n;if(w.value){p.value=!0,h.value="";try{await t.register({name:l.value,email:c.value,password:d.value,password_confirmation:u.value}),e.push({name:"role-selection"})}catch(i){console.error("Error de registro:",i),h.value=(null==(n=null==(a=i.response)?void 0:a.data)?void 0:n.message)||"Error al crear la cuenta. Por favor, inténtalo de nuevo."}finally{p.value=!1}}},handleGoogleRegister:async()=>{var a,n,s,l;try{let a,n;if(p.value=!0,h.value="",console.log("🔵 Iniciando registro con Google...",r?"NATIVO":"WEB"),r){const e=await o();a=e.token,n=e.email}else{const e=await i(!0);a=e.token,n=e.email}console.log("✅ Token de Google obtenido para:",n);const s={google_token:a,fcm_token:localStorage.getItem("fcm_token")||void 0,platform:r?"android":"web"},l=new URLSearchParams(window.location.search),c=l.get("invitation_code")||l.get("code");c&&(s.business_invitation_code=c,console.log("🏢 Código de invitación detectado:",c)),console.log("🚀 Enviando datos de registro al servidor...");const d=await t.loginWithGoogle(s);d.staff_request_created&&(console.log(`✅ Solicitud de staff creada para: ${d.business_name}`),d.message&&console.log("📢 Mensaje del servidor:",d.message)),e.push({name:"role-selection"})}catch(c){if(console.error("❌ Error en registro con Google:",c),"Redirecting to Google Sign-In..."===c.message)return void(h.value="Redirigiendo a Google Sign-In...");"Google sign-in cancelled by user"===c.message?h.value="Registro cancelado":401===(null==(a=c.response)?void 0:a.status)?h.value="Token de Google inválido. Por favor, inténtalo de nuevo.":h.value=(null==(s=null==(n=c.response)?void 0:n.data)?void 0:s.message)||c.message||"Error al registrarse con Google"}finally{(null==(l=h.value)?void 0:l.includes("Redirigiendo"))||(p.value=!1)}}}}},ep={class:"auth-container"},tp={class:"auth-card"},ap={key:0,class:"alert alert-danger"},np={class:"mb-3"},ip=["disabled"],sp={class:"mb-3"},op=["disabled"],rp={key:0,class:"form-text text-danger"},lp={class:"mb-3"},cp=["disabled"],dp={key:0,class:"form-text text-danger"},up={class:"mb-4"},hp=["disabled"],pp={key:0,class:"form-text text-danger"},mp=["disabled"],fp={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},vp=["disabled"],gp={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},bp={key:1,class:"bi bi-google me-2"},wp={class:"text-center"};const yp=Mh(Xh,[["render",function(e,t,a,n,i,p){const g=f("router-link");return w(),s("div",ep,[o("div",tp,[t[14]||(t[14]=o("div",{class:"text-center mb-4"},[o("h1",{class:"h3"},"Crear cuenta"),o("p",{class:"text-muted"},"Regístrate para acceder a MOZO")],-1)),n.error?(w(),s("div",ap,l(n.error),1)):r("",!0),o("form",{onSubmit:t[5]||(t[5]=c((...e)=>n.handleRegister&&n.handleRegister(...e),["prevent"]))},[o("div",np,[t[6]||(t[6]=o("label",{for:"name",class:"form-label"},"Nombre completo",-1)),d(o("input",{type:"text",class:"form-control",id:"name","onUpdate:modelValue":t[0]||(t[0]=e=>n.name=e),required:"",disabled:n.loading,placeholder:"Tu nombre completo"},null,8,ip),[[u,n.name]])]),o("div",sp,[t[7]||(t[7]=o("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),d(o("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[1]||(t[1]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,op),[[u,n.email]]),!n.isEmailValid&&n.email?(w(),s("div",rp," Introduce un correo electrónico válido ")):r("",!0)]),o("div",lp,[t[8]||(t[8]=o("label",{for:"password",class:"form-label"},"Contraseña",-1)),d(o("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[2]||(t[2]=e=>n.password=e),required:"",disabled:n.loading,placeholder:"Mínimo 8 caracteres"},null,8,cp),[[u,n.password]]),!n.isPasswordValid&&n.password?(w(),s("div",dp," La contraseña debe tener al menos 8 caracteres ")):r("",!0)]),o("div",up,[t[9]||(t[9]=o("label",{for:"passwordConfirmation",class:"form-label"},"Confirmar contraseña",-1)),d(o("input",{type:"password",class:"form-control",id:"passwordConfirmation","onUpdate:modelValue":t[3]||(t[3]=e=>n.passwordConfirmation=e),required:"",disabled:n.loading,placeholder:"Repite tu contraseña"},null,8,hp),[[u,n.passwordConfirmation]]),!n.doPasswordsMatch&&n.passwordConfirmation?(w(),s("div",pp," Las contraseñas no coinciden ")):r("",!0)]),o("button",{type:"submit",class:"btn btn-primary w-100 mb-3",disabled:n.loading||!n.isFormValid},[n.loading?(w(),s("span",fp)):r("",!0),t[10]||(t[10]=v(" Crear cuenta "))],8,mp),t[13]||(t[13]=o("div",{class:"text-center my-3"},[o("span",{class:"text-muted"},"O regístrate con")],-1)),o("button",{type:"button",class:"btn btn-outline-secondary w-100 mb-4",onClick:t[4]||(t[4]=(...e)=>n.handleGoogleRegister&&n.handleGoogleRegister(...e)),disabled:n.loading||n.isInitializing},[n.loading?(w(),s("span",gp)):(w(),s("i",bp)),v(" "+l(n.loading?"Registrando...":"Continuar con Google"),1)],8,vp),o("div",wp,[t[12]||(t[12]=o("span",{class:"text-muted"},"¿Ya tienes una cuenta?",-1)),h(g,{to:"/login",class:"link-primary ms-1"},{default:m(()=>t[11]||(t[11]=[v("Iniciar sesión")])),_:1,__:[11]})])],32)])])}],["__scopeId","data-v-803f6633"]]),_p={class:"auth-container"},kp={class:"auth-card"},Cp={key:0,class:"alert alert-success"},Ep={key:1,class:"alert alert-danger"},Ip={class:"mb-4"},Sp=["disabled"],Tp=["disabled"],Np={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Ap={class:"text-center"},Pp={key:3,class:"text-center mt-3"};const Rp=Mh({name:"ForgotPasswordView",setup(){const e=a(""),t=a(""),i=a(""),s=a(!1),o=n(()=>""!==e.value.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value));return{email:e,error:t,success:i,loading:s,isFormValid:o,handleForgotPassword:async()=>{var a,n;if(o.value){s.value=!0,t.value="",i.value="";try{await dr.forgotPassword(e.value),i.value="Se ha enviado un enlace de recuperación a tu correo electrónico. Por favor, revisa tu bandeja de entrada.",e.value=""}catch(r){console.error("Error al solicitar recuperación de contraseña:",r),t.value=(null==(n=null==(a=r.response)?void 0:a.data)?void 0:n.message)||"No se pudo enviar el enlace de recuperación. Por favor, inténtalo de nuevo."}finally{s.value=!1}}}}}},[["render",function(e,t,a,n,i,p){const g=f("router-link");return w(),s("div",_p,[o("div",kp,[t[6]||(t[6]=o("div",{class:"text-center mb-4"},[o("h1",{class:"h3"},"Recuperar contraseña"),o("p",{class:"text-muted"},"Ingresa tu correo electrónico para recibir un enlace de recuperación")],-1)),n.success?(w(),s("div",Cp,l(n.success),1)):r("",!0),n.error?(w(),s("div",Ep,l(n.error),1)):r("",!0),n.success?r("",!0):(w(),s("form",{key:2,onSubmit:t[1]||(t[1]=c((...e)=>n.handleForgotPassword&&n.handleForgotPassword(...e),["prevent"]))},[o("div",Ip,[t[2]||(t[2]=o("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),d(o("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,Sp),[[u,n.email]])]),o("button",{type:"submit",class:"btn btn-primary w-100 mb-4",disabled:n.loading||!n.isFormValid},[n.loading?(w(),s("span",Np)):r("",!0),t[3]||(t[3]=v(" Enviar enlace de recuperación "))],8,Tp),o("div",Ap,[h(g,{to:"/login",class:"link-primary"},{default:m(()=>t[4]||(t[4]=[o("i",{class:"bi bi-arrow-left me-1"},null,-1),v(" Volver a inicio de sesión ")])),_:1,__:[4]})])],32)),n.success?(w(),s("div",Pp,[h(g,{to:"/login",class:"btn btn-outline-primary"},{default:m(()=>t[5]||(t[5]=[v(" Volver a inicio de sesión ")])),_:1,__:[5]})])):r("",!0)])])}],["__scopeId","data-v-af089bfd"]]),xp={name:"ResetPasswordView",setup(){b();const e=y(),t=a(""),i=a(""),s=a(""),o=a(""),r=a(""),l=a(""),c=a(!1),d=n(()=>s.value.length>=8),u=n(()=>s.value===o.value),h=n(()=>""!==t.value&&""!==i.value.trim()&&d.value&&u.value);g(()=>{t.value=e.query.token||"",i.value=e.query.email||"",t.value||(r.value="Token de restablecimiento no válido o expirado. Por favor, solicita un nuevo enlace de recuperación.")});return{email:i,password:s,passwordConfirmation:o,error:r,success:l,loading:c,isPasswordValid:d,doPasswordsMatch:u,isFormValid:h,handleResetPassword:async()=>{var e,a;if(h.value){c.value=!0,r.value="",l.value="";try{await dr.resetPassword(t.value,i.value,s.value,o.value),l.value="Tu contraseña ha sido restablecida con éxito. Ya puedes iniciar sesión con tu nueva contraseña.",s.value="",o.value=""}catch(n){console.error("Error al restablecer contraseña:",n),r.value=(null==(a=null==(e=n.response)?void 0:e.data)?void 0:a.message)||"No se pudo restablecer la contraseña. Por favor, inténtalo de nuevo o solicita un nuevo enlace."}finally{c.value=!1}}}}}},Dp={class:"auth-container"},Op={class:"auth-card"},Lp={key:0,class:"alert alert-success"},Mp={key:1,class:"alert alert-danger"},Up={class:"mb-3"},Fp=["disabled"],qp={class:"mb-3"},Bp=["disabled"],jp={key:0,class:"form-text text-danger"},$p={class:"mb-4"},zp=["disabled"],Vp={key:0,class:"form-text text-danger"},Wp=["disabled"],Hp={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Gp={class:"text-center"},Kp={key:3,class:"text-center mt-3"};const Jp=Mh(xp,[["render",function(e,t,a,n,i,p){const g=f("router-link");return w(),s("div",Dp,[o("div",Op,[t[10]||(t[10]=o("div",{class:"text-center mb-4"},[o("h1",{class:"h3"},"Restablecer contraseña"),o("p",{class:"text-muted"},"Crea una nueva contraseña segura")],-1)),n.success?(w(),s("div",Lp,l(n.success),1)):r("",!0),n.error?(w(),s("div",Mp,l(n.error),1)):r("",!0),n.success?r("",!0):(w(),s("form",{key:2,onSubmit:t[3]||(t[3]=c((...e)=>n.handleResetPassword&&n.handleResetPassword(...e),["prevent"]))},[o("div",Up,[t[4]||(t[4]=o("label",{for:"email",class:"form-label"},"Correo electrónico",-1)),d(o("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",disabled:n.loading,placeholder:"correo@ejemplo.com"},null,8,Fp),[[u,n.email]])]),o("div",qp,[t[5]||(t[5]=o("label",{for:"password",class:"form-label"},"Nueva contraseña",-1)),d(o("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),required:"",disabled:n.loading,placeholder:"Mínimo 8 caracteres"},null,8,Bp),[[u,n.password]]),!n.isPasswordValid&&n.password?(w(),s("div",jp," La contraseña debe tener al menos 8 caracteres ")):r("",!0)]),o("div",$p,[t[6]||(t[6]=o("label",{for:"passwordConfirmation",class:"form-label"},"Confirmar nueva contraseña",-1)),d(o("input",{type:"password",class:"form-control",id:"passwordConfirmation","onUpdate:modelValue":t[2]||(t[2]=e=>n.passwordConfirmation=e),required:"",disabled:n.loading,placeholder:"Repite tu nueva contraseña"},null,8,zp),[[u,n.passwordConfirmation]]),!n.doPasswordsMatch&&n.passwordConfirmation?(w(),s("div",Vp," Las contraseñas no coinciden ")):r("",!0)]),o("button",{type:"submit",class:"btn btn-primary w-100 mb-4",disabled:n.loading||!n.isFormValid},[n.loading?(w(),s("span",Hp)):r("",!0),t[7]||(t[7]=v(" Cambiar contraseña "))],8,Wp),o("div",Gp,[h(g,{to:"/login",class:"link-primary"},{default:m(()=>t[8]||(t[8]=[o("i",{class:"bi bi-arrow-left me-1"},null,-1),v(" Volver a inicio de sesión ")])),_:1,__:[8]})])],32)),n.success?(w(),s("div",Kp,[h(g,{to:"/login",class:"btn btn-primary"},{default:m(()=>t[9]||(t[9]=[v(" Ir a inicio de sesión ")])),_:1,__:[9]})])):r("",!0)])])}],["__scopeId","data-v-9859a781"]]),Yp="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+DQogIDwhLS0gRm9uZG8gZGVsIGxvZ28gLS0+DQogIDxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiByeD0iNDAiIGZpbGw9IiM3QzZDRjMiLz4NCiAgDQogIDwhLS0gT2pvcyAtLT4NCiAgPGNpcmNsZSBjeD0iNzAiIGN5PSI4MCIgcj0iMTUiIGZpbGw9ImJsYWNrIi8+DQogIDxjaXJjbGUgY3g9IjEzMCIgY3k9IjgwIiByPSIxNSIgZmlsbD0iYmxhY2siLz4NCiAgDQogIDwhLS0gQ2VqYXMgLS0+DQogIDxsaW5lIHgxPSI1MCIgeTE9IjYwIiB4Mj0iOTAiIHkyPSI2MCIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSI1IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4NCiAgPGxpbmUgeDE9IjExMCIgeTE9IjYwIiB4Mj0iMTUwIiB5Mj0iNjAiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+DQogIA0KICA8IS0tIEJvY2Egc29ucmllbnRlIC0tPg0KICA8cGF0aCBkPSJNNzAgMTMwIFExMDAgMTYwIDEzMCAxMzAiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+DQogIA0KICA8IS0tIFRleHRvICJNT1pPIiAtLT4NCiAgPHRleHQgeD0iMTAwIiB5PSIxMTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZvbnQtc2l6ZT0iMzQiIGZpbGw9ImJsYWNrIj5NT1pPPC90ZXh0Pg0KPC9zdmc+IA==",Qp={class:"container d-flex justify-content-center align-items-center vh-100"},Zp={class:"row justify-content-center align-items-center w-100"},Xp={class:"role-card col-11 d-flex flex-column justify-content-center align-items-center"},em={class:"row justify-content-between align-items-center w-100"},tm={class:"col me-2 d-flex flex-column justify-content-center align-items-center px-0"},am={class:"col ms-2 d-flex flex-column justify-content-center align-items-center px-0"},nm={class:"mt-5 text-center row justify-content-center align-items-center w-100"},im=["disabled"],sm=Mh({__name:"RoleSelection",props:[],setup(e){const t=b(),n=a(""),i=a(!1),r=a(""),l=tn(),c=async e=>{if(r.value)return;r.value=e,n.value="";try{console.log("RoleSelection - Inicio de selección de rol:",e),console.log("RoleSelection - Token antes de selectRole:",localStorage.getItem("token"));const t=await dr.selectRole(e);console.log("RoleSelection - Respuesta de selectRole:",t),console.log("RoleSelection - Token después de selectRole:",localStorage.getItem("token"))}catch(i){console.warn("RoleSelection - selectRole falló, se continúa localmente:",(null==i?void 0:i.message)||i),console.error("RoleSelection - Error completo:",i)}console.log("RoleSelection - Actualizando estado local con setSelectedRole"),l.setSelectedRole(e),console.log("RoleSelection - Estado actualizado, token actual:",localStorage.getItem("token"));const a="waiter"===e?"waiter-dashboard":"admin";console.log("RoleSelection - Redirigiendo a:",a),t.push({name:a}),r.value=""},d=async()=>{try{await dr.logout(),l.logout(),t.push({name:"login"})}catch(e){t.push({name:"login"})}};return(e,t)=>(w(),s("div",Qp,[o("div",Zp,[o("div",Xp,[t[5]||(t[5]=o("div",{class:"text-center mb-4 row justify-content-center align-items-center w-100"},[o("img",{src:Yp,alt:"MOZO Logo",class:"logo mb-3"}),o("h1",{class:"h3"},"¿Qué rol tienes?")],-1)),o("div",em,[o("div",tm,[o("div",{class:"role-option static",onClick:t[0]||(t[0]=e=>c("admin"))},t[2]||(t[2]=[o("div",{class:"role-icon"},[o("i",{class:"bi bi-house-door"})],-1),o("h3",{class:"h5 mt-3"},"Dueño",-1)]))]),o("div",am,[o("div",{class:"role-option static",onClick:t[1]||(t[1]=e=>c("waiter"))},t[3]||(t[3]=[o("div",{class:"role-icon"},[o("i",{class:"bi bi-person"})],-1),o("h3",{class:"h5 mt-3"},"Mozo",-1)]))])]),o("div",nm,[o("button",{class:"btn btn-outline-secondary w-100",onClick:d,disabled:i.value||!!r.value},t[4]||(t[4]=[o("i",{class:"bi bi-box-arrow-left me-1"},null,-1),v(" Cerrar sesión ")]),8,im)])])])]))}},[["__scopeId","data-v-22e7f38d"]]);const om=new class{async callWaiter(e,t={}){const{message:a,urgency:n="normal",client_info:i}=t;try{return(await ga.callWaiter(e)).data}catch(s){throw console.error("Error calling waiter:",s),this.handleError(s)}}async getPendingCalls(){try{return(await ga.getPendingCalls()).data}catch(e){throw this.handleError(e)}}async acknowledgCall(e){try{return(await ga.acknowledgeCall(e)).data}catch(t){throw this.handleError(t)}}async completeCall(e){try{return(await ga.completeCall(e)).data}catch(t){throw this.handleError(t)}}async getWaiterCallHistory(e="today",t=1,a=20){try{return(await ga.getWaiterCallHistory({filter:e,page:t,limit:a})).data}catch(n){throw this.handleError(n)}}async getAdminCallHistory(e="today",t=1,a=20){try{return(await ga.getAdminCallHistory({filter:e,page:t,limit:a})).data}catch(n){throw this.handleError(n)}}async activateTable(e){var t;try{return(await ga.activateTable(e)).data}catch(a){throw console.error("❌ Error activating table:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data),this.handleError(a)}}async deactivateTable(e){try{return(await ga.deactivateTable(e)).data}catch(t){throw console.error("Error deactivating table:",t),this.handleError(t)}}async activateMultipleTables(e){var t;try{return(await ga.activateMultipleTables({table_ids:e})).data}catch(a){throw console.error("❌ Error activating multiple tables:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data),this.handleError(a)}}async deactivateMultipleTables(e){try{return(await ga.deactivateMultipleTables({table_ids:e})).data}catch(t){throw console.error("Error deactivating multiple tables:",t),this.handleError(t)}}async silenceTable(e,t=30,a=""){var n;const i={duration_minutes:t,notes:"string"==typeof a?a:""};try{const t=await ga.silenceTable(e,i);return console.log("✅ Respuesta silenciar mesa:",t.data),t.data}catch(s){throw console.error("❌ Error silencing table:",s),console.error("❌ Error details:",null==(n=s.response)?void 0:n.data),this.handleError(s)}}async unsilenceTable(e){var t;console.log("🔊 Quitando silencio de mesa:",e);try{const t=await ga.unsilenceTable(e);return console.log("✅ Respuesta quitar silencio:",t.data),t.data}catch(a){console.error("❌ Error unsilencing table:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data)}}async silenceMultipleTables(e,t=30,a=""){try{return(await ga.post("/waiter/tables/silence/multiple",{table_ids:e,duration_minutes:t,notes:a})).data}catch(n){throw console.error("Error silencing multiple tables:",n),this.handleError(n)}}async unsilenceMultipleTables(e){try{return(await ga.post("/waiter/tables/unsilence/multiple",{table_ids:e})).data}catch(t){throw console.error("Error unsilencing multiple tables:",t),this.handleError(t)}}async getSilencedTables(){try{return(await ga.getSilencedTables()).data}catch(e){throw console.error("Error getting silenced tables:",e),this.handleError(e)}}async getAssignedTables(){try{return(await ga.getAssignedTables()).data}catch(e){throw console.error("Error getting assigned tables:",e),this.handleError(e)}}async getAvailableTables(){try{return(await ga.getAvailableTables()).data}catch(e){throw console.error("Error getting available tables:",e),this.handleError(e)}}async getWaiterBusinesses(){try{const e=await ga.getWaiterBusinesses();return console.log("Negocios del mozo obtenidos:",e.data),e.data}catch(e){throw console.error("Error getting waiter businesses:",e),this.handleError(e)}}async setActiveWaiterBusiness(e){try{return(await ga.setActiveWaiterBusiness(e)).data}catch(t){throw console.error("Error setting active business:",t),this.handleError(t)}}async getActiveWaiterBusiness(){try{return(await ga.getActiveWaiterBusiness()).data}catch(e){throw console.error("Error getting active business:",e),this.handleError(e)}}async getWaiterBusinessTables(e){var t;try{return(await ga.getWaiterBusinessTables(e)).data}catch(a){throw console.error("❌ Error getting business tables:",a),console.error("❌ Error details:",null==(t=a.response)?void 0:t.data),this.handleError(a)}}async joinBusinessWithCode(e){try{return(await ga.joinBusinessWithCode(e)).data}catch(t){throw console.error("Error joining business with code:",t),this.handleError(t)}}async blockIpForSpam(e,t={}){try{const a={call_id:e,reason:t.reason||"spam",duration_hours:t.duration_hours||24,notes:t.notes||"Bloqueado por spam"};return(await ga.blockIpForSpam(a)).data}catch(a){throw console.error("Error blocking IP for spam:",a),this.handleError(a)}}async unblockIp(e,t=null){try{const a={ip_address:e};t&&(a.business_id=t);return(await ga.unblockIp(a)).data}catch(a){throw console.error("Error unblocking IP:",a),this.handleError(a)}}async getBlockedIps(e={}){try{const t={};void 0!==e.active_only&&(t.active_only=e.active_only),e.reason&&(t.reason=e.reason),e.per_page&&(t.per_page=e.per_page);return(await ga.getBlockedIps(t)).data}catch(t){throw console.error("Error getting blocked IPs:",t),this.handleError(t)}}async debugBlockedIp(e,t=null){try{const a={ip_address:e};t&&(a.business_id=t);return(await ga.debugBlockedIp(a)).data}catch(a){throw console.error("Error debugging blocked IP:",a),this.handleError(a)}}async forceUnblockIp(e,t=null){try{const a={ip_address:e};t&&(a.business_id=t);return(await ga.forceUnblockIp(a)).data}catch(a){throw console.error("Error force-unblocking IP:",a),this.handleError(a)}}async leaveWaiterBusiness(e){try{return(await ga.leaveWaiterBusiness(e)).data}catch(t){throw console.error("Error leaving business:",t),this.handleError(t)}}async getAdminSilencedTables(){try{return(await ga.get("/admin/tables/silenced")).data}catch(e){throw console.error("Error getting admin silenced tables:",e),this.handleError(e)}}async adminUnsilenceTable(e){try{return(await ga.delete(`/admin/tables/${e}/silence`)).data}catch(t){throw console.error("Error admin unsilencing table:",t),this.handleError(t)}}handleError(e){var t;return(null==(t=e.response)?void 0:t.data)?{success:!1,message:e.response.data.message||"Error en la solicitud",code:e.response.status,data:e.response.data}:{success:!1,message:e.message||"Error de conexión",code:"NETWORK_ERROR"}}formatResponseTime(e){if(e<60)return`${e}s`;if(e<3600){const t=Math.floor(e/60),a=e%60;return a>0?`${t}m ${a}s`:`${t}m`}{const t=Math.floor(e/3600),a=Math.floor(e%3600/60);return a>0?`${t}h ${a}m`:`${t}h`}}formatTimeAgo(e){const t=new Date-new Date(e),a=Math.floor(t/6e4);if(a<1)return"Ahora";if(a<60)return`${a}m`;if(a<1440){return`${Math.floor(a/60)}h`}return`${Math.floor(a/1440)}d`}getUrgencyColor(e,t=0){return"high"===e?"#dc3545":t>5?"#fd7e14":"#007bff"}getUrgencyIcon(e,t=0){return"high"===e?"🚨":t>5?"⏰":"🔔"}},rm=Object.freeze(Object.defineProperty({__proto__:null,default:om},Symbol.toStringTag,{value:"Module"}));var lm={};const cm="@firebase/database",dm="1.1.0";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let um="";function hm(e){um=e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pm{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Gr(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Hr(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mm{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Jr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fm=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new pm(t)}}catch(t){}return new mm},vm=fm("localStorage"),gm=fm("sessionStorage"),bm=new bl("@firebase/database"),wm=function(){let e=1;return function(){return e++}}(),ym=function(e){const t=function(e){const t=[];let a=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);if(i>=55296&&i<=56319){const t=i-55296;n++,pr(n<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(n)-56320)}i<128?t[a++]=i:i<2048?(t[a++]=i>>6|192,t[a++]=63&i|128):i<65536?(t[a++]=i>>12|224,t[a++]=i>>6&63|128,t[a++]=63&i|128):(t[a++]=i>>18|240,t[a++]=i>>12&63|128,t[a++]=i>>6&63|128,t[a++]=63&i|128)}return t}(e),a=new al;a.update(t);const n=a.digest();return vr.encodeByteArray(n)},_m=function(...e){let t="";for(let a=0;a<e.length;a++){const n=e[a];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=_m.apply(null,n):t+="object"==typeof n?Gr(n):n,t+=" "}return t};let km=null,Cm=!0;const Em=function(...e){if(!0===Cm&&(Cm=!1,null===km&&!0===gm.get("logging_enabled")&&(pr(!0,"Can't turn on custom loggers persistently."),bm.logLevel=hl.VERBOSE,km=bm.log.bind(bm))),km){const t=_m.apply(null,e);km(t)}},Im=function(e){return function(...t){Em(e,...t)}},Sm=function(...e){const t="FIREBASE INTERNAL ERROR: "+_m(...e);bm.error(t)},Tm=function(...e){const t=`FIREBASE FATAL ERROR: ${_m(...e)}`;throw bm.error(t),new Error(t)},Nm=function(...e){const t="FIREBASE WARNING: "+_m(...e);bm.warn(t)},Am=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Pm="[MIN_NAME]",Rm="[MAX_NAME]",xm=function(e,t){if(e===t)return 0;if(e===Pm||t===Rm)return-1;if(t===Pm||e===Rm)return 1;{const a=Bm(e),n=Bm(t);return null!==a?null!==n?a-n===0?e.length-t.length:a-n:-1:null!==n?1:e<t?-1:1}},Dm=function(e,t){return e===t?0:e<t?-1:1},Om=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Gr(t))},Lm=function(e){if("object"!=typeof e||null===e)return Gr(e);const t=[];for(const n in e)t.push(n);t.sort();let a="{";for(let n=0;n<t.length;n++)0!==n&&(a+=","),a+=Gr(t[n]),a+=":",a+=Lm(e[t[n]]);return a+="}",a},Mm=function(e,t){const a=e.length;if(a<=t)return[e];const n=[];for(let i=0;i<a;i+=t)i+t>a?n.push(e.substring(i,a)):n.push(e.substring(i,i+t));return n};function Um(e,t){for(const a in e)e.hasOwnProperty(a)&&t(a,e[a])}const Fm=function(e){pr(!Am(e),"Invalid JSON number");const t=1023;let a,n,i,s,o;0===e?(n=0,i=0,a=1/e==-1/0?1:0):(a=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),t),n=s+t,i=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(n=0,i=Math.round(e/Math.pow(2,-1074))));const r=[];for(o=52;o;o-=1)r.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;o-=1)r.push(n%2?1:0),n=Math.floor(n/2);r.push(a?1:0),r.reverse();const l=r.join("");let c="";for(o=0;o<64;o+=8){let e=parseInt(l.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()};const qm=new RegExp("^-?(0*)\\d{1,10}$"),Bm=function(e){if(qm.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},jm=function(e){try{e()}catch(t){setTimeout(()=>{const e=t.stack||"";throw Nm("Exception was thrown by user callback.",e),t},Math.floor(0))}},$m=function(e,t){const a=setTimeout(e,t);return"number"==typeof a&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(a):"object"==typeof a&&a.unref&&a.unref(),a};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class zm{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,_c(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,a)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,a):t(null)},0)})}addTokenChangeListener(e){var t;null==(t=this.appCheckProvider)||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){Nm(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vm{constructor(e,t,a){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=a,this.auth_=null,this.auth_=a.getImmediate({optional:!0}),this.auth_||a.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(Em("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,a)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,a):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Nm(e)}}class Wm{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Wm.OWNER="owner";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Hm=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Gm="ac",Km="websocket",Jm="long_polling";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ym{constructor(e,t,a,n,i=!1,s="",o=!1,r=!1,l=null){this.secure=t,this.namespace=a,this.webSocketOnly=n,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=r,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=vm.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&vm.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Qm(e,t,a){let n;if(pr("string"==typeof t,"typeof type must == string"),pr("object"==typeof a,"typeof params must == object"),t===Km)n=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Jm)throw new Error("Unknown connection type: "+t);n=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(a.ns=e.namespace);const i=[];return Um(a,(e,t)=>{i.push(e+"="+t)}),n+i.join("&")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{constructor(){this.counters_={}}incrementCounter(e,t=1){Jr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return _r(this.counters_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xm={},ef={};function tf(e){const t=e.toString();return Xm[t]||(Xm[t]=new Zm),Xm[t]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class af{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&jm(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nf="start";class sf{constructor(e,t,a,n,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=a,this.appCheckToken=n,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Im(e),this.stats_=tf(t),this.urlFn=e=>(this.appCheckToken&&(e[Gm]=this.appCheckToken),Qm(t,Jm,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new af(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const a=function(){document.body?t||(t=!0,e()):setTimeout(a,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&a()}),window.attachEvent("onload",a))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new of((...e)=>{const[t,a,n,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===nf)this.id=a,this.password=n;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{const[t,a]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,a)},()=>{this.onClosed_()},this.urlFn);const e={};e[nf]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[Gm]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Hm.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){sf.forceAllow_=!0}static forceDisallow(){sf.forceDisallow_=!0}static isAvailable(){return!!sf.forceAllow_||!(sf.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Gr(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const a=br(t),n=Mm(a,1840);for(let i=0;i<n.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const a={dframe:"t"};a.id=e,a.pw=t,this.myDisconnFrame.src=this.urlFn(a),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Gr(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class of{constructor(e,t,a,n){this.onDisconnect=a,this.urlFn=n,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=wm(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=of.createIFrame_();let a="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){a='<script>document.domain="'+document.domain+'";<\/script>'}const n="<html><body>"+a+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(n),this.myIFrame.doc.close()}catch(i){Em("frame writing exception"),i.stack&&Em(i.stack),Em(i)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Em("No IE domain setting required")}catch(t){const a=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+a+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),a="",n=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+a.length<=1870))break;{const e=this.pendingSegs.shift();a=a+"&seg"+n+"="+e.seg+"&ts"+n+"="+e.ts+"&d"+n+"="+e.d,n++}}return t+=a,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,a){this.pendingSegs.push({seg:e,ts:t,d:a}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const a=()=>{this.outstandingRequests.delete(t),this.newRequest_()},n=setTimeout(a,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(n),a()})}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const a=this.myIFrame.doc.createElement("script");a.type="text/javascript",a.async=!0,a.src=e,a.onload=a.onreadystatechange=function(){const e=a.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,a.parentNode&&a.parentNode.removeChild(a),t())},a.onerror=()=>{Em("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(a)}catch(a){}},Math.floor(1))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rf=null;"undefined"!=typeof MozWebSocket?rf=MozWebSocket:"undefined"!=typeof WebSocket&&(rf=WebSocket);class lf{constructor(e,t,a,n,i,s,o){this.connId=e,this.applicationId=a,this.appCheckToken=n,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Im(this.connId),this.stats_=tf(t),this.connURL=lf.connectionURL_(t,s,o,n,a),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,a,n,i){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&Hm.test(location.hostname)&&(s.r="f"),t&&(s.s=t),a&&(s.ls=a),n&&(s[Gm]=n),i&&(s.p=i),Qm(e,Km,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,vm.set("previous_websocket_failure",!0);try{let e;this.mySock=new rf(this.connURL,[],e)}catch(a){this.log_("Error instantiating WebSocket.");const e=a.message||a.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){lf.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,a=navigator.userAgent.match(t);a&&a.length>1&&parseFloat(a[1])<4.4&&(e=!0)}return!e&&null!==rf&&!lf.forceDisallow_}static previouslyFailed(){return vm.isInMemoryStorage||!0===vm.get("previous_websocket_failure")}markConnectionHealthy(){vm.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=Hr(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(pr(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=Gr(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const a=Mm(t,16384);a.length>1&&this.sendString_(String(a.length));for(let n=0;n<a.length;n++)this.sendString_(a[n])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}lf.responsesRequiredToBeHealthy=2,lf.healthyTimeout=3e4;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class cf{static get ALL_TRANSPORTS(){return[sf,lf]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=lf&&lf.isAvailable();let a=t&&!lf.previouslyFailed();if(e.webSocketOnly&&(t||Nm("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),a=!0),a)this.transports_=[lf];else{const e=this.transports_=[];for(const t of cf.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);cf.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}cf.globalTransportInitialized_=!1;class df{constructor(e,t,a,n,i,s,o,r,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=a,this.appCheckToken_=n,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=r,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Im("c:"+this.id+":"),this.transportManager_=new cf(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),a=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,a)},Math.floor(0));const n=e.healthyTimeout||0;n>0&&(this.healthyTimeout_=$m(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(n)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Om("t",e),a=Om("d",e);if("c"===t)this.onSecondaryControl_(a);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(a)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Om("t",e),a=Om("d",e);"c"===t?this.onControl_(a):"d"===t&&this.onDataMessage_(a)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Om("t",e);if("d"in e){const a=e.d;if("h"===t){const e={...a};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(a):"r"===t?this.onReset_(a):"e"===t?Sm("Server Error: "+a):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Sm("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,a=e.v,n=e.h;this.sessionId=e.s,this.repoInfo_.host=n,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==a&&Nm("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),a=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,a),$m(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):$m(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(vm.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{put(e,t,a,n){}merge(e,t,a,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,a){}onDisconnectMerge(e,t,a){}onDisconnectCancel(e,t){}reportStats(e){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hf{constructor(e){this.allowedEvents_=e,this.listeners_={},pr(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const a=[...this.listeners_[e]];for(let e=0;e<a.length;e++)a[e].callback.apply(a[e].context,t)}}on(e,t,a){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:a});const n=this.getInitialEvent(e);n&&t.apply(a,n)}off(e,t,a){this.validateEventType_(e);const n=this.listeners_[e]||[];for(let i=0;i<n.length;i++)if(n[i].callback===t&&(!a||a===n[i].context))return void n.splice(i,1)}validateEventType_(e){pr(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf extends hf{static getInstance(){return new pf}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Fr()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return pr("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mf{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function ff(){return new mf("")}function vf(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function gf(e){return e.pieces_.length-e.pieceNum_}function bf(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new mf(e.pieces_,t)}function wf(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function yf(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function _f(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let a=e.pieceNum_;a<e.pieces_.length-1;a++)t.push(e.pieces_[a]);return new mf(t,0)}function kf(e,t){const a=[];for(let n=e.pieceNum_;n<e.pieces_.length;n++)a.push(e.pieces_[n]);if(t instanceof mf)for(let n=t.pieceNum_;n<t.pieces_.length;n++)a.push(t.pieces_[n]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&a.push(e[t])}return new mf(a,0)}function Cf(e){return e.pieceNum_>=e.pieces_.length}function Ef(e,t){const a=vf(e),n=vf(t);if(null===a)return t;if(a===n)return Ef(bf(e),bf(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function If(e,t){if(gf(e)!==gf(t))return!1;for(let a=e.pieceNum_,n=t.pieceNum_;a<=e.pieces_.length;a++,n++)if(e.pieces_[a]!==t.pieces_[n])return!1;return!0}function Sf(e,t){let a=e.pieceNum_,n=t.pieceNum_;if(gf(e)>gf(t))return!1;for(;a<e.pieces_.length;){if(e.pieces_[a]!==t.pieces_[n])return!1;++a,++n}return!0}class Tf{constructor(e,t){this.errorPrefix_=t,this.parts_=yf(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let a=0;a<this.parts_.length;a++)this.byteLength_+=ol(this.parts_[a]);Nf(this)}}function Nf(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Af(e))}function Af(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf extends hf{static getInstance(){return new Pf}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return pr("visible"===e,"Unknown event type: "+e),[this.visible_]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rf=1e3;class xf extends uf{constructor(e,t,a,n,i,s,o,r){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=a,this.onConnectStatus_=n,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=r,this.id=xf.nextPersistentConnectionId_++,this.log_=Im("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Rf,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,r)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Pf.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&pf.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,a){const n=++this.requestNumber_,i={r:n,a:e,b:t};this.log_(Gr(i)),pr(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),a&&(this.requestCBHash_[n]=a)}get(e){this.initConnection_();const t=new Pr,a={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const a=e.d;"ok"===e.s?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(a),this.outstandingGetCount_++;const n=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(n),t.promise}listen(e,t,a,n){this.initConnection_();const i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),pr(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),pr(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");const o={onComplete:n,hashFn:t,query:e,tag:a};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,a=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(a)})}sendListen_(e){const t=e.query,a=t._path.toString(),n=t._queryIdentifier;this.log_("Listen on "+a+" for "+n);const i={p:a};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,i=>{const s=i.d,o=i.s;xf.warnOnListenWarnings_(s,t);(this.listens.get(a)&&this.listens.get(a).get(n))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(a,n),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&Jr(e,"w")){const a=Yr(e,"w");if(Array.isArray(a)&&~a.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',a=t._path.toString();Nm(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${a} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=Kr(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=Kr(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",a={cred:e};null===this.authOverride_?a.noauth=!0:"object"==typeof this.authOverride_&&(a.authvar=this.authOverride_),this.sendRequest(t,a,t=>{const a=t.s,n=t.d||"error";this.authToken_===e&&("ok"===a?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(a,n))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,a=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,a)})}unlisten(e,t){const a=e._path.toString(),n=e._queryIdentifier;this.log_("Unlisten called for "+a+" "+n),pr(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(a,n)&&this.connected_&&this.sendUnlisten_(a,n,e._queryObject,t)}sendUnlisten_(e,t,a,n){this.log_("Unlisten on "+e+" for "+t);const i={p:e};n&&(i.q=a,i.t=n),this.sendRequest("n",i)}onDisconnectPut(e,t,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,a):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:a})}onDisconnectMerge(e,t,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,a):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:a})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,a,n){const i={p:t,d:a};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{n&&setTimeout(()=>{n(e.s,e.d)},Math.floor(0))})}put(e,t,a,n){this.putInternal("p",e,t,a,n)}merge(e,t,a,n){this.putInternal("m",e,t,a,n)}putInternal(e,t,a,n,i){this.initConnection_();const s={p:t,d:a};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:n}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,a=this.outstandingPuts_[e].request,n=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,a,a=>{this.log_(t+" response",a),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),n&&n(a.s,a.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Gr(e));const t=e.r,a=this.requestCBHash_[t];a&&(delete this.requestCBHash_[t],a(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Sm("Unrecognized action received from server: "+Gr(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){pr(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Rf,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Rf,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Rf),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),a=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+xf.nextConnectionId_++,s=this.lastSessionId;let o=!1,r=null;const l=function(){r?r.close():(o=!0,n())},c=function(e){pr(r,"sendRequest call when we're not connected not allowed."),r.sendRequest(e)};this.realtime_={close:l,sendRequest:c};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[e,l]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);o?Em("getToken() completed but was canceled"):(Em("getToken() completed. Creating connection."),this.authToken_=e&&e.accessToken,this.appCheckToken_=l&&l.token,r=new df(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,a,n,e=>{Nm(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&Nm(e),l())}}}interrupt(e){Em("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Em("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Qr(this.interruptReasons_)&&(this.reconnectDelay_=Rf,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let a;a=t?t.map(e=>Lm(e)).join("$"):"default";const n=this.removeListen_(e,a);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(e,t){const a=new mf(e).toString();let n;if(this.listens.has(a)){const e=this.listens.get(a);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(a)}else n=void 0;return n}onAuthRevoked_(e,t){Em("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Em("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+um.replace(/\./g,"-")]=1,Fr()?e["framework.cordova"]=1:qr()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=pf.getInstance().currentlyOnline();return Qr(this.interruptReasons_)&&e}}xf.nextPersistentConnectionId_=0,xf.nextConnectionId_=0;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Df{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Df(e,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const a=new Df(Pm,e),n=new Df(Pm,t);return 0!==this.compare(a,n)}minPost(){return Df.MIN}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Lf;class Mf extends Of{static get __EMPTY_NODE(){return Lf}static set __EMPTY_NODE(e){Lf=e}compare(e,t){return xm(e.name,t.name)}isDefinedOn(e){throw mr("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Df.MIN}maxPost(){return new Df(Rm,Lf)}makePost(e,t){return pr("string"==typeof e,"KeyIndex indexValue must always be a string."),new Df(e,Lf)}toString(){return".key"}}const Uf=new Mf;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff{constructor(e,t,a,n,i=null){this.isReverse_=n,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?a(e.key,t):1,n&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class qf{constructor(e,t,a,n,i){this.key=e,this.value=t,this.color=null!=a?a:qf.RED,this.left=null!=n?n:Bf.EMPTY_NODE,this.right=null!=i?i:Bf.EMPTY_NODE}copy(e,t,a,n,i){return new qf(null!=e?e:this.key,null!=t?t:this.value,null!=a?a:this.color,null!=n?n:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,a){let n=this;const i=a(e,n.key);return n=i<0?n.copy(null,null,null,n.left.insert(e,t,a),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,a)),n.fixUp_()}removeMin_(){if(this.left.isEmpty())return Bf.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let a,n;if(a=this,t(e,a.key)<0)a.left.isEmpty()||a.left.isRed_()||a.left.left.isRed_()||(a=a.moveRedLeft_()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed_()&&(a=a.rotateRight_()),a.right.isEmpty()||a.right.isRed_()||a.right.left.isRed_()||(a=a.moveRedRight_()),0===t(e,a.key)){if(a.right.isEmpty())return Bf.EMPTY_NODE;n=a.right.min_(),a=a.copy(n.key,n.value,null,null,a.right.removeMin_())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,qf.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,qf.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}qf.RED=!0,qf.BLACK=!1;class Bf{constructor(e,t=Bf.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Bf(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,qf.BLACK,null,null))}remove(e){return new Bf(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,qf.BLACK,null,null))}get(e){let t,a=this.root_;for(;!a.isEmpty();){if(t=this.comparator_(e,a.key),0===t)return a.value;t<0?a=a.left:t>0&&(a=a.right)}return null}getPredecessorKey(e){let t,a=this.root_,n=null;for(;!a.isEmpty();){if(t=this.comparator_(e,a.key),0===t){if(a.left.isEmpty())return n?n.key:null;for(a=a.left;!a.right.isEmpty();)a=a.right;return a.key}t<0?a=a.left:t>0&&(n=a,a=a.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ff(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ff(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ff(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ff(this.root_,null,this.comparator_,!0,e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function jf(e,t){return xm(e.name,t.name)}function $f(e,t){return xm(e,t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zf;Bf.EMPTY_NODE=new class{copy(e,t,a,n,i){return this}insert(e,t,a){return new qf(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Vf=function(e){return"number"==typeof e?"number:"+Fm(e):"string:"+e},Wf=function(e){if(e.isLeafNode()){const t=e.val();pr("string"==typeof t||"number"==typeof t||"object"==typeof t&&Jr(t,".sv"),"Priority must be a string or number.")}else pr(e===zf||e.isEmpty(),"priority of unexpected type.");pr(e===zf||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let Hf,Gf,Kf;class Jf{static set __childrenNodeConstructor(e){Hf=e}static get __childrenNodeConstructor(){return Hf}constructor(e,t=Jf.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,pr(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Wf(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Jf(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Jf.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Cf(e)?this:".priority"===vf(e)?this.priorityNode_:Jf.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Jf.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const a=vf(e);return null===a?t:t.isEmpty()&&".priority"!==a?this:(pr(".priority"!==a||1===gf(e),".priority must be the last token in a path"),this.updateImmediateChild(a,Jf.__childrenNodeConstructor.EMPTY_NODE.updateChild(bf(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Vf(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?Fm(this.value_):this.value_,this.lazyHash_=ym(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Jf.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Jf.__childrenNodeConstructor?-1:(pr(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,a=typeof this.value_,n=Jf.VALUE_TYPE_ORDER.indexOf(t),i=Jf.VALUE_TYPE_ORDER.indexOf(a);return pr(n>=0,"Unknown leaf type: "+t),pr(i>=0,"Unknown leaf type: "+a),n===i?"object"===a?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-n}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}Jf.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Yf=new class extends Of{compare(e,t){const a=e.node.getPriority(),n=t.node.getPriority(),i=a.compareTo(n);return 0===i?xm(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Df.MIN}maxPost(){return new Df(Rm,new Jf("[PRIORITY-POST]",Kf))}makePost(e,t){const a=Gf(e);return new Df(t,new Jf("[PRIORITY-POST]",a))}toString(){return".priority"}},Qf=Math.log(2);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zf{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Qf,10)),this.current_=this.count-1;const a=(n=this.count,parseInt(Array(n+1).join("1"),2));var n;this.bits_=e+1&a}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Xf=function(e,t,a,n){e.sort(t);const i=function(t,n){const s=n-t;let o,r;if(0===s)return null;if(1===s)return o=e[t],r=a?a(o):o,new qf(r,o.node,qf.BLACK,null,null);{const l=parseInt(s/2,10)+t,c=i(t,l),d=i(l+1,n);return o=e[l],r=a?a(o):o,new qf(r,o.node,qf.BLACK,c,d)}},s=function(t){let n=null,s=null,o=e.length;const r=function(t,n){const s=o-t,r=o;o-=t;const c=i(s+1,r),d=e[s],u=a?a(d):d;l(new qf(u,d.node,n,null,c))},l=function(e){n?(n.left=e,n=e):(s=e,n=e)};for(let e=0;e<t.count;++e){const a=t.nextBitIsOne(),n=Math.pow(2,t.count-(e+1));a?r(n,qf.BLACK):(r(n,qf.BLACK),r(n,qf.RED))}return s}(new Zf(e.length));return new Bf(n||t,s)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ev;const tv={};class av{static get Default(){return pr(tv&&Yf,"ChildrenNode.ts has not been loaded"),ev=ev||new av({".priority":tv},{".priority":Yf}),ev}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Yr(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Bf?t:null}hasIndex(e){return Jr(this.indexSet_,e.toString())}addIndex(e,t){pr(e!==Uf,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const a=[];let n=!1;const i=t.getIterator(Df.Wrap);let s,o=i.getNext();for(;o;)n=n||e.isDefinedOn(o.node),a.push(o),o=i.getNext();s=n?Xf(a,e.getCompare()):tv;const r=e.toString(),l={...this.indexSet_};l[r]=e;const c={...this.indexes_};return c[r]=s,new av(c,l)}addToIndexes(e,t){const a=Zr(this.indexes_,(a,n)=>{const i=Yr(this.indexSet_,n);if(pr(i,"Missing index implementation for "+n),a===tv){if(i.isDefinedOn(e.node)){const a=[],n=t.getIterator(Df.Wrap);let s=n.getNext();for(;s;)s.name!==e.name&&a.push(s),s=n.getNext();return a.push(e),Xf(a,i.getCompare())}return tv}{const n=t.get(e.name);let i=a;return n&&(i=i.remove(new Df(e.name,n))),i.insert(e,e.node)}});return new av(a,this.indexSet_)}removeFromIndexes(e,t){const a=Zr(this.indexes_,a=>{if(a===tv)return a;{const n=t.get(e.name);return n?a.remove(new Df(e.name,n)):a}});return new av(a,this.indexSet_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nv;class iv{static get EMPTY_NODE(){return nv||(nv=new iv(new Bf($f),null,av.Default))}constructor(e,t,a){this.children_=e,this.priorityNode_=t,this.indexMap_=a,this.lazyHash_=null,this.priorityNode_&&Wf(this.priorityNode_),this.children_.isEmpty()&&pr(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||nv}updatePriority(e){return this.children_.isEmpty()?this:new iv(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?nv:t}}getChild(e){const t=vf(e);return null===t?this:this.getImmediateChild(t).getChild(bf(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(pr(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const a=new Df(e,t);let n,i;t.isEmpty()?(n=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(a,this.children_)):(n=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(a,this.children_));const s=n.isEmpty()?nv:this.priorityNode_;return new iv(n,s,i)}}updateChild(e,t){const a=vf(e);if(null===a)return t;{pr(".priority"!==vf(e)||1===gf(e),".priority must be the last token in a path");const n=this.getImmediateChild(a).updateChild(bf(e),t);return this.updateImmediateChild(a,n)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let a=0,n=0,i=!0;if(this.forEachChild(Yf,(s,o)=>{t[s]=o.val(e),a++,i&&iv.INTEGER_REGEXP_.test(s)?n=Math.max(n,Number(s)):i=!1}),!e&&i&&n<2*a){const e=[];for(const a in t)e[a]=t[a];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Vf(this.getPriority().val())+":"),this.forEachChild(Yf,(t,a)=>{const n=a.hash();""!==n&&(e+=":"+t+":"+n)}),this.lazyHash_=""===e?"":ym(e)}return this.lazyHash_}getPredecessorChildName(e,t,a){const n=this.resolveIndex_(a);if(n){const a=n.getPredecessorKey(new Df(e,t));return a?a.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Df(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Df(t,this.children_.get(t)):null}forEachChild(e,t){const a=this.resolveIndex_(e);return a?a.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const a=this.resolveIndex_(t);if(a)return a.getIteratorFrom(e,e=>e);{const a=this.children_.getIteratorFrom(e.name,Df.Wrap);let n=a.peek();for(;null!=n&&t.compare(n,e)<0;)a.getNext(),n=a.peek();return a}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const a=this.resolveIndex_(t);if(a)return a.getReverseIteratorFrom(e,e=>e);{const a=this.children_.getReverseIteratorFrom(e.name,Df.Wrap);let n=a.peek();for(;null!=n&&t.compare(n,e)>0;)a.getNext(),n=a.peek();return a}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===sv?-1:0}withIndex(e){if(e===Uf||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new iv(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Uf||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(Yf),a=t.getIterator(Yf);let n=e.getNext(),i=a.getNext();for(;n&&i;){if(n.name!==i.name||!n.node.equals(i.node))return!1;n=e.getNext(),i=a.getNext()}return null===n&&null===i}return!1}return!1}}resolveIndex_(e){return e===Uf?null:this.indexMap_.get(e.toString())}}iv.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const sv=new class extends iv{constructor(){super(new Bf($f),iv.EMPTY_NODE,av.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return iv.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Df,{MIN:{value:new Df(Pm,iv.EMPTY_NODE)},MAX:{value:new Df(Rm,sv)}}),Mf.__EMPTY_NODE=iv.EMPTY_NODE,Jf.__childrenNodeConstructor=iv,zf=sv,function(e){Kf=e}(sv);function ov(e,t=null){if(null===e)return iv.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),pr(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){return new Jf(e,ov(t))}if(e instanceof Array){let a=iv.EMPTY_NODE;return Um(e,(t,n)=>{if(Jr(e,t)&&"."!==t.substring(0,1)){const e=ov(n);!e.isLeafNode()&&e.isEmpty()||(a=a.updateImmediateChild(t,e))}}),a.updatePriority(ov(t))}{const a=[];let n=!1;if(Um(e,(e,t)=>{if("."!==e.substring(0,1)){const i=ov(t);i.isEmpty()||(n=n||!i.getPriority().isEmpty(),a.push(new Df(e,i)))}}),0===a.length)return iv.EMPTY_NODE;const i=Xf(a,jf,e=>e.name,$f);if(n){const e=Xf(a,Yf.getCompare());return new iv(i,ov(t),new av({".priority":e},{".priority":Yf}))}return new iv(i,ov(t),av.Default)}}!function(e){Gf=e}(ov);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class rv extends Of{constructor(e){super(),this.indexPath_=e,pr(!Cf(e)&&".priority"!==vf(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const a=this.extractChild(e.node),n=this.extractChild(t.node),i=a.compareTo(n);return 0===i?xm(e.name,t.name):i}makePost(e,t){const a=ov(e),n=iv.EMPTY_NODE.updateChild(this.indexPath_,a);return new Df(t,n)}maxPost(){const e=iv.EMPTY_NODE.updateChild(this.indexPath_,sv);return new Df(Rm,e)}toString(){return yf(this.indexPath_,0).join("/")}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lv=new class extends Of{compare(e,t){const a=e.node.compareTo(t.node);return 0===a?xm(e.name,t.name):a}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Df.MIN}maxPost(){return Df.MAX}makePost(e,t){const a=ov(e);return new Df(t,a)}toString(){return".value"}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cv(e){return{type:"value",snapshotNode:e}}function dv(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function uv(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function hv(e,t,a){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:a}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class pv{constructor(e){this.index_=e}updateChild(e,t,a,n,i,s){pr(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(n).equals(a.getChild(n))&&o.isEmpty()===a.isEmpty()?e:(null!=s&&(a.isEmpty()?e.hasChild(t)?s.trackChildChange(uv(t,o)):pr(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(dv(t,a)):s.trackChildChange(hv(t,a,o))),e.isLeafNode()&&a.isEmpty()?e:e.updateImmediateChild(t,a).withIndex(this.index_))}updateFullNode(e,t,a){return null!=a&&(e.isLeafNode()||e.forEachChild(Yf,(e,n)=>{t.hasChild(e)||a.trackChildChange(uv(e,n))}),t.isLeafNode()||t.forEachChild(Yf,(t,n)=>{if(e.hasChild(t)){const i=e.getImmediateChild(t);i.equals(n)||a.trackChildChange(hv(t,n,i))}else a.trackChildChange(dv(t,n))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?iv.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mv{constructor(e){this.indexedFilter_=new pv(e.getIndex()),this.index_=e.getIndex(),this.startPost_=mv.getStartPost_(e),this.endPost_=mv.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,a=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&a}updateChild(e,t,a,n,i,s){return this.matches(new Df(t,a))||(a=iv.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,a,n,i,s)}updateFullNode(e,t,a){t.isLeafNode()&&(t=iv.EMPTY_NODE);let n=t.withIndex(this.index_);n=n.updatePriority(iv.EMPTY_NODE);const i=this;return t.forEachChild(Yf,(e,t)=>{i.matches(new Df(e,t))||(n=n.updateImmediateChild(e,iv.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,n,a)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fv{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new mv(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,a,n,i,s){return this.rangedFilter_.matches(new Df(t,a))||(a=iv.EMPTY_NODE),e.getImmediateChild(t).equals(a)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,a,n,i,s):this.fullLimitUpdateChild_(e,t,a,i,s)}updateFullNode(e,t,a){let n;if(t.isLeafNode()||t.isEmpty())n=iv.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;n=iv.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let a=0;for(;e.hasNext()&&a<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;n=n.updateImmediateChild(t.name,t.node),a++}}}else{let e;n=t.withIndex(this.index_),n=n.updatePriority(iv.EMPTY_NODE),e=this.reverse_?n.getReverseIterator(this.index_):n.getIterator(this.index_);let a=0;for(;e.hasNext();){const t=e.getNext();a<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?a++:n=n.updateImmediateChild(t.name,iv.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,n,a)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,a,n,i){let s;if(this.reverse_){const e=this.index_.getCompare();s=(t,a)=>e(a,t)}else s=this.index_.getCompare();const o=e;pr(o.numChildren()===this.limit_,"");const r=new Df(t,a),l=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),c=this.rangedFilter_.matches(r);if(o.hasChild(t)){const e=o.getImmediateChild(t);let d=n.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=d&&(d.name===t||o.hasChild(d.name));)d=n.getChildAfterChild(this.index_,d,this.reverse_);const u=null==d?1:s(d,r);if(c&&!a.isEmpty()&&u>=0)return null!=i&&i.trackChildChange(hv(t,a,e)),o.updateImmediateChild(t,a);{null!=i&&i.trackChildChange(uv(t,e));const a=o.updateImmediateChild(t,iv.EMPTY_NODE);return null!=d&&this.rangedFilter_.matches(d)?(null!=i&&i.trackChildChange(dv(d.name,d.node)),a.updateImmediateChild(d.name,d.node)):a}}return a.isEmpty()?e:c&&s(l,r)>=0?(null!=i&&(i.trackChildChange(uv(l.name,l.node)),i.trackChildChange(dv(t,a))),o.updateImmediateChild(t,a).updateImmediateChild(l.name,iv.EMPTY_NODE)):e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vv{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Yf}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return pr(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return pr(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Pm}hasEnd(){return this.endSet_}getIndexEndValue(){return pr(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return pr(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Rm}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return pr(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Yf}copy(){const e=new vv;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function gv(e){const t={};if(e.isDefault())return t;let a;if(e.index_===Yf?a="$priority":e.index_===lv?a="$value":e.index_===Uf?a="$key":(pr(e.index_ instanceof rv,"Unrecognized index type!"),a=e.index_.toString()),t.orderBy=Gr(a),e.startSet_){const a=e.startAfterSet_?"startAfter":"startAt";t[a]=Gr(e.indexStartValue_),e.startNameSet_&&(t[a]+=","+Gr(e.indexStartName_))}if(e.endSet_){const a=e.endBeforeSet_?"endBefore":"endAt";t[a]=Gr(e.indexEndValue_),e.endNameSet_&&(t[a]+=","+Gr(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function bv(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let a=e.viewFrom_;""===a&&(a=e.isViewFromLeft()?"l":"r"),t.vf=a}return e.index_!==Yf&&(t.i=e.index_.toString()),t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv extends uf{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(pr(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,a,n){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=a,this.appCheckTokenProvider_=n,this.log_=Im("p:rest:"),this.listens_={}}listen(e,t,a,n){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const s=wv.getListenId_(e,a),o={};this.listens_[s]=o;const r=gv(e._queryParams);this.restRequest_(i+".json",r,(e,t)=>{let r=t;if(404===e&&(r=null,e=null),null===e&&this.onDataUpdate_(i,r,!1,a),Yr(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",n(t,null)}})}unlisten(e,t){const a=wv.getListenId_(e,t);delete this.listens_[a]}get(e){const t=gv(e._queryParams),a=e._path.toString(),n=new Pr;return this.restRequest_(a+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(a,i,!1,null),n.resolve(i)):n.reject(new Error(i))}),n.promise}refreshAuthToken(e){}restRequest_(e,t={},a){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([n,i])=>{n&&n.accessToken&&(t.auth=n.accessToken),i&&i.token&&(t.ac=i.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+tl(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(a&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let t=null;if(o.status>=200&&o.status<300){try{t=Hr(o.responseText)}catch(e){Nm("Failed to parse JSON response for "+s+": "+o.responseText)}a(null,t)}else 401!==o.status&&404!==o.status&&Nm("Got unsuccessful REST response for "+s+" Status: "+o.status),a(o.status);a=null}},o.open("GET",s,!0),o.send()})}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yv{constructor(){this.rootNode_=iv.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _v(){return{value:null,children:new Map}}function kv(e,t,a){if(Cf(t))e.value=a,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,a);else{const n=vf(t);e.children.has(n)||e.children.set(n,_v());kv(e.children.get(n),t=bf(t),a)}}function Cv(e,t,a){null!==e.value?a(t,e.value):function(e,t){e.children.forEach((e,a)=>{t(a,e)})}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,(e,n)=>{Cv(n,new mf(t.toString()+"/"+e),a)})}class Ev{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&Um(this.last_,(e,a)=>{t[e]=t[e]-a}),this.last_=e,t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iv{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Ev(e);const a=1e4+2e4*Math.random();$m(this.reportStats_.bind(this),Math.floor(a))}reportStats_(){const e=this.statsListener_.get(),t={};let a=!1;Um(e,(e,n)=>{n>0&&Jr(this.statsToReport_,e)&&(t[e]=n,a=!0)}),a&&this.server_.reportStats(t),$m(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sv,Tv;function Nv(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(Tv=Sv||(Sv={}))[Tv.OVERWRITE=0]="OVERWRITE",Tv[Tv.MERGE=1]="MERGE",Tv[Tv.ACK_USER_WRITE=2]="ACK_USER_WRITE",Tv[Tv.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class Av{constructor(e,t,a){this.path=e,this.affectedTree=t,this.revert=a,this.type=Sv.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Cf(this.path)){if(null!=this.affectedTree.value)return pr(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new mf(e));return new Av(ff(),t,this.revert)}}return pr(vf(this.path)===e,"operationForChild called for unrelated child."),new Av(bf(this.path),this.affectedTree,this.revert)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pv{constructor(e,t){this.source=e,this.path=t,this.type=Sv.LISTEN_COMPLETE}operationForChild(e){return Cf(this.path)?new Pv(this.source,ff()):new Pv(this.source,bf(this.path))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rv{constructor(e,t,a){this.source=e,this.path=t,this.snap=a,this.type=Sv.OVERWRITE}operationForChild(e){return Cf(this.path)?new Rv(this.source,ff(),this.snap.getImmediateChild(e)):new Rv(this.source,bf(this.path),this.snap)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xv{constructor(e,t,a){this.source=e,this.path=t,this.children=a,this.type=Sv.MERGE}operationForChild(e){if(Cf(this.path)){const t=this.children.subtree(new mf(e));return t.isEmpty()?null:t.value?new Rv(this.source,ff(),t.value):new xv(this.source,ff(),t)}return pr(vf(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new xv(this.source,bf(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dv{constructor(e,t,a){this.node_=e,this.fullyInitialized_=t,this.filtered_=a}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Cf(e))return this.isFullyInitialized()&&!this.filtered_;const t=vf(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ov{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Lv(e,t,a,n,i,s){const o=n.filter(e=>e.type===a);o.sort((t,a)=>function(e,t,a){if(null==t.childName||null==a.childName)throw mr("Should only compare child_ events.");const n=new Df(t.childName,t.snapshotNode),i=new Df(a.childName,a.snapshotNode);return e.index_.compare(n,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,a)),o.forEach(a=>{const n=function(e,t,a){return"value"===t.type||"child_removed"===t.type||(t.prevName=a.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,a,s);i.forEach(i=>{i.respondsTo(a.type)&&t.push(i.createEvent(n,e.query_))})})}function Mv(e,t){return{eventCache:e,serverCache:t}}function Uv(e,t,a,n){return Mv(new Dv(t,a,n),e.serverCache)}function Fv(e,t,a,n){return Mv(e.eventCache,new Dv(t,a,n))}function qv(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Bv(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jv;class $v{static fromObject(e){let t=new $v(null);return Um(e,(e,a)=>{t=t.set(new mf(e),a)}),t}constructor(e,t=(()=>(jv||(jv=new Bf(Dm)),jv))()){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:ff(),value:this.value};if(Cf(e))return null;{const a=vf(e),n=this.children.get(a);if(null!==n){const i=n.findRootMostMatchingPathAndValue(bf(e),t);if(null!=i){return{path:kf(new mf(a),i.path),value:i.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Cf(e))return this;{const t=vf(e),a=this.children.get(t);return null!==a?a.subtree(bf(e)):new $v(null)}}set(e,t){if(Cf(e))return new $v(t,this.children);{const a=vf(e),n=(this.children.get(a)||new $v(null)).set(bf(e),t),i=this.children.insert(a,n);return new $v(this.value,i)}}remove(e){if(Cf(e))return this.children.isEmpty()?new $v(null):new $v(null,this.children);{const t=vf(e),a=this.children.get(t);if(a){const n=a.remove(bf(e));let i;return i=n.isEmpty()?this.children.remove(t):this.children.insert(t,n),null===this.value&&i.isEmpty()?new $v(null):new $v(this.value,i)}return this}}get(e){if(Cf(e))return this.value;{const t=vf(e),a=this.children.get(t);return a?a.get(bf(e)):null}}setTree(e,t){if(Cf(e))return t;{const a=vf(e),n=(this.children.get(a)||new $v(null)).setTree(bf(e),t);let i;return i=n.isEmpty()?this.children.remove(a):this.children.insert(a,n),new $v(this.value,i)}}fold(e){return this.fold_(ff(),e)}fold_(e,t){const a={};return this.children.inorderTraversal((n,i)=>{a[n]=i.fold_(kf(e,n),t)}),t(e,this.value,a)}findOnPath(e,t){return this.findOnPath_(e,ff(),t)}findOnPath_(e,t,a){const n=!!this.value&&a(t,this.value);if(n)return n;if(Cf(e))return null;{const n=vf(e),i=this.children.get(n);return i?i.findOnPath_(bf(e),kf(t,n),a):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ff(),t)}foreachOnPath_(e,t,a){if(Cf(e))return this;{this.value&&a(t,this.value);const n=vf(e),i=this.children.get(n);return i?i.foreachOnPath_(bf(e),kf(t,n),a):new $v(null)}}foreach(e){this.foreach_(ff(),e)}foreach_(e,t){this.children.inorderTraversal((a,n)=>{n.foreach_(kf(e,a),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,a)=>{a.value&&e(t,a.value)})}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zv{constructor(e){this.writeTree_=e}static empty(){return new zv(new $v(null))}}function Vv(e,t,a){if(Cf(t))return new zv(new $v(a));{const n=e.writeTree_.findRootMostValueAndPath(t);if(null!=n){const i=n.path;let s=n.value;const o=Ef(i,t);return s=s.updateChild(o,a),new zv(e.writeTree_.set(i,s))}{const n=new $v(a),i=e.writeTree_.setTree(t,n);return new zv(i)}}}function Wv(e,t,a){let n=e;return Um(a,(e,a)=>{n=Vv(n,kf(t,e),a)}),n}function Hv(e,t){if(Cf(t))return zv.empty();{const a=e.writeTree_.setTree(t,new $v(null));return new zv(a)}}function Gv(e,t){return null!=Kv(e,t)}function Kv(e,t){const a=e.writeTree_.findRootMostValueAndPath(t);return null!=a?e.writeTree_.get(a.path).getChild(Ef(a.path,t)):null}function Jv(e){const t=[],a=e.writeTree_.value;return null!=a?a.isLeafNode()||a.forEachChild(Yf,(e,a)=>{t.push(new Df(e,a))}):e.writeTree_.children.inorderTraversal((e,a)=>{null!=a.value&&t.push(new Df(e,a.value))}),t}function Yv(e,t){if(Cf(t))return e;{const a=Kv(e,t);return new zv(null!=a?new $v(a):e.writeTree_.subtree(t))}}function Qv(e){return e.writeTree_.isEmpty()}function Zv(e,t){return Xv(ff(),e.writeTree_,t)}function Xv(e,t,a){if(null!=t.value)return a.updateChild(e,t.value);{let n=null;return t.children.inorderTraversal((t,i)=>{".priority"===t?(pr(null!==i.value,"Priority writes must always be leaf nodes"),n=i.value):a=Xv(kf(e,t),i,a)}),a.getChild(e).isEmpty()||null===n||(a=a.updateChild(kf(e,".priority"),n)),a}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eg(e,t){return pg(t,e)}function tg(e,t){const a=e.allWrites.findIndex(e=>e.writeId===t);pr(a>=0,"removeWrite called with nonexistent writeId.");const n=e.allWrites[a];e.allWrites.splice(a,1);let i=n.visible,s=!1,o=e.allWrites.length-1;for(;i&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=a&&ag(t,n.path)?i=!1:Sf(n.path,t.path)&&(s=!0)),o--}if(i){if(s)return function(e){e.visibleWrites=ig(e.allWrites,ng,ff()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(n.snap)e.visibleWrites=Hv(e.visibleWrites,n.path);else{Um(n.children,t=>{e.visibleWrites=Hv(e.visibleWrites,kf(n.path,t))})}return!0}return!1}function ag(e,t){if(e.snap)return Sf(e.path,t);for(const a in e.children)if(e.children.hasOwnProperty(a)&&Sf(kf(e.path,a),t))return!0;return!1}function ng(e){return e.visible}function ig(e,t,a){let n=zv.empty();for(let i=0;i<e.length;++i){const s=e[i];if(t(s)){const e=s.path;let t;if(s.snap)Sf(a,e)?(t=Ef(a,e),n=Vv(n,t,s.snap)):Sf(e,a)&&(t=Ef(e,a),n=Vv(n,ff(),s.snap.getChild(t)));else{if(!s.children)throw mr("WriteRecord should have .snap or .children");if(Sf(a,e))t=Ef(a,e),n=Wv(n,t,s.children);else if(Sf(e,a))if(t=Ef(e,a),Cf(t))n=Wv(n,ff(),s.children);else{const e=Yr(s.children,vf(t));if(e){const a=e.getChild(bf(t));n=Vv(n,ff(),a)}}}}}return n}function sg(e,t,a,n,i){if(n||i){const s=Yv(e.visibleWrites,t);if(!i&&Qv(s))return a;if(i||null!=a||Gv(s,ff())){const s=function(e){return(e.visible||i)&&(!n||!~n.indexOf(e.writeId))&&(Sf(e.path,t)||Sf(t,e.path))};return Zv(ig(e.allWrites,s,t),a||iv.EMPTY_NODE)}return null}{const n=Kv(e.visibleWrites,t);if(null!=n)return n;{const n=Yv(e.visibleWrites,t);if(Qv(n))return a;if(null!=a||Gv(n,ff())){return Zv(n,a||iv.EMPTY_NODE)}return null}}}function og(e,t,a,n){return sg(e.writeTree,e.treePath,t,a,n)}function rg(e,t){return function(e,t,a){let n=iv.EMPTY_NODE;const i=Kv(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(Yf,(e,t)=>{n=n.updateImmediateChild(e,t)}),n;if(a){const i=Yv(e.visibleWrites,t);return a.forEachChild(Yf,(e,t)=>{const a=Zv(Yv(i,new mf(e)),t);n=n.updateImmediateChild(e,a)}),Jv(i).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}return Jv(Yv(e.visibleWrites,t)).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}(e.writeTree,e.treePath,t)}function lg(e,t,a,n){return function(e,t,a,n,i){pr(n||i,"Either existingEventSnap or existingServerSnap must exist");const s=kf(t,a);if(Gv(e.visibleWrites,s))return null;{const t=Yv(e.visibleWrites,s);return Qv(t)?i.getChild(a):Zv(t,i.getChild(a))}}(e.writeTree,e.treePath,t,a,n)}function cg(e,t){return function(e,t){return Kv(e.visibleWrites,t)}(e.writeTree,kf(e.treePath,t))}function dg(e,t,a,n,i,s){return function(e,t,a,n,i,s,o){let r;const l=Yv(e.visibleWrites,t),c=Kv(l,ff());if(null!=c)r=c;else{if(null==a)return[];r=Zv(l,a)}if(r=r.withIndex(o),r.isEmpty()||r.isLeafNode())return[];{const e=[],t=o.getCompare(),a=s?r.getReverseIteratorFrom(n,o):r.getIteratorFrom(n,o);let l=a.getNext();for(;l&&e.length<i;)0!==t(l,n)&&e.push(l),l=a.getNext();return e}}(e.writeTree,e.treePath,t,a,n,i,s)}function ug(e,t,a){return function(e,t,a,n){const i=kf(t,a),s=Kv(e.visibleWrites,i);if(null!=s)return s;if(n.isCompleteForChild(a))return Zv(Yv(e.visibleWrites,i),n.getNode().getImmediateChild(a));return null}(e.writeTree,e.treePath,t,a)}function hg(e,t){return pg(kf(e.treePath,t),e.writeTree)}function pg(e,t){return{treePath:e,writeTree:t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mg{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,a=e.childName;pr("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),pr(".priority"!==a,"Only non-priority child changes can be tracked.");const n=this.changeMap.get(a);if(n){const i=n.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(a,hv(a,e.snapshotNode,n.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(a);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(a,uv(a,n.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(a,dv(a,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw mr("Illegal combination of changes: "+e+" occurred after "+n);this.changeMap.set(a,hv(a,e.snapshotNode,n.oldSnap))}}else this.changeMap.set(a,e)}getChanges(){return Array.from(this.changeMap.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fg=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,a){return null}};class vg{constructor(e,t,a=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=a}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Dv(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ug(this.writes_,e,t)}}getChildAfterChild(e,t,a){const n=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Bv(this.viewCache_),i=dg(this.writes_,n,t,1,a,e);return 0===i.length?null:i[0]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gg(e,t,a,n,i){const s=new mg;let o,r;if(a.type===Sv.OVERWRITE){const l=a;l.source.fromUser?o=yg(e,t,l.path,l.snap,n,i,s):(pr(l.source.fromServer,"Unknown source."),r=l.source.tagged||t.serverCache.isFiltered()&&!Cf(l.path),o=wg(e,t,l.path,l.snap,n,i,r,s))}else if(a.type===Sv.MERGE){const l=a;l.source.fromUser?o=function(e,t,a,n,i,s,o){let r=t;return n.foreach((n,l)=>{const c=kf(a,n);_g(t,vf(c))&&(r=yg(e,r,c,l,i,s,o))}),n.foreach((n,l)=>{const c=kf(a,n);_g(t,vf(c))||(r=yg(e,r,c,l,i,s,o))}),r}(e,t,l.path,l.children,n,i,s):(pr(l.source.fromServer,"Unknown source."),r=l.source.tagged||t.serverCache.isFiltered(),o=Cg(e,t,l.path,l.children,n,i,r,s))}else if(a.type===Sv.ACK_USER_WRITE){const r=a;o=r.revert?function(e,t,a,n,i,s){let o;if(null!=cg(n,a))return t;{const r=new vg(n,t,i),l=t.eventCache.getNode();let c;if(Cf(a)||".priority"===vf(a)){let a;if(t.serverCache.isFullyInitialized())a=og(n,Bv(t));else{const e=t.serverCache.getNode();pr(e instanceof iv,"serverChildren would be complete if leaf node"),a=rg(n,e)}c=e.filter.updateFullNode(l,a,s)}else{const i=vf(a);let d=ug(n,i,t.serverCache);null==d&&t.serverCache.isCompleteForChild(i)&&(d=l.getImmediateChild(i)),c=null!=d?e.filter.updateChild(l,i,d,bf(a),r,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(l,i,iv.EMPTY_NODE,bf(a),r,s):l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=og(n,Bv(t)),o.isLeafNode()&&(c=e.filter.updateFullNode(c,o,s)))}return o=t.serverCache.isFullyInitialized()||null!=cg(n,ff()),Uv(t,c,o,e.filter.filtersNodes())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,r.path,n,i,s):function(e,t,a,n,i,s,o){if(null!=cg(i,a))return t;const r=t.serverCache.isFiltered(),l=t.serverCache;if(null!=n.value){if(Cf(a)&&l.isFullyInitialized()||l.isCompleteForPath(a))return wg(e,t,a,l.getNode().getChild(a),i,s,r,o);if(Cf(a)){let n=new $v(null);return l.getNode().forEachChild(Uf,(e,t)=>{n=n.set(new mf(e),t)}),Cg(e,t,a,n,i,s,r,o)}return t}{let c=new $v(null);return n.foreach((e,t)=>{const n=kf(a,e);l.isCompleteForPath(n)&&(c=c.set(e,l.getNode().getChild(n)))}),Cg(e,t,a,c,i,s,r,o)}}(e,t,r.path,r.affectedTree,n,i,s)}else{if(a.type!==Sv.LISTEN_COMPLETE)throw mr("Unknown operation type: "+a.type);o=function(e,t,a,n,i){const s=t.serverCache,o=Fv(t,s.getNode(),s.isFullyInitialized()||Cf(a),s.isFiltered());return bg(e,o,a,n,fg,i)}(e,t,a.path,n,s)}const l=s.getChanges();return function(e,t,a){const n=t.eventCache;if(n.isFullyInitialized()){const i=n.getNode().isLeafNode()||n.getNode().isEmpty(),s=qv(e);(a.length>0||!e.eventCache.isFullyInitialized()||i&&!n.getNode().equals(s)||!n.getNode().getPriority().equals(s.getPriority()))&&a.push(cv(qv(t)))}}(t,o,l),{viewCache:o,changes:l}}function bg(e,t,a,n,i,s){const o=t.eventCache;if(null!=cg(n,a))return t;{let r,l;if(Cf(a))if(pr(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const a=Bv(t),i=rg(n,a instanceof iv?a:iv.EMPTY_NODE);r=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{const a=og(n,Bv(t));r=e.filter.updateFullNode(t.eventCache.getNode(),a,s)}else{const c=vf(a);if(".priority"===c){pr(1===gf(a),"Can't have a priority with additional path components");const i=o.getNode();l=t.serverCache.getNode();const s=lg(n,a,i,l);r=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{const d=bf(a);let u;if(o.isCompleteForChild(c)){l=t.serverCache.getNode();const e=lg(n,a,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(c).updateChild(d,e):o.getNode().getImmediateChild(c)}else u=ug(n,c,t.serverCache);r=null!=u?e.filter.updateChild(o.getNode(),c,u,d,i,s):o.getNode()}}return Uv(t,r,o.isFullyInitialized()||Cf(a),e.filter.filtersNodes())}}function wg(e,t,a,n,i,s,o,r){const l=t.serverCache;let c;const d=o?e.filter:e.filter.getIndexedFilter();if(Cf(a))c=d.updateFullNode(l.getNode(),n,null);else if(d.filtersNodes()&&!l.isFiltered()){const e=l.getNode().updateChild(a,n);c=d.updateFullNode(l.getNode(),e,null)}else{const e=vf(a);if(!l.isCompleteForPath(a)&&gf(a)>1)return t;const i=bf(a),s=l.getNode().getImmediateChild(e).updateChild(i,n);c=".priority"===e?d.updatePriority(l.getNode(),s):d.updateChild(l.getNode(),e,s,i,fg,null)}const u=Fv(t,c,l.isFullyInitialized()||Cf(a),d.filtersNodes());return bg(e,u,a,i,new vg(i,u,s),r)}function yg(e,t,a,n,i,s,o){const r=t.eventCache;let l,c;const d=new vg(i,t,s);if(Cf(a))c=e.filter.updateFullNode(t.eventCache.getNode(),n,o),l=Uv(t,c,!0,e.filter.filtersNodes());else{const i=vf(a);if(".priority"===i)c=e.filter.updatePriority(t.eventCache.getNode(),n),l=Uv(t,c,r.isFullyInitialized(),r.isFiltered());else{const s=bf(a),c=r.getNode().getImmediateChild(i);let u;if(Cf(s))u=n;else{const e=d.getCompleteChild(i);u=null!=e?".priority"===wf(s)&&e.getChild(_f(s)).isEmpty()?e:e.updateChild(s,n):iv.EMPTY_NODE}if(c.equals(u))l=t;else{l=Uv(t,e.filter.updateChild(r.getNode(),i,u,s,d,o),r.isFullyInitialized(),e.filter.filtersNodes())}}}return l}function _g(e,t){return e.eventCache.isCompleteForChild(t)}function kg(e,t,a){return a.foreach((e,a)=>{t=t.updateChild(e,a)}),t}function Cg(e,t,a,n,i,s,o,r){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l,c=t;l=Cf(a)?n:new $v(null).setTree(a,n);const d=t.serverCache.getNode();return l.children.inorderTraversal((a,n)=>{if(d.hasChild(a)){const l=kg(0,t.serverCache.getNode().getImmediateChild(a),n);c=wg(e,c,new mf(a),l,i,s,o,r)}}),l.children.inorderTraversal((a,n)=>{const l=!t.serverCache.isCompleteForChild(a)&&null===n.value;if(!d.hasChild(a)&&!l){const l=kg(0,t.serverCache.getNode().getImmediateChild(a),n);c=wg(e,c,new mf(a),l,i,s,o,r)}}),c}class Eg{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const a=this.query_._queryParams,n=new pv(a.getIndex()),i=(s=a).loadsAllData()?new pv(s.getIndex()):s.hasLimit()?new fv(s):new mv(s);var s;this.processor_=function(e){return{filter:e}}(i);const o=t.serverCache,r=t.eventCache,l=n.updateFullNode(iv.EMPTY_NODE,o.getNode(),null),c=i.updateFullNode(iv.EMPTY_NODE,r.getNode(),null),d=new Dv(l,o.isFullyInitialized(),n.filtersNodes()),u=new Dv(c,r.isFullyInitialized(),i.filtersNodes());this.viewCache_=Mv(u,d),this.eventGenerator_=new Ov(this.query_)}get query(){return this.query_}}function Ig(e,t){const a=Bv(e.viewCache_);return a&&(e.query._queryParams.loadsAllData()||!Cf(t)&&!a.getImmediateChild(vf(t)).isEmpty())?a.getChild(t):null}function Sg(e){return 0===e.eventRegistrations_.length}function Tg(e,t,a){const n=[];if(a){pr(null==t,"A cancel should cancel all event registrations.");const i=e.query._path;e.eventRegistrations_.forEach(e=>{const t=e.createCancelEvent(a,i);t&&n.push(t)})}if(t){let a=[];for(let n=0;n<e.eventRegistrations_.length;++n){const i=e.eventRegistrations_[n];if(i.matches(t)){if(t.hasAnyCallback()){a=a.concat(e.eventRegistrations_.slice(n+1));break}}else a.push(i)}e.eventRegistrations_=a}else e.eventRegistrations_=[];return n}function Ng(e,t,a,n){t.type===Sv.MERGE&&null!==t.source.queryId&&(pr(Bv(e.viewCache_),"We should always have a full cache before handling merges"),pr(qv(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=gg(e.processor_,i,t,a,n);var o,r;return o=e.processor_,r=s.viewCache,pr(r.eventCache.getNode().isIndexed(o.filter.getIndex()),"Event snap not indexed"),pr(r.serverCache.getNode().isIndexed(o.filter.getIndex()),"Server snap not indexed"),pr(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,Ag(e,s.changes,s.viewCache.eventCache.getNode(),null)}function Ag(e,t,a,n){const i=n?[n]:e.eventRegistrations_;return function(e,t,a,n){const i=[],s=[];return t.forEach(t=>{var a;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((a=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:a}))}),Lv(e,i,"child_removed",t,n,a),Lv(e,i,"child_added",t,n,a),Lv(e,i,"child_moved",s,n,a),Lv(e,i,"child_changed",t,n,a),Lv(e,i,"value",t,n,a),i}(e.eventGenerator_,t,a,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Pg,Rg;class xg{constructor(){this.views=new Map}}function Dg(e,t,a,n){const i=t.source.queryId;if(null!==i){const s=e.views.get(i);return pr(null!=s,"SyncTree gave us an op for an invalid query."),Ng(s,t,a,n)}{let i=[];for(const s of e.views.values())i=i.concat(Ng(s,t,a,n));return i}}function Og(e,t,a,n,i,s){const o=function(e,t,a,n,i){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=og(a,i?n:null),s=!1;e?s=!0:n instanceof iv?(e=rg(a,n),s=!1):(e=iv.EMPTY_NODE,s=!1);const o=Mv(new Dv(e,s,!1),new Dv(n,i,!1));return new Eg(t,o)}return o}(e,t,n,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,a),function(e,t){const a=e.viewCache_.eventCache,n=[];a.getNode().isLeafNode()||a.getNode().forEachChild(Yf,(e,t)=>{n.push(dv(e,t))});return a.isFullyInitialized()&&n.push(cv(a.getNode())),Ag(e,n,a.getNode(),t)}(o,a)}function Lg(e,t,a,n){const i=t._queryIdentifier,s=[];let o=[];const r=Bg(e);if("default"===i)for(const[l,c]of e.views.entries())o=o.concat(Tg(c,a,n)),Sg(c)&&(e.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{const t=e.views.get(i);t&&(o=o.concat(Tg(t,a,n)),Sg(t)&&(e.views.delete(i),t.query._queryParams.loadsAllData()||s.push(t.query)))}return r&&!Bg(e)&&s.push(new(pr(Pg,"Reference.ts has not been loaded"),Pg)(t._repo,t._path)),{removed:s,events:o}}function Mg(e){const t=[];for(const a of e.views.values())a.query._queryParams.loadsAllData()||t.push(a);return t}function Ug(e,t){let a=null;for(const n of e.views.values())a=a||Ig(n,t);return a}function Fg(e,t){if(t._queryParams.loadsAllData())return jg(e);{const a=t._queryIdentifier;return e.views.get(a)}}function qg(e,t){return null!=Fg(e,t)}function Bg(e){return null!=jg(e)}function jg(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $g=1;class zg{constructor(e){this.listenProvider_=e,this.syncPointTree_=new $v(null),this.pendingWriteTree_={visibleWrites:zv.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Vg(e,t,a,n,i){return function(e,t,a,n,i){pr(n>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:a,writeId:n,visible:i}),i&&(e.visibleWrites=Vv(e.visibleWrites,t,a)),e.lastWriteId=n}(e.pendingWriteTree_,t,a,n,i),i?Yg(e,new Rv({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,a)):[]}function Wg(e,t,a=!1){const n=function(e,t){for(let a=0;a<e.allWrites.length;a++){const n=e.allWrites[a];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(tg(e.pendingWriteTree_,t)){let t=new $v(null);return null!=n.snap?t=t.set(ff(),!0):Um(n.children,e=>{t=t.set(new mf(e),!0)}),Yg(e,new Av(n.path,t,a))}return[]}function Hg(e,t,a){return Yg(e,new Rv({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,a))}function Gg(e,t,a,n,i=!1){const s=t._path,o=e.syncPointTree_.get(s);let r=[];if(o&&("default"===t._queryIdentifier||qg(o,t))){const l=Lg(o,t,a,n);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));const c=l.removed;if(r=l.events,!i){const a=-1!==c.findIndex(e=>e._queryParams.loadsAllData()),i=e.syncPointTree_.findOnPath(s,(e,t)=>Bg(t));if(a&&!i){const t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){const a=function(e){return e.fold((e,t,a)=>{if(t&&Bg(t)){return[jg(t)]}{let e=[];return t&&(e=Mg(t)),Um(a,(t,a)=>{e=e.concat(a)}),e}})}(t);for(let t=0;t<a.length;++t){const n=a[t],i=n.query,s=Xg(e,n);e.listenProvider_.startListening(sb(i),eb(e,i),s.hashFn,s.onComplete)}}}if(!i&&c.length>0&&!n)if(a){const a=null;e.listenProvider_.stopListening(sb(t),a)}else c.forEach(t=>{const a=e.queryToTagMap.get(tb(t));e.listenProvider_.stopListening(sb(t),a)})}!function(e,t){for(let a=0;a<t.length;++a){const n=t[a];if(!n._queryParams.loadsAllData()){const t=tb(n),a=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(a)}}}(e,c)}return r}function Kg(e,t,a,n=!1){const i=t._path;let s=null,o=!1;e.syncPointTree_.foreachOnPath(i,(e,t)=>{const a=Ef(e,i);s=s||Ug(t,a),o=o||Bg(t)});let r,l=e.syncPointTree_.get(i);if(l?(o=o||Bg(l),s=s||Ug(l,ff())):(l=new xg,e.syncPointTree_=e.syncPointTree_.set(i,l)),null!=s)r=!0;else{r=!1,s=iv.EMPTY_NODE;e.syncPointTree_.subtree(i).foreachChild((e,t)=>{const a=Ug(t,ff());a&&(s=s.updateImmediateChild(e,a))})}const c=qg(l,t);if(!c&&!t._queryParams.loadsAllData()){const a=tb(t);pr(!e.queryToTagMap.has(a),"View does not exist, but we have a tag");const n=$g++;e.queryToTagMap.set(a,n),e.tagToQueryMap.set(n,a)}let d=Og(l,t,a,eg(e.pendingWriteTree_,i),s,r);if(!c&&!o&&!n){const a=Fg(l,t);d=d.concat(function(e,t,a){const n=t._path,i=eb(e,t),s=Xg(e,a),o=e.listenProvider_.startListening(sb(t),i,s.hashFn,s.onComplete),r=e.syncPointTree_.subtree(n);if(i)pr(!Bg(r.value),"If we're adding a query, it shouldn't be shadowed");else{const t=r.fold((e,t,a)=>{if(!Cf(e)&&t&&Bg(t))return[jg(t).query];{let e=[];return t&&(e=e.concat(Mg(t).map(e=>e.query))),Um(a,(t,a)=>{e=e.concat(a)}),e}});for(let a=0;a<t.length;++a){const n=t[a];e.listenProvider_.stopListening(sb(n),eb(e,n))}}return o}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,a))}return d}function Jg(e,t,a){const n=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,a)=>{const n=Ug(a,Ef(e,t));if(n)return n});return sg(n,t,i,a,!0)}function Yg(e,t){return Qg(t,e.syncPointTree_,null,eg(e.pendingWriteTree_,ff()))}function Qg(e,t,a,n){if(Cf(e.path))return Zg(e,t,a,n);{const i=t.get(ff());null==a&&null!=i&&(a=Ug(i,ff()));let s=[];const o=vf(e.path),r=e.operationForChild(o),l=t.children.get(o);if(l&&r){const e=a?a.getImmediateChild(o):null,t=hg(n,o);s=s.concat(Qg(r,l,e,t))}return i&&(s=s.concat(Dg(i,e,n,a))),s}}function Zg(e,t,a,n){const i=t.get(ff());null==a&&null!=i&&(a=Ug(i,ff()));let s=[];return t.children.inorderTraversal((t,i)=>{const o=a?a.getImmediateChild(t):null,r=hg(n,t),l=e.operationForChild(t);l&&(s=s.concat(Zg(l,i,o,r)))}),i&&(s=s.concat(Dg(i,e,n,a))),s}function Xg(e,t){const a=t.query,n=eb(e,a);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||iv.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return n?function(e,t,a){const n=ab(e,a);if(n){const a=nb(n),i=a.path,s=a.queryId,o=Ef(i,t);return ib(e,i,new Pv(Nv(s),o))}return[]}(e,a._path,n):function(e,t){return Yg(e,new Pv({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,a._path);{const n=function(e,t){let a="Unknown Error";"too_big"===e?a="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?a="Client doesn't have permission to access the desired data.":"unavailable"===e&&(a="The service is unavailable");const n=new Error(e+" at "+t._path.toString()+": "+a);return n.code=e.toUpperCase(),n}(t,a);return Gg(e,a,null,n)}}}}function eb(e,t){const a=tb(t);return e.queryToTagMap.get(a)}function tb(e){return e._path.toString()+"$"+e._queryIdentifier}function ab(e,t){return e.tagToQueryMap.get(t)}function nb(e){const t=e.indexOf("$");return pr(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new mf(e.substr(0,t))}}function ib(e,t,a){const n=e.syncPointTree_.get(t);pr(n,"Missing sync point for query tag that we're tracking");return Dg(n,a,eg(e.pendingWriteTree_,t),null)}function sb(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(pr(Rg,"Reference.ts has not been loaded"),Rg)(e._repo,e._path):e}class ob{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new ob(t)}node(){return this.node_}}class rb{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=kf(this.path_,e);return new rb(this.syncTree_,t)}node(){return Jg(this.syncTree_,this.path_)}}const lb=function(e,t,a){return e&&"object"==typeof e?(pr(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?cb(e[".sv"],t,a):"object"==typeof e[".sv"]?db(e[".sv"],t):void pr(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},cb=function(e,t,a){if("timestamp"===e)return a.timestamp;pr(!1,"Unexpected server value: "+e)},db=function(e,t,a){e.hasOwnProperty("increment")||pr(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const n=e.increment;"number"!=typeof n&&pr(!1,"Unexpected increment value: "+n);const i=t.node();if(pr(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return n;const s=i.getValue();return"number"!=typeof s?n:s+n},ub=function(e,t,a){return hb(e,new ob(t),a)};function hb(e,t,a){const n=e.getPriority().val(),i=lb(n,t.getImmediateChild(".priority"),a);let s;if(e.isLeafNode()){const n=e,s=lb(n.getValue(),t,a);return s!==n.getValue()||i!==n.getPriority().val()?new Jf(s,ov(i)):e}{const n=e;return s=n,i!==n.getPriority().val()&&(s=s.updatePriority(new Jf(i))),n.forEachChild(Yf,(e,n)=>{const i=hb(n,t.getImmediateChild(e),a);i!==n&&(s=s.updateImmediateChild(e,i))}),s}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pb{constructor(e="",t=null,a={children:{},childCount:0}){this.name=e,this.parent=t,this.node=a}}function mb(e,t){let a=t instanceof mf?t:new mf(t),n=e,i=vf(a);for(;null!==i;){const e=Yr(n.node.children,i)||{children:{},childCount:0};n=new pb(i,n,e),a=bf(a),i=vf(a)}return n}function fb(e){return e.node.value}function vb(e,t){e.node.value=t,_b(e)}function gb(e){return e.node.childCount>0}function bb(e,t){Um(e.node.children,(a,n)=>{t(new pb(a,e,n))})}function wb(e,t,a,n){a&&t(e),bb(e,e=>{wb(e,t,!0)})}function yb(e){return new mf(null===e.parent?e.name:yb(e.parent)+"/"+e.name)}function _b(e){null!==e.parent&&function(e,t,a){const n=function(e){return void 0===fb(e)&&!gb(e)}(a),i=Jr(e.node.children,t);n&&i?(delete e.node.children[t],e.node.childCount--,_b(e)):n||i||(e.node.children[t]=a.node,e.node.childCount++,_b(e))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e.parent,e.name,e)}const kb=/[\[\].#$\/\u0000-\u001F\u007F]/,Cb=/[\[\].#$\u0000-\u001F\u007F]/,Eb=10485760,Ib=function(e){return"string"==typeof e&&0!==e.length&&!kb.test(e)},Sb=function(e){return"string"==typeof e&&0!==e.length&&!Cb.test(e)},Tb=function(e,t,a,n){n&&void 0===t||Nb(sl(e,"value"),t,a)},Nb=function(e,t,a){const n=a instanceof mf?new Tf(a,e):a;if(void 0===t)throw new Error(e+"contains undefined "+Af(n));if("function"==typeof t)throw new Error(e+"contains a function "+Af(n)+" with contents = "+t.toString());if(Am(t))throw new Error(e+"contains "+t.toString()+" "+Af(n));if("string"==typeof t&&t.length>Eb/3&&ol(t)>Eb)throw new Error(e+"contains a string greater than "+Eb+" utf8 bytes "+Af(n)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let a=!1,i=!1;if(Um(t,(t,s)=>{if(".value"===t)a=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!Ib(t)))throw new Error(e+" contains an invalid key ("+t+") "+Af(n)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var o,r;r=t,(o=n).parts_.length>0&&(o.byteLength_+=1),o.parts_.push(r),o.byteLength_+=ol(r),Nf(o),Nb(e,s,n),function(e){const t=e.parts_.pop();e.byteLength_-=ol(t),e.parts_.length>0&&(e.byteLength_-=1)}(n)}),a&&i)throw new Error(e+' contains ".value" child '+Af(n)+" in addition to actual children.")}},Ab=function(e,t,a,n){if(!Sb(a))throw new Error(sl(e,t)+'was an invalid path = "'+a+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Pb=function(e,t){if(".info"===vf(t))throw new Error(e+" failed = Can't modify data under /.info/")},Rb=function(e,t){const a=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Ib(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==a.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Sb(e)}(a))throw new Error(sl(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class xb{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Db(e,t){let a=null;for(let n=0;n<t.length;n++){const i=t[n],s=i.getPath();null===a||If(s,a.path)||(e.eventLists_.push(a),a=null),null===a&&(a={events:[],path:s}),a.events.push(i)}a&&e.eventLists_.push(a)}function Ob(e,t,a){Db(e,a),Mb(e,e=>If(e,t))}function Lb(e,t,a){Db(e,a),Mb(e,e=>Sf(e,t)||Sf(t,e))}function Mb(e,t){e.recursionDepth_++;let a=!0;for(let n=0;n<e.eventLists_.length;n++){const i=e.eventLists_[n];if(i){t(i.path)?(Ub(e.eventLists_[n]),e.eventLists_[n]=null):a=!1}}a&&(e.eventLists_=[]),e.recursionDepth_--}function Ub(e){for(let t=0;t<e.events.length;t++){const a=e.events[t];if(null!==a){e.events[t]=null;const n=a.getEventRunner();km&&Em("event: "+a.toString()),jm(n)}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fb{constructor(e,t,a,n){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=a,this.appCheckProvider_=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new xb,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=_v(),this.transactionQueueTree_=new pb,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function qb(e,t,a){if(e.stats_=tf(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new wv(e.repoInfo_,(t,a,n,i)=>{$b(e,t,a,n,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>zb(e,!0),0);else{if(null!=a){if("object"!=typeof a)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Gr(a)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}e.persistentConnection_=new xf(e.repoInfo_,t,(t,a,n,i)=>{$b(e,t,a,n,i)},t=>{zb(e,t)},t=>{!function(e,t){Um(t,(t,a)=>{Vb(e,t,a)})}(e,t)},e.authTokenProvider_,e.appCheckProvider_,a),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){const a=e.toString();return ef[a]||(ef[a]=t()),ef[a]}(e.repoInfo_,()=>new Iv(e.stats_,e.server_)),e.infoData_=new yv,e.infoSyncTree_=new zg({startListening:(t,a,n,i)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=Hg(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),Vb(e,"connected",!1),e.serverSyncTree_=new zg({startListening:(t,a,n,i)=>(e.server_.listen(t,n,a,(a,n)=>{const s=i(a,n);Lb(e.eventQueue_,t._path,s)}),[]),stopListening:(t,a)=>{e.server_.unlisten(t,a)}})}function Bb(e){const t=e.infoData_.getNode(new mf(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function jb(e){return(t=(t={timestamp:Bb(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function $b(e,t,a,n,i){e.dataUpdateCount++;const s=new mf(t);a=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,a):a;let o=[];if(i)if(n){const t=Zr(a,e=>ov(e));o=function(e,t,a,n){const i=ab(e,n);if(i){const n=nb(i),s=n.path,o=n.queryId,r=Ef(s,t),l=$v.fromObject(a);return ib(e,s,new xv(Nv(o),r,l))}return[]}(e.serverSyncTree_,s,t,i)}else{const t=ov(a);o=function(e,t,a,n){const i=ab(e,n);if(null!=i){const n=nb(i),s=n.path,o=n.queryId,r=Ef(s,t);return ib(e,s,new Rv(Nv(o),r,a))}return[]}(e.serverSyncTree_,s,t,i)}else if(n){const t=Zr(a,e=>ov(e));o=function(e,t,a){const n=$v.fromObject(a);return Yg(e,new xv({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}(e.serverSyncTree_,s,t)}else{const t=ov(a);o=Hg(e.serverSyncTree_,s,t)}let r=s;o.length>0&&(r=Qb(e,s)),Lb(e.eventQueue_,r,o)}function zb(e,t){Vb(e,"connected",t),!1===t&&function(e){Kb(e,"onDisconnectEvents");const t=jb(e),a=_v();Cv(e.onDisconnect_,ff(),(n,i)=>{const s=function(e,t,a,n){return hb(t,new rb(a,e),n)}(n,i,e.serverSyncTree_,t);kv(a,n,s)});let n=[];Cv(a,ff(),(t,a)=>{n=n.concat(Hg(e.serverSyncTree_,t,a));const i=aw(e,t);Qb(e,i)}),e.onDisconnect_=_v(),Lb(e.eventQueue_,ff(),n)}(e)}function Vb(e,t,a){const n=new mf("/.info/"+t),i=ov(a);e.infoData_.updateSnapshot(n,i);const s=Hg(e.infoSyncTree_,n,i);Lb(e.eventQueue_,n,s)}function Wb(e){return e.nextWriteId_++}function Hb(e,t,a,n,i){Kb(e,"set",{path:t.toString(),value:a,priority:n});const s=jb(e),o=ov(a,n),r=Jg(e.serverSyncTree_,t),l=ub(o,r,s),c=Wb(e),d=Vg(e.serverSyncTree_,t,l,c,!0);Db(e.eventQueue_,d),e.server_.put(t.toString(),o.val(!0),(a,n)=>{const s="ok"===a;s||Nm("set at "+t+" failed: "+a);const o=Wg(e.serverSyncTree_,c,!s);Lb(e.eventQueue_,t,o),function(e,t,a,n){t&&jm(()=>{if("ok"===a)t(null);else{const e=(a||"error").toUpperCase();let i=e;n&&(i+=": "+n);const s=new Error(i);s.code=e,t(s)}})}(0,i,a,n)});const u=aw(e,t);Qb(e,u),Lb(e.eventQueue_,u,[])}function Gb(e,t,a){let n;n=".info"===vf(t._path)?Gg(e.infoSyncTree_,t,a):Gg(e.serverSyncTree_,t,a),Ob(e.eventQueue_,t._path,n)}function Kb(e,...t){let a="";e.persistentConnection_&&(a=e.persistentConnection_.id+":"),Em(a,...t)}function Jb(e,t,a){return Jg(e.serverSyncTree_,t,a)||iv.EMPTY_NODE}function Yb(e,t=e.transactionQueueTree_){if(t||tw(e,t),fb(t)){const a=Xb(e,t);pr(a.length>0,"Sending zero length transaction queue");a.every(e=>0===e.status)&&function(e,t,a){const n=a.map(e=>e.currentWriteId),i=Jb(e,t,n);let s=i;const o=i.hash();for(let c=0;c<a.length;c++){const e=a[c];pr(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const n=Ef(t,e.path);s=s.updateChild(n,e.currentOutputSnapshotRaw)}const r=s.val(!0),l=t;e.server_.put(l.toString(),r,n=>{Kb(e,"transaction put response",{path:l.toString(),status:n});let i=[];if("ok"===n){const n=[];for(let t=0;t<a.length;t++)a[t].status=2,i=i.concat(Wg(e.serverSyncTree_,a[t].currentWriteId)),a[t].onComplete&&n.push(()=>a[t].onComplete(null,!0,a[t].currentOutputSnapshotResolved)),a[t].unwatcher();tw(e,mb(e.transactionQueueTree_,t)),Yb(e,e.transactionQueueTree_),Lb(e.eventQueue_,t,i);for(let e=0;e<n.length;e++)jm(n[e])}else{if("datastale"===n)for(let e=0;e<a.length;e++)3===a[e].status?a[e].status=4:a[e].status=0;else{Nm("transaction at "+l.toString()+" failed: "+n);for(let e=0;e<a.length;e++)a[e].status=4,a[e].abortReason=n}Qb(e,t)}},o)}(e,yb(t),a)}else gb(t)&&bb(t,t=>{Yb(e,t)})}function Qb(e,t){const a=Zb(e,t),n=yb(a);return function(e,t,a){if(0===t.length)return;const n=[];let i=[];const s=t.filter(e=>0===e.status),o=s.map(e=>e.currentWriteId);for(let r=0;r<t.length;r++){const s=t[r],l=Ef(a,s.path);let c,d=!1;if(pr(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===s.status)d=!0,c=s.abortReason,i=i.concat(Wg(e.serverSyncTree_,s.currentWriteId,!0));else if(0===s.status)if(s.retryCount>=25)d=!0,c="maxretry",i=i.concat(Wg(e.serverSyncTree_,s.currentWriteId,!0));else{const a=Jb(e,s.path,o);s.currentInputSnapshot=a;const n=t[r].update(a.val());if(void 0!==n){Nb("transaction failed: Data returned ",n,s.path);let t=ov(n);"object"==typeof n&&null!=n&&Jr(n,".priority")||(t=t.updatePriority(a.getPriority()));const r=s.currentWriteId,l=jb(e),c=ub(t,a,l);s.currentOutputSnapshotRaw=t,s.currentOutputSnapshotResolved=c,s.currentWriteId=Wb(e),o.splice(o.indexOf(r),1),i=i.concat(Vg(e.serverSyncTree_,s.path,c,s.currentWriteId,s.applyLocally)),i=i.concat(Wg(e.serverSyncTree_,r,!0))}else d=!0,c="nodata",i=i.concat(Wg(e.serverSyncTree_,s.currentWriteId,!0))}Lb(e.eventQueue_,a,i),i=[],d&&(t[r].status=2,function(e){setTimeout(e,Math.floor(0))}(t[r].unwatcher),t[r].onComplete&&("nodata"===c?n.push(()=>t[r].onComplete(null,!1,t[r].currentInputSnapshot)):n.push(()=>t[r].onComplete(new Error(c),!1,null))))}tw(e,e.transactionQueueTree_);for(let r=0;r<n.length;r++)jm(n[r]);Yb(e,e.transactionQueueTree_)}(e,Xb(e,a),n),n}function Zb(e,t){let a,n=e.transactionQueueTree_;for(a=vf(t);null!==a&&void 0===fb(n);)n=mb(n,a),a=vf(t=bf(t));return n}function Xb(e,t){const a=[];return ew(e,t,a),a.sort((e,t)=>e.order-t.order),a}function ew(e,t,a){const n=fb(t);if(n)for(let i=0;i<n.length;i++)a.push(n[i]);bb(t,t=>{ew(e,t,a)})}function tw(e,t){const a=fb(t);if(a){let e=0;for(let t=0;t<a.length;t++)2!==a[t].status&&(a[e]=a[t],e++);a.length=e,vb(t,a.length>0?a:void 0)}bb(t,t=>{tw(e,t)})}function aw(e,t){const a=yb(Zb(e,t)),n=mb(e.transactionQueueTree_,t);return function(e,t){let a=e.parent;for(;null!==a;){if(t(a))return!0;a=a.parent}}(n,t=>{nw(e,t)}),nw(e,n),wb(n,t=>{nw(e,t)}),a}function nw(e,t){const a=fb(t);if(a){const n=[];let i=[],s=-1;for(let t=0;t<a.length;t++)3===a[t].status||(1===a[t].status?(pr(s===t-1,"All SENT items should be at beginning of queue."),s=t,a[t].status=3,a[t].abortReason="set"):(pr(0===a[t].status,"Unexpected transaction status in abort"),a[t].unwatcher(),i=i.concat(Wg(e.serverSyncTree_,a[t].currentWriteId,!0)),a[t].onComplete&&n.push(a[t].onComplete.bind(null,new Error("set"),!1,null))));-1===s?vb(t,void 0):a.length=s+1,Lb(e.eventQueue_,yb(t),i);for(let e=0;e<n.length;e++)jm(n[e])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iw=function(e,t){const a=sw(e),n=a.namespace;"firebase.com"===a.domain&&Tm(a.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===a.domain||Tm("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),a.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Nm("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const i="ws"===a.scheme||"wss"===a.scheme;return{repoInfo:new Ym(a.host,a.secure,n,i,t,"",n!==a.subdomain),path:new mf(a.pathString)}},sw=function(e){let t="",a="",n="",i="",s="",o=!0,r="https",l=443;if("string"==typeof e){let c=e.indexOf("//");c>=0&&(r=e.substring(0,c-1),e=e.substring(c+2));let d=e.indexOf("/");-1===d&&(d=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(d,u)),d<u&&(i=function(e){let t="";const a=e.split("/");for(let i=0;i<a.length;i++)if(a[i].length>0){let e=a[i];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(n){}t+="/"+e}return t}(e.substring(d,u)));const h=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const a of e.split("&")){if(0===a.length)continue;const n=a.split("=");2===n.length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Nm(`Invalid query segment '${a}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));c=t.indexOf(":"),c>=0?(o="https"===r||"wss"===r,l=parseInt(t.substring(c+1),10)):c=t.length;const p=t.slice(0,c);if("localhost"===p.toLowerCase())a="localhost";else if(p.split(".").length<=2)a=p;else{const e=t.indexOf(".");n=t.substring(0,e).toLowerCase(),a=t.substring(e+1),s=n}"ns"in h&&(s=h.ns)}return{host:t,port:l,domain:a,subdomain:n,secure:o,scheme:r,pathString:i,namespace:s}},ow="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",rw=function(){let e=0;const t=[];return function(a){const n=a===e;let i;e=a;const s=new Array(8);for(i=7;i>=0;i--)s[i]=ow.charAt(a%64),a=Math.floor(a/64);pr(0===a,"Cannot push at time == 0");let o=s.join("");if(n){for(i=11;i>=0&&63===t[i];i--)t[i]=0;t[i]++}else for(i=0;i<12;i++)t[i]=Math.floor(64*Math.random());for(i=0;i<12;i++)o+=ow.charAt(t[i]);return pr(20===o.length,"nextPushId: Length should be 20."),o}}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class lw{constructor(e,t,a,n){this.eventType=e,this.eventRegistration=t,this.snapshot=a,this.prevName=n}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Gr(this.snapshot.exportVal())}}class cw{constructor(e,t,a){this.eventRegistration=e,this.error=t,this.path=a}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dw{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return pr(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uw{constructor(e,t,a,n){this._repo=e,this._path=t,this._queryParams=a,this._orderByCalled=n}get key(){return Cf(this._path)?null:wf(this._path)}get ref(){return new hw(this._repo,this._path)}get _queryIdentifier(){const e=bv(this._queryParams),t=Lm(e);return"{}"===t?"default":t}get _queryObject(){return bv(this._queryParams)}isEqual(e){if(!((e=rl(e))instanceof uw))return!1;const t=this._repo===e._repo,a=If(this._path,e._path),n=this._queryIdentifier===e._queryIdentifier;return t&&a&&n}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let a=e.pieceNum_;a<e.pieces_.length;a++)""!==e.pieces_[a]&&(t+="/"+encodeURIComponent(String(e.pieces_[a])));return t||"/"}(this._path)}}class hw extends uw{constructor(e,t){super(e,t,new vv,!1)}get parent(){const e=_f(this._path);return null===e?null:new hw(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class pw{constructor(e,t,a){this._node=e,this.ref=t,this._index=a}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new mf(e),a=fw(this.ref,e);return new pw(this._node.getChild(t),a,Yf)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,(t,a)=>e(new pw(a,fw(this.ref,t),Yf)))}hasChild(e){const t=new mf(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function mw(e,t){return(e=rl(e))._checkNotDeleted("ref"),void 0!==t?fw(e._root,t):e._root}function fw(e,t){var a,n,i;return null===vf((e=rl(e))._path)?(a="child",n="path",(i=t)&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),Ab(a,n,i)):Ab("child","path",t),new hw(e._repo,kf(e._path,t))}function vw(e,t){e=rl(e),Pb("set",e._path),Tb("set",t,e._path,!1);const a=new Pr;return Hb(e._repo,e._path,t,null,a.wrapCallback(()=>{})),a.promise}class gw{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const a=t._queryParams.getIndex();return new lw("value",this,new pw(e.snapshotNode,new hw(t._repo,t._path),a))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new cw(this,e,t):null}matches(e){return e instanceof gw&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}function bw(e,t,a,n,i){let s;if("object"==typeof n&&(s=void 0,i=n),"function"==typeof n&&(s=n),i&&i.onlyOnce){const t=a,n=(a,n)=>{Gb(e._repo,e,r),t(a,n)};n.userCallback=a.userCallback,n.context=a.context,a=n}const o=new dw(a,s||void 0),r=new gw(o);return function(e,t,a){let n;n=".info"===vf(t._path)?Kg(e.infoSyncTree_,t,a):Kg(e.serverSyncTree_,t,a),Ob(e.eventQueue_,t._path,n)}(e._repo,e,r),()=>Gb(e._repo,e,r)}function ww(e,t,a,n){return bw(e,0,t,a,n)}function yw(e,t,a){Gb(e._repo,e,null)}!function(e){pr(!Pg,"__referenceConstructor has already been defined"),Pg=e}(hw),function(e){pr(!Rg,"__referenceConstructor has already been defined"),Rg=e}(hw);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const _w={};let kw=!1;function Cw(e,t,a,n,i){let s=n||e.options.databaseURL;void 0===s&&(e.options.projectId||Tm("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Em("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,r=iw(s,i),l=r.repoInfo;"undefined"!=typeof process&&lm&&(o=lm.FIREBASE_DATABASE_EMULATOR_HOST),o?(s=`http://${o}?ns=${l.namespace}`,r=iw(s,i),l=r.repoInfo):r.repoInfo.secure;const c=new Vm(e.name,e.options,t);Rb("Invalid Firebase Database URL",r),Cf(r.path)||Tm("Database URL must point to the root of a Firebase Database (not including a child path).");const d=function(e,t,a,n){let i=_w[t.name];i||(i={},_w[t.name]=i);let s=i[e.toURLString()];s&&Tm("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new Fb(e,kw,a,n),i[e.toURLString()]=s,s}(l,e,c,new zm(e,a));return new Ew(d,e)}class Ew{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(qb(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new hw(this._repo,ff())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const a=_w[t];a&&a[e.key]===e||Tm(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete a[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Tm("Cannot call "+e+" on a deleted database.")}}function Iw(e=Sc(),t){const a=yc(e,"database").getImmediate({identifier:t});if(!a._instanceStarted){const e=Tr("database");e&&Sw(a,...e)}return a}function Sw(e,t,a,n={}){(e=rl(e))._checkNotDeleted("useEmulator");const i=`${t}:${a}`,s=e._repoInternal;if(e._instanceStarted){if(i===e._repoInternal.repoInfo_.host&&Xr(n,s.repoInfo_.emulatorOptions))return;Tm("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)n.mockUserToken&&Tm('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Wm(Wm.OWNER);else if(n.mockUserToken){const t="string"==typeof n.mockUserToken?n.mockUserToken:Dr(n.mockUserToken,e.app.options.projectId);o=new Wm(t)}Rr(t)&&(xr(t),Mr("Database",!0)),function(e,t,a,n){const i=t.lastIndexOf(":"),s=Rr(t.substring(0,i));e.repoInfo_=new Ym(t,s,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,a),n&&(e.authTokenProvider_=n)}(s,i,n,o)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Tw={".sv":"timestamp"};xf.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},xf.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},function(e){hm(Ec),wc(new ll("database",(e,{instanceIdentifier:t})=>Cw(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),Tc(cm,dm,e),Tc(cm,dm,"esm2020")}();const Nw=Object.freeze(Object.defineProperty({__proto__:null,DataSnapshot:pw,Database:Ew,_QueryImpl:uw,_QueryParams:vv,_ReferenceImpl:hw,_repoManagerDatabaseFromApp:Cw,_setSDKVersion:hm,_validatePathString:Ab,_validateWritablePath:Pb,child:fw,connectDatabaseEmulator:Sw,getDatabase:Iw,off:yw,onValue:ww,push:function(e,t){e=rl(e),Pb("push",e._path),Tb("push",t,e._path,!0);const a=Bb(e._repo),n=rw(a),i=fw(e,n),s=fw(e,n);let o;return o=null!=t?vw(s,t).then(()=>s):Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i},ref:mw,serverTimestamp:function(){return Tw},set:vw},Symbol.toStringTag,{value:"Module"}));let Aw,Pw;async function Rw(){if(Pw)return Pw;const{getDatabase:e}=await G(async()=>{const{getDatabase:e}=await Promise.resolve().then(()=>Nw);return{getDatabase:e}},void 0),t=Aw||await(Aw||La.initializeFirebaseApp().then(e=>(Aw=null==e?void 0:e.app,Aw)));if(!t)throw new Error("Firebase app no inicializada");return Pw=e(t),Pw}class xw{constructor(e){this.waiterId=e,this.listeners=new Map,this.activeCalls=new Map,this.db=null,this.initializing=!1,this._expectedInitialCallIds=new Set,this._initialSetProcessed=!1}async startListening(){if(!this.db)try{this.db=await Rw()}catch(t){return void console.error("❌ No se pudo obtener instancia Realtime DB:",t)}const e=ww(mw(this.db,`waiters/${this.waiterId}/active_calls`),e=>{const t=e.val()||[];this.initializing&&!this._initialSetProcessed&&(this._expectedInitialCallIds=new Set(t.map(e=>String(e))),0===this._expectedInitialCallIds.size&&(this.initializing=!1,this._initialSetProcessed=!0)),this.updateActiveCallsListeners(t)},e=>{console.error("🚨 Error en UNIFIED listener:",e),this.handleError(e)});this.initializing=!0,this.listeners.set("waiter",e),console.log(`⚡ UNIFIED WebSocket conectado para mozo ${this.waiterId}`)}updateActiveCallsListeners(e){Array.from(this.activeCalls.keys()).forEach(t=>{e.includes(t)||(this.removeCallListener(t),this.onCallRemoved(t))}),e.forEach(e=>{this.activeCalls.has(e)||this.addCallListener(e)})}addCallListener(e){if(!this.db)return;const t=ww(mw(this.db,`active_calls/${e}`),t=>{const a=t.val();if(a){const t=!this.activeCalls.has(e);this.activeCalls.set(e,a);const n=this.normalizeCallData(a);t?this.onNewCall(n):this.onCallUpdated(n),"acknowledged"!==a.status&&"completed"!==a.status||setTimeout(()=>{this.onCallMovedToHistory(e,n)},400),this.initializing&&!this._initialSetProcessed&&(this._expectedInitialCallIds.has(String(e))&&this._expectedInitialCallIds.delete(String(e)),0===this._expectedInitialCallIds.size&&(this.initializing=!1,this._initialSetProcessed=!0))}});this.listeners.set(`call_${e}`,t)}removeCallListener(e){const t=`call_${e}`;if(this.listeners.has(t)){this.listeners.get(t)(),this.listeners.delete(t)}this.activeCalls.delete(e)}onNewCall(e){console.debug("⚡ UNIFIED: Nueva llamada:",e.id,e);"pending"===e.status?(window.dispatchEvent(new CustomEvent("newWaiterCall",{detail:e})),window.dispatchEvent(new CustomEvent("ultraFastAddCall",{detail:e})),this.initializing||(this.playUltraFastSound(),this.vibrateUltraFast(),this.scheduleNativeNotification(e),this.showBrowserNotification(e)),this.logStatus(e,"pending")):this.onCallMovedToHistory(e.id,e)}onCallUpdated(e){"acknowledged"===e.status&&(this.showStatusUpdate(`Mesa ${e.table_number} - Atendiendo`),this.logStatus(e,"acknowledged")),window.dispatchEvent(new CustomEvent("updateCallStatus",{detail:e}))}onCallRemoved(e){this.showStatusUpdate("Servicio completado"),window.dispatchEvent(new CustomEvent("removeCall",{detail:{callId:e}}))}onCallMovedToHistory(e,t){let a="";switch(t.status){case"acknowledged":a=`Mesa ${t.table_number} - Atendiendo`;break;case"completed":a=`Mesa ${t.table_number} - Completado`;break;default:a=`Mesa ${t.table_number} - Actualizado`}this.showStatusUpdate(a),window.dispatchEvent(new CustomEvent("removeCall",{detail:{callId:e}})),window.dispatchEvent(new CustomEvent("callMovedToHistory",{detail:{callId:e,callData:t,status:t.status}})),"acknowledged"===t.status?this.logStatus(t,"acknowledged"):"completed"===t.status&&this.logStatus(t,"completed")}logStatus(e,t){try{if(!e||!e.id)return;switch(t){case"pending":console.info("[UNIFIED][PENDING]",`id=${e.id}`,`mesa=${e.table_number}`,`t=${e.called_at}`);break;case"acknowledged":console.info("[UNIFIED][ACKNOWLEDGED]",`id=${e.id}`,`mesa=${e.table_number}`,`ack=${e.acknowledged_at}`);break;case"completed":console.info("[UNIFIED][COMPLETED]",`id=${e.id}`,`mesa=${e.table_number}`,`comp=${e.completed_at}`)}}catch(a){}}normalizeCallData(e){var t,a;return{id:e.id,table_number:(null==(t=e.table)?void 0:t.number)||e.table_number,message:e.message||"Cliente solicita atención",urgency:e.urgency||"normal",status:e.status,called_at:e.called_at,acknowledged_at:e.acknowledged_at,completed_at:e.completed_at,timestamp:e.called_at,waiter_id:(null==(a=e.waiter)?void 0:a.id)||this.waiterId,client_info:e.client_info,table:e.table,waiter:e.waiter}}scheduleNativeNotification(e){try{ja&&ja.isPluginAvailable&&ja.isPluginAvailable("LocalNotifications")&&G(async()=>{const{LocalNotifications:e}=await import("./index-F8_fAb3q.js");return{LocalNotifications:e}},__vite__mapDeps([9,1,2])).then(({LocalNotifications:t})=>{t.schedule({notifications:[{title:`Mesa ${e.table_number} · ${e.urgency?e.urgency.toUpperCase():""}`,body:e.message||"Solicita atención",id:Number(Date.now()%1e5),extra:{callId:e.id,source:"unified-realtime"},schedule:null,smallIcon:void 0}]}).then(()=>{}).catch(e=>console.warn("⚠️ Error scheduling local notification:",e))}).catch(e=>{console.warn("⚠️ Error importing LocalNotifications:",e)})}catch(t){console.warn("⚠️ Exception scheduling native notification:",t)}}showBrowserNotification(e){try{if("undefined"==typeof Notification)return;if("granted"!==Notification.permission)return;const t=new Notification(`⚡ Mesa ${e.table_number}`,{body:`${e.message||"Solicita atención"} (UNIFIED)`,icon:"/favicon.ico",tag:`unified-call-${e.id}`,requireInteraction:!0});t.onclick=()=>{window.focus(),t.close()}}catch(t){}}playUltraFastSound(){try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),a=e.createGain();t.connect(a),a.connect(e.destination),t.frequency.setValueAtTime(800,e.currentTime),t.frequency.setValueAtTime(400,e.currentTime+.1),a.gain.setValueAtTime(.3,e.currentTime),a.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),t.start(e.currentTime),t.stop(e.currentTime+.3)}catch(e){const t=new Audio;t.src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+nfvnUjBjd+zO/eizEIDGKw5+mqWRMJRZzp4b5+JgU2jdXzzX4tBSF1xe/ejzQIElyx6OyrYRYJSKXi67RiHAY8k9nyyXkpBSR+zO/ijDEIDWOz6OyrXRQIR6Hn4L55KAU5jNTx0IAvBh1qtOnnqlkSCUig5OqyYhsGPJHY8sp7KgUle8vt3o4yBxFYr+ftrWIaBjeL0/LNfjAGIn3M7+CNMA==",t.volume=.7,t.play().catch(e=>{})}}vibrateUltraFast(){navigator.vibrate&&navigator.vibrate([100,50,100,50,200])}showStatusUpdate(e){const t=document.createElement("div");t.className="status-update",t.textContent=`⚡ ${e}`,document.body.appendChild(t),setTimeout(()=>t.classList.add("show"),10),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>t.remove(),200)},2e3)}async acknowledgeCall(e){try{const a=localStorage.getItem("token");let n=null;try{const t=await G(()=>Promise.resolve().then(()=>rm),void 0),a=t&&(t.default||t);if(a&&"function"==typeof a.acknowledgCall)n=await a.acknowledgCall(e);else{if(!a||"function"!=typeof a.acknowledgeCall)throw new Error("No acknowledge helper found");n=await a.acknowledgeCall(e)}}catch(t){n=await fetch(`https://mozoqr.com/api/waiter/calls/${e}/acknowledge`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}})}let i=!1;if(n&&"boolean"==typeof n.ok?i=n.ok:n&&"boolean"==typeof n.success?i=!1!==n.success:n&&(i=!0),!i){const e=n&&(n.status||n.code||"unknown");throw new Error(`Acknowledge failed: ${e}`)}window.dispatchEvent(new CustomEvent("callAcknowledged",{detail:{callId:e}}))}catch(a){console.error("UNIFIED: Error reconociendo llamada:",a),this.showError("Error al reconocer la llamada")}}async completeCall(e){try{const a=localStorage.getItem("token");let n=null;try{const t=await G(()=>Promise.resolve().then(()=>rm),void 0),a=t&&(t.default||t);if(a&&"function"==typeof a.completeCall)n=await a.completeCall(e);else{if(!a||"function"!=typeof a.complete)throw new Error("No complete helper found");n=await a.complete(e)}}catch(t){n=await fetch(`https://mozoqr.com/api/waiter/calls/${e}/complete`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}})}let i=!1;if(n&&"boolean"==typeof n.ok?i=n.ok:n&&"boolean"==typeof n.success?i=!1!==n.success:n&&(i=!0),!i){const e=n&&(n.status||n.code||"unknown");throw new Error(`Complete failed: ${e}`)}console.log("⚡ UNIFIED: Llamada completada"),window.dispatchEvent(new CustomEvent("removeCall",{detail:{callId:e}}));try{const{useNotificationsStore:t}=await G(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>cr);return{useNotificationsStore:e}},void 0);t().removeNotification(e)}catch(t){console.warn("⚠️ Unable to remove notification from store:",t)}}catch(a){console.error("UNIFIED: Error completando llamada:",a),this.showError("Error al completar la llamada")}}stopListening(){this.listeners.forEach(e=>{e()}),this.listeners.clear(),this.activeCalls.clear(),console.log("🛑 UNIFIED listener detenido")}async createTestCall(){console.log("🧪 UNIFIED: Creando llamada de prueba...");try{(await fetch("https://mozoqr.com/api/tables/1/call-waiter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"Llamada de prueba UNIFIED",urgency:"high"})})).ok&&console.log("✅ UNIFIED: Llamada de prueba creada")}catch(e){console.error("❌ UNIFIED: Error creando llamada de prueba:",e)}}handleError(e){console.error("🚨 UNIFIED: Error en listener:",e),this.showError("Error de conexión en tiempo real")}showError(e){const t=document.createElement("div");t.className="ultra-fast-error",t.innerHTML=`\n            <p>❌ ${e}</p>\n            <p>Reintentando automáticamente...</p>\n            <button onclick="this.remove()">Cerrar</button>\n        `,document.body.appendChild(t),setTimeout(()=>{t.parentElement&&t.remove()},5e3),setTimeout(()=>{this.startListening()},2e3)}}window.addEventListener("beforeunload",()=>{window.unifiedNotifications&&window.unifiedNotifications.stopListening()});const Dw={class:"modal-header"},Ow={class:"modal-body"},Lw={key:0,class:"loading-state"},Mw={key:1},Uw={key:0,class:"selection-summary"},Fw={class:"tables-grid"},qw=["onClick"],Bw={class:"table-checkbox"},jw=["checked","onChange"],$w={class:"table-info"},zw={class:"table-number"},Vw={key:0,class:"table-name"},Ww={class:"table-details"},Hw={key:0},Gw={key:1},Kw={key:0,class:"empty-state"},Jw={key:1,class:"quick-actions"},Yw={class:"modal-footer"},Qw=["disabled"],Zw=Mh({__name:"TableSelector",props:{availableTables:{type:Array,default:()=>[]},assignedTables:{type:Array,default:()=>[]}},emits:["close","tables-selected"],setup(e,{emit:t}){const i=e,d=t,u=a([]),h=a(!1),p=n(()=>i.availableTables||[]),m=e=>{const t=u.value.indexOf(e);-1===t?u.value.push(e):u.value.splice(t,1)},f=()=>{u.value=p.value.map(e=>e.id)},b=()=>{u.value=[]},y=()=>{console.log("🎯 TableSelector: Confirmando selección de mesas:",u.value),d("tables-selected",u.value)};return g(()=>{console.log("🏠 TableSelector mounted"),console.log("📋 Mesas disponibles recibidas:",i.availableTables),console.log("📋 Mesas asignadas recibidas:",i.assignedTables),console.log("Available tables:",p.value),console.log("Assigned tables:",i.assignedTables)}),(e,t)=>(w(),s("div",{class:"modal-overlay",onClick:t[4]||(t[4]=t=>e.$emit("close"))},[o("div",{class:"modal-content",onClick:t[3]||(t[3]=c(()=>{},["stop"]))},[o("div",Dw,[t[6]||(t[6]=o("h3",null,[o("i",{class:"fas fa-table"}),v(" Seleccionar Mesas para Activar ")],-1)),o("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},t[5]||(t[5]=[o("i",{class:"fas fa-times"},null,-1)]))]),o("div",Ow,[h.value?(w(),s("div",Lw,t[7]||(t[7]=[o("div",{class:"spinner"},null,-1),o("p",null,"Cargando mesas disponibles...",-1)]))):(w(),s("div",Mw,[u.value.length>0?(w(),s("div",Uw,[o("strong",null,l(u.value.length)+" mesa(s) seleccionada(s)",1)])):r("",!0),o("div",Fw,[(w(!0),s(_,null,k(p.value,e=>(w(),s("div",{key:e.id,class:C(["table-card",{selected:u.value.includes(e.id)}]),onClick:t=>m(e.id)},[o("div",Bw,[o("input",{type:"checkbox",checked:u.value.includes(e.id),onClick:t[1]||(t[1]=c(()=>{},["stop"])),onChange:t=>m(e.id)},null,40,jw)]),o("div",$w,[o("div",zw,"Mesa "+l(e.number),1),e.name&&e.name!==`Mesa ${e.number}`?(w(),s("div",Vw,l(e.name),1)):r("",!0),o("div",Ww,[e.capacity?(w(),s("span",Hw,[t[8]||(t[8]=o("i",{class:"fas fa-users"},null,-1)),v(" "+l(e.capacity)+" personas ",1)])):r("",!0),e.location?(w(),s("span",Gw,[t[9]||(t[9]=o("i",{class:"fas fa-map-marker-alt"},null,-1)),v(" "+l(e.location),1)])):r("",!0)])])],10,qw))),128)),0===p.value.length?(w(),s("div",Kw,t[10]||(t[10]=[o("i",{class:"fas fa-table"},null,-1),o("p",null,"No hay mesas disponibles para activar",-1),o("small",null,"Todas las mesas ya están asignadas a otros mozos",-1)]))):r("",!0)]),p.value.length>0?(w(),s("div",Jw,[o("button",{onClick:f,class:"quick-btn"},[t[11]||(t[11]=o("i",{class:"fas fa-check-double"},null,-1)),v(" Seleccionar Todas ("+l(p.value.length)+") ",1)]),u.value.length>0?(w(),s("button",{key:0,onClick:b,class:"quick-btn"},t[12]||(t[12]=[o("i",{class:"fas fa-times"},null,-1),v(" Deseleccionar Todas ")]))):r("",!0)])):r("",!0)]))]),o("div",Yw,[o("button",{onClick:t[2]||(t[2]=t=>e.$emit("close")),class:"btn btn-secondary"}," Cancelar "),o("button",{onClick:y,class:"btn btn-primary",disabled:0===u.value.length||h.value},[t[13]||(t[13]=o("i",{class:"fas fa-check"},null,-1)),v(" Activar "+l(u.value.length)+" Mesa(s) ",1)],8,Qw)])])]))}},[["__scopeId","data-v-f6fe2c8a"]]);function Xw(e){const t=lr(),a={id:`staff_join_success_${Date.now()}`,type:"staff_join_success",data:{title:"🎉 ¡Bienvenido al equipo!",message:`Te has unido exitosamente a ${e}`,route:"/waiter/dashboard",business_name:e},created_at:(new Date).toISOString()};return t.addNewNotification(a),a}const ey={class:"sheet-header"},ty={key:0,class:"sheet-title"},ay={key:1,class:"sheet-subtitle"},ny={class:"sheet-body"},iy={__name:"BottomSheet",props:{modelValue:{type:Boolean,default:!1},title:{type:String,default:""},subtitle:{type:String,default:""},sheetClass:{type:[String,Array,Object],default:""}},emits:["update:modelValue","close","after-leave"],setup(e,{emit:t}){const a=e,n=t,i=()=>{n("update:modelValue",!1),n("close")},d=e=>{"Escape"===e.key&&i()};E(()=>a.modelValue,e=>{document.body.style.overflow=e?"hidden":""}),g(()=>window.addEventListener("keydown",d)),I(()=>{window.removeEventListener("keydown",d),document.body.style.overflow=""});const u=()=>{n("after-leave")};return(t,n)=>(w(),S(A,{to:"body"},[h(T,{name:"overlay-fade"},{default:m(()=>[e.modelValue?(w(),s("div",{key:0,class:"sheet-overlay",onClick:c(i,["self"])})):r("",!0)]),_:1}),h(T,{name:"sheet",onAfterLeave:u},{default:m(()=>[e.modelValue?(w(),s("div",{key:0,class:C(["bottom-sheet",a.sheetClass]),role:"dialog","aria-modal":"true"},[o("div",ey,[o("div",null,[e.title?(w(),s("div",ty,l(e.title),1)):r("",!0),e.subtitle?(w(),s("div",ay,l(e.subtitle),1)):r("",!0)]),o("button",{class:"sheet-close",onClick:i,"aria-label":"Cerrar"},n[0]||(n[0]=[o("i",{class:"fas fa-times"},null,-1)]))]),o("div",ny,[N(t.$slots,"default")])],2)):r("",!0)]),_:3})]))}},sy={class:"business-selector"},oy={key:0,class:"business-dropdown"},ry={class:"business-details"},ly={class:"business-name"},cy={class:"business-subtitle"},dy={class:"dropdown-arrow"},uy={class:"mb-3"},hy={class:"bs-list"},py=["onClick"],my={class:"left"},fy={class:"bs-name"},vy={class:"bs-sub"},gy={class:"bs-right"},by={key:1,class:"no-business-state"},wy={class:"no-business-content"},yy={class:"form-group"},_y=["disabled"],ky={class:"d-flex gap-2 justify-content-end"},Cy=["disabled"],Ey=["disabled"],Iy={key:0,class:"fas fa-spinner fa-spin"},Sy={key:1},Ty={__name:"BusinessSelector",emits:["business-changed","businesses-loaded"],setup(e,{expose:t,emit:n}){const i=n,r=a([]),p=a(null),f=a(!1),b=a(!1),y=a(""),E=a(!1),S=a(!1),T=async()=>{S.value=!0;try{const t=await om.getWaiterBusinesses();if(t.success){if(r.value=t.businesses||[],t.active_business_id&&r.value.length>0?p.value=r.value.find(e=>e.id===t.active_business_id)||null:p.value=t.active_business||null,!p.value&&1===r.value.length)try{const e=r.value[0];(await om.setActiveWaiterBusiness(e.id)).success&&(p.value=e)}catch(e){}i("businesses-loaded",{businesses:r.value,activeBusiness:p.value,needsBusiness:!p.value})}else console.error("❌ Error en respuesta de negocios:",t.message),or(t.message||"Error cargando negocios")}catch(t){console.error("💥 Error loading businesses:",t),or("Error cargando negocios")}finally{S.value=!1}},N=async()=>{var e,t,a,n,i,s;if(y.value.trim()){E.value=!0;try{const i=await om.joinBusinessWithCode(y.value.trim());if(i.success){const s=(null==(e=i.business)?void 0:e.name)||(null==(a=null==(t=i.data)?void 0:t.business)?void 0:a.name)||"el negocio";"pending"===(null==(n=i.staff_request)?void 0:n.status)?sr("Solicitud enviada al administrador. Te notificaremos cuando sea aprobada."):(sr(i.message||"Te has unido al negocio exitosamente"),Xw(s)),y.value="",A(),await T()}else or(i.message||"Error uniéndose al negocio")}catch(o){console.error("Error joining business:",o);const e=(null==(s=null==(i=o.response)?void 0:i.data)?void 0:s.message)||o.message||"Error uniéndose al negocio";or(e)}finally{E.value=!1}}},A=()=>{b.value=!1,y.value="",E.value=!1},P=e=>{e.target.closest(".business-dropdown")||(f.value=!1)};return g(async()=>{await T(),document.addEventListener("click",P)}),I(()=>{document.removeEventListener("click",P)}),t({loadBusinesses:T,getCurrentBusiness:()=>p.value}),(e,t)=>{var a;return w(),s("div",sy,[r.value.length>0?(w(),s("div",oy,[o("div",{class:"current-business",onClick:t[0]||(t[0]=e=>f.value=!f.value)},[t[6]||(t[6]=o("div",{class:"business-icon"},[o("i",{class:"fas fa-building"})],-1)),o("div",ry,[o("div",ly,l((null==(a=p.value)?void 0:a.name)||"Seleccionar Negocio"),1),o("div",cy,l(r.value.length)+" negocio"+l(1!==r.value.length?"s":""),1)]),o("div",dy,[o("i",{class:C(["fas fa-chevron-down",{rotated:f.value}])},null,2)])]),h(iy,{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=e=>f.value=e),title:"Seleccionar Negocio",subtitle:"Elige el restaurante donde estás trabajando"},{default:m(()=>[o("div",uy,[o("button",{class:"bs-add-btn",onClick:t[1]||(t[1]=e=>b.value=!0)},"+ Agregar Negocio")]),o("div",hy,[(w(!0),s(_,null,k(r.value,e=>{var a,n;return w(),s("button",{key:e.id,onClick:t=>(async e=>{try{const t=await om.setActiveWaiterBusiness(e.id);t.success?(p.value=e,f.value=!1,sr(`Negocio "${e.name}" seleccionado`),i("business-changed",e)):or(t.message||"Error seleccionando negocio")}catch(t){console.error("Error selecting business:",t),or("Error seleccionando negocio")}})(e),class:C(["bs-item",{active:(null==(a=p.value)?void 0:a.id)===e.id}])},[o("div",my,[t[7]||(t[7]=o("div",{class:"bs-ico"},[o("i",{class:"fas fa-building"})],-1)),o("div",null,[o("div",fy,l(e.name),1),o("div",vy,l(e.type||"Fast Food")+" • "+l(e.address||"Sin dirección"),1)])]),o("div",gy,[o("i",{class:C(["fas",(null==(n=p.value)?void 0:n.id)===e.id?"fa-check":"fa-chevron-right"])},null,2)])],10,py)}),128))])]),_:1},8,["modelValue"])])):(w(),s("div",by,[o("div",wy,[t[9]||(t[9]=o("i",{class:"fas fa-building"},null,-1)),t[10]||(t[10]=o("h3",null,"Sin negocios asignados",-1)),t[11]||(t[11]=o("p",null,"Necesitas unirte a un negocio para empezar a trabajar",-1)),o("button",{onClick:t[3]||(t[3]=e=>b.value=!0),class:"join-btn primary"},t[8]||(t[8]=[o("i",{class:"fas fa-plus"},null,-1),v(" Unirse a negocio ")]))])])),h(iy,{modelValue:b.value,"onUpdate:modelValue":t[5]||(t[5]=e=>b.value=e),title:"Unirse a negocio",subtitle:"Ingresa el código del negocio"},{default:m(()=>[o("form",{onSubmit:c(N,["prevent"])},[o("div",yy,[t[12]||(t[12]=o("label",{for:"businessCode"},"Código del negocio",-1)),d(o("input",{id:"businessCode","onUpdate:modelValue":t[4]||(t[4]=e=>y.value=e),type:"text",class:"form-input",placeholder:"Ej: ABC123",disabled:E.value,required:""},null,8,_y),[[u,y.value]])]),o("div",ky,[o("button",{type:"button",onClick:A,class:"btn btn-secondary",disabled:E.value},"Cancelar",8,Cy),o("button",{type:"submit",class:"btn btn-primary",disabled:E.value||!y.value.trim()},[E.value?(w(),s("i",Iy)):(w(),s("span",Sy,"Unirse"))],8,Ey)])],32)]),_:1},8,["modelValue"])])}}},Ny=Mh(Ty,[["__scopeId","data-v-3fba45b9"]]),Ay={class:"business-tables-manager"},Py={class:"manager-header"},Ry={class:"manager-stats"},xy={class:"stat-item"},Dy={class:"stat-number"},Oy={class:"stat-item success"},Ly={class:"stat-number"},My={class:"stat-item warning"},Uy={class:"stat-number"},Fy={class:"stat-item danger"},qy={class:"stat-number"},By={class:"tables-container"},jy={key:0,class:"loading-state"},$y={key:1,class:"tables-grid"},zy={class:"table-header"},Vy={class:"table-number"},Wy={class:"table-status"},Hy={key:0,class:"fas fa-exclamation-triangle status-icon urgent",title:"Tiene llamadas pendientes"},Gy={key:1,class:"fas fa-volume-mute status-icon silenced",title:"Silenciada"},Ky={key:2,class:"fas fa-check status-icon active",title:"Activa y asignada"},Jy={key:3,class:"fas fa-ban status-icon silenced",title:"Mesa silenciada"},Yy={key:4,class:"fas fa-circle status-icon available",title:"Disponible"},Qy={class:"table-info"},Zy={key:0,class:"table-name"},Xy={class:"table-details"},e_={key:0},t_={key:1},a_={key:1,class:"assigned-waiter"},n_={class:"table-actions"},i_=["onClick"],s_=["onClick"],o_=["onClick"],r_=["onClick"],l_={key:2,class:"no-actions"},c_={key:0},d_={key:1},u_={key:0,class:"empty-state"},h_={class:"quick-actions"},p_=["disabled"],m_={__name:"BusinessTablesManager",props:{businessId:{type:[String,Number],required:!0},businessName:{type:String,default:"Negocio"}},emits:["tables-updated"],setup(e,{expose:t,emit:i}){const c=e,d=i,u=a([]),h=a(!1),p=n(()=>u.value.length),m=n(()=>u.value.filter(e=>e.assigned_to_me).length),f=n(()=>u.value.filter(e=>!e.assigned_to_me&&!e.is_silenced).length),b=n(()=>u.value.filter(e=>e.is_silenced).length),y=n(()=>u.value.filter(e=>e.assigned_to_me)),E=n(()=>u.value.filter(e=>!e.assigned_to_me&&!e.is_silenced)),I=async()=>{h.value=!0,console.log("🏢 Cargando mesas del negocio:",c.businessId);try{const e=await om.getWaiterBusinessTables(c.businessId);console.log("📋 Respuesta de mesas del negocio:",e),e.success?(u.value=e.tables||[],console.log("✅ Mesas cargadas:",u.value.length,u.value),u.value.forEach((e,t)=>{t<3&&console.log(`🔍 Mesa ${e.number}:`,{id:e.id,assigned_to_me:e.assigned_to_me,is_silenced:e.is_silenced,assigned_waiter:e.assigned_waiter})}),console.log("📊 Estadísticas calculadas:"),console.log("  - Total mesas:",u.value.length),console.log("  - Asignadas a mí:",u.value.filter(e=>e.assigned_to_me).length),console.log("  - Disponibles:",u.value.filter(e=>!e.assigned_to_me&&!e.is_silenced).length),console.log("  - Silenciadas:",u.value.filter(e=>e.is_silenced).length),d("tables-updated",u.value)):(console.error("❌ Error en respuesta:",e.message),or(e.message||"Error cargando mesas del negocio"))}catch(e){console.error("💥 Error loading business tables:",e),or("Error cargando mesas del negocio")}finally{h.value=!1}},S=async()=>{await I()},T=async()=>{var e;const t=E.value;if(0!==t.length)try{if(await rr("¿Tomar todas las mesas disponibles?",`Se asignarán ${t.length} mesas a tu cuenta.`,"Tomar todas","Cancelar","info")){const a=t.map(e=>e.id),n=await om.activateMultipleTables(a);n.success?(sr(`${(null==(e=n.summary)?void 0:e.successful)||t.length} mesas asignadas`),await I()):or(n.message||"Error asignando mesas")}}catch(a){console.error("Error activating multiple tables:",a),or("Error asignando mesas múltiples")}},N=async()=>{var e;const t=y.value;if(0!==t.length)try{if(await rr("¿Desasignarte de todas las mesas?",`Se desasignarán ${t.length} mesas de tu cuenta.`,"Desasignar todas","Cancelar","warning")){const a=t.map(e=>e.id),n=await om.deactivateMultipleTables(a);n.success?(sr(`${(null==(e=n.summary)?void 0:e.successful)||t.length} mesas desasignadas`),await I()):or(n.message||"Error desasignando mesas")}}catch(a){console.error("Error deactivating multiple tables:",a),or("Error desasignando mesas múltiples")}};return g(()=>{console.log("🏢 BusinessTablesManager mounted with businessId:",c.businessId),I()}),t({loadBusinessTables:I,refreshTables:S}),(t,a)=>(w(),s("div",Ay,[o("div",Py,[o("h3",null,[a[0]||(a[0]=o("i",{class:"fas fa-table"},null,-1)),v(" Mesas de "+l(e.businessName),1)]),o("div",Ry,[o("div",xy,[o("div",Dy,l(p.value),1),a[1]||(a[1]=o("div",{class:"stat-label"},"Total mesas",-1))]),o("div",Oy,[o("div",Ly,l(m.value),1),a[2]||(a[2]=o("div",{class:"stat-label"},"Asignadas a mí",-1))]),o("div",My,[o("div",Uy,l(f.value),1),a[3]||(a[3]=o("div",{class:"stat-label"},"Disponibles",-1))]),o("div",Fy,[o("div",qy,l(b.value),1),a[4]||(a[4]=o("div",{class:"stat-label"},"Silenciadas",-1))])])]),o("div",By,[h.value?(w(),s("div",jy,a[5]||(a[5]=[o("div",{class:"spinner"},null,-1),o("p",null,"Cargando mesas del negocio...",-1)]))):(w(),s("div",$y,[(w(!0),s(_,null,k(u.value,e=>(w(),s("div",{key:e.id,class:C(["table-card",{assigned:e.assigned_to_me,available:!e.assigned_to_me&&!e.is_silenced,silenced:e.is_silenced,"has-calls":e.pending_calls_count>0}])},[o("div",zy,[o("div",Vy,"Mesa "+l(e.number),1),o("div",Wy,[e.assigned_to_me&&e.pending_calls_count>0?(w(),s("i",Hy)):e.assigned_to_me&&e.is_silenced?(w(),s("i",Gy)):e.assigned_to_me?(w(),s("i",Ky)):e.is_silenced?(w(),s("i",Jy)):(w(),s("i",Yy))])]),o("div",Qy,[e.name&&e.name!==`Mesa ${e.number}`?(w(),s("div",Zy,l(e.name),1)):r("",!0),o("div",Xy,[e.capacity?(w(),s("span",e_,[a[6]||(a[6]=o("i",{class:"fas fa-users"},null,-1)),v(" "+l(e.capacity)+" personas ",1)])):r("",!0),e.pending_calls_count>0?(w(),s("span",t_,[a[7]||(a[7]=o("i",{class:"fas fa-bell"},null,-1)),v(" "+l(e.pending_calls_count)+" llamada(s) ",1)])):r("",!0)]),e.assigned_waiter&&!e.assigned_to_me?(w(),s("div",a_,[a[8]||(a[8]=o("i",{class:"fas fa-user"},null,-1)),v(" Asignada a: "+l(e.assigned_waiter.name),1)])):r("",!0)]),o("div",n_,[e.assigned_to_me?(w(),s(_,{key:0},[e.is_silenced?(w(),s("button",{key:0,onClick:t=>(async e=>{try{const t=await om.unsilenceTable(e);t.success?(sr(t.message||"Mesa activada"),await I()):or(t.message||"Error activando mesa")}catch(t){console.error("Error unsilencing table:",t),or("Error activando mesa")}})(e.id),class:"action-btn unsilence",title:"Activar mesa"},a[9]||(a[9]=[o("i",{class:"fas fa-volume-up"},null,-1)]),8,i_)):(w(),s("button",{key:1,onClick:t=>(async e=>{try{if(await rr("¿Silenciar mesa?","La mesa no podrá realizar llamadas durante 30 minutos.","Silenciar","Cancelar","warning")){const t=await om.silenceTable(e,30);t.success?(sr(t.message||"Mesa silenciada"),await I()):or(t.message||"Error silenciando mesa")}}catch(t){console.error("Error silencing table:",t),or("Error silenciando mesa")}})(e.id),class:"action-btn silence",title:"Silenciar mesa"},a[10]||(a[10]=[o("i",{class:"fas fa-volume-mute"},null,-1)]),8,s_)),o("button",{onClick:t=>(async e=>{try{if(await rr("¿Desasignarte de esta mesa?","Ya no recibirás llamadas de esta mesa.","Desasignar","Cancelar","warning")){const t=await om.deactivateTable(e);t.success?(sr(t.message||"Mesa desasignada"),await I()):or(t.message||"Error desasignando mesa")}}catch(t){console.error("Error deactivating table:",t),or("Error desasignando mesa")}})(e.id),class:"action-btn deactivate",title:"Desasignarme de esta mesa"},a[11]||(a[11]=[o("i",{class:"fas fa-times"},null,-1)]),8,o_)],64)):e.is_silenced?(w(),s("div",l_,[e.is_silenced?(w(),s("span",c_,"Mesa silenciada")):(w(),s("span",d_,"No disponible"))])):(w(),s("button",{key:1,onClick:t=>(async e=>{console.log("🚀 BusinessTablesManager: Iniciando activación de mesa:",e);try{const t=await om.activateTable(e);console.log("📊 BusinessTablesManager: Respuesta de activación:",t),t.success?(console.log("✅ BusinessTablesManager: Mesa activada exitosamente"),sr(t.message||"Mesa activada"),console.log("🔄 BusinessTablesManager: Recargando mesas del negocio..."),await I()):(console.error("❌ BusinessTablesManager: Error en respuesta:",t.message),or(t.message||"Error activando mesa"))}catch(t){console.error("💥 BusinessTablesManager: Error completo activando mesa:",t),or("Error activando mesa")}})(e.id),class:"action-btn activate",title:"Asignarme esta mesa"},a[12]||(a[12]=[o("i",{class:"fas fa-plus"},null,-1),v(" Tomar ")]),8,r_))])],2))),128)),0===u.value.length?(w(),s("div",u_,a[13]||(a[13]=[o("i",{class:"fas fa-table"},null,-1),o("h4",null,"Sin mesas registradas",-1),o("p",null,"Este negocio no tiene mesas registradas aún.",-1)]))):r("",!0)]))]),o("div",h_,[o("button",{onClick:S,class:"action-btn primary",disabled:h.value},[o("i",{class:C(["fas fa-sync-alt",{"fa-spin":h.value}])},null,2),a[14]||(a[14]=v(" Actualizar "))],8,p_),y.value.length>0?(w(),s("button",{key:0,onClick:N,class:"action-btn danger"},[a[15]||(a[15]=o("i",{class:"fas fa-sign-out-alt"},null,-1)),v(" Desasignarme de todas ("+l(y.value.length)+") ",1)])):r("",!0),E.value.length>0?(w(),s("button",{key:1,onClick:T,class:"action-btn success"},[a[16]||(a[16]=o("i",{class:"fas fa-check-double"},null,-1)),v(" Tomar todas disponibles ("+l(E.value.length)+") ",1)])):r("",!0)])]))}},f_=Mh(m_,[["__scopeId","data-v-0cdb7b2a"]]),v_={class:"table-profiles-manager"},g_={class:"profiles-header"},b_={key:0,class:"profiles-list"},w_={class:"profile-header"},y_={class:"profile-info"},__={class:"profile-name"},k_={key:0,class:"active-badge"},C_={class:"profile-meta"},E_={class:"table-count"},I_={class:"created-date"},S_={class:"profile-actions"},T_=["onClick","disabled"],N_=["onClick","disabled"],A_=["onClick"],P_=["onClick"],R_={class:"profile-tables"},x_={class:"tables-list"},D_={key:0,class:"fas fa-exclamation-triangle",title:"En conflicto con otro mozo"},O_={key:0,class:"conflict-info"},L_={key:1,class:"activation-summary"},M_={key:0,class:"summary-item success"},U_={key:1,class:"summary-item info"},F_={key:2,class:"summary-item warning"},q_={key:0,class:"empty-state"},B_={key:1,class:"loading-state"},j_={class:"modal-content"},$_={class:"modal-header"},z_={class:"modal-body"},V_={class:"pm-field"},W_={class:"pm-field"},H_={class:"pm-label"},G_={class:"pm-chip"},K_={class:"pm-section-title"},J_={class:"pm-options"},Y_=["value","disabled"],Q_={class:"pm-option-text"},Z_={key:0},X_={class:"pm-actions"},ek=["disabled"],tk={key:0,class:"fas fa-spinner fa-spin"},ak={key:1,class:"fas fa-check"},nk={__name:"TableProfilesManager",props:{businessId:{type:Number,required:!0},availableTables:{type:Array,default:()=>[]},assignedTables:{type:Array,default:()=>[]}},emits:["profiles-updated"],setup(e,{emit:t}){const a=e,i=t,h=P({profiles:[],loading:!1,processing:null,saving:!1,showCreateModal:!1,editingProfile:null,formData:{name:"",table_ids:[]}}),m=n(()=>h.profiles),f=n(()=>h.loading),b=n(()=>h.processing),y=n(()=>h.saving),E=n({get:()=>h.showCreateModal,set:e=>h.showCreateModal=e}),I=n(()=>h.editingProfile),T=n(()=>h.formData),N=n(()=>[...a.availableTables,...a.assignedTables].map(e=>({...e,is_assigned_to_me:a.assignedTables.some(t=>t.id===e.id),is_assigned_to_other:e.assigned_waiter&&"Tú"!==e.assigned_waiter,assigned_waiter:e.assigned_waiter||"Disponible"}))),R=n(()=>{const e=[{key:"terraza",title:"Terraza",items:[]},{key:"interior",title:"Interior",items:[]},{key:"vip",title:"VIP",items:[]},{key:"barra",title:"Barra",items:[]}],t={key:"otras",title:"Otras",items:[]},a=N.value;for(const i of a){const a=(i.name||"").toLowerCase();a.includes("terraza")||a.includes("exterior")?e[0].items.push(i):a.includes("interior")?e[1].items.push(i):a.includes("vip")?e[2].items.push(i):a.includes("barra")||a.includes("bar")?e[3].items.push(i):t.items.push(i)}const n=[...e,t].filter(e=>e.items.length>0);for(const i of n)i.items.sort((e,t)=>(e.number||0)-(t.number||0));return n}),x=async()=>{h.loading=!0;try{const e=await ga.getWaiterTableProfiles();e.data.success?(h.profiles=e.data.profiles||[],console.log("✅ Perfiles cargados:",h.profiles.length)):or(e.data.message||"Error cargando perfiles")}catch(e){console.error("Error loading profiles:",e),or("Error cargando perfiles")}finally{h.loading=!1}},D=async()=>{if(h.formData.name.trim()&&0!==h.formData.table_ids.length){h.saving=!0;try{const e={name:h.formData.name.trim(),table_ids:h.formData.table_ids};let t;t=h.editingProfile?await ga.updateWaiterTableProfile(h.editingProfile.id,e):await ga.createWaiterTableProfile(e),t.data.success?(sr(t.data.message||`Perfil ${h.editingProfile?"actualizado":"creado"} correctamente`),O(),await x(),i("profiles-updated")):or(t.data.message||`Error ${h.editingProfile?"actualizando":"creando"} perfil`)}catch(e){console.error("Error saving profile:",e),or(`Error ${h.editingProfile?"actualizando":"creando"} perfil`)}finally{h.saving=!1}}else or("Completa todos los campos requeridos")},O=()=>{h.showCreateModal=!1,h.editingProfile=null,h.formData={name:"",table_ids:[]}},L=e=>a.assignedTables.some(t=>t.number===e),M=e=>{if(!e)return"";return new Date(e).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})};return g(async()=>{console.log("🏠 TableProfilesManager mounted"),await x()}),(e,t)=>(w(),s("div",v_,[o("div",g_,[t[5]||(t[5]=o("div",{class:"header-info"},[o("h3",null,[o("i",{class:"fas fa-bookmark"}),v(" Mis Perfiles de Mesa ")]),o("p",{class:"header-description"}," Crea perfiles con conjuntos de mesas para activar rápidamente ")],-1)),o("button",{onClick:t[0]||(t[0]=e=>E.value=!0),class:"btn btn-primary"},t[4]||(t[4]=[o("i",{class:"fas fa-plus"},null,-1),v(" Crear Perfil ")]))]),f.value?r("",!0):(w(),s("div",b_,[(w(!0),s(_,null,k(m.value,e=>{var a,n,c;return w(),s("div",{key:e.id,class:C(["profile-card",{active:e.is_active,"has-conflicts":(null==(a=e.conflict_tables)?void 0:a.length)>0}])},[o("div",w_,[o("div",y_,[o("h4",__,[v(l(e.name)+" ",1),e.is_active?(w(),s("span",k_,"ACTIVO")):r("",!0)]),o("div",C_,[o("span",E_,[t[6]||(t[6]=o("i",{class:"fas fa-table"},null,-1)),v(" "+l((null==(n=e.table_numbers)?void 0:n.length)||0)+" mesas ",1)]),o("span",I_," Creado "+l(M(e.created_at)),1)])]),o("div",S_,[e.is_active?r("",!0):(w(),s("button",{key:0,onClick:t=>(async e=>{h.processing=e;try{const t=await ga.activateWaiterTableProfile(e);t.data.success?(sr(t.data.message||"Perfil activado"),await x(),i("profiles-updated")):or(t.data.message||"Error activando perfil")}catch(t){console.error("Error activating profile:",t),or("Error activando perfil")}finally{h.processing=null}})(e.id),class:"action-btn activate",disabled:b.value===e.id,title:"Activar perfil"},t[7]||(t[7]=[o("i",{class:"fas fa-play"},null,-1)]),8,T_)),e.is_active?(w(),s("button",{key:1,onClick:t=>(async e=>{if(await rr("¿Desactivar perfil?","Se desasignarán todas las mesas de este perfil.","Desactivar","Cancelar","warning")){h.processing=e;try{const t=await ga.deactivateWaiterTableProfile(e);t.data.success?(sr(t.data.message||"Perfil desactivado"),await x(),i("profiles-updated")):or(t.data.message||"Error desactivando perfil")}catch(t){console.error("Error deactivating profile:",t),or("Error desactivando perfil")}finally{h.processing=null}}})(e.id),class:"action-btn deactivate",disabled:b.value===e.id,title:"Desactivar perfil"},t[8]||(t[8]=[o("i",{class:"fas fa-pause"},null,-1)]),8,N_)):r("",!0),o("button",{onClick:t=>(e=>{h.editingProfile=e,h.formData={name:e.name,table_ids:[...e.table_ids||[]]},h.showCreateModal=!1})(e),class:"action-btn edit",title:"Editar perfil"},t[9]||(t[9]=[o("i",{class:"fas fa-edit"},null,-1)]),8,A_),o("button",{onClick:t=>(async(e,t)=>{if(await rr(`¿Eliminar perfil "${t}"?`,"Esta acción no se puede deshacer.","Eliminar","Cancelar","danger"))try{const t=await ga.deleteWaiterTableProfile(e);t.data.success?(sr(t.data.message||"Perfil eliminado"),await x(),i("profiles-updated")):or(t.data.message||"Error eliminando perfil")}catch(a){console.error("Error deleting profile:",a),or("Error eliminando perfil")}})(e.id,e.name),class:"action-btn delete",title:"Eliminar perfil"},t[10]||(t[10]=[o("i",{class:"fas fa-trash"},null,-1)]),8,P_)])]),o("div",R_,[o("div",x_,[(w(!0),s(_,null,k(e.table_numbers,t=>{var a,n;return w(),s("span",{key:t,class:C(["table-tag",{conflict:null==(a=e.conflict_tables)?void 0:a.includes(t),assigned:L(t)}])},[v(" Mesa "+l(t)+" ",1),(null==(n=e.conflict_tables)?void 0:n.includes(t))?(w(),s("i",D_)):r("",!0)],2)}),128))])]),(null==(c=e.conflict_tables)?void 0:c.length)>0?(w(),s("div",O_,[t[11]||(t[11]=o("i",{class:"fas fa-exclamation-triangle"},null,-1)),o("span",null,l(e.conflict_tables.length)+" mesa(s) en conflicto con otros mozos",1)])):r("",!0),e.is_active&&e.activation_summary?(w(),s("div",L_,[e.activation_summary.activated>0?(w(),s("div",M_,[t[12]||(t[12]=o("i",{class:"fas fa-check"},null,-1)),v(" "+l(e.activation_summary.activated)+" activadas ",1)])):r("",!0),e.activation_summary.already_yours>0?(w(),s("div",U_,[t[13]||(t[13]=o("i",{class:"fas fa-user-check"},null,-1)),v(" "+l(e.activation_summary.already_yours)+" ya eran tuyas ",1)])):r("",!0),e.activation_summary.conflicts>0?(w(),s("div",F_,[t[14]||(t[14]=o("i",{class:"fas fa-exclamation-triangle"},null,-1)),v(" "+l(e.activation_summary.conflicts)+" en conflicto ",1)])):r("",!0)])):r("",!0)],2)}),128)),0===m.value.length?(w(),s("div",q_,[t[16]||(t[16]=o("i",{class:"fas fa-bookmark"},null,-1)),t[17]||(t[17]=o("h4",null,"No tienes perfiles creados",-1)),t[18]||(t[18]=o("p",null,"Crea tu primer perfil para agrupar mesas que usas frecuentemente",-1)),o("button",{onClick:t[1]||(t[1]=e=>E.value=!0),class:"btn btn-primary"},t[15]||(t[15]=[o("i",{class:"fas fa-plus"},null,-1),v(" Crear Primer Perfil ")]))])):r("",!0)])),f.value?(w(),s("div",B_,t[19]||(t[19]=[o("i",{class:"fas fa-spinner fa-spin"},null,-1),o("p",null,"Cargando perfiles...",-1)]))):r("",!0),(w(),S(A,{to:"body"},[E.value||I.value?(w(),s("div",{key:0,class:"pm-overlay",onClick:c(O,["self"])},[o("div",j_,[o("div",$_,[o("h3",null,[t[20]||(t[20]=o("i",{class:"fas fa-map-marker-alt pm-icon"},null,-1)),v(" "+l(I.value?"Editar Perfil de Mesas":"Agregar Perfil de Mesas"),1)]),o("button",{onClick:O,class:"close-btn"},t[21]||(t[21]=[o("i",{class:"fas fa-times"},null,-1)]))]),o("div",z_,[o("form",{onSubmit:c(D,["prevent"])},[o("div",V_,[t[22]||(t[22]=o("div",{class:"pm-label"},"Nombre del Perfil *",-1)),d(o("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>T.value.name=e),class:"pm-input",type:"text",placeholder:"ej. Mesas Exteriores",maxlength:"50",required:""},null,512),[[u,T.value.name]])]),t[25]||(t[25]=o("div",{class:"pm-field"},[o("div",{class:"pm-label"},"Descripción"),o("input",{class:"pm-input",type:"text",placeholder:"ej. Terraza y área al aire libre"})],-1)),o("div",W_,[o("div",H_,[t[23]||(t[23]=o("span",null,"Seleccionar Mesas *",-1)),o("span",G_,l(T.value.table_ids.length)+" seleccionadas",1)]),(w(!0),s(_,null,k(R.value,e=>(w(),s("div",{class:"pm-section",key:e.title},[o("div",K_,l(e.title),1),o("div",J_,[(w(!0),s(_,null,k(e.items,e=>(w(),s("label",{key:e.id,class:"pm-option"},[d(o("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":t[3]||(t[3]=e=>T.value.table_ids=e),disabled:T.value.table_ids.length>=20&&!T.value.table_ids.includes(e.id)},null,8,Y_),[[p,T.value.table_ids]]),o("div",Q_,[v("Mesa "+l(e.number),1),e.capacity?(w(),s("span",Z_," ("+l(e.capacity)+"p)",1)):r("",!0)])]))),128))])]))),128))]),o("div",X_,[o("button",{type:"button",class:"btn-cancel",onClick:O},t[24]||(t[24]=[o("i",{class:"fas fa-times"},null,-1),v(" Cancelar ")])),o("button",{type:"submit",class:"btn-primary",disabled:!T.value.name.trim()||0===T.value.table_ids.length||y.value},[y.value?(w(),s("i",tk)):(w(),s("i",ak)),v(" "+l(I.value?"Actualizar Perfil":"Crear Perfil"),1)],8,ek)])],32)])])])):r("",!0)]))]))}},ik=Mh(nk,[["__scopeId","data-v-1cb639b5"]]),sk={class:"pm-modal"},ok={class:"pm-header"},rk={class:"pm-title"},lk={key:0},ck={class:"pm-search"},dk={class:"pm-view-switch"},uk={class:"pm-filters"},hk={class:"pm-filter"},pk={key:0,class:"pm-filter-menu"},mk=["onClick"],fk={class:"pm-filter"},vk={key:0,class:"pm-filter-menu"},gk=["onClick"],bk={class:"pm-filter"},wk={key:0,class:"pm-filter-menu"},yk=["onClick"],_k={class:"pm-filter-actions"},kk={key:0,class:"pm-chip info"},Ck={key:1,class:"pm-chip danger"},Ek={key:2,class:"pm-chip primary"},Ik={key:3,class:"pm-chip muted"},Sk={key:0,class:"at-list"},Tk={class:"left"},Nk={class:"at-title"},Ak={class:"at-meta"},Pk={class:"at-zone"},Rk={class:"at-capacity"},xk={class:"right"},Dk=["onClick"],Ok=["onClick"],Lk=["onClick"],Mk=["onClick"],Uk={key:1,class:"at-grid"},Fk=["onClick"],qk={class:"at-card-title"},Bk={class:"at-card-meta"},jk={key:0,class:"at-card-badge"},$k={class:"pm-actions"},zk={__name:"AllTablesModal",props:{title:{type:String,default:""},tables:{type:Array,default:()=>[]},assignedIds:{type:Array,default:()=>[]},silencedIds:{type:Array,default:()=>[]},pendingByTableId:{type:Object,default:()=>({})}},emits:["close","assign","unassign","silence","unsilence"],setup(e,{emit:t}){const i=e,h=a(""),p=a("list"),m=P({status:!1,zone:!1,sort:!1}),f=a("all"),g=a("all"),b=a("number"),y=[{value:"all",label:"Todos los estados"},{value:"available",label:"Disponibles"},{value:"assigned",label:"Asignadas"},{value:"calling",label:"Llamando"},{value:"silenced",label:"Silenciadas"}],E=[{value:"number",label:"Número"},{value:"zone",label:"Zona"}],I=n(()=>{const e=new Set;return i.tables.forEach(t=>e.add(j(t))),Array.from(e).filter(Boolean)}),T=n(()=>[{value:"all",label:"Todas"},...I.value.map(e=>({value:e,label:e}))]),N=n(()=>{var e;return(null==(e=y.find(e=>e.value===f.value))?void 0:e.label)||"Estados"}),R=n(()=>{var e;return(null==(e=E.find(e=>e.value===b.value))?void 0:e.label)||"Orden"}),x=n(()=>{var e;return(null==(e=T.value.find(e=>e.value===g.value))?void 0:e.label)||"Zonas"}),D=n(()=>new Set(i.assignedIds)),O=n(()=>new Set(i.silencedIds));function L(e){return D.value.has(e.id)}function M(e){return O.value.has(e.id)}function U(e){var t;return((null==(t=i.pendingByTableId)?void 0:t[e.id])||0)>0}function F(e){return U(e)?"Llamando":M(e)?"Silenciada":L(e)?"Asignada":"Disponible"}function q(e){const t=F(e);return{warning:"Llamando"===t,danger:"Urgente"===t,muted:"Silenciada"===t,primary:"Asignada"===t}}function B(e){const t=F(e);return{"is-calling":"Llamando"===t,"is-silenced":"Silenciada"===t}}function j(e){return e.zone_name||e.section||e.zone||"Zona Principal"}function $(e){return e.capacity||e.seats||e.people||4}const z=n(()=>{let e=i.tables;const t=h.value.trim().toLowerCase();return t&&(e=e.filter(e=>{const a=String(e.number||e.name||e.id).toLowerCase(),n=String(j(e)).toLowerCase();return a.includes(t)||n.includes(t)})),"all"!==f.value&&(e=e.filter(e=>{const t=F(e);return"available"===f.value&&"Disponible"===t||"assigned"===f.value&&"Asignada"===t||"calling"===f.value&&"Llamando"===t||"silenced"===f.value&&"Silenciada"===t})),"all"!==g.value&&(e=e.filter(e=>j(e)===g.value)),e=[...e],"number"===b.value?e.sort((e,t)=>(e.number||0)-(t.number||0)):"zone"===b.value&&e.sort((e,t)=>j(e).localeCompare(j(t))),e}),V=n(()=>({total:i.tables.length,calling:z.value.filter(e=>U(e)).length,assigned:z.value.filter(e=>L(e)).length,silenced:z.value.filter(e=>M(e)).length})),W=n(()=>h.value||"all"!==f.value||"all"!==g.value||"number"!==b.value);function H(){h.value="",f.value="all",g.value="all",b.value="number"}function G(e){m[e]=!m[e]}return(t,a)=>(w(),S(A,{to:"body"},[o("div",{class:"pm-overlay",onClick:a[8]||(a[8]=c(e=>t.$emit("close"),["self"]))},[o("div",sk,[o("div",ok,[o("div",rk,[a[10]||(a[10]=o("i",{class:"bi bi-grid-3x3-gap-fill pm-icon"},null,-1)),o("span",null,[a[9]||(a[9]=v("Todas las Mesas")),e.title?(w(),s("span",lk," - "+l(e.title),1)):r("",!0)])]),o("button",{class:"pm-close",onClick:a[0]||(a[0]=e=>t.$emit("close")),"aria-label":"Cerrar"},a[11]||(a[11]=[o("i",{class:"bi bi-x-lg"},null,-1)]))]),o("div",ck,[a[14]||(a[14]=o("i",{class:"bi bi-search"},null,-1)),d(o("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>h.value=e),class:"pm-input",type:"text",placeholder:"Buscar por número o zona..."},null,512),[[u,h.value]]),o("div",dk,[o("button",{class:C(["pm-icon-btn",{active:"grid"===p.value}]),onClick:a[2]||(a[2]=e=>p.value="grid")},a[12]||(a[12]=[o("i",{class:"bi bi-grid-fill"},null,-1)]),2),o("button",{class:C(["pm-icon-btn",{active:"list"===p.value}]),onClick:a[3]||(a[3]=e=>p.value="list")},a[13]||(a[13]=[o("i",{class:"bi bi-list-ul"},null,-1)]),2)])]),o("div",uk,[o("div",hk,[o("button",{class:"pm-filter-btn",onClick:a[4]||(a[4]=e=>G("status"))},[a[15]||(a[15]=o("i",{class:"bi bi-funnel"},null,-1)),v(" "+l(N.value)+" ",1),a[16]||(a[16]=o("i",{class:"bi bi-chevron-down"},null,-1))]),m.status?(w(),s("div",pk,[(w(),s(_,null,k(y,e=>o("button",{key:e.value,class:C(["pm-filter-opt",{active:f.value===e.value}]),onClick:t=>{return a=e.value,f.value=a,void(m.status=!1);var a}},l(e.label),11,mk)),64))])):r("",!0)]),o("div",fk,[o("button",{class:"pm-filter-btn",onClick:a[5]||(a[5]=e=>G("zone"))},[v(l(x.value)+" ",1),a[17]||(a[17]=o("i",{class:"bi bi-chevron-down"},null,-1))]),m.zone?(w(),s("div",vk,[(w(!0),s(_,null,k(T.value,e=>(w(),s("button",{key:e.value,class:C(["pm-filter-opt",{active:g.value===e.value}]),onClick:t=>{return a=e.value,g.value=a,void(m.zone=!1);var a}},l(e.label),11,gk))),128))])):r("",!0)]),o("div",bk,[o("button",{class:"pm-filter-btn",onClick:a[6]||(a[6]=e=>G("sort"))},[a[18]||(a[18]=o("i",{class:"bi bi-sort-down-alt"},null,-1)),v(" "+l(R.value)+" ",1),a[19]||(a[19]=o("i",{class:"bi bi-chevron-down"},null,-1))]),m.sort?(w(),s("div",wk,[(w(),s(_,null,k(E,e=>o("button",{key:e.value,class:C(["pm-filter-opt",{active:b.value===e.value}]),onClick:t=>{return a=e.value,b.value=a,void(m.sort=!1);var a}},l(e.label),11,yk)),64))])):r("",!0)]),o("div",_k,[V.value.total?(w(),s("button",kk,l(V.value.total)+" mesas",1)):r("",!0),V.value.calling?(w(),s("button",Ck,l(V.value.calling)+" notificaciones",1)):r("",!0),V.value.assigned?(w(),s("button",Ek,l(V.value.assigned)+" asignadas",1)):r("",!0),V.value.silenced?(w(),s("button",Ik,l(V.value.silenced)+" silenciadas",1)):r("",!0),W.value?(w(),s("button",{key:4,class:"pm-clear",onClick:H},a[20]||(a[20]=[o("i",{class:"bi bi-eraser"},null,-1),v(" Limpiar filtros ")]))):r("",!0)])]),"list"===p.value?(w(),s("div",Sk,[(w(!0),s(_,null,k(z.value,e=>(w(),s("div",{key:e.id,class:C(["at-item",B(e)])},[o("div",Tk,[o("div",Nk,"Mesa "+l(e.number||e.name||e.id),1),o("div",Ak,[o("span",Pk,[a[21]||(a[21]=o("i",{class:"bi bi-people"},null,-1)),v(" "+l(j(e)),1)]),"Disponible"!==F(e)?(w(),s("span",{key:0,class:C(["at-badge",q(e)])},l(F(e)),3)):r("",!0),o("span",Rk,l($(e))+" pers.",1)])]),o("div",xk,[L(e)?(w(),s("button",{key:0,class:"pm-btn primary",onClick:a=>t.$emit("unassign",e.id)},"Desasignar",8,Dk)):(w(),s("button",{key:1,class:"pm-btn outline",onClick:a=>t.$emit("assign",e.id)},"Asignar",8,Ok)),M(e)?(w(),s("button",{key:2,class:"pm-link",onClick:a=>t.$emit("unsilence",e.id)},"Activar",8,Lk)):(w(),s("button",{key:3,class:"pm-link",onClick:a=>t.$emit("silence",e.id)},"Silenciar",8,Mk))])],2))),128))])):(w(),s("div",Uk,[(w(!0),s(_,null,k(z.value,e=>(w(),s("button",{key:e.id,class:C(["at-card",q(e)]),onClick:a=>t.$emit(L(e)?"unassign":"assign",e.id)},[o("div",qk,l(e.number||e.name||e.id),1),o("div",Bk,l(j(e))+" • "+l($(e))+"p",1),"Disponible"!==F(e)?(w(),s("div",jk,l(F(e)),1)):r("",!0)],10,Fk))),128))])),o("div",$k,[o("button",{class:"pm-btn outline",onClick:a[7]||(a[7]=e=>t.$emit("close"))},"Cerrar")])])])]))}},Vk={class:"waiter-dashboard-root waiter-dashboard-page container"},Wk={class:"dashboard-content row"},Hk={class:"header-user pt-0 col-12 px-0"},Gk={class:"user-avatar"},Kk={class:"user-info"},Jk={class:"user-name"},Yk={class:"user-time"},Qk={class:"notification-badge"},Zk={class:"dropdown-cards col-12 d-flex justify-content-center align-items-center px-0"},Xk={class:"row justify-content-between row__width"},eC={class:"dropdown-content"},tC={class:"dropdown-title"},aC={class:"bs-list mt-3"},nC={class:"bs-list mt-3"},iC={class:"bs-right"},sC={class:"bs-right"},oC={class:"bs-right"},rC={class:"bs-right"},lC={class:"invitation-section"},cC={class:"code-inputs"},dC={class:"mesas-section"},uC={class:"section-header"},hC={class:"section-info"},pC={class:"section-title"},mC={class:"section-subtitle"},fC={class:"tabs-container col-12 d-flex justify-content-center align-items-center"},vC={class:"row"},gC={class:"tab-item active col-4"},bC={class:"tab-badge"},wC={class:"tab-item col-4"},yC={class:"tab-badge"},_C={class:"tab-item bloqueadas col-4"},kC={class:"tab-badge"},CC={class:"notifications-section col-12"},EC={class:"row section-header mb-4"},IC={class:"col-12 d-flex justify-content-between align-items-center px-0"},SC={class:"section-subtitle"},TC={class:"notifications-section",style:{display:"none"}},NC={class:"section-header"},AC={class:"section-subtitle"},PC={style:{display:"none"}},RC={class:"modal-content large"},xC={class:"modal-header"},DC={class:"modal-body"},OC={class:"modal-content large"},LC={class:"modal-header"},MC={class:"modal-body"},UC={class:"modal-content large"},FC={class:"modal-header"},qC={class:"modal-body"},BC={class:"anti-spam-section"},jC={key:0,class:"spam-alerts"},$C={class:"ip-info"},zC={class:"call-count"},VC={class:"ip-calls"},WC=["onClick"],HC={class:"blocked-ips-list"},GC={key:0,class:"empty-state"},KC={key:1,class:"blocked-ip-cards"},JC={class:"blocked-ip-header"},YC={class:"ip-address"},QC={class:"block-reason"},ZC={class:"blocked-ip-details"},XC={class:"detail-item"},eE={class:"detail-item"},tE={key:0,class:"detail-item"},aE={key:1,class:"detail-item"},nE={key:2,class:"detail-item"},iE={class:"blocked-ip-actions"},sE=["onClick"],oE={class:"modal-content large"},rE={class:"modal-header"},lE={class:"modal-body ip-debug-body"},cE={class:"ip-debug-form"},dE={class:"actions"},uE=["disabled"],hE={key:0,class:"fas fa-search"},pE={key:1,class:"fas fa-spinner fa-spin"},mE=["disabled"],fE={key:0,class:"error-box"},vE={key:0,class:"ip-debug-result"},gE={class:"summary-line"},bE={key:0,class:"locks-section"},wE={key:1,class:"locks-section"},yE={class:"raw-json"},_E={key:1,class:"hint-box"},kE={__name:"Dashboard",setup(e){b();const t=tn(),i=P({assignedTables:[],availableTables:[],pendingCalls:[],callHistory:[],silencedTables:[],businesses:[],currentBusiness:null,needsBusiness:!1,loading:!1,processingCall:null,showTableSelector:!1,showTablesManager:!1,showProfilesManager:!1,showBlockedIpsManager:!1,showAllTablesModal:!1,blockedIps:[],showIpDebugPanel:!1,uiFlags:{unlinkedBanner:!1,unlinkedMessage:""}}),p=n(()=>i.availableTables);n(()=>i.silencedTables),n(()=>i.loading),n(()=>i.processingCall);const f=n({get:()=>i.showTableSelector,set:e=>i.showTableSelector=e}),y=n({get:()=>i.showTablesManager,set:e=>i.showTablesManager=e}),T=n({get:()=>i.showProfilesManager,set:e=>i.showProfilesManager=e}),N=n({get:()=>i.showBlockedIpsManager,set:e=>i.showBlockedIpsManager=e}),A=n({get:()=>i.showAllTablesModal,set:e=>i.showAllTablesModal=e}),x=n({get:()=>i.showIpDebugPanel,set:e=>i.showIpDebugPanel=e}),D=a(""),O=a(!1),L=a(null),M=a(null),U=a(!1),F=a(!1),q=a("exteriores"),B=a(!1),j=a(!1),$=a(["","","",""]),z=n(()=>i.blockedIps||[]),V=a(null);n(()=>i.businesses);const W=n(()=>i.currentBusiness),H=n(()=>i.needsBusiness);n(()=>{var e;return(null==(e=i.currentBusiness)?void 0:e.name)||"Seleccionar Negocio"});const K=e=>{q.value=e,((e=!1)=>{const t="boolean"==typeof e&&e;F.value&&(F.value=!1,t&&setTimeout(()=>{T.value=!0},0))})(!1)},J=()=>{j.value=!0,U.value=!1},Y=()=>{j.value&&(j.value=!1,B.value=!0)},Q=n(()=>{var e;return(null==(e=t.user)?void 0:e.name)||"Ana Martinez"}),Z=n(()=>(Q.value||"A").charAt(0).toUpperCase()),X=a(""),ee=()=>{const e=new Date,t=e=>String(e).padStart(2,"0");X.value=`${t(e.getHours())}:${t(e.getMinutes())}`};ee(),setInterval(ee,6e4);const te=a("todas"),ae=n(()=>ie.value.filter(e=>(e.pending_calls_count||0)>0));n(()=>{switch(te.value){case"con-llamadas":return ae.value;case"silenciadas":return ie.value.filter(e=>e.is_silenced);default:return ie.value}}),n(()=>{try{if(window&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls){const e=new Set(Array.from(window.ultraFastNotifications.activeCalls.keys()).map(e=>String(e)));return i.pendingCalls.filter(t=>!e.has(String(t.id)))}}catch(e){}return i.pendingCalls});const ne=n(()=>{try{const e=new Set(window&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls?Array.from(window.ultraFastNotifications.activeCalls.keys()).map(e=>String(e)):[]);return i.callHistory.filter(t=>!e.has(String(t.id)))}catch(e){return i.callHistory}});n(()=>{try{if(window&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls){const e=new Set(Array.from(window.ultraFastNotifications.activeCalls.keys()).map(e=>String(e)));return i.pendingCalls.filter(t=>!e.has(String(t.id)))}}catch(e){}return i.pendingCalls});const ie=n(()=>i.assignedTables.map(e=>{var t,a;const n=null==(t=e.calls)?void 0:t.pending_count,s=i.pendingCalls.filter(t=>{var a;return t.table_id===e.id||(null==(a=t.table)?void 0:a.id)===e.id}).length;return{...e,is_silenced:(null==(a=e.silence)?void 0:a.is_silenced)??e.is_silenced??!1,pending_calls_count:"number"==typeof n?n:s}})),se=n(()=>{const e=new Map;return(i.availableTables||[]).forEach(t=>e.set(t.id,t)),(i.assignedTables||[]).forEach(t=>e.set(t.id,{...e.get(t.id),...t})),Array.from(e.values())}),oe=n(()=>(i.assignedTables||[]).map(e=>e.id)),re=n(()=>(i.silencedTables||[]).map(e=>e.id)),le=n(()=>{var e;const t={};for(const a of i.pendingCalls||[]){const n=a.table_id||(null==(e=a.table)?void 0:e.id);n&&(t[n]=(t[n]||0)+1)}return t});async function ce(e){await xe(e)}async function de(e){await Le(e)}async function ue(e){await De(e)}async function he(e){await Oe(e)}const pe=n(()=>{if(!i.pendingCalls||!Array.isArray(i.pendingCalls))return{};const e=Date.now()-6e5,t={};return i.pendingCalls.forEach(a=>{var n;const i=null==(n=a.client_info)?void 0:n.ip_address;!i||!a.called_at||a.called_at<e||(t[i]||(t[i]={count:0,calls:[]}),t[i].count++,t[i].calls.push(a))}),t}),me=n(()=>Object.entries(pe.value).filter(([e,t])=>t.count>=2).map(([e,t])=>({ip:e,...t}))),fe=n(()=>i.pendingCalls&&Array.isArray(i.pendingCalls)?i.pendingCalls.map(e=>{var t;const a=null==(t=e.client_info)?void 0:t.ip_address,n=pe.value[a];return{...e,is_potential_spam:n&&n.count>=2,ip_call_count:n?n.count:1}}):[]);function ve(e){const t=String(e.id);i.callHistory=i.callHistory.filter(e=>String(e.id)!==t);const a=i.pendingCalls.findIndex(e=>String(e.id)===t),n=Date.now(),s=e.called_at||e.timestamp||n,o=Math.max(0,Math.floor((n-s)/6e4)),r={...e,minutes_ago:o};-1===a?i.pendingCalls.unshift(r):i.pendingCalls[a]={...i.pendingCalls[a],...r}}function ge(e){try{const t=null==e?void 0:e.detail;if(!t||!t.id)return;console.debug("Dashboard handler ultraFastAddCall",t.id,t),ve(t)}catch(t){console.warn("Error handling ultraFastAddCall:",t)}}function be(e){try{const t=null==e?void 0:e.detail;if(!t||!t.id)return;ve(t)}catch(t){console.warn("Error handling updateCallStatus:",t)}}function we(e){var t;try{const a=null==(t=null==e?void 0:e.detail)?void 0:t.callId;if(!a)return;const n=String(a);i.pendingCalls=i.pendingCalls.filter(e=>String(e.id)!==n)}catch(a){console.warn("Error handling removeCall:",a)}}function ye(){i.pendingCalls=[]}function _e(e){var t;try{const a=null==(t=null==e?void 0:e.detail)?void 0:t.callId;if(!a)return;const n=i.pendingCalls.findIndex(e=>String(e.id)===String(a));if(-1!==n){const e={...i.pendingCalls[n],status:"acknowledged"};i.pendingCalls.splice(n,1),i.callHistory.unshift(e)}}catch(a){console.warn("Error handling callAcknowledged:",a)}}function ke(e){try{const t=(null==e?void 0:e.detail)||{},a=t.callId||t.callData&&t.callData.id,n=t.callData||null;if(!a)return;if(n&&"pending"===n.status)return;i.pendingCalls=i.pendingCalls.filter(e=>String(e.id)!==String(a));const s=i.callHistory.find(e=>String(e.id)===String(a));s?Object.assign(s,n||{}):n&&i.callHistory.unshift(n)}catch(t){console.warn("Error manejando callMovedToHistory en Dashboard:",t)}}function Ce(e){try{console.log("🎉 Staff request approved! Reloading dashboard data...",e.detail),V.value&&V.value.loadBusinesses?(console.log("🔄 Forcing business data reload..."),V.value.loadBusinesses().then(()=>(console.log("✅ Business data reloaded, now loading dashboard data"),Te())).then(()=>{console.log("✅ Dashboard data reloaded after staff approval"),je()}).catch(e=>{console.error("❌ Error reloading after staff approval:",e)})):(console.warn("⚠️ BusinessSelector ref not available, falling back to dashboard reload only"),Te().then(()=>{console.log("✅ Dashboard data reloaded after staff approval"),je()}).catch(e=>{console.error("❌ Error reloading dashboard after staff approval:",e)}))}catch(t){console.warn("Error handling staff request approval:",t)}}function Ee(e){try{console.log("🚫 Waiter unlinked from business! Processing unlink notification...",e.detail),Se().then(()=>{if(console.log("✅ Dashboard info reloaded after unlink notification"),V.value&&V.value.loadBusinesses)return V.value.loadBusinesses()}).then(()=>(console.log("✅ Business data reloaded after unlink"),Te())).catch(e=>{console.error("❌ Error handling waiter unlink:",e)})}catch(t){console.warn("Error handling waiter unlink notification:",t)}}let Ie=null;const Se=async()=>{try{const e=(await ga.getWaiterDashboard()).data;return e.ui_flags&&(i.uiFlags.unlinkedBanner=e.ui_flags.unlinked_banner||!1,i.uiFlags.unlinkedMessage=e.ui_flags.unlinked_message||""),e}catch(e){return console.error("Error loading dashboard info:",e),null}},Te=async()=>{if(!i.needsBusiness&&i.currentBusiness){i.loading=!0;try{await Promise.all([Se(),Ne(),Ae(),Pe(),Re(),$e()])}catch(e){console.error("Error loading dashboard data:",e),or("Error cargando datos del dashboard")}finally{i.loading=!1}}};g(async()=>{await Te(),window.__waiterDashboardListenersRegistered||(window.addEventListener("newWaiterCall",ge),window.addEventListener("updateCallStatus",be),window.addEventListener("removeCall",we),window.addEventListener("clearAllCalls",ye),window.addEventListener("callAcknowledged",_e),window.addEventListener("callMovedToHistory",ke),window.addEventListener("staffRequestApproved",Ce),window.addEventListener("waiterUnlinked",Ee),window.__waiterDashboardListenersRegistered=!0);try{window.debugUltra=()=>({pendingCalls:i.pendingCalls.slice(),activeCalls:window.ultraFastNotifications?Array.from(window.ultraFastNotifications.activeCalls.keys()):[]})}catch(e){}}),I(()=>{try{window.__waiterDashboardListenersRegistered&&(window.removeEventListener("newWaiterCall",ge),window.removeEventListener("updateCallStatus",be),window.removeEventListener("removeCall",we),window.removeEventListener("clearAllCalls",ye),window.removeEventListener("callAcknowledged",_e),window.removeEventListener("callMovedToHistory",ke),window.removeEventListener("staffRequestApproved",Ce),window.removeEventListener("waiterUnlinked",Ee),window.__waiterDashboardListenersRegistered=!1)}catch(e){console.warn("Error removing ultraFast event listeners:",e)}try{Ie&&Ie.stopListening&&Ie.stopListening()}catch(e){console.warn("Error stopping ultraFastNotifications on unmount:",e)}});const Ne=async()=>{var e;if(i.currentBusiness)try{const t=await om.getWaiterBusinessTables(i.currentBusiness.id);if(t.success){const a=(null==(e=t.tables)?void 0:e.filter(e=>{var t;return"assigned_to_me"===(null==(t=e.status)?void 0:t.assignment)}))||[];i.assignedTables=a}}catch(t){console.error("❌ Error cargando mesas asignadas:",t),or("Error al cargar las mesas asignadas")}},Ae=async()=>{},Pe=async()=>{try{const e=await om.getAvailableTables();e.success&&(i.availableTables=e.available_tables||[])}catch(e){console.error("💥 Error loading available tables:",e)}},Re=async()=>{try{const e=await om.getSilencedTables();e.success&&(i.silencedTables=e.silenced_tables||[])}catch(e){console.error("Error loading silenced tables:",e)}},xe=async e=>{var t,a,n;try{const t=await om.activateTable(e);t.success?(sr(t.message||"Mesa activada"),await Ne(),je()):or(t.message||"Error activando mesa")}catch(i){console.error("💥 Dashboard: Error completo activando mesa:",i),403===(null==(t=i.response)?void 0:t.status)?(console.log("🚫 403 error detected - waiter not confirmed staff, reloading dashboard info"),or((null==(n=null==(a=i.response)?void 0:a.data)?void 0:n.message)||"No tienes permisos para activar mesas en este negocio"),await Se()):or("Error activando mesa")}},De=async e=>{try{if(await rr("¿Silenciar mesa?","La mesa no podrá realizar llamadas durante 30 minutos.","Silenciar","Cancelar","warning")){const t=await om.silenceTable(e,30);t.success?(sr(t.message||"Mesa silenciada"),await Ne(),await Re()):or(t.message||"Error silenciando mesa")}}catch(t){console.error("Error silencing table:",t),or("Error silenciando mesa")}},Oe=async e=>{try{const t=await om.unsilenceTable(e);t.success?(sr(t.message||"Silencio removido"),await Ne(),await Re()):or(t.message||"Error removiendo silencio")}catch(t){console.error("Error unsilencing table:",t),or("Error removiendo silencio")}},Le=async e=>{try{if(await rr("¿Desactivar mesa?","Te desasignarás de esta mesa y no recibirás más llamadas.","Desactivar","Cancelar","warning")){const t=await om.deactivateTable(e);t.success?(sr(t.message||"Mesa desactivada"),await Ne(),await Pe(),await Ae(),je()):or(t.message||"Error desactivando mesa")}}catch(t){console.error("Error deactivating table:",t),or("Error desactivando mesa")}},Me=e=>{i.businesses=e.businesses||[],i.currentBusiness=e.activeBusiness||null,i.needsBusiness=e.needsBusiness||!1,i.currentBusiness&&!i.needsBusiness&&(Te(),je())},Ue=e=>{i.currentBusiness=e,i.assignedTables=[],i.availableTables=[],i.pendingCalls=[],i.silencedTables=[],Te(),je()};E(()=>i.showTableSelector,async e=>{e&&i.currentBusiness&&!i.needsBusiness&&await Pe()});const Fe=async e=>{var t,a,n,s;if(i.showTableSelector=!1,0!==e.length)try{const a=await om.activateMultipleTables(e);a.success?(console.log("✅ Dashboard: Mesas activadas exitosamente"),sr(a.message||`${(null==(t=a.summary)?void 0:t.successful)||e.length} mesas activadas`),await Ne(),await Pe(),je()):or(a.message||"Error activando mesas")}catch(o){console.error("💥 Dashboard: Error completo activando mesas múltiples:",o),403===(null==(a=o.response)?void 0:a.status)?(console.log("🚫 403 error detected - waiter not confirmed staff, reloading dashboard info"),or((null==(s=null==(n=o.response)?void 0:n.data)?void 0:s.message)||"No tienes permisos para activar mesas en este negocio"),await Se()):or("Error activando mesas")}},qe=async e=>{await Te()},Be=async()=>{await Te()},je=async()=>{if(t.user&&!i.needsBusiness)try{Ie=function(e){"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission();try{ja&&ja.isPluginAvailable&&ja.isPluginAvailable("LocalNotifications")&&G(async()=>{const{LocalNotifications:e}=await import("./index-F8_fAb3q.js");return{LocalNotifications:e}},__vite__mapDeps([9,1,2])).then(({LocalNotifications:e})=>{e.requestPermissions().then(e=>{console.log("UNIFIED: LocalNotifications permissions:",e)}).catch(e=>{console.warn("Error pidiendo permisos LocalNotifications:",e)}),e.createChannel&&e.createChannel({id:"mozo_waiter",name:"Mozo - Llamadas",importance:5,visibility:1,description:"Notificaciones de llamadas y eventos importantes para mozos"}).then(()=>{console.log("✅ UNIFIED: Canal mozo_waiter creado")}).catch(e=>{console.warn("⚠️ Error creando canal mozo_waiter:",e)})}).catch(e=>console.warn("⚠️ No se pudo importar LocalNotifications:",e))}catch(a){console.warn("⚠️ Excepción al preparar LocalNotifications:",a)}const t=new xw(e);return t.startListening(),console.log("⚡ UNIFIED notifications inicializadas"),t}(t.user.id.toString())}catch(e){console.error("❌ Error configurando Ultra Fast Firebase:",e),or("Error configurando notificaciones ultra rápidas")}};g(async()=>{}),I(()=>{(async()=>{try{Ie&&(Ie.stopListening(),Ie=null)}catch(e){console.error("❌ Error desconectando Ultra Fast Firebase:",e)}})()});const $e=async()=>{try{const e=await om.getBlockedIps({active_only:!0});e.success?i.blockedIps=e.blocked_ips||[]:i.blockedIps=[]}catch(e){console.error("Error loading blocked IPs:",e),i.blockedIps=[]}},ze=async()=>{var e;if(D.value){O.value=!0,M.value=null,L.value=null;try{const t=await om.debugBlockedIp(D.value,null==(e=i.currentBusiness)?void 0:e.id);t.success?L.value=t.data||t:M.value=t.message||"Diagnóstico fallido"}catch(t){console.error("Error debug IP:",t),M.value=t.message||"Error de red"}finally{O.value=!1}}},Ve=async()=>{var e,t;if(!(null==(e=L.value)?void 0:e.ip_address))return;if(await rr("¿Force Unblock?",`Se forzará el desbloqueo completo de la IP ${L.value.ip_address}.`,"Desbloquear","Cancelar","warning")){O.value=!0;try{const e=await om.forceUnblockIp(L.value.ip_address,null==(t=i.currentBusiness)?void 0:t.id);e.success?(sr("IP desbloqueada forzadamente"),await ze(),await $e()):or(e.message||"No se pudo desbloquear")}catch(a){console.error("Error force unblock:",a),or(a.message||"Error desconocido")}finally{O.value=!1}}},We=e=>{console.log("Business selected:",e),U.value=!1};return(e,t)=>{var a,n,g,b,E,I,P,j,G;return w(),s("div",Vk,[o("div",Wk,[o("div",Hk,[o("div",Gk,l(Z.value),1),o("div",Kk,[o("h5",Jk,l(Q.value),1),o("p",Yk,l(X.value),1)]),o("div",Qk,l(fe.value.length),1)]),o("div",Zk,[o("div",Xk,[o("div",{class:"dropdown-card col me-1",onClick:t[0]||(t[0]=e=>U.value=!U.value)},[t[31]||(t[31]=o("div",{class:"dropdown-icon"},[o("i",{class:"fas fa-building"})],-1)),o("div",eC,[o("h6",tC,l((null==(a=W.value)?void 0:a.name)||"Café Central"),1),t[30]||(t[30]=o("p",{class:"dropdown-subtitle"},"Fast Food",-1))]),t[32]||(t[32]=o("div",{class:"dropdown-arrow"},[o("i",{class:"fas fa-chevron-right"})],-1))]),o("div",{class:"dropdown-card col ms-1",onClick:t[1]||(t[1]=e=>{U.value=!1,F.value=!F.value})},t[33]||(t[33]=[R('<div class="dropdown-icon"><i class="fas fa-map-marker-alt"></i></div><div class="dropdown-content"><h6 class="dropdown-title">Mesas Exteriores</h6><p class="dropdown-subtitle">12 mesas</p></div><div class="dropdown-arrow"><i class="fas fa-chevron-right"></i></div>',3)]))])]),h(iy,{modelValue:U.value,"onUpdate:modelValue":t[5]||(t[5]=e=>U.value=e),title:"Seleccionar Negocio",subtitle:"Elige el restaurante donde estás trabajando","sheet-class":"violet",onAfterLeave:Y},{default:m(()=>[o("button",{class:"bs-add-btn",onClick:J},"+ Agregar Negocio"),o("div",aC,[o("button",{class:"bs-item",onClick:t[2]||(t[2]=e=>We("mcdonalds"))},t[34]||(t[34]=[o("div",{class:"left"},[o("div",{class:"bs-ico"},[o("i",{class:"fas fa-building"})]),o("div",null,[o("div",{class:"bs-name"},"McDonald's"),o("div",{class:"bs-sub"},"Fast Food • Centro Comercial")])],-1),o("div",{class:"bs-right"},[o("i",{class:"fas fa-chevron-right"})],-1)])),o("button",{class:"bs-item active",onClick:t[3]||(t[3]=e=>We("burger-king"))},t[35]||(t[35]=[o("div",{class:"left"},[o("div",{class:"bs-ico"},[o("i",{class:"fas fa-building"})]),o("div",null,[o("div",{class:"bs-name"},"Burger King"),o("div",{class:"bs-sub"},"Fast Food • Plaza Norte")])],-1),o("div",{class:"bs-right"},[o("i",{class:"fas fa-check"})],-1)])),o("button",{class:"bs-item",onClick:t[4]||(t[4]=e=>We("starbucks"))},t[36]||(t[36]=[o("div",{class:"left"},[o("div",{class:"bs-ico"},[o("i",{class:"fas fa-building"})]),o("div",null,[o("div",{class:"bs-name"},"Starbucks"),o("div",{class:"bs-sub"},"Café • Zona Rosa")])],-1),o("div",{class:"bs-right"},[o("i",{class:"fas fa-chevron-right"})],-1)]))])]),_:1},8,["modelValue"]),h(iy,{modelValue:F.value,"onUpdate:modelValue":t[11]||(t[11]=e=>F.value=e),title:"Perfil de Mesas",subtitle:"Selecciona qué área de mesas quieres gestionar","sheet-class":"violet"},{default:m(()=>[o("button",{class:"bs-add-btn",onClick:t[6]||(t[6]=e=>{T.value=!0,F.value=!1})},"+ Gestionar Perfiles"),o("div",nC,[o("button",{class:C(["bs-item",{active:"exteriores"===q.value}]),onClick:t[7]||(t[7]=e=>K("exteriores"))},[t[37]||(t[37]=o("div",{class:"left"},[o("div",{class:"bs-ico"},[o("i",{class:"fas fa-map-marker-alt"})]),o("div",null,[o("div",{class:"bs-name"},"Mesas Exteriores"),o("div",{class:"bs-sub"},"Terraza y área al aire libre • 12 mesas")])],-1)),o("div",iC,[o("i",{class:C(["fas","exteriores"===q.value?"fa-check":"fa-chevron-right"])},null,2)])],2),o("button",{class:C(["bs-item",{active:"interiores"===q.value}]),onClick:t[8]||(t[8]=e=>K("interiores"))},[t[38]||(t[38]=o("div",{class:"left"},[o("div",{class:"bs-ico"},[o("i",{class:"fas fa-map-marker-alt"})]),o("div",null,[o("div",{class:"bs-name"},"Mesas Interiores"),o("div",{class:"bs-sub"},"Comedor principal • 20 mesas")])],-1)),o("div",sC,[o("i",{class:C(["fas","interiores"===q.value?"fa-check":"fa-chevron-right"])},null,2)])],2),o("button",{class:C(["bs-item",{active:"vip"===q.value}]),onClick:t[9]||(t[9]=e=>K("vip"))},[t[39]||(t[39]=o("div",{class:"left"},[o("div",{class:"bs-ico"},[o("i",{class:"fas fa-map-marker-alt"})]),o("div",null,[o("div",{class:"bs-name"},"Área VIP"),o("div",{class:"bs-sub"},"Zona premium • 8 mesas")])],-1)),o("div",oC,[o("i",{class:C(["fas","vip"===q.value?"fa-check":"fa-chevron-right"])},null,2)])],2),o("button",{class:C(["bs-item",{active:"barra"===q.value}]),onClick:t[10]||(t[10]=e=>K("barra"))},[t[40]||(t[40]=o("div",{class:"left"},[o("div",{class:"bs-ico"},[o("i",{class:"fas fa-map-marker-alt"})]),o("div",null,[o("div",{class:"bs-name"},"Barra"),o("div",{class:"bs-sub"},"Bebidas • 6 mesas")])],-1)),o("div",rC,[o("i",{class:C(["fas","barra"===q.value?"fa-check":"fa-chevron-right"])},null,2)])],2)])]),_:1},8,["modelValue"]),B.value?(w(),s("div",{key:0,class:"add-business-backdrop",onClick:t[17]||(t[17]=e=>B.value=!1)},[o("div",{class:"add-business-content",onClick:t[16]||(t[16]=c(()=>{},["stop"]))},[t[43]||(t[43]=R('<div class="modal-icon"><i class="fas fa-building"></i></div><h3 class="modal-title"><i class="fas fa-building"></i> Agregar Negocio </h3><p class="modal-subtitle my-3">Ingresa el código de invitación para unirte a un nuevo negocio</p>',3)),o("div",lC,[t[41]||(t[41]=o("h6",{class:"invitation-label"},"Código de Invitación",-1)),o("div",cC,[d(o("input",{type:"text",maxlength:"1",class:"code-input","onUpdate:modelValue":t[12]||(t[12]=e=>$.value[0]=e)},null,512),[[u,$.value[0]]]),d(o("input",{type:"text",maxlength:"1",class:"code-input","onUpdate:modelValue":t[13]||(t[13]=e=>$.value[1]=e)},null,512),[[u,$.value[1]]]),d(o("input",{type:"text",maxlength:"1",class:"code-input","onUpdate:modelValue":t[14]||(t[14]=e=>$.value[2]=e)},null,512),[[u,$.value[2]]]),d(o("input",{type:"text",maxlength:"1",class:"code-input","onUpdate:modelValue":t[15]||(t[15]=e=>$.value[3]=e)},null,512),[[u,$.value[3]]])]),t[42]||(t[42]=o("p",{class:"invitation-help"},"Solicita este código al administrador del negocio",-1))]),t[44]||(t[44]=o("button",{class:"btn-validate-code"},"Validar Código",-1))])])):r("",!0),t[53]||(t[53]=R('<div class="divider"></div><div class="quick-actions"><button class="btn-none d-flex flex-column justify-content-center align-items-center"><span class="quick-action-btn activate-all"><i class="fas fa-check"></i></span> Activar Todo </button><button class="btn-none d-flex flex-column justify-content-center align-items-center"><span class="quick-action-btn silence-all"><i class="fas fa-bell-slash"></i></span> Silenciar Todo </button><button class="btn-none d-flex flex-column justify-content-center align-items-center"><span class="quick-action-btn activate-solo"><i class="fas fa-bolt"></i></span> Activar Solitarias </button></div><div class="divider"></div>',3)),o("div",dC,[o("div",uC,[o("div",hC,[o("h3",pC,"Mesas - "+l((null==(n=W.value)?void 0:n.name)||"Café Central"),1),o("p",mC,l(ie.value.length)+" con notificaciones • "+l(ie.value.length)+" asignadas",1)]),o("button",{class:"btn-ver-todas",onClick:t[18]||(t[18]=e=>A.value=!0)},"Ver Todas")]),t[45]||(t[45]=R('<div class="mesas-controls"><div class="control-left"><button class="mas-control"><i class="fas fa-plus"></i> Más </button><div class="pagination-nav"><button class="nav-btn"><i class="fas fa-chevron-left"></i></button><span class="page-info">1/2</span><button class="nav-btn"><i class="fas fa-chevron-right"></i></button></div></div><div class="badge-urgent">1 urgentes</div></div><div class="mesas-grid"><div class="table-card status-llamando"><div class="notification-dot"></div><div class="table-number">2</div><div class="table-status">Llamando</div><div class="table-actions"><button class="action-btn" title="asignar"><i class="fa-thin fa-user-plus"></i></button><button class="action-btn" title="silenciar"><i class="fa-thin fa-volume-slash"></i></button></div><div class="table-icon"><i class="fa-thin fa-triangle-exclamation"></i></div></div></div><div class="page-dots"><span class="dots-text">(1-6 de 12)</span></div>',3))]),o("div",fC,[o("div",vC,[o("button",gC,[t[46]||(t[46]=v(" Pendientes ")),o("span",bC,l(fe.value.length),1)]),o("button",wC,[t[47]||(t[47]=v(" Historial ")),o("span",yC,l(ne.value.length),1)]),o("button",_C,[t[48]||(t[48]=v(" Bloqueadas ")),o("span",kC,l(z.value.length),1)])])]),o("div",CC,[o("div",EC,[o("div",IC,[t[49]||(t[49]=o("h3",{class:"section-title"},"Notificaciones Pendientes",-1)),o("p",SC,l(fe.value.length)+" sin atender",1)])]),t[50]||(t[50]=R('<div class="notifications-list row"><div class="notification-card urgent col-12"><div class="row notification-content p-2"><div class="col-12 d-flex justify-content-between align-items-center px-0"><h6 class="notification-title">Mesa 3</h6><p class="notification-time">Hace 2 min</p></div><div class="col-12 px-0"><p class="notification-message">Llamado urgente</p></div><div class="col-12"><div class="row notification-actions"><button class="btn-silenciar col"><i class="fas fa-volume-mute"></i> Silenciar </button><button class="btn-recibido col"><i class="fas fa-check"></i> Recibido </button><button class="btn-bloquear-ip col"><i class="fas fa-ban"></i> Bloquear IP </button></div></div></div></div></div>',1))]),o("div",TC,[o("div",NC,[t[51]||(t[51]=o("h3",{class:"section-title"},"IPs Bloqueadas",-1)),o("p",AC,l(z.value.length)+" bloqueada(s)",1)]),t[52]||(t[52]=R('<div class="notifications-list"><div class="ip-blocked-card"><div class="ip-title">Mesa 5</div><div class="ip-address">IP: 192.168.1.45</div><div class="ip-reason">Razón: Spam múltiple</div><div class="ip-time">Hace 1 hora</div><div class="ip-actions"><button class="btn-desbloquear-ip">Desbloquear IP</button></div></div></div>',1))])]),o("div",PC,[h(Ny,{onBusinessChanged:Ue,onBusinessesLoaded:Me,ref_key:"businessSelector",ref:V},null,512),f.value&&!H.value?(w(),S(Zw,{key:0,"available-tables":p.value,"assigned-tables":ie.value,onClose:t[19]||(t[19]=e=>f.value=!1),onTablesSelected:Fe},null,8,["available-tables","assigned-tables"])):r("",!0),y.value&&W.value?(w(),s("div",{key:1,class:"modal-overlay",onClick:t[21]||(t[21]=c(e=>y.value=!1,["self"]))},[o("div",RC,[o("div",xC,[o("h3",null,[t[54]||(t[54]=o("i",{class:"fas fa-building"},null,-1)),v(" "+l(W.value.name)+" - Gestión de Mesas ",1)]),o("button",{onClick:t[20]||(t[20]=e=>y.value=!1),class:"close-btn"},t[55]||(t[55]=[o("i",{class:"fas fa-times"},null,-1)]))]),o("div",DC,[h(f_,{"business-id":W.value.id,"business-name":W.value.name,onTablesUpdated:qe},null,8,["business-id","business-name"])])])])):r("",!0),T.value&&W.value?(w(),s("div",{key:2,class:"modal-overlay",onClick:t[23]||(t[23]=c(e=>T.value=!1,["self"]))},[o("div",OC,[o("div",LC,[t[57]||(t[57]=o("h3",null,[o("i",{class:"fas fa-bookmark"}),v(" Perfiles de Mesa ")],-1)),o("button",{onClick:t[22]||(t[22]=e=>T.value=!1),class:"close-btn"},t[56]||(t[56]=[o("i",{class:"fas fa-times"},null,-1)]))]),o("div",MC,[h(ik,{"business-id":W.value.id,"available-tables":p.value,"assigned-tables":ie.value,onProfilesUpdated:Be},null,8,["business-id","available-tables","assigned-tables"])])])])):r("",!0),N.value&&W.value?(w(),s("div",{key:3,class:"modal-overlay",onClick:t[25]||(t[25]=c(e=>N.value=!1,["self"]))},[o("div",UC,[o("div",FC,[t[59]||(t[59]=o("h3",null,[o("i",{class:"fas fa-shield-alt"}),v(" Sistema Anti-Spam - IPs Bloqueadas ")],-1)),o("button",{onClick:t[24]||(t[24]=e=>N.value=!1),class:"close-btn"},t[58]||(t[58]=[o("i",{class:"fas fa-times"},null,-1)]))]),o("div",qC,[o("div",BC,[me.value.length>0?(w(),s("div",jC,[t[61]||(t[61]=o("h4",null,[o("i",{class:"fas fa-exclamation-triangle"}),v(" IPs Sospechosas Activas")],-1)),(w(!0),s(_,null,k(me.value,e=>(w(),s("div",{key:e.ip,class:"suspicious-ip-card"},[o("div",$C,[o("strong",null,l(e.ip),1),o("span",zC,l(e.count)+" llamadas en 10 min",1)]),o("div",VC,[(w(!0),s(_,null,k(e.calls,e=>(w(),s("div",{key:e.id,class:"mini-call"}," Mesa "+l(e.table_number)+" - "+l(e.message),1))),128))]),o("button",{onClick:t=>(async e=>{var t;if(null==(t=e.client_info)?void 0:t.ip_address)try{if(await rr("¿Bloquear IP por spam?",`Se bloqueará la IP ${e.client_info.ip_address} por 24 horas. Esta IP no podrá realizar más llamadas.`,"Bloquear IP","Cancelar","error")){i.processingCall=e.id;const t=await om.blockIpForSpam(e.id,{reason:"spam",duration_hours:24,notes:`Bloqueada desde Mesa ${e.table_number} - IP: ${e.client_info.ip_address}`});if(t.success){sr(`IP ${e.client_info.ip_address} bloqueada por 24 horas`);const t=e.client_info.ip_address;i.pendingCalls=i.pendingCalls.filter(e=>{var a;return(null==(a=e.client_info)?void 0:a.ip_address)!==t}),await $e()}else or(t.message||"Error bloqueando IP")}}catch(a){console.error("Error blocking IP for spam:",a),or("Error bloqueando IP por spam")}finally{i.processingCall=null}else or("No se puede bloquear: IP no disponible")})(e.calls[0]),class:"btn-block-ip"},t[60]||(t[60]=[o("i",{class:"fas fa-ban"},null,-1),v(" Bloquear IP ")]),8,WC)]))),128))])):r("",!0),o("div",HC,[o("div",{class:"section-header"},[t[63]||(t[63]=o("h4",null,[o("i",{class:"fas fa-ban"}),v(" IPs Bloqueadas")],-1)),o("button",{onClick:$e,class:"btn btn-secondary btn-sm"},t[62]||(t[62]=[o("i",{class:"fas fa-sync"},null,-1),v(" Actualizar ")]))]),0===z.value.length?(w(),s("div",GC,t[64]||(t[64]=[o("i",{class:"fas fa-shield-check"},null,-1),o("p",null,"No hay IPs bloqueadas actualmente",-1)]))):(w(),s("div",KC,[(w(!0),s(_,null,k(z.value,e=>(w(),s("div",{key:e.ip_address,class:"blocked-ip-card"},[o("div",JC,[o("div",YC,l(e.ip_address),1),o("div",QC,l(e.reason),1)]),o("div",ZC,[o("div",XC,[t[65]||(t[65]=o("strong",null,"Bloqueada por:",-1)),v(" "+l(e.blocked_by),1)]),o("div",eE,[t[66]||(t[66]=o("strong",null,"Fecha:",-1)),v(" "+l(new Date(e.blocked_at).toLocaleString()),1)]),e.expires_at?(w(),s("div",tE,[t[67]||(t[67]=o("strong",null,"Expira:",-1)),v(" "+l(new Date(e.expires_at).toLocaleString()),1)])):(w(),s("div",aE,t[68]||(t[68]=[o("strong",null,"Duración:",-1),v(" Permanente ")]))),e.notes?(w(),s("div",nE,[t[69]||(t[69]=o("strong",null,"Notas:",-1)),v(" "+l(e.notes),1)])):r("",!0)]),o("div",iE,[o("button",{onClick:t=>(async e=>{var t;try{if(await rr("¿Desbloquear IP?",`Se desbloqueará la IP ${e} y podrá volver a realizar llamadas.`,"Desbloquear","Cancelar","warning")){const a=await om.unblockIp(e,null==(t=i.currentBusiness)?void 0:t.id);a.success?(sr(`IP ${e} desbloqueada`),await $e()):or(a.message||"Error desbloqueando IP")}}catch(a){console.error("Error unblocking IP:",a),or("Error desbloqueando IP")}})(e.ip_address),class:"btn btn-warning btn-sm"},t[70]||(t[70]=[o("i",{class:"fas fa-unlock"},null,-1),v(" Desbloquear ")]),8,sE)])]))),128))]))])])])])])):r("",!0)]),x.value?(w(),s("div",{key:0,class:"modal-overlay",onClick:t[28]||(t[28]=c(e=>x.value=!1,["self"]))},[o("div",oE,[o("div",rE,[t[72]||(t[72]=o("h3",null,[o("i",{class:"fas fa-bug"}),v(" Debug de IP (Anti-Spam) ")],-1)),o("button",{onClick:t[26]||(t[26]=e=>x.value=!1),class:"close-btn"},t[71]||(t[71]=[o("i",{class:"fas fa-times"},null,-1)]))]),o("div",lE,[o("div",cE,[t[76]||(t[76]=o("label",null,"IP a diagnosticar",-1)),d(o("input",{"onUpdate:modelValue":t[27]||(t[27]=e=>D.value=e),type:"text",placeholder:"Ej: 190.123.45.67",class:"ip-input"},null,512),[[u,D.value]]),o("div",dE,[o("button",{class:"btn btn-primary",onClick:ze,disabled:!D.value||O.value},[O.value?(w(),s("i",pE)):(w(),s("i",hE)),t[73]||(t[73]=v(" Diagnosticar "))],8,uE),(null==(b=null==(g=L.value)?void 0:g.active_locks)?void 0:b.length)?(w(),s("button",{key:0,class:"btn btn-warning",onClick:Ve,disabled:O.value},[t[74]||(t[74]=o("i",{class:"fas fa-unlock"},null,-1)),v(" Force Unblock ("+l(L.value.active_locks.length)+") ",1)],8,mE)):r("",!0)]),M.value?(w(),s("div",fE,[t[75]||(t[75]=o("i",{class:"fas fa-exclamation-triangle"},null,-1)),v(" "+l(M.value),1)])):r("",!0)]),L.value?(w(),s("div",vE,[t[83]||(t[83]=o("h4",null,"Resultado:",-1)),o("div",gE,[t[77]||(t[77]=o("strong",null,"IP:",-1)),v(" "+l(L.value.ip_address)+" ",1),t[78]||(t[78]=o("strong",{style:{"margin-left":"16px"}},"Locks activos:",-1)),v(" "+l((null==(E=L.value.active_locks)?void 0:E.length)||0)+" ",1),t[79]||(t[79]=o("strong",{style:{"margin-left":"16px"}},"Total registros:",-1)),v(" "+l((null==(I=L.value.all_locks)?void 0:I.length)||0),1)]),(null==(P=L.value.active_locks)?void 0:P.length)?(w(),s("div",bE,[t[80]||(t[80]=o("h5",null,"Locks Activos",-1)),o("ul",null,[(w(!0),s(_,null,k(L.value.active_locks,e=>(w(),s("li",{key:e.id}," ID "+l(e.id)+" - expira: "+l(e.expires_at||e.unblock_at||"N/D")+" - razón: "+l(e.reason),1))),128))])])):r("",!0),(null==(j=L.value.inactive_locks)?void 0:j.length)?(w(),s("div",wE,[t[81]||(t[81]=o("h5",null,"Locks Inactivos",-1)),o("ul",null,[(w(!0),s(_,null,k(L.value.inactive_locks,e=>(w(),s("li",{key:"i-"+e.id}," ID "+l(e.id)+" - desbloqueado: "+l(e.unblocked_at||"N/D")+" - razón: "+l(e.reason),1))),128))])])):r("",!0),o("details",yE,[t[82]||(t[82]=o("summary",null,"Ver JSON crudo",-1)),o("pre",null,l(L.value),1)])])):O.value?r("",!0):(w(),s("div",_E," Ingrese una IP y presione Diagnosticar para ver su estado en el sistema anti-spam. "))])]),t[84]||(t[84]=o("footer",{class:"app-footer"},[o("div",{class:"footer-content"},[o("span",{class:"app-name"},"MozoApp"),o("span",{class:"app-version"},"v0.0.111")])],-1))])):r("",!0),A.value?(w(),S(zk,{key:1,title:(null==(G=W.value)?void 0:G.name)?`Mesas ${W.value.name}`:"",tables:se.value,"assigned-ids":oe.value,"silenced-ids":re.value,"pending-by-table-id":le.value,onClose:t[29]||(t[29]=e=>A.value=!1),onAssign:ce,onUnassign:de,onSilence:ue,onUnsilence:he},null,8,["title","tables","assigned-ids","silenced-ids","pending-by-table-id"])):r("",!0)])}}},CE=t("admin",()=>{const e=a(localStorage.getItem("businessId")||null),t=a(null),i=a(null),s=a(0),o=a(0),r=a(0),l=a(null),c=a(null),d=a([]),u=a([]),h=a([]),p=a([]),m=a([]),f=a([]),v=a([]),g=a(null),b=a(!1),w=a(null),y=a({next:null,prev:null}),_=a({current_page:1,last_page:1}),k=a(!1),C=n(()=>h.value.length>0),E=n(()=>p.value.length>0),I=n(()=>m.value.filter(e=>"pending"===e.status)),S=async(a=!1)=>{if(!a&&t.value&&t.value.id)return t.value;b.value=!0,w.value=null;try{const a=(await ga.getBusinessInfo()).data||{};if(k.value=!0===a.requires_business_setup,k.value)return{requires_business_setup:!0};const n=a.business||a;return t.value=n||null,i.value=a.active_business_id??(null==n?void 0:n.id)??null,s.value=a.tables_count??0,o.value=a.menus_count??0,r.value=a.qr_codes_count??0,l.value=a.invitation_code??null,c.value=a.invitation_url??null,d.value=Array.isArray(a.available_businesses)?a.available_businesses:d.value||[],n&&Array.isArray(n.tables)&&(p.value=n.tables,null==a.tables_count&&(s.value=n.tables.length)),n&&Array.isArray(n.menus)&&(h.value=n.menus.map(e=>({id:e.id,name:e.name,url:e.view_url||e.file_path,thumbnailUrl:e.preview_url||e.thumbnail_url||"/src/assets/pdf-thumb.png",isDefault:e.is_default})),null==a.menus_count&&(o.value=h.value.length)),i.value?(e.value=i.value,localStorage.setItem("businessId",String(i.value))):n&&n.id&&(e.value=n.id,localStorage.setItem("businessId",String(n.id))),{business:t.value,active_business_id:i.value,tables_count:s.value,menus_count:o.value,qr_codes_count:r.value,invitation_code:l.value,invitation_url:c.value,available_businesses:d.value}}catch(n){throw w.value=n.message||"Error al cargar datos del negocio",n}finally{b.value=!1}},T=async t=>{b.value=!0,w.value=null;try{const a=(await ga.selectRole("admin",t)).data||{};return i.value=t,e.value=t,localStorage.setItem("businessId",String(t)),await Promise.all([S(!0),A(),N()]),a}catch(a){throw w.value=a.message||"Error al seleccionar negocio",a}finally{b.value=!1}},N=async()=>{var e;b.value=!0,w.value=null;try{const t=await ga.getMenus(),a=(null==(e=t.data)?void 0:e.menus)??t.data,n=Array.isArray(a)?a:[];return h.value=n.map(e=>({id:e.id,name:e.name,url:e.view_url||e.file_path,thumbnailUrl:e.preview_url||e.thumbnail_url||"/src/assets/pdf-thumb.png",isDefault:e.is_default})),h.value}catch(t){throw w.value=t.message||"Error al cargar menús",t}finally{b.value=!1}},A=async()=>{var e;b.value=!0,w.value=null;try{const t=await ga.getTables();return p.value=(null==(e=t.data)?void 0:e.tables)||t.data||[],p.value}catch(t){throw w.value=t.message||"Error al obtener mesas",t}finally{b.value=!1}},P=async()=>{var e;b.value=!0,w.value=null;try{const t=await ga.getStaffRequests(),a=(null==(e=t.data)?void 0:e.requests)??t.data,n=Array.isArray(a)?a:[];return m.value=n,m.value}catch(t){throw w.value=t.message||"Error al cargar solicitudes de personal",t}finally{b.value=!1}},R=async()=>{var e,t;b.value=!0,w.value=null;try{const a=await ga.getArchivedStaffRequests(),n=(null==(e=a.data)?void 0:e.archived_requests)??(null==(t=a.data)?void 0:t.requests)??a.data,i=Array.isArray(n)?n:[];return f.value=i,f.value}catch(a){throw w.value=a.message||"Error al cargar solicitudes archivadas",a}finally{b.value=!1}},x=async(e=1)=>{var t,a,n,i,s,o,r,l,c,d;b.value=!0,w.value=null;try{const u="string"==typeof e?await va.get(e.replace(va.defaults.baseURL+"/","")):await ga.getStaff(e),h=(null==(t=u.data)?void 0:t.staff)??(null==(a=u.data)?void 0:a.data)??u.data;return v.value=Array.isArray(h)?h:[],y.value={next:(null==(i=null==(n=u.data)?void 0:n.links)?void 0:i.next)??null,prev:(null==(o=null==(s=u.data)?void 0:s.links)?void 0:o.prev)??null},_.value={current_page:(null==(l=null==(r=u.data)?void 0:r.meta)?void 0:l.current_page)??1,last_page:(null==(d=null==(c=u.data)?void 0:c.meta)?void 0:d.last_page)??1},v.value}catch(u){throw w.value=u.message||"Error al cargar el personal",u}finally{b.value=!1}};return{businessId:e,businessData:t,activeBusinessId:i,tablesCount:s,menusCount:o,qrCodesCount:r,invitationCode:l,invitationUrl:c,availableBusinesses:d,allBusinesses:u,menus:h,tables:p,staffRequests:m,archivedRequests:f,staff:v,statistics:g,isLoading:b,error:w,staffLinks:y,staffMeta:_,requiresBusinessSetup:k,hasMenus:C,hasTables:E,pendingRequests:I,fetchBusinessData:S,fetchAllBusinesses:async()=>{var e;if(d.value&&d.value.length>0)return d.value;b.value=!0,w.value=null;try{const t=await ga.getAdminBusinesses(),a=(null==(e=t.data)?void 0:e.businesses)??t.data;return u.value=Array.isArray(a)?a:[],d.value=u.value,u.value}catch(t){throw w.value=t.message||"Error al listar negocios",t}finally{b.value=!1}},fetchMenus:N,setDefaultMenu:async e=>{b.value=!0,w.value=null;try{return await ga.setDefaultMenu({menu_id:e}),await N(),!0}catch(t){throw w.value=t.message||"Error al establecer menú predeterminado",t}finally{b.value=!1}},uploadMenu:async e=>{b.value=!0,w.value=null;try{const t=await ga.uploadMenu(e);return await N(),t.data}catch(t){throw w.value=t.message||"Error al subir menú",t}finally{b.value=!1}},fetchTables:A,createTable:async e=>{var t;b.value=!0,w.value=null;try{const a=await ga.createTable(e),n=(null==(t=a.data)?void 0:t.table)||a.data;return n&&p.value.push(n),n}catch(a){throw w.value=a.message||"Error al crear mesa",a}finally{b.value=!1}},updateTable:async(e,t)=>{var a;b.value=!0,w.value=null;try{const n=await ga.updateTable(e,t),i=(null==(a=n.data)?void 0:a.table)||n.data,s=p.value.findIndex(t=>t.id===e);return-1!==s&&i&&(p.value[s]=i),i}catch(n){throw w.value=n.message||"Error al actualizar mesa",n}finally{b.value=!1}},deleteTable:async e=>{b.value=!0,w.value=null;try{return await ga.deleteTable(e),p.value=p.value.filter(t=>t.id!==e),!0}catch(t){throw w.value=t.message||"Error al eliminar mesa",t}finally{b.value=!1}},fetchStaffRequests:P,fetchArchivedRequests:R,handleStaffRequest:async(e,t)=>{b.value=!0,w.value=null;try{return await ga.handleStaffRequest(e,{action:t}),await P(),await R(),"confirm"===t&&await x(),!0}catch(a){throw w.value=a.message||"Error al procesar solicitud",a}finally{b.value=!1}},fetchStaff:x,inviteStaff:async e=>{b.value=!0,w.value=null;try{const t=await ga.inviteStaff(e);return await P(),t.data}catch(t){throw w.value=t.message||"Error al enviar invitación",t}finally{b.value=!1}},approveStaffRequest:async(e,t={})=>{b.value=!0,w.value=null;try{const a=await ga.approveStaff(e,t);return await P(),await x(),a.data}catch(a){throw w.value=a.message||"Error al aprobar solicitud",a}finally{b.value=!1}},rejectStaffRequest:async(e,t={})=>{b.value=!0,w.value=null;try{const a=await ga.rejectStaff(e,t);return await P(),await R(),a.data}catch(a){throw w.value=a.message||"Error al rechazar solicitud",a}finally{b.value=!1}},inviteStaffMember:async e=>{b.value=!0,w.value=null;try{const t=await ga.inviteStaffMember(e);return await P(),t.data}catch(t){throw w.value=t.message||"Error al enviar invitación",t}finally{b.value=!1}},fetchDashboardStats:async()=>{var e;b.value=!0,w.value=null;try{const t=await ga.getAdminStatistics();return(null==(e=t.data)?void 0:e.statistics)??t.data}catch(t){throw w.value=t.message||"Error al cargar estadísticas",t}finally{b.value=!1}},fetchStaffMember:async e=>{var t;b.value=!0,w.value=null;try{const a=await ga.getStaffMember(e);return(null==(t=a.data)?void 0:t.staff)??a.data}catch(a){throw w.value=a.message||"Error al cargar datos del miembro del personal",a}finally{b.value=!1}},updateStaffMember:async(e,t)=>{b.value=!0,w.value=null;try{const a=await ga.updateStaffMember(e,t),n=v.value.findIndex(t=>t.id===e);return-1!==n&&(v.value[n]={...v.value[n],...a.data}),a.data}catch(a){throw w.value=a.message||"Error al actualizar miembro del personal",a}finally{b.value=!1}},removeStaff:async e=>{b.value=!0,w.value=null;try{return await ga.removeStaff(e),v.value=v.value.filter(t=>t.id!==e),!0}catch(t){throw w.value=t.message||"Error al eliminar miembro del personal",t}finally{b.value=!1}},addReview:async(e,t)=>{b.value=!0,w.value=null;try{return(await ga.addReview(e,t)).data}catch(a){throw w.value=a.message||"Error al añadir reseña",a}finally{b.value=!1}},deleteReview:async(e,t)=>{b.value=!0,w.value=null;try{return await ga.deleteReview(e,t),!0}catch(a){throw w.value=a.message||"Error al eliminar reseña",a}finally{b.value=!1}},renameMenu:async(e,t)=>{b.value=!0,w.value=null;try{return await ga.renameMenu(e,{name:t}),await N(),!0}catch(a){return w.value=a.message||"Error al renombrar menú",!1}finally{b.value=!1}},deleteMenu:async e=>{b.value=!0,w.value=null;try{return await ga.deleteMenu(e),await N(),!0}catch(t){throw w.value=t.message||"Error al eliminar menú",t}finally{b.value=!1}},reorderMenus:async e=>{try{const t=e.map((e,t)=>({menu_id:e,display_order:t+1}));await ga.reorderMenus(t),h.value.sort((t,a)=>e.indexOf(t.id)-e.indexOf(a.id))}catch(t){console.error("Error reordenando menús",t)}},previewMenu:async e=>{try{const t=await ga.previewMenu(e);return URL.createObjectURL(t.data)}catch(t){return console.error("Error obteniendo preview",t),null}},cloneTable:async(e,t)=>{b.value=!0;try{const a=await ga.cloneTable(e,t);p.value.push(a.data)}catch(a){console.error("Error clonando mesa",a)}finally{b.value=!1}},generateQrCode:async e=>{b.value=!0,w.value=null;try{await ga.generateQRCode(e),await A()}catch(t){throw w.value=t.message||"Error al generar código QR",t}finally{b.value=!1}},regenerateQrCode:async e=>{b.value=!0,w.value=null;try{await ga.regenerateQRCode(e),await A()}catch(t){throw w.value=t.message||"Error al regenerar código QR",t}finally{b.value=!1}},getSettings:async()=>{var e;const t=await ga.getSettings();return(null==(e=t.data)?void 0:e.settings)||t.data},updateBusinessData:async e=>{var t;const a=await ga.updateSettings({settings:e});return(null==(t=a.data)?void 0:t.settings)||a.data},regenerateInvitation:async()=>{const e=(await ga.regenerateInvitationCode()).data||{};return l.value=e.invitation_code??l.value,c.value=e.invitation_url??c.value,e},selectActiveBusiness:T,createBusiness:async t=>{var a,n,s,o,r,d;b.value=!0,w.value=null;try{const o=await ga.createBusiness(t),r=o.data||{};return 201===o.status||r.business,t.value=r.business,e.value=null==(a=r.business)?void 0:a.id,i.value=null==(n=r.business)?void 0:n.id,l.value=null==(s=r.business)?void 0:s.invitation_code,c.value=r.invitation_url,k.value=!1,e.value&&localStorage.setItem("businessId",String(e.value)),r}catch(u){if(u.response&&422===u.response.status){const e=null==(o=u.response.data)?void 0:o.errors,t=e&&(null==(r=Object.values(e)[0])?void 0:r[0]);w.value=t||(null==(d=u.response.data)?void 0:d.message)||"Los datos proporcionados no son válidos"}else w.value=u.message||"Error al crear negocio";throw u}finally{b.value=!1}},joinBusinessWithCode:async a=>{var n,s;b.value=!0,w.value=null;try{const o=(await ga.joinBusiness(a)).data||{};return t.value=o.business,e.value=null==(n=o.business)?void 0:n.id,i.value=null==(s=o.business)?void 0:s.id,k.value=!1,e.value&&localStorage.setItem("businessId",String(e.value)),await S(),o}catch(o){throw w.value=o.message||"Error al unirse al negocio",o}finally{b.value=!1}},deleteBusiness:async a=>{var n,m;b.value=!0,w.value=null;try{const g=a??i.value??e.value;if(!g)throw new Error("No se encontró el ID del negocio a eliminar");const b=i.value===g||e.value===g,w=await ga.deleteBusiness(g);let y=[];try{const e=await ga.getAdminBusinesses();y=(null==(n=e.data)?void 0:n.businesses)??e.data??[],Array.isArray(y)||(y=[])}catch(f){y=(u.value||[]).filter(e=>e.id!==g)}if(u.value=y,d.value=y,y.length>0){if(k.value=!1,b){const t=y.find(e=>e.is_active)||y[0];if(null==t?void 0:t.id)try{await T(t.id)}catch(f){i.value=t.id,e.value=t.id,localStorage.setItem("businessId",String(t.id));try{await S(!0)}catch(v){}}}else if(!i.value&&(null==(m=y[0])?void 0:m.id))try{await T(y[0].id)}catch(f){}return{...w.data||{},redirected:"admin",active_business_id:i.value}}return i.value=null,e.value=null,t.value=null,h.value=[],p.value=[],l.value=null,c.value=null,s.value=0,o.value=0,r.value=0,k.value=!0,localStorage.removeItem("businessId"),{...w.data||{},redirected:"onboarding"}}catch(g){throw w.value=g.message||"Error al eliminar negocio",g}finally{b.value=!1}}}}),EE=Object.freeze(Object.defineProperty({__proto__:null,useAdminStore:CE},Symbol.toStringTag,{value:"Module"})),IE={key:0,class:"field-label"},SE={key:1,class:"edit-container"},TE=["type","placeholder"],NE=["placeholder","min","max"],AE=["value"],PE={key:1,class:"error-message"},RE={__name:"EditableField",props:{value:{type:[String,Number],default:""},label:{type:String,default:""},type:{type:String,default:"text"},placeholder:{type:String,default:""},options:{type:Array,default:()=>[]},editable:{type:Boolean,default:!0},min:{type:[Number,String],default:null},max:{type:[Number,String],default:null},unit:{type:String,default:""},displayValue:{type:String,default:""},hasError:{type:Boolean,default:!1},errorMessage:{type:String,default:""}},emits:["update:value"],setup(e,{emit:t}){const i=e,h=t,p=a(i.value),m=a(!1),f=a(null);E(()=>i.value,e=>{m.value||(p.value=e)});const g=n(()=>{if(i.displayValue)return i.displayValue;if("select"===i.type&&i.options.length){const e=i.options.find(e=>e.value===p.value);return e?e.label:p.value}return p.value+(i.unit?" "+i.unit:"")}),b=()=>{i.editable&&(m.value=!0,setTimeout(()=>{f.value&&f.value.focus()},100))},y=()=>{m.value=!1,h("update:value",p.value)},I=e=>{"Enter"===e.key?y():"Escape"===e.key&&(m.value=!1,p.value=i.value)},S=()=>{m.value=!1,p.value=i.value};return(t,a)=>(w(),s("div",{class:C(["editable-field",{"has-error":e.hasError}])},[e.label?(w(),s("div",IE,l(e.label),1)):r("",!0),o("div",{class:C(["field-content",{"is-editing":m.value,error:e.hasError}])},[m.value?(w(),s("div",SE,["text"===e.type||"email"===e.type||"tel"===e.type?d((w(),s("input",{key:0,ref_key:"inputRef",ref:f,type:e.type,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e),placeholder:e.placeholder,class:C(["edit-input",{"input-error":e.hasError}]),onKeydown:I,onChange:y,onBlur:S},null,42,TE)),[[x,p.value]]):"number"===e.type?d((w(),s("input",{key:1,ref_key:"inputRef",ref:f,type:"number","onUpdate:modelValue":a[1]||(a[1]=e=>p.value=e),placeholder:e.placeholder,min:e.min,max:e.max,class:C(["edit-input",{"input-error":e.hasError}]),onKeydown:I,onChange:y,onBlur:S},null,42,NE)),[[u,p.value]]):"date"===e.type?d((w(),s("input",{key:2,ref_key:"inputRef",ref:f,type:"date","onUpdate:modelValue":a[2]||(a[2]=e=>p.value=e),class:C(["edit-input",{"input-error":e.hasError}]),onKeydown:I,onChange:y,onBlur:S},null,34)),[[u,p.value]]):"textarea"===e.type?d((w(),s("textarea",{key:3,ref_key:"inputRef",ref:f,"onUpdate:modelValue":a[3]||(a[3]=e=>p.value=e),rows:"3",class:C(["edit-input",{"input-error":e.hasError}]),onKeydown:I,onChange:y,onBlur:S},null,34)),[[u,p.value]]):"select"===e.type?d((w(),s("select",{key:4,ref_key:"inputRef",ref:f,"onUpdate:modelValue":a[4]||(a[4]=e=>p.value=e),class:C(["edit-select",{"input-error":e.hasError}]),onChange:y,onBlur:S},[(w(!0),s(_,null,k(e.options,e=>(w(),s("option",{key:e.value,value:e.value},l(e.label),9,AE))),128))],34)),[[D,p.value]]):r("",!0),o("div",{class:"edit-actions"},[o("button",{type:"button",class:"action-button save-button",onClick:y},a[6]||(a[6]=[o("i",{class:"bi bi-check"},null,-1)])),o("button",{type:"button",class:"action-button cancel-button",onClick:S},a[7]||(a[7]=[o("i",{class:"bi bi-x"},null,-1)]))])])):(w(),s("div",{key:0,class:"display-value",onClick:b},[v(l(g.value)+" ",1),e.editable?(w(),s("button",{key:0,class:"edit-button",onClick:c(b,["stop"])},a[5]||(a[5]=[o("i",{class:"bi bi-pencil"},null,-1)]))):r("",!0)]))],2),e.hasError&&e.errorMessage?(w(),s("div",PE,l(e.errorMessage),1)):r("",!0)],2))}},xE=Mh(RE,[["__scopeId","data-v-8303ada0"]]),DE=["src","alt"],OE={key:0,class:"avatar-overlay"},LE={key:1,class:"avatar-loading"},ME={__name:"ProfileAvatar",props:{src:{type:String,default:""},alt:{type:String,default:"Foto de perfil"},editable:{type:Boolean,default:!1}},emits:["update:src","file-selected"],setup(e,{emit:t}){const n=e,i=t,l=a(n.src),c=a(!1),d=a(null);E(()=>n.src,e=>{l.value=e});const u=()=>{n.editable&&d.value&&d.value.click()},h=e=>{const t=e.target.files[0];if(!t)return;c.value=!0;const a=new FileReader;a.onload=e=>{l.value=e.target.result,i("update:src",l.value),i("file-selected",t),c.value=!1},a.readAsDataURL(t)};return(t,a)=>(w(),s("div",{class:C(["profile-avatar",{editable:e.editable}]),onClick:u},[o("img",{src:l.value,alt:e.alt,class:"avatar-image"},null,8,DE),e.editable?(w(),s("div",OE,a[0]||(a[0]=[o("i",{class:"bi bi-camera"},null,-1)]))):r("",!0),c.value?(w(),s("div",LE,a[1]||(a[1]=[o("div",{class:"spinner"},null,-1)]))):r("",!0),e.editable?(w(),s("input",{key:2,ref_key:"fileInput",ref:d,type:"file",accept:"image/*",class:"file-input",onChange:h},null,544)):r("",!0)],2))}},UE=Mh(ME,[["__scopeId","data-v-b3232b9c"]]),FE=["type","disabled"],qE={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},BE={__name:"BaseButton",props:{variant:{type:String,default:"primary",validator:e=>["primary","secondary","outline-primary","outline-secondary","success","danger","warning","info","light","dark","link"].includes(e)},size:{type:String,default:"",validator:e=>["","sm","lg"].includes(e)},block:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},type:{type:String,default:"button"}},emits:["click"],setup(e,{emit:t}){const a=e,i=t,l=n(()=>{const e=["btn"];return e.push(`btn-${a.variant}`),a.size&&e.push(`btn-${a.size}`),a.block&&e.push("w-100"),a.loading&&e.push("position-relative"),e.join(" ")}),c=e=>{a.disabled||a.loading||i("click",e)};return(t,a)=>(w(),s("button",{type:e.type,class:C(l.value),disabled:e.disabled||e.loading,onClick:c},[e.loading?(w(),s("div",qE)):r("",!0),o("span",{class:C({"opacity-0":e.loading})},[N(t.$slots,"default",{},void 0,!0)],2)],10,FE))}},jE=Mh(BE,[["__scopeId","data-v-9b101dda"]]),$E={class:"modal-content rounded-4"},zE={class:"modal-header"},VE={class:"modal-title"},WE={class:"modal-body"},HE={key:0,class:"modal-footer"},GE={__name:"BaseModal",props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:""},size:{type:String,default:"",validator:e=>["","sm","lg","xl"].includes(e)},centered:{type:Boolean,default:!0},scrollable:{type:Boolean,default:!1},staticBackdrop:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const i=e,c=t,d=a(null);let u=null;g(()=>{d.value&&(u=new W(d.value,{backdrop:!i.staticBackdrop||"static",keyboard:!i.staticBackdrop}),d.value.addEventListener("hidden.bs.modal",()=>{c("update:modelValue",!1)}),i.modelValue&&u.show())}),O(()=>{u&&u.dispose()}),E(()=>i.modelValue,e=>{!u&&d.value&&(u=new W(d.value,{backdrop:!i.staticBackdrop||"static",keyboard:!i.staticBackdrop})),e&&u?u.show():!e&&u&&u.hide()});const h=n(()=>{const e=["modal-dialog"];return i.centered&&e.push("modal-dialog-centered"),i.scrollable&&e.push("modal-dialog-scrollable"),i.size&&e.push(`modal-${i.size}`),e.join(" ")});return(t,a)=>(w(),s("div",{ref_key:"modalElement",ref:d,class:"modal fade",tabindex:"-1","aria-hidden":"true"},[o("div",{class:C(h.value)},[o("div",$E,[o("div",zE,[o("h5",VE,l(e.title),1),o("button",{type:"button",class:"btn-close",onClick:a[0]||(a[0]=e=>c("update:modelValue",!1)),"aria-label":"Close"})]),o("div",WE,[N(t.$slots,"default",{},void 0,!0)]),t.$slots.footer?(w(),s("div",HE,[N(t.$slots,"footer",{},void 0,!0)])):r("",!0)])],2)],512))}},KE=Mh(GE,[["__scopeId","data-v-aefedeba"]]),JE={class:"profile-container"},YE={key:0,class:"loading-container"},QE={key:1,class:"alert alert-danger"},ZE={key:2,class:"alert alert-success"},XE={key:3,class:"profile-content"},eI={key:0,class:"d-none profile-card completeness-card"},tI={class:"card-header"},aI={class:"completeness-percentage"},nI={class:"completeness-content"},iI={class:"progress-bar"},sI={class:"completeness-text"},oI={key:0,class:"missing-fields"},rI={class:"profile-card"},lI={class:"profile-main"},cI={class:"profile-image-section"},dI={class:"profile-data"},uI={class:"data-row"},hI={class:"data-row"},pI={key:0,class:"age-display"},mI={class:"data-row"},fI={class:"data-row"},vI={class:"data-row"},gI={class:"data-row"},bI={class:"profile-card"},wI={class:"profile-data"},yI={class:"data-row"},_I={class:"data-row"},kI={class:"data-row"},CI={class:"profile-card"},EI={class:"profile-data"},II={class:"data-row"},SI={class:"data-row"},TI={class:"data-row"},NI={class:"availability-toggle"},AI={class:"toggle-container"},PI={for:"availability-toggle",class:"toggle-label"},RI={class:"profile-card"},xI={class:"skills-section"},DI={class:"skills-list"},OI=["onClick"],LI={class:"add-skill"},MI={class:"profile-card"},UI={class:"card-header"},FI={class:"work-history"},qI={class:"work-item-header"},BI={class:"work-actions"},jI=["onClick"],$I=["onClick"],zI={class:"work-details"},VI={class:"work-dates"},WI={key:0,class:"work-description"},HI={key:0,class:"empty-state"},GI={class:"profile-card"},KI={class:"businesses-list"},JI={class:"business-main-info"},YI={class:"business-name"},QI={key:0,class:"business-code"},ZI={key:0,class:"business-stats"},XI={class:"stat-item"},eS={class:"stat-value"},tS={class:"stat-item"},aS={class:"stat-value"},nS={key:0,class:"stat-item"},iS={class:"stat-value"},sS={key:1,class:"stat-item"},oS={class:"stat-value"},rS={class:"business-actions"},lS=["onClick","disabled"],cS={key:0,class:"empty-state"},dS={class:"profile-card"},uS={class:"form-group"},hS=["disabled"],pS={class:"form-group"},mS=["disabled"],fS={key:0,class:"form-text error"},vS={class:"form-group"},gS=["disabled"],bS={key:0,class:"form-text error"},wS={key:0},yS={key:1},_S={class:"profile-card danger-zone"},kS={class:"danger-content"},CS={class:"form-group"},ES={class:"form-group"},IS={class:"form-group"},SS={class:"form-row"},TS={class:"form-group"},NS={class:"form-group"},AS={key:0},PS={key:1},RS={class:"delete-account-content"},xS={class:"form-group"},DS=["disabled"],OS={key:0},LS=Mh({__name:"Profile",setup(e){const t=b(),i=tn(),f=CE(),I=a({display_name:"",bio:"",phone:"",birth_date:"",height:null,weight:null,gender:"",experience_years:null,employment_type:"",current_schedule:"",current_location:"",latitude:null,longitude:null,availability_hours:[],skills:[],is_available:!0,avatar:"",business_id:null}),S=a([]),T=a([]),N=a({current:"",new:"",confirm:""}),A=a(!0),P=a(!1),R=a(""),x=a("");a(null),a(null);const D=a({}),O=a(!1),q=a(""),B=a(!1),j=a(!1),$=a(null),z=a({business_name:"",position:"",description:"",start_date:"",end_date:""}),V=a({is_complete:!1,missing_fields:[],completed_fields:0,total_required_fields:0,completion_percentage:0}),W=n(()=>!N.value.new||N.value.new.length>=8),H=n(()=>!N.value.new||!N.value.confirm||N.value.new===N.value.confirm),G=n(()=>{if(!I.value.birth_date)return null;const e=new Date(I.value.birth_date),t=new Date;let a=t.getFullYear()-e.getFullYear();const n=t.getMonth()-e.getMonth();return(n<0||0===n&&t.getDate()<e.getDate())&&a--,a}),K=[{value:"masculino",label:"Masculino"},{value:"femenino",label:"Femenino"},{value:"otro",label:"Otro"}],J=[{value:"full-time",label:"Tiempo completo"},{value:"part-time",label:"Medio tiempo"},{value:"hourly",label:"Por horas"},{value:"weekends-only",label:"Solo fines de semana"}],Y=async()=>{A.value=!0,R.value="";try{const e=(null==f?void 0:f.activeBusinessId)??localStorage.getItem("businessId")??null,t=(await ga.getActiveUserProfile(e?Number(e):null)).data.data.profile_data;I.value=t?{display_name:t.display_name||"",bio:t.bio||"",phone:t.phone||"",birth_date:t.birth_date||"",height:t.height||null,weight:t.weight||null,gender:t.gender||"",experience_years:t.experience_years||null,employment_type:t.employment_type||"",current_schedule:t.current_schedule||"",current_location:t.current_location||"",latitude:t.latitude||null,longitude:t.longitude||null,availability_hours:t.availability_hours||[],skills:t.skills||[],is_available:void 0===t.is_available||t.is_available,avatar:t.avatar||"",business_id:t.business_id}:{display_name:"Mozo",bio:"",phone:"",birth_date:"",height:null,weight:null,gender:"",experience_years:null,employment_type:"",current_schedule:"",current_location:"",latitude:null,longitude:null,availability_hours:[],skills:[],is_available:!0,avatar:"",business_id:null},await Q(),await Z()}catch(e){console.error("Error al cargar datos del usuario:",e),R.value="No se pudieron cargar tus datos. Por favor, inténtalo de nuevo."}finally{A.value=!1}},Q=async()=>{var e;try{const e=await ga.listWorkHistory();S.value=e.data.data.items||[]}catch(t){console.error("❌ Error al cargar historial laboral:",t),console.error("❌ Respuesta del error:",null==(e=t.response)?void 0:e.data),S.value=[]}},Z=async()=>{var e;try{console.log("🏪 Cargando negocios asociados activos hoy...");const e=await ga.getWaiterBusinessesActiveToday();console.log("🏪 Respuesta de businesses/active-today:",e.data),T.value=(e.data.businesses||[]).map(e=>({id:e.id,name:e.name,code:e.code,status:e.is_active?"active":"inactive",assigned_tables:e.assigned_tables||0,calls_today:e.calls_today||0,count:e.count||0,date:e.date,is_active:e.is_active})),console.log("🏪 Negocios procesados:",T.value)}catch(t){console.error("❌ Error al cargar negocios asociados:",t),console.error("❌ Respuesta del error:",null==(e=t.response)?void 0:e.data),T.value=[]}},X=async e=>{var t,a,n,i,s;if(e)if(e.size>2097152)R.value="La imagen no puede ser mayor a 2MB";else try{P.value=!0;const t=new FormData;I.value.display_name&&t.append("display_name",I.value.display_name),I.value.bio&&t.append("bio",I.value.bio),I.value.phone&&t.append("phone",I.value.phone),I.value.birth_date&&t.append("birth_date",I.value.birth_date),I.value.height&&t.append("height",I.value.height),I.value.weight&&t.append("weight",I.value.weight),I.value.gender&&t.append("gender",I.value.gender),I.value.experience_years&&t.append("experience_years",I.value.experience_years),I.value.employment_type&&t.append("employment_type",I.value.employment_type),I.value.current_schedule&&t.append("current_schedule",I.value.current_schedule),I.value.current_location&&t.append("current_location",I.value.current_location),I.value.latitude&&t.append("latitude",I.value.latitude),I.value.longitude&&t.append("longitude",I.value.longitude),t.append("availability_hours",JSON.stringify(I.value.availability_hours||[])),t.append("skills",JSON.stringify(I.value.skills||[])),t.append("is_available",I.value.is_available?"1":"0"),t.append("avatar",e);const a=await ga.updateWaiterUserProfile(t),n=new FileReader;n.onload=e=>{I.value.profile_picture=e.target.result},n.readAsDataURL(e),x.value=a.data.message||"Foto de perfil actualizada"}catch(o){422===(null==(t=o.response)?void 0:t.status)&&(null==(n=null==(a=o.response)?void 0:a.data)?void 0:n.errors)?(D.value=o.response.data.errors,R.value=o.response.data.message||"Por favor, corrige los errores en el formulario"):R.value=(null==(s=null==(i=o.response)?void 0:i.data)?void 0:s.message)||"Error al subir la imagen"}finally{P.value=!1,R.value||(await Y(),await te())}},ee=async(e,t)=>{var a,n,i,s,o;try{P.value=!0,D.value={},R.value="",I.value[e]=t;const a=new FormData;a.append(e,t||"");const n=await ga.updateWaiterUserProfile(a);n.data.data&&(I.value.avatar=n.data.data.avatar,I.value.display_name=n.data.data.display_name),x.value=n.data.message||"Campo actualizado correctamente"}catch(r){422===(null==(a=r.response)?void 0:a.status)&&(null==(i=null==(n=r.response)?void 0:n.data)?void 0:i.errors)?(D.value=r.response.data.errors,R.value=r.response.data.message||"Por favor, corrige los errores en el formulario"):R.value=(null==(o=null==(s=r.response)?void 0:s.data)?void 0:o.message)||`Error al actualizar ${e}`}finally{P.value=!1,R.value||(await Y(),await te())}},te=async()=>{try{const e=await ga.getProfileCompleteness();V.value=e.data}catch(e){console.error("Error checking profile completeness:",e)}},ae=async()=>{var e,t;if(N.value.current&&N.value.new&&N.value.confirm)if(W.value&&H.value)try{P.value=!0,await ga.changePassword({current_password:N.value.current,password:N.value.new,password_confirmation:N.value.confirm}),N.value.current="",N.value.new="",N.value.confirm="",x.value="Contraseña actualizada correctamente"}catch(a){R.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"Error al cambiar contraseña"}finally{P.value=!1}else R.value="Verifica que la contraseña sea válida y coincida";else R.value="Por favor completa todos los campos de contraseña"},ne=()=>{$.value=null,z.value={business_name:"",position:"",description:"",start_date:"",end_date:""},j.value=!0},ie=async()=>{var e,t;try{P.value=!0;const e={business_name:z.value.business_name,position:z.value.position,description:z.value.description||"",start_date:z.value.start_date,end_date:z.value.end_date||null};if($.value){const t=await ga.updateWorkHistory($.value.id,e),a=S.value.findIndex(e=>e.id===$.value.id);-1!==a&&(S.value[a]=t.data)}else{const t=await ga.addWorkHistory(e);S.value.push(t.data)}j.value=!1,x.value=$.value?"Experiencia actualizada correctamente":"Experiencia agregada correctamente"}catch(a){console.error("Error al guardar experiencia laboral:",a),R.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"Error al guardar experiencia laboral"}finally{P.value=!1}},se=async()=>{var e,a;if("ELIMINAR"===q.value){B.value=!0;try{await ga.deleteAccount({password:N.value.current}),await i.logout(),t.push({name:"login"})}catch(n){console.error("Error al eliminar cuenta:",n),R.value=(null==(a=null==(e=n.response)?void 0:e.data)?void 0:a.message)||"No se pudo eliminar la cuenta. Por favor, inténtalo de nuevo.",O.value=!1,q.value="",B.value=!1}}},oe=()=>{t.push({name:"waiter-dashboard"})};return g(()=>{Y(),te()}),y(),L((e,t)=>{Y(),te()}),E(x,e=>{e&&setTimeout(()=>{x.value=""},5e3)}),E(R,e=>{e&&setTimeout(()=>{R.value=""},8e3)}),(e,t)=>{var a,n,i,f,g,b,y,E,L,Y;const Q=F('else"');return w(),s("div",JE,[o("div",{class:"profile-header"},[o("button",{class:"back-button",onClick:oe},t[28]||(t[28]=[o("i",{class:"bi bi-arrow-left"},null,-1),v(" Volver ")]))]),A.value?(w(),s("div",YE,t[29]||(t[29]=[o("div",{class:"loading-spinner"},null,-1),o("p",null,"Cargando perfil...",-1)]))):r("",!0),R.value?(w(),s("div",QE,l(R.value),1)):r("",!0),x.value?(w(),s("div",ZE,l(x.value),1)):r("",!0),A.value?r("",!0):(w(),s("div",XE,[V.value.is_complete?r("",!0):(w(),s("div",eI,[o("div",tI,[t[30]||(t[30]=o("h3",null,"Completitud del Perfil",-1)),o("span",aI,l(V.value.completion_percentage)+"%",1)]),o("div",nI,[o("div",iI,[o("div",{class:"progress-fill",style:M({width:V.value.completion_percentage+"%"})},null,4)]),o("p",sI,l(V.value.completed_fields)+" de "+l(V.value.total_required_fields)+" campos completados ",1),(null==(n=null==(a=V.value)?void 0:a.missing_fields)?void 0:n.length)?(w(),s("div",oI,[t[31]||(t[31]=o("p",null,[o("strong",null,"Campos faltantes:")],-1)),o("ul",null,[(w(!0),s(_,null,k(V.value.missing_fields,e=>(w(),s("li",{key:e.field},l(e.label),1))),128))])])):r("",!0)])])),o("div",rI,[t[32]||(t[32]=o("div",{class:"card-header"},[o("h2",null,"Información Personal")],-1)),o("div",lI,[o("div",cI,[h(UE,{src:I.value.avatar,alt:`Foto de ${I.value.display_name}`,editable:!0,onFileSelected:X},null,8,["src","alt"])]),o("div",dI,[o("div",uI,[h(xE,{value:I.value.display_name,"onUpdate:value":t[0]||(t[0]=e=>ee("display_name",e)),type:"text",label:"Nombre para mostrar",placeholder:"Tu nombre como mozo",editable:!0,"has-error":!!D.value.display_name,"error-message":null==(i=D.value.display_name)?void 0:i[0]},null,8,["value","has-error","error-message"])]),o("div",hI,[h(xE,{value:I.value.birth_date,"onUpdate:value":t[1]||(t[1]=e=>ee("birth_date",e)),type:"date",label:"Fecha de nacimiento",editable:!0,"has-error":!!D.value.birth_date,"error-message":null==(f=D.value.birth_date)?void 0:f[0]},null,8,["value","has-error","error-message"]),G.value?(w(),s("div",pI," Edad: "+l(G.value)+" años ",1)):r("",!0)]),o("div",mI,[h(xE,{value:I.value.height,"onUpdate:value":t[2]||(t[2]=e=>ee("height",e)),type:"number",label:"Estatura",min:1,max:2.5,step:.01,unit:"mt",editable:!0,"has-error":!!D.value.height,"error-message":null==(g=D.value.height)?void 0:g[0]},null,8,["value","has-error","error-message"])]),o("div",fI,[h(xE,{value:I.value.weight,"onUpdate:value":t[3]||(t[3]=e=>ee("weight",e)),type:"number",label:"Peso",min:30,max:200,unit:"kg",editable:!0,"has-error":!!D.value.weight,"error-message":null==(b=D.value.weight)?void 0:b[0]},null,8,["value","has-error","error-message"])]),o("div",vI,[h(xE,{value:I.value.gender,"onUpdate:value":t[4]||(t[4]=e=>ee("gender",e)),type:"select",label:"Sexo",options:K,editable:!0,"has-error":!!D.value.gender,"error-message":null==(y=D.value.gender)?void 0:y[0]},null,8,["value","has-error","error-message"])]),o("div",gI,[h(xE,{value:I.value.experience_years,"onUpdate:value":t[5]||(t[5]=e=>ee("experience_years",e)),type:"number",label:"Años de experiencia",min:0,max:50,unit:"años",editable:!0},null,8,["value"])])])])]),o("div",bI,[t[33]||(t[33]=o("div",{class:"card-header"},[o("h3",null,"Información de Contacto")],-1)),o("div",wI,[o("div",yI,[h(xE,{value:I.value.current_location,"onUpdate:value":t[6]||(t[6]=e=>ee("current_location",e)),type:"text",label:"Ubicación actual",editable:!0},null,8,["value"])]),o("div",_I,[h(xE,{value:I.value.phone,"onUpdate:value":t[7]||(t[7]=e=>ee("phone",e)),type:"tel",label:"Teléfono",editable:!0,"has-error":!!D.value.phone,"error-message":null==(E=D.value.phone)?void 0:E[0]},null,8,["value","has-error","error-message"])]),o("div",kI,[h(xE,{value:I.value.bio,"onUpdate:value":t[8]||(t[8]=e=>ee("bio",e)),type:"textarea",label:"Descripción personal",editable:!0},null,8,["value"])])])]),o("div",CI,[t[35]||(t[35]=o("div",{class:"card-header"},[o("h3",null,"Información Laboral")],-1)),o("div",EI,[o("div",II,[h(xE,{value:I.value.employment_type,"onUpdate:value":t[9]||(t[9]=e=>ee("employment_type",e)),type:"select",label:"Modalidad",options:J,editable:!0,"has-error":!!D.value.employment_type,"error-message":null==(L=D.value.employment_type)?void 0:L[0]},null,8,["value","has-error","error-message"])]),o("div",SI,[h(xE,{value:I.value.current_schedule,"onUpdate:value":t[10]||(t[10]=e=>ee("current_schedule",e)),type:"text",label:"Horario de trabajo actual",editable:!0,"has-error":!!D.value.current_schedule,"error-message":null==(Y=D.value.current_schedule)?void 0:Y[0]},null,8,["value","has-error","error-message"])]),o("div",TI,[o("div",NI,[t[34]||(t[34]=o("label",{class:"form-label"},"Disponibilidad",-1)),o("div",AI,[d(o("input",{type:"checkbox",id:"availability-toggle","onUpdate:modelValue":t[11]||(t[11]=e=>I.value.is_available=e),onChange:t[12]||(t[12]=e=>ee("is_available",I.value.is_available)),class:"toggle-input"},null,544),[[p,I.value.is_available]]),o("label",PI,l(I.value.is_available?"Disponible":"No disponible"),1)])])])])]),o("div",RI,[t[37]||(t[37]=o("div",{class:"card-header"},[o("h3",null,"Habilidades")],-1)),o("div",xI,[o("div",DI,[(w(!0),s(_,null,k(I.value.skills,e=>(w(),s("span",{key:e,class:"skill-tag"},[v(l(e)+" ",1),o("button",{onClick:t=>(e=>{I.value.skills=I.value.skills.filter(t=>t!==e),ee("skills",I.value.skills)})(e),class:"skill-remove"},t[36]||(t[36]=[o("i",{class:"bi bi-x"},null,-1)]),8,OI)]))),128))]),o("div",LI,[o("input",{type:"text",placeholder:"Agregar habilidad",onKeyup:t[13]||(t[13]=U(e=>{var t;(t=e.target.value)&&!I.value.skills.includes(t)&&(I.value.skills.push(t),ee("skills",I.value.skills)),e.target.value=""},["enter"])),class:"skill-input"},null,32)])])]),o("div",MI,[o("div",UI,[t[39]||(t[39]=o("h3",null,"Historial Laboral",-1)),h(jE,{onClick:ne,variant:"primary",size:"sm"},{default:m(()=>t[38]||(t[38]=[o("i",{class:"bi bi-plus"},null,-1),v(" Agregar Experiencia ")])),_:1,__:[38]})]),o("div",FI,[(w(!0),s(_,null,k(S.value,e=>(w(),s("div",{key:e.id,class:"work-item"},[o("div",qI,[o("h4",null,l(e.position)+" - "+l(e.business_name),1),o("div",BI,[o("button",{onClick:t=>(e=>{$.value=e,z.value={...e},j.value=!0})(e),class:"btn btn-sm btn-outline-primary"},t[40]||(t[40]=[o("i",{class:"bi bi-pencil"},null,-1)]),8,jI),o("button",{onClick:t=>(async e=>{var t,a;if(confirm("¿Estás seguro de que deseas eliminar esta experiencia laboral?"))try{P.value=!0,await ga.deleteWorkHistory(e),S.value=S.value.filter(t=>t.id!==e),x.value="Experiencia eliminada correctamente"}catch(n){console.error("Error al eliminar experiencia:",n),R.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al eliminar experiencia"}finally{P.value=!1}})(e.id),class:"btn btn-sm btn-outline-danger"},t[41]||(t[41]=[o("i",{class:"bi bi-trash"},null,-1)]),8,$I)])]),o("div",zI,[o("div",VI,l(e.start_date)+l(e.end_date?" - "+e.end_date:" - Actualidad"),1),e.description?(w(),s("div",WI,l(e.description),1)):r("",!0)])]))),128)),S.value.length?r("",!0):(w(),s("div",HI," No has agregado experiencia laboral aún. "))])]),o("div",GI,[t[47]||(t[47]=o("div",{class:"card-header"},[o("h3",null,"Negocios Asociados Hoy")],-1)),o("div",KI,[(w(!0),s(_,null,k(T.value,e=>(w(),s("div",{key:e.id,class:"business-item detailed"},[o("div",JI,[o("div",YI,l(e.name),1),e.code?(w(),s("div",QI,"Código: "+l(e.code),1)):r("",!0),o("div",{class:C(["business-status",e.status])},l(e.is_active?"Activo hoy":"Inactivo"),3)]),e.is_active?(w(),s("div",ZI,[o("div",XI,[t[42]||(t[42]=o("span",{class:"stat-label"},"Mesas asignadas:",-1)),o("span",eS,l(e.assigned_tables||0),1)]),o("div",tS,[t[43]||(t[43]=o("span",{class:"stat-label"},"Llamadas hoy:",-1)),o("span",aS,l(e.calls_today||0),1)]),void 0!==e.count?(w(),s("div",nS,[t[44]||(t[44]=o("span",{class:"stat-label"},"Total:",-1)),o("span",iS,l(e.count),1)])):r("",!0),e.date?(w(),s("div",sS,[t[45]||(t[45]=o("span",{class:"stat-label"},"Fecha:",-1)),o("span",oS,l(new Date(e.date).toLocaleDateString()),1)])):r("",!0)])):r("",!0),o("div",rS,[o("button",{onClick:t=>(async(e,t)=>{var a,n,i;if(confirm(`¿Estás seguro de que deseas abandonar el negocio "${t}"?`))try{P.value=!0,console.log("🚪 Abandonando negocio:",{businessId:e,businessName:t});const a=await ga.leaveBusinessAsWaiter({business_id:e});console.log("🚪 Respuesta de leave-business:",a.data),await Z(),x.value=`Has abandonado el negocio "${t}" correctamente`}catch(s){console.error("❌ Error al abandonar negocio:",s),console.error("❌ Respuesta del error:",null==(a=s.response)?void 0:a.data),R.value=(null==(i=null==(n=s.response)?void 0:n.data)?void 0:i.message)||"Error al abandonar el negocio"}finally{P.value=!1}})(e.id,e.name),class:"btn btn-sm btn-outline-danger",disabled:P.value},t[46]||(t[46]=[o("i",{class:"bi bi-box-arrow-left"},null,-1),v(" Abandonar ")]),8,lS)])]))),128)),T.value.length?r("",!0):(w(),s("div",cS," No estás asociado a ningún negocio actualmente. "))])]),o("div",dS,[t[51]||(t[51]=o("div",{class:"card-header"},[o("h3",null,"Cambiar Contraseña")],-1)),o("form",{onSubmit:c(ae,["prevent"]),class:"password-form"},[o("div",uS,[t[48]||(t[48]=o("label",null,"Contraseña actual",-1)),d(o("input",{type:"password","onUpdate:modelValue":t[14]||(t[14]=e=>N.value.current=e),class:"form-control",disabled:P.value},null,8,hS),[[u,N.value.current]])]),o("div",pS,[t[49]||(t[49]=o("label",null,"Nueva contraseña",-1)),d(o("input",{type:"password","onUpdate:modelValue":t[15]||(t[15]=e=>N.value.new=e),class:"form-control",disabled:P.value},null,8,mS),[[u,N.value.new]]),N.value.new&&!W.value?(w(),s("div",fS," La contraseña debe tener al menos 8 caracteres ")):r("",!0)]),o("div",vS,[t[50]||(t[50]=o("label",null,"Confirmar nueva contraseña",-1)),d(o("input",{type:"password","onUpdate:modelValue":t[16]||(t[16]=e=>N.value.confirm=e),class:"form-control",disabled:P.value},null,8,gS),[[u,N.value.confirm]]),N.value.confirm&&!H.value?(w(),s("div",bS," Las contraseñas no coinciden ")):r("",!0)]),h(jE,{type:"submit",variant:"primary",disabled:P.value||!N.value.current||!N.value.new||!N.value.confirm||!W.value||!H.value},{default:m(()=>[P.value?(w(),s("span",wS,"Actualizando...")):(w(),s("span",yS,"Cambiar Contraseña"))]),_:1},8,["disabled"])],32)]),o("div",_S,[t[54]||(t[54]=o("div",{class:"card-header"},[o("h3",null,"Zona de Peligro")],-1)),o("div",kS,[t[53]||(t[53]=o("p",null,"Una vez que elimines tu cuenta, no hay vuelta atrás. Por favor, está seguro.",-1)),h(jE,{onClick:t[17]||(t[17]=e=>O.value=!0),variant:"danger",disabled:P.value},{default:m(()=>t[52]||(t[52]=[v(" Eliminar Cuenta ")])),_:1,__:[52]},8,["disabled"])])])])),h(KE,{modelValue:j.value,"onUpdate:modelValue":t[24]||(t[24]=e=>j.value=e),title:$.value?"Editar Experiencia":"Agregar Experiencia",size:"md"},{footer:m(()=>[h(jE,{onClick:t[23]||(t[23]=e=>j.value=!1),variant:"secondary"},{default:m(()=>t[60]||(t[60]=[v(" Cancelar ")])),_:1,__:[60]}),h(jE,{onClick:ie,variant:"primary",disabled:P.value},{default:m(()=>[P.value?(w(),s("span",AS,"Guardando...")):(w(),s("span",PS,"Guardar"))]),_:1},8,["disabled"])]),default:m(()=>[o("form",{onSubmit:c(ie,["prevent"])},[o("div",CS,[t[55]||(t[55]=o("label",null,"Nombre del local/empresa",-1)),d(o("input",{type:"text","onUpdate:modelValue":t[18]||(t[18]=e=>z.value.business_name=e),class:"form-control",required:""},null,512),[[u,z.value.business_name]])]),o("div",ES,[t[56]||(t[56]=o("label",null,"Cargo",-1)),d(o("input",{type:"text","onUpdate:modelValue":t[19]||(t[19]=e=>z.value.position=e),class:"form-control",required:""},null,512),[[u,z.value.position]])]),o("div",IS,[t[57]||(t[57]=o("label",null,"Descripción del puesto",-1)),d(o("textarea",{"onUpdate:modelValue":t[20]||(t[20]=e=>z.value.description=e),class:"form-control",rows:"3"},null,512),[[u,z.value.description]])]),o("div",SS,[o("div",TS,[t[58]||(t[58]=o("label",null,"Fecha de ingreso",-1)),d(o("input",{type:"date","onUpdate:modelValue":t[21]||(t[21]=e=>z.value.start_date=e),class:"form-control",required:""},null,512),[[u,z.value.start_date]])]),o("div",NS,[t[59]||(t[59]=o("label",null,"Fecha de salida (opcional)",-1)),d(o("input",{type:"date","onUpdate:modelValue":t[22]||(t[22]=e=>z.value.end_date=e),class:"form-control"},null,512),[[u,z.value.end_date]])])])],32)]),_:1},8,["modelValue","title"]),h(KE,{modelValue:O.value,"onUpdate:modelValue":t[27]||(t[27]=e=>O.value=e),title:"Eliminar Cuenta",size:"md"},{footer:m(()=>[h(jE,{onClick:t[26]||(t[26]=e=>O.value=!1),variant:"secondary",disabled:B.value},{default:m(()=>t[64]||(t[64]=[v(" Cancelar ")])),_:1,__:[64]},8,["disabled"]),h(jE,{onClick:se,variant:"danger",disabled:"ELIMINAR"!==q.value||B.value},{default:m(()=>[B.value?(w(),s("span",OS,"Eliminando...")):r("",!0),d((w(),s("span",null,t[65]||(t[65]=[v("Eliminar mi cuenta")]))),[[Q]])]),_:1},8,["disabled"])]),default:m(()=>[o("div",RS,[t[62]||(t[62]=o("p",null,"¿Estás seguro de que deseas eliminar tu cuenta? Esta acción no se puede deshacer.",-1)),t[63]||(t[63]=o("div",{class:"alert alert-danger"},[o("i",{class:"bi bi-exclamation-triangle-fill"}),v(" Al eliminar tu cuenta perderás todo el acceso a tus datos y negocios asociados. ")],-1)),o("div",xS,[t[61]||(t[61]=o("label",null,'Escribe "ELIMINAR" para confirmar',-1)),d(o("input",{type:"text","onUpdate:modelValue":t[25]||(t[25]=e=>q.value=e),class:"form-control",disabled:B.value},null,8,DS),[[u,q.value]])])])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-bce4d566"]]),MS=t("waiter",()=>{const e=a(localStorage.getItem("waiterBusinessId")||null),t=a(null),i=a([]),s=a([]),o=a([]),r=a(!1),l=a(null),c=n(()=>!!e.value),d=n(()=>o.value.filter(e=>"pending"===e.status).sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp))),u=e=>({...e,name:String(e.number),notifications_on:e.notifications_enabled??!0,is_muted:!(e.notifications_enabled??1),color:e.color??null,alert:!1}),h=async()=>{var e,t,a;if(c.value){r.value=!0,l.value=null;try{const[t,a,n]=await Promise.all([ga.getWaiterTables(),ga.getWaiterTableProfiles(),ga.getWaiterNotifications()]),r=(null==(e=t.data)?void 0:e.tables)??t.data;i.value=Array.isArray(r)?r.map(u):[];const l=null==a?void 0:a.data;s.value=Array.isArray(l)?l:Array.isArray(null==l?void 0:l.profiles)?l.profiles:[],o.value=n.data}catch(n){l.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al cargar los datos iniciales.",console.error(n)}finally{r.value=!1}}};return{businessId:e,businessData:t,tables:i,profiles:s,notifications:o,isLoading:r,error:l,isAssociated:c,activeNotifications:d,associateBusiness:async a=>{var n,i;r.value=!0,l.value=null;try{const n=await ga.waiterOnboard(a),{business:i}=n.data;return e.value=i.id,t.value=i,localStorage.setItem("waiterBusinessId",i.id),!0}catch(s){throw l.value=(null==(i=null==(n=s.response)?void 0:n.data)?void 0:i.message)||"Error al asociar el negocio.",s}finally{r.value=!1}},fetchInitialData:h,toggleTableNotifications:async e=>{var t,a;const n=e.notifications_on;e.notifications_on=!n,e.is_muted=!e.notifications_on;try{await ga.toggleTableNotifications(e.id,{value:e.notifications_on})}catch(i){e.notifications_on=n,e.is_muted=!n,l.value=(null==(a=null==(t=i.response)?void 0:t.data)?void 0:a.message)||"Error al actualizar la mesa.",console.error(i)}},fetchNotifications:async()=>{try{const e=await ga.getWaiterNotifications();o.value=e.data}catch(e){console.error("Error fetching notifications:",e)}},handleNotification:async(e,t)=>{var a,n;try{await ga.handleWaiterNotification(e,{action:t}),o.value=o.value.filter(t=>t.id!==e)}catch(i){l.value=(null==(n=null==(a=i.response)?void 0:a.data)?void 0:n.message)||"Error al procesar la notificación.",console.error(i)}},createProfile:async e=>{var t,a;try{const t=await ga.createWaiterTableProfile(e);return await h(),null==t?void 0:t.data}catch(n){throw l.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al crear el perfil.",console.error(n),n}},deleteProfile:async e=>{var t,a;try{await ga.deleteWaiterTableProfile(e),s.value=s.value.filter(t=>t.id!==e)}catch(n){l.value=(null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al eliminar el perfil.",console.error(n)}},clearWaiterData:()=>{e.value=null,t.value=null,i.value=[],s.value=[],o.value=[],localStorage.removeItem("waiterBusinessId")}}}),US={class:"onboarding-container"},FS={class:"content-wrapper"},qS=["src"],BS={class:"form-container"},jS=["disabled"],$S={key:0,class:"spinner"},zS={key:1},VS=["onInput","onKeydown"],WS={key:0,class:"error-feedback"},HS=Mh({__name:"Onboarding",setup(e){const t=b(),n=MS(),d=tn(),u=a(["","","",""]),h=a(!1),p=a(""),m=a([]),f=e=>{e.preventDefault();const t=e.clipboardData.getData("text").trim().slice(0,4);/^\d{4}$/.test(t)&&(t.split("").forEach((e,t)=>{u.value[t]=e,m.value[t].value=e}),m.value[3].focus(),v())},v=async()=>{const e=u.value.join("");if(4===e.length){h.value=!0,p.value="";try{await n.associateBusiness(e),await d.fetchUser(),t.push({name:"waiter-dashboard"})}catch(a){p.value=a.message||"El código es incorrecto o ha expirado.","vibrate"in navigator&&navigator.vibrate(100)}finally{h.value=!1}}else p.value="El código debe tener 4 dígitos."},g=()=>{t.push({name:"profile"})};return(e,t)=>{var a;return w(),s("div",US,[o("div",FS,[o("div",{class:"user-header",onClick:g,title:"Editar perfil"},[o("img",{src:(null==(a=i(d).user)?void 0:a.avatar)||"/src/assets/default-avatar.png",alt:"Avatar",class:"user-avatar"},null,8,qS),t[0]||(t[0]=o("div",{class:"business-selector-wrapper",title:"Vincúlate introduciendo un código"},[o("span",null,"Negocio:"),o("select",{disabled:""},[o("option",null,"Ninguno")])],-1))]),o("div",BS,[o("form",{onSubmit:c(v,["prevent"])},[o("button",{type:"submit",class:"btn-primary",disabled:h.value},[h.value?(w(),s("span",$S)):(w(),s("span",zS,"AGREGAR NEGOCIO"))],8,jS),t[1]||(t[1]=o("h2",{class:"code-prompt"},"Código",-1)),o("div",{class:"otp-inputs",onPaste:f},[(w(),s(_,null,k(4,e=>o("input",{key:e,type:"text",inputmode:"numeric",maxlength:"1",class:"otp-box",ref_for:!0,ref:t=>m.value[e-1]=t,onInput:t=>((e,t)=>{const a=e.target;let n=a.value;/^\d*$/.test(n)?(u.value[t-1]=n,n&&a.nextElementSibling&&a.nextElementSibling.focus()):a.value=""})(t,e),onKeydown:e=>{var t;"Backspace"===(t=e).key&&!t.target.value&&t.target.previousElementSibling&&t.target.previousElementSibling.focus()}},null,40,VS)),64))],32)],32),p.value?(w(),s("p",WS,l(p.value),1)):r("",!0)])])])}}},[["__scopeId","data-v-8759152c"]]),GS={class:"staff-invitations"},KS={class:"container"},JS={key:0,class:"loading-state"},YS={key:1,class:"empty-state"},QS={key:2,class:"invitations-grid"},ZS={class:"card-header"},XS={class:"business-info"},eT={class:"business-logo"},tT=["src","alt"],aT={key:1,class:"fas fa-building"},nT={class:"business-details"},iT={class:"position"},sT={key:0},oT={key:1},rT={key:2},lT={class:"card-body"},cT={class:"invitation-details"},dT={key:0,class:"detail-item"},uT={key:1,class:"detail-item"},hT={class:"detail-item"},pT={key:0,class:"invitation-message"},mT={key:0,class:"card-actions"},fT=["onClick","disabled"],vT={key:0,class:"fas fa-spinner fa-spin"},gT={key:1,class:"fas fa-check"},bT=["onClick","disabled"],wT={key:0,class:"fas fa-spinner fa-spin"},yT={key:1,class:"fas fa-times"},_T={key:1,class:"card-actions"},kT={key:3,class:"back-button"},CT=Mh({__name:"StaffInvitations",setup(e){const t=b(),n=tn(),i=a([]),c=a(!1),d=a(!1),u=a(null),h=e=>{if(!e.invitation_sent_at)return!1;const t=new Date(e.invitation_sent_at);return(new Date-t)/864e5>7},p=e=>{if(!e)return"Fecha desconocida";const t=new Date(e),a=new Date,n=Math.abs(a-t),i=Math.ceil(n/864e5);return 1===i?"hace 1 día":i<7?`hace ${i} días`:t.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})};return g(()=>{(async()=>{var e,t,a;c.value=!0;try{const n=(null==(a=null==(t=null==(e=(await ga.getWaiterNotifications()).data)?void 0:e.unread_notifications)?void 0:t.filter(e=>"staff_invitation"===e.type))?void 0:a.map(e=>{var t,a,n,i,s,o,r,l;return{id:(null==(t=e.data)?void 0:t.staff_invitation_id)||e.id,business_name:null==(a=e.data)?void 0:a.business_name,business_logo:null==(n=e.data)?void 0:n.business_logo,business_address:null==(i=e.data)?void 0:i.business_address,position:(null==(s=e.data)?void 0:s.position)||"Mozo",salary:null==(o=e.data)?void 0:o.salary,status:"invited",invitation_sent_at:e.created_at,invitation_token:null==(r=e.data)?void 0:r.invitation_token,notes:null==(l=e.data)?void 0:l.message}}))||[];i.value=n}catch(n){console.error("Error loading invitations:",n),or("Error al cargar invitaciones")}finally{c.value=!1}})()}),(e,a)=>(w(),s("div",GS,[o("div",KS,[a[15]||(a[15]=o("div",{class:"header"},[o("h1",null,[o("i",{class:"fas fa-envelope"}),v(" Invitaciones de Trabajo ")]),o("p",{class:"subtitle"},"Revisa y gestiona tus invitaciones para trabajar en diferentes negocios")],-1)),c.value?(w(),s("div",JS,a[2]||(a[2]=[o("div",{class:"spinner"},null,-1),o("p",null,"Cargando invitaciones...",-1)]))):0===i.value.length?(w(),s("div",YS,[a[4]||(a[4]=o("div",{class:"empty-icon"},[o("i",{class:"fas fa-inbox"})],-1)),a[5]||(a[5]=o("h3",null,"No tienes invitaciones",-1)),a[6]||(a[6]=o("p",null,"Cuando los administradores te inviten a trabajar, aparecerán aquí.",-1)),o("button",{onClick:a[0]||(a[0]=t=>e.$router.push("/waiter/dashboard")),class:"btn btn-primary"},a[3]||(a[3]=[o("i",{class:"fas fa-arrow-left"},null,-1),v(" Volver al Dashboard ")]))])):(w(),s("div",QS,[(w(!0),s(_,null,k(i.value,e=>(w(),s("div",{key:e.id,class:C(["invitation-card",{expired:h(e)}])},[o("div",ZS,[o("div",XS,[o("div",eT,[e.business_logo?(w(),s("img",{key:0,src:e.business_logo,alt:e.business_name},null,8,tT)):(w(),s("i",aT))]),o("div",nT,[o("h3",null,l(e.business_name),1),o("p",iT,l(e.position||"Mozo"),1)])]),o("div",{class:C(["invitation-status",e.status])},["invited"===e.status?(w(),s("span",sT,"📩 Pendiente")):"confirmed"===e.status?(w(),s("span",oT,"✅ Aceptada")):"rejected"===e.status?(w(),s("span",rT,"❌ Rechazada")):r("",!0)],2)]),o("div",lT,[o("div",cT,[e.business_address?(w(),s("div",dT,[a[7]||(a[7]=o("i",{class:"fas fa-map-marker-alt"},null,-1)),o("span",null,l(e.business_address),1)])):r("",!0),e.salary?(w(),s("div",uT,[a[8]||(a[8]=o("i",{class:"fas fa-dollar-sign"},null,-1)),o("span",null,"$"+l(e.salary.toLocaleString()),1)])):r("",!0),o("div",hT,[a[9]||(a[9]=o("i",{class:"fas fa-clock"},null,-1)),o("span",null,"Invitado "+l(p(e.invitation_sent_at)),1)])]),e.notes?(w(),s("div",pT,[a[10]||(a[10]=o("i",{class:"fas fa-comment"},null,-1)),o("p",null,l(e.notes),1)])):r("",!0)]),"invited"!==e.status||h(e)?h(e)?(w(),s("div",_T,a[13]||(a[13]=[o("div",{class:"expired-message"},[o("i",{class:"fas fa-exclamation-triangle"}),v(" Esta invitación ha expirado ")],-1)]))):r("",!0):(w(),s("div",mT,[o("button",{onClick:a=>(async e=>{var a,s,o,r;d.value=!0,u.value=e.id;try{const o={user_id:n.user.id},r=await ga.joinStaffWithToken(e.invitation_token,o);if(!(null==(a=r.data)?void 0:a.success)&&!r.success)throw new Error((null==(s=r.data)?void 0:s.message)||"Error al aceptar invitación");{sr(`¡Te has unido exitosamente a ${e.business_name}!`),Xw(e.business_name);const a=i.value.findIndex(t=>t.id===e.id);-1!==a&&(i.value[a].status="confirmed"),setTimeout(()=>{t.push("/waiter/dashboard")},2e3)}}catch(l){console.error("Error accepting invitation:",l);const e=(null==(r=null==(o=l.response)?void 0:o.data)?void 0:r.message)||l.message||"Error al aceptar invitación";or(e)}finally{d.value=!1,u.value=null}})(e),disabled:d.value,class:"btn btn-success"},[d.value&&u.value===e.id?(w(),s("i",vT)):(w(),s("i",gT)),a[11]||(a[11]=v(" Aceptar "))],8,fT),o("button",{onClick:t=>(async e=>{d.value=!0,u.value=e.id;try{sr(`Has declinado la invitación de ${e.business_name}`);const t=i.value.findIndex(t=>t.id===e.id);-1!==t&&(i.value[t].status="rejected")}catch(t){console.error("Error declining invitation:",t),or("Error al declinar invitación")}finally{d.value=!1,u.value=null}})(e),disabled:d.value,class:"btn btn-danger"},[d.value&&u.value===e.id?(w(),s("i",wT)):(w(),s("i",yT)),a[12]||(a[12]=v(" Declinar "))],8,bT)]))],2))),128))])),i.value.length>0?(w(),s("div",kT,[o("button",{onClick:a[1]||(a[1]=t=>e.$router.push("/waiter/dashboard")),class:"btn btn-outline"},a[14]||(a[14]=[o("i",{class:"fas fa-arrow-left"},null,-1),v(" Volver al Dashboard ")]))])):r("",!0)])]))}},[["__scopeId","data-v-35a9f1e6"]]),ET={class:"dashboard"},IT={class:"container py-3"},ST={class:"role-section"},TT={key:0,class:"business-dropdown ms-auto me-2"},NT=["disabled"],AT={key:0,class:"bi bi-arrow-clockwise spin ms-1"},PT=["onClick"],RT={key:0,class:"text-success ms-2"},xT={class:"user-id-container d-flex align-items-center ms-auto"},DT={class:"user-id me-2"},OT={key:0,class:"text-center py-5"},LT={key:1,class:"alert alert-danger"},MT={key:2},UT={key:0,class:"alert alert-warning d-flex justify-content-between align-items-center"},FT={class:"card mb-3"},qT={class:"card-body d-flex flex-wrap align-items-center justify-content-between gap-3"},BT={class:"me-auto"},jT={class:"mb-1"},$T={class:"text-muted small"},zT={class:"d-flex gap-3"},VT={class:"text-center"},WT={class:"fw-bold"},HT={class:"text-center"},GT={class:"fw-bold"},KT={class:"text-center"},JT={class:"fw-bold"},YT={class:"card-footer d-flex flex-wrap align-items-center gap-2"},QT={class:"me-auto small"},ZT={key:0,class:"ms-2"},XT=["href"],eN={class:"row g-3 card-grid"},tN={class:"col-6"},aN={class:"col-6"},nN={class:"col-6"},iN={class:"col-6"},sN=Mh({__name:"Home",setup(e){const t=b(),c=CE();tn();const d=a(!1),u=a(""),p=a(!1),y=a(!1),S=a("");let T;const N=n(()=>c.availableBusinesses||[]),A=n(()=>{var e,t,a;const n=N.value.find(e=>e.id===c.activeBusinessId);return(null==(e=c.businessData)?void 0:e.id)===c.activeBusinessId&&(null==(t=c.businessData)?void 0:t.name)?c.businessData.name:(null==n?void 0:n.name)||(null==(a=c.businessData)?void 0:a.name)||"Negocio"}),P=a({activeRequests:0,pendingRequests:0,totalOrders:0,totalSales:0,salesThisMonth:0}),x=async()=>{try{let e=c.businessData;if(e&&e.id||(e=await c.fetchBusinessData()),c.requiresBusinessSetup||(null==e?void 0:e.requires_business_setup))return void t.replace({name:"admin-onboard"});const a=[];c.requiresBusinessSetup||c.availableBusinesses&&0!==c.availableBusinesses.length||a.push(c.fetchAllBusinesses().catch(e=>{console.warn("Error al cargar lista de negocios:",e)})),c.staffRequests&&0!==c.staffRequests.length||a.push(c.fetchStaffRequests()),a.push(c.fetchDashboardStats().then(e=>{P.value=e})),await Promise.allSettled(a),c.businessData&&c.invitationCode&&(S.value=c.invitationCode)}catch(e){u.value=e.message||"Error al cargar datos del negocio"}};g(async()=>{d.value=!0,u.value="",await x(),T=e=>{const t=document.querySelector(".business-dropdown");t&&!t.contains(e.target)&&(p.value=!1)},document.addEventListener("click",T),d.value=!1}),I(()=>{T&&document.removeEventListener("click",T)});const D=()=>{c.businessId&&navigator.clipboard.writeText(c.businessId).then(()=>{alert("ID de negocio copiado al portapapeles")}).catch(()=>{alert("No se pudo copiar el ID de negocio")})},O=()=>{p.value=!p.value},L=()=>{navigator.clipboard.writeText(S.value).then(()=>{console.log("Código copiado al portapapeles")}).catch(e=>{console.error("Error al copiar al portapapeles:",e)})};return E(()=>c.activeBusinessId,async(e,t)=>{if(e&&e!==t)try{d.value=!0,await c.fetchBusinessData(!0),S.value=c.invitationCode||"",await x()}catch(a){console.warn("No se pudo refrescar datos tras cambio de negocio:",a)}finally{d.value=!1}}),(e,t)=>{var a;const n=f("RouterLink");return w(),s("div",ET,[o("div",IT,[o("div",ST,[t[7]||(t[7]=R('<div class="role-dropdown me-2" data-v-3faf224c><button class="btn btn-outline-secondary dropdown-toggle" id="roleMenu" data-bs-toggle="dropdown" data-v-3faf224c> Rol Admin </button><ul class="dropdown-menu" aria-labelledby="roleMenu" data-v-3faf224c><li data-v-3faf224c><a class="dropdown-item" href="#" data-v-3faf224c>Admin</a></li><li data-v-3faf224c><a class="dropdown-item" href="#" data-v-3faf224c>Mozo</a></li></ul></div>',1)),N.value.length>1?(w(),s("div",TT,[o("button",{class:"btn btn-outline-primary dropdown-toggle btn-sm",onClick:O,disabled:y.value},[t[3]||(t[3]=o("i",{class:"bi bi-building me-1"},null,-1)),v(" "+l(y.value?"Cambiando...":A.value)+" ",1),y.value?(w(),s("i",AT)):r("",!0)],8,NT),o("div",{class:C(["dropdown-menu",{show:p.value}])},[(w(!0),s(_,null,k(N.value,e=>(w(),s("div",{key:e.id,class:"dropdown-item-wrapper"},[o("a",{class:C(["dropdown-item",{active:e.id===i(c).activeBusinessId}]),href:"#",onClick:t=>(async e=>{if(e.id!==c.activeBusinessId)try{y.value=!0,p.value=!1,await c.selectActiveBusiness(e.id),S.value=c.invitationCode||"",await x()}catch(t){console.error("Error al cambiar negocio:",t)}finally{y.value=!1}else p.value=!1})(e)},[t[5]||(t[5]=o("i",{class:"bi bi-building me-2"},null,-1)),v(" "+l(e.name)+" ",1),e.id===i(c).activeBusinessId?(w(),s("small",RT,t[4]||(t[4]=[o("i",{class:"bi bi-check-circle-fill"},null,-1)]))):r("",!0)],10,PT)]))),128))],2)])):r("",!0),o("div",xT,[o("span",DT,"ID:"+l(S.value),1),o("button",{class:"btn btn-sm btn-outline-secondary",onClick:L,title:"Copiar al portapapeles"},t[6]||(t[6]=[o("i",{class:"bi bi-clipboard"},null,-1)]))])]),d.value?(w(),s("div",OT,t[8]||(t[8]=[o("div",{class:"spinner-border text-primary",role:"status"},[o("span",{class:"visually-hidden"},"Cargando...")],-1),o("p",{class:"mt-2"},"Cargando...",-1)]))):u.value?(w(),s("div",LT,[o("p",null,l(u.value),1),o("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=t=>e.$router.go(0))}," Reintentar ")])):(w(),s("div",MT,[i(c).requiresBusinessSetup?(w(),s("div",UT,[t[9]||(t[9]=o("span",null,"Aún no tienes un negocio configurado.",-1)),o("button",{class:"btn btn-sm btn-primary",onClick:t[1]||(t[1]=t=>e.$router.replace({name:"admin-onboard"}))},"Configurar ahora")])):r("",!0),o("div",FT,[o("div",qT,[o("div",BT,[o("h5",jT,l((null==(a=i(c).businessData)?void 0:a.name)||"Mi negocio"),1),o("div",$T,"Negocio activo: #"+l(i(c).activeBusinessId),1)]),o("div",zT,[o("div",VT,[o("div",WT,l(i(c).tablesCount),1),t[10]||(t[10]=o("div",{class:"small text-muted"},"Mesas",-1))]),o("div",HT,[o("div",GT,l(i(c).menusCount),1),t[11]||(t[11]=o("div",{class:"small text-muted"},"Menús",-1))]),o("div",KT,[o("div",JT,l(i(c).qrCodesCount),1),t[12]||(t[12]=o("div",{class:"small text-muted"},"QRs",-1))])])]),o("div",YT,[o("div",QT,[t[13]||(t[13]=o("span",{class:"text-muted"},"Código de invitación: ",-1)),o("code",null,l(i(c).invitationCode||"—"),1),i(c).invitationUrl?(w(),s("span",ZT,[o("a",{href:i(c).invitationUrl,target:"_blank"},"Enlace",8,XT)])):r("",!0)]),o("button",{class:"btn btn-sm btn-outline-primary",onClick:t[2]||(t[2]=()=>i(c).regenerateInvitation().then(()=>i(c).fetchBusinessData()))},"Regenerar"),o("button",{class:"btn btn-sm btn-outline-secondary",onClick:D},"Copiar ID")])]),o("div",eN,[o("div",tN,[h(n,{to:{name:"admin-qr"},class:"card dashboard-card text-center text-decoration-none"},{default:m(()=>t[14]||(t[14]=[o("div",{class:"card-body"},[o("i",{class:"bi bi-qr-code"})],-1),o("div",{class:"card-footer"},"QR",-1)])),_:1,__:[14]})]),o("div",aN,[h(n,{to:{name:"admin-stats"},class:"card dashboard-card text-center text-decoration-none"},{default:m(()=>t[15]||(t[15]=[o("div",{class:"card-body"},[o("i",{class:"bi bi-graph-up"})],-1),o("div",{class:"card-footer"},"ESTADÍSTICAS",-1)])),_:1,__:[15]})]),o("div",nN,[h(n,{to:{name:"admin-staff"},class:"card dashboard-card text-center text-decoration-none"},{default:m(()=>t[16]||(t[16]=[o("div",{class:"card-body"},[o("i",{class:"bi bi-person-fill"})],-1),o("div",{class:"card-footer"},"PERSONAL",-1)])),_:1,__:[16]})]),o("div",iN,[h(n,{to:{name:"admin-settings"},class:"card dashboard-card text-center text-decoration-none"},{default:m(()=>t[17]||(t[17]=[o("div",{class:"card-body"},[o("i",{class:"bi bi-gear-fill"})],-1),o("div",{class:"card-footer"},"CONFIGURACIÓN",-1)])),_:1,__:[17]})])])]))])])}}},[["__scopeId","data-v-3faf224c"]]),oN={class:"mb-3"},rN={class:"form-label"},lN=["type","placeholder"],cN=["disabled"],dN={__name:"InputModal",props:{modelValue:Boolean,title:{type:String,default:"Ingresar dato"},label:{type:String,default:""},placeholder:{type:String,default:""},defaultValue:{type:[String,Number],default:""},inputType:{type:String,default:"text"}},emits:["update:modelValue","confirm"],setup(e,{emit:t}){const n=e,i=t,s=a(n.defaultValue);E(()=>n.modelValue,e=>{e&&(s.value=n.defaultValue)});const r=()=>{const e="number"===n.inputType?s.value:s.value.trim();i("confirm",e),i("update:modelValue",!1)};return(t,a)=>(w(),S(KE,{"model-value":e.modelValue,"onUpdate:modelValue":a[2]||(a[2]=e=>t.$emit("update:modelValue",e)),title:e.title,size:"sm"},{footer:m(()=>[o("button",{class:"btn btn-secondary",onClick:a[1]||(a[1]=e=>t.$emit("update:modelValue",!1))},"Cancelar"),o("button",{class:"btn btn-primary",disabled:!s.value.toString().trim(),onClick:r},"Aceptar",8,cN)]),default:m(()=>[o("div",oN,[o("label",rN,l(e.label),1),d(o("input",{type:e.inputType,class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),placeholder:e.placeholder},null,8,lN),[[x,s.value]])])]),_:1},8,["model-value","title"]))}},uN=Mh({__name:"SkeletonLoader",props:{width:{type:String,default:"100%"},height:{type:String,default:"1rem"},borderRadius:{type:String,default:"4px"}},setup:e=>(t,a)=>(w(),s("div",{class:"skeleton",style:M({width:e.width,height:e.height,borderRadius:e.borderRadius})},null,4))},[["__scopeId","data-v-7bfd6ab9"]]),hN={class:"menu-card-skeleton"},pN={class:"skeleton-info"},mN=Mh({__name:"MenuCardSkeleton",setup:e=>(e,t)=>(w(),s("div",hN,[h(uN,{height:"150px",borderRadius:"12px 12px 0 0"}),o("div",pN,[h(uN,{width:"70%",height:"1.25rem",borderRadius:"4px"}),h(uN,{width:"40%",height:"1rem",borderRadius:"4px",style:{"margin-top":"8px"}})])]))},[["__scopeId","data-v-01f8ef4d"]]),fN={class:"table-item-skeleton"},vN=Mh({__name:"TableListItemSkeleton",setup:e=>(e,t)=>(w(),s("div",fN,[h(uN,{width:"80%",height:"24px",borderRadius:"6px"})]))},[["__scopeId","data-v-41c50015"]]),gN={class:"qr-container"},bN={class:"tabs-container"},wN={class:"tabs-header d-flex justify-content-center align-items-center"},yN={key:0,class:"loading-container"},_N={key:1,class:"alert alert-danger"},kN={class:"qr-content"},CN={key:0,class:"qr-layout"},EN={class:"tables-panel"},IN={class:"select-all-container"},SN=["checked"],TN={key:0,class:"tables-list"},NN={key:1,class:"tables-list"},AN=["onClick"],PN=["checked","onChange"],RN={class:"table-name"},xN=["onClick"],DN=["onClick"],ON={class:"qr-panel"},LN={key:0,class:"qr-display-multiple"},MN={class:"share-buttons"},UN={key:1,class:"qr-display"},FN={class:"qr-table-name"},qN={key:0,class:"qr-code-item"},BN={key:0,class:"qr-image-loader"},jN=["src"],$N={key:2,class:"qr-image-error"},zN={class:"share-buttons"},VN={key:1,class:"no-qr-codes"},WN={key:2,class:"qr-placeholder"},HN={key:1,class:"menu-layout"},GN={key:0,class:"menu-grid"},KN={key:1,class:"menu-grid"},JN=["onClick"],YN={class:"card-content"},QN={class:"menu-info"},ZN={class:"menu-name"},XN={key:0,class:"menu-badge"},eA=["onClick"],tA=["onClick"],aA=["onClick"],nA=["onClick"],iA=["onClick"],sA={key:0,class:"processing-overlay"},oA={class:"edit-table-content"},rA={class:"form-group"},lA={class:"form-group"},cA={class:"download-modal-content"},dA={class:"form-group"},uA={class:"email-modal-content"},hA={class:"form-group"},pA={class:"form-group"},mA={class:"form-group"},fA={class:"form-group"},vA=Mh({__name:"QR",setup(e){b();const t=CE(),i=n(()=>t.isLoading),p=n(()=>t.error),f=n(()=>t.tables),y=n(()=>t.menus),I=a(null);a("");const S=a(localStorage.getItem("adminQRTab")||"tables"),T=a(!1),N=a(""),A=a(!1),P=a({id:null,number:null,name:""}),R=a(null),x=a(null),O=a([]),L=a(!1),M=a("pdf");let U=[];const F=a(""),q=a(!1),B=a(!1),j=a("pdf"),$=a(""),z=a("Mesas QR"),V=a("Te comparto los códigos.");let W=[];const H=e=>O.value.some(t=>t.id===e.id),G=e=>{e.target.checked?O.value=[...f.value]:O.value=[]},K=e=>{S.value=e,localStorage.setItem("adminQRTab",e)},J=()=>{N.value="",T.value=!0},Y=async e=>{const a=parseInt(e,10);if(isNaN(a)||a<=0)or("Por favor, ingresa un número de mesa válido y mayor a cero.");else try{await t.createTable({number:a}),sr("Mesa creada correctamente")}catch(n){or(n.message||"Error al crear la mesa")}},Q=async()=>{if(!P.value.number||P.value.number<=0)or("Por favor, ingresa un número de mesa válido y mayor a cero.");else try{const e={number:P.value.number,name:P.value.name||null};if(await t.updateTable(P.value.id,e),A.value=!1,I.value&&I.value.id===P.value.id){const e=f.value.find(e=>e.id===P.value.id);e&&(I.value=e)}sr("Mesa actualizada correctamente")}catch(e){or(e.message||"Error al actualizar la mesa")}},Z=async()=>{if(I.value)try{const e=I.value.qr_code,a=e?"regenerado":"generado";e?await t.regenerateQrCode(I.value.id):await t.generateQrCode(I.value.id);const n=f.value.find(e=>e.id===I.value.id);n&&(I.value=n),sr(`Código QR ${a} exitosamente.`)}catch(e){or(e.message||"Error al procesar código QR")}},X=async()=>{const{value:e}=await nr.fire({title:"Selecciona un PDF",input:"file",inputAttributes:{accept:"application/pdf"},confirmButtonText:"Subir",showCancelButton:!0,cancelButtonText:"Cancelar"});if(!e)return;const a=e.size/1048576;if(a>50)return void or(`El archivo (${a.toFixed(2)} MB) supera el límite de 50 MB`);const{value:n}=await nr.fire({title:"Nombre del menú",input:"text",inputValue:e.name.replace(/\.pdf$/i,""),showCancelButton:!0,confirmButtonText:"Guardar"});if(!n)return;const i=new FormData;i.append("file",e),i.append("name",n),await t.uploadMenu(i),sr("Menú subido")},ee=async()=>{try{const e=await va.post("/debug/fix-php-limits",{});console.log("🐛 DEBUG RESULT:",e.data),nr.fire({title:"✅ DEBUG Success",text:e.data,icon:"success"})}catch(e){console.error("🐛 DEBUG ERROR:",e),nr.fire({title:"❌ DEBUG Error",text:e.message||"Error al ejecutar el debug",icon:"error"})}},te=e=>{U=e,L.value=!0},ae=async()=>{L.value=!1;const e=U.filter(e=>e.qr_code&&e.qr_code.id).map(e=>e.qr_code.id);if(0===e.length)return void or("Ninguna de las mesas seleccionadas tiene un QR para exportar.");const t=M.value;try{const a=await va.post("/admin/qr/export",{qr_ids:e,format:t},{responseType:"blob"}),n=window.URL.createObjectURL(a.data),i=document.createElement("a");i.href=n;const s=a.headers["content-disposition"];let o;if(s){const e=s.match(/filename="(.+)"/);e&&2===e.length&&(o=e[1])}if(!o){const a=t;if(1===e.length){o=`QR_Mesa_${U.find(t=>t.qr_code&&t.qr_code.id===e[0]).number}.${a}`}else o=`QRs_Export.${a}`}i.download=o,document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(n)}catch(a){or("Error al exportar los códigos QR.")}},ne=e=>{W=e,B.value=!0},ie=async()=>{B.value=!1;const e=$.value.split(",").map(e=>e.trim()).filter(e=>e);if(0===e.length)return void or("Ingresa al menos un destinatario.");const t=W.filter(e=>e.qr_code&&e.qr_code.id).map(e=>e.qr_code.id);if(0===t.length)return void or("Ninguna de las mesas seleccionadas tiene un QR para enviar.");const a={qr_ids:t,format:j.value,recipients:e,subject:z.value,body:V.value};try{await va.post("/admin/qr/email",a),sr("Correo enviado correctamente.")}catch(n){or(n.message||"Error al enviar el correo.")}};return g(()=>{t.fetchTables(),t.fetchMenus()}),E(I,async e=>{if(F.value&&(URL.revokeObjectURL(F.value),F.value=""),e&&e.qr_code){q.value=!0;try{const t=await va.get(`/admin/qr/preview/${e.id}`,{responseType:"blob"});F.value=URL.createObjectURL(t.data)}catch(t){console.error("Error fetching QR code image:",t),or("No se pudo cargar la imagen del QR.")}finally{q.value=!1}}}),E(f,e=>{if(I.value){const t=e.find(e=>e.id===I.value.id);t&&t!==I.value&&(I.value=t)}},{deep:!0}),(e,a)=>(w(),s("div",gN,[o("div",bN,[o("div",wN,[o("button",{class:C(["tab-button",{active:"tables"===S.value}]),onClick:a[0]||(a[0]=e=>K("tables"))}," MESAS ",2),o("button",{class:C(["tab-button",{active:"menus"===S.value}]),onClick:a[1]||(a[1]=e=>K("menus"))}," MENÚ ",2)])]),i.value&&!f.value.length?(w(),s("div",yN,a[24]||(a[24]=[o("div",{class:"loading-spinner"},null,-1),o("p",null,"Cargando datos...",-1)]))):r("",!0),p.value&&!i.value?(w(),s("div",_N,l(p.value),1)):r("",!0),o("div",kN,["tables"===S.value?(w(),s("div",CN,[o("div",EN,[a[28]||(a[28]=o("h2",{class:"panel-title"},"Selecciona una mesa",-1)),o("div",IN,[o("input",{type:"checkbox",onChange:G,checked:f.value.length>0&&O.value.length===f.value.length,class:"form-check-input"},null,40,SN),a[25]||(a[25]=o("label",null,"Seleccionar todo",-1))]),i.value?(w(),s("div",TN,[(w(),s(_,null,k(8,e=>h(vN,{key:e})),64))])):(w(),s("div",NN,[(w(!0),s(_,null,k(f.value,e=>(w(),s("div",{key:e.id,class:C(["table-item",{active:I.value&&I.value.id===e.id}]),onClick:t=>(e=>{I.value=e})(e)},[o("input",{type:"checkbox",checked:H(e),onChange:t=>(e=>{const t=O.value.findIndex(t=>t.id===e.id);-1===t?O.value.push(e):O.value.splice(t,1)})(e),onClick:a[2]||(a[2]=c(()=>{},["stop"])),class:"form-check-input"},null,40,PN),o("span",RN,l((e.name||`MESA ${e.number}`).toUpperCase()),1),o("div",{class:"table-actions",onClick:a[3]||(a[3]=c(()=>{},["stop"]))},[o("button",{onClick:t=>(e=>{P.value={id:e.id,number:e.number,name:e.name||""},A.value=!0})(e),class:"btn-action edit",title:"Editar mesa"},a[26]||(a[26]=[o("i",{class:"bi bi-pencil"},null,-1)]),8,xN),o("button",{onClick:a=>(async e=>{if((await nr.fire({title:"¿Eliminar mesa?",html:`¿Estás seguro de que deseas eliminar la mesa <strong>${e.name||`MESA ${e.number}`}</strong>?<br><br><small class="text-danger">Esta acción no se puede deshacer y eliminará también su código QR.</small>`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{await t.deleteTable(e.id),I.value&&I.value.id===e.id&&(I.value=null),O.value=O.value.filter(t=>t.id!==e.id),sr(`Mesa ${e.name||e.number} eliminada correctamente`)}catch(a){or(a.message||"Error al eliminar la mesa")}})(e),class:"btn-action delete",title:"Eliminar mesa"},a[27]||(a[27]=[o("i",{class:"bi bi-trash"},null,-1)]),8,DN)])],10,AN))),128))])),o("button",{class:"add-table-btn",onClick:J},"MESA ＋")]),o("div",ON,[O.value.length>0?(w(),s("div",LN,[o("h3",null,l(O.value.length)+" mesa(s) seleccionada(s)",1),a[31]||(a[31]=o("p",null,"Selecciona una acción para aplicar a todas las mesas seleccionadas.",-1)),o("div",MN,[o("button",{onClick:a[4]||(a[4]=e=>te(O.value)),class:"share-btn download"},a[29]||(a[29]=[o("i",{class:"bi bi-download"},null,-1),v(" Descargar QRs ")])),o("button",{onClick:a[5]||(a[5]=e=>ne(O.value)),class:"share-btn email"},a[30]||(a[30]=[o("i",{class:"bi bi-envelope-fill"},null,-1),v(" Enviar por correo ")]))])])):I.value?(w(),s("div",UN,[o("h3",FN,"Mesa "+l(I.value.number),1),I.value.qr_code?(w(),s("div",qN,[q.value?(w(),s("div",BN,a[32]||(a[32]=[o("div",{class:"loading-spinner-small"},null,-1)]))):F.value?(w(),s("img",{key:1,src:F.value,alt:"Código QR",class:"qr-image"},null,8,jN)):(w(),s("div",$N,a[33]||(a[33]=[o("i",{class:"bi bi-exclamation-triangle-fill"},null,-1),o("span",null,"Error al cargar QR",-1)]))),o("div",zN,[o("button",{onClick:a[6]||(a[6]=e=>te([I.value])),class:"share-btn download"},a[34]||(a[34]=[o("i",{class:"bi bi-download"},null,-1),v(" Descargar ")])),o("button",{onClick:a[7]||(a[7]=e=>(async e=>{if(e&&e.qr_code)try{const t=await va.post("/admin/qr/export",{qr_ids:[e.qr_code.id],format:"png"},{responseType:"blob"}),a=new File([t.data],`QR_Mesa_${e.number}.png`,{type:"image/png"});if(navigator.canShare&&navigator.canShare({files:[a]}))await navigator.share({files:[a],title:`Código QR para Mesa ${e.number}`,text:`Aquí está el código QR para la mesa ${e.number}.`});else{const e=window.URL.createObjectURL(a),t=document.createElement("a");t.href=e,t.download=a.name,document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(e),sr("Archivo descargado (el navegador no admite compartir).")}}catch(t){"AbortError"!==t.name&&or("Error al intentar compartir el código QR.")}else or("La mesa no tiene un QR para compartir.")})(I.value)),class:"share-btn share"},a[35]||(a[35]=[o("i",{class:"bi bi-share-fill"},null,-1),v(" Compartir ")])),o("button",{onClick:a[8]||(a[8]=e=>ne([I.value])),class:"share-btn email"},a[36]||(a[36]=[o("i",{class:"bi bi-envelope-fill"},null,-1),v(" Enviar ")]))]),o("button",{class:"btn btn-secondary mt-3",onClick:Z},"Regenerar QR")])):(w(),s("div",VN,[a[37]||(a[37]=o("p",null,"Esta mesa aún no tiene un código QR.",-1)),o("button",{class:"btn btn-primary mt-3",onClick:Z},"Generar QR")]))])):(w(),s("div",WN,a[38]||(a[38]=[o("p",null,"Selecciona una mesa para ver su código QR",-1)])))])])):(w(),s("div",HN,[a[46]||(a[46]=o("div",{class:"row mb-3"},[o("div",{class:"col-12 d-flex flex-column align-items-start justify-content-start"},[o("h2",null,"Menús"),o("p",{class:"text-left"},"Administra tus menús para que tus clientes puedan escanearlos y verlos en su mesa.")])],-1)),i.value?(w(),s("div",GN,[(w(),s(_,null,k(6,e=>h(mN,{key:e})),64))])):(w(),s("div",KN,[(w(!0),s(_,null,k(y.value,e=>(w(),s("div",{key:e.id,class:C(["menu-card",{default:e.isDefault,processing:x.value===e.id}]),onClick:t=>{return a=e.id,void(R.value=R.value===a?null:a);var a}},[o("div",YN,[a[39]||(a[39]=o("div",{class:"menu-cover"},null,-1)),o("div",QN,[o("span",ZN,l(e.name),1),e.isDefault?(w(),s("span",XN,"PREDETERMINADO")):r("",!0)])]),o("div",{class:C(["menu-actions",{show:R.value===e.id}]),onClick:a[9]||(a[9]=c(()=>{},["stop"]))},[e.isPredefined?r("",!0):(w(),s("button",{key:0,onClick:a=>(async e=>{x.value=e.id;try{await t.setDefaultMenu(e.id),sr("Menú predeterminado actualizado"),R.value=null}catch(a){or(a.message||"Error al establecer menú predeterminado")}finally{x.value=null}})(e),class:"action-item"},a[40]||(a[40]=[o("span",{class:"action-icon select"},[o("i",{class:"bi bi-check-lg"})],-1),o("span",{class:"action-label"},"Seleccionar",-1)]),8,eA)),o("button",{onClick:a=>(async e=>{const a=await t.previewMenu(e.id);a&&window.open(a,"_blank")})(e),class:"action-item"},a[41]||(a[41]=[o("span",{class:"action-icon view"},[o("i",{class:"bi bi-eye-fill"})],-1),o("span",{class:"action-label"},"Ver",-1)]),8,tA),o("button",{onClick:a=>(async e=>{const{value:a}=await nr.fire({title:"Nuevo nombre",input:"text",inputValue:e.name,showCancelButton:!0});if(a&&a!==e.name){x.value=e.id;try{await t.renameMenu(e.id,a),sr("Nombre cambiado"),R.value=null}catch(n){or(n.message||"Error al renombrar menú")}finally{x.value=null}}})(e),class:"action-item"},a[42]||(a[42]=[o("span",{class:"action-icon rename"},[o("i",{class:"bi bi-pencil-fill"})],-1),o("span",{class:"action-label"},"Renombrar",-1)]),8,aA),o("button",{onClick:t=>(async e=>{x.value=e.id;try{const t=await va.get(`/menus/${e.id}/download`,{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=a;const i=t.headers["content-disposition"];let s=`${e.name}.pdf`;if(i){const e=i.match(/filename="(.+)"/);e&&2===e.length&&(s=e[1])}n.setAttribute("download",s),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(a),R.value=null}catch(t){or(t.message||"Error al descargar el archivo.")}finally{x.value=null}})(e),class:"action-item"},a[43]||(a[43]=[o("span",{class:"action-icon download"},[o("i",{class:"bi bi-download"})],-1),o("span",{class:"action-label"},"Descargar",-1)]),8,nA),e.isPredefined?r("",!0):(w(),s("button",{key:1,onClick:a=>(async e=>{if(e.isPredefined)return void or("No puedes eliminar el menú predeterminado.");if((await nr.fire({title:`¿Eliminar "${e.name}"?`,text:"Esta acción es irreversible",icon:"warning",showCancelButton:!0})).isConfirmed){x.value=e.id;try{await t.deleteMenu(e.id),sr("Menú eliminado"),R.value=null}catch(a){or(a.message||"Error al eliminar el menú")}finally{x.value=null}}})(e),class:"action-item"},a[44]||(a[44]=[o("span",{class:"action-icon delete"},[o("i",{class:"bi bi-trash-fill"})],-1),o("span",{class:"action-label"},"Eliminar",-1)]),8,iA))],2),x.value===e.id?(w(),s("div",sA,a[45]||(a[45]=[o("div",{class:"loading-spinner-small"},null,-1)]))):r("",!0)],10,JN))),128)),o("div",{class:"add-menu-card w-100",onClick:X}," ＋ Agregar menú (PDF) "),o("div",{class:"debug-menu-card w-100",onClick:ee}," 🐛 DEBUG Upload Test ")]))]))]),h(dN,{modelValue:T.value,"onUpdate:modelValue":a[10]||(a[10]=e=>T.value=e),title:"Nueva mesa",label:"Número de la mesa",placeholder:"Ej: 5","input-type":"number",onConfirm:Y},null,8,["modelValue"]),h(KE,{modelValue:A.value,"onUpdate:modelValue":a[14]||(a[14]=e=>A.value=e),title:"Editar Mesa"},{footer:m(()=>[o("button",{class:"btn btn-secondary",onClick:a[13]||(a[13]=e=>A.value=!1)},"Cancelar"),o("button",{class:"btn btn-primary",onClick:Q},"Guardar Cambios")]),default:m(()=>[o("div",oA,[o("div",rA,[a[47]||(a[47]=o("label",{for:"edit-table-number"},"Número de la mesa:",-1)),d(o("input",{id:"edit-table-number","onUpdate:modelValue":a[11]||(a[11]=e=>P.value.number=e),type:"number",class:"form-control",min:"1"},null,512),[[u,P.value.number,void 0,{number:!0}]])]),o("div",lA,[a[48]||(a[48]=o("label",{for:"edit-table-name"},"Nombre personalizado (opcional):",-1)),d(o("input",{id:"edit-table-name","onUpdate:modelValue":a[12]||(a[12]=e=>P.value.name=e),type:"text",class:"form-control",placeholder:"Ej: Mesa VIP, Mesa Terraza..."},null,512),[[u,P.value.name]])])])]),_:1},8,["modelValue"]),h(KE,{modelValue:L.value,"onUpdate:modelValue":a[17]||(a[17]=e=>L.value=e),title:"Exportar Códigos QR"},{footer:m(()=>[o("button",{class:"btn btn-secondary",onClick:a[16]||(a[16]=e=>L.value=!1)},"Cancelar"),o("button",{class:"btn btn-primary",onClick:ae},"Descargar")]),default:m(()=>[o("div",cA,[a[51]||(a[51]=o("p",null,"Selecciona el formato en el que deseas descargar los códigos QR.",-1)),o("div",dA,[a[50]||(a[50]=o("label",{for:"format-select"},"Formato:",-1)),d(o("select",{id:"format-select","onUpdate:modelValue":a[15]||(a[15]=e=>M.value=e),class:"form-control"},a[49]||(a[49]=[o("option",{value:"pdf"},"PDF",-1),o("option",{value:"png"},"PNG",-1),o("option",{value:"svg"},"SVG",-1),o("option",{value:"zip"},"ZIP (PNGs comprimidos)",-1)]),512),[[D,M.value]])])])]),_:1},8,["modelValue"]),h(KE,{modelValue:B.value,"onUpdate:modelValue":a[23]||(a[23]=e=>B.value=e),title:"Enviar Códigos QR por Email"},{footer:m(()=>[o("button",{class:"btn btn-secondary",onClick:a[22]||(a[22]=e=>B.value=!1)},"Cancelar"),o("button",{class:"btn btn-primary",onClick:ie},"Enviar")]),default:m(()=>[o("div",uA,[o("div",hA,[a[52]||(a[52]=o("label",{for:"recipients-input"},"Destinatarios (separa correos con coma):",-1)),d(o("input",{id:"recipients-input","onUpdate:modelValue":a[18]||(a[18]=e=>$.value=e),type:"text",class:"form-control",placeholder:"ej: correo@dominio.com, otro@dominio.com"},null,512),[[u,$.value]])]),o("div",pA,[a[53]||(a[53]=o("label",{for:"subject-input"},"Asunto:",-1)),d(o("input",{id:"subject-input","onUpdate:modelValue":a[19]||(a[19]=e=>z.value=e),type:"text",class:"form-control"},null,512),[[u,z.value]])]),o("div",mA,[a[54]||(a[54]=o("label",{for:"body-input"},"Mensaje:",-1)),d(o("textarea",{id:"body-input","onUpdate:modelValue":a[20]||(a[20]=e=>V.value=e),class:"form-control",rows:"3"},null,512),[[u,V.value]])]),o("div",fA,[a[56]||(a[56]=o("label",{for:"email-format-select"},"Formato:",-1)),d(o("select",{id:"email-format-select","onUpdate:modelValue":a[21]||(a[21]=e=>j.value=e),class:"form-control"},a[55]||(a[55]=[o("option",{value:"pdf"},"PDF",-1),o("option",{value:"png"},"PNG",-1)]),512),[[D,j.value]])])])]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-4ea07d37"]]),gA={class:"stats-container"};const bA=Mh({},[["render",function(e,t){return w(),s("div",gA,t[0]||(t[0]=[o("div",{class:"coming-soon-container"},[o("i",{class:"bi bi-bar-chart-line-fill icon"}),o("h1",null,"Estadísticas"),o("p",null,"Esta sección estará disponible próximamente."),o("p",null,"Estamos trabajando para ofrecerte los mejores análisis para tu negocio.")],-1)]))}],["__scopeId","data-v-29de642f"]]),wA={class:"request-card"},yA={class:"requester-info"},_A=["src","alt"],kA={class:"text-info"},CA={class:"name"},EA={class:"email"},IA={key:0,class:"phone"},SA={class:"profile-details"},TA={key:0,class:"experience"},NA={key:1,class:"schedule"},AA={key:2,class:"employment"},PA={key:1,class:"skills"},RA={key:2,class:"bio"},xA={class:"actions"},DA=["title"],OA={__name:"RequestCard",props:{request:{type:Object,required:!0},isArchived:{type:Boolean,default:!1}},emits:["confirm","archive","reject","unarchive","invite"],setup:(e,{emit:t})=>(t,a)=>{var n,i,d,u,h,p,m,f,g,b,y,C,E,I,S;return w(),s("div",wA,[e.isArchived?r("",!0):(w(),s("button",{key:0,class:"close-button",onClick:a[0]||(a[0]=c(a=>t.$emit("reject",e.request),["stop"]))},a[6]||(a[6]=[o("i",{class:"bi bi-x"},null,-1)]))),o("div",yA,[o("img",{src:(null==(n=e.request.user_profile)?void 0:n.avatar)||"/default-avatar.png",alt:`Avatar de ${(null==(i=e.request.user)?void 0:i.name)||(null==(d=e.request.user_profile)?void 0:d.display_name)}`,class:"avatar"},null,8,_A),o("div",kA,[o("h4",CA,l((null==(u=e.request.user)?void 0:u.name)||(null==(h=e.request.user_profile)?void 0:h.display_name)),1),o("p",EA,l(null==(p=e.request.user)?void 0:p.email),1),(null==(m=e.request.user_profile)?void 0:m.phone)?(w(),s("p",IA,l(e.request.user_profile.phone),1)):r("",!0),o("div",SA,[(null==(f=e.request.user_profile)?void 0:f.experience_years)?(w(),s("p",TA,[a[7]||(a[7]=o("i",{class:"bi bi-briefcase"},null,-1)),v(" "+l(e.request.user_profile.experience_years)+" años de experiencia ",1)])):r("",!0),(null==(g=e.request.user_profile)?void 0:g.current_schedule)?(w(),s("p",NA,[a[8]||(a[8]=o("i",{class:"bi bi-clock"},null,-1)),v(" "+l(e.request.user_profile.current_schedule),1)])):r("",!0),(null==(b=e.request.user_profile)?void 0:b.employment_type)?(w(),s("p",AA,[a[9]||(a[9]=o("i",{class:"bi bi-person-badge"},null,-1)),v(" "+l(e.request.user_profile.employment_type),1)])):r("",!0)]),(null==(C=null==(y=e.request.user_profile)?void 0:y.skills)?void 0:C.length)?(w(),s("div",PA,[(w(!0),s(_,null,k(e.request.user_profile.skills,e=>(w(),s("span",{class:"skill-tag",key:e},l(e),1))),128))])):r("",!0),(null==(E=e.request.user_profile)?void 0:E.bio)?(w(),s("p",RA,l(e.request.user_profile.bio),1)):r("",!0)])]),o("div",xA,[e.isArchived?(w(),s("button",{key:1,class:"btn btn-primary",onClick:a[5]||(a[5]=c(a=>t.$emit("unarchive",e.request),["stop"]))},a[14]||(a[14]=[o("i",{class:"bi bi-arrow-counterclockwise"},null,-1),v(" Desarchivar ")]))):(w(),s(_,{key:0},[o("button",{class:"btn btn-primary",onClick:a[1]||(a[1]=c(a=>t.$emit("confirm",e.request),["stop"]))},a[10]||(a[10]=[o("i",{class:"bi bi-check-lg"},null,-1),v(" Confirmar ")])),o("button",{class:"btn btn-info",onClick:a[2]||(a[2]=c(a=>t.$emit("invite",e.request),["stop"])),title:"Enviar invitación a "+((null==(I=e.request.user)?void 0:I.name)||(null==(S=e.request.user_profile)?void 0:S.display_name))},a[11]||(a[11]=[o("i",{class:"bi bi-envelope"},null,-1),v(" Invitar ")]),8,DA),o("button",{class:"btn btn-secondary",onClick:a[3]||(a[3]=c(a=>t.$emit("archive",e.request),["stop"]))},a[12]||(a[12]=[o("i",{class:"bi bi-archive"},null,-1),v(" Archivar ")])),o("button",{class:"btn btn-danger",onClick:a[4]||(a[4]=c(a=>t.$emit("reject",e.request),["stop"]))},a[13]||(a[13]=[o("i",{class:"bi bi-x-lg"},null,-1),v(" Rechazar ")]))],64))])])}},LA=Mh(OA,[["__scopeId","data-v-f3cb5e00"]]),MA={class:"staff-avatar"},UA=["src","alt"],FA={class:"employee-name"},qA={key:0,class:"employee-email"},BA={class:"staff-info"},jA={key:0,class:"profile-details"},$A={key:0,class:"detail-item"},zA={key:1,class:"detail-item"},VA={key:2,class:"detail-item"},WA={class:"rating-container"},HA={class:"stars"},GA={class:"comments-count"},KA={__name:"StaffCard",props:{employee:{type:Object,required:!0}},emits:["view","remove"],setup(e,{emit:t}){const a=e,n=t,i=()=>{n("view",a.employee)},c=e=>{e.stopPropagation(),n("remove",a.employee)};return(t,a)=>{var n,d,u,h,p,m,f,v,g,b,y,E,I,S;return w(),s("div",{class:"staff-card",onClick:i},[o("button",{class:"remove-button",onClick:c},a[0]||(a[0]=[o("i",{class:"bi bi-x"},null,-1)])),o("div",MA,[o("img",{src:(null==(d=null==(n=e.employee.user)?void 0:n.user_profile)?void 0:d.avatar)||(null==(h=null==(u=e.employee.user)?void 0:u.user_profile)?void 0:h.avatar_url)||"https://randomuser.me/api/portraits/men/32.jpg",alt:(null==(p=e.employee.user)?void 0:p.name)||(null==(f=null==(m=e.employee.user)?void 0:m.user_profile)?void 0:f.display_name),class:"avatar-image"},null,8,UA)]),o("h3",FA,l((null==(v=e.employee.user)?void 0:v.name)||(null==(b=null==(g=e.employee.user)?void 0:g.user_profile)?void 0:b.display_name)),1),(null==(y=e.employee.user)?void 0:y.email)?(w(),s("p",qA,l(e.employee.user.email),1)):r("",!0),o("div",BA,[(null==(E=e.employee.user)?void 0:E.user_profile)?(w(),s("div",jA,[e.employee.user.user_profile.experience_years?(w(),s("div",$A,[a[1]||(a[1]=o("i",{class:"bi bi-briefcase"},null,-1)),o("span",null,l(e.employee.user.user_profile.experience_years)+" años",1)])):r("",!0),e.employee.user.user_profile.current_schedule?(w(),s("div",zA,[a[2]||(a[2]=o("i",{class:"bi bi-clock"},null,-1)),o("span",null,l(e.employee.user.user_profile.current_schedule),1)])):r("",!0),e.employee.user.user_profile.employment_type?(w(),s("div",VA,[a[3]||(a[3]=o("i",{class:"bi bi-person-badge"},null,-1)),o("span",null,l(e.employee.user.user_profile.employment_type),1)])):r("",!0)])):r("",!0),o("div",WA,[o("div",HA,[(w(),s(_,null,k(5,t=>{var a,n;return o("i",{key:t,class:C(["bi",t<=Math.round((null==(n=null==(a=e.employee.user)?void 0:a.user_profile)?void 0:n.rating)||0)?"bi-star-fill":"bi-star"])},null,2)}),64))]),o("div",GA,[a[4]||(a[4]=o("i",{class:"bi bi-chat-left-text"},null,-1)),o("span",null,l((null==(S=null==(I=e.employee.user)?void 0:I.user_profile)?void 0:S.total_reviews)||0)+" comentarios",1)])])])])}}},JA=Mh(KA,[["__scopeId","data-v-6de59a5a"]]),YA={class:"staff-card-skeleton"},QA={class:"avatar-skeleton"},ZA={class:"info-skeleton"},XA={__name:"StaffCardSkeleton",setup:e=>(e,t)=>(w(),s("div",YA,[o("div",QA,[h(uN,{width:"64px",height:"64px",borderRadius:"50%"})]),o("div",ZA,[h(uN,{width:"60%",height:"1.2rem",borderRadius:"4px"}),h(uN,{width:"40%",height:"1rem",borderRadius:"4px",style:{"margin-top":"8px"}})])]))},eP=Mh(XA,[["__scopeId","data-v-77a45dbe"]]),tP={class:"request-card-skeleton"},aP={class:"info-skeleton"},nP={class:"actions-skeleton"},iP={__name:"RequestCardSkeleton",setup:e=>(e,t)=>(w(),s("div",tP,[o("div",aP,[h(uN,{width:"50%",height:"1.1rem",borderRadius:"4px"}),h(uN,{width:"30%",height:"0.9rem",borderRadius:"4px",style:{"margin-top":"8px"}})]),o("div",nP,[h(uN,{width:"40px",height:"40px",borderRadius:"50%"}),h(uN,{width:"40px",height:"40px",borderRadius:"50%"})])]))},sP=Mh(iP,[["__scopeId","data-v-8e0a7703"]]),oP={class:"staff-page"},rP={class:"page-header"},lP={key:0,class:"header-stats"},cP={class:"stat-item"},dP={class:"stat-value"},uP={class:"stat-item"},hP={class:"stat-value"},pP={key:0,class:"loading-container"},mP={key:1,class:"error-container"},fP={class:"error-message"},vP={key:2,class:"staff-content"},gP={class:"staff-section"},bP={class:"section-header"},wP={class:"section-title"},yP={key:0,class:"badge bg-primary rounded-pill"},_P={key:0,class:"section-actions"},kP={key:0,class:"requests-list"},CP={key:1},EP={key:0,class:"text-center p-4 text-muted"},IP={key:1,class:"requests-list"},SP={class:"staff-section"},TP={class:"section-header"},NP={key:0,class:"staff-grid"},AP={key:1,class:"staff-grid"},PP={key:0},RP={key:2,class:"pagination-container"},xP=["disabled"],DP=["disabled"],OP={class:"invite-form"},LP={class:"form-group"},MP={class:"form-group"},UP=["disabled"],FP={key:0},qP={key:1},BP=["disabled"],jP={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},$P={__name:"Staff",setup(e){const t=b(),i=CE(),c=a(!1),p=a(""),f=n(()=>i.staff),y=n(()=>i.staffRequests),C=n(()=>i.archivedRequests),E=a(!1),I=a(!1);a(!1),a(!1);const T=a(null);a(null);const N=a(""),A=a(""),P=a("waiter"),R=a(!1),x=n(()=>i.staffLinks),O=n(()=>i.staffMeta),L=n(()=>{if(!f.value.length)return[];let e=[...f.value];if(N.value){const t=N.value.toLowerCase();e=e.filter(e=>{var a,n,i,s,o,r,l,c,d,u,h,p,m;return(null==(n=null==(a=e.user)?void 0:a.name)?void 0:n.toLowerCase().includes(t))||(null==(s=null==(i=e.user)?void 0:i.email)?void 0:s.toLowerCase().includes(t))||(null==(l=null==(r=null==(o=e.user)?void 0:o.user_profile)?void 0:r.display_name)?void 0:l.toLowerCase().includes(t))||(null==(u=null==(d=null==(c=e.user)?void 0:c.user_profile)?void 0:d.bio)?void 0:u.toLowerCase().includes(t))||(null==(m=null==(p=null==(h=e.user)?void 0:h.user_profile)?void 0:p.employment_type)?void 0:m.toLowerCase().includes(t))})}return e}),M=n(()=>R.value?C.value:y.value),U=n(()=>{if(!f.value.length)return{total:0,avgRating:0};const e=f.value.length;return{total:e,avgRating:(f.value.reduce((e,t)=>{var a,n;return e+((null==(n=null==(a=t.user)?void 0:a.user_profile)?void 0:n.rating)||0)},0)/e).toFixed(1)}});g(async()=>{c.value=!0,p.value="";try{await Promise.all([i.fetchStaff(),i.fetchStaffRequests(),i.fetchArchivedRequests()])}catch(e){p.value=e.message||"Error al cargar datos de personal"}finally{c.value=!1}});const F=async()=>{if(A.value&&P.value){c.value=!0,p.value="";try{(await i.inviteStaff({email:A.value,role:P.value,position:"waiter"===P.value?"Mozo":P.value})).invitation_url?sr(`Invitación enviada a ${A.value}. Se ha enviado un enlace por email.`):sr(`Invitación creada para ${A.value}`),A.value="",P.value="waiter",E.value=!1}catch(e){p.value=e.message||"Error al enviar invitación"}finally{c.value=!1}}else p.value="Por favor, completa todos los campos"},q=async e=>{var t,a;c.value=!0,p.value="";try{const n=e.id;if(!n)throw console.error("Request object:",e),new Error("ID de solicitud no encontrado");const s={hire_date:(new Date).toISOString().split("T")[0],notes:"Aprobado desde panel de administración"};await i.approveStaffRequest(n,s),await Promise.all([i.fetchStaff(),i.fetchStaffRequests(),i.fetchArchivedRequests()]),sr(`Solicitud de ${(null==(t=e.user)?void 0:t.name)||(null==(a=e.user_profile)?void 0:a.display_name)} aprobada exitosamente`)}catch(n){p.value=n.message||"Error al confirmar solicitud"}finally{c.value=!1}},B=async e=>{c.value=!0,p.value="";try{const t=e.id;if(!t)throw console.error("Request object:",e),new Error("ID de solicitud no encontrado");await i.handleStaffRequest(t,"archive"),await Promise.all([i.fetchStaff(),i.fetchStaffRequests(),i.fetchArchivedRequests()])}catch(t){p.value=t.message||"Error al archivar solicitud"}finally{c.value=!1}},j=async e=>{c.value=!0,p.value="";try{const t=e.id;if(!t)throw console.error("Request object:",e),new Error("ID de solicitud archivada no encontrado");console.log("Unarchiving request with ID:",t),await i.handleStaffRequest(t,"unarchive"),await Promise.all([i.fetchStaff(),i.fetchStaffRequests(),i.fetchArchivedRequests()])}catch(t){console.error("Error unarchiving request:",t),p.value=t.message||"Error al desarchivar solicitud"}finally{c.value=!1}},$=async e=>{var t,a;c.value=!0,p.value="";try{const n=e.id;if(!n)throw console.error("Request object:",e),new Error("ID de solicitud no encontrado");const s={notes:"Rechazado desde panel de administración"};await i.rejectStaffRequest(n,s),await Promise.all([i.fetchStaff(),i.fetchStaffRequests(),i.fetchArchivedRequests()]),sr(`Solicitud de ${(null==(t=e.user)?void 0:t.name)||(null==(a=e.user_profile)?void 0:a.display_name)} rechazada`)}catch(n){p.value=n.message||"Error al rechazar solicitud"}finally{c.value=!1}},z=async()=>{if(y.value.length){c.value=!0,p.value="";try{const e={hire_date:(new Date).toISOString().split("T")[0],notes:"Aprobación masiva desde panel de administración"};for(const t of y.value){const a=t.id;a&&await i.approveStaffRequest(a,e)}await Promise.all([i.fetchStaff(),i.fetchStaffRequests(),i.fetchArchivedRequests()]),sr(`${y.value.length} solicitudes aprobadas exitosamente`)}catch(e){p.value=e.message||"Error al confirmar todas las solicitudes"}finally{c.value=!1}}},V=async e=>{var t,a,n,s;c.value=!0,p.value="";try{const o=e.id;if(!o)throw console.error("Request object:",e),new Error("ID de solicitud no encontrado");(await i.inviteStaffMember(o)).invitation_url?sr(`Invitación enviada a ${(null==(t=e.user)?void 0:t.name)||(null==(a=e.user_profile)?void 0:a.display_name)}. Se ha enviado el enlace por email/WhatsApp.`):sr(`Token de invitación generado para ${(null==(n=e.user)?void 0:n.name)||(null==(s=e.user_profile)?void 0:s.display_name)}`),await Promise.all([i.fetchStaff(),i.fetchStaffRequests(),i.fetchArchivedRequests()])}catch(o){p.value=o.message||"Error al enviar invitación"}finally{c.value=!1}},W=async()=>{if(y.value.length){c.value=!0,p.value="";try{for(const e of y.value){const t=e.id;t&&await i.handleStaffRequest(t,"archive")}await Promise.all([i.fetchStaff(),i.fetchStaffRequests(),i.fetchArchivedRequests()])}catch(e){p.value=e.message||"Error al archivar todas las solicitudes"}finally{c.value=!1}}},H=e=>{T.value=e,I.value=!0},G=async()=>{var e;if(T.value){c.value=!0,p.value="";try{const t=T.value.staff_id||(null==(e=T.value.user)?void 0:e.id);if(!t)throw new Error("ID de empleado no encontrado");await i.removeStaff(t),await Promise.all([i.fetchStaff(),i.fetchStaffRequests()]),I.value=!1,T.value=null}catch(t){p.value=t.message||"Error al eliminar miembro del personal"}finally{c.value=!1}}},K=()=>{R.value=!R.value},J=e=>{var a;const n=e.staff_id||(null==(a=e.user)?void 0:a.id);t.push("/admin/staff/"+n)},Y=()=>{E.value=!0},Q=async()=>{x.value.next&&(c.value=!0,await i.fetchStaff(x.value.next),c.value=!1)},Z=async()=>{x.value.prev&&(c.value=!0,await i.fetchStaff(x.value.prev),c.value=!1)};return(e,t)=>(w(),s("div",oP,[o("div",rP,[t[11]||(t[11]=o("h1",{class:"page-title"},"Gestión de Personal",-1)),!c.value&&f.value.length>0?(w(),s("div",lP,[o("div",cP,[o("span",dP,l(U.value.total),1),t[8]||(t[8]=o("span",{class:"stat-label"},"Total",-1))]),o("div",uP,[o("span",hP,l(U.value.avgRating),1),t[9]||(t[9]=o("span",{class:"stat-label"},"Rating promedio",-1))])])):r("",!0),h(jE,{onClick:Y,variant:"primary",icon:"fas fa-plus"},{default:m(()=>t[10]||(t[10]=[v(" Invitar Personal ")])),_:1,__:[10]})]),c.value?(w(),s("div",pP,t[12]||(t[12]=[o("div",{class:"spinner"},null,-1),o("p",null,"Cargando personal...",-1)]))):p.value?(w(),s("div",mP,[o("p",fP,l(p.value),1),h(jE,{onClick:t[0]||(t[0]=t=>e.$router.go(0)),variant:"primary"},{default:m(()=>t[13]||(t[13]=[v(" Reintentar ")])),_:1,__:[13]})])):(w(),s("div",vP,[o("section",gP,[o("div",bP,[o("div",null,[o("h2",wP,[v(l(R.value?"Solicitudes Archivadas":"Solicitudes Pendientes")+" ",1),!R.value&&y.value.length?(w(),s("span",yP,l(y.value.length),1)):r("",!0)])]),R.value?r("",!0):(w(),s("div",_P,[h(jE,{onClick:W,size:"sm",disabled:!y.value.length},{default:m(()=>t[14]||(t[14]=[v("Archivar Todo")])),_:1,__:[14]},8,["disabled"]),h(jE,{onClick:z,size:"sm",variant:"success",disabled:!y.value.length},{default:m(()=>t[15]||(t[15]=[v("Confirmar Todo")])),_:1,__:[15]},8,["disabled"])]))]),c.value?(w(),s("div",kP,[(w(),s(_,null,k(3,e=>h(sP,{key:e})),64))])):(w(),s("div",CP,[M.value.length?(w(),s("div",IP,[(w(!0),s(_,null,k(M.value,e=>(w(),S(LA,{key:e.id,request:e,"is-archived":R.value,onConfirm:q,onInvite:V,onArchive:B,onUnarchive:j,onReject:$},null,8,["request","is-archived"]))),128))])):(w(),s("div",EP,t[16]||(t[16]=[o("p",null,"No hay solicitudes para mostrar.",-1)])))])),h(jE,{onClick:K,size:"sm",class:"mt-3"},{default:m(()=>[v(l(R.value?"Ver Pendientes":"Ver Archivadas"),1)]),_:1})]),o("section",SP,[o("div",TP,[t[17]||(t[17]=o("h2",{class:"section-title"},"Tu Personal",-1)),d(o("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>N.value=e),class:"search-input",placeholder:"Buscar personal..."},null,512),[[u,N.value]])]),c.value?(w(),s("div",NP,[(w(),s(_,null,k(4,e=>h(eP,{key:e})),64))])):(w(),s("div",AP,[L.value.length?r("",!0):(w(),s("p",PP,"No se encontró personal.")),(w(!0),s(_,null,k(L.value,e=>(w(),S(JA,{key:e.id,employee:e,onRemove:H,onView:J},null,8,["employee"]))),128))])),O.value.last_page>1?(w(),s("div",RP,[o("button",{class:"pagination-button",disabled:!x.value.prev,onClick:Z},"Anterior",8,xP),o("span",null,l(O.value.current_page)+" / "+l(O.value.last_page),1),o("button",{class:"pagination-button",disabled:!x.value.next,onClick:Q},"Siguiente",8,DP)])):r("",!0)])])),h(KE,{modelValue:E.value,"onUpdate:modelValue":t[5]||(t[5]=e=>E.value=e),title:"Invitar Personal",size:"md"},{footer:m(()=>[o("button",{class:"btn btn-secondary",onClick:t[4]||(t[4]=e=>E.value=!1)}," Cancelar "),o("button",{class:"btn btn-primary",onClick:F,disabled:!A.value||c.value},[c.value?(w(),s("span",FP,"Enviando...")):(w(),s("span",qP,"Enviar invitación"))],8,UP)]),default:m(()=>[o("div",OP,[o("div",LP,[t[18]||(t[18]=o("label",{for:"invite-email"},"Correo electrónico",-1)),d(o("input",{id:"invite-email",type:"email","onUpdate:modelValue":t[2]||(t[2]=e=>A.value=e),placeholder:"Ingresa el correo electrónico",class:"form-control"},null,512),[[u,A.value]])]),o("div",MP,[t[20]||(t[20]=o("label",{for:"invite-role"},"Cargo",-1)),d(o("select",{id:"invite-role","onUpdate:modelValue":t[3]||(t[3]=e=>P.value=e),class:"form-control"},t[19]||(t[19]=[o("option",{value:"waiter"},"Mozo",-1),o("option",{value:"kitchen"},"Cocinero",-1),o("option",{value:"cashier"},"Cajero",-1),o("option",{value:"manager"},"Gerente",-1),o("option",{value:"cleaning"},"Limpieza",-1)]),512),[[D,P.value]])])])]),_:1},8,["modelValue"]),h(KE,{modelValue:I.value,"onUpdate:modelValue":t[7]||(t[7]=e=>I.value=e),title:"Desvincular empleado",size:"sm"},{footer:m(()=>[o("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=e=>I.value=!1)}," Cancelar "),o("button",{class:"btn btn-danger",onClick:G,disabled:c.value},[c.value?(w(),s("span",jP)):r("",!0),t[21]||(t[21]=v(" Desvincular "))],8,BP)]),default:m(()=>{var e,a,n,i,s;return[o("p",null,"¿Estás seguro de que deseas desvincular a "+l((null==(a=null==(e=T.value)?void 0:e.user)?void 0:a.name)||(null==(s=null==(i=null==(n=T.value)?void 0:n.user)?void 0:i.user_profile)?void 0:s.display_name))+"?",1),t[22]||(t[22]=o("p",{class:"warning-text"},"Esta acción no se puede deshacer.",-1))]}),_:1,__:[22]},8,["modelValue"])]))}},zP=Mh($P,[["__scopeId","data-v-7a46563e"]]),VP={class:"review-card"},WP={class:"review-header"},HP={class:"reviewer-info"},GP=["src","alt"],KP={class:"reviewer-name"},JP={class:"review-rating"},YP={class:"stars-container"},QP={class:"rating-value"},ZP={class:"review-text"},XP={class:"review-footer"},eR={key:0,class:"review-date"},tR={__name:"ReviewCard",props:{review:{type:Object,required:!0},canDelete:{type:Boolean,default:!1}},emits:["delete"],setup(e,{emit:t}){const n=e,i=t,c=a(!1),d=()=>{c.value=!0},u=()=>{i("delete",n.review.id),c.value=!1},h=e=>{if(!e)return"";return new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})};return(t,a)=>{var n,i,p;return w(),s("div",VP,[o("div",WP,[o("div",HP,[o("img",{src:null==(n=e.review.reviewer)?void 0:n.avatar,alt:null==(i=e.review.reviewer)?void 0:i.name,class:"reviewer-avatar"},null,8,GP),o("h3",KP,l(null==(p=e.review.reviewer)?void 0:p.name),1)]),o("div",JP,[o("div",YP,[(w(),s(_,null,k(5,t=>o("i",{key:t,class:C(["bi",t<=e.review.rating?"bi-star-fill":"bi-star"])},null,2)),64))]),o("span",QP,l(e.review.rating),1)]),e.canDelete?(w(),s("button",{key:0,class:"delete-button",onClick:d,"aria-label":"Eliminar reseña"},a[2]||(a[2]=[o("i",{class:"bi bi-trash"},null,-1)]))):r("",!0)]),o("p",ZP,l(e.review.comment),1),o("div",XP,[e.review.date?(w(),s("span",eR,l(h(e.review.date)),1)):r("",!0)]),c.value?(w(),S(KE,{key:0,modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=e=>c.value=e),title:"Eliminar reseña",size:"sm"},{footer:m(()=>[o("button",{class:"btn btn-secondary",onClick:a[0]||(a[0]=e=>c.value=!1)}," Cancelar "),o("button",{class:"btn btn-danger",onClick:u}," Eliminar ")]),default:m(()=>[a[3]||(a[3]=o("p",null,"¿Estás seguro de que deseas eliminar esta reseña?",-1)),a[4]||(a[4]=o("p",{class:"warning-text"},"Esta acción no se puede deshacer.",-1))]),_:1,__:[3,4]},8,["modelValue"])):r("",!0)])}}},aR=Mh(tR,[["__scopeId","data-v-99cedcd8"]]),nR={class:"base-input-wrapper"},iR={key:0,class:"base-input-label"},sR={key:0,class:"required-indicator"},oR=["type","value","placeholder","disabled","required","autocomplete","name"],rR={key:1,class:"base-input-error-message"},lR={__name:"BaseInput",props:{modelValue:{type:[String,Number],default:""},label:{type:String,default:""},placeholder:{type:String,default:""},type:{type:String,default:"text"},error:{type:String,default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},autocomplete:{type:String,default:"off"},name:{type:String,default:""}},emits:["update:modelValue","focus","blur"],setup(e,{emit:t}){const i=e,c=t,d=a(i.modelValue),u=a(!1);E(()=>i.modelValue,e=>{d.value=e});const h=e=>{const t=e.target.value;d.value=t,c("update:modelValue",t)},p=e=>{u.value=!0,c("focus",e)},m=e=>{u.value=!1,c("blur",e)},f=n(()=>["base-input",{"base-input-disabled":i.disabled},{"base-input-error":i.error},{"base-input-focused":u.value}]);return(t,a)=>(w(),s("div",nR,[e.label?(w(),s("label",iR,[v(l(e.label)+" ",1),e.required?(w(),s("span",sR,"*")):r("",!0)])):r("",!0),o("input",{type:e.type,value:d.value,placeholder:e.placeholder,disabled:e.disabled,required:e.required,autocomplete:e.autocomplete,name:e.name,class:C(f.value),onInput:h,onFocus:p,onBlur:m},null,42,oR),e.error?(w(),s("p",rR,l(e.error),1)):r("",!0)]))}},cR=Mh(lR,[["__scopeId","data-v-da9b847d"]]),dR={class:"form-group"},uR={class:"form-group"},hR={__name:"SendNotificationModal",props:{modelValue:Boolean,loading:Boolean},emits:["update:modelValue","submit"],setup(e,{emit:t}){const i=t,s=a({title:"",body:""}),r=n(()=>""!==s.value.title.trim()&&""!==s.value.body.trim()),l=()=>{r.value&&i("submit",{...s.value})};return(t,a)=>(w(),S(KE,{"model-value":e.modelValue,title:"Enviar Notificación","onUpdate:modelValue":a[3]||(a[3]=e=>t.$emit("update:modelValue",e))},{body:m(()=>[o("form",{onSubmit:c(l,["prevent"]),class:"send-notification-form"},[o("div",dR,[a[4]||(a[4]=o("label",{for:"title"},"Título",-1)),h(cR,{id:"title",modelValue:s.value.title,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value.title=e),placeholder:"Ej: Recordatorio de reunión",required:""},null,8,["modelValue"])]),o("div",uR,[a[5]||(a[5]=o("label",{for:"body"},"Mensaje",-1)),d(o("textarea",{id:"body","onUpdate:modelValue":a[1]||(a[1]=e=>s.value.body=e),rows:"4",placeholder:"Escribe aquí el mensaje de la notificación...",required:"",class:"textarea-input"},null,512),[[u,s.value.body]])])],32)]),footer:m(()=>[h(jE,{onClick:a[2]||(a[2]=e=>t.$emit("update:modelValue",!1)),variant:"secondary"},{default:m(()=>a[6]||(a[6]=[v(" Cancelar ")])),_:1,__:[6]}),h(jE,{onClick:l,loading:e.loading,disabled:!r.value},{default:m(()=>a[7]||(a[7]=[v(" Enviar ")])),_:1,__:[7]},8,["loading","disabled"])]),_:1},8,["model-value"]))}},pR=Mh(hR,[["__scopeId","data-v-a3aa051f"]]),mR={class:"staff-detail-container"},fR={key:0,class:"loading-container"},vR={key:1,class:"error-container"},gR={key:2,class:"staff-detail-content"},bR={class:"profile-card"},wR={class:"profile-header"},yR={class:"profile-name-container"},_R={class:"profile-data"},kR={class:"data-row"},CR={key:0,class:"text-muted",style:{"font-size":"0.875rem"}},ER={class:"data-row"},IR={class:"data-row"},SR={class:"data-row"},TR={class:"data-row"},NR={class:"data-row"},AR={class:"data-row"},PR={class:"data-row"},RR={class:"data-row"},xR={class:"data-row"},DR={class:"data-row"},OR={class:"data-row"},LR={class:"data-row"},MR={class:"data-row"},UR={class:"data-row"},FR={class:"profile-actions"},qR={class:"reviews-section d-none"},BR={class:"reviews-header"},jR={class:"average-rating"},$R={class:"stars-container"},zR={class:"rating-text"},VR={class:"add-review-buttons"},WR={key:0,class:"empty-reviews"},HR={key:1,class:"reviews-list"},GR={class:"confirm-content"},KR={class:"confirm-input"},JR=["disabled"],YR={class:"add-review-form"},QR={class:"rating-input"},ZR={class:"star-rating"},XR=["onClick"],ex={class:"comment-input"},tx=["disabled"],ax={key:0},nx={key:1},ix=Mh({__name:"StaffDetail",setup(e){const t=y(),c=b(),p=CE(),f=t.params.id,E=a(!1),I=a(""),T=a(null),N=a(!1),A=a(!1),P=a(""),R=a({rating:5,comment:""}),x=a(!1),D=a(!1),O=a(!1),L={experience:"experience_years",seniority:"seniority_years",schedule:"employment_type",currentSchedule:"current_schedule"};g(async()=>{E.value=!0,I.value="";try{const e=await p.fetchStaffMember(f);T.value=e}catch(e){I.value=e.message||"Error al cargar datos del empleado"}finally{E.value=!1}});const M=async()=>{if("DESVINCULAR"===P.value){E.value=!0,I.value="";try{await p.removeStaff(f),c.push("/admin/staff")}catch(e){I.value=e.message||"Error al eliminar al miembro del personal"}finally{E.value=!1,N.value=!1}}},U=async(e,t)=>{if(!T.value)return;if("birth_date"===e){const e=new Date(t),a=new Date;let n=a.getFullYear()-e.getFullYear();const i=a.getMonth()-e.getMonth();if((i<0||0===i&&a.getDate()<e.getDate())&&n--,n<16)return void(I.value="El empleado debe ser mayor de 16 años")}x.value=!0;const a=L[e]||e;try{if(await p.updateStaffMember(f,{[a]:t}),T.value[a]=t,T.value[e]=t,"birth_date"===e){const e=new Date(t).toLocaleDateString("es-ES");T.value.birthdate_formatted=e}if("hire_date"===e){const e=new Date(t).toLocaleDateString("es-ES");T.value.hire_date_formatted=e}}catch(n){I.value=n.message||`Error al actualizar ${e}`}finally{x.value=!1}},F=async e=>{if(T.value)try{x.value=!0,await p.deleteReview(f,e),T.value.reviews=T.value.reviews.filter(t=>t.id!==e)}catch(t){I.value=t.message||"Error al eliminar reseña"}finally{x.value=!1}},q=async()=>{if(T.value&&R.value.comment)try{x.value=!0;const e=await p.addReview(f,R.value);T.value.reviews.push(e),R.value={rating:5,comment:""},A.value=!1}catch(e){I.value=e.message||"Error al agregar reseña"}finally{x.value=!1}},B=()=>{if(T.value&&T.value.phone){const e=T.value.phone.replace(/[^0-9]/g,""),t=encodeURIComponent("Hola, te contacto desde la app MOZO.");window.open(`https://wa.me/${e}?text=${t}`,"_blank")}},j=()=>{if(T.value&&T.value.email){const e=encodeURIComponent("Contacto desde app MOZO"),t=encodeURIComponent("Hola, te contacto desde la app MOZO.");window.open(`mailto:${T.value.email}?subject=${e}&body=${t}`,"_blank")}},$=()=>{c.push("/admin/staff")},z=[{value:"masculino",label:"Masculino"},{value:"femenino",label:"Femenino"},{value:"otro",label:"Otro"}],V=[{value:"Gerente",label:"Gerente"},{value:"Mozo",label:"Mozo"},{value:"Cajero",label:"Cajero"},{value:"Cocinero",label:"Cocinero"},{value:"Limpieza",label:"Limpieza"}],W=[{value:"full-time",label:"Tiempo completo"},{value:"part-time",label:"Medio tiempo"},{value:"hourly",label:"Por horas"},{value:"weekends-only",label:"Solo fines de semana"}],H=()=>{A.value=!0},G=n(()=>{if(!T.value||!T.value.reviews.length)return 0;return(T.value.reviews.reduce((e,t)=>e+t.rating,0)/T.value.reviews.length).toFixed(1)}),K=n(()=>T.value&&T.value.reviews.length?[...T.value.reviews].sort((e,t)=>new Date(t.date)-new Date(e.date)):[]),J=n(()=>{if(!T.value||!T.value.birth_date)return null;const e=new Date(T.value.birth_date),t=new Date;let a=t.getFullYear()-e.getFullYear();const n=t.getMonth()-e.getMonth();return(n<0||0===n&&t.getDate()<e.getDate())&&a--,a}),Y=async e=>{var t,a;O.value=!0;try{const t={user_id:T.value.user.id,title:e.title,body:e.body},a=await ga.sendPushToUser(t);sr(a.message||"Notificación enviada con éxito"),D.value=!1}catch(n){or((null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Error al enviar la notificación")}finally{O.value=!1}},Q=()=>{N.value=!0};return(e,t)=>(w(),s("div",mR,[o("div",{class:"staff-header"},[o("button",{class:"back-button",onClick:$},t[25]||(t[25]=[o("i",{class:"bi bi-arrow-left"},null,-1),v(" Volver ")]))]),E.value?(w(),s("div",fR,t[26]||(t[26]=[o("div",{class:"loading-spinner"},null,-1),o("p",null,"Cargando datos del empleado...",-1)]))):I.value?(w(),s("div",vR,[o("p",null,l(I.value),1),h(jE,{onClick:t[0]||(t[0]=t=>e.$router.go(0)),variant:"primary"},{default:m(()=>t[27]||(t[27]=[v(" Reintentar ")])),_:1,__:[27]})])):T.value?(w(),s("div",gR,[o("div",bR,[o("div",wR,[h(UE,{src:T.value.avatar_url,alt:`Foto de ${T.value.name}`,editable:!1},null,8,["src","alt"]),o("div",yR,[h(xE,{value:T.value.name,"onUpdate:value":t[1]||(t[1]=e=>U("name",e)),type:"text",placeholder:"Nombre completo",editable:!1,class:"profile-name"},null,8,["value"])])]),o("div",_R,[o("div",kR,[h(xE,{value:T.value.birth_date,"display-value":T.value.birthdate_formatted,label:"Fecha de nacimiento","onUpdate:value":t[2]||(t[2]=e=>U("birth_date",e)),type:"date",editable:!1},null,8,["value","display-value"]),J.value?(w(),s("div",CR,"Edad: "+l(J.value)+" años",1)):r("",!0)]),o("div",ER,[h(xE,{value:T.value.height,label:"Estatura","onUpdate:value":t[3]||(t[3]=e=>U("height",e)),type:"number",min:1,max:2.5,step:.01,unit:"mt",editable:!1},null,8,["value"])]),o("div",IR,[h(xE,{value:T.value.weight,label:"Peso","onUpdate:value":t[4]||(t[4]=e=>U("weight",e)),type:"number",min:30,max:200,unit:"kg",editable:!1},null,8,["value"])]),o("div",SR,[h(xE,{value:T.value.gender,label:"Sexo","onUpdate:value":t[5]||(t[5]=e=>U("gender",e)),type:"select",options:z,editable:!1},null,8,["value"])]),o("div",TR,[h(xE,{value:T.value.experience_years,label:"Años de experiencia","onUpdate:value":t[6]||(t[6]=e=>U("experience",e)),type:"number",min:0,max:50,unit:"años",editable:!1},null,8,["value"])]),o("div",NR,[h(xE,{value:T.value.seniority_years,label:"Antigüedad","onUpdate:value":t[7]||(t[7]=e=>U("seniority",e)),type:"number",min:0,max:50,unit:"años de antigüedad",editable:!1},null,8,["value"])]),o("div",AR,[h(xE,{value:T.value.email,label:"Email","onUpdate:value":t[8]||(t[8]=e=>U("email",e)),type:"text",editable:!1},null,8,["value"])]),o("div",PR,[h(xE,{value:T.value.phone,label:"Teléfono","onUpdate:value":t[9]||(t[9]=e=>U("phone",e)),type:"text",editable:!1},null,8,["value"])]),o("div",RR,[h(xE,{value:T.value.hire_date,"display-value":T.value.hire_date_formatted,label:"Fecha de contratación","onUpdate:value":t[10]||(t[10]=e=>U("hire_date",e)),type:"date",editable:!1},null,8,["value","display-value"])]),o("div",xR,[h(xE,{value:T.value.position,label:"Cargo","onUpdate:value":t[11]||(t[11]=e=>U("position",e)),type:"select",options:V,editable:!0},null,8,["value"])]),o("div",DR,[h(xE,{value:T.value.salary,label:"Salario","onUpdate:value":t[12]||(t[12]=e=>U("salary",e)),type:"number",min:0,step:.01,unit:"$",editable:!0},null,8,["value"])]),o("div",OR,[h(xE,{value:T.value.notes,label:"Notas","onUpdate:value":t[13]||(t[13]=e=>U("notes",e)),type:"textarea",editable:!0},null,8,["value"])]),o("div",LR,[h(xE,{value:T.value.education,label:"Condición","onUpdate:value":t[14]||(t[14]=e=>U("education",e)),type:"text",editable:!0},null,8,["value"])]),o("div",MR,[h(xE,{value:T.value.employment_type,label:"Modalidad","onUpdate:value":t[15]||(t[15]=e=>U("schedule",e)),type:"select",options:W,editable:!1},null,8,["value"])]),o("div",UR,[h(xE,{value:T.value.current_schedule,label:"Horario actual","onUpdate:value":t[16]||(t[16]=e=>U("currentSchedule",e)),type:"text",editable:!1},null,8,["value"])])]),o("div",FR,[h(jE,{variant:"primary",onClick:t[17]||(t[17]=t=>e.$router.push(`/admin/staff/${i(f)}/history`)),class:"action-button d-none"},{default:m(()=>t[28]||(t[28]=[v(" Ver historial ")])),_:1,__:[28]}),h(jE,{variant:"secondary",onClick:B,class:"action-button",disabled:!T.value.phone},{default:m(()=>t[29]||(t[29]=[o("i",{class:"bi bi-whatsapp"},null,-1),v(" WhatsApp ")])),_:1,__:[29]},8,["disabled"]),!T.value.phone&&T.value.email?(w(),S(jE,{key:0,variant:"secondary",onClick:j,class:"action-button"},{default:m(()=>t[30]||(t[30]=[o("i",{class:"bi bi-envelope"},null,-1),v(" Enviar Correo ")])),_:1,__:[30]})):r("",!0),h(jE,{variant:"danger",onClick:Q,class:"action-button"},{default:m(()=>t[31]||(t[31]=[o("i",{class:"bi bi-person-dash"},null,-1),v(" Desvincular ")])),_:1,__:[31]})])]),o("div",qR,[o("div",BR,[t[34]||(t[34]=o("h2",{class:"section-title"},"Reseñas",-1)),o("div",jR,[o("div",$R,[(w(),s(_,null,k(5,e=>o("i",{key:e,class:C(["bi",e<=Math.round(T.value.rating)?"bi-star-fill":"bi-star"])},null,2)),64))]),o("span",zR,l(G.value),1)]),o("div",VR,[h(jE,{onClick:H,variant:"primary",class:"add-review-button"},{default:m(()=>t[32]||(t[32]=[o("i",{class:"bi bi-plus-lg"},null,-1),v(" Añadir reseña ")])),_:1,__:[32]}),h(jE,{onClick:B,variant:"secondary"},{default:m(()=>t[33]||(t[33]=[o("i",{class:"bi bi-whatsapp"},null,-1),v(" Contactar ")])),_:1,__:[33]})])]),K.value.length?(w(),s("div",HR,[(w(!0),s(_,null,k(K.value,e=>(w(),S(aR,{key:e.id,review:e,"can-delete":!0,onDelete:F},null,8,["review"]))),128))])):(w(),s("div",WR,t[35]||(t[35]=[o("p",null,"No hay reseñas todavía.",-1)])))])])):r("",!0),h(KE,{modelValue:N.value,"onUpdate:modelValue":t[20]||(t[20]=e=>N.value=e),title:"Desvincular empleado",size:"md"},{footer:m(()=>[o("button",{class:"btn btn-secondary",onClick:t[19]||(t[19]=e=>N.value=!1)}," Cancelar "),o("button",{class:"btn btn-danger",onClick:M,disabled:"DESVINCULAR"!==P.value}," Desvincular ",8,JR)]),default:m(()=>{var e;return[o("div",GR,[o("p",null,"¿Estás seguro de que deseas desvincular a "+l(null==(e=T.value)?void 0:e.name)+" del personal?",1),t[37]||(t[37]=o("p",{class:"confirm-warning"},"Esta acción no se puede deshacer.",-1)),o("div",KR,[t[36]||(t[36]=o("label",{for:"confirm-text"},'Escribe "DESVINCULAR" para confirmar',-1)),d(o("input",{type:"text",id:"confirm-text","onUpdate:modelValue":t[18]||(t[18]=e=>P.value=e),class:"form-control"},null,512),[[u,P.value]])])])]}),_:1},8,["modelValue"]),h(KE,{modelValue:A.value,"onUpdate:modelValue":t[23]||(t[23]=e=>A.value=e),title:"Añadir nueva reseña",size:"md"},{footer:m(()=>[o("button",{class:"btn btn-secondary",onClick:t[22]||(t[22]=e=>A.value=!1)}," Cancelar "),o("button",{class:"btn btn-primary",onClick:q,disabled:!R.value.comment||x.value},[x.value?(w(),s("span",ax,"Guardando...")):(w(),s("span",nx,"Guardar reseña"))],8,tx)]),default:m(()=>[o("div",YR,[o("div",QR,[t[38]||(t[38]=o("label",null,"Calificación",-1)),o("div",ZR,[(w(),s(_,null,k(5,e=>o("button",{key:e,type:"button",class:C(["star-button",{active:e<=R.value.rating}]),onClick:t=>R.value.rating=e},[o("i",{class:C(["bi",e<=R.value.rating?"bi-star-fill":"bi-star"])},null,2)],10,XR)),64))])]),o("div",ex,[t[39]||(t[39]=o("label",{for:"review-comment"},"Comentario",-1)),d(o("textarea",{id:"review-comment","onUpdate:modelValue":t[21]||(t[21]=e=>R.value.comment=e),rows:"4",placeholder:"Escribe tu comentario aquí...",class:"form-control"},null,512),[[u,R.value.comment]])])])]),_:1},8,["modelValue"]),h(pR,{modelValue:D.value,"onUpdate:modelValue":t[24]||(t[24]=e=>D.value=e),loading:O.value,onSubmit:Y},null,8,["modelValue","loading"])]))}},[["__scopeId","data-v-2fe9964d"]]),sx={class:"profile-container"},ox={key:0,class:"loading-container"},rx={key:1,class:"alert alert-danger"},lx={key:2,class:"alert alert-success"},cx={key:3,class:"profile-content"},dx={class:"profile-card"},ux={class:"profile-main"},hx={class:"profile-image-container"},px=["src"],mx={class:"profile-info"},fx={class:"form-group"},vx=["disabled"],gx={class:"form-group"},bx=["disabled"],wx={class:"form-group"},yx=["disabled"],_x={class:"form-group"},kx=["disabled"],Cx={class:"form-group"},Ex=["disabled"],Ix={class:"form-group"},Sx=["disabled"],Tx={class:"form-group"},Nx=["disabled"],Ax={key:0,class:"form-text"},Px={class:"form-group"},Rx=["disabled"],xx={key:0,class:"form-text"},Dx={class:"profile-actions"},Ox=["disabled"],Lx={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Mx=["disabled"],Ux=["disabled"],Fx={class:"confirm-content"},qx={class:"confirm-input"},Bx=["disabled"],jx=["disabled"],$x=["disabled"],zx={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Vx=Mh({__name:"Profile",setup(e){const t=b(),i=tn(),p=a({display_name:"",business_name:"",position:"",corporate_email:"",corporate_phone:"",avatar:"",business_id:null}),f=a({current:"",new:"",confirm:""}),y=a(!0),_=a(!1),k=a(""),C=a(""),E=a(null),I=a(null),S=a(!1),T=a(""),N=a(!1),A=n(()=>!f.value.new||f.value.new.length>=8),P=n(()=>!f.value.new||!f.value.confirm||f.value.new===f.value.confirm),R=n(()=>!!p.value.display_name&&(!(f.value.current||f.value.new||f.value.confirm)||f.value.current&&A.value&&P.value)),x=async()=>{y.value=!0,k.value="";try{const e=i.user;console.log("🔍 Profile: Auth store user data:",e);const t=(await ga.getActiveUserProfile()).data.data,a=t.profile_data;console.log("🔍 Profile: Backend response data:",t),t&&"admin"===t.type?p.value={display_name:t.display_name||(null==e?void 0:e.display_name)||(null==e?void 0:e.name)||"",business_name:a.business_name||"",position:a.position||"Administrador",corporate_email:a.corporate_email||(null==e?void 0:e.email)||"",corporate_phone:a.corporate_phone||"",avatar:t.avatar||(null==e?void 0:e.avatar)||"",business_id:t.business_id}:p.value={display_name:(null==e?void 0:e.display_name)||(null==e?void 0:e.name)||"Administrador",business_name:"Mi Negocio",position:"Administrador",corporate_email:(null==e?void 0:e.email)||"",corporate_phone:"",avatar:(null==e?void 0:e.avatar)||"",business_id:null},console.log("🔍 Profile: Final user data:",p.value)}catch(e){console.error("Error al cargar datos del usuario:",e),k.value="No se pudieron cargar tus datos. Por favor, inténtalo de nuevo."}finally{y.value=!1}},D=e=>{const t=e.target.files[0];if(!t)return;if(t.size>5242880)return void(k.value="La imagen no puede ser mayor a 5MB");I.value=t;const a=new FileReader;a.onload=e=>{E.value=e.target.result},a.readAsDataURL(t)},O=async()=>{var e,t;if(R.value){_.value=!0,k.value="",C.value="";try{const e=new FormData;p.value.display_name&&e.append("display_name",p.value.display_name),p.value.business_name&&e.append("business_name",p.value.business_name),p.value.position&&e.append("position",p.value.position),p.value.corporate_email&&e.append("corporate_email",p.value.corporate_email),p.value.corporate_phone&&e.append("corporate_phone",p.value.corporate_phone),I.value&&e.append("avatar",I.value);const t=await ga.updateAdminUserProfile(e);t.data.data&&(p.value.avatar=t.data.data.avatar,p.value.display_name=t.data.data.display_name),I.value=null,E.value=null,C.value=t.data.message||"Perfil actualizado correctamente",f.value.current&&f.value.new&&await L()}catch(a){console.error("Error al actualizar perfil:",a),k.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"No se pudo actualizar el perfil. Por favor, inténtalo de nuevo."}finally{_.value=!1,k.value||await x()}}},L=async()=>{var e,t;if(f.value.current&&f.value.new&&f.value.confirm&&A.value&&P.value)try{await ga.changePassword({current_password:f.value.current,password:f.value.new,password_confirmation:f.value.confirm}),f.value.current="",f.value.new="",f.value.confirm="",C.value="Contraseña actualizada correctamente"}catch(a){k.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"Error al cambiar contraseña"}},M=async()=>{var e,a;if("ELIMINAR"===T.value){N.value=!0;try{await ga.deleteAccount({password:f.value.current}),await i.logout(),t.push("/login")}catch(n){console.error("Error al eliminar cuenta:",n),k.value=(null==(a=null==(e=n.response)?void 0:e.data)?void 0:a.message)||"No se pudo eliminar la cuenta. Por favor, inténtalo de nuevo.",S.value=!1,T.value="",N.value=!1}}},U=()=>{t.push("/admin")};return g(()=>{x()}),(e,t)=>(w(),s("div",sx,[o("div",{class:"profile-header"},[o("button",{class:"back-button",onClick:U}," ← Volver ")]),y.value&&!p.value.name?(w(),s("div",ox,t[12]||(t[12]=[o("div",{class:"loading-spinner"},null,-1),o("p",null,"Cargando datos del perfil...",-1)]))):r("",!0),k.value?(w(),s("div",rx,l(k.value),1)):r("",!0),C.value?(w(),s("div",lx,l(C.value),1)):r("",!0),!y.value||p.value.name?(w(),s("div",cx,[o("div",dx,[o("div",ux,[o("div",hx,[o("img",{src:E.value||p.value.avatar||"/placeholder-avatar.png",alt:"Foto de perfil",class:"profile-image"},null,8,px),t[13]||(t[13]=o("label",{for:"avatar-upload",class:"avatar-edit-btn"},[o("i",{class:"bi bi-camera"})],-1)),o("input",{type:"file",id:"avatar-upload",accept:"image/*",class:"visually-hidden",onChange:D},null,32)]),o("div",mx,[o("form",{onSubmit:c(O,["prevent"])},[o("div",fx,[t[14]||(t[14]=o("label",{for:"display-name"},"Nombre para mostrar",-1)),d(o("input",{type:"text",id:"display-name","onUpdate:modelValue":t[0]||(t[0]=e=>p.value.display_name=e),class:"form-control",required:"",disabled:_.value,placeholder:"Tu nombre como administrador"},null,8,vx),[[u,p.value.display_name]])]),o("div",gx,[t[15]||(t[15]=o("label",{for:"business-name"},"Nombre del negocio",-1)),d(o("input",{type:"text",id:"business-name","onUpdate:modelValue":t[1]||(t[1]=e=>p.value.business_name=e),class:"form-control",disabled:_.value,placeholder:"Nombre de tu negocio"},null,8,bx),[[u,p.value.business_name]])]),o("div",wx,[t[16]||(t[16]=o("label",{for:"position"},"Cargo/Posición",-1)),d(o("input",{type:"text",id:"position","onUpdate:modelValue":t[2]||(t[2]=e=>p.value.position=e),class:"form-control",disabled:_.value,placeholder:"Administrador, Gerente, etc."},null,8,yx),[[u,p.value.position]])]),o("div",_x,[t[17]||(t[17]=o("label",{for:"corporate-email"},"Email corporativo",-1)),d(o("input",{type:"email",id:"corporate-email","onUpdate:modelValue":t[3]||(t[3]=e=>p.value.corporate_email=e),class:"form-control",disabled:_.value,placeholder:"email@empresa.com"},null,8,kx),[[u,p.value.corporate_email]])]),o("div",Cx,[t[18]||(t[18]=o("label",{for:"corporate-phone"},"Teléfono corporativo",-1)),d(o("input",{type:"tel",id:"corporate-phone","onUpdate:modelValue":t[4]||(t[4]=e=>p.value.corporate_phone=e),class:"form-control",disabled:_.value,placeholder:"+1234567890"},null,8,Ex),[[u,p.value.corporate_phone]])]),t[23]||(t[23]=o("div",{class:"profile-divider"},[o("h3",null,"Cambiar contraseña")],-1)),o("div",Ix,[t[19]||(t[19]=o("label",{for:"current-password"},"Contraseña actual",-1)),d(o("input",{type:"password",id:"current-password","onUpdate:modelValue":t[5]||(t[5]=e=>f.value.current=e),class:"form-control",disabled:_.value},null,8,Sx),[[u,f.value.current]])]),o("div",Tx,[t[20]||(t[20]=o("label",{for:"new-password"},"Nueva contraseña",-1)),d(o("input",{type:"password",id:"new-password","onUpdate:modelValue":t[6]||(t[6]=e=>f.value.new=e),class:"form-control",disabled:_.value},null,8,Nx),[[u,f.value.new]]),f.value.new&&!A.value?(w(),s("div",Ax," La contraseña debe tener al menos 8 caracteres ")):r("",!0)]),o("div",Px,[t[21]||(t[21]=o("label",{for:"confirm-password"},"Confirmar nueva contraseña",-1)),d(o("input",{type:"password",id:"confirm-password","onUpdate:modelValue":t[7]||(t[7]=e=>f.value.confirm=e),class:"form-control",disabled:_.value},null,8,Rx),[[u,f.value.confirm]]),f.value.confirm&&!P.value?(w(),s("div",xx," Las contraseñas no coinciden ")):r("",!0)]),o("div",Dx,[o("button",{type:"submit",class:"btn btn-primary",disabled:_.value||!R.value},[_.value?(w(),s("span",Lx)):r("",!0),t[22]||(t[22]=v(" Guardar perfil "))],8,Ox),o("button",{type:"button",class:"btn btn-secondary",onClick:L,disabled:_.value||!f.value.current||!f.value.new||!f.value.confirm||!A.value||!P.value}," Cambiar contraseña ",8,Mx),o("button",{type:"button",class:"btn btn-danger",onClick:t[8]||(t[8]=e=>S.value=!0),disabled:_.value}," Eliminar cuenta ",8,Ux)])],32)])])])])):r("",!0),h(KE,{modelValue:S.value,"onUpdate:modelValue":t[11]||(t[11]=e=>S.value=e),title:"Eliminar cuenta",size:"md"},{footer:m(()=>[o("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=e=>S.value=!1),disabled:N.value}," Cancelar ",8,jx),o("button",{type:"button",class:"btn btn-danger",onClick:M,disabled:"ELIMINAR"!==T.value||N.value},[N.value?(w(),s("span",zx)):r("",!0),t[27]||(t[27]=v(" Eliminar mi cuenta "))],8,$x)]),default:m(()=>[o("div",Fx,[t[25]||(t[25]=o("p",null,"¿Estás seguro de que deseas eliminar tu cuenta? Esta acción no se puede deshacer.",-1)),t[26]||(t[26]=o("div",{class:"alert alert-danger"},[o("i",{class:"bi bi-exclamation-triangle-fill me-2"}),v(" Al eliminar tu cuenta perderás todo el acceso a tus datos y negocios asociados. ")],-1)),o("div",qx,[t[24]||(t[24]=o("label",{for:"confirm-delete"},'Escribe "ELIMINAR" para confirmar',-1)),d(o("input",{type:"text",class:"form-control",id:"confirm-delete","onUpdate:modelValue":t[9]||(t[9]=e=>T.value=e),disabled:N.value},null,8,Bx),[[u,T.value]])])])]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-f90f6dc8"]]),Wx={class:"settings-container"},Hx={key:0,class:"loading-container"},Gx={key:1,class:"error-container"},Kx={key:2,class:"settings-content"},Jx={key:0,class:"success-message"},Yx={class:"settings-section"},Qx={key:0,class:"form-group mb-3"},Zx=["value"],Xx=["value"],eD={class:"form-group"},tD={class:"form-group"},aD={class:"form-row"},nD={class:"form-group"},iD={class:"form-group"},sD={class:"form-group"},oD={class:"form-actions"},rD={class:"settings-section danger-zone"},lD={class:"danger-actions"},cD={class:"danger-block"},dD={class:"danger-block"},uD={class:"form-row"},hD={class:"form-group"},pD={class:"form-group"},mD={class:"form-group"},fD={class:"form-row"},vD={class:"form-group"},gD={class:"form-group"},bD={class:"form-group"},wD={class:"confirm-content"},yD={class:"confirm-content"},_D={class:"form-group mt-3"},kD={key:0,class:"error-text"},CD={__name:"Settings",setup(e){const t=b(),n=CE(),p=tn(),f=a(!1),y=a(""),C=a(""),E=a(null),I=a([]),T=a([]),N=a(!1),A=a(!1),R=a(!1),x=a(null),D=a(!1),O=a(""),L=a(""),M=a(null),U=P({number:"",name:"",capacity:4});g(async()=>{f.value=!0,y.value="";try{const[e,t]=await Promise.all([n.fetchBusinessData(!0),n.fetchAllBusinesses().catch(()=>[])]);E.value=e.business||{},I.value=Array.isArray(n.tables)&&n.tables.length>0?n.tables:[],T.value=t||[]}catch(e){y.value=e.message||"Error al cargar datos"}finally{f.value=!1}});const F=async()=>{if(E.value){f.value=!0,y.value="",C.value="";try{await n.updateBusinessData(E.value),C.value="Configuración guardada con éxito"}catch(e){y.value=e.message||"Error al guardar configuración"}finally{f.value=!1}}},q=async()=>{if(U.number&&U.capacity){f.value=!0,y.value="";try{const e=await n.createTable(U);e&&(I.value.push(e),U.number="",U.name="",U.capacity=4,N.value=!1)}catch(e){y.value=e.message||"Error al crear mesa"}finally{f.value=!1}}else y.value="Por favor, completa todos los campos requeridos"},B=async()=>{if(x.value){f.value=!0,y.value="";try{await n.updateTable(x.value),I.value=I.value.map(e=>e.id===x.value.id?x.value:e),A.value=!1,x.value=null}catch(e){y.value=e.message||"Error al actualizar mesa"}finally{f.value=!1}}},j=async()=>{if(x.value){f.value=!0,y.value="";try{await n.deleteTable(x.value.id),I.value=I.value.filter(e=>e.id!==x.value.id),R.value=!1,x.value=null}catch(e){y.value=e.message||"Error al eliminar mesa"}finally{f.value=!1}}},$=()=>{t.push({name:"admin"})},z=async()=>{await p.logout(),t.push("/login")},V=async e=>{const t=Number(e.target.value);if(t&&t!==n.activeBusinessId){f.value=!0,y.value="",C.value="";try{await n.selectActiveBusiness(t);const e=await n.fetchBusinessData();E.value=e||E.value,C.value="Negocio activo actualizado"}catch(a){y.value=a.message||"No se pudo cambiar el negocio activo"}finally{f.value=!1}}},W=()=>{var e;O.value="",L.value="",M.value=n.activeBusinessId||n.businessId||(null==(e=E.value)?void 0:e.id)||null,D.value=!0},H=async()=>{var e,a;if("ELIMINAR"===O.value.trim().toUpperCase()){f.value=!0,L.value="";try{let s=n.activeBusinessId||n.businessId||(null==(e=E.value)?void 0:e.id)||M.value;if(!s){try{await n.fetchBusinessData(!0)}catch(i){}s=n.activeBusinessId||n.businessId||(null==(a=E.value)?void 0:a.id)||M.value}if(!s)return void(L.value="No se encontró el negocio activo.");M.value=s;const o=await n.deleteBusiness(s);D.value=!1,"admin"===(null==o?void 0:o.redirected)?t.push({name:"admin"}):t.push({name:"admin-onboard"})}catch(s){L.value=s.message||"No se pudo eliminar el negocio"}finally{f.value=!1}}else L.value="Escribe ELIMINAR para confirmar."};return(e,t)=>(w(),s("div",Wx,[o("div",{class:"settings-header"},[o("button",{class:"back-button",onClick:$}," ← Volver "),t[21]||(t[21]=o("h1",null,"Configuración",-1))]),f.value?(w(),s("div",Hx,t[22]||(t[22]=[o("div",{class:"loading-spinner"},null,-1),o("p",null,"Cargando configuración...",-1)]))):y.value?(w(),s("div",Gx,[o("p",null,l(y.value),1),h(jE,{onClick:t[0]||(t[0]=t=>e.$router.go(0)),variant:"primary"},{default:m(()=>t[23]||(t[23]=[v(" Reintentar ")])),_:1,__:[23]})])):E.value?(w(),s("div",Kx,[C.value?(w(),s("div",Jx,l(C.value),1)):r("",!0),o("div",Yx,[t[31]||(t[31]=o("h2",null,"Información del negocio",-1)),T.value.length>1?(w(),s("div",Qx,[t[24]||(t[24]=o("label",{for:"active-business"},"Negocio activo",-1)),o("select",{id:"active-business",class:"form-select",value:i(n).activeBusinessId,onChange:V},[(w(!0),s(_,null,k(T.value,e=>(w(),s("option",{key:e.id,value:e.id},l(e.name),9,Xx))),128))],40,Zx)])):r("",!0),o("form",{onSubmit:c(F,["prevent"]),class:"business-form"},[o("div",eD,[t[25]||(t[25]=o("label",{for:"business-name"},"Nombre del restaurante",-1)),d(o("input",{id:"business-name",type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>E.value.name=e),required:""},null,512),[[u,E.value.name]])]),o("div",tD,[t[26]||(t[26]=o("label",{for:"business-address"},"Dirección",-1)),d(o("input",{id:"business-address",type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>E.value.address=e)},null,512),[[u,E.value.address]])]),o("div",aD,[o("div",nD,[t[27]||(t[27]=o("label",{for:"business-phone"},"Teléfono",-1)),d(o("input",{id:"business-phone",type:"tel","onUpdate:modelValue":t[3]||(t[3]=e=>E.value.phone=e)},null,512),[[u,E.value.phone]])]),o("div",iD,[t[28]||(t[28]=o("label",{for:"business-email"},"Email",-1)),d(o("input",{id:"business-email",type:"email","onUpdate:modelValue":t[4]||(t[4]=e=>E.value.email=e)},null,512),[[u,E.value.email]])])]),o("div",sD,[t[29]||(t[29]=o("label",{for:"business-description"},"Descripción",-1)),d(o("textarea",{id:"business-description","onUpdate:modelValue":t[5]||(t[5]=e=>E.value.description=e),rows:"3"},null,512),[[u,E.value.description]])]),o("div",oD,[h(jE,{type:"submit",variant:"primary",loading:f.value},{default:m(()=>t[30]||(t[30]=[v(" Guardar cambios ")])),_:1,__:[30]},8,["loading"])])],32)]),o("div",rD,[t[37]||(t[37]=o("h2",null,"Zona de Peligro",-1)),o("div",lD,[o("div",cD,[t[33]||(t[33]=o("h3",null,"Eliminar negocio",-1)),o("p",null,' Esta acción eliminará el negocio "'+l(E.value.name)+'" y todos sus datos asociados (mesas, menús, códigos QR, staff, llamadas, archivos, pivotes). Es irreversible. ',1),h(jE,{onClick:W,variant:"danger"},{default:m(()=>t[32]||(t[32]=[v(" Eliminar negocio ")])),_:1,__:[32]})]),o("div",dD,[t[35]||(t[35]=o("h3",null,"Cerrar sesión",-1)),t[36]||(t[36]=o("p",null,"Finaliza tu sesión actual de forma segura.",-1)),h(jE,{onClick:z,variant:"danger-outline"},{default:m(()=>t[34]||(t[34]=[v(" Cerrar sesión ")])),_:1,__:[34]})])])])])):r("",!0),h(KE,{modelValue:N.value,"onUpdate:modelValue":t[10]||(t[10]=e=>N.value=e),title:"Añadir nueva mesa",size:"md"},{footer:m(()=>[h(jE,{onClick:t[9]||(t[9]=e=>N.value=!1),variant:"outline"},{default:m(()=>t[41]||(t[41]=[v(" Cancelar ")])),_:1,__:[41]}),h(jE,{onClick:q,variant:"primary",loading:f.value},{default:m(()=>t[42]||(t[42]=[v(" Añadir ")])),_:1,__:[42]},8,["loading"])]),default:m(()=>[o("form",{onSubmit:c(q,["prevent"]),class:"table-form"},[o("div",uD,[o("div",hD,[t[38]||(t[38]=o("label",{for:"table-number"},"Número*",-1)),d(o("input",{id:"table-number",type:"number","onUpdate:modelValue":t[6]||(t[6]=e=>U.number=e),min:"1",required:""},null,512),[[u,U.number]])]),o("div",pD,[t[39]||(t[39]=o("label",{for:"table-capacity"},"Capacidad*",-1)),d(o("input",{id:"table-capacity",type:"number","onUpdate:modelValue":t[7]||(t[7]=e=>U.capacity=e),min:"1",required:""},null,512),[[u,U.capacity]])])]),o("div",mD,[t[40]||(t[40]=o("label",{for:"table-name"},"Nombre (opcional)",-1)),d(o("input",{id:"table-name",type:"text","onUpdate:modelValue":t[8]||(t[8]=e=>U.name=e),placeholder:"Ej: Terraza 1"},null,512),[[u,U.name]])])],32)]),_:1},8,["modelValue"]),x.value?(w(),S(KE,{key:3,modelValue:A.value,"onUpdate:modelValue":t[15]||(t[15]=e=>A.value=e),title:"Editar mesa",size:"md"},{footer:m(()=>[h(jE,{onClick:t[14]||(t[14]=e=>A.value=!1),variant:"outline"},{default:m(()=>t[46]||(t[46]=[v(" Cancelar ")])),_:1,__:[46]}),h(jE,{onClick:B,variant:"primary",loading:f.value},{default:m(()=>t[47]||(t[47]=[v(" Guardar ")])),_:1,__:[47]},8,["loading"])]),default:m(()=>[o("form",{onSubmit:c(B,["prevent"]),class:"table-form"},[o("div",fD,[o("div",vD,[t[43]||(t[43]=o("label",{for:"edit-table-number"},"Número*",-1)),d(o("input",{id:"edit-table-number",type:"number","onUpdate:modelValue":t[11]||(t[11]=e=>x.value.number=e),min:"1",required:""},null,512),[[u,x.value.number]])]),o("div",gD,[t[44]||(t[44]=o("label",{for:"edit-table-capacity"},"Capacidad*",-1)),d(o("input",{id:"edit-table-capacity",type:"number","onUpdate:modelValue":t[12]||(t[12]=e=>x.value.capacity=e),min:"1",required:""},null,512),[[u,x.value.capacity]])])]),o("div",bD,[t[45]||(t[45]=o("label",{for:"edit-table-name"},"Nombre (opcional)",-1)),d(o("input",{id:"edit-table-name",type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>x.value.name=e),placeholder:"Ej: Terraza 1"},null,512),[[u,x.value.name]])])],32)]),_:1},8,["modelValue"])):r("",!0),x.value?(w(),S(KE,{key:4,modelValue:R.value,"onUpdate:modelValue":t[17]||(t[17]=e=>R.value=e),title:"Eliminar mesa",size:"sm"},{footer:m(()=>[h(jE,{onClick:t[16]||(t[16]=e=>R.value=!1),variant:"outline"},{default:m(()=>t[49]||(t[49]=[v(" Cancelar ")])),_:1,__:[49]}),h(jE,{onClick:j,variant:"danger",loading:f.value},{default:m(()=>t[50]||(t[50]=[v(" Eliminar ")])),_:1,__:[50]},8,["loading"])]),default:m(()=>[o("div",wD,[o("p",null,"¿Estás seguro de que deseas eliminar la mesa "+l(x.value.number)+"?",1),t[48]||(t[48]=o("p",{class:"confirm-warning"},"Esta acción no se puede deshacer.",-1))])]),_:1},8,["modelValue"])):r("",!0),h(KE,{modelValue:D.value,"onUpdate:modelValue":t[20]||(t[20]=e=>D.value=e),title:"Eliminar negocio",size:"sm","static-backdrop":!0},{footer:m(()=>[h(jE,{onClick:t[19]||(t[19]=e=>D.value=!1),variant:"outline"},{default:m(()=>t[55]||(t[55]=[v(" Cancelar ")])),_:1,__:[55]}),h(jE,{onClick:H,variant:"danger",loading:f.value},{default:m(()=>t[56]||(t[56]=[v(" Eliminar definitivamente ")])),_:1,__:[56]},8,["loading"])]),default:m(()=>{var e;return[o("div",yD,[o("p",null,[t[51]||(t[51]=v(" Vas a eliminar el negocio ")),o("strong",null,l(null==(e=E.value)?void 0:e.name),1),t[52]||(t[52]=v(" y todos sus datos. "))]),t[54]||(t[54]=o("p",{class:"confirm-warning"},"Esta acción es permanente e irreversible.",-1)),o("div",_D,[t[53]||(t[53]=o("label",null,[v("Para confirmar, escribe "),o("strong",null,"ELIMINAR"),v(":")],-1)),d(o("input",{type:"text","onUpdate:modelValue":t[18]||(t[18]=e=>O.value=e),placeholder:"ELIMINAR"},null,512),[[u,O.value]])]),L.value?(w(),s("p",kD,l(L.value),1)):r("",!0)])]}),_:1},8,["modelValue"])]))}},ED=Mh(CD,[["__scopeId","data-v-1653f138"]]),ID={class:"debug-panel"},SD={class:"debug-section"},TD={class:"status-grid"},ND={class:"status-icon"},AD={class:"status-icon"},PD={class:"status-icon"},RD={class:"status-item"},xD={class:"debug-section"},DD={class:"button-grid"},OD=["disabled"],LD=["disabled"],MD=["disabled"],UD=["disabled"],FD={class:"debug-section"},qD={class:"test-form"},BD={class:"form-row"},jD={class:"form-row"},$D={class:"form-row"},zD=["disabled"],VD={class:"debug-section"},WD={class:"token-actions"},HD=["disabled"],GD={key:0,class:"debug-section"},KD={class:"debug-logs"},JD={class:"log-time"},YD={class:"log-message"},QD={class:"debug-section"},ZD={class:"tech-info"},XD={class:"info-item"},eO={class:"info-item"},tO={class:"info-item"},aO={class:"info-item"},nO={__name:"NotificationDebugPanel",setup(e){const t=tn(),c=lr(),h=a(!1),p=a([]),m=a(null),f=a({title:"🧪 Notificación de Prueba",body:"Esta es una notificación de prueba desde el panel de debug",type:"all"}),b=n(()=>t.isAuthenticated),y=a(!1),E=n(()=>!!m.value),I=P({browser:"",pushSupport:!1,serviceWorkerSupport:!1,firebaseProject:""});function S(e,t="info"){p.value.push({id:Date.now()+Math.random(),timestamp:new Date,message:e,type:t}),console.log(`[NotificationDebug] ${e}`)}function T(){p.value=[],S("🧹 Log limpiado","info")}function N(){const e=p.value.map(e=>`[${e.timestamp.toLocaleString()}] ${e.type.toUpperCase()}: ${e.message}`).join("\n"),t=new Blob([e],{type:"text/plain"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=`notification-debug-${(new Date).toISOString().slice(0,10)}.log`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a),S("💾 Log descargado","success")}async function A(){if(!h.value){h.value=!0,S("🔔 Solicitando permisos de notificación...","info");try{if(!("Notification"in window))throw new Error("Este navegador no soporta notificaciones push");const e=await Notification.requestPermission();S(`📋 Resultado de permisos: ${e}`,"info"),"granted"===e?(systemStatus.permissions=!0,S("✅ Permisos concedidos","success"),sr("Permisos de notificación concedidos"),await R()):(systemStatus.permissions=!1,S("❌ Permisos denegados","error"),or("Permisos de notificación denegados"))}catch(e){S(`❌ Error pidiendo permisos: ${e.message}`,"error"),or(`Error: ${e.message}`)}finally{h.value=!1}}}async function R(){if(!h.value){h.value=!0,S("🚀 Inicializando Firebase Cloud Messaging...","info");try{if(!t.isAuthenticated)throw new Error("Usuario no autenticado");await Ta();const e=await Na();if(!e)throw new Error("No se pudo obtener el token FCM");m.value=e,S(`🔑 Token FCM obtenido: ${e.substring(0,20)}...`,"success"),S("🔥 Listener de mensajes en primer plano configurado","success"),await x()}catch(e){S(`❌ Error inicializando FCM: ${e.message}`,"error"),or(`Error inicializando FCM: ${e.message}`)}finally{h.value=!1}}}async function x(){if(h.value)return;const e=m.value||localStorage.getItem("fcm_token");if(e){h.value=!0,S("📤 Enviando token al servidor...","info");try{await ba.storeDeviceToken(e,"web",t.user.id);S("✅ Token enviado al servidor exitosamente","success"),sr("Token FCM registrado en el servidor")}catch(a){S(`❌ Error enviando token: ${a.message}`,"error"),or(`Error enviando token: ${a.message}`)}finally{h.value=!1}}else S("❌ No hay token FCM para enviar","error")}async function O(){if(!h.value){h.value=!0,S("📥 Cargando notificaciones...","info");try{await c.loadNotifications(),S(`📬 ${c.totalUnreadCount} notificaciones no leídas cargadas`,"success"),sr("Notificaciones cargadas")}catch(e){S(`❌ Error cargando notificaciones: ${e.message}`,"error"),or(`Error cargando notificaciones: ${e.message}`)}finally{h.value=!1}}}async function L(){if(h.value)return;if(!f.value.title.trim()||!f.value.body.trim())return void or("Título y mensaje son requeridos");h.value=!0;const{title:e,body:a,type:n}=f.value;S(`📨 Enviando notificación tipo: ${n}`,"info");try{let i;switch(n){case"all":i=await ba.sendNotificationToAll(e,a),S("✅ Notificación enviada a todos los usuarios","success");break;case"user":i=await ba.sendNotificationToUser(t.user.id,e,a),S("✅ Notificación enviada solo para ti","success");break;case"device":const n=m.value||localStorage.getItem("fcm_token");if(!n)throw new Error("No hay token FCM disponible");i=await ba.sendNotificationToDevice(n,e,a),S("✅ Notificación enviada a tu dispositivo","success");break;default:throw new Error("Tipo de notificación no válido")}sr("Notificación enviada exitosamente"),S(`📝 Respuesta: ${JSON.stringify(i)}`,"info")}catch(i){S(`❌ Error enviando notificación: ${i.message}`,"error"),or(`Error enviando notificación: ${i.message}`)}finally{h.value=!1}}function M(){const e=m.value||localStorage.getItem("fcm_token");e?(S("🔑 Token FCM actual:","info"),S(e,"info"),sr("Token mostrado en el log")):(S("❌ No hay token FCM disponible","error"),or("No hay token FCM disponible"))}async function U(){const e=m.value||localStorage.getItem("fcm_token");if(e)try{await navigator.clipboard.writeText(e),S("📋 Token copiado al portapapeles","success"),sr("Token copiado al portapapeles")}catch(t){S("❌ Error copiando token","error"),or("Error copiando token")}else or("No hay token para copiar")}async function F(){if(h.value)return;if(m.value||localStorage.getItem("fcm_token")){h.value=!0,S("🗑️ Eliminando token...","info");try{m.value=null,localStorage.removeItem("fcm_token"),S("✅ Token eliminado","success"),sr("Token eliminado")}catch(e){S(`❌ Error eliminando token: ${e.message}`,"error"),or(`Error eliminando token: ${e.message}`)}finally{h.value=!1}}else or("No hay token para eliminar")}return g(()=>{S("🔧 Panel de debug cargado","info"),I.browser=navigator.userAgent.split("(")[0].trim(),I.pushSupport="Notification"in window,I.serviceWorkerSupport="serviceWorker"in navigator,I.firebaseProject="mozoqr-7d32c","Notification"in window&&(y.value="granted"===Notification.permission,S(`📋 Permisos actuales: ${Notification.permission}`,"info"));const e=localStorage.getItem("fcm_token");e&&(m.value=e,S(`🔑 Token FCM encontrado: ${e.substring(0,20)}...`,"info")),S("👤 Usuario autenticado: "+(t.isAuthenticated?"Sí":"No"),"info"),t.user&&S(`👤 ID: ${t.user.id} | Email: ${t.user.email}`,"info")}),(e,t)=>(w(),s("div",ID,[t[21]||(t[21]=o("div",{class:"debug-header"},[o("h3",null,"🧪 Debug de Notificaciones FCM"),o("p",{class:"debug-subtitle"},"Panel para probar y debuggear notificaciones push")],-1)),o("div",SD,[t[7]||(t[7]=o("h4",null,"📊 Estado del Sistema",-1)),o("div",TD,[o("div",{class:C(["status-item",{active:b.value}])},[o("span",ND,l(b.value?"✅":"❌"),1),t[3]||(t[3]=o("span",null,"Usuario Autenticado",-1))],2),o("div",{class:C(["status-item",{active:y.value}])},[o("span",AD,l(y.value?"✅":"❌"),1),t[4]||(t[4]=o("span",null,"Permisos Push",-1))],2),o("div",{class:C(["status-item",{active:E.value}])},[o("span",PD,l(E.value?"✅":"❌"),1),t[5]||(t[5]=o("span",null,"Token FCM",-1))],2),o("div",RD,[t[6]||(t[6]=o("span",{class:"status-icon"},"🔔",-1)),o("span",null,l(i(c).totalUnreadCount)+" no leídas",1)])])]),o("div",xD,[t[8]||(t[8]=o("h4",null,"⚡ Acciones Rápidas",-1)),o("div",DD,[o("button",{onClick:A,disabled:h.value,class:"debug-btn primary"},l(h.value?"Procesando...":"🔔 Pedir Permisos"),9,OD),o("button",{onClick:R,disabled:h.value,class:"debug-btn secondary"}," 🚀 Inicializar FCM ",8,LD),o("button",{onClick:x,disabled:h.value,class:"debug-btn secondary"}," 📤 Enviar Token al Servidor ",8,MD),o("button",{onClick:O,disabled:h.value,class:"debug-btn info"}," 📥 Cargar Notificaciones ",8,UD)])]),o("div",FD,[t[13]||(t[13]=o("h4",null,"📤 Enviar Notificaciones de Prueba",-1)),o("div",qD,[o("div",BD,[t[9]||(t[9]=o("label",null,"Título:",-1)),d(o("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>f.value.title=e),placeholder:"Título de la notificación"},null,512),[[u,f.value.title]])]),o("div",jD,[t[10]||(t[10]=o("label",null,"Mensaje:",-1)),d(o("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>f.value.body=e),placeholder:"Cuerpo del mensaje",rows:"2"},null,512),[[u,f.value.body]])]),o("div",$D,[t[12]||(t[12]=o("label",null,"Tipo:",-1)),d(o("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>f.value.type=e)},t[11]||(t[11]=[o("option",{value:"all"},"🌐 Enviar a Todos",-1),o("option",{value:"user"},"👤 Enviar Solo a Mí",-1),o("option",{value:"device"},"📱 Enviar a Mi Device",-1)]),512),[[D,f.value.type]])]),o("button",{onClick:L,disabled:h.value,class:"debug-btn primary full-width"},l(h.value?"Enviando...":"📨 Enviar Notificación"),9,zD)])]),o("div",VD,[t[14]||(t[14]=o("h4",null,"🔑 Gestión de Device Tokens",-1)),o("div",WD,[o("button",{onClick:M,class:"debug-btn secondary"}," 👀 Ver Token Actual "),o("button",{onClick:U,class:"debug-btn secondary"}," 📋 Copiar Token "),o("button",{onClick:F,disabled:h.value,class:"debug-btn danger"}," 🗑️ Eliminar Token ",8,HD)])]),p.value.length>0?(w(),s("div",GD,[t[15]||(t[15]=o("h4",null,"📝 Log de Eventos",-1)),o("div",KD,[(w(!0),s(_,null,k(p.value.slice(-10),e=>{return w(),s("div",{key:e.id,class:C(["log-item",e.type])},[o("span",JD,l((t=e.timestamp,t.toLocaleTimeString())),1),o("span",YD,l(e.message),1)],2);var t}),128))]),o("div",{class:"log-actions"},[o("button",{onClick:T,class:"debug-btn small"},"Limpiar Log"),o("button",{onClick:N,class:"debug-btn small"},"💾 Descargar Log")])])):r("",!0),o("div",QD,[t[20]||(t[20]=o("h4",null,"🔧 Información Técnica",-1)),o("div",ZD,[o("div",XD,[t[16]||(t[16]=o("strong",null,"Navegador:",-1)),v(" "+l(I.browser),1)]),o("div",eO,[t[17]||(t[17]=o("strong",null,"Soporte Push:",-1)),v(" "+l(I.pushSupport?"Sí":"No"),1)]),o("div",tO,[t[18]||(t[18]=o("strong",null,"Service Worker:",-1)),v(" "+l(I.serviceWorkerSupport?"Sí":"No"),1)]),o("div",aO,[t[19]||(t[19]=o("strong",null,"Firebase Project:",-1)),v(" "+l(I.firebaseProject),1)])])])]))}},iO=Mh(nO,[["__scopeId","data-v-03f702b6"]]),sO={class:"notification-debug"},oO={key:0,class:"current-notifications"},rO={class:"notifications-list"},lO={class:"notification-header"},cO={class:"notification-time"},dO={class:"notification-body"},uO={class:"notification-meta"},hO={class:"notification-type"},pO={class:"notification-status"},mO=Mh({__name:"NotificationDebug",setup(e){const t=lr(),a=n(()=>[...t.unreadNotifications,...t.readNotifications]);async function i(){try{await(async()=>{try{console.log("🧪 Enviando notificación de prueba para app cerrada...");const e=await ga.post("/notifications/test-background",{title:"🔔 Prueba App Cerrada",message:"Esta notificación debe aparecer cuando la app está cerrada",data:{type:"background_test",timestamp:(new Date).toISOString(),test_mode:!0}});return console.log("✅ Notificación de prueba enviada:",e.data),e.data}catch(e){throw console.error("❌ Error enviando notificación de prueba:",e),e}})(),alert("✅ Notificación de prueba enviada. Cierra la app y verifica que llegue la notificación.")}catch(e){alert("❌ Error enviando notificación: "+e.message)}}async function c(){try{await(async(e=10)=>{try{console.log(`🕐 Programando notificación de prueba en ${e} segundos...`);const t=await ga.post("/notifications/schedule-test",{delay:e,title:"⏰ Notificación Programada",message:`Esta notificación fue programada hace ${e} segundos`,data:{type:"scheduled_test",scheduled_at:(new Date).toISOString(),delay_seconds:e}});return console.log("✅ Notificación programada:",t.data),t.data}catch(t){throw console.error("❌ Error programando notificación:",t),t}})(15),alert("✅ Notificación programada para 15 segundos. Cierra la app y espera.")}catch(e){alert("❌ Error programando notificación: "+e.message)}}function d(){const e={steps:["1. Asegúrate de estar autenticado en la app","2. Ejecuta sendTestBackgroundNotification() o scheduleTestNotification()","3. Cierra completamente la aplicación (no solo minimizar)","4. Espera unos segundos","5. Deberías ver la notificación en la barra de notificaciones","6. Al tocar la notificación, la app debe abrirse"],note:"Para Android, asegúrate de que los permisos de notificaciones estén activados y que la app no esté en modo ahorro de batería."},t=`\nInstrucciones para probar notificaciones:\n\n${e.steps.join("\n")}\n\nNota: ${e.note}\n  `;alert(t)}return(e,t)=>(w(),s("div",sO,[t[2]||(t[2]=o("div",{class:"page-header"},[o("h1",null,"Panel de Debug - Notificaciones"),o("p",{class:"subtitle"},"Prueba y monitorea el sistema de notificaciones FCM")],-1)),h(iO),o("div",{class:"background-tests"},[t[0]||(t[0]=o("h2",null,"📴 Pruebas App Cerrada",-1)),t[1]||(t[1]=o("p",{class:"test-description"}," Estas pruebas envían notificaciones que deben llegar cuando la aplicación está completamente cerrada. ",-1)),o("div",{class:"test-buttons"},[o("button",{onClick:i,class:"test-btn primary"}," 🧪 Probar App Cerrada "),o("button",{onClick:c,class:"test-btn secondary"}," ⏰ Notificación en 15s "),o("button",{onClick:d,class:"test-btn info"}," 📋 Ver Instrucciones ")])]),a.value.length>0?(w(),s("div",oO,[o("h2",null,"📬 Notificaciones Actuales ("+l(a.value.length)+")",1),o("div",rO,[(w(!0),s(_,null,k(a.value.slice(0,10),e=>{var t,a,n;return w(),s("div",{key:e.id,class:C(["notification-preview",{unread:!e.read_at}])},[o("div",lO,[o("strong",null,l((null==(t=e.data)?void 0:t.title)||e.title||"Sin título"),1),o("span",cO,l((n=e.created_at||e.timestamp,new Date(n).toLocaleString())),1)]),o("p",dO,l((null==(a=e.data)?void 0:a.message)||e.body||"Sin mensaje"),1),o("div",uO,[o("span",hO,l(e.type||"notification"),1),o("span",pO,l(e.read_at?"Leída":"No leída"),1)])],2)}),128))])])):r("",!0),t[3]||(t[3]=R('<div class="instructions" data-v-da0dde4d><h2 data-v-da0dde4d>📋 Instrucciones de Uso</h2><div class="instruction-steps" data-v-da0dde4d><div class="step" data-v-da0dde4d><span class="step-number" data-v-da0dde4d>1</span><div class="step-content" data-v-da0dde4d><strong data-v-da0dde4d>Inicializar Sistema:</strong><p data-v-da0dde4d>Haz clic en &quot;Inicializar Sistema&quot; para configurar FCM y obtener permisos.</p></div></div><div class="step" data-v-da0dde4d><span class="step-number" data-v-da0dde4d>2</span><div class="step-content" data-v-da0dde4d><strong data-v-da0dde4d>Probar Notificaciones:</strong><p data-v-da0dde4d>Usa &quot;Test Local&quot; para notificaciones inmediatas o &quot;Servidor&quot; para probar el backend.</p></div></div><div class="step" data-v-da0dde4d><span class="step-number" data-v-da0dde4d>3</span><div class="step-content" data-v-da0dde4d><strong data-v-da0dde4d>Verificar en el Bell:</strong><p data-v-da0dde4d>Las notificaciones aparecerán en el icono de campana en la barra superior.</p></div></div></div></div>',1))]))}},[["__scopeId","data-v-da0dde4d"]]),fO={class:"onboarding-container"},vO={class:"content-wrapper"},gO={class:"options"},bO={key:0,class:"card"},wO={class:"form-group"},yO={class:"form-group"},_O={class:"form-row"},kO={class:"form-group"},CO={class:"form-group"},EO={class:"form-group"},IO={class:"actions"},SO=["disabled"],TO={key:0,class:"spinner"},NO={key:1},AO=["disabled"],PO={key:0,class:"error"},RO={key:1,class:"card"},xO={class:"form-group"},DO=Mh({__name:"Onboarding",setup(e){const t=b(),n=CE(),i=a("create"),h=a(!1),p=a(""),m=P({name:"",address:"",phone:"",email:"",description:""}),f=a("");g(async()=>{!n.requiresBusinessSetup&&n.activeBusinessId&&t.replace({name:"admin"})});const y=async()=>{if(p.value="",m.name&&m.address)if(!m.email||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m.email)){h.value=!0;try{const e={name:m.name,address:m.address,phone:m.phone||void 0,email:m.email||void 0,description:m.description||void 0};await n.createBusiness(e),t.replace({name:"admin"})}catch(e){p.value=e.message||"No se pudo crear el negocio."}finally{h.value=!1}}else p.value="El email no es válido.";else p.value="Nombre y dirección son obligatorios."},_=async()=>{},k=()=>{t.replace({name:"admin"})};return(e,t)=>(w(),s("div",fO,[o("div",vO,[t[15]||(t[15]=o("div",{class:"header"},[o("h1",null,"Configura tu negocio"),o("p",{class:"subtitle"},"Eres admin y aún no tienes un negocio configurado.")],-1)),o("div",gO,[o("button",{class:C(["tab-btn",{active:"create"===i.value}]),onClick:t[0]||(t[0]=e=>i.value="create")}," Crear negocio ",2),o("button",{class:C(["tab-btn hidden",{active:"join"===i.value}]),onClick:t[1]||(t[1]=e=>i.value="join"),disabled:""}," Unirse a negocio (próximamente) ",2)]),"create"===i.value?(w(),s("div",bO,[o("form",{onSubmit:c(y,["prevent"])},[o("div",wO,[t[8]||(t[8]=o("label",null,[v("Nombre del negocio"),o("span",{class:"req"},"*")],-1)),d(o("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>m.name=e),type:"text",maxlength:"255",required:"",placeholder:"Ej: Café Central"},null,512),[[u,m.name,void 0,{trim:!0}]])]),o("div",yO,[t[9]||(t[9]=o("label",null,[v("Dirección"),o("span",{class:"req"},"*")],-1)),d(o("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>m.address=e),type:"text",maxlength:"255",required:"",placeholder:"Calle 123, Ciudad"},null,512),[[u,m.address,void 0,{trim:!0}]])]),o("div",_O,[o("div",kO,[t[10]||(t[10]=o("label",null,"Teléfono",-1)),d(o("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>m.phone=e),type:"text",maxlength:"20",placeholder:"Opcional"},null,512),[[u,m.phone,void 0,{trim:!0}]])]),o("div",CO,[t[11]||(t[11]=o("label",null,"Email",-1)),d(o("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>m.email=e),type:"email",maxlength:"255",placeholder:"Opcional"},null,512),[[u,m.email,void 0,{trim:!0}]])])]),o("div",EO,[t[12]||(t[12]=o("label",null,"Descripción",-1)),d(o("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>m.description=e),maxlength:"500",rows:"3",placeholder:"Opcional"},null,512),[[u,m.description,void 0,{trim:!0}]])]),o("div",IO,[o("button",{type:"submit",class:"btn-primary",disabled:h.value},[h.value?(w(),s("span",TO)):(w(),s("span",NO,"Crear negocio"))],8,SO),o("button",{type:"button",class:"btn-secondary",onClick:k,disabled:h.value},"Cancelar",8,AO)]),p.value?(w(),s("p",PO,l(p.value),1)):r("",!0)],32)])):(w(),s("div",RO,[o("form",{onSubmit:c(_,["prevent"])},[o("div",xO,[t[13]||(t[13]=o("label",null,"Código de invitación",-1)),d(o("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>f.value=e),type:"text",maxlength:"32",placeholder:"Ej: ABCD1234",disabled:""},null,512),[[u,f.value,void 0,{trim:!0}]])]),t[14]||(t[14]=o("div",{class:"actions"},[o("button",{type:"submit",class:"btn-primary",disabled:""},"Unirse")],-1))],32)]))])]))}},[["__scopeId","data-v-d90919cc"]]),OO={class:"call-waiter-container"},LO={key:0,class:"call-idle-state"},MO=["disabled"],UO={key:0},FO={key:1},qO={key:1,class:"call-calling-state"},BO={key:2,class:"call-waiting-state"},jO={class:"call-status-card"},$O={class:"wait-time"},zO={key:3,class:"call-acknowledged-state"},VO={key:4,class:"call-error-state"},WO={class:"call-status-card error"},HO={class:"urgency-options"},GO=Mh({__name:"CallWaiterButton",props:{tableId:{type:[String,Number],required:!0},businessId:{type:[String,Number],required:!0},tableNumber:{type:[String,Number],default:null}},emits:["call-status-change"],setup(e,{emit:t}){const a=e,i=t,d=P({callState:"idle",loading:!1,showUrgencyOptions:!1,waitTimeSeconds:0,errorMessage:{},currentCallId:null,waitTimer:null}),u=n(()=>d.callState),h=n(()=>d.loading),p=n({get:()=>d.showUrgencyOptions,set:e=>d.showUrgencyOptions=e}),m=n(()=>d.waitTimeSeconds),f=n(()=>d.errorMessage),b=n(()=>{const e=d.waitTimeSeconds;if(e<60)return`${e}s`;return`${Math.floor(e/60)}m ${e%60}s`}),y=()=>{d.showUrgencyOptions=!0},_=()=>{k("urgent")},k=async(e="normal")=>{d.showUrgencyOptions=!1,d.callState="calling",d.loading=!0,i("call-status-change","calling");try{console.log("📞 Calling waiter...",{tableId:a.tableId,urgency:e,tableNumber:a.tableNumber});const t=await om.callWaiter(a.tableId,{message:"urgent"===e?"Solicitud urgente":"Solicita mozo",urgency:"urgent"===e?"high":"normal",client_info:{timestamp:(new Date).toISOString(),table_number:a.tableNumber}});t.success?(console.log("✅ Waiter called successfully:",t),d.currentCallId=t.call_id,d.callState="waiting",d.waitTimeSeconds=0,T(),A(),i("call-status-change","waiting")):E(t)}catch(t){console.error("❌ Error calling waiter:",t),E(t)}finally{d.loading=!1}},E=e=>{var t,a;d.callState="error",(null==(t=e.message)?void 0:t.includes("no_waiter_assigned"))?d.errorMessage={title:"Mozo no disponible",description:"No hay un mozo asignado a esta mesa actualmente. Por favor, solicite ayuda al personal del establecimiento."}:(null==(a=e.message)?void 0:a.includes("table_silenced"))?d.errorMessage={title:"Mesa temporalmente silenciada",description:"Su mesa está temporalmente silenciada. Inténtelo de nuevo en unos minutos."}:d.errorMessage={title:"Error en la conexión",description:"No pudimos procesar su solicitud. Verifique su conexión a internet e inténtelo nuevamente."},i("call-status-change","error")},S=()=>{N(),R(),d.callState="idle",d.currentCallId=null,d.waitTimeSeconds=0,d.errorMessage={},i("call-status-change","idle")},T=()=>{N(),d.waitTimer=setInterval(()=>{d.waitTimeSeconds+=1},1e3)},N=()=>{d.waitTimer&&(clearInterval(d.waitTimer),d.waitTimer=null)},A=()=>{window.addEventListener("waiter-call-acknowledged",x),window.addEventListener("waiter-call-completed",D)},R=()=>{window.removeEventListener("waiter-call-acknowledged",x),window.removeEventListener("waiter-call-completed",D)},x=e=>{console.log("✅ Waiter acknowledged call:",e.detail),e.detail.call_id===d.currentCallId&&(N(),d.callState="acknowledged",i("call-status-change","acknowledged"))},D=e=>{console.log("✅ Waiter completed call:",e.detail),e.detail.call_id===d.currentCallId&&S()};return g(()=>{console.log("🔔 CallWaiterButton mounted",{tableId:a.tableId,businessId:a.businessId,tableNumber:a.tableNumber})}),I(()=>{N(),R()}),(e,t)=>(w(),s("div",OO,["idle"===u.value?(w(),s("div",LO,[t[5]||(t[5]=o("div",{class:"call-info"},[o("h3",null,[o("i",{class:"fas fa-concierge-bell"}),v(" ¿Necesitas ayuda? ")]),o("p",null,"Presiona el botón para llamar a tu mozo")],-1)),o("button",{onClick:y,class:"call-button primary",disabled:h.value},[o("i",{class:C(["fas fa-bell",{"fa-spin":h.value}])},null,2),h.value?(w(),s("span",FO,"Conectando...")):(w(),s("span",UO,"Llamar Mozo"))],8,MO)])):"calling"===u.value?(w(),s("div",qO,t[6]||(t[6]=[o("div",{class:"call-status-card"},[o("div",{class:"status-icon calling"},[o("i",{class:"fas fa-paper-plane"})]),o("h3",null,"Llamando mozo..."),o("p",null,"Estamos notificando a tu mozo"),o("div",{class:"loading-dots"},[o("span"),o("span"),o("span")])],-1)]))):"waiting"===u.value?(w(),s("div",BO,[o("div",jO,[t[9]||(t[9]=o("div",{class:"status-icon waiting"},[o("i",{class:"fas fa-clock"})],-1)),t[10]||(t[10]=o("h3",null,"¡Mozo notificado!",-1)),t[11]||(t[11]=o("p",null,"Aguarde por favor, su mozo fue notificado y lo atenderá en breve",-1)),o("div",$O,[t[7]||(t[7]=o("i",{class:"fas fa-hourglass-half"},null,-1)),o("span",null,"Tiempo de espera: "+l(b.value),1)]),m.value>120?(w(),s("button",{key:0,onClick:_,class:"call-button urgent"},t[8]||(t[8]=[o("i",{class:"fas fa-exclamation-triangle"},null,-1),v(" Llamar urgente ")]))):r("",!0)])])):"acknowledged"===u.value?(w(),s("div",zO,[o("div",{class:"call-status-card success"},[t[13]||(t[13]=o("div",{class:"status-icon acknowledged"},[o("i",{class:"fas fa-check"})],-1)),t[14]||(t[14]=o("h3",null,"¡Mozo en camino!",-1)),t[15]||(t[15]=o("p",null,"Su mozo confirmó la llamada y se dirige a su mesa",-1)),o("button",{onClick:S,class:"call-button secondary"},t[12]||(t[12]=[o("i",{class:"fas fa-redo"},null,-1),v(" Nueva solicitud ")]))])])):"error"===u.value?(w(),s("div",VO,[o("div",WO,[t[17]||(t[17]=o("div",{class:"status-icon error"},[o("i",{class:"fas fa-exclamation-triangle"})],-1)),o("h3",null,l(f.value.title||"Error en la llamada"),1),o("p",null,l(f.value.description||"No pudimos contactar con su mozo. Intente nuevamente."),1),o("button",{onClick:S,class:"call-button primary"},t[16]||(t[16]=[o("i",{class:"fas fa-redo"},null,-1),v(" Intentar nuevamente ")]))])])):r("",!0),p.value?(w(),s("div",{key:5,class:"urgency-modal-overlay",onClick:t[4]||(t[4]=e=>p.value=!1)},[o("div",{class:"urgency-modal",onClick:t[3]||(t[3]=c(()=>{},["stop"]))},[t[20]||(t[20]=o("h4",null,"Tipo de solicitud",-1)),o("div",HO,[o("button",{onClick:t[0]||(t[0]=e=>k("normal")),class:"urgency-option normal"},t[18]||(t[18]=[o("i",{class:"fas fa-bell"},null,-1),o("span",null,"Normal",-1),o("small",null,"Solicitud general",-1)])),o("button",{onClick:t[1]||(t[1]=e=>k("urgent")),class:"urgency-option urgent"},t[19]||(t[19]=[o("i",{class:"fas fa-exclamation-triangle"},null,-1),o("span",null,"Urgente",-1),o("small",null,"Necesito atención inmediata",-1)]))]),o("button",{onClick:t[2]||(t[2]=e=>p.value=!1),class:"cancel-btn"}," Cancelar ")])])):r("",!0)]))}},[["__scopeId","data-v-28254294"]]),KO="0.0.133",JO=()=>`v${KO}`,YO={class:"menu-table-page"},QO={class:"business-header"},ZO={class:"business-info"},XO={key:0,class:"business-logo"},eL=["src","alt"],tL={class:"business-details"},aL={class:"table-info"},nL={key:0,class:"business-address"},iL={class:"main-content"},sL={class:"menu-section"},oL={key:0,class:"loading-state"},rL={key:1,class:"error-state"},lL={key:2,class:"pdf-container"},cL=["src"],dL={class:"pdf-actions"},uL=["href"],hL={key:3,class:"no-menu-state"},pL={class:"waiter-call-section"},mL={class:"page-footer"},fL={class:"app-branding"},vL={class:"version"},gL=Mh({__name:"MenuTable",setup(e){const t=y(),a=n(()=>t.params.tableId),c=n(()=>t.query.business_id),d=n(()=>t.query.table_number||a.value),u=P({businessData:{},menuPdfUrl:null,loadingMenu:!0,loadingBusiness:!0,menuError:!1,businessError:!1,callStatus:"idle"}),p=n(()=>u.businessData),m=n(()=>u.menuPdfUrl),f=n(()=>u.loadingMenu),b=n(()=>u.menuError),_=async()=>{if(c.value)try{u.loadingBusiness=!0,u.businessError=!1;const e=await ga.get(`/public/business/${c.value}`);if(!e.data.success)throw new Error(e.data.message||"Error loading business info");u.businessData=e.data.business,console.log("✅ Business info loaded:",u.businessData)}catch(e){console.error("❌ Error loading business info:",e),u.businessError=!0,u.businessData={name:"Restaurante",address:null,logo:null}}finally{u.loadingBusiness=!1}else console.error("Business ID not provided")},k=async()=>{if(!c.value)return console.error("Business ID not provided for menu"),void(u.loadingMenu=!1);try{u.loadingMenu=!0,u.menuError=!1;const e=await ga.get(`/public/business/${c.value}/menu`);e.data.success&&e.data.menu_pdf_url?(u.menuPdfUrl=e.data.menu_pdf_url,console.log("✅ Menu PDF loaded:",u.menuPdfUrl)):(console.warn("⚠️ No menu available for this business"),u.menuPdfUrl=null)}catch(e){console.error("❌ Error loading menu:",e),u.menuError=!0}finally{u.loadingMenu=!1}},C=e=>{u.callStatus=e,console.log("📱 Call status changed:",e)};return g(async()=>{console.log("🏠 MenuTable mounted",{tableId:a.value,businessId:c.value,tableNumber:d.value}),a.value&&c.value?await Promise.all([_(),k()]):console.error("❌ Missing required parameters")}),(e,t)=>(w(),s("div",YO,[o("div",QO,[o("div",ZO,[p.value.logo?(w(),s("div",XO,[o("img",{src:p.value.logo,alt:p.value.name},null,8,eL)])):r("",!0),o("div",tL,[o("h1",null,l(p.value.name||"Bienvenido"),1),o("div",aL,[t[0]||(t[0]=o("i",{class:"fas fa-table"},null,-1)),o("span",null,"Mesa "+l(d.value),1)]),p.value.address?(w(),s("div",nL,[t[1]||(t[1]=o("i",{class:"fas fa-map-marker-alt"},null,-1)),o("span",null,l(p.value.address),1)])):r("",!0)])])]),o("div",iL,[o("div",sL,[t[8]||(t[8]=o("div",{class:"section-header"},[o("h2",null,[o("i",{class:"fas fa-utensils"}),v(" Nuestro Menú ")])],-1)),f.value?(w(),s("div",oL,t[2]||(t[2]=[o("div",{class:"spinner"},null,-1),o("p",null,"Cargando menú...",-1)]))):b.value?(w(),s("div",rL,[t[4]||(t[4]=o("i",{class:"fas fa-exclamation-triangle"},null,-1)),t[5]||(t[5]=o("p",null,"No pudimos cargar el menú",-1)),o("button",{onClick:k,class:"retry-btn"},t[3]||(t[3]=[o("i",{class:"fas fa-refresh"},null,-1),v(" Reintentar ")]))])):m.value?(w(),s("div",lL,[o("iframe",{src:m.value,class:"pdf-viewer",title:"Menú del restaurante",frameborder:"0"},null,8,cL),o("div",dL,[o("a",{href:m.value,target:"_blank",class:"pdf-action-btn"},t[6]||(t[6]=[o("i",{class:"fas fa-external-link-alt"},null,-1),v(" Ver menú completo ")]),8,uL)])])):(w(),s("div",hL,t[7]||(t[7]=[o("i",{class:"fas fa-file-pdf"},null,-1),o("p",null,"Menú no disponible temporalmente",-1),o("small",null,"Consulte con el personal del establecimiento",-1)])))]),o("div",pL,[h(GO,{"table-id":a.value,"business-id":c.value,"table-number":d.value,onCallStatusChange:C},null,8,["table-id","business-id","table-number"])])]),o("div",mL,[o("div",fL,[t[9]||(t[9]=o("span",null,"Powered by",-1)),t[10]||(t[10]=o("strong",null,"MozoApp",-1)),o("span",vL,l(i(JO)()),1)])])]))}},[["__scopeId","data-v-eae715a0"]]),bL=q({history:B("/"),routes:[{path:"/",name:"root",beforeEnter:(e,t,a)=>{const n=tn(),{isAuthenticated:i,currentRole:s}=j(n);if(i.value){const e=s.value;if(!e)return a({name:"role-selection"});return a({name:"waiter"===e?"waiter-dashboard":"admin"})}return a({name:"login"})}},{path:"/login",name:"login",component:Zh,meta:{requiresGuest:!0}},{path:"/register",name:"register",component:yp,meta:{requiresGuest:!0}},{path:"/forgot-password",name:"forgot-password",component:Rp,meta:{requiresGuest:!0}},{path:"/join/:token",name:"join-staff",component:()=>G(()=>import("./JoinStaff-CfbO3qEg.js"),__vite__mapDeps([10,1,2,11])),meta:{requiresGuest:!1}},{path:"/reset-password",name:"reset-password",component:Jp,meta:{requiresGuest:!0}},{path:"/role-selection",name:"role-selection",component:sm,meta:{requiresAuth:!0}},{path:"/waiter/dashboard",name:"waiter-dashboard",component:kE,meta:{requiresAuth:!0,role:"waiter"}},{path:"/waiter/onboard",name:"waiter-onboard",component:HS,meta:{requiresAuth:!0,role:"waiter"}},{path:"/staff/invitations",name:"staff-invitations",component:CT,meta:{requiresAuth:!0}},{path:"/profile",name:"profile",component:LS,meta:{requiresAuth:!0}},{path:"/completeness",name:"completeness",component:()=>G(()=>import("./Completeness-BbP7MUeN.js"),__vite__mapDeps([12,1,2,13])),meta:{requiresAuth:!0}},{path:"/admin",name:"admin",component:sN,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/onboard",name:"admin-onboard",component:DO,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/home",redirect:{name:"admin"}},{path:"/admin/qr",name:"admin-qr",component:vA,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/stats",name:"admin-stats",component:bA,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/staff",name:"admin-staff",component:zP,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/staff/:id",name:"admin-staff-detail",component:ix,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/profile",name:"admin-profile",component:Vx,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/settings",name:"admin-settings",component:ED,meta:{requiresAuth:!0,role:"admin"}},{path:"/admin/notification-debug",name:"admin-notification-debug",component:mO,meta:{requiresAuth:!0,role:"admin"}},{path:"/menu/mesa/:tableId",name:"menu-table",component:gL,meta:{isPublic:!0}},{path:"/:pathMatch(.*)*",redirect:"/"}]});bL.beforeEach(async(e,t,a)=>{var n;const i=tn(),{isAuthenticated:s,currentRole:o,initialized:r}=j(i),{useAdminStore:l}=await G(async()=>{const{useAdminStore:e}=await Promise.resolve().then(()=>EE);return{useAdminStore:e}},void 0),c=l();if(e.meta.isPublic)return a();if(e.meta.requiresGuest)return s.value?a({name:"root"}):a();if(e.meta.requiresAuth){if(!r.value)try{await i.tryToLogin()}catch(d){}if(!s.value)return a({name:"login"});if(i.user||await i.fetchUser(!1),e.meta.role){if(!o.value)return a({name:"role-selection"});const t=o.value;if(e.meta.role!==t)return a({name:"waiter"===t?"waiter-dashboard":"admin"})}if((null==(n=e.name)?void 0:n.toString().startsWith("admin"))&&"admin-onboard"!==e.name)try{if(!1===c.requiresBusinessSetup&&c.activeBusinessId);else{const e=await c.fetchBusinessData();if(c.requiresBusinessSetup||(null==e?void 0:e.requires_business_setup))return a({name:"admin-onboard"})}}catch(d){}}return a()});const wL=t("ui",()=>{const e=a(!1);return{isOffCanvasOpen:e,toggleOffCanvas:function(){e.value=!e.value},closeOffCanvas:function(){e.value=!1}}}),yL={class:"notification-bell-container"},_L={key:0,class:"notification-badge"},kL={class:"dropdown-header"},CL={class:"notification-count"},EL={key:0,class:"notification-list"},IL=["onClick"],SL={class:"notification-content"},TL={class:"notification-title"},NL={class:"notification-message"},AL={class:"notification-time"},PL={key:0,class:"unread-dot"},RL={key:1,class:"empty-notifications"},xL={key:2,class:"dropdown-footer"},DL=Mh({__name:"NotificationBell",setup(e){const t=lr(),i=a(!1),d=n(()=>t.totalUnreadCount),u=n(()=>t.hasUnreadNotifications),h=n(()=>t.allUnreadNotifications.concat(t.allReadNotifications)),p=n(()=>d.value>99?"99+":d.value);function m(){i.value=!i.value}function f(){i.value=!1}async function v(){try{const e=t.allUnreadNotifications.map(async e=>"waiter_call"===e.type||"waiter_notification"===e.type?t.handleWaiterNotification(e.id,"mark_as_read"):t.handleNotification(e.id,"mark_as_read"));await Promise.all(e),await Promise.all([t.loadNotifications(),t.loadWaiterNotifications()]),f()}catch(e){console.error("Error marking all notifications as read:",e),f()}}function b(e){if(!e)return"";const t=new Date(e),a=new Date-t,n=Math.floor(a/36e5),i=Math.floor(a/6e4);return n>24?t.toLocaleDateString():n>0?`${n}h`:i>0?`${i}m`:"ahora"}function y(e){e.target.closest(".notification-bell-container")||f()}return g(()=>{document.addEventListener("click",y)}),I(()=>{document.removeEventListener("click",y)}),(e,a)=>(w(),s("div",yL,[o("button",{onClick:m,class:C(["notification-bell",{"has-notifications":u.value}])},[a[1]||(a[1]=o("i",{class:"bi bi-bell"},null,-1)),d.value>0?(w(),s("span",_L,l(p.value),1)):r("",!0)],2),i.value?(w(),s("div",{key:0,class:"notification-dropdown",onClick:a[0]||(a[0]=c(()=>{},["stop"]))},[o("div",kL,[a[2]||(a[2]=o("h4",null,"Notificaciones",-1)),o("span",CL,l(d.value)+" nuevas",1)]),h.value.length>0?(w(),s("div",EL,[(w(!0),s(_,null,k(h.value.slice(0,5),e=>{var a,n;return w(),s("div",{key:e.id,class:C(["notification-item",{unread:!e.read_at}]),onClick:a=>async function(e){if(!e.read_at)try{"waiter_call"===e.type||"waiter_notification"===e.type?await t.handleWaiterNotification(e.id,"mark_as_read"):await t.handleNotification(e.id,"mark_as_read"),await Promise.all([t.loadNotifications(),t.loadWaiterNotifications()])}catch(a){console.error("Error marking notification as read:",a)}}(e)},[o("div",SL,[o("div",TL,l((null==(a=e.data)?void 0:a.title)||e.title||"Notificación"),1),o("div",NL,l((null==(n=e.data)?void 0:n.message)||e.body||"Nueva notificación recibida"),1),o("div",AL,l(b(e.created_at)),1)]),e.read_at?r("",!0):(w(),s("div",PL))],10,IL)}),128))])):(w(),s("div",RL,a[3]||(a[3]=[o("i",{class:"bi bi-bell-slash"},null,-1),o("p",null,"No hay notificaciones",-1)]))),h.value.length>0?(w(),s("div",xL,[o("button",{onClick:v,class:"action-btn"},"Marcar todas como leídas")])):r("",!0)])):r("",!0)]))}},[["__scopeId","data-v-3d95d0ec"]]),OL={class:"navbar-container"},LL={class:"top-bar"},ML={class:"navbar-left"},UL={class:"app-title"},FL={key:0,class:"navbar-right"},qL=Mh({__name:"Navbar",props:{title:{type:String,default:"MÖZÖ"}},setup(e){const t=wL(),a=tn();return(n,c)=>(w(),s("div",OL,[o("header",LL,[o("div",ML,[o("button",{class:"menu-toggle",onClick:c[0]||(c[0]=(...e)=>i(t).toggleOffCanvas&&i(t).toggleOffCanvas(...e)),"aria-label":"Abrir menú"},c[1]||(c[1]=[o("i",{class:"bi bi-list"},null,-1)])),o("h1",UL,l(e.title),1)]),i(a).isAuthenticated?(w(),s("div",FL,[h(DL)])):r("",!0)])]))}},[["__scopeId","data-v-33d07fba"]]),BL={class:"off-canvas-panel"},jL={class:"panel-header"},$L={class:"header-content"},zL={class:"user-info"},VL={class:"user-avatar"},WL=["src","alt"],HL={key:1,class:"bi bi-person-circle avatar-icon"},GL={class:"user-details"},KL={class:"user-name"},JL={key:0,class:"user-email"},YL={class:"user-role"},QL={class:"panel-nav"},ZL={key:0},XL={key:1},eM={key:2},tM={key:3},aM=Mh({__name:"OffCanvasNavbar",setup(e){const t=wL(),a=tn(),{currentRole:d,user:u}=j(a),p=b(),y=n(()=>t.isOffCanvasOpen),_=n(()=>d.value),k=n(()=>{var e,t;return(null==(e=u.value)?void 0:e.display_name)||(null==(t=u.value)?void 0:t.name)||"Usuario"}),E=n(()=>{var e;return(null==(e=u.value)?void 0:e.avatar)||null}),I=n(()=>{var e;return(null==(e=u.value)?void 0:e.email)||null});g(()=>{try{console.log("OffCanvasNavbar - mounted - userRole:",_.value),console.log("OffCanvasNavbar - mounted - isAuthenticated:",a.isAuthenticated),console.log("OffCanvasNavbar - mounted - currentRole:",a.currentRole)}catch(e){}});const S=async()=>{t.closeOffCanvas(),await a.logout(),p.push({name:"login"})};return(e,a)=>{const n=f("RouterLink");return w(),s("div",{class:C(["off-canvas-container",{open:y.value}])},[o("div",{class:"off-canvas-backdrop",onClick:a[0]||(a[0]=(...e)=>i(t).closeOffCanvas&&i(t).closeOffCanvas(...e))}),o("aside",BL,[o("header",jL,[o("div",$L,[o("div",zL,[o("div",VL,[E.value?(w(),s("img",{key:0,src:E.value,alt:k.value,class:"avatar-img"},null,8,WL)):(w(),s("i",HL))]),o("div",GL,[o("h4",KL,l(k.value),1),I.value?(w(),s("p",JL,l(I.value),1)):r("",!0),o("p",YL,l("admin"===_.value?"Administrador":"Mesero"),1)])]),o("button",{onClick:a[1]||(a[1]=(...e)=>i(t).closeOffCanvas&&i(t).closeOffCanvas(...e)),class:"close-btn"},"×")])]),o("nav",QL,[o("ul",null,["admin"===_.value?(w(),s("li",ZL,[h(n,{to:{name:"admin"},class:"nav-link",onClick:a[2]||(a[2]=e=>i(t).closeOffCanvas())},{default:m(()=>a[9]||(a[9]=[o("i",{class:"bi bi-speedometer2"},null,-1),v(" Dashboard ")])),_:1,__:[9]})])):r("",!0),o("li",null,[h(n,{to:{name:"admin-notification-debug"},class:"nav-link",onClick:a[3]||(a[3]=e=>i(t).closeOffCanvas())},{default:m(()=>a[10]||(a[10]=[o("i",{class:"bi bi-bug"},null,-1),v(" Debug Notificaciones ")])),_:1,__:[10]})]),"waiter"===_.value?(w(),s("li",XL,[h(n,{to:{name:"waiter-dashboard"},class:"nav-link",onClick:a[4]||(a[4]=e=>i(t).closeOffCanvas())},{default:m(()=>a[11]||(a[11]=[o("i",{class:"bi bi-grid-1x2-fill"},null,-1),v(" Tablero ")])),_:1,__:[11]})])):r("",!0),o("li",null,[h(n,{to:{name:"staff-invitations"},class:"nav-link",onClick:a[5]||(a[5]=e=>i(t).closeOffCanvas())},{default:m(()=>a[12]||(a[12]=[o("i",{class:"bi bi-envelope"},null,-1),v(" Invitaciones ")])),_:1,__:[12]})]),"admin"===_.value?(w(),s("li",eM,[h(n,{to:{name:"admin-profile"},class:"nav-link",onClick:a[6]||(a[6]=e=>i(t).closeOffCanvas())},{default:m(()=>a[13]||(a[13]=[o("i",{class:"bi bi-person-fill"},null,-1),v(" Mi Perfil ")])),_:1,__:[13]})])):r("",!0),"waiter"===_.value?(w(),s("li",tM,[h(n,{to:{name:"profile"},class:"nav-link",onClick:a[7]||(a[7]=e=>i(t).closeOffCanvas())},{default:m(()=>a[14]||(a[14]=[o("i",{class:"bi bi-person-fill"},null,-1),v(" Mi Perfil ")])),_:1,__:[14]})])):r("",!0),o("li",null,[h(n,{to:{name:"role-selection"},class:"nav-link",onClick:a[8]||(a[8]=e=>i(t).closeOffCanvas())},{default:m(()=>a[15]||(a[15]=[o("i",{class:"bi bi-person-badge-fill"},null,-1),v(" Cambiar Rol ")])),_:1,__:[15]})]),a[17]||(a[17]=o("li",{class:"separator"},null,-1)),o("li",null,[o("a",{onClick:c(S,["prevent"]),class:"nav-link"},a[16]||(a[16]=[o("i",{class:"bi bi-box-arrow-right"},null,-1),v(" Cerrar Sesión ")]))])])])])],2)}}},[["__scopeId","data-v-e17b3ea6"]]),nM={class:"app-container"},iM={key:2,class:"app-footer"},sM={class:"footer-content"},oM={class:"version"},rM={__name:"App",setup(e){const t=y(),a=b(),c=tn(),d=lr(),u=n(()=>!["login","register","forgot-password","reset-password","role-selection"].includes(t.name)),p=n(()=>void 0===c.initialized||c.initialized),v=()=>{["login","register","forgot-password","reset-password","role-selection"].includes(t.name)?Ph.exitApp():a.options.history.state.back?a.back():Ph.exitApp()};return g(async()=>{if((async()=>{try{await Ph.addListener("backButton",v)}catch(e){console.warn("No se pudo configurar el listener del botón atrás:",e)}})(),await c.tryToLogin(),c.isAuthenticated){d.loadNotifications(),d.initializeRealTimeNotifications();try{const e=!!window.Capacitor&&window.Capacitor.getPlatform&&"web"!==window.Capacitor.getPlatform(),t=localStorage.getItem("fcm_token");if(!e&&!t&&!window.__pushInitStarted){window.__pushInitStarted=!0,console.log("🔔 (Fallback) Inicializando push porque fcm_token está vacío tras login restaurado...");const{initializePushNotifications:e}=await G(async()=>{const{initializePushNotifications:e}=await Promise.resolve().then(()=>gM);return{initializePushNotifications:e}},void 0);await e();const t=localStorage.getItem("fcm_token");console.log("🔔 (Fallback) Resultado obtención token:",t?t.substring(0,25)+"...":"NO TOKEN"),t||console.warn("⚠️ (Fallback) No se pudo obtener token FCM en inicialización tardía.")}}catch(e){console.warn("⚠️ (Fallback) Error asegurando token FCM:",e)}}}),I(()=>{(async()=>{try{await Ph.removeAllListeners("backButton")}catch(e){console.warn("Error al limpiar listeners del botón atrás:",e)}})(),c.isAuthenticated&&d.disconnectRealTimeNotifications()}),(e,t)=>{const a=f("router-view");return w(),s("div",nM,[u.value&&p.value?(w(),S(qL,{key:0})):r("",!0),u.value&&p.value?(w(),S(aM,{key:1})):r("",!0),o("main",{class:C({"with-navbar":u.value})},[h(a,null,{default:m(({Component:e})=>[h(T,{name:"fade",mode:"out-in"},{default:m(()=>[(w(),S($(e)))]),_:2},1024)]),_:1})],2),u.value&&p.value?(w(),s("footer",iM,[o("div",sM,[t[0]||(t[0]=o("span",{class:"app-name"},"MozoApp",-1)),o("span",oM,l(i(JO)()),1)])])):r("",!0)])}}},lM=$a("PushNotifications",{}),cM=Object.freeze(Object.defineProperty({__proto__:null,PushNotifications:lM},Symbol.toStringTag,{value:"Module"})),dM={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_DEBUG_MODE:"true",VITE_FIREBASE_ANDROID_APP_ID:"1:175482362472:android:f2589ca9ec71fd0cb6b9dd",VITE_FIREBASE_API_KEY:"AIzaSyBlupKSIy7qtTsXukqROyVjMNx03X8CCzU",VITE_FIREBASE_APP_ID:"1:175482362472:web:308070c885bacc71b6b9dd",VITE_FIREBASE_AUTH_DOMAIN:"mozoqr-7d32c.firebaseapp.com",VITE_FIREBASE_DATABASE_URL:"https://mozoqr-7d32c-default-rtdb.firebaseio.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"175482362472",VITE_FIREBASE_PROJECT_ID:"mozoqr-7d32c",VITE_FIREBASE_STORAGE_BUCKET:"mozoqr-7d32c.firebasestorage.app",VITE_FIREBASE_VAPID_KEY:"BNJgpNkgB0a0y7gHT-SNBFLMGIZw-Xx8NTBDCn_4dVqekzgmnGmKMIn10t-6gWl3Qj_msyCcfbsVycnAp8USs6M",VITE_GOOGLE_ANDROID_CLIENT_ID:"175482362472-d8i8so3lpdbkl30ls0gme012t18f9q8q.apps.googleusercontent.com",VITE_GOOGLE_API_KEY:"AIzaSyAytXxncmi_89lUiLeXKDy6tPpV-BrxWFY",VITE_GOOGLE_CLIENT_ID:"175482362472-sbae126lpnl34rlsf24p8lmdau1obob3.apps.googleusercontent.com",VITE_GOOGLE_IOS_CLIENT_ID:"175482362472-qv7ql9v55gu9tq0um54u3u54up6584ud.apps.googleusercontent.com",VITE_MEASUREMENT_ID:"G-6N7J4X94DH",VITE_PUSHER_APP_CLUSTER:"us2",VITE_PUSHER_APP_KEY:"bd06ab967cc733531514",VITE_QR_BASE_URL:"https://mozoqr.com",VITE_URL_API:"https://mozoqr.com/api/"},uM=a({configured:!1,tokenExists:!1}),hM=async()=>{if(!ja.isPluginAvailable("PushNotifications"))return{available:!1,reason:"Plugin no disponible"};try{const e=await lM.checkPermissions(),t=localStorage.getItem("fcm_token");return{available:!0,permissions:e.receive,hasToken:!!t,token:t?`${t.substring(0,20)}...`:null,platform:ja.getPlatform()}}catch(e){return{available:!1,reason:e.message}}},pM=()=>{const e=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_PROJECT_ID"].filter(e=>!dM[e]);return{configured:0===e.length,missing:e,config:{apiKey:"Configurada",projectId:"Configurada"}}};(async()=>{try{if(ja.isPluginAvailable&&ja.isPluginAvailable("LocalNotifications")){const t=(await G(()=>import("./index-F8_fAb3q.js"),__vite__mapDeps([9,1,2]))).LocalNotifications;try{t&&t.createChannel&&(await t.createChannel({id:"mozo_waiter",name:"Mozo - Llamadas",importance:5,visibility:1,description:"Notificaciones de llamadas y eventos importantes para mozos"}),console.log("✅ Canal mozo_waiter creado al importar pushNotifications"))}catch(e){console.warn("⚠️ Error creando canal mozo_waiter al importar:",e)}}}catch(e){console.warn("⚠️ No se pudo crear canal mozo_waiter al importar pushNotifications:",e)}})();const mM=e=>{try{const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      top: 50px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: rgba(0,0,0,0.9);\n      color: white;\n      padding: 12px 20px;\n      border-radius: 8px;\n      z-index: 10000;\n      font-size: 14px;\n      font-weight: bold;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.5);\n      max-width: 90%;\n      text-align: center;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.parentElement&&t.remove()},3e3)}catch(t){console.warn("Toast debug failed:",t)}},fM=e=>{try{if(!e.data)return!1;const t="string"==typeof e.data?JSON.parse(e.data):e.data;return"acknowledged"===t.status||"completed"===t.status?(console.log("🚫 Filtrando actualización de estado:",t.status),!0):e.android&&"normal"===e.android.priority?(console.log("🚫 Filtrando notificación de prioridad normal (posible confirmación)"),!0):"normal"===t.priority&&"new_call"!==t.type&&(console.log("🚫 Filtrando notificación normal que no es llamada nueva"),!0)}catch(t){return console.warn("⚠️ Error filtering notification:",t),!1}},vM=e=>{console.log("🔄 Procesando notificación del backend...");let t={title:e.title||"Nueva notificación",body:e.body||"Tienes una nueva notificación",data:e.data||{}};if(e.data){const a="string"==typeof e.data?JSON.parse(e.data):e.data;switch(console.log("🔄 Datos de notificación:",a),a.type){case"TestNotification":t={title:"Notificación de Prueba",body:"Esta es una notificación de prueba enviada a todos los usuarios del negocio",data:{...a,icon:"🧪",priority:"normal",channels:["Database","Broadcast","FCM"]}};break;case"UserSpecificNotification":t={title:a.title||"Notificación Personalizada",body:a.message||"Tienes una nueva notificación personalizada",data:{...a,icon:"👤",priority:"high",channels:["Database","Broadcast","FCM"]}};break;case"WebSocketTestNotification":t={title:"⚡ Prueba WebSocket + FCM",body:"Esta notificación llega por WebSocket (tiempo real) y FCM (push)",data:{...a,icon:"⚡",priority:"high",test_mode:"websocket_fcm"}};break;case"WebSocketOnlyNotification":t={title:"🔌 Prueba Solo WebSocket",body:"Esta notificación SOLO llega por WebSocket en tiempo real",data:{...a,icon:"🔌",priority:"normal",test_mode:"websocket_only"}};break;default:e.title&&e.body&&(t={title:e.title,body:e.body,data:{...a,icon:"📱",priority:"normal"}})}}return console.log("✅ Notificación procesada:",t),t},gM=Object.freeze(Object.defineProperty({__proto__:null,checkFirebaseConfig:pM,fcmStatus:uM,getNotificationStatus:hM,initializePushNotifications:async()=>{console.log("🔔 Inicializando sistema de notificaciones push...");const e=ja.getPlatform();console.log("🔔 Plataforma detectada:",e),await(async()=>{if(console.log("🔔 Setting up push notification listeners..."),"web"===ja.getPlatform())try{return console.log("🔔 Setting up Firebase listeners for web..."),await La.setupForegroundMessageListener(e=>{console.log("🚨 FCM NOTIFICATION RECEIVED IN REAL-TIME:",e),console.log("⏰ Received at:",(new Date).toLocaleTimeString()),G(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>cr);return{useNotificationsStore:e}},void 0).then(({useNotificationsStore:t})=>{var a,n,i,s;const o=t(),r=(null==(a=e.data)?void 0:a.call_id)||(null==(n=e.data)?void 0:n.callId)||(null==(i=e.data)?void 0:i.callID)||null,l={id:r||`fcm-${Date.now()}`,type:(null==(s=e.data)?void 0:s.type)||(r?"waiter_call":"FCMNotification"),data:{title:e.title,message:e.body,...e.data},created_at:(new Date).toISOString(),read_at:null,source:"fcm-realtime"};try{if(r&&window.ultraFastNotifications&&window.ultraFastNotifications.activeCalls&&window.ultraFastNotifications.activeCalls.has(r))return void console.log("🔍 Skipping FCM store add for call already in UltraFast activeCalls:",r)}catch(c){console.warn("⚠️ Error checking ultraFastNotifications activeCalls for dedupe:",c)}console.log("📨 Adding notification to store:",l),r&&(o.waiterUnreadNotifications.find(e=>e.id===r)||o.unreadNotifications.find(e=>e.id===r))?console.log("🔁 Duplicate notification skipped (canonicalCallId):",r):(o.addNewNotification(l),console.log("✅ Notification added to reactive store!"))}).catch(e=>{console.error("❌ Error importing notifications store:",e)})}),void console.log("✅ Firebase listeners configured for web")}catch(e){return void console.error("❌ Error setting up Firebase listeners:",e)}if(ja.isPluginAvailable("PushNotifications"))try{lM.addListener("registration",async t=>{var a,n,i,s;console.log("✅ Push registration success, token:",t.value),localStorage.setItem("fcm_token",t.value);let o=0;const r=e=>new Promise(t=>setTimeout(t,e));for(;o<5;)try{const e=tn();if(console.log("🔔 Intento de envío de token - intento",o+1,"authState:",{isAuthenticated:e.isAuthenticated,userId:null==(a=e.user)?void 0:a.id}),e.isAuthenticated&&(null==(n=e.user)?void 0:n.id)){const a=ja.getPlatform();console.log("🔔 Enviando token al backend (móvil):",{token:t.value.substring(0,20)+"...",platform:a,userId:null==(i=e.user)?void 0:i.id});const n=await ba.storeDeviceToken(t.value,a,null==(s=e.user)?void 0:s.id);console.log("✅ Device token stored successfully (móvil):",n);break}o++,console.log("⚠️ Usuario no autenticado aún, reintentando en 500ms..."),await r(500);continue}catch(e){console.error("❌ Error intentando enviar token (móvil):",e),o++,await r(500)}5===o&&console.warn("⚠️ No se pudo enviar token al backend después de varios intentos. Se dejó guardado localmente.")}),lM.addListener("registrationError",e=>{console.error("❌ Error on registration:",JSON.stringify(e))}),lM.addListener("pushNotificationReceived",e=>{var t,a,n;const i=(null==(t=e.android)?void 0:t.priority)||(null==(a=e.data)?void 0:a.priority)||"unknown",s=(null==(n=e.data)?void 0:n.status)||"unknown";if(console.log(`🔔 Push received - Priority: ${i}, Status: ${s}`),console.log("🔔 Full notification:",JSON.stringify(e,null,2)),mM(`📨 Push: ${i}/${s}`),fM(e))return console.log(`🚫 Notificación filtrada - Priority: ${i}, Status: ${s}`),void mM(`🚫 FILTRADA: ${i}/${s}`);console.log(`✅ Notificación permitida - Priority: ${i}, Status: ${s}`),mM(`✅ PERMITIDA: ${i}/${s}`);const o=vM(e);try{G(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>cr);return{useNotificationsStore:e}},void 0).then(({useNotificationsStore:e})=>{var t,a,n,i,s;const r=e(),l={id:(null==(t=o.data)?void 0:t.staff_request_id)||(null==(a=o.data)?void 0:a.id)||`push-${Date.now()}`,type:(null==(n=o.data)?void 0:n.type)||"push",data:{title:o.title,message:o.body,route:(null==(i=o.data)?void 0:i.route)||(null==(s=o.data)?void 0:s.url),...o.data},created_at:(new Date).toISOString(),read_at:null,source:"push-foreground"};r.addNewNotification(l)}).catch(e=>console.error("Error adding push notification to store",e))}catch(r){console.error("Error importing notifications store for pushNotificationReceived",r)}ja.isPluginAvailable("LocalNotifications")?G(async()=>{const{LocalNotifications:e}=await import("./index-F8_fAb3q.js");return{LocalNotifications:e}},__vite__mapDeps([9,1,2])).then(({LocalNotifications:e})=>{e.schedule({notifications:[{title:o.title,body:o.body,id:(new Date).getTime(),sound:null,actionTypeId:"OPEN_APP",extra:{...o.data,receivedAt:(new Date).toISOString(),source:"push-foreground"}}]}).catch(e=>{console.error("❌ Error programando notificación local:",e)})}).catch(e=>{console.error("❌ Error importando LocalNotifications:",e)}):"Notification"in window&&"granted"===Notification.permission&&new Notification(o.title,{body:o.body,icon:"/favicon.ico",tag:"push-notification",data:o.data})}),lM.addListener("pushNotificationActionPerformed",e=>{console.log("🔔 Push action performed:",JSON.stringify(e,null,2));const t=e.notification&&(e.notification.data||e.notification.extra||e.notification);try{const e=t&&(t.route||t.url);if(e){console.log("🔔 Navegando a (mobile):",e);try{bL.push(e)}catch(a){console.warn("Error navigating to route from push action",a)}}else window.dispatchEvent(new CustomEvent("pushNotificationAction",{detail:t}))}catch(n){console.error("Error handling pushNotificationActionPerformed data",n)}}),console.log("✅ Listeners de notificaciones configurados correctamente")}catch(e){console.error("❌ Error configurando listeners:",e)}else console.log("⚠️ Plugin PushNotifications no disponible para listeners")})();const t=await(async()=>{var e;console.log("🔔 Starting push notification registration...");const t=ja.getPlatform(),a=ja.isNativePlatform();if(console.log("🔔 DETECTED - Platform:",t,"Native:",a),"web"===t&&!a)try{if(console.log("🔔 Web platform detected, using Firebase FCM..."),!(await La.initializeFirebase()))return{success:!1,error:"Firebase initialization failed"};const t=await La.getFCMToken();console.log("🔔 FCM token obtained for web:",t.substring(0,20)+"..."),localStorage.setItem("fcm_token",t);const a=tn();if(a.isAuthenticated)try{const n=await ba.storeDeviceToken(t,"web",null==(e=a.user)?void 0:e.id);console.log("✅ Device token stored:",n),uM.value={configured:!0,tokenExists:!0}}catch(n){console.error("❌ Error storing device token:",n)}else console.warn("⚠️ User not authenticated - token not sent to server");return{success:!0,token:t}}catch(n){return console.error("❌ FCM registration error:",n),{success:!1,error:n.message}}try{if(console.log("🔔 MOBILE: Starting Capacitor push notification registration..."),console.log("🔔 MOBILE: Platform:",ja.getPlatform()),console.log("🔔 MOBILE: Native platform:",ja.isNativePlatform()),!ja.isPluginAvailable("PushNotifications"))return console.warn("⚠️ Plugin PushNotifications no disponible para registro (móvil)"),{success:!1,error:"PushNotifications plugin not available"};console.log("✅ MOBILE: PushNotifications plugin available");try{console.log("🔔 MOBILE: Requesting push permissions...");const e=await lM.requestPermissions();if(console.log("🔔 MOBILE: Push permission result:",e),e&&"denied"===e.receive)return console.error("❌ MOBILE: Push permissions DENIED"),{success:!1,error:"Push permissions denied"};console.log("✅ MOBILE: Push permissions OK")}catch(i){console.warn("⚠️ MOBILE: Error requesting push permissions:",i)}return console.log("🔔 MOBILE: Calling PushNotifications.register()..."),await lM.register(),console.log("✅ MOBILE: PushNotifications.register() completed"),{success:!0,token:null}}catch(n){return console.error("❌ Mobile push registration error:",n),{success:!1,error:n.message}}})();ja.isPluginAvailable&&ja.isPluginAvailable("LocalNotifications")&&G(async()=>{const{LocalNotifications:e}=await import("./index-F8_fAb3q.js");return{LocalNotifications:e}},__vite__mapDeps([9,1,2])).then(({LocalNotifications:e})=>{try{e&&e.createChannel&&e.createChannel({id:"mozo_waiter",name:"Mozo - Llamadas",importance:5,visibility:1,description:"Notificaciones de llamadas y eventos importantes para mozos"}).then(()=>{console.log("✅ Canal de notificaciones Android creado: mozo_waiter")}).catch(e=>{console.warn("⚠️ Error creando canal LocalNotifications:",e)})}catch(t){console.warn("⚠️ Excepción creando canal LocalNotifications:",t)}}).catch(e=>{console.warn("⚠️ No se pudo importar LocalNotifications para crear canal:",e)});const a=await hM(),n=pM(),i=La.getFirebaseStatus();return console.log("🔔 Estado final de notificaciones:",{platform:e,registration:t,status:a,firebase:n,firebaseStatus:i}),{platform:e,registration:t,status:a,firebase:n,firebaseStatus:i}}},Symbol.toStringTag,{value:"Module"}));const bM=z(rM),wM=V();bM.use(wM),bM.use(bL),function(){if("undefined"!=typeof window&&(console.log("🔍 OAuth Handler: Checking for tokens on page load..."),console.log("🔍 Current URL:",window.location.href),console.log("🔍 Hash:",window.location.hash),window.location.hash.includes("access_token=")||window.location.hash.includes("id_token="))){console.log("✅ OAuth2 token detected! Storing in sessionStorage...");const e=window.location.hash.substring(1),t=new URLSearchParams(e),a={access_token:t.get("access_token"),id_token:t.get("id_token"),token_type:t.get("token_type"),expires_in:t.get("expires_in"),scope:t.get("scope"),state:t.get("state"),nonce:t.get("nonce"),timestamp:Date.now()};console.log("🔍 Storing token data:",{...a,access_token:a.access_token?"***":null,id_token:a.id_token?"***":null}),sessionStorage.setItem("oauth_token_data",JSON.stringify(a)),window.history.replaceState({},document.title,window.location.pathname+window.location.search),console.log("✅ Token stored and URL cleaned")}}(),(async()=>{try{const t=tn(),a=lr();a.initializeSettings(),await a.requestNotificationPermission(),t.initialized||await t.tryToLogin();try{const{checkForRedirectResult:e}=await G(async()=>{const{checkForRedirectResult:e}=await import("./redirectResultHandler-Ci_IUV6f.js");return{checkForRedirectResult:e}},__vite__mapDeps([14,1,2])),a=await e();a&&await t.loginWithGoogle({provider:"google",id_token:a.token,google_token:a.token,email:a.email,name:a.name,avatar:a.imageUrl,uid:a.uid,access_token:a.accessToken})}catch(e){}}catch(e){}await bL.isReady(),bM.mount("#app")})(),"undefined"!=typeof window&&navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",e=>{if(e.data){if("fcm_event"===e.data.type){const n=e.data.payload,i=n.data||{},s=K(),o=i.call_id||i.callId;o&&(s.has(o)||s.upsert({id:o,table_id:i.table_id,table_number:i.table_number,status:i.status||(t=i.type,"new_call"===t?"pending":"acknowledged"===t?"acknowledged":"completed"===t?"completed":"pending"),urgency:i.urgency,called_at:i.timestamp||Date.now(),last_updated:Date.now(),event_type:i.type||"event"}));try{G(async()=>{const{useNotificationsStore:e}=await Promise.resolve().then(()=>cr);return{useNotificationsStore:e}},void 0).then(({useNotificationsStore:e})=>{var t,a;const s=e(),r={id:o||`fcm-${Date.now()}`,type:i.type||"FCMNotification",data:{title:(null==(t=n.notification)?void 0:t.title)||i.title||"Nueva notificación",message:(null==(a=n.notification)?void 0:a.body)||i.body||i.message||"",route:i.route||i.url,...i},created_at:(new Date).toISOString(),read_at:null,source:"fcm-sw"};s.addNewNotification(r)}).catch(e=>console.error("Error adding FCM message to notifications store",e))}catch(a){console.error("Error importing notifications store for fcm_event",a)}return}if("notification_click"===e.data.type)try{const t=e.data.data||{},a=t.route||t.url;a?(window.focus(),bL.push(a).catch(()=>{})):window.dispatchEvent(new CustomEvent("notification_click",{detail:t}))}catch(a){console.error("Error handling notification_click message",a)}}var t});const yM=(()=>{try{if(!window.Capacitor)return!1;if("function"==typeof window.Capacitor.isNativePlatform){return window.Capacitor.isNativePlatform()}if("function"==typeof window.Capacitor.getPlatform){const e=window.Capacitor.getPlatform();return"android"===e||"ios"===e}return!1}catch(e){return!1}})();yM&&"android"===(null==(e=window.Capacitor)?void 0:e.getPlatform())&&setTimeout(async()=>{try{const e=await G(()=>import("./androidFCM-DnXR5pmY.js"),__vite__mapDeps([15,1,2]));(null==e?void 0:e.initializeAndroidFCM)&&await e.initializeAndroidFCM()}catch(e){console.error("❌ Error inicializando Android FCM:",e),console.error("❌ Stack trace:",e.stack)}},3e3),!yM&&"serviceWorker"in navigator&&navigator.serviceWorker.register("/firebase-messaging-sw.js").then(e=>console.log("Service Worker registrado:",e.scope)).catch(e=>console.warn("No se pudo registrar el Service Worker:",e)),yM?console.log("Saltando runNotificationDiagnostics en entorno nativo"):async function(){try{if("serviceWorker"in navigator)try{await navigator.serviceWorker.getRegistration("/firebase-messaging-sw.js")}catch(e){}const n="undefined"!=typeof Notification?Notification.permission:"unsupported";if(localStorage.getItem("fcm_token"),"denied"===n);else try{if("default"===n&&"granted"!==await Notification.requestPermission())return;if(await La.initializeFirebase())try{const e=await La.getFCMToken();if(e&&localStorage.setItem("fcm_token",e),localStorage.getItem("token"))try{await ba.storeDeviceToken(e,"web")}catch(t){console.warn("[NotificationDiagnostics] Error enviando token al backend:",(null==t?void 0:t.message)||t)}}catch(a){console.warn("[NotificationDiagnostics] Error obteniendo FCM token:",(null==a?void 0:a.message)||a)}else console.warn("[NotificationDiagnostics] No se pudo inicializar Firebase (revisar variables env y SW)")}catch(e){console.warn("[NotificationDiagnostics] Error durante diagnóstico FCM:",e)}}finally{console.groupEnd()}}().catch(e=>console.warn("Error ejecutando diagnósticos de notificación:",e));export{$r as A,jE as B,ja as C,pc as D,Vr as E,zr as F,lu as G,xl as H,Tr as I,Rr as J,xr as K,Mr as L,Xr as M,Dr as N,bl as O,hl as P,dr as Q,wa as R,Ec as S,an as T,Ah as U,Nw as V,za as W,cM as X,G as _,Iw as a,ww as b,Tc as c,bc as d,fc as e,gc as f,Sa as g,yc as h,Ia as i,_c as j,wc as k,vc as l,Sc as m,Ic as n,yw as o,$a as p,Mh as q,mw as r,Yp as s,ga as t,tn as u,ll as v,Rl as w,rl as x,jr as y,Br as z};
