const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D8RLanhp.js","assets/vendor-CC72n-b_.js","assets/bootstrap--QliLv9A.js","assets/index-BGuHQhhT.css","assets/index-BZ776mdu.js","assets/index-DlE1A72V.js"])))=>i.map(i=>d[i]);
import{C as o,_ as e}from"./index-D8RLanhp.js";import"./vendor-CC72n-b_.js";import"./bootstrap--QliLv9A.js";let n,t;const i=async()=>{if(!n){const{useAuthStore:o}=await e(async()=>{const{useAuthStore:o}=await import("./index-D8RLanhp.js").then(o=>o.T);return{useAuthStore:o}},__vite__mapDeps([0,1,2,3]));n=o}return n()},a=async()=>{if(!t){const o=await e(()=>import("./index-D8RLanhp.js").then(o=>o.R),__vite__mapDeps([0,1,2,3]));t=o.default}return t},r=async o=>{var e;try{const n=await i();if(!n.isAuthenticated||!(null==(e=n.user)?void 0:e.id))return console.warn("üîî ANDROID FCM: Usuario no autenticado, guardando token para despu√©s"),localStorage.setItem("pending_android_fcm_token",o),!1;console.log("üîî ANDROID FCM: Enviando token al backend..."),console.log("üîî ANDROID FCM: Token completo:",o),console.log("üîî ANDROID FCM: Usuario ID:",n.user.id),console.log("üîî ANDROID FCM: Plataforma: android");const t=await a(),r=await t.storeDeviceToken(o,"android",n.user.id);return console.log("üîî ANDROID FCM: Respuesta del backend:",r),r?(console.log("‚úÖ ANDROID FCM: Token enviado exitosamente al backend"),localStorage.removeItem("pending_android_fcm_token"),!0):(console.error("‚ùå ANDROID FCM: Error enviando token al backend"),!1)}catch(n){return console.error("‚ùå ANDROID FCM: Error enviando token:",n),console.error("‚ùå ANDROID FCM: Stack trace:",n.stack),!1}},s=async()=>{if(!o.isNativePlatform()||"android"!==o.getPlatform())return console.log("üîî ANDROID FCM: Skip - no es Android nativo"),{success:!1,reason:"not_android"};console.log("üîî ANDROID FCM: Inicializando...");try{const{PushNotifications:o}=await e(async()=>{const{PushNotifications:o}=await import("./index-D8RLanhp.js").then(o=>o.V);return{PushNotifications:o}},__vite__mapDeps([0,1,2,3]));await o.addListener("registration",o=>{console.log("üîî ANDROID FCM: Token recibido:",o.value.substring(0,20)+"..."),r(o.value)}),await o.addListener("registrationError",o=>{console.error("‚ùå ANDROID FCM: Error de registro:",o)}),await o.addListener("pushNotificationReceived",o=>{console.log("üîî ANDROID FCM: Notificaci√≥n recibida (FOREGROUND):",o),console.log("üîî ANDROID FCM: T√≠tulo:",o.title),console.log("üîî ANDROID FCM: Cuerpo:",o.body),console.log("üîî ANDROID FCM: Datos:",o.data)}),await o.addListener("pushNotificationActionPerformed",o=>{console.log("üîî ANDROID FCM: Notificaci√≥n TOCADA por el usuario:",o),console.log("üîî ANDROID FCM: T√≠tulo:",o.notification.title),console.log("üîî ANDROID FCM: Cuerpo:",o.notification.body),console.log("üîî ANDROID FCM: Datos:",o.notification.data)}),console.log("üîî ANDROID FCM: Solicitando permisos...");const n=await o.requestPermissions();return console.log("üîî ANDROID FCM: Resultado permisos:",n),"granted"!==n.receive?(console.warn("üîî ANDROID FCM: Permisos de notificaciones denegados"),{success:!1,reason:"permissions_denied"}):(console.log("üîî ANDROID FCM: Registrando PushNotifications..."),await o.register(),console.log("‚úÖ ANDROID FCM: PushNotifications registrado exitosamente"),setTimeout(async()=>{console.log("üîî ANDROID FCM: Esperando token de registro...");try{const{Preferences:o}=await e(async()=>{const{Preferences:o}=await import("./index-BZ776mdu.js");return{Preferences:o}},__vite__mapDeps([4,0,1,2,3])),{value:n}=await o.get({key:"fcm_token"});n?(console.log("üîî ANDROID FCM: Token encontrado en SharedPreferences:",n.substring(0,20)+"..."),r(n)):console.log("üîî ANDROID FCM: No hay token en SharedPreferences a√∫n")}catch(o){console.error("‚ùå ANDROID FCM: Error obteniendo token desde SharedPreferences:",o)}console.log("üîî ANDROID FCM: TEST - Creando notificaci√≥n local de prueba...");try{const{LocalNotifications:o}=await e(async()=>{const{LocalNotifications:o}=await import("./index-DlE1A72V.js");return{LocalNotifications:o}},__vite__mapDeps([5,0,1,2,3]));await o.schedule({notifications:[{title:"TEST - Android FCM",body:"Si ves esto, las notificaciones Android funcionan ‚úÖ",id:99999,schedule:{at:new Date(Date.now()+1e3)},sound:null,attachments:null,actionTypeId:"",extra:null}]}),console.log("‚úÖ ANDROID FCM: Notificaci√≥n local de prueba programada")}catch(o){console.error("‚ùå ANDROID FCM: Error creando notificaci√≥n de prueba:",o)}},2e3),{success:!0})}catch(n){return console.error("‚ùå ANDROID FCM: Error:",n),{success:!1,reason:"exception",error:n.message}}},c=async()=>{var e;if(!o.isNativePlatform()||"android"!==o.getPlatform())return;const n=localStorage.getItem("pending_android_fcm_token");if(n){console.log("üîî ANDROID FCM: Enviando token pendiente...");try{const o=await i();if(o.isAuthenticated&&(null==(e=o.user)?void 0:e.id)){const e=await a();await e.storeDeviceToken(n,"android",o.user.id)&&(console.log("‚úÖ ANDROID FCM: Token pendiente enviado exitosamente"),localStorage.removeItem("pending_android_fcm_token"))}}catch(t){console.error("‚ùå ANDROID FCM: Error enviando token pendiente:",t)}}},d={initializeAndroidFCM:s,sendPendingAndroidToken:c};export{d as default,s as initializeAndroidFCM,c as sendPendingAndroidToken};
