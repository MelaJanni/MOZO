const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D8RLanhp.js","assets/vendor-CC72n-b_.js","assets/bootstrap--QliLv9A.js","assets/index-BGuHQhhT.css"])))=>i.map(i=>d[i]);
import{o as e,r as t,a as r,_ as o,i as a,b as s}from"./index-D8RLanhp.js";import"./vendor-CC72n-b_.js";import"./bootstrap--QliLv9A.js";let n=null,i=null;const l=async()=>{if(i)return{app:n,db:i};try{const e=await a();if(!e)return console.error("staffRealtime: Failed to initialize Firebase app"),null;if(n=e.app,i=s(n),e.auth){const{onAuthStateChanged:t}=await o(async()=>{const{onAuthStateChanged:e}=await import("./index-D8RLanhp.js").then(e=>e.U);return{onAuthStateChanged:e}},__vite__mapDeps([0,1,2,3]));await new Promise(r=>{const o=t(e.auth,e=>{console.log("ðŸ”¥ staffRealtime: Auth state changed:",e?"authenticated":"not authenticated"),o(),r()})})}return console.log("ðŸ”¥ staffRealtime: Firebase initialized successfully"),{app:n,db:i}}catch(e){return console.error("staffRealtime: Firebase init error",e),null}},f=new Map;async function c(e,o){if(!e)return;if(!(await l()))return;const a=t(i,`businesses_staff/${e}`),s=r(a,e=>{const t=e.val();try{o&&"function"==typeof o&&o(t)}catch(r){console.error("startStaffRealtimeForAdmin onChange error",r)}},e=>{console.error("startStaffRealtimeForAdmin listener error",e)});f.set(`admin:${e}`,{ref:a,unsubscribe:s}),console.log("staffRealtime: admin listener started for",e)}function u(t){const r=`admin:${t}`,o=f.get(r);if(o){try{e(o.ref)}catch(a){console.warn("stopStaffRealtimeForAdmin off error",a)}f.delete(r),console.log("staffRealtime: admin listener stopped for",t)}}async function d(e,a){if(!e)return void console.warn("staffRealtime: No userId provided");console.log("ðŸ”¥ staffRealtime: Starting user listener for userId:",e);if(!(await l()))return void console.error("staffRealtime: Failed to initialize Firebase");const s=`users_staff/${e}`;console.log("ðŸ”¥ staffRealtime: Setting up listener for path:",s);try{const{getAuth:e}=await o(async()=>{const{getAuth:e}=await import("./index-D8RLanhp.js").then(e=>e.U);return{getAuth:e}},__vite__mapDeps([0,1,2,3])),t=e(n).currentUser;console.log("ðŸ”¥ staffRealtime: Current user before listener setup:",t?t.uid:"null"),t||console.warn("ðŸ”¥ staffRealtime: No authenticated user found, this may cause permission errors")}catch(d){console.error("ðŸ”¥ staffRealtime: Error checking auth state:",d)}const c=t(i,s),u=r(c,e=>{const t=e.val();try{a&&"function"==typeof a&&a(t)}catch(r){console.error("startStaffRealtimeForUser onChange error",r)}},e=>{console.error("ðŸ”¥ startStaffRealtimeForUser listener error for path:",s,e),console.error("ðŸ”¥ Error details:",{code:null==e?void 0:e.code,message:null==e?void 0:e.message,details:(null==e?void 0:e.details)||(null==e?void 0:e.toString())})});f.set(`user:${e}`,{ref:c,unsubscribe:u}),console.log("staffRealtime: user listener started for",e)}function m(t){const r=`user:${t}`,o=f.get(r);if(o){try{e(o.ref)}catch(a){console.warn("stopStaffRealtimeForUser off error",a)}f.delete(r),console.log("staffRealtime: user listener stopped for",t)}}export{c as startStaffRealtimeForAdmin,d as startStaffRealtimeForUser,u as stopStaffRealtimeForAdmin,m as stopStaffRealtimeForUser};
